/*! For license information please see main.js.LICENSE.txt */
(()=>{var __webpack_modules__={9713:e=>{e.exports=function(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e},e.exports.default=e.exports,e.exports.__esModule=!0},5318:e=>{e.exports=function(e){return e&&e.__esModule?e:{default:e}},e.exports.default=e.exports,e.exports.__esModule=!0},9141:e=>{"use strict";for(var t=/[\\\"\x00-\x1F]/g,n={},r=0;r<32;++r)n[String.fromCharCode(r)]="\\U"+("0000"+r.toString(16)).slice(-4).toUpperCase();function i(e){return t.lastIndex=0,e.replace(t,(function(e){return n[e]}))}n["\b"]="\\b",n["\t"]="\\t",n["\n"]="\\n",n["\f"]="\\f",n["\r"]="\\r",n['"']='\\"',n["\\"]="\\\\",e.exports={stringify:function e(t){switch(typeof t){case"string":return'"'+i(t)+'"';case"number":return isFinite(t)?t:"null";case"boolean":return t;case"object":return null===t?"null":Array.isArray(t)?function(t){for(var n="[",r="",i=0;i<t.length;++i)r+=n,n=",",r+=e(t[i]);return","!=n?"[]":r+"]"}(t):function(t){var n="{",r="",s=Object.keys(t);s.sort();for(var o=0;o<s.length;++o){var a=s[o];r+=n+'"'+i(a)+'":',n=",",r+=e(t[a])}return","!=n?"{}":r+"}"}(t);default:throw new Error("Cannot stringify: "+typeof t)}}}},8162:(e,t,n)=>{"use strict";var r=n(9509).Buffer;e.exports=function(e){if(e.length>=255)throw new TypeError("Alphabet too long");for(var t=new Uint8Array(256),n=0;n<t.length;n++)t[n]=255;for(var i=0;i<e.length;i++){var s=e.charAt(i),o=s.charCodeAt(0);if(255!==t[o])throw new TypeError(s+" is ambiguous");t[o]=i}var a=e.length,l=e.charAt(0),c=Math.log(a)/Math.log(256),d=Math.log(256)/Math.log(a);function u(e){if("string"!=typeof e)throw new TypeError("Expected String");if(0===e.length)return r.alloc(0);for(var n=0,i=0,s=0;e[n]===l;)i++,n++;for(var o=(e.length-n)*c+1>>>0,d=new Uint8Array(o);e[n];){var u=t[e.charCodeAt(n)];if(255===u)return;for(var h=0,p=o-1;(0!==u||h<s)&&-1!==p;p--,h++)u+=a*d[p]>>>0,d[p]=u%256>>>0,u=u/256>>>0;if(0!==u)throw new Error("Non-zero carry");s=h,n++}for(var m=o-s;m!==o&&0===d[m];)m++;var g=r.allocUnsafe(i+(o-m));g.fill(0,0,i);for(var f=i;m!==o;)g[f++]=d[m++];return g}return{encode:function(t){if((Array.isArray(t)||t instanceof Uint8Array)&&(t=r.from(t)),!r.isBuffer(t))throw new TypeError("Expected Buffer");if(0===t.length)return"";for(var n=0,i=0,s=0,o=t.length;s!==o&&0===t[s];)s++,n++;for(var c=(o-s)*d+1>>>0,u=new Uint8Array(c);s!==o;){for(var h=t[s],p=0,m=c-1;(0!==h||p<i)&&-1!==m;m--,p++)h+=256*u[m]>>>0,u[m]=h%a>>>0,h=h/a>>>0;if(0!==h)throw new Error("Non-zero carry");i=p,s++}for(var g=c-i;g!==c&&0===u[g];)g++;for(var f=l.repeat(n);g<c;++g)f+=e.charAt(u[g]);return f},decodeUnsafe:u,decode:function(e){var t=u(e);if(t)return t;throw new Error("Non-base"+a+" character")}}}},9742:(e,t)=>{"use strict";t.byteLength=function(e){var t=l(e),n=t[0],r=t[1];return 3*(n+r)/4-r},t.toByteArray=function(e){var t,n,s=l(e),o=s[0],a=s[1],c=new i(function(e,t,n){return 3*(t+n)/4-n}(0,o,a)),d=0,u=a>0?o-4:o;for(n=0;n<u;n+=4)t=r[e.charCodeAt(n)]<<18|r[e.charCodeAt(n+1)]<<12|r[e.charCodeAt(n+2)]<<6|r[e.charCodeAt(n+3)],c[d++]=t>>16&255,c[d++]=t>>8&255,c[d++]=255&t;return 2===a&&(t=r[e.charCodeAt(n)]<<2|r[e.charCodeAt(n+1)]>>4,c[d++]=255&t),1===a&&(t=r[e.charCodeAt(n)]<<10|r[e.charCodeAt(n+1)]<<4|r[e.charCodeAt(n+2)]>>2,c[d++]=t>>8&255,c[d++]=255&t),c},t.fromByteArray=function(e){for(var t,r=e.length,i=r%3,s=[],o=16383,a=0,l=r-i;a<l;a+=o)s.push(c(e,a,a+o>l?l:a+o));return 1===i?(t=e[r-1],s.push(n[t>>2]+n[t<<4&63]+"==")):2===i&&(t=(e[r-2]<<8)+e[r-1],s.push(n[t>>10]+n[t>>4&63]+n[t<<2&63]+"=")),s.join("")};for(var n=[],r=[],i="undefined"!=typeof Uint8Array?Uint8Array:Array,s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",o=0,a=s.length;o<a;++o)n[o]=s[o],r[s.charCodeAt(o)]=o;function l(e){var t=e.length;if(t%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var n=e.indexOf("=");return-1===n&&(n=t),[n,n===t?0:4-n%4]}function c(e,t,r){for(var i,s,o=[],a=t;a<r;a+=3)i=(e[a]<<16&16711680)+(e[a+1]<<8&65280)+(255&e[a+2]),o.push(n[(s=i)>>18&63]+n[s>>12&63]+n[s>>6&63]+n[63&s]);return o.join("")}r["-".charCodeAt(0)]=62,r["_".charCodeAt(0)]=63},4770:function(e,t){var n,r;n=function(){var e=XMLHttpRequest;if(!e)throw new Error("missing XMLHttpRequest");t.log={trace:r,debug:r,info:r,warn:r,error:r};function t(s,o){if("function"!=typeof o)throw new Error("Bad callback given: "+o);if(!s)throw new Error("No options given");var a=s.onResponse;if((s="string"==typeof s?{uri:s}:JSON.parse(JSON.stringify(s))).onResponse=a,s.verbose&&(t.log=function(){var e,t,n={},s=["trace","debug","info","warn","error"];for(t=0;t<s.length;t++)n[e=s[t]]=r,"undefined"!=typeof console&&console&&console[e]&&(n[e]=i(console,e));return n}()),s.url&&(s.uri=s.url,delete s.url),!s.uri&&""!==s.uri)throw new Error("options.uri is a required argument");if("string"!=typeof s.uri)throw new Error("options.uri must be a string");for(var l=["proxy","_redirectsFollowed","maxRedirects","followRedirect"],c=0;c<l.length;c++)if(s[l[c]])throw new Error("options."+l[c]+" is not supported");if(s.callback=o,s.method=s.method||"GET",s.headers=s.headers||{},s.body=s.body||null,s.timeout=s.timeout||t.DEFAULT_TIMEOUT,s.headers.host)throw new Error("Options.headers.host is not supported");s.json&&(s.headers.accept=s.headers.accept||"application/json","GET"!==s.method&&(s.headers["content-type"]="application/json"),"boolean"!=typeof s.json?s.body=JSON.stringify(s.json):"string"!=typeof s.body&&(s.body=JSON.stringify(s.body)));var d=function(e){var t=[];for(var n in e)e.hasOwnProperty(n)&&t.push(encodeURIComponent(n)+"="+encodeURIComponent(e[n]));return t.join("&")};if(s.qs){var u="string"==typeof s.qs?s.qs:d(s.qs);-1!==s.uri.indexOf("?")?s.uri=s.uri+"&"+u:s.uri=s.uri+"?"+u}if(s.form){if("string"==typeof s.form)throw"form name unsupported";if("POST"===s.method){var h=(s.encoding||"application/x-www-form-urlencoded").toLowerCase();switch(s.headers["content-type"]=h,h){case"application/x-www-form-urlencoded":s.body=d(s.form).replace(/%20/g,"+");break;case"multipart/form-data":var p=function(e){var t={};t.boundry="-------------------------------"+Math.floor(1e9*Math.random());var n=[];for(var r in e)e.hasOwnProperty(r)&&n.push("--"+t.boundry+'\nContent-Disposition: form-data; name="'+r+'"\n\n'+e[r]+"\n");return n.push("--"+t.boundry+"--"),t.body=n.join(""),t.length=t.body.length,t.type="multipart/form-data; boundary="+t.boundry,t}(s.form);s.body=p.body,s.headers["content-type"]=p.type;break;default:throw new Error("unsupported encoding:"+h)}}}return s.onResponse=s.onResponse||r,!0===s.onResponse&&(s.onResponse=o,s.callback=r),!s.headers.authorization&&s.auth&&(s.headers.authorization="Basic "+function(e){var t,n,r,i,s,o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",a=0,l=0,c="",d=[];if(!e)return e;do{t=(s=e.charCodeAt(a++)<<16|e.charCodeAt(a++)<<8|e.charCodeAt(a++))>>18&63,n=s>>12&63,r=s>>6&63,i=63&s,d[l++]=o.charAt(t)+o.charAt(n)+o.charAt(r)+o.charAt(i)}while(a<e.length);switch(c=d.join(""),e.length%3){case 1:c=c.slice(0,-2)+"==";break;case 2:c=c.slice(0,-1)+"="}return c}(s.auth.username+":"+s.auth.password)),function(r){var i=new e,s=!1,o=function(e){var t,n=/^([\w\+\.\-]+:)(?:\/\/([^\/?#:]*)(?::(\d+))?)?/;try{t=location.href}catch(e){(t=document.createElement("a")).href="",t=t.href}var r=n.exec(t.toLowerCase())||[],i=n.exec(e.toLowerCase());return!(!i||i[1]==r[1]&&i[2]==r[2]&&(i[3]||("http:"===i[1]?80:443))==(r[3]||("http:"===r[1]?80:443)))}(r.uri),a="withCredentials"in i;if(n+=1,i.seq_id=n,i.id=n+": "+r.method+" "+r.uri,i._id=i.id,o&&!a){var l=new Error("Browser does not support cross-origin request: "+r.uri);return l.cors="unsupported",r.callback(l,i)}function c(){s=!0;var e=new Error("ETIMEDOUT");return e.code="ETIMEDOUT",e.duration=r.timeout,t.log.error("Timeout",{id:i._id,milliseconds:r.timeout}),r.callback(e,i)}i.timeoutTimer=setTimeout(c,r.timeout);var d={response:!1,loading:!1,end:!1};return i.onreadystatechange=u,i.open(r.method,r.uri,!0),o&&(i.withCredentials=!!r.withCredentials),i.send(r.body),i;function u(n){if(s)return t.log.debug("Ignoring timed out state change",{state:i.readyState,id:i.id});if(t.log.debug("State change",{state:i.readyState,id:i.id,timed_out:s}),i.readyState===e.OPENED)for(var o in t.log.debug("Request started",{id:i.id}),r.headers)i.setRequestHeader(o,r.headers[o]);else i.readyState===e.HEADERS_RECEIVED?h():i.readyState===e.LOADING?(h(),p()):i.readyState===e.DONE&&(h(),p(),m())}function h(){if(!d.response){if(d.response=!0,t.log.debug("Got response",{id:i.id,status:i.status}),clearTimeout(i.timeoutTimer),i.statusCode=i.status,o&&0==i.statusCode){var e=new Error("CORS request rejected: "+r.uri);return e.cors="rejected",d.loading=!0,d.end=!0,r.callback(e,i)}r.onResponse(null,i)}}function p(){d.loading||(d.loading=!0,t.log.debug("Response body loading",{id:i.id}))}function m(){if(!d.end){if(d.end=!0,t.log.debug("Request done",{id:i.id}),i.body=i.responseText,r.json)try{i.body=JSON.parse(i.responseText)}catch(e){return r.callback(e,i)}r.callback(null,i,i.body)}}}(s)}var n=0;function r(){}function i(e,t){return function(n,r){return"object"==typeof r&&(n+=" "+JSON.stringify(r)),e[t].call(e,n)}}return t.withCredentials=!1,t.DEFAULT_TIMEOUT=18e4,t.defaults=function(e,n){var r=function(t){return function(n,r){for(var i in n="string"==typeof n?{uri:n}:JSON.parse(JSON.stringify(n)),e)void 0===n[i]&&(n[i]=e[i]);return t(n,r)}},i=r(t);return i.get=r(t.get),i.post=r(t.post),i.put=r(t.put),i.head=r(t.head),i},["get","put","post","head"].forEach((function(e){var n=e.toUpperCase();t[e.toLowerCase()]=function(e){"string"==typeof e?e={method:n,uri:e}:(e=JSON.parse(JSON.stringify(e))).method=n;var r=[e].concat(Array.prototype.slice.apply(arguments,[1]));return t.apply(this,r)}})),t.couch=function(e,n){return"string"==typeof e&&(e={uri:e}),e.json=!0,e.body&&(e.json=e.body),delete e.body,n=n||r,t(e,(function(e,t,r){if(e)return n(e,t,r);if((t.statusCode<200||t.statusCode>299)&&r.error){for(var i in e=new Error("CouchDB error: "+(r.error.reason||r.error.error)),r)e[i]=r[i];return n(e,t,r)}return n(e,t,r)}))},t},void 0===(r=n.apply(t,[]))||(e.exports=r)},7191:(e,t,n)=>{var r=n(8162);e.exports=r("123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz")},8764:(e,t,n)=>{"use strict";const r=n(9742),i=n(645),s="function"==typeof Symbol&&"function"==typeof Symbol.for?Symbol.for("nodejs.util.inspect.custom"):null;t.Buffer=l,t.SlowBuffer=function(e){return+e!=e&&(e=0),l.alloc(+e)},t.INSPECT_MAX_BYTES=50;const o=2147483647;function a(e){if(e>o)throw new RangeError('The value "'+e+'" is invalid for option "size"');const t=new Uint8Array(e);return Object.setPrototypeOf(t,l.prototype),t}function l(e,t,n){if("number"==typeof e){if("string"==typeof t)throw new TypeError('The "string" argument must be of type string. Received type number');return u(e)}return c(e,t,n)}function c(e,t,n){if("string"==typeof e)return function(e,t){if("string"==typeof t&&""!==t||(t="utf8"),!l.isEncoding(t))throw new TypeError("Unknown encoding: "+t);const n=0|g(e,t);let r=a(n);const i=r.write(e,t);return i!==n&&(r=r.slice(0,i)),r}(e,t);if(ArrayBuffer.isView(e))return function(e){if(Y(e,Uint8Array)){const t=new Uint8Array(e);return p(t.buffer,t.byteOffset,t.byteLength)}return h(e)}(e);if(null==e)throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof e);if(Y(e,ArrayBuffer)||e&&Y(e.buffer,ArrayBuffer))return p(e,t,n);if("undefined"!=typeof SharedArrayBuffer&&(Y(e,SharedArrayBuffer)||e&&Y(e.buffer,SharedArrayBuffer)))return p(e,t,n);if("number"==typeof e)throw new TypeError('The "value" argument must not be of type number. Received type number');const r=e.valueOf&&e.valueOf();if(null!=r&&r!==e)return l.from(r,t,n);const i=function(e){if(l.isBuffer(e)){const t=0|m(e.length),n=a(t);return 0===n.length||e.copy(n,0,0,t),n}return void 0!==e.length?"number"!=typeof e.length||X(e.length)?a(0):h(e):"Buffer"===e.type&&Array.isArray(e.data)?h(e.data):void 0}(e);if(i)return i;if("undefined"!=typeof Symbol&&null!=Symbol.toPrimitive&&"function"==typeof e[Symbol.toPrimitive])return l.from(e[Symbol.toPrimitive]("string"),t,n);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof e)}function d(e){if("number"!=typeof e)throw new TypeError('"size" argument must be of type number');if(e<0)throw new RangeError('The value "'+e+'" is invalid for option "size"')}function u(e){return d(e),a(e<0?0:0|m(e))}function h(e){const t=e.length<0?0:0|m(e.length),n=a(t);for(let r=0;r<t;r+=1)n[r]=255&e[r];return n}function p(e,t,n){if(t<0||e.byteLength<t)throw new RangeError('"offset" is outside of buffer bounds');if(e.byteLength<t+(n||0))throw new RangeError('"length" is outside of buffer bounds');let r;return r=void 0===t&&void 0===n?new Uint8Array(e):void 0===n?new Uint8Array(e,t):new Uint8Array(e,t,n),Object.setPrototypeOf(r,l.prototype),r}function m(e){if(e>=o)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+o.toString(16)+" bytes");return 0|e}function g(e,t){if(l.isBuffer(e))return e.length;if(ArrayBuffer.isView(e)||Y(e,ArrayBuffer))return e.byteLength;if("string"!=typeof e)throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof e);const n=e.length,r=arguments.length>2&&!0===arguments[2];if(!r&&0===n)return 0;let i=!1;for(;;)switch(t){case"ascii":case"latin1":case"binary":return n;case"utf8":case"utf-8":return H(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*n;case"hex":return n>>>1;case"base64":return W(e).length;default:if(i)return r?-1:H(e).length;t=(""+t).toLowerCase(),i=!0}}function f(e,t,n){let r=!1;if((void 0===t||t<0)&&(t=0),t>this.length)return"";if((void 0===n||n>this.length)&&(n=this.length),n<=0)return"";if((n>>>=0)<=(t>>>=0))return"";for(e||(e="utf8");;)switch(e){case"hex":return R(this,t,n);case"utf8":case"utf-8":return T(this,t,n);case"ascii":return A(this,t,n);case"latin1":case"binary":return I(this,t,n);case"base64":return E(this,t,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return O(this,t,n);default:if(r)throw new TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),r=!0}}function y(e,t,n){const r=e[t];e[t]=e[n],e[n]=r}function v(e,t,n,r,i){if(0===e.length)return-1;if("string"==typeof n?(r=n,n=0):n>2147483647?n=2147483647:n<-2147483648&&(n=-2147483648),X(n=+n)&&(n=i?0:e.length-1),n<0&&(n=e.length+n),n>=e.length){if(i)return-1;n=e.length-1}else if(n<0){if(!i)return-1;n=0}if("string"==typeof t&&(t=l.from(t,r)),l.isBuffer(t))return 0===t.length?-1:b(e,t,n,r,i);if("number"==typeof t)return t&=255,"function"==typeof Uint8Array.prototype.indexOf?i?Uint8Array.prototype.indexOf.call(e,t,n):Uint8Array.prototype.lastIndexOf.call(e,t,n):b(e,[t],n,r,i);throw new TypeError("val must be string, number or Buffer")}function b(e,t,n,r,i){let s,o=1,a=e.length,l=t.length;if(void 0!==r&&("ucs2"===(r=String(r).toLowerCase())||"ucs-2"===r||"utf16le"===r||"utf-16le"===r)){if(e.length<2||t.length<2)return-1;o=2,a/=2,l/=2,n/=2}function c(e,t){return 1===o?e[t]:e.readUInt16BE(t*o)}if(i){let r=-1;for(s=n;s<a;s++)if(c(e,s)===c(t,-1===r?0:s-r)){if(-1===r&&(r=s),s-r+1===l)return r*o}else-1!==r&&(s-=s-r),r=-1}else for(n+l>a&&(n=a-l),s=n;s>=0;s--){let n=!0;for(let r=0;r<l;r++)if(c(e,s+r)!==c(t,r)){n=!1;break}if(n)return s}return-1}function w(e,t,n,r){n=Number(n)||0;const i=e.length-n;r?(r=Number(r))>i&&(r=i):r=i;const s=t.length;let o;for(r>s/2&&(r=s/2),o=0;o<r;++o){const r=parseInt(t.substr(2*o,2),16);if(X(r))return o;e[n+o]=r}return o}function S(e,t,n,r){return G(H(t,e.length-n),e,n,r)}function _(e,t,n,r){return G(function(e){const t=[];for(let n=0;n<e.length;++n)t.push(255&e.charCodeAt(n));return t}(t),e,n,r)}function k(e,t,n,r){return G(W(t),e,n,r)}function x(e,t,n,r){return G(function(e,t){let n,r,i;const s=[];for(let o=0;o<e.length&&!((t-=2)<0);++o)n=e.charCodeAt(o),r=n>>8,i=n%256,s.push(i),s.push(r);return s}(t,e.length-n),e,n,r)}function E(e,t,n){return 0===t&&n===e.length?r.fromByteArray(e):r.fromByteArray(e.slice(t,n))}function T(e,t,n){n=Math.min(e.length,n);const r=[];let i=t;for(;i<n;){const t=e[i];let s=null,o=t>239?4:t>223?3:t>191?2:1;if(i+o<=n){let n,r,a,l;switch(o){case 1:t<128&&(s=t);break;case 2:n=e[i+1],128==(192&n)&&(l=(31&t)<<6|63&n,l>127&&(s=l));break;case 3:n=e[i+1],r=e[i+2],128==(192&n)&&128==(192&r)&&(l=(15&t)<<12|(63&n)<<6|63&r,l>2047&&(l<55296||l>57343)&&(s=l));break;case 4:n=e[i+1],r=e[i+2],a=e[i+3],128==(192&n)&&128==(192&r)&&128==(192&a)&&(l=(15&t)<<18|(63&n)<<12|(63&r)<<6|63&a,l>65535&&l<1114112&&(s=l))}}null===s?(s=65533,o=1):s>65535&&(s-=65536,r.push(s>>>10&1023|55296),s=56320|1023&s),r.push(s),i+=o}return function(e){const t=e.length;if(t<=C)return String.fromCharCode.apply(String,e);let n="",r=0;for(;r<t;)n+=String.fromCharCode.apply(String,e.slice(r,r+=C));return n}(r)}t.kMaxLength=o,l.TYPED_ARRAY_SUPPORT=function(){try{const e=new Uint8Array(1),t={foo:function(){return 42}};return Object.setPrototypeOf(t,Uint8Array.prototype),Object.setPrototypeOf(e,t),42===e.foo()}catch(e){return!1}}(),l.TYPED_ARRAY_SUPPORT||"undefined"==typeof console||"function"!=typeof console.error||console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support."),Object.defineProperty(l.prototype,"parent",{enumerable:!0,get:function(){if(l.isBuffer(this))return this.buffer}}),Object.defineProperty(l.prototype,"offset",{enumerable:!0,get:function(){if(l.isBuffer(this))return this.byteOffset}}),l.poolSize=8192,l.from=function(e,t,n){return c(e,t,n)},Object.setPrototypeOf(l.prototype,Uint8Array.prototype),Object.setPrototypeOf(l,Uint8Array),l.alloc=function(e,t,n){return function(e,t,n){return d(e),e<=0?a(e):void 0!==t?"string"==typeof n?a(e).fill(t,n):a(e).fill(t):a(e)}(e,t,n)},l.allocUnsafe=function(e){return u(e)},l.allocUnsafeSlow=function(e){return u(e)},l.isBuffer=function(e){return null!=e&&!0===e._isBuffer&&e!==l.prototype},l.compare=function(e,t){if(Y(e,Uint8Array)&&(e=l.from(e,e.offset,e.byteLength)),Y(t,Uint8Array)&&(t=l.from(t,t.offset,t.byteLength)),!l.isBuffer(e)||!l.isBuffer(t))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(e===t)return 0;let n=e.length,r=t.length;for(let i=0,s=Math.min(n,r);i<s;++i)if(e[i]!==t[i]){n=e[i],r=t[i];break}return n<r?-1:r<n?1:0},l.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},l.concat=function(e,t){if(!Array.isArray(e))throw new TypeError('"list" argument must be an Array of Buffers');if(0===e.length)return l.alloc(0);let n;if(void 0===t)for(t=0,n=0;n<e.length;++n)t+=e[n].length;const r=l.allocUnsafe(t);let i=0;for(n=0;n<e.length;++n){let t=e[n];if(Y(t,Uint8Array))i+t.length>r.length?(l.isBuffer(t)||(t=l.from(t)),t.copy(r,i)):Uint8Array.prototype.set.call(r,t,i);else{if(!l.isBuffer(t))throw new TypeError('"list" argument must be an Array of Buffers');t.copy(r,i)}i+=t.length}return r},l.byteLength=g,l.prototype._isBuffer=!0,l.prototype.swap16=function(){const e=this.length;if(e%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(let t=0;t<e;t+=2)y(this,t,t+1);return this},l.prototype.swap32=function(){const e=this.length;if(e%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(let t=0;t<e;t+=4)y(this,t,t+3),y(this,t+1,t+2);return this},l.prototype.swap64=function(){const e=this.length;if(e%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(let t=0;t<e;t+=8)y(this,t,t+7),y(this,t+1,t+6),y(this,t+2,t+5),y(this,t+3,t+4);return this},l.prototype.toString=function(){const e=this.length;return 0===e?"":0===arguments.length?T(this,0,e):f.apply(this,arguments)},l.prototype.toLocaleString=l.prototype.toString,l.prototype.equals=function(e){if(!l.isBuffer(e))throw new TypeError("Argument must be a Buffer");return this===e||0===l.compare(this,e)},l.prototype.inspect=function(){let e="";const n=t.INSPECT_MAX_BYTES;return e=this.toString("hex",0,n).replace(/(.{2})/g,"$1 ").trim(),this.length>n&&(e+=" ... "),"<Buffer "+e+">"},s&&(l.prototype[s]=l.prototype.inspect),l.prototype.compare=function(e,t,n,r,i){if(Y(e,Uint8Array)&&(e=l.from(e,e.offset,e.byteLength)),!l.isBuffer(e))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof e);if(void 0===t&&(t=0),void 0===n&&(n=e?e.length:0),void 0===r&&(r=0),void 0===i&&(i=this.length),t<0||n>e.length||r<0||i>this.length)throw new RangeError("out of range index");if(r>=i&&t>=n)return 0;if(r>=i)return-1;if(t>=n)return 1;if(this===e)return 0;let s=(i>>>=0)-(r>>>=0),o=(n>>>=0)-(t>>>=0);const a=Math.min(s,o),c=this.slice(r,i),d=e.slice(t,n);for(let e=0;e<a;++e)if(c[e]!==d[e]){s=c[e],o=d[e];break}return s<o?-1:o<s?1:0},l.prototype.includes=function(e,t,n){return-1!==this.indexOf(e,t,n)},l.prototype.indexOf=function(e,t,n){return v(this,e,t,n,!0)},l.prototype.lastIndexOf=function(e,t,n){return v(this,e,t,n,!1)},l.prototype.write=function(e,t,n,r){if(void 0===t)r="utf8",n=this.length,t=0;else if(void 0===n&&"string"==typeof t)r=t,n=this.length,t=0;else{if(!isFinite(t))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");t>>>=0,isFinite(n)?(n>>>=0,void 0===r&&(r="utf8")):(r=n,n=void 0)}const i=this.length-t;if((void 0===n||n>i)&&(n=i),e.length>0&&(n<0||t<0)||t>this.length)throw new RangeError("Attempt to write outside buffer bounds");r||(r="utf8");let s=!1;for(;;)switch(r){case"hex":return w(this,e,t,n);case"utf8":case"utf-8":return S(this,e,t,n);case"ascii":case"latin1":case"binary":return _(this,e,t,n);case"base64":return k(this,e,t,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return x(this,e,t,n);default:if(s)throw new TypeError("Unknown encoding: "+r);r=(""+r).toLowerCase(),s=!0}},l.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};const C=4096;function A(e,t,n){let r="";n=Math.min(e.length,n);for(let i=t;i<n;++i)r+=String.fromCharCode(127&e[i]);return r}function I(e,t,n){let r="";n=Math.min(e.length,n);for(let i=t;i<n;++i)r+=String.fromCharCode(e[i]);return r}function R(e,t,n){const r=e.length;(!t||t<0)&&(t=0),(!n||n<0||n>r)&&(n=r);let i="";for(let r=t;r<n;++r)i+=Z[e[r]];return i}function O(e,t,n){const r=e.slice(t,n);let i="";for(let e=0;e<r.length-1;e+=2)i+=String.fromCharCode(r[e]+256*r[e+1]);return i}function P(e,t,n){if(e%1!=0||e<0)throw new RangeError("offset is not uint");if(e+t>n)throw new RangeError("Trying to access beyond buffer length")}function M(e,t,n,r,i,s){if(!l.isBuffer(e))throw new TypeError('"buffer" argument must be a Buffer instance');if(t>i||t<s)throw new RangeError('"value" argument is out of bounds');if(n+r>e.length)throw new RangeError("Index out of range")}function D(e,t,n,r,i){K(t,r,i,e,n,7);let s=Number(t&BigInt(4294967295));e[n++]=s,s>>=8,e[n++]=s,s>>=8,e[n++]=s,s>>=8,e[n++]=s;let o=Number(t>>BigInt(32)&BigInt(4294967295));return e[n++]=o,o>>=8,e[n++]=o,o>>=8,e[n++]=o,o>>=8,e[n++]=o,n}function L(e,t,n,r,i){K(t,r,i,e,n,7);let s=Number(t&BigInt(4294967295));e[n+7]=s,s>>=8,e[n+6]=s,s>>=8,e[n+5]=s,s>>=8,e[n+4]=s;let o=Number(t>>BigInt(32)&BigInt(4294967295));return e[n+3]=o,o>>=8,e[n+2]=o,o>>=8,e[n+1]=o,o>>=8,e[n]=o,n+8}function F(e,t,n,r,i,s){if(n+r>e.length)throw new RangeError("Index out of range");if(n<0)throw new RangeError("Index out of range")}function N(e,t,n,r,s){return t=+t,n>>>=0,s||F(e,0,n,4),i.write(e,t,n,r,23,4),n+4}function j(e,t,n,r,s){return t=+t,n>>>=0,s||F(e,0,n,8),i.write(e,t,n,r,52,8),n+8}l.prototype.slice=function(e,t){const n=this.length;(e=~~e)<0?(e+=n)<0&&(e=0):e>n&&(e=n),(t=void 0===t?n:~~t)<0?(t+=n)<0&&(t=0):t>n&&(t=n),t<e&&(t=e);const r=this.subarray(e,t);return Object.setPrototypeOf(r,l.prototype),r},l.prototype.readUintLE=l.prototype.readUIntLE=function(e,t,n){e>>>=0,t>>>=0,n||P(e,t,this.length);let r=this[e],i=1,s=0;for(;++s<t&&(i*=256);)r+=this[e+s]*i;return r},l.prototype.readUintBE=l.prototype.readUIntBE=function(e,t,n){e>>>=0,t>>>=0,n||P(e,t,this.length);let r=this[e+--t],i=1;for(;t>0&&(i*=256);)r+=this[e+--t]*i;return r},l.prototype.readUint8=l.prototype.readUInt8=function(e,t){return e>>>=0,t||P(e,1,this.length),this[e]},l.prototype.readUint16LE=l.prototype.readUInt16LE=function(e,t){return e>>>=0,t||P(e,2,this.length),this[e]|this[e+1]<<8},l.prototype.readUint16BE=l.prototype.readUInt16BE=function(e,t){return e>>>=0,t||P(e,2,this.length),this[e]<<8|this[e+1]},l.prototype.readUint32LE=l.prototype.readUInt32LE=function(e,t){return e>>>=0,t||P(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+16777216*this[e+3]},l.prototype.readUint32BE=l.prototype.readUInt32BE=function(e,t){return e>>>=0,t||P(e,4,this.length),16777216*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},l.prototype.readBigUInt64LE=J((function(e){z(e>>>=0,"offset");const t=this[e],n=this[e+7];void 0!==t&&void 0!==n||$(e,this.length-8);const r=t+256*this[++e]+65536*this[++e]+this[++e]*2**24,i=this[++e]+256*this[++e]+65536*this[++e]+n*2**24;return BigInt(r)+(BigInt(i)<<BigInt(32))})),l.prototype.readBigUInt64BE=J((function(e){z(e>>>=0,"offset");const t=this[e],n=this[e+7];void 0!==t&&void 0!==n||$(e,this.length-8);const r=t*2**24+65536*this[++e]+256*this[++e]+this[++e],i=this[++e]*2**24+65536*this[++e]+256*this[++e]+n;return(BigInt(r)<<BigInt(32))+BigInt(i)})),l.prototype.readIntLE=function(e,t,n){e>>>=0,t>>>=0,n||P(e,t,this.length);let r=this[e],i=1,s=0;for(;++s<t&&(i*=256);)r+=this[e+s]*i;return i*=128,r>=i&&(r-=Math.pow(2,8*t)),r},l.prototype.readIntBE=function(e,t,n){e>>>=0,t>>>=0,n||P(e,t,this.length);let r=t,i=1,s=this[e+--r];for(;r>0&&(i*=256);)s+=this[e+--r]*i;return i*=128,s>=i&&(s-=Math.pow(2,8*t)),s},l.prototype.readInt8=function(e,t){return e>>>=0,t||P(e,1,this.length),128&this[e]?-1*(255-this[e]+1):this[e]},l.prototype.readInt16LE=function(e,t){e>>>=0,t||P(e,2,this.length);const n=this[e]|this[e+1]<<8;return 32768&n?4294901760|n:n},l.prototype.readInt16BE=function(e,t){e>>>=0,t||P(e,2,this.length);const n=this[e+1]|this[e]<<8;return 32768&n?4294901760|n:n},l.prototype.readInt32LE=function(e,t){return e>>>=0,t||P(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},l.prototype.readInt32BE=function(e,t){return e>>>=0,t||P(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},l.prototype.readBigInt64LE=J((function(e){z(e>>>=0,"offset");const t=this[e],n=this[e+7];void 0!==t&&void 0!==n||$(e,this.length-8);const r=this[e+4]+256*this[e+5]+65536*this[e+6]+(n<<24);return(BigInt(r)<<BigInt(32))+BigInt(t+256*this[++e]+65536*this[++e]+this[++e]*2**24)})),l.prototype.readBigInt64BE=J((function(e){z(e>>>=0,"offset");const t=this[e],n=this[e+7];void 0!==t&&void 0!==n||$(e,this.length-8);const r=(t<<24)+65536*this[++e]+256*this[++e]+this[++e];return(BigInt(r)<<BigInt(32))+BigInt(this[++e]*2**24+65536*this[++e]+256*this[++e]+n)})),l.prototype.readFloatLE=function(e,t){return e>>>=0,t||P(e,4,this.length),i.read(this,e,!0,23,4)},l.prototype.readFloatBE=function(e,t){return e>>>=0,t||P(e,4,this.length),i.read(this,e,!1,23,4)},l.prototype.readDoubleLE=function(e,t){return e>>>=0,t||P(e,8,this.length),i.read(this,e,!0,52,8)},l.prototype.readDoubleBE=function(e,t){return e>>>=0,t||P(e,8,this.length),i.read(this,e,!1,52,8)},l.prototype.writeUintLE=l.prototype.writeUIntLE=function(e,t,n,r){e=+e,t>>>=0,n>>>=0,r||M(this,e,t,n,Math.pow(2,8*n)-1,0);let i=1,s=0;for(this[t]=255&e;++s<n&&(i*=256);)this[t+s]=e/i&255;return t+n},l.prototype.writeUintBE=l.prototype.writeUIntBE=function(e,t,n,r){e=+e,t>>>=0,n>>>=0,r||M(this,e,t,n,Math.pow(2,8*n)-1,0);let i=n-1,s=1;for(this[t+i]=255&e;--i>=0&&(s*=256);)this[t+i]=e/s&255;return t+n},l.prototype.writeUint8=l.prototype.writeUInt8=function(e,t,n){return e=+e,t>>>=0,n||M(this,e,t,1,255,0),this[t]=255&e,t+1},l.prototype.writeUint16LE=l.prototype.writeUInt16LE=function(e,t,n){return e=+e,t>>>=0,n||M(this,e,t,2,65535,0),this[t]=255&e,this[t+1]=e>>>8,t+2},l.prototype.writeUint16BE=l.prototype.writeUInt16BE=function(e,t,n){return e=+e,t>>>=0,n||M(this,e,t,2,65535,0),this[t]=e>>>8,this[t+1]=255&e,t+2},l.prototype.writeUint32LE=l.prototype.writeUInt32LE=function(e,t,n){return e=+e,t>>>=0,n||M(this,e,t,4,4294967295,0),this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=255&e,t+4},l.prototype.writeUint32BE=l.prototype.writeUInt32BE=function(e,t,n){return e=+e,t>>>=0,n||M(this,e,t,4,4294967295,0),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e,t+4},l.prototype.writeBigUInt64LE=J((function(e,t=0){return D(this,e,t,BigInt(0),BigInt("0xffffffffffffffff"))})),l.prototype.writeBigUInt64BE=J((function(e,t=0){return L(this,e,t,BigInt(0),BigInt("0xffffffffffffffff"))})),l.prototype.writeIntLE=function(e,t,n,r){if(e=+e,t>>>=0,!r){const r=Math.pow(2,8*n-1);M(this,e,t,n,r-1,-r)}let i=0,s=1,o=0;for(this[t]=255&e;++i<n&&(s*=256);)e<0&&0===o&&0!==this[t+i-1]&&(o=1),this[t+i]=(e/s>>0)-o&255;return t+n},l.prototype.writeIntBE=function(e,t,n,r){if(e=+e,t>>>=0,!r){const r=Math.pow(2,8*n-1);M(this,e,t,n,r-1,-r)}let i=n-1,s=1,o=0;for(this[t+i]=255&e;--i>=0&&(s*=256);)e<0&&0===o&&0!==this[t+i+1]&&(o=1),this[t+i]=(e/s>>0)-o&255;return t+n},l.prototype.writeInt8=function(e,t,n){return e=+e,t>>>=0,n||M(this,e,t,1,127,-128),e<0&&(e=255+e+1),this[t]=255&e,t+1},l.prototype.writeInt16LE=function(e,t,n){return e=+e,t>>>=0,n||M(this,e,t,2,32767,-32768),this[t]=255&e,this[t+1]=e>>>8,t+2},l.prototype.writeInt16BE=function(e,t,n){return e=+e,t>>>=0,n||M(this,e,t,2,32767,-32768),this[t]=e>>>8,this[t+1]=255&e,t+2},l.prototype.writeInt32LE=function(e,t,n){return e=+e,t>>>=0,n||M(this,e,t,4,2147483647,-2147483648),this[t]=255&e,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24,t+4},l.prototype.writeInt32BE=function(e,t,n){return e=+e,t>>>=0,n||M(this,e,t,4,2147483647,-2147483648),e<0&&(e=4294967295+e+1),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e,t+4},l.prototype.writeBigInt64LE=J((function(e,t=0){return D(this,e,t,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))})),l.prototype.writeBigInt64BE=J((function(e,t=0){return L(this,e,t,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))})),l.prototype.writeFloatLE=function(e,t,n){return N(this,e,t,!0,n)},l.prototype.writeFloatBE=function(e,t,n){return N(this,e,t,!1,n)},l.prototype.writeDoubleLE=function(e,t,n){return j(this,e,t,!0,n)},l.prototype.writeDoubleBE=function(e,t,n){return j(this,e,t,!1,n)},l.prototype.copy=function(e,t,n,r){if(!l.isBuffer(e))throw new TypeError("argument should be a Buffer");if(n||(n=0),r||0===r||(r=this.length),t>=e.length&&(t=e.length),t||(t=0),r>0&&r<n&&(r=n),r===n)return 0;if(0===e.length||0===this.length)return 0;if(t<0)throw new RangeError("targetStart out of bounds");if(n<0||n>=this.length)throw new RangeError("Index out of range");if(r<0)throw new RangeError("sourceEnd out of bounds");r>this.length&&(r=this.length),e.length-t<r-n&&(r=e.length-t+n);const i=r-n;return this===e&&"function"==typeof Uint8Array.prototype.copyWithin?this.copyWithin(t,n,r):Uint8Array.prototype.set.call(e,this.subarray(n,r),t),i},l.prototype.fill=function(e,t,n,r){if("string"==typeof e){if("string"==typeof t?(r=t,t=0,n=this.length):"string"==typeof n&&(r=n,n=this.length),void 0!==r&&"string"!=typeof r)throw new TypeError("encoding must be a string");if("string"==typeof r&&!l.isEncoding(r))throw new TypeError("Unknown encoding: "+r);if(1===e.length){const t=e.charCodeAt(0);("utf8"===r&&t<128||"latin1"===r)&&(e=t)}}else"number"==typeof e?e&=255:"boolean"==typeof e&&(e=Number(e));if(t<0||this.length<t||this.length<n)throw new RangeError("Out of range index");if(n<=t)return this;let i;if(t>>>=0,n=void 0===n?this.length:n>>>0,e||(e=0),"number"==typeof e)for(i=t;i<n;++i)this[i]=e;else{const s=l.isBuffer(e)?e:l.from(e,r),o=s.length;if(0===o)throw new TypeError('The value "'+e+'" is invalid for argument "value"');for(i=0;i<n-t;++i)this[i+t]=s[i%o]}return this};const U={};function B(e,t,n){U[e]=class extends n{constructor(){super(),Object.defineProperty(this,"message",{value:t.apply(this,arguments),writable:!0,configurable:!0}),this.name=`${this.name} [${e}]`,this.stack,delete this.name}get code(){return e}set code(e){Object.defineProperty(this,"code",{configurable:!0,enumerable:!0,value:e,writable:!0})}toString(){return`${this.name} [${e}]: ${this.message}`}}}function q(e){let t="",n=e.length;const r="-"===e[0]?1:0;for(;n>=r+4;n-=3)t=`_${e.slice(n-3,n)}${t}`;return`${e.slice(0,n)}${t}`}function K(e,t,n,r,i,s){if(e>n||e<t){const r="bigint"==typeof t?"n":"";let i;throw i=s>3?0===t||t===BigInt(0)?`>= 0${r} and < 2${r} ** ${8*(s+1)}${r}`:`>= -(2${r} ** ${8*(s+1)-1}${r}) and < 2 ** ${8*(s+1)-1}${r}`:`>= ${t}${r} and <= ${n}${r}`,new U.ERR_OUT_OF_RANGE("value",i,e)}!function(e,t,n){z(t,"offset"),void 0!==e[t]&&void 0!==e[t+n]||$(t,e.length-(n+1))}(r,i,s)}function z(e,t){if("number"!=typeof e)throw new U.ERR_INVALID_ARG_TYPE(t,"number",e)}function $(e,t,n){if(Math.floor(e)!==e)throw z(e,n),new U.ERR_OUT_OF_RANGE(n||"offset","an integer",e);if(t<0)throw new U.ERR_BUFFER_OUT_OF_BOUNDS;throw new U.ERR_OUT_OF_RANGE(n||"offset",`>= ${n?1:0} and <= ${t}`,e)}B("ERR_BUFFER_OUT_OF_BOUNDS",(function(e){return e?`${e} is outside of buffer bounds`:"Attempt to access memory outside buffer bounds"}),RangeError),B("ERR_INVALID_ARG_TYPE",(function(e,t){return`The "${e}" argument must be of type number. Received type ${typeof t}`}),TypeError),B("ERR_OUT_OF_RANGE",(function(e,t,n){let r=`The value of "${e}" is out of range.`,i=n;return Number.isInteger(n)&&Math.abs(n)>2**32?i=q(String(n)):"bigint"==typeof n&&(i=String(n),(n>BigInt(2)**BigInt(32)||n<-(BigInt(2)**BigInt(32)))&&(i=q(i)),i+="n"),r+=` It must be ${t}. Received ${i}`,r}),RangeError);const V=/[^+/0-9A-Za-z-_]/g;function H(e,t){let n;t=t||1/0;const r=e.length;let i=null;const s=[];for(let o=0;o<r;++o){if(n=e.charCodeAt(o),n>55295&&n<57344){if(!i){if(n>56319){(t-=3)>-1&&s.push(239,191,189);continue}if(o+1===r){(t-=3)>-1&&s.push(239,191,189);continue}i=n;continue}if(n<56320){(t-=3)>-1&&s.push(239,191,189),i=n;continue}n=65536+(i-55296<<10|n-56320)}else i&&(t-=3)>-1&&s.push(239,191,189);if(i=null,n<128){if((t-=1)<0)break;s.push(n)}else if(n<2048){if((t-=2)<0)break;s.push(n>>6|192,63&n|128)}else if(n<65536){if((t-=3)<0)break;s.push(n>>12|224,n>>6&63|128,63&n|128)}else{if(!(n<1114112))throw new Error("Invalid code point");if((t-=4)<0)break;s.push(n>>18|240,n>>12&63|128,n>>6&63|128,63&n|128)}}return s}function W(e){return r.toByteArray(function(e){if((e=(e=e.split("=")[0]).trim().replace(V,"")).length<2)return"";for(;e.length%4!=0;)e+="=";return e}(e))}function G(e,t,n,r){let i;for(i=0;i<r&&!(i+n>=t.length||i>=e.length);++i)t[i+n]=e[i];return i}function Y(e,t){return e instanceof t||null!=e&&null!=e.constructor&&null!=e.constructor.name&&e.constructor.name===t.name}function X(e){return e!=e}const Z=function(){const e="0123456789abcdef",t=new Array(256);for(let n=0;n<16;++n){const r=16*n;for(let i=0;i<16;++i)t[r+i]=e[n]+e[i]}return t}();function J(e){return"undefined"==typeof BigInt?Q:e}function Q(){throw new Error("BigInt not supported")}},1924:(e,t,n)=>{"use strict";var r=n(210),i=n(5559),s=i(r("String.prototype.indexOf"));e.exports=function(e,t){var n=r(e,!!t);return"function"==typeof n&&s(e,".prototype.")>-1?i(n):n}},5559:(e,t,n)=>{"use strict";var r=n(8612),i=n(210),s=i("%Function.prototype.apply%"),o=i("%Function.prototype.call%"),a=i("%Reflect.apply%",!0)||r.call(o,s),l=i("%Object.getOwnPropertyDescriptor%",!0),c=i("%Object.defineProperty%",!0),d=i("%Math.max%");if(c)try{c({},"a",{value:1})}catch(e){c=null}e.exports=function(e){var t=a(r,o,arguments);if(l&&c){var n=l(t,"length");n.configurable&&c(t,"length",{value:1+d(0,e.length-(arguments.length-1))})}return t};var u=function(){return a(r,s,arguments)};c?c(e.exports,"apply",{value:u}):e.exports.apply=u},7811:(e,t)=>{"use strict";var n=/; *([!#$%&'*+.^_`|~0-9A-Za-z-]+) *= *("(?:[\u000b\u0020\u0021\u0023-\u005b\u005d-\u007e\u0080-\u00ff]|\\[\u000b\u0020-\u00ff])*"|[!#$%&'*+.^_`|~0-9A-Za-z-]+) */g,r=/^[\u000b\u0020-\u007e\u0080-\u00ff]+$/,i=/^[!#$%&'*+.^_`|~0-9A-Za-z-]+$/,s=/\\([\u000b\u0020-\u00ff])/g,o=/([\\"])/g,a=/^[!#$%&'*+.^_`|~0-9A-Za-z-]+\/[!#$%&'*+.^_`|~0-9A-Za-z-]+$/;function l(e){var t=String(e);if(i.test(t))return t;if(t.length>0&&!r.test(t))throw new TypeError("invalid parameter value");return'"'+t.replace(o,"\\$1")+'"'}function c(e){this.parameters=Object.create(null),this.type=e}t.format=function(e){if(!e||"object"!=typeof e)throw new TypeError("argument obj is required");var t=e.parameters,n=e.type;if(!n||!a.test(n))throw new TypeError("invalid type");var r=n;if(t&&"object"==typeof t)for(var s,o=Object.keys(t).sort(),c=0;c<o.length;c++){if(s=o[c],!i.test(s))throw new TypeError("invalid parameter name");r+="; "+s+"="+l(t[s])}return r},t.parse=function(e){if(!e)throw new TypeError("argument string is required");var t="object"==typeof e?function(e){var t;if("function"==typeof e.getHeader?t=e.getHeader("content-type"):"object"==typeof e.headers&&(t=e.headers&&e.headers["content-type"]),"string"!=typeof t)throw new TypeError("content-type header is missing from object");return t}(e):e;if("string"!=typeof t)throw new TypeError("argument string is required to be a string");var r=t.indexOf(";"),i=-1!==r?t.substr(0,r).trim():t.trim();if(!a.test(i))throw new TypeError("invalid media type");var o=new c(i.toLowerCase());if(-1!==r){var l,d,u;for(n.lastIndex=r;d=n.exec(t);){if(d.index!==r)throw new TypeError("invalid parameter format");r+=d[0].length,l=d[1].toLowerCase(),'"'===(u=d[2])[0]&&(u=u.substr(1,u.length-2).replace(s,"$1")),o.parameters[l]=u}if(r!==t.length)throw new TypeError("invalid parameter format")}return o}},4606:(e,t)=>{var n;n=function(e){e.version="0.3.0";var t=function(){for(var e=0,t=new Array(256),n=0;256!=n;++n)e=1&(e=1&(e=1&(e=1&(e=1&(e=1&(e=1&(e=1&(e=n)?-306674912^e>>>1:e>>>1)?-306674912^e>>>1:e>>>1)?-306674912^e>>>1:e>>>1)?-306674912^e>>>1:e>>>1)?-306674912^e>>>1:e>>>1)?-306674912^e>>>1:e>>>1)?-306674912^e>>>1:e>>>1)?-306674912^e>>>1:e>>>1,t[n]=e;return"undefined"!=typeof Int32Array?new Int32Array(t):t}(),n="undefined"!=typeof Buffer;function r(e){for(var n=-1,r=0,i=e.length-7;r<i;)n=(n=(n=(n=(n=(n=(n=(n=n>>>8^t[255&(n^e[r++])])>>>8^t[255&(n^e[r++])])>>>8^t[255&(n^e[r++])])>>>8^t[255&(n^e[r++])])>>>8^t[255&(n^e[r++])])>>>8^t[255&(n^e[r++])])>>>8^t[255&(n^e[r++])])>>>8^t[255&(n^e[r++])];for(;r<i+7;)n=n>>>8^t[255&(n^e[r++])];return-1^n}e.table=t,e.bstr=function(e){if(e.length>32768&&n)return r(new Buffer(e));for(var i=-1,s=e.length-1,o=0;o<s;)i=t[255&(i^e.charCodeAt(o++))]^i>>>8,i=t[255&(i^e.charCodeAt(o++))]^i>>>8;return o===s&&(i=i>>>8^t[255&(i^e.charCodeAt(o))]),-1^i},e.buf=function(e){if(e.length>1e4)return r(e);for(var n=-1,i=0,s=e.length-3;i<s;)n=(n=(n=(n=n>>>8^t[255&(n^e[i++])])>>>8^t[255&(n^e[i++])])>>>8^t[255&(n^e[i++])])>>>8^t[255&(n^e[i++])];for(;i<s+3;)n=n>>>8^t[255&(n^e[i++])];return-1^n},e.str=function(e){for(var n,r,i=-1,s=0,o=e.length;s<o;)(n=e.charCodeAt(s++))<128?i=i>>>8^t[255&(i^n)]:n<2048?i=(i=i>>>8^t[255&(i^(192|n>>6&31))])>>>8^t[255&(i^(128|63&n))]:n>=55296&&n<57344?(n=64+(1023&n),r=1023&e.charCodeAt(s++),i=(i=(i=(i=i>>>8^t[255&(i^(240|n>>8&7))])>>>8^t[255&(i^(128|n>>2&63))])>>>8^t[255&(i^(128|r>>6&15|3&n))])>>>8^t[255&(i^(128|63&r))]):i=(i=(i=i>>>8^t[255&(i^(224|n>>12&15))])>>>8^t[255&(i^(128|n>>6&63))])>>>8^t[255&(i^(128|63&n))];return-1^i}},"undefined"==typeof DO_NOT_EXPORT_CRC?n(t):n({})},5047:(e,t,n)=>{"use strict";n.d(t,{Z:()=>h});var r=n(8081),i=n.n(r),s=n(3645),o=n.n(s),a=n(1667),l=n.n(a),c=new URL(n(8211),n.b),d=o()(i()),u=l()(c);d.push([e.id,"#annotation-layer { \n    position: absolute;\n    line-height:1;\n    overflow:visible;\n    left: 0;\n    top: 0;\n}\n\n#annotation-layer span {\n    position: absolute;\n    white-space: pre;\n    cursor: text;\n    transform-origin: 0% 0%;\n    pointer-events: auto !important;\n}\n\n#annotation-layer span.annotation-pindrop { \n    cursor: pointer;\n    padding:2px;\n    border-radius:30px;\n    border: 2px solid transparent;\n}\n\n#annotation-layer span.annotation-pindrop svg {\n  height:14px;\n  width:16px;\n}\n\n#annotation-layer span.annotation-pindrop[data-focused] { \n    border: 2px solid var(--user_light);\n}\n\n#annotation-layer span.annotation-pindrop[data-annotation-typing] {\n    animation: pulse-color 1s infinite;\n}\n\n#annotation-layer span.annotation-pindrop-preview { \n    animation: pulse-opacity 1s infinite;\n}\n\n#annotation-layer .inline-annotations {\n    opacity:0.2;\n    transition: opacity 0.25s ease;\n}\n\n#annotation-layer[data-annotation-focused] .inline-annotations {\n  opacity:0.1\n}\n\n#annotation-layer .inline-annotations span {\n    background-color:var(--user_solid);\n}\n\n#annotation-layer .annotation-bartab {\n    opacity:0.5;\n    background-color:var(--user_solid);\n}\n\n#annotation-layer .annotation-bartab:hover {\n    opacity:1;\n}\n\n#annotation-layer > div[data-focused] > .inline-annotations,\n#annotation-layer .annotation-bartab:hover + .inline-annotations {\n    opacity:0.3;\n}\n\n#annotation-layer > div[data-annotation-typing] > .inline-annotations {\n    animation: pulse-half-opacity 2s infinite; \n    animation-timing-function:ease;\n}\n\n[data-annotations-hidden] .annotation-bartab,\n[data-annotations-hidden] .inline-annotations {\n    visibility: hidden;\n}\n\n#annotation-layer > div[data-focused] > .annotation-bartab,\n#annotation-layer > div[data-focused] > .inline-annotations {\n    visibility:visible;\n}\n\n[data-pindrop-mode] #annotation-layer * {\n    cursor:unset !important;\n}\n\n[data-pindrop-mode] #annotation-layer { \n    cursor: url("+u+") 16 16, pointer !important;\n}\n",""]);const h=d},1444:(e,t,n)=>{"use strict";n.d(t,{Z:()=>a});var r=n(8081),i=n.n(r),s=n(3645),o=n.n(s)()(i());o.push([e.id,'#annotation-panel {\n    position:relative;\n    flex-direction: column;\n}\n\n#annotation-panel .empty-marker { padding:10px }\n\n#annotation-entries-wrapper {\n    overflow-y:scroll;\n    padding-bottom:40px;\n}\n\nhtml[data-scrollbars="hidden"] #annotation-entries-wrapper {\n    -ms-overflow-style: none;  /* IE and Edge */\n    scrollbar-width: none;  /* Firefox */\n}\n\nhtml[data-scrollbars="hidden"] #annotation-entries-wrapper::-webkit-scrollbar { display: none; }\n\n#annotation-controls {\n    user-select:none;\n    display:flex;\n    align-items:center;\n    margin-top: .5em;\n    padding-bottom: .5em;\n    padding-left: .5em;\n    border-bottom: 1px solid #ababab;\n}\n\n#annotation-controls button {\n    margin-left: 1em;\n}\n\n#annotation-controls button:first-child {\n    margin-left: 0em;\n}\n\n#annotation-panel .annotation-listing-entry {\n    cursor: pointer;\n    position:relative;\n    width:calc(100% - 20px);\n    padding:20px 10px 20px 10px;\n    display: flex;\n    align-items:center;\n    justify-content: right;\n    flex-wrap:wrap;\n    transition: background-color 0.5s ease;\n}\n\n/* Medium devices (landscape tablets, 768px and up) */\n@media only screen and (min-width: 768px) {\n  #annotation-panel .annotation-listing-entry {\n      width:calc(100% - 50px);\n      padding:20px 25px 20px 25px;\n\n  } \n}\n\n#annotation-panel .annotation-listing-divider {\n    border-bottom: 1px solid #dddddd;\n    margin: 20px 60px 20px 60px;\n    text-align:center;\n}\n\n#annotation-panel .annotation-listing-divider > span {\n    color: #ababab;\n    font-size:10pt;\n    background:white;\n    position:relative;\n    padding:10px;\n    top:.5em;\n}\n\n#annotation-panel .annotation-listing-entry[data-annotation-entry-typing] {\n    animation: pulse-color 2s infinite; \n    animation-timing-function:ease;\n}\n\n#annotation-panel .annotation-listing-entry:hover {\n    background: var(--user_ultralight);\n    transition: background-color 0.5s ease;\n}\n\n#annotation-panel .annotation-listing-entry[data-annotation-entry-focused] {\n    background: var(--user_ultralight);\n}\n\n.annotation-listing-pin-icon {\n  width:100%;\n}\n\n.annotation-listing-topic {\n  width: 100%;\n  color:#565656;\n}\n\n.annotation-listing-topic-icon {\n  padding-right: .25em;\n}\n\n.annotation-listing-pin-icon svg,\n.annotation-listing-topic-icon svg {\n  height:1em;\n}\n\n.annotation-listing-pin-icon {\n  display:flex;\n  color:#565656;\n  align-items:center;\n}\n\n.annotation-listing-pending {\n  width:100%;\n  padding-top:10px;\n  padding-left:5px;\n  font-size:10pt;\n  color:#565656;\n}\n\n.annotation-listing-comment, .annotation-listing-comment-unread {\n    width:calc(100%);\n    padding:0px 10px 0px 10px;\n    border: 2px solid var(--user_light);\n    margin-bottom:10px;\n    margin-top:10px;\n    overflow-wrap: anywhere;\n    word-break: break-word;\n    hyphens: auto;\n    background:white;\n}\n\n.annotation-listing-comment-unread { border: 5px solid var(--user_light); }\n\n.annotation-listing-info {\n  display: flex;\n  justify-content: space-between;\n  align-content:center;\n  width:100%;\n}\n\n.annotation-listing-features > svg {\n  height:14px;\n  width:14px;\n}\n\n.annotation-listing-features {\n  height:14px;\n  padding-left:5px;\n  color:#565656;\n}\n\n.annotation-listing-creator::before {\n  content: "";\n  position: absolute;\n  bottom:21px;\n  left:-25px;\n  border-right: 10px solid var(--user_light);\n  border-top: 10px solid var(--user_light);\n  border-left: 10px solid transparent;\n  border-bottom: 10px solid transparent;\n}\n\n.annotation-listing-creator::after {\n  content: "";\n  position: absolute;\n  bottom:26px;\n  left:-25px;\n  border-right: 9px solid white;\n  border-top: 9px solid white;\n  border-left: 9px solid transparent;\n  border-bottom: 9px solid transparent;\n}\n\n.annotation-listing-comment-unread + .annotation-listing-info .annotation-listing-creator::before {\n  bottom:13px;\n  left:-35px;\n  border-right: 15px solid var(--user_light);\n  border-top: 15px solid var(--user_light);\n  border-left: 15px solid transparent;\n  border-bottom: 15px solid transparent;\n}\n\n.annotation-listing-comment-unread + .annotation-listing-info .annotation-listing-creator::after {\n  bottom:27px;\n  left:-28px;\n}\n\n.annotation-listing-comment pre, .annotation-listing-comment-unread pre{\n  overflow-y: scroll;\n  max-width: calc(var(--widget-2-width) - 50px);\n  text-overflow:ellipsis;\n}\n\nhtml[data-scrollbars="hidden"] .annotation-listing-comment-unread pre,\nhtml[data-scrollbars="hidden"] .annotation-listing-comment pre {\n  -ms-overflow-style: none;  /* IE and Edge */\n  scrollbar-width:none;\n}\n\nhtml[data-scrollbars="hidden"] .annotation-listing-comment pre::-webkit-scrollbar,\nhtml[data-scrollbars="hidden"] .annotation-listing-comment-unread pre::-webkit-scrollbar { \n  display: none; \n}\n\n.annotation-listing-creator {\n    position:relative;\n    font-size:10pt;\n    padding-right:10px;\n    user-select: none;\n}\n\n.annotation-listing-fallback {\n  color:#565656;\n  text-align:center;\n}\n\n#annotation-panel-button-wrapper {\n  position:absolute;\n  bottom:0px;\n  width:100%;\n}\n\n#annotation-panel-button-wrapper .search-bar {\n  height:36px;\n  border: 2px solid black;\n  background-color:white;\n}\n\n#annotation-panel-button-wrapper[data-mode="search"] .search-bar > input {\n  opacity:1;\n  width:100%;\n  height:100%;\n  margin:0px;\n  padding-top:0px;\n  padding-bottom:0px;\n  outline:none;\n}\n\n#annotation-panel-button-wrapper[data-mode="navigation"] .search-bar > input {\n  background-color:white;\n}\n\n#annotation-panel-button-wrapper .search-bar > .clear-icon,\n#annotation-panel-button-wrapper .search-bar > .search-icon {\n  right:6px;\n}\n\n#annotation-panel-button-wrapper[data-mode="search"] button {\n  display:none;\n}\n\n#annotation-panel-button-wrapper > button {\n  height:40px;\n  font-size:14pt;\n  border-left:none;\n  transition: background-color 0.5s ease;\n}\n\n#annotation-panel-button-wrapper > button:hover {\n    background-color:#ededed;\n    transition: background-color 0.5s ease;\n}\n\n#annotation-panel-button-wrapper > button:first-child {\n    border:2px solid black;\n}\n',""]);const a=o},5789:(e,t,n)=>{"use strict";n.d(t,{Z:()=>a});var r=n(8081),i=n.n(r),s=n(3645),o=n.n(s)()(i());o.push([e.id,"#chat-wrapper {\n    flex-direction: column-reverse;\n    overflow-x: hidden;\n}\n\n#chat-panel {\n    display:inline-flex;\n    flex-direction: column-reverse;\n}\n\n#scroll-anchor, #scroll-done {\n    user-select:none;\n    padding:10px;\n    font-weight:bold;\n}\n\n#anchor-quote {\n  padding:10px;\n  margin-top:30px;\n}\n\n#anchor-quote svg {\n  padding-right: .25em;\n  height: 1em;\n  color:#565656;\n}\n\n#anchor-pin {\n  padding:5px;\n  display:flex;\n  color:#565656;\n  align-items:center;\n}\n\n#anchor-pin svg {\n  height: 1em;\n}\n\n#messageComposer > textarea,\n.replyComposer > textarea,\n.messageEditor > textarea {\n    display:block;\n    overflow: hidden;\n    min-height:100px;\n    width:100%;\n    margin:0px;\n    border:none;\n    padding:5px;\n    resize:none;\n    border-top: 1px solid #adadad;\n    -webkit-box-sizing: border-box; /* Safari/Chrome, other WebKit */\n    -moz-box-sizing: border-box; /* Firefox, other Gecko */\n    box-sizing: border-box; /* Opera/IE 8+ */\n}\n\n.typing-indicator {\n  user-select:none;\n}\n\n#messageComposer > textarea:focus,\n.replyComposer > textarea:focus,\n.messageEditor > textarea:focus {\n    outline: none;\n    border: 1px solid black;\n    border-bottom: none;\n}\n\n#submit-button-wrapper {\n  background: black\n}\n\n#submit-button-wrapper > button,\n.replyComposer > button,\n.messageEditor > button {\n    cursor:pointer;\n    outline:none;\n    border:2px solid black;\n    border-left:none;\n    color:black;\n    font-weight:bold;\n    transition: background-color 0.5s ease;\n    background-color:white;\n}\n\n#submit-button-wrapper > button:focus,\n.replyComposer > button:focus,\n.messageEditor > button:focus {\n    border:3px solid black;\n    border-left:1px solid black;\n}\n\n#submit-button-wrapper > button:first-child,\n.replyComposer > button:first-child,\n.messageEditor > button:first-child {\n    border:2px solid black;\n}\n\n#submit-button-wrapper > button:first-child:focus,\n.replyComposer > button:first-child:focus,\n.messageEditor > button:first-child:focus {\n    border:3px solid black;\n}\n\n.replyComposer > button,\n.messageEditor > button {\n    width:50%;\n    height:30px;\n}\n\n#submit-button-wrapper {\n    display:grid;\n    column-gap: 0px;\n    grid-template-columns: repeat(6,1fr) ;\n}\n\n#submit-button-wrapper > button {\n    height:40px;\n    font-size:14pt;\n    margin:0px;\n    display: inline-flex;\n    justify-content: center;\n    align-items: center;\n}\n\n#submitButton { grid-column:1/4; }\n\n#quote-button > svg  {\n  width:20px;\n}\n\n#cancelButton { grid-column:4/7; }\n\n#submit-button-wrapper > button:hover,\n.replyComposer > button:hover,\n.messageEditor > button:hover {\n    transition: background-color 0.5s ease;\n    background-color: var(--user_light);\n}\n\n#submit-button-wrapper > button:disabled {\n  background-color: white;\n  cursor: not-allowed;\n  color:grey;\n}\n\n#messageComposer > button:active {\n    background-color:var(--user_dark);\n}\n\n#mediaUploaderHidden {\n  display:none;\n}\n\n#audioRecordingWrapper, #videoRecordingWrapper {\n  position:relative;\n  cursor:pointer;\n}\n\n#audioRecordingWrapper {\n  display:flex;\n  background:black;\n  justify-content: center;\n  align-items: center;\n  height:150px;\n}\n\n#audioRecordingWrapper .audioVisualizer {\n    width:100%;\n    height:100%;\n}\n\n#audioCaption, #videoCaption {\n    pointer-events:none;\n    display:flex;\n    color: black;\n    font-weight: bold;\n    background: white;\n    border-radius: 30px;\n    padding: 5px;\n    justify-content: center;\n    align-items: center;\n    width:25px;  \n    height:25px;\n    position: absolute;\n}\n\n#videoCaption {\n    bottom: 30px;\n    left: 25px;\n}\n\n#audioCaption {\n    bottom: 20px;\n    left: 20px;\n}\n\n#audioCaption[data-recording-state=started], #videoCaption[data-recording-state=started] {\n    animation: pulse-color 2s infinite; \n    animation-timing-function:ease;\n}\n\n#audioCaption[data-recording-state=countdown] {\n    color:white;\n    justify-content:center;\n    animation: reverse-pulse-color 1.5s infinite;\n    animation-timing-function:ease;\n}\n",""]);const a=o},8046:(e,t,n)=>{"use strict";n.d(t,{Z:()=>a});var r=n(8081),i=n.n(r),s=n(3645),o=n.n(s)()(i());o.push([e.id,'#content-container {\n    position: relative;\n    overflow:auto;\n    height: calc(100% - var(--navHeight));\n    width: var(--contentWidth);\n    --leftToCenter: max(0px, calc(50% - (var(--pdfWidthPx) * var(--pdfZoomFactor)) / 2));\n    transition: var(--transitionSizing)\n}\n\nhtml[data-scrollbars="hidden"] #content-container {\n  -ms-overflow-style: none;  /* IE and Edge */\n  scrollbar-width:none;\n}\n\nhtml[data-scrollbars="hidden"] #content-container::-webkit-scrollbar { display: none; }\n\n#document-view {\n    position:relative;\n    display: inline-block;\n    left: var(--leftToCenter);\n    /* the below forces chrome to recalculate overflow on zoom It\'s not\n     * necessary for Firefox or Webkit ... Not seeing an effect any more, so\n     * this bug may be fixed on newer chromium */\n    height: calc(var(--pdfHeightPx) * var(--pdfZoomFactor))\n}\n\n#document-wrapper {\n    transform-origin : top left;\n    transform: scale(var(--pdfZoomFactor));\n}\n\n#document-wrapper canvas {\n    position:relative;\n    z-index:-1; /* prevents an apparent stacking bug in chromium */\n    width: var(--pdfWidthPx);\n    height: var(--pdfHeightPx);\n}\n\n#document-view-loading {\n    height:100%;\n    display:flex;\n    flex-direction:column;\n    justify-content: center;\n    align-items: center;\n    animation: pulse-opacity 2s infinite; \n    animation-timing-function:ease;\n}\n\n#annotation-layer , #text-layer {\n    transform-origin : top left;\n    transform : scale(var(--pdfFitRatio));\n    overflow:visible;\n    width: calc(var(--pdfWidthPx) / var(--pdfFitRatio)) ;\n    height: calc(var(--pdfHeightPx) / var(--pdfFitRatio));\n    user-select:none;\n}\n\n#pdf-mobile-buttons {\n    position:fixed;\n    z-index:7;\n    top:0px;\n    transition: var(--transitionSizing);\n    right:0px;\n    width: calc(var(--sidepanelWidth));\n    margin-top:5px;\n    font-size:24px;\n    pointer-events:none;\n}\n\n#pdf-mobile-buttons[data-hide-buttons] {\n    top:-50px;\n    transition: var(--transitionSizing);\n}\n\n#panel-toggle {\n    pointer-events:all;\n}\n\n#show-annotations {\n    pointer-events:all;\n}\n\n#pdf-mobile-buttons > button {\n    border:none;\n    outline:none;\n    font-size:24px;\n    text-align:center;\n    vertical-align:middle;\n    background:transparent;\n    cursor:pointer;\n}\n\n#pdf-mobile-buttons > button:last-child {\n    float:right\n}\n\n/* Extra small devices (phones, 600px and down) */\n@media only screen and (max-width: 600px) {\n    #content-container {\n        height: calc(100% - (0.8 * var(--navHeight)));\n        --contentWidth: calc(100%);\n    }\n\n} \n\n/* Small devices (portrait tablets and large phones, 600px and up) */\n@media only screen and (min-width: 600px) {\n} \n\n/* Medium devices (landscape tablets, 768px and up) */\n@media only screen and (min-width: 768px) {\n    #pdf-mobile-buttons {\n      display:none;\n    }\n\n    #content-container {\n        --contentWidth: calc(max(475px, 100% - var(--sidepanelWidth)));\n    }\n} \n\n/* Large devices (laptops/desktops, 992px and up) */\n@media only screen and (min-width: 992px) {\n} \n\n/* standard DPI */\n@media only screen and (min-width: 1280px) {\n    #panel-toggle {\n        visibility:hidden;\n    }\n}\n\n/* high DPI laptop */\n@media only screen and (min-width: 1400px) {\n}\n\n/* larger monitor */\n@media only screen and (min-width: 1800px) {\n}\n',""]);const a=o},5812:(e,t,n)=>{"use strict";n.d(t,{Z:()=>h});var r=n(8081),i=n.n(r),s=n(3645),o=n.n(s),a=n(1667),l=n.n(a),c=new URL(n(7129),n.b),d=o()(i());d.push([e.id,"@import url(https://rsms.me/inter/inter.css);"]);var u=l()(c);d.push([e.id,"html[data-scrollbars=\"hidden\"] {\n  -ms-overflow-style: none;  /* IE and Edge */\n  scrollbar-width:none;\n}\n\nhtml[data-scrollbars=\"hidden\"]::-webkit-scrollbar { display: none; }\n\ncode { font-family: 'IBM Plex Mono', monospace; }\n\npre { font-family: 'IBM Plex Mono', monospace; }\n\n* { font-family: 'Inter', sans-serif; }\n\n@supports (font-variation-settings: normal) {\n  * { font-family: 'Inter var', sans-serif; }\n}\n\n.katex * { font-family: unset }\n\nbody { \n  margin:0px; \n  height:100vh;\n}\n\nbody[data-modal-visible] { \n  overflow:hidden;\n}\n\n@keyframes reverse-pulse-color{\n  0% { color: white }\n  50% { color: black }\n  100% { color: white}\n}\n\n@keyframes pulse-opacity {\n  0% { opacity:1 }\n  50% { opacity:.2 }\n  100% { opacity:1 }\n}\n\n@keyframes pulse-opacity {\n  0% { opacity:1 }\n  50% { opacity:.2 }\n  100% { opacity:1 }\n}\n\n@keyframes pulse-half-opacity {\n  0% { opacity:.5 }\n  50% { opacity:.2 }\n  100% { opacity:.5 }\n}\n\n@keyframes pulse-color {\n  0% { background-color: white; }\n  50% { background-color: var(--user_light); }\n  100% { background-color: white; }\n}\n\n.select-view {\n  display:flex;\n  gap:10px;\n}\n\n.select-view > button {\n  cursor:pointer;\n  outline:none;\n  border:none;\n  padding:5px;\n  color:black;\n  font-weight:bold;\n  background-color:white;\n  user-select:none;\n  border-bottom:2px solid white;\n  transition:border .25s;\n}\n\n.select-view > button[data-current-button] {\n  border-bottom:2px solid black;\n}\n\n.styled-button {\n  cursor:pointer;\n  outline:none;\n  border:2px solid black;\n  padding:2px 4px 2px 4px;\n  color:black;\n  font-weight:bold;\n  background-color:white;\n  user-select:none;\n}\n\n.styled-button:disabled {\n  color:#555555;\n  border:2px solid #555555;\n  cursor:not-allowed;\n}\n\n.styled-button:focus {\n  border:3px solid black;\n  padding:1px 3px 1px 3px;\n}\n\n.styled-progress {\n  appearance: none;\n  -webkit-appearance: none;\n  -moz-appearance: none;\n  border: none;\n}\n\n.styled-input {\n  padding:7px;\n  border:none;\n  background:#ededed;\n}\n\n.select-sort-icon {\n  height:1.5em;\n  content: url("+u+");\n}\n\n.styled-button[data-current-button]{\n  color:white;\n  background:black;\n}\n\n.styled-progress::-webkit-progress-bar {\n  background: #ededed;\n  padding: 5px;\n}\n\n.styled-progress::-moz-progress-bar {\n  background: black;\n  padding: 5px;\n}\n\n.styled-progress::-webkit-progress-value {\n  background: black;\n}\n\n.small-icon {\n  height: 20px;\n  width: 20px;\n  border:none;\n  background:none;\n  padding:0px;\n}\n\nbutton.small-icon { cursor:pointer }\n\n.small-icon-badge {\n  background:black;\n  position:relative;\n  bottom:10px;\n  display:inline-flex;\n  align-items: center;\n  border:none;\n  justify-content: space-around;\n  color:white;\n  font-size:8pt;\n  font-weight:bold;\n  min-width:18px;\n  height:18px;\n  border-radius:10px;\n}\n\n.small-icon-badge > span {\n  margin-left:3px;\n  margin-right:3px;\n}\n\n.small-icon > svg {\n  height: 20px;\n  width: 20px;\n}\n",""]);const h=d},5440:(e,t,n)=>{"use strict";n.d(t,{Z:()=>a});var r=n(8081),i=n.n(r),s=n(3645),o=n.n(s)()(i());o.push([e.id,".invite-candidate,\n.disinvite-candidate,\n.removal-candidate {\n  display:flex;\n  position:relative;\n  background:none;\n  border:none;\n  font-size:unset;\n  cursor:pointer;\n  align-items:center;\n  max-width:100%;\n  height:40px;\n}\n\n.disinvite-candidate {\n  opacity:.5\n}\n\n.invite-candidate:hover,\n.disinvite-candidate:hover,\n.removal-candidate:hover {\n  left:5px;\n}\n\n.invite-candidate .small-icon,\n.disinvite-candidate .small-icon,\n.removal-candidate .small-icon{\n  padding-right: 10px;\n}\n\n#invite-search-divider {\n  margin-top:20px;\n  margin-bottom:20px;\n}\n\n#invite-select-view {\n  margin-top:20px;\n}\n\n#invite-search-directory {\n  margin-top:20px;\n}\n\n#invite-add-members, #invite-remove-members {\n  max-height:60vh;\n  padding-top:10px;\n  overflow-y: auto;\n  transition:height .25s ease;\n}\n",""]);const a=o},2462:(e,t,n)=>{"use strict";n.d(t,{Z:()=>a});var r=n(8081),i=n.n(r),s=n(3645),o=n.n(s)()(i());o.push([e.id,"#login, #registration {\n    display: inline-block;\n    border: 1px solid black;\n    padding: 2em;\n    padding-top: 1em;\n    position: absolute;\n    left: 50%;\n    transform: translateX(-50%) translateY(-50%);\n    top: 50%;\n}\n\n#login input:invalid, #registration input:invalid {\n    background:#ff9394;\n}\n\n#login form, #registration form {\n    display:grid;\n    grid-template-columns: 80px 1fr;\n    align-items: center;\n}\n\n#login label, #registration label {\n    grid-column: 1 / 2 ;\n    margin:5px;\n    margin-left:0px;\n}\n\n#login input, #registration input {\n    grid-column: 2 / 3 ;\n    margin:5px;\n    margin-left:0px;\n    padding:7px;\n    border:none;\n    background:#ededed;\n}\n\n#login div, #registration div {\n    padding-top:.5em;\n    grid-column: 1 / 3 ;\n}\n\n.login-options {\n  display: inline-block;\n}\n\n.login-sso-listing {\n  display: flex;\n  align-items: center;\n  cursor: pointer;\n}\n\n.login-sso-listing:hover .sso-name {\n  font-weight:bold;\n  transition: font-weight ease .2s;\n}\n\n.sso-name {\n  padding-left:20px;\n  color:black;\n  text-decoration:none;\n  transition: font-weight ease .2s;\n}\n\n#registration button, #login button { \n    /* margin-top:10px; */ \n    margin-right:10px;\n}\n\n#theRecaptcha {\n    padding:1em;\n}\n\n#registeringFeedback {\n  text-align: center;\n  animation: pulse-opacity 2s infinite;\n}\n\n#server-loading-message {\n    animation: pulse-opacity 2s infinite; \n}\n\n@media only screen and (max-width: 600px) {\n    #login, #registration { \n      border:none;\n      width:80%;\n    }\n\n    #login form, \n    #registration form { \n      border: 0px;\n      grid-template-columns: 1fr; \n    }\n\n    #login input,\n    #registration input { \n      grid-column: 1 / 2 \n    }\n} \n",""]);const a=o},3062:(e,t,n)=>{"use strict";n.d(t,{Z:()=>a});var r=n(8081),i=n.n(r),s=n(3645),o=n.n(s)()(i());o.push([e.id,".member-pill {\n    border-radius:5px;\n    padding:5px;\n    white-space: nowrap;\n    color:black;\n    display:inline-block;\n    overflow-x:hidden;\n    text-overflow:ellipsis;\n    background: var(--user_light);\n}\n",""]);const a=o},9688:(e,t,n)=>{"use strict";n.d(t,{Z:()=>a});var r=n(8081),i=n.n(r),s=n(3645),o=n.n(s)()(i());o.push([e.id,'.message-frame {\n    position:relative;\n    display: grid;\n    width:100%;\n    justify-items: left;\n    grid-template-areas: "ident content";\n    grid-template-columns: fit-content(10%) auto;\n    transition: background-color .2s ease;\n}\n\n.message-from-user {\n    grid-template-columns: auto fit-content(10%);\n    grid-template-areas: "content ident";\n    text-align:right;\n    flex-direction:row-reverse;\n}\n\n.message-decoration {\n    position:relative;\n    grid-area: ident;\n    width:0px;\n    padding-top:10px;\n    padding-bottom:10px;\n    padding-left:12px;\n    margin-right:20px;\n    border-right: 5px solid var(--user_light);\n    background: white;\n}\n\n.message-from-user > .message-decoration {\n    padding-left:0px;\n    margin-right:0px;\n    padding-right:12px;\n    margin-left:15px;\n    border-right: none;\n    border-left: 5px solid var(--user_light);\n}\n\n.message-actions {\n    width:300px;\n    visibility:hidden;\n    position:absolute;\n    top:-29px;\n    left: 12px;\n}\n\n.message-actions > button {\n    cursor: pointer;\n    margin:0px;\n    margin-left:5px;\n    border:2px solid var(--user_light);\n    padding-left:4px;\n    padding-right:4px;\n    background-color:white;\n    min-height:30px;\n    vertical-align:bottom;\n}\n\n.message-actions > button:hover {\n    background-color: var(--user_light);\n}\n\n.message-actions > button > svg {\n  height:16px;\n  width:16px;\n}\n\n.message-actions > button:first-child {\n    margin-left:0px;\n}\n\n.message-actions > button:last-child {\n    margin-right:0px;\n}\n\n.message-actions > emoji-picker {\n  position:absolute;\n  bottom: 0px;\n  --num-columns: 6;\n  width:250px;\n}\n\n.message-from-user .message-actions {\n    left:unset;\n    right: 12px;\n}\n\n.message-frame .message-actions[data-active],\n.message-frame:hover .message-actions  {\n    visibility:visible;\n}\n\n.file-upload,\n.redacted {\n    font-size:10pt;\n    color:gray;\n}\n\n/* status vanishes on sent. We probably want a warning for a "not_sent" status,\n * whuch means that sending has failed */\n.message-frame[data-event-status] {\n    color:gray;\n}\n\n.message-frame .message-frame-status {\n  position: absolute;\n  right: 25px;\n  bottom: 5px;\n  width:300px;\n  font-size:10pt;\n  color: #ababab;\n}\n\n.message-frame .message-frame-status a {\n  text-decoration:underline;\n  cursor:pointer;\n}\n\n.message-frame > .message-body {\n    display: inline-block;\n    text-align:left;\n    margin-top:5px;\n    margin-bottom:5px;\n    margin-right:5px;\n    grid-area: content;\n    overflow-wrap: anywhere;\n    /* XXX: depreciated, but needed until webkit adds overflow-wrap: anywhere */\n    word-break: break-word;\n    hyphens:auto;\n}\n\n.message-body blockquote {\n  margin-left: 1em;\n}\n\n.message-body [data-mx-maths],\n.message-body pre {\n  overflow-y: scroll;\n  max-width: calc(var(--widget-1-width) - 55px);\n}\n\n/* allows max-width on inline math */\nspan[data-mx-maths] { \n  display:inline-block; \n  vertical-align:middle;\n}\n\nhtml[data-scrollbars="hidden"] .message-body [data-mx-maths],\nhtml[data-scrollbars="hidden"] .message-body pre {\n  -ms-overflow-style: none;  /* IE and Edge */\n  scrollbar-width:none;\n}\n\nhtml[data-scrollbars="hidden"] .message-body [data-mx-maths]::-webkit-scrollbar,\nhtml[data-scrollbars="hidden"] .message-body pre::-webkit-scrollbar { display: none; }\n\n\n.message-body a {\n  color:black;\n}\n\n.message-body a:hover {\n  text-underline-offset: 0.1em;\n  text-decoration-thickness: 0.125em;\n}\n\n.message-body a[href^="https://matrix.to/#/@"] {\n  font-weight: bold;\n  color:var(--user_dark);\n  cursor: unset;\n  text-decoration: none;\n}\n\n.message-body a[href^="https://matrix.to/#/@"]::before {\n  content:"@"\n}\n\n.message-frame:hover {\n    background-color: var(--user_ultralight);\n}\n\n.message-from-user .message-body  {\n    padding-left:15px;\n}\n\n.emote-banner {\n  color: var(--user_dark);\n  font-weight:bold;\n}\n\n.annotation-banner {\n  font-size:10pt;\n  font-weight: bold;\n}\n\n.message-frame div[data-mx-maths] {\n    min-width:300px;\n}\n\n.message-reactions {\n    position:relative;\n    width:0px;\n    top:0px;\n    right:10px;\n    height:100%;\n}\n\n.message-reactions > div {\n  position: absolute;\n  max-height:100%;\n  display:flex;\n  flex-direction:column;\n  font-size:8pt;\n  padding:2px;\n  background-color:white;\n  border-radius:25px;\n  user-select:none;\n  border:2px solid var(--user_light);\n  overflow: scroll;\n  -ms-overflow-style: none;  /* IE and Edge */\n  scrollbar-width: none;  /* Firefox */\n}\n\n.message-reactions > div::-webkit-scrollbar { display: none; }\n\n.emoji-badge {\n  white-space: nowrap;\n  padding-top:1px;\n  padding-bottom:1px;\n  cursor: pointer;\n}\n\n.reply-sender-info,\n.user-info-message {\n    display:flex;\n    align-items: center;\n    font-size:10pt;\n    font-weight:bold;\n    color: var(--user_dark);\n}\n\n.user-info-message {\n    padding:10px;\n}\n\n.reply-sender-info > img,\n.user-info-message > img {\n    width:20px;\n    height:20px;\n    border-radius:30px;\n    position:relative;\n    left:-5px;\n    object-fit:cover;\n    user-select: none;\n}\n\n.large-emoji-display { font-size: 36pt }\n\n.reply-preface {\n    position:relative;\n    left:-5px;\n    color:#ababab;\n    font-size:10pt;\n    padding-bottom:5px;\n}\n\n.reply-preview {\n    border-left:5px solid var(--user_light);\n    padding-left:15px;\n}\n\n.redacted-preview {\n    padding-top:5px;\n    font-size:10pt;\n    color: gray;\n}\n\n.reply-fallback blockquote{\n    margin:0px\n}\n\n.message-from-user > img {\n   left: 5px;\n}\n\n.message-from-user .message-reactions {\n    right:-10px;\n}\n\n.message-from-user .message-reactions div{\n    right:0px;\n}\n\n.media-message-thumbnail {\n  max-width: calc(100% - 20px);\n  border-radius:20px;\n}\n\n.image-message-preview,\n.video-message-preview {\n  margin:10px;\n  width: calc(100% - 30px);\n}\n\n.media-message-thumbnail.awaiting {\n  height:200px;\n  margin:10px;\n  border:3px dashed black;\n  width: calc(100% - 30px);\n}\n',""]);const a=o},7724:(e,t,n)=>{"use strict";n.d(t,{Z:()=>a});var r=n(8081),i=n.n(r),s=n(3645),o=n.n(s)()(i());o.push([e.id,'#modalPopup {\n  position: fixed;\n  top: 0px;\n  bottom: 0px;\n  left: 0px;\n  right: 0px;\n  display:flex;\n  align-items:center;\n  justify-content:center;\n  z-index:20;\n}\n\n#modalBackground {\n  position: absolute;\n  top: 0px;\n  bottom: 0px;\n  left: 0px;\n  right: 0px;\n  background:black;\n  opacity:0.15;\n  overscroll-behavior:none;\n  overflow-y:scroll;\n}\n\n#modalContent {\n  position: relative;\n  background:white;\n  opacity:1;\n  width:400px;\n  min-height:150px;\n  max-width:70vw;\n  max-height:80vh;\n  border-radius:30px;\n  padding:30px;\n  padding-right:30px;\n  z-index:21;\n  overflow-y:scroll;\n  overscroll-behavior:contain;\n}\n\nhtml[data-scrollbars="hidden"] #modalContent {\n  scrollbar-width: none;\n}\n\nhtml[data-scrollbars="hidden"] #modalContent::-webkit-scrollbar {\n  display: none;\n}\n\n#modalHeader {\n  margin-top:-10px;\n  margin-right:20px;\n\n}\n\n#dismissModal {\n  cursor:pointer;\n  position:absolute;\n  right:20px;\n  top:20px;\n  background:none;\n  border:none;\n}\n',""]);const a=o},6145:(e,t,n)=>{"use strict";n.d(t,{Z:()=>h});var r=n(8081),i=n.n(r),s=n(3645),o=n.n(s),a=n(1667),l=n.n(a),c=new URL(n(5685),n.b),d=o()(i()),u=l()(c);d.push([e.id,'#page-nav {\n    position:fixed;\n    bottom:0px;\n    width:100%;\n    height:var(--navHeight);\n    z-index:5;\n    transition: height 0.5s ease;\n}\n\n#nav-background{\n    background: black;\n    position:absolute;\n    width:100%;\n    top:0px;\n    bottom:0px;\n}\n\n#nav-pages {\n    display:flex;\n    position:absolute;\n    bottom: var(--navHeight);\n    align-items: center;\n    height:50px;\n    width: var(--contentWidth);\n    overflow-y:scroll;\n    transition: bottom 0.5s ease-in-out;\n}\n\nhtml[data-scrollbars="hidden"] #nav-pages {\n    -ms-overflow-style: none;  /* IE and Edge */\n    scrollbar-width: none;  /* Firefox */\n}\n\nhtml[data-scrollbars="hidden"] #nav-pages::-webkit-scrollbar { display: none; }\n\n.nav-hidden {\n    bottom:0px !important;\n}\n\n#nav-pages > button:first-child {\n    margin-left:auto\n}\n\n#nav-pages > button:last-child {\n    margin-right:auto\n}\n\n#nav-pages > button {\n    cursor:pointer;\n    background:white;\n    border:2px solid black;\n    min-width:40px;\n    min-height:40px;\n    border-radius:30px;\n    margin-left:5px;\n    margin-right:5px;\n    text-align:center;\n}\n\n#nav-pages > button.typing {\n    animation: pulse-color 2s infinite; \n    animation-timing-function:ease;\n}\n\n#nav-pages > button:focus {\n  font-weight: bold;\n}\n\n.nav-button-wrapper {\n    position:relative;\n    display: flex;\n    height:75px;\n    align-items: center;\n    justify-content:center;\n    max-width: var(--contentWidth);\n    transition: var(--transitionSizing)\n}\n\n@media only screen and (max-width: 600px) {\n    .nav-button-wrapper {\n        display: grid;\n        grid-template-columns: repeat(9,1fr);\n        transform: scale(0.8);\n        transform-origin: left;\n        min-width: calc((var(--contentWidth)/0.8));\n        justify-content:space-around;\n    }\n\n    #page-nav {\n      height:calc(0.8 * var(--navHeight));\n    }\n\n    #nav-pages {\n      bottom: calc(0.8 * var(--navHeight));\n    }\n\n    .nav-button-wrapper {\n      height:calc(0.8 * 75px);\n    }\n}\n\n@media only screen and (min-width: 600px) {\n    .nav-button-wrapper > button:first-child {\n        position: absolute;\n        left:10px;\n    }\n\n    .nav-button-wrapper > button:last-child {\n        position: absolute;\n        right:10px;\n    }\n}\n\n.nav-button-wrapper > button {\n    cursor:pointer;\n    outline:none;\n    color:white;\n    background:black;\n    border:none;\n    margin:2px;\n}\n\n.nav-button-wrapper > button:focus {\n  outline: 1px solid white;\n}\n\n.nav-button-wrapper > button[disabled] {\n    color:gray;\n}\n\n.nav-button-wrapper > form {\n    position: relative;\n    display:flex;\n    align-items: center;\n    justify-content: center;\n    background:white;\n    font-size: 1em;\n    border-radius:50px;\n    height:45px;\n}\n\n.nav-button-wrapper > form > input {\n    width:20px; /*this is going to need to be adjusted in JS*/\n    font-size: 1em;\n    border:none;\n    text-align:right;\n}\n\n.nav-button-wrapper > form > span:last-child {\n    padding-right:5px;\n}\n\n@media only screen and (max-width: 600px) {\n    .nav-button-wrapper > form > input { display:none }\n    .nav-button-wrapper > form > span { display:none }\n}\n\n.nav-button-wrapper > form > button {\n    cursor:pointer;\n    outline:none;\n    margin:5px;\n    padding:5px;\n    height:35px;\n    border-radius:50px;\n    border:none;\n    background:white;\n    transition: background 0.5s ease;\n}\n\n.nav-button-wrapper > form > button:hover {\n    color:white;\n    background:#dddddd;\n    transition: background 0.5s ease;\n}\n\n.nav-button-wrapper > form > button.nav-toggled {\n    color:white;\n    background:#ababab;\n    transition: background 0.5s ease;\n}\n\n#nav-total-pages {\n    font-size: 1em;\n    text-align:left;\n    min-width:20px;\n    margin:3px;\n}\n\n.currentpage {\n  background:black !important;\n  color: white;\n}\n\n[data-pindrop-mode="unplaced"] #page-nav * { \n  cursor:unset;\n}\n\n[data-pindrop-mode="unplaced"] #page-nav { \n  cursor: url('+u+") 16 16, pointer !important;\n}\n",""]);const h=d},3519:(e,t,n)=>{"use strict";n.d(t,{Z:()=>a});var r=n(8081),i=n.n(r),s=n(3645),o=n.n(s)()(i());o.push([e.id,"#notifications-listing {\n  width: 90vw;\n  max-width: 800px;\n  padding-top:1em;\n}\n\n.notification, .invite-entry {\n  margin:10px;\n  border: 1px solid black;\n}\n\n.unread-notification, .invite-entry {\n  border: 2px solid black;\n}\n\n.invite-entry {\n    padding: 1em; \n}\n\n.notification-contents {\n  padding-bottom:10px;\n}\n\n.discussion-intro {\n  padding:10px;\n  font-size:10pt;\n}\n\n.discussion-topic {\n  padding:10px;\n  padding-left:20px;\n}\n\n.notification-header > img {\n    width:20px;\n    height:20px;\n    border-radius:30px;\n    position:relative;\n    left:-5px;\n    object-fit:cover;\n    user-select:none;\n}\n\n.notification-header {\n    padding:10px;\n    display:flex;\n    align-items: center;\n    font-size:10pt;\n}\n\n.notification-date-indicator {\n  font-size:10pt;\n  color:#555555\n}\n\n.notification-header .sender {\n    font-weight:bold;\n    color: var(--user_dark);\n}\n\n.notification-body {\n    padding:20px;\n    padding-top:10px;\n    border-left: 5px solid var(--user_light);\n    margin-left:13px;\n    margin-bottom:13px;\n}\n",""]);const a=o},9302:(e,t,n)=>{"use strict";n.d(t,{Z:()=>a});var r=n(8081),i=n.n(r),s=n(3645),o=n.n(s)()(i());o.push([e.id,"#pdf-upload {\n  max-width: 800px;\n  width: 90vw;\n  padding-top:1em;\n}\n\n#pdfUploadForm {\n    border: 1px black solid;\n    margin: 1em;\n    padding: 1em;\n}\n\n#pdfUploadForm {\n    display:grid;\n    grid-template-columns: 180px 1fr;\n}\n\n#pdfUploadForm label {\n    grid-column: 1 / 2 ;\n}\n\n #pdfUploadForm input, #pdfUploadForm textarea {\n    grid-column: 2 / 3 ;\n    margin-bottom:.5em;\n    border:none;\n    background:#ededed\n}\n\n#pdfUploadForm details {\n    grid-column: 1 / 3 ;\n    margin-bottom:.5em;\n}\n\n.pdfupload-details-wrapper {\n  padding-top:.5em;\n  display:grid;\n  grid-template-columns: 180px 1fr;\n}\n\n#pdfUploadForm > textarea {\n    resize: vertical;\n    min-height:50px;\n}\n\n#pdfUploadFormSubmit {\n    grid-column: 1 / 2 ;\n}\n\n#pdfUploadFormProgress {\n    text-align:right;\n    grid-column: 2 / 3 ;\n}\n\n.pdfupload-form-detail {\n    color:#ababab;\n    grid-column: 2 / 3 ;\n    font-size:10pt;\n    position:relative;\n    top:-8px;\n}\n\n#pdfUploadFormProgress progress {\n  width: 100%;\n  height: 80%;\n}\n\n@media only screen and (max-width: 600px) {\n    #pdfUploadForm,\n    .pdfupload-details-wrapper {\n      grid-template-columns: 1fr;\n    }\n\n    #pdfUploadForm details, \n    #pdfUploadFormProgress, \n    .pdfupload-form-detail,\n    #pdfUploadForm input, \n    #pdfUploadForm textarea { \n        grid-column: 1 / 2;\n        min-width: 0px; /* helps prevent overflow on very narrow viewports */\n    }\n} \n",""]);const a=o},3723:(e,t,n)=>{"use strict";n.d(t,{Z:()=>a});var r=n(8081),i=n.n(r),s=n(3645),o=n.n(s)()(i());o.push([e.id,'#content-container {\n  --dragOffset-1: 0px;\n  --dragOffset-2: 0px;\n  --sidepanelWidth: 100%; \n  --widget-1-width: calc(100vw - var(--widget-control-width));\n  /* 1px to compensate for border */\n  --widget-2-width: calc(100vw - var(--widget-control-width) + 1px);\n  --widget-control-width:40px;\n  --transitionSizing: max-width 0.5s ease, width 0.5s ease, left 0.5s ease, right 0.5s ease, padding 0.5s ease;\n}\n\n#sidepanel {\n    display:flex;\n    position:fixed;\n    right: 0px;\n    top:0px;\n    bottom:0px;\n    box-shadow: -2px 0 4px 0 rgba(0,0,0,.2);\n    background:white;\n    z-index:6;\n    /*  for mobile, override below */\n    left: calc(\n      (100% + 5px) * (1 - max(var(--chatVisible), var(--listingVisible)))\n    );\n    width: var(--sidepanelWidth);\n    transition: var(--transitionSizing)\n}\n\n.panel-handle {\n  opacity:0;\n  position:absolute;\n  left:-10px;\n  width: 10px;\n  height:100%;\n  display:flex;\n  align-items:center;\n  cursor:ew-resize;\n  font-size:16pt;\n  user-select:none;\n  touch-action:none;\n}\n\n.panel-handle:hover {\n  opacity:1;\n}\n\n#panel-handle-2 {\n  left: calc((var(--chatVisible) * var(--widget-1-width)) - 10px);\n}\n\n/* workaround for chrome bug with resizing the chat panel itself */\n.panel-widget-1, .panel-widget-2 {\n    position:absolute;\n    display:inline-flex;\n    height:100%;\n    overflow-y:auto;\n    -webkit-box-sizing: border-box; /* Safari/Chrome, other WebKit */\n    -moz-box-sizing: border-box; /* Firefox, other Gecko */\n    box-sizing: border-box; /* Opera/IE 8+ */\n    transition: var(--transitionSizing)\n}\n\n.panel-widget-1 {\n    width: var(--widget-1-width);\n    min-width: var(--widget-1-width);\n}\n\n.panel-widget-2 {\n    left: calc(\n      var(--chatVisible) * (var(--widget-1-width) + var(--widget-control-width)) \n      + (var(--listingVisible) * -1px) /* 1px to compensate for border */\n    );\n    width: var(--widget-2-width);\n    min-width: var(--widget-2-width);\n    border-left:1px solid #adadad;\n    background:white;\n}\n\nhtml[data-scrollbars="hidden"] .panel-widget-2,\nhtml[data-scrollbars="hidden"] .panel-widget-1 {\n  -ms-overflow-style: none;  /* IE and Edge */\n  scrollbar-width: none;  /* Firefox */\n}\n\n/*chrome, safari, opera*/\nhtml[data-scrollbars="hidden"] .panel-widget-2::-webkit-scrollbar,\nhtml[data-scrollbars="hidden"] .panel-widget-1::-webkit-scrollbar {\n  display: none;\n}\n\n.panel-widget-controls {\n  box-sizing:border-box;\n  height:100%;\n  position:absolute;\n  right:0px;\n  background:white;\n  width:calc(var(--widget-control-width)); \n  border-left:1px solid #adadad;\n  display:flex;\n  flex-direction:column;\n  gap:10px;\n  align-items:center;\n}\n\n.panel-widget-controls > button {\n    border:none;\n    outline:none;\n    font-size:24px;\n    height:24px;\n    text-align:center;\n    vertical-align:middle;\n    background:transparent;\n    cursor:pointer;\n}\n\n.panel-widget-controls > button[data-active]::after {\n  position:absolute;\n  right: -2px;\n  display:inline-block;\n  border-left: 4px solid black;\n  content:"";\n  height:24px;\n  border-radius:24px;\n}\n\n.panel-widget-controls > hr {\n  border: none;\n  border-top: 1px solid #dedede;\n  width:24px;\n}\n\n@media only screen and (max-width: 600px) {\n  .panel-widget-controls .room-icon {\n    transform: scale(0.7)\n  }\n}\n\n/* Small devices (portrait tablets and large phones, 600px and up) */\n@media only screen and (min-width: 600px) {\n  .panel-widget-controls {\n    padding-top:10px;\n  }\n    #content-container {\n      --widget-control-width:80px;\n    }\n}\n\n/* Medium devices (landscape tablets, 768px and up) */\n@media only screen and (min-width: 768px) {\n\n    .panel-widget-2 {\n      left: calc(var(--chatVisible) * var(--widget-1-width));\n    }\n\n    #sidepanel {\n      left:unset;\n    }\n\n    #content-container {\n        --sidepanelWidth: calc(\n            (var(--widget-1-width) * var(--chatVisible))\n            + (var(--widget-2-width) * var(--listingVisible))\n            + (var(--widget-control-width))\n        );\n        --widget-1-width:calc(350px + var(--dragOffset-1));\n        --widget-2-width:calc(350px + var(--dragOffset-2));\n    }\n}\n\n/* standard DPI */\n@media only screen and (min-width: 1280px) {\n    #content-container {\n        --widget-1-width:calc(400px + var(--dragOffset-1));\n        --widget-2-width:calc(400px + var(--dragOffset-2));\n    }\n\n    .panel-widget-1 {\n        padding:0px;\n        border: none;\n    }\n}\n\n/* high DPI laptop */\n@media only screen and (min-width: 1400px) {\n}\n    \n@media only screen and (min-width: 1800px) {\n    #content-container {\n        --widget-1-width:calc(400px + var(--dragOffset-1));\n        --widget-2-width:calc(500px + var(--dragOffset-2));\n    }\n}\n',""]);const a=o},8244:(e,t,n)=>{"use strict";n.d(t,{Z:()=>a});var r=n(8081),i=n.n(r),s=n(3645),o=n.n(s)()(i());o.push([e.id,"#popup-wrapper {\n  position:sticky;\n  z-index:10;\n}\n\n#popup-menu {\n  position:absolute;\n  bottom:0px;\n  left:0px;\n  right:0px;\n  border-top: 1px solid #adadad;\n  border-bottom: 1px solid #adadad;\n}\n\n.popup-menu-item {\n  padding:10px;\n  height:20px;\n  background:white;\n  cursor: pointer;\n}\n\n.popup-menu-item-selected-user {\n  background:var(--user_ultralight);\n}\n\n.popup-menu-item-selected-flag,\n.popup-menu-item-selected-emoji {\n  background:#eaeaea\n}\n\n.popup-menu-item-username {\n  font-weight:bold;\n  color:var(--user_dark)\n}\n",""]);const a=o},3734:(e,t,n)=>{"use strict";n.d(t,{Z:()=>a});var r=n(8081),i=n.n(r),s=n(3645),o=n.n(s)()(i());o.push([e.id,'#profile-information {\n  width:90vw;\n  max-width:800px;\n  padding-top:1em;\n}\n\n#profileInformationForm {\n    border: 1px black solid;\n    margin: 1em;\n    padding: 1em;\n}\n\n#profileInformationForm {\n    display:grid;\n    grid-template-columns: 180px 1fr;\n}\n\n#profile-display-options,\n#profile-advanced-options {\n    display:grid;\n    grid-template-columns: 180px 1fr;\n    padding:10px;\n}\n\n#profile-advanced-options > pre {\n  margin:0px;\n  font-size:10pt;\n  overflow-y:scroll;\n  user-select:all;\n}\n\nhtml[data-scrollbars="hidden"] #profile-advanced-options > pre {\n  -ms-overflow-style: none;  /* IE and Edge */\n  scrollbar-width: none;  /* Firefox */\n}\n\nhtml[data-scrollbars="hidden"] #profile-advanced-options > div::-webkit-scrollbar { display: none; }\n\n#profileInformationForm label {\n    grid-column: 1 / 2 ;\n}\n\n#profileInformationForm details {\n    grid-column: 1 / 3 ;\n}\n\n#profileInformationForm input,\n#profile-information-userid {\n    grid-column: 2 / 3 ;\n    margin-bottom:.5em;\n    width:100%;\n    overflow-y:auto;\n}\n\n#profileInformationForm input {\n    border:none;\n    background:#ededed\n}\n\n#profileSelector {\n    cursor: pointer;\n    display:block;\n    height:180px;\n    max-height:180px;\n    width:180px;\n    object-fit:cover;\n    border-radius:90px;\n    grid-column: 2 / 3 ;\n    margin:auto;\n}\n\ndiv#profileSelector {\n    background : #ababab;\n}\n\n#profileSelector:hover {\n    filter: brightness(80%);\n    transition: filter 0.5s ease;\n}\n\n#profileInformationFormSubmit {\n    grid-column: 1 / 3 ;\n}\n\n#profileInformationFormSubmit > button {\n    margin-top:10px;\n    margin-right:10px;\n}\n\n#profileInformationFormProgress {\n    grid-column: 1 / 3 ;\n    padding-top: 10px;\n    animation: pulse-opacity 2s infinite; \n    animation-timing-function:ease;\n}\n\n#profileInformationFormProgress > progress {\n  width: 100%\n}\n\n#profileInformationFormHidden {\n    display:none;\n}\n\n@media only screen and (max-width: 600px) {\n\n    #profileInformationForm,\n    #profile-advanced-options,\n    #profile-display-options {\n      grid-template-columns: 1fr \n    }\n\n    #profileInformationFormProgress,\n    #profile-information-userid,\n    #profileInformationForm > input { \n      grid-column: 1 / 2;\n    }\n\n    #profile-advanced-options > pre {\n      padding: 5px\n    }\n\n    #profileSelector {\n      grid-column: 1 / 2;\n    }\n} \n',""]);const a=o},1737:(e,t,n)=>{"use strict";n.d(t,{Z:()=>a});var r=n(8081),i=n.n(r),s=n(3645),o=n.n(s)()(i());o.push([e.id,".room-icon {\n  display:inline-block;\n  border-radius:5px;\n  overflow:hidden;\n  vertical-align:bottom;\n  transition: opacity 0.5s ease;\n  user-select:none;\n}\n\n.room-icon img {\n  object-fit:cover;\n}\n\n.room-icon:not([data-has-avatar]) {\n  background: var(--room_light);\n  color: var(--room_dark);\n  font-size:24pt;\n  text-align:center;\n}\n\n.room-icon:not([data-joined]) {\n  opacity: 0.5;\n}\n\n.room-icon:hover {\n  opacity: 1\n}\n",""]);const a=o},8316:(e,t,n)=>{"use strict";n.d(t,{Z:()=>a});var r=n(8081),i=n.n(r),s=n(3645),o=n.n(s)()(i());o.push([e.id,'#room-list {\n  padding-top: 1em\n}\n\n#select-sort {\n    user-select:none;\n    display:flex;\n    align-items:center;\n    margin-left: 1em;\n}\n\n#room-filters {\n    margin-left: 1em;\n    padding-top: 1em;\n}\n\n.room-filter-listing:first-child {\n    padding-left:.5em;\n}\n\n.room-filter-listing {\n    position:relative;\n    font-weight: bold;\n}\n\n.room-filter-content .small-icon {\n    vertical-align: sub;\n    padding-right:5px;\n}\n\n.room-filter-content::after {\n    content: ","\n}\n\n.room-filter-listing > .small-icon-badge {\n  visibility:hidden;\n  cursor: pointer;\n  padding:0px;\n}\n\n.room-filter-listing > .small-icon-badge > svg {\n  height:10px;\n  width:10px;\n  stroke-width:4px;\n}\n\n.room-filter-listing:hover > .small-icon-badge {\n  visibility:visible;\n}\n\n#select-sort > button {\n    margin-left: 1em;\n}\n\n#select-sort > .small-icon {\n    margin-left: 0em;\n}\n\n.room-listing-entry {\n    margin: 1em;\n    border: 1px black solid;\n}\n\n.invite-buttons button {\n  margin-right:10px;\n}\n\n.room-listing-avatar {\n  width:100%;\n  background:#454545;\n  display:flex;\n  justify-content: center;\n  overflow:hidden;\n  position:relative;\n}\n\n.room-listing-avatar > img:first-child {\n  object-fit:cover;\n  max-width:100%;\n  opacity: 0;\n  transition: opacity .25s ease;\n}\n\n.room-listing-avatar > img:first-child[data-avatar-loaded] {\n  opacity: 1\n}\n\n.room-listing-body {\n    padding: 1em;\n    display: grid;\n    grid-template-columns: minmax(0, 1fr) 40px;\n}\n\n.room-listing-body[data-room-entry-buttons-visible] > div {\n    grid-column: 1 / 2;\n}\n\n.room-listing-entry-buttons {\n    grid-column: 1 / 2 !important;\n}\n\n.invite-heading, .room-listing-heading {\n    grid-column: 1 / 2 !important;\n    margin-bottom:1em;\n    display:flex;\n    align-items:center;\n}\n\n.room-listing-heading a {\n  color:black;\n}\n\n.room-listing-data {\n    padding-bottom:5px;\n}\n\n.room-listing-data-row {\n    display: flex;\n    padding-bottom:5px;\n    flex-wrap:wrap;\n    gap:5px;\n    align-items: center;\n}\n\n.room-listing-data-row .room-data-icon { \n  display:grid;\n  align-items:center;\n  margin-right:10px;\n}\n\n.room-listing-data .invite-pill { opacity:.5; }\n\n.room-listing-heading > a {\n  font-size:16pt;\n  font-weight:bold;\n  text-decoration: underline;\n  text-decoration-thickness: 2px;\n  cursor: pointer;\n}\n\n.room-toggle-members {\n  border-radius:5px;\n  margin-right:5px;\n  border:none;\n  background:white;\n  font-size:12pt;\n  cursor:pointer;\n  padding:5px;\n  white-space: nowrap;\n  color:black;\n  transition:background .5s ease;\n}\n\n.room-toggle-members:hover {\n  background:#ededed;\n  transition:background .5s ease;\n}\n\n.room-listing-entry .fav-star {\n    height:24px;\n    padding-right:5px;\n}\n\n.room-listing-entry .fav-star svg {\n    transform: scale(1);\n}\n\n.room-listing-entry-buttons  {\n    grid-column: 2 / 3 !important;\n    grid-row: 1 / 50 !important;\n    padding:5px;\n    margin-left:5px;\n}\n\n.room-listing-body[data-room-entry-buttons-visible] .room-listing-entry-buttons {\n    background: #ededed;\n    border-radius: 15px;\n}\n\n.room-listing-entry-buttons > button {\n    padding: 0px;\n    margin: 0px;\n    background: none;\n    border: none;\n    cursor: pointer;\n}\n\n.room-listing-avatar:not([data-has-avatar]) .room-annotation-data {\n  position:relative;\n  width:100%;\n}\n\n.room-listing-avatar[data-has-avatar] .room-annotation-data {\n  position:absolute;\n  left:0px;\n  top:0px;\n}\n\n.room-annotation-data > span{\n  margin:10px;\n}\n\n.room-annotation-data > span {\n  display:grid;\n  background: rgba(255,255,255,0.6);\n  backdrop-filter: blur(6px);\n  padding:10px;\n  width:20px;\n  border-radius:30px;\n  grid-template-columns: 20px 0px;\n  cursor:pointer;\n  transition:background .25s ease;\n}\n\n.room-annotation-data > span:hover {\n  background: rgba(255,255,255,1);\n}\n\n\n#settings-loading {\n  animation: pulse-opacity 2s infinite; \n  animation-timing-function:ease;\n}\n',""]);const a=o},5255:(e,t,n)=>{"use strict";n.d(t,{Z:()=>a});var r=n(8081),i=n.n(r),s=n(3645),o=n.n(s)()(i());o.push([e.id,'#room-settings-form {\n  display: grid;\n  grid-template-columns: 100px 1fr;\n  align-items: center;\n}\n\n#room-settings-form label {\n  margin:5px;\n  margin-left:0px;\n}\n\n#room-settings-avatar-selector {\n    cursor: pointer;\n    display:block;\n    height:180px;\n    max-height:180px;\n    width:100%;\n    object-fit:cover;\n    border-radius:10px;\n    grid-column: 2 / 3 ;\n    margin:auto;\n}\n\ndiv#room-settings-avatar-selector {\n    background : #ababab;\n}\n\n#room-avatar-selector-hidden {\n    display:none;\n}\n\n#room-settings-avatar-info,\n#room-settings-name-info,\n#room-settings-visibility-info,\n#room-settings-join-info {\n  grid-column: 2/3;\n  padding-top:5px;\n  font-size:10pt;\n}\n\n#room-settings-join-link {\n  grid-column: 2/3;\n  font-size:10pt;\n  overflow-x:auto;\n  user-select:all;\n}\n\nhtml[data-scrollbars="hidden"] #room-settings-join-link {\n  -ms-overflow-style: none;  /* IE and Edge */\n  scrollbar-width:none;\n}\n\nhtml[data-scrollbars="hidden"] #room-settings-join-link::-webkit-scrollbar { display: none; }\n\n#room-settings-name-info,\n#room-settings-avatar-info,\n#room-settings-visibility-info,\n#room-settings-join-info {\n  padding-bottom:15px;\n}\n\n#room-settings-submit-wrapper {\n  grid-column: 1/3;\n}\n\n#room-settings-submit-wrapper button:not(:last-child) {\n  margin-right:10px;\n  margin-bottom:10px;\n}\n\n#room-settings-progress {\n    grid-column: 1/3 ;\n    padding-top: 10px;\n    animation: pulse-opacity 2s infinite; \n    animation-timing-function:ease;\n}\n\n#room-settings-progress progress {\n    width:100%;\n  }\n\n@media only screen and (max-width: 600px) {\n  #room-settings-form {\n    grid-template-columns: 1fr;\n  }\n\n  #room-settings-name-info,\n  #room-settings-visibility-info,\n  #room-settings-submit-wrapper,\n  #room-settings-avatar-info,\n  #room-settings-avatar-selector,\n  #room-settings-progress,\n  #room-settings-join-link,\n  #room-settings-join-info {\n    grid-column: 1/2;\n  }\n}\n',""]);const a=o},592:(e,t,n)=>{"use strict";n.d(t,{Z:()=>a});var r=n(8081),i=n.n(r),s=n(3645),o=n.n(s)()(i());o.push([e.id,".search-bar { \n    position:relative; \n    display:flex;\n    align-items:center;\n}\n\n.search-bar > .search-icon {\n    pointer-events:none;\n}\n\n.search-bar > .clear-icon {\n    cursor: pointer;\n}\n\n.search-bar > .search-icon {\n    position:absolute;\n    left:5px;\n    align-items:center;\n    display:flex;\n}\n\n\n.search-bar > .right-decoration {\n    position:absolute;\n    right:5px;\n    align-items:center;\n    display:flex;\n}\n\n.search-bar > .right-decoration > .search-hint {\n  border-radius:5px;\n  border: solid 1px #cdcdcd;\n  padding-left:5px;\n  padding-right:5px;\n  color:#ababab;\n}\n\n.search-bar > input {\n    width:100%;\n    margin:auto;\n    padding:7px;\n    padding-left:35px;\n    border:none;\n    background:#ededed;\n}\n",""]);const a=o},6213:(e,t,n)=>{"use strict";n.d(t,{Z:()=>a});var r=n(8081),i=n.n(r),s=n(3645),o=n.n(s)()(i());o.push([e.id,"#pdf-search-result-panel {\n  flex-direction: column;\n  position:relative;\n}\n\n#pdf-search-term {\n  padding:10px;\n  border-bottom: 1px solid #ababab;\n}\n\n#pdf-search-term .search-bar {\n  margin-top:5px;\n}\n\n#pdf-search-term .small-icon {\n  position:absolute;\n  right:10px;\n  cursor:pointer;\n}\n\n#pdf-search-warn {\n  padding:10px;\n}\n\n#pdf-search-result-panel .pdf-search-result:hover {\n    background: #efefef;\n    transition: background-color 0.5s ease;\n}\n\n.pdf-search-result[data-focused-result] {\n    background: #efefef;\n}\n\n#pdf-search-result-panel .pdf-search-result {\n  cursor: pointer;\n  position:relative;\n  width:calc(100% - 20px);\n  padding:10px;\n  border-bottom: 1px solid #ababab;\n  transition: background-color 0.5s ease;\n}\n\n.result-context {\n  white-space:pre;\n  text-overflow:ellipsis;\n  overflow:hidden;\n  text-align:center;\n  padding-bottom:5px;\n}\n\n#pdf-search-result-panel .page-data {\n  font-size:10pt;\n  color:#565656;\n}\n",""]);const a=o},5620:(e,t,n)=>{"use strict";n.d(t,{Z:()=>a});var r=n(8081),i=n.n(r),s=n(3645),o=n.n(s)()(i());o.push([e.id,"#spaces-manager {\n  padding-top:1em;\n}\n\n#spaces-list {\n  margin-left: 16px;\n}\n\n#spaces-manager h1 {\n  margin:0px\n}\n\n#create-space {\n  background:white;\n  /* border: 2px #cdcdcd dashed; */\n  border:none;\n  padding:0px;\n  border-radius:15px;\n  font-size:14pt;\n  font-weight:bold;\n  color: #cdcdcd;\n  margin-top:16px;\n  cursor:pointer;\n  transition: color .5s ease;\n}\n\n#create-space:hover {\n  color: black;\n}\n\n.space-listing h3 {\n  cursor:pointer;\n  margin-bottom:12px;\n  display:inline-flex;\n  align-content:center;\n}\n\n.space-listing h3 button {\n  visibility:hidden;\n  background:none;\n  border:none;\n  cursor: pointer;\n}\n.space-listing h3 button[data-narrow-view],\n.space-listing h3:hover button {\n  visibility: visible;\n}\n\n.space-listing h3 svg {\n  height:20px;\n}\n\n.space-listing-actions {\n  position:relative;\n  top:-7px;\n}\n\n.space-listing-actions button {\n  margin-left:10px;\n}\n\n.space-listing-children .room-icon {\n  margin-left:10px;\n  margin-bottom:10px;\n}\n\n.space-listing-more {\n  margin-left:10px;\n  background:white;\n  display:inline-block;\n  border-radius:5px;\n  font-size:14pt;\n  font-weight:bold;\n  height:50px;\n  color: #cdcdcd;\n  cursor:pointer;\n  transition: color .5s ease;\n}\n\n.space-listing-more:hover {\n  color:black;\n}\n\n#create-collection {\n    display:grid;\n    grid-template-columns: 180px 1fr;\n}\n\n#manage-discussion-select-view {\n  margin-top:20px;\n}\n\n#current-discussions-list,\n#available-discussions-list {\n  max-height:60vh;\n  padding-top:20px;\n  transition: height .25s ease;\n}\n\n.discussion-listing svg {\n  height:1.2em;\n  vertical-align:bottom;\n}\n\n.discussion-listing {\n  display: grid;\n  height:28px;\n  grid-template-columns: 2em 1fr;\n  background: none;\n  border: none;\n  font-weight: bold;\n  cursor: pointer;\n  position: relative;\n  text-align:left;\n}\n\n.discussion-listing > span {\n  padding-bottom:10px;\n  white-space:pre;\n  overflow-x:auto;\n  -ms-overflow-style: none;  /* IE and Edge */\n  scrollbar-width:none;\n}\n\n.discussion-listing > span::-webkit-scrollbar { display: none; }\n\n.discussion-listing[data-change-pending] {\n  color:#ababab;\n}\n\n.discussion-listing:hover {\n  left:5px\n}\n\n#create-collection > label {\n    grid-column: 1 / 2 ;\n}\n\n#create-collection > input, #create-collection > textarea {\n    grid-column: 2 / 3 ;\n    margin-bottom:.5em;\n    border:none;\n    background:#ededed\n}\n\n.name-validation-detail {\n    color:#ababab;\n    grid-column: 2 / 3 ;\n    font-size:10pt;\n    position:relative;\n    top:-8px;\n}\n\n#create-collection-submit {\n    grid-column: 1 / 2 ;\n}\n\n@media only screen and (max-width: 600px) {\n    #create-collection { grid-template-columns: 1fr; }\n\n    .space-listing h3 {\n      display:grid;\n      grid-template-columns: 1fr auto;\n    }\n\n    .name-validation-detail,\n    #create-collection > input, \n    #create-collection > textarea { \n        grid-column: 1 / 2;\n        min-width: 0px; /* helps prevent overflow on very narrow viewports */\n    }\n} \n\n@media only screen and (min-width: 600px) {\n  .space-listing-children { padding-right:50px; }\n}\n\n@media only screen and (min-width: 1280px) {\n  .space-listing-children { padding-right:100px; }\n}\n",""]);const a=o},5578:(e,t,n)=>{"use strict";n.d(t,{Z:()=>a});var r=n(8081),i=n.n(r),s=n(3645),o=n.n(s)()(i());o.push([e.id,"#splash-logo {\n    width: min(500px,80vw)\n}\n\n#splash-loader{\n    padding-top:20px;\n    animation: pulse-opacity 2s infinite; \n    animation-timing-function:ease;\n}\n\n#splash-wrapper {\n    display:flex;\n    flex-direction:column;\n    justify-content:center;\n    align-items:center;\n    height:100%;\n    width:100%;\n}\n",""]);const a=o},7384:(e,t,n)=>{"use strict";n.d(t,{Z:()=>a});var r=n(8081),i=n.n(r),s=n(3645),o=n.n(s)()(i());o.push([e.id,"#sync-indicator {\n  position:fixed;\n  bottom:0px;\n  right:0px;\n  margin:5px;\n  font-size:8pt;\n  background:white;\n  z-index:15;\n  padding:0px 3px 0px 3px;\n  border-radius:5px;\n}\n\n@media only screen and (max-width: 1280px) {\n  .sync-hidden { visibility: hidden }\n}\n",""]);const a=o},8477:(e,t,n)=>{"use strict";n.d(t,{Z:()=>a});var r=n(8081),i=n.n(r),s=n(3645),o=n.n(s)()(i());o.push([e.id,".tag-input {\n  width:55px;\n}\n\n.tag-input:focus {\n  width:120px;\n}\n\n.tag-editor {\n    display: flex;\n    padding-bottom:5px;\n    flex-wrap:wrap;\n    align-items: center;\n}\n\n.room-tag {\n  padding-right:5px;\n}\n\n.room-tag::after {\n  content:',';\n}\n\n.room-tag:last-child::after {\n  content:'';\n}\n\n.room-tag-delete-icon svg {\n  height:15px;\n  cursor: pointer;\n}\n",""]);const a=o},145:(e,t,n)=>{"use strict";n.d(t,{Z:()=>a});var r=n(8081),i=n.n(r),s=n(3645),o=n.n(s)()(i());o.push([e.id,"#text-layer { \n    position: absolute;\n    left: 0;\n    top: 0;\n    right: 0;\n    bottom: 0;\n    overflow: hidden;\n    line-height:1;\n    opacity: 0.2;\n    pointer-events:none;\n    transform: scale(var(--pdfFitRatio)) translate(-4px,-4px);\n    /* a slight skootch here to make up for span padding */\n}\n\n[data-pindrop-mode] #text-layer { display:none; }\n\n#text-layer > span {\n    color:transparent;\n    position: absolute;\n    white-space: pre;\n    cursor: text;\n    pointer-events:auto;\n    transform-origin: 0% 0%;\n    user-select:text;\n    /* a little padding seems to help with text selection */\n    padding:4px; \n}\n\n#text-layer > br {\n  color: transparent;\n  position: absolute;\n  white-space: pre;\n  cursor: text;\n  transform-origin: 0% 0%;\n  user-select:text;\n}\n\n#text-layer mark {\n    color:transparent;\n    background:black;\n    padding:2px;\n    position:relative;\n    left:-5px;\n}\n\n#text-layer span::selection {\n    color:transparent;\n    background:var(--selectColor);\n}\n",""]);const a=o},9631:(e,t,n)=>{"use strict";n.d(t,{Z:()=>a});var r=n(8081),i=n.n(r),s=n(3645),o=n.n(s)()(i());o.push([e.id,'#toast-popup {\n  position: fixed;\n  display:flex;\n  align-items:center;\n  justify-content:center;\n  z-index:25;\n}\n\n@media only screen and (min-width: 600px) {\n  #toast-popup {\n    top: 40px;\n    left: 40px;\n    animation: slide-from-left .5s ease-out;\n  }\n\n  #toast-content {\n    width:400px;\n    min-height:100px;\n    border-radius:10px;\n  }\n}\n\n@media only screen and (max-width: 600px) {\n  #toast-popup {\n    animation: slide-from-top .5s ease-out;\n    width:100%;\n    top: 0px;\n  }\n\n  #toast-content {\n    width:100%;\n    min-height:80px;\n  }\n}\n\n@keyframes slide-from-top {\n    0% { \n      top: -150px; \n      opacity:0;\n    }\n    100% { \n      top: 0px; \n      opacity:1;\n    }\n}\n\n@keyframes slide-from-left {\n    0% { \n      left: -400px; \n      opacity:0;\n    }\n    100% { \n      left: 40px; \n      opacity:1;\n    }\n}\n\n#toast-content {\n  position: relative;\n  background:#efefef;\n  padding:10px;\n  z-index:21;\n}\n\nhtml[data-scrollbars="hidden"] #toast-content { scrollbar-width: none; }\n\nhtml[data-scrollbars="hidden"] #toast-content::-webkit-scrollbar { display: none; }\n\n#toast-content pre {\n  overflow-y: scroll;\n  text-overflow:ellipsis;\n}\n\nhtml[data-scrollbars="hidden"] #toast-content pre {\n  -ms-overflow-style: none;  /* IE and Edge */\n  scrollbar-width:none;\n}\n\nhtml[data-scrollbars="hidden"] #toast-content pre::-webkit-scrollbar { display: none; }\n\n#toast-header{ margin-top:-3px; }\n\n#dismiss-toast {\n  cursor:pointer;\n  position:absolute;\n  right:5px;\n  top:5px;\n  background:none;\n  border:none;\n}\n',""]);const a=o},6894:(e,t,n)=>{"use strict";n.d(t,{Z:()=>a});var r=n(8081),i=n.n(r),s=n(3645),o=n.n(s)()(i());o.push([e.id,'.tippy-box {\n  color:white;\n  background:black;\n  padding:5px;\n  font-weight:bold;\n  border-radius:5px;\n}\n\n.tippy-box[data-theme="bordered"] {\n  border: 1px solid white;\n}\n\n.tippy-box[data-theme="small"] {\n  font-size:10pt;\n}\n',""]);const a=o},5188:(e,t,n)=>{"use strict";n.d(t,{Z:()=>a});var r=n(8081),i=n.n(r),s=n(3645),o=n.n(s)()(i());o.push([e.id,"#welcome-header {\n    user-select:none;\n    position:fixed;\n    width:100%;\n    display:flex;\n    justify-content:flex-end;\n    align-items:center;\n    top:0px;\n    background-color: white;\n    z-index:2;\n    height:50px;\n    box-shadow: 0px 2px 4px 0 rgba(0,0,0,.2);\n}\n\n#welcome-header-content {\n    width:100%;\n    display:flex;\n    justify-content:flex-end;\n    align-items:center;\n}\n\n#welcome-header-content button {\n  border:none;\n  border-bottom: 2px solid white;\n  background:none;\n  padding:0px;\n}\n\n#welcome-collection, #welcome-upload, #welcome-notifications {\n    margin-right:15px; \n}\n\n#welcome-collection > svg, \n#welcome-notifications > svg, \n#welcome-upload > svg {\n    cursor: pointer;\n    vertical-align:top;\n    margin-bottom:5px;\n}\n\n#welcome-notifications > .small-icon-badge {\n  position:absolute;\n  bottom:19px;\n  left:12px;\n}\n\n#welcome-notifications, \n#welcome-upload, \n#welcome-collection, \n#welcome-profile {\n  flex-shrink: 0;\n  position:relative;\n  top: 2px;\n  border-bottom: 2px solid white;\n  transition: border .25s ease;\n}\n\n#welcome-collection[data-active], \n#welcome-notifications[data-active], \n#welcome-upload[data-active], \n#welcome-profile[data-active] {\n  border-bottom: 2px solid black;\n}\n\n#welcome-profile {\n    cursor: pointer;\n    width: 31px;\n    height: 31px;\n    margin-right: 13px; \n}\n\n#welcome-initial {\n    display:inline-block;\n    position:relative;\n    bottom:2px;\n    width:22px;\n    height:22px;\n    text-align:center;\n    font-weight: bold;\n    line-height:22px;\n    border:2px solid black;\n    border-radius:35px;\n    background-color: var(--user_light);\n}\n\n#welcome-profile img {\n    height:28px;\n    width:28px;\n    border-radius:35px;\n    position:relative;\n    bottom:2px;\n    object-fit:cover;\n}\n\n#welcome-profile button {\n  margin-bottom:5px;\n}\n\n#welcome-container {\n    margin-top:50px;\n    width: 100%;\n    position: absolute;\n    display:flex;\n    justify-content:center;\n}\n\n#welcome-split {\n  display:grid;\n  width: 90vw;\n  grid-template-columns: 1fr 1fr;\n  max-width:1600px;\n}\n\n.welcome-column {\n  width: 90vw;\n  max-width:800px;\n}\n\n#welcome-container h2 {\n  margin:0px;\n  padding-left:15px;\n}\n\n#welcome-header-content .search-bar {\n    flex-shrink:2;\n    flex-grow:1;\n    margin-right:15px; \n    margin-left:13px; \n}\n\n@media only screen and (min-width: 600px) {\n  #welcome-header-content .search-bar {\n    flex-grow:unset;\n    margin-right:auto;\n  }\n\n  #welcome-header-content .search-bar input {\n    transition: width .25s;\n    width:200px;\n  }\n\n  #welcome-header-content .search-bar input:focus {\n    width:400px;\n  }\n} \n",""]);const a=o},3645:e=>{"use strict";e.exports=function(e){var t=[];return t.toString=function(){return this.map((function(t){var n="",r=void 0!==t[5];return t[4]&&(n+="@supports (".concat(t[4],") {")),t[2]&&(n+="@media ".concat(t[2]," {")),r&&(n+="@layer".concat(t[5].length>0?" ".concat(t[5]):""," {")),n+=e(t),r&&(n+="}"),t[2]&&(n+="}"),t[4]&&(n+="}"),n})).join("")},t.i=function(e,n,r,i,s){"string"==typeof e&&(e=[[null,e,void 0]]);var o={};if(r)for(var a=0;a<this.length;a++){var l=this[a][0];null!=l&&(o[l]=!0)}for(var c=0;c<e.length;c++){var d=[].concat(e[c]);r&&o[d[0]]||(void 0!==s&&(void 0===d[5]||(d[1]="@layer".concat(d[5].length>0?" ".concat(d[5]):""," {").concat(d[1],"}")),d[5]=s),n&&(d[2]?(d[1]="@media ".concat(d[2]," {").concat(d[1],"}"),d[2]=n):d[2]=n),i&&(d[4]?(d[1]="@supports (".concat(d[4],") {").concat(d[1],"}"),d[4]=i):d[4]="".concat(i)),t.push(d))}},t}},1667:e=>{"use strict";e.exports=function(e,t){return t||(t={}),e?(e=String(e.__esModule?e.default:e),/^['"].*['"]$/.test(e)&&(e=e.slice(1,-1)),t.hash&&(e+=t.hash),/["'() \t\n]|(%20)/.test(e)||t.needQuotes?'"'.concat(e.replace(/"/g,'\\"').replace(/\n/g,"\\n"),'"'):e):e}},8081:e=>{"use strict";e.exports=function(e){return e[1]}},9996:e=>{"use strict";var t=function(e){return function(e){return!!e&&"object"==typeof e}(e)&&!function(e){var t=Object.prototype.toString.call(e);return"[object RegExp]"===t||"[object Date]"===t||function(e){return e.$$typeof===n}(e)}(e)},n="function"==typeof Symbol&&Symbol.for?Symbol.for("react.element"):60103;function r(e,t){return!1!==t.clone&&t.isMergeableObject(e)?a((n=e,Array.isArray(n)?[]:{}),e,t):e;var n}function i(e,t,n){return e.concat(t).map((function(e){return r(e,n)}))}function s(e){return Object.keys(e).concat(function(e){return Object.getOwnPropertySymbols?Object.getOwnPropertySymbols(e).filter((function(t){return e.propertyIsEnumerable(t)})):[]}(e))}function o(e,t){try{return t in e}catch(e){return!1}}function a(e,n,l){(l=l||{}).arrayMerge=l.arrayMerge||i,l.isMergeableObject=l.isMergeableObject||t,l.cloneUnlessOtherwiseSpecified=r;var c=Array.isArray(n);return c===Array.isArray(e)?c?l.arrayMerge(e,n,l):function(e,t,n){var i={};return n.isMergeableObject(e)&&s(e).forEach((function(t){i[t]=r(e[t],n)})),s(t).forEach((function(s){(function(e,t){return o(e,t)&&!(Object.hasOwnProperty.call(e,t)&&Object.propertyIsEnumerable.call(e,t))})(e,s)||(o(e,s)&&n.isMergeableObject(t[s])?i[s]=function(e,t){if(!t.customMerge)return a;var n=t.customMerge(e);return"function"==typeof n?n:a}(s,n)(e[s],t[s],n):i[s]=r(t[s],n))})),i}(e,n,l):r(n,l)}a.all=function(e,t){if(!Array.isArray(e))throw new Error("first argument should be an array");return e.reduce((function(e,n){return a(e,n,t)}),{})};var l=a;e.exports=l},7837:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.attributeNames=t.elementNames=void 0,t.elementNames=new Map([["altglyph","altGlyph"],["altglyphdef","altGlyphDef"],["altglyphitem","altGlyphItem"],["animatecolor","animateColor"],["animatemotion","animateMotion"],["animatetransform","animateTransform"],["clippath","clipPath"],["feblend","feBlend"],["fecolormatrix","feColorMatrix"],["fecomponenttransfer","feComponentTransfer"],["fecomposite","feComposite"],["feconvolvematrix","feConvolveMatrix"],["fediffuselighting","feDiffuseLighting"],["fedisplacementmap","feDisplacementMap"],["fedistantlight","feDistantLight"],["fedropshadow","feDropShadow"],["feflood","feFlood"],["fefunca","feFuncA"],["fefuncb","feFuncB"],["fefuncg","feFuncG"],["fefuncr","feFuncR"],["fegaussianblur","feGaussianBlur"],["feimage","feImage"],["femerge","feMerge"],["femergenode","feMergeNode"],["femorphology","feMorphology"],["feoffset","feOffset"],["fepointlight","fePointLight"],["fespecularlighting","feSpecularLighting"],["fespotlight","feSpotLight"],["fetile","feTile"],["feturbulence","feTurbulence"],["foreignobject","foreignObject"],["glyphref","glyphRef"],["lineargradient","linearGradient"],["radialgradient","radialGradient"],["textpath","textPath"]]),t.attributeNames=new Map([["definitionurl","definitionURL"],["attributename","attributeName"],["attributetype","attributeType"],["basefrequency","baseFrequency"],["baseprofile","baseProfile"],["calcmode","calcMode"],["clippathunits","clipPathUnits"],["diffuseconstant","diffuseConstant"],["edgemode","edgeMode"],["filterunits","filterUnits"],["glyphref","glyphRef"],["gradienttransform","gradientTransform"],["gradientunits","gradientUnits"],["kernelmatrix","kernelMatrix"],["kernelunitlength","kernelUnitLength"],["keypoints","keyPoints"],["keysplines","keySplines"],["keytimes","keyTimes"],["lengthadjust","lengthAdjust"],["limitingconeangle","limitingConeAngle"],["markerheight","markerHeight"],["markerunits","markerUnits"],["markerwidth","markerWidth"],["maskcontentunits","maskContentUnits"],["maskunits","maskUnits"],["numoctaves","numOctaves"],["pathlength","pathLength"],["patterncontentunits","patternContentUnits"],["patterntransform","patternTransform"],["patternunits","patternUnits"],["pointsatx","pointsAtX"],["pointsaty","pointsAtY"],["pointsatz","pointsAtZ"],["preservealpha","preserveAlpha"],["preserveaspectratio","preserveAspectRatio"],["primitiveunits","primitiveUnits"],["refx","refX"],["refy","refY"],["repeatcount","repeatCount"],["repeatdur","repeatDur"],["requiredextensions","requiredExtensions"],["requiredfeatures","requiredFeatures"],["specularconstant","specularConstant"],["specularexponent","specularExponent"],["spreadmethod","spreadMethod"],["startoffset","startOffset"],["stddeviation","stdDeviation"],["stitchtiles","stitchTiles"],["surfacescale","surfaceScale"],["systemlanguage","systemLanguage"],["tablevalues","tableValues"],["targetx","targetX"],["targety","targetY"],["textlength","textLength"],["viewbox","viewBox"],["viewtarget","viewTarget"],["xchannelselector","xChannelSelector"],["ychannelselector","yChannelSelector"],["zoomandpan","zoomAndPan"]])},7220:function(e,t,n){"use strict";var r=this&&this.__assign||function(){return r=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},r.apply(this,arguments)},i=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n),Object.defineProperty(e,r,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),s=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),o=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&i(t,e,n);return s(t,e),t};Object.defineProperty(t,"__esModule",{value:!0});var a=o(n(9960)),l=n(5863),c=n(7837),d=new Set(["style","script","xmp","iframe","noembed","noframes","plaintext","noscript"]),u=new Set(["area","base","basefont","br","col","command","embed","frame","hr","img","input","isindex","keygen","link","meta","param","source","track","wbr"]);function h(e,t){void 0===t&&(t={});for(var n=("length"in e?e:[e]),r="",i=0;i<n.length;i++)r+=p(n[i],t);return r}function p(e,t){switch(e.type){case a.Root:return h(e.children,t);case a.Directive:case a.Doctype:return"<"+e.data+">";case a.Comment:return"\x3c!--"+e.data+"--\x3e";case a.CDATA:return function(e){return"<![CDATA["+e.children[0].data+"]]>"}(e);case a.Script:case a.Style:case a.Tag:return function(e,t){var n;"foreign"===t.xmlMode&&(e.name=null!==(n=c.elementNames.get(e.name))&&void 0!==n?n:e.name,e.parent&&m.has(e.parent.name)&&(t=r(r({},t),{xmlMode:!1}))),!t.xmlMode&&g.has(e.name)&&(t=r(r({},t),{xmlMode:"foreign"}));var i="<"+e.name,s=function(e,t){if(e)return Object.keys(e).map((function(n){var r,i,s=null!==(r=e[n])&&void 0!==r?r:"";return"foreign"===t.xmlMode&&(n=null!==(i=c.attributeNames.get(n))&&void 0!==i?i:n),t.emptyAttrs||t.xmlMode||""!==s?n+'="'+(!1!==t.decodeEntities?l.encodeXML(s):s.replace(/"/g,"&quot;"))+'"':n})).join(" ")}(e.attribs,t);return s&&(i+=" "+s),0===e.children.length&&(t.xmlMode?!1!==t.selfClosingTags:t.selfClosingTags&&u.has(e.name))?(t.xmlMode||(i+=" "),i+="/>"):(i+=">",e.children.length>0&&(i+=h(e.children,t)),!t.xmlMode&&u.has(e.name)||(i+="</"+e.name+">")),i}(e,t);case a.Text:return function(e,t){var n=e.data||"";return!1===t.decodeEntities||!t.xmlMode&&e.parent&&d.has(e.parent.name)||(n=l.encodeXML(n)),n}(e,t)}}t.default=h;var m=new Set(["mi","mo","mn","ms","mtext","annotation-xml","foreignObject","desc","title"]),g=new Set(["svg","math"])},9960:(e,t)=>{"use strict";var n;Object.defineProperty(t,"__esModule",{value:!0}),t.Doctype=t.CDATA=t.Tag=t.Style=t.Script=t.Comment=t.Directive=t.Text=t.Root=t.isTag=t.ElementType=void 0,function(e){e.Root="root",e.Text="text",e.Directive="directive",e.Comment="comment",e.Script="script",e.Style="style",e.Tag="tag",e.CDATA="cdata",e.Doctype="doctype"}(n=t.ElementType||(t.ElementType={})),t.isTag=function(e){return e.type===n.Tag||e.type===n.Script||e.type===n.Style},t.Root=n.Root,t.Text=n.Text,t.Directive=n.Directive,t.Comment=n.Comment,t.Script=n.Script,t.Style=n.Style,t.Tag=n.Tag,t.CDATA=n.CDATA,t.Doctype=n.Doctype},7915:function(e,t,n){"use strict";var r=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n),Object.defineProperty(e,r,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),i=this&&this.__exportStar||function(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||r(t,e,n)};Object.defineProperty(t,"__esModule",{value:!0}),t.DomHandler=void 0;var s=n(9960),o=n(7790);i(n(7790),t);var a=/\s+/g,l={normalizeWhitespace:!1,withStartIndices:!1,withEndIndices:!1,xmlMode:!1},c=function(){function e(e,t,n){this.dom=[],this.root=new o.Document(this.dom),this.done=!1,this.tagStack=[this.root],this.lastNode=null,this.parser=null,"function"==typeof t&&(n=t,t=l),"object"==typeof e&&(t=e,e=void 0),this.callback=null!=e?e:null,this.options=null!=t?t:l,this.elementCB=null!=n?n:null}return e.prototype.onparserinit=function(e){this.parser=e},e.prototype.onreset=function(){this.dom=[],this.root=new o.Document(this.dom),this.done=!1,this.tagStack=[this.root],this.lastNode=null,this.parser=null},e.prototype.onend=function(){this.done||(this.done=!0,this.parser=null,this.handleCallback(null))},e.prototype.onerror=function(e){this.handleCallback(e)},e.prototype.onclosetag=function(){this.lastNode=null;var e=this.tagStack.pop();this.options.withEndIndices&&(e.endIndex=this.parser.endIndex),this.elementCB&&this.elementCB(e)},e.prototype.onopentag=function(e,t){var n=this.options.xmlMode?s.ElementType.Tag:void 0,r=new o.Element(e,t,void 0,n);this.addNode(r),this.tagStack.push(r)},e.prototype.ontext=function(e){var t=this.options.normalizeWhitespace,n=this.lastNode;if(n&&n.type===s.ElementType.Text)t?n.data=(n.data+e).replace(a," "):n.data+=e,this.options.withEndIndices&&(n.endIndex=this.parser.endIndex);else{t&&(e=e.replace(a," "));var r=new o.Text(e);this.addNode(r),this.lastNode=r}},e.prototype.oncomment=function(e){if(this.lastNode&&this.lastNode.type===s.ElementType.Comment)this.lastNode.data+=e;else{var t=new o.Comment(e);this.addNode(t),this.lastNode=t}},e.prototype.oncommentend=function(){this.lastNode=null},e.prototype.oncdatastart=function(){var e=new o.Text(""),t=new o.NodeWithChildren(s.ElementType.CDATA,[e]);this.addNode(t),e.parent=t,this.lastNode=e},e.prototype.oncdataend=function(){this.lastNode=null},e.prototype.onprocessinginstruction=function(e,t){var n=new o.ProcessingInstruction(e,t);this.addNode(n)},e.prototype.handleCallback=function(e){if("function"==typeof this.callback)this.callback(e,this.dom);else if(e)throw e},e.prototype.addNode=function(e){var t=this.tagStack[this.tagStack.length-1],n=t.children[t.children.length-1];this.options.withStartIndices&&(e.startIndex=this.parser.startIndex),this.options.withEndIndices&&(e.endIndex=this.parser.endIndex),t.children.push(e),n&&(e.prev=n,n.next=e),e.parent=t,this.lastNode=null},e}();t.DomHandler=c,t.default=c},7790:function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},r(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),s=this&&this.__assign||function(){return s=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},s.apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0}),t.cloneNode=t.hasChildren=t.isDocument=t.isDirective=t.isComment=t.isText=t.isCDATA=t.isTag=t.Element=t.Document=t.NodeWithChildren=t.ProcessingInstruction=t.Comment=t.Text=t.DataNode=t.Node=void 0;var o=n(9960),a=new Map([[o.ElementType.Tag,1],[o.ElementType.Script,1],[o.ElementType.Style,1],[o.ElementType.Directive,1],[o.ElementType.Text,3],[o.ElementType.CDATA,4],[o.ElementType.Comment,8],[o.ElementType.Root,9]]),l=function(){function e(e){this.type=e,this.parent=null,this.prev=null,this.next=null,this.startIndex=null,this.endIndex=null}return Object.defineProperty(e.prototype,"nodeType",{get:function(){var e;return null!==(e=a.get(this.type))&&void 0!==e?e:1},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"parentNode",{get:function(){return this.parent},set:function(e){this.parent=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"previousSibling",{get:function(){return this.prev},set:function(e){this.prev=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"nextSibling",{get:function(){return this.next},set:function(e){this.next=e},enumerable:!1,configurable:!0}),e.prototype.cloneNode=function(e){return void 0===e&&(e=!1),_(this,e)},e}();t.Node=l;var c=function(e){function t(t,n){var r=e.call(this,t)||this;return r.data=n,r}return i(t,e),Object.defineProperty(t.prototype,"nodeValue",{get:function(){return this.data},set:function(e){this.data=e},enumerable:!1,configurable:!0}),t}(l);t.DataNode=c;var d=function(e){function t(t){return e.call(this,o.ElementType.Text,t)||this}return i(t,e),t}(c);t.Text=d;var u=function(e){function t(t){return e.call(this,o.ElementType.Comment,t)||this}return i(t,e),t}(c);t.Comment=u;var h=function(e){function t(t,n){var r=e.call(this,o.ElementType.Directive,n)||this;return r.name=t,r}return i(t,e),t}(c);t.ProcessingInstruction=h;var p=function(e){function t(t,n){var r=e.call(this,t)||this;return r.children=n,r}return i(t,e),Object.defineProperty(t.prototype,"firstChild",{get:function(){var e;return null!==(e=this.children[0])&&void 0!==e?e:null},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"lastChild",{get:function(){return this.children.length>0?this.children[this.children.length-1]:null},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"childNodes",{get:function(){return this.children},set:function(e){this.children=e},enumerable:!1,configurable:!0}),t}(l);t.NodeWithChildren=p;var m=function(e){function t(t){return e.call(this,o.ElementType.Root,t)||this}return i(t,e),t}(p);t.Document=m;var g=function(e){function t(t,n,r,i){void 0===r&&(r=[]),void 0===i&&(i="script"===t?o.ElementType.Script:"style"===t?o.ElementType.Style:o.ElementType.Tag);var s=e.call(this,i,r)||this;return s.name=t,s.attribs=n,s}return i(t,e),Object.defineProperty(t.prototype,"tagName",{get:function(){return this.name},set:function(e){this.name=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"attributes",{get:function(){var e=this;return Object.keys(this.attribs).map((function(t){var n,r;return{name:t,value:e.attribs[t],namespace:null===(n=e["x-attribsNamespace"])||void 0===n?void 0:n[t],prefix:null===(r=e["x-attribsPrefix"])||void 0===r?void 0:r[t]}}))},enumerable:!1,configurable:!0}),t}(p);function f(e){return(0,o.isTag)(e)}function y(e){return e.type===o.ElementType.CDATA}function v(e){return e.type===o.ElementType.Text}function b(e){return e.type===o.ElementType.Comment}function w(e){return e.type===o.ElementType.Directive}function S(e){return e.type===o.ElementType.Root}function _(e,t){var n;if(void 0===t&&(t=!1),v(e))n=new d(e.data);else if(b(e))n=new u(e.data);else if(f(e)){var r=t?k(e.children):[],i=new g(e.name,s({},e.attribs),r);r.forEach((function(e){return e.parent=i})),e["x-attribsNamespace"]&&(i["x-attribsNamespace"]=s({},e["x-attribsNamespace"])),e["x-attribsPrefix"]&&(i["x-attribsPrefix"]=s({},e["x-attribsPrefix"])),n=i}else if(y(e)){r=t?k(e.children):[];var a=new p(o.ElementType.CDATA,r);r.forEach((function(e){return e.parent=a})),n=a}else if(S(e)){r=t?k(e.children):[];var l=new m(r);r.forEach((function(e){return e.parent=l})),e["x-mode"]&&(l["x-mode"]=e["x-mode"]),n=l}else{if(!w(e))throw new Error("Not implemented yet: "+e.type);var c=new h(e.name,e.data);null!=e["x-name"]&&(c["x-name"]=e["x-name"],c["x-publicId"]=e["x-publicId"],c["x-systemId"]=e["x-systemId"]),n=c}return n.startIndex=e.startIndex,n.endIndex=e.endIndex,n}function k(e){for(var t=e.map((function(e){return _(e,!0)})),n=1;n<t.length;n++)t[n].prev=t[n-1],t[n-1].next=t[n];return t}t.Element=g,t.isTag=f,t.isCDATA=y,t.isText=v,t.isComment=b,t.isDirective=w,t.isDocument=S,t.hasChildren=function(e){return Object.prototype.hasOwnProperty.call(e,"children")},t.cloneNode=_},6996:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getFeed=void 0;var r=n(3346),i=n(3905);t.getFeed=function(e){var t=l(u,e);return t?"feed"===t.name?function(e){var t,n=e.children,r={type:"atom",items:(0,i.getElementsByTagName)("entry",n).map((function(e){var t,n=e.children,r={media:a(n)};d(r,"id","id",n),d(r,"title","title",n);var i=null===(t=l("link",n))||void 0===t?void 0:t.attribs.href;i&&(r.link=i);var s=c("summary",n)||c("content",n);s&&(r.description=s);var o=c("updated",n);return o&&(r.pubDate=new Date(o)),r}))};d(r,"id","id",n),d(r,"title","title",n);var s=null===(t=l("link",n))||void 0===t?void 0:t.attribs.href;s&&(r.link=s),d(r,"description","subtitle",n);var o=c("updated",n);return o&&(r.updated=new Date(o)),d(r,"author","email",n,!0),r}(t):function(e){var t,n,r=null!==(n=null===(t=l("channel",e.children))||void 0===t?void 0:t.children)&&void 0!==n?n:[],s={type:e.name.substr(0,3),id:"",items:(0,i.getElementsByTagName)("item",e.children).map((function(e){var t=e.children,n={media:a(t)};d(n,"id","guid",t),d(n,"title","title",t),d(n,"link","link",t),d(n,"description","description",t);var r=c("pubDate",t);return r&&(n.pubDate=new Date(r)),n}))};d(s,"title","title",r),d(s,"link","link",r),d(s,"description","description",r);var o=c("lastBuildDate",r);return o&&(s.updated=new Date(o)),d(s,"author","managingEditor",r,!0),s}(t):null};var s=["url","type","lang"],o=["fileSize","bitrate","framerate","samplingrate","channels","duration","height","width"];function a(e){return(0,i.getElementsByTagName)("media:content",e).map((function(e){for(var t=e.attribs,n={medium:t.medium,isDefault:!!t.isDefault},r=0,i=s;r<i.length;r++)t[c=i[r]]&&(n[c]=t[c]);for(var a=0,l=o;a<l.length;a++){var c;t[c=l[a]]&&(n[c]=parseInt(t[c],10))}return t.expression&&(n.expression=t.expression),n}))}function l(e,t){return(0,i.getElementsByTagName)(e,t,!0,1)[0]}function c(e,t,n){return void 0===n&&(n=!1),(0,r.textContent)((0,i.getElementsByTagName)(e,t,n,1)).trim()}function d(e,t,n,r,i){void 0===i&&(i=!1);var s=c(n,r,i);s&&(e[t]=s)}function u(e){return"rss"===e||"feed"===e||"rdf:RDF"===e}},4975:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.uniqueSort=t.compareDocumentPosition=t.removeSubsets=void 0;var r=n(7915);function i(e,t){var n=[],i=[];if(e===t)return 0;for(var s=(0,r.hasChildren)(e)?e:e.parent;s;)n.unshift(s),s=s.parent;for(s=(0,r.hasChildren)(t)?t:t.parent;s;)i.unshift(s),s=s.parent;for(var o=Math.min(n.length,i.length),a=0;a<o&&n[a]===i[a];)a++;if(0===a)return 1;var l=n[a-1],c=l.children,d=n[a],u=i[a];return c.indexOf(d)>c.indexOf(u)?l===t?20:4:l===e?10:2}t.removeSubsets=function(e){for(var t=e.length;--t>=0;){var n=e[t];if(t>0&&e.lastIndexOf(n,t-1)>=0)e.splice(t,1);else for(var r=n.parent;r;r=r.parent)if(e.includes(r)){e.splice(t,1);break}}return e},t.compareDocumentPosition=i,t.uniqueSort=function(e){return(e=e.filter((function(e,t,n){return!n.includes(e,t+1)}))).sort((function(e,t){var n=i(e,t);return 2&n?-1:4&n?1:0})),e}},9432:function(e,t,n){"use strict";var r=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n),Object.defineProperty(e,r,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),i=this&&this.__exportStar||function(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||r(t,e,n)};Object.defineProperty(t,"__esModule",{value:!0}),t.hasChildren=t.isDocument=t.isComment=t.isText=t.isCDATA=t.isTag=void 0,i(n(3346),t),i(n(5010),t),i(n(6765),t),i(n(8043),t),i(n(3905),t),i(n(4975),t),i(n(6996),t);var s=n(7915);Object.defineProperty(t,"isTag",{enumerable:!0,get:function(){return s.isTag}}),Object.defineProperty(t,"isCDATA",{enumerable:!0,get:function(){return s.isCDATA}}),Object.defineProperty(t,"isText",{enumerable:!0,get:function(){return s.isText}}),Object.defineProperty(t,"isComment",{enumerable:!0,get:function(){return s.isComment}}),Object.defineProperty(t,"isDocument",{enumerable:!0,get:function(){return s.isDocument}}),Object.defineProperty(t,"hasChildren",{enumerable:!0,get:function(){return s.hasChildren}})},3905:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getElementsByTagType=t.getElementsByTagName=t.getElementById=t.getElements=t.testElement=void 0;var r=n(7915),i=n(8043),s={tag_name:function(e){return"function"==typeof e?function(t){return(0,r.isTag)(t)&&e(t.name)}:"*"===e?r.isTag:function(t){return(0,r.isTag)(t)&&t.name===e}},tag_type:function(e){return"function"==typeof e?function(t){return e(t.type)}:function(t){return t.type===e}},tag_contains:function(e){return"function"==typeof e?function(t){return(0,r.isText)(t)&&e(t.data)}:function(t){return(0,r.isText)(t)&&t.data===e}}};function o(e,t){return"function"==typeof t?function(n){return(0,r.isTag)(n)&&t(n.attribs[e])}:function(n){return(0,r.isTag)(n)&&n.attribs[e]===t}}function a(e,t){return function(n){return e(n)||t(n)}}function l(e){var t=Object.keys(e).map((function(t){var n=e[t];return Object.prototype.hasOwnProperty.call(s,t)?s[t](n):o(t,n)}));return 0===t.length?null:t.reduce(a)}t.testElement=function(e,t){var n=l(e);return!n||n(t)},t.getElements=function(e,t,n,r){void 0===r&&(r=1/0);var s=l(e);return s?(0,i.filter)(s,t,n,r):[]},t.getElementById=function(e,t,n){return void 0===n&&(n=!0),Array.isArray(t)||(t=[t]),(0,i.findOne)(o("id",e),t,n)},t.getElementsByTagName=function(e,t,n,r){return void 0===n&&(n=!0),void 0===r&&(r=1/0),(0,i.filter)(s.tag_name(e),t,n,r)},t.getElementsByTagType=function(e,t,n,r){return void 0===n&&(n=!0),void 0===r&&(r=1/0),(0,i.filter)(s.tag_type(e),t,n,r)}},6765:(e,t)=>{"use strict";function n(e){if(e.prev&&(e.prev.next=e.next),e.next&&(e.next.prev=e.prev),e.parent){var t=e.parent.children;t.splice(t.lastIndexOf(e),1)}}Object.defineProperty(t,"__esModule",{value:!0}),t.prepend=t.prependChild=t.append=t.appendChild=t.replaceElement=t.removeElement=void 0,t.removeElement=n,t.replaceElement=function(e,t){var n=t.prev=e.prev;n&&(n.next=t);var r=t.next=e.next;r&&(r.prev=t);var i=t.parent=e.parent;if(i){var s=i.children;s[s.lastIndexOf(e)]=t}},t.appendChild=function(e,t){if(n(t),t.next=null,t.parent=e,e.children.push(t)>1){var r=e.children[e.children.length-2];r.next=t,t.prev=r}else t.prev=null},t.append=function(e,t){n(t);var r=e.parent,i=e.next;if(t.next=i,t.prev=e,e.next=t,t.parent=r,i){if(i.prev=t,r){var s=r.children;s.splice(s.lastIndexOf(i),0,t)}}else r&&r.children.push(t)},t.prependChild=function(e,t){if(n(t),t.parent=e,t.prev=null,1!==e.children.unshift(t)){var r=e.children[1];r.prev=t,t.next=r}else t.next=null},t.prepend=function(e,t){n(t);var r=e.parent;if(r){var i=r.children;i.splice(i.indexOf(e),0,t)}e.prev&&(e.prev.next=t),t.parent=r,t.prev=e.prev,t.next=e,e.prev=t}},8043:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.findAll=t.existsOne=t.findOne=t.findOneChild=t.find=t.filter=void 0;var r=n(7915);function i(e,t,n,s){for(var o=[],a=0,l=t;a<l.length;a++){var c=l[a];if(e(c)&&(o.push(c),--s<=0))break;if(n&&(0,r.hasChildren)(c)&&c.children.length>0){var d=i(e,c.children,n,s);if(o.push.apply(o,d),(s-=d.length)<=0)break}}return o}t.filter=function(e,t,n,r){return void 0===n&&(n=!0),void 0===r&&(r=1/0),Array.isArray(t)||(t=[t]),i(e,t,n,r)},t.find=i,t.findOneChild=function(e,t){return t.find(e)},t.findOne=function e(t,n,i){void 0===i&&(i=!0);for(var s=null,o=0;o<n.length&&!s;o++){var a=n[o];(0,r.isTag)(a)&&(t(a)?s=a:i&&a.children.length>0&&(s=e(t,a.children)))}return s},t.existsOne=function e(t,n){return n.some((function(n){return(0,r.isTag)(n)&&(t(n)||n.children.length>0&&e(t,n.children))}))},t.findAll=function(e,t){for(var n,i,s=[],o=t.filter(r.isTag);i=o.shift();){var a=null===(n=i.children)||void 0===n?void 0:n.filter(r.isTag);a&&a.length>0&&o.unshift.apply(o,a),e(i)&&s.push(i)}return s}},3346:function(e,t,n){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.innerText=t.textContent=t.getText=t.getInnerHTML=t.getOuterHTML=void 0;var i=n(7915),s=r(n(7220)),o=n(9960);function a(e,t){return(0,s.default)(e,t)}t.getOuterHTML=a,t.getInnerHTML=function(e,t){return(0,i.hasChildren)(e)?e.children.map((function(e){return a(e,t)})).join(""):""},t.getText=function e(t){return Array.isArray(t)?t.map(e).join(""):(0,i.isTag)(t)?"br"===t.name?"\n":e(t.children):(0,i.isCDATA)(t)?e(t.children):(0,i.isText)(t)?t.data:""},t.textContent=function e(t){return Array.isArray(t)?t.map(e).join(""):(0,i.hasChildren)(t)&&!(0,i.isComment)(t)?e(t.children):(0,i.isText)(t)?t.data:""},t.innerText=function e(t){return Array.isArray(t)?t.map(e).join(""):(0,i.hasChildren)(t)&&(t.type===o.ElementType.Tag||(0,i.isCDATA)(t))?e(t.children):(0,i.isText)(t)?t.data:""}},5010:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.prevElementSibling=t.nextElementSibling=t.getName=t.hasAttrib=t.getAttributeValue=t.getSiblings=t.getParent=t.getChildren=void 0;var r=n(7915),i=[];function s(e){var t;return null!==(t=e.children)&&void 0!==t?t:i}function o(e){return e.parent||null}t.getChildren=s,t.getParent=o,t.getSiblings=function(e){var t=o(e);if(null!=t)return s(t);for(var n=[e],r=e.prev,i=e.next;null!=r;)n.unshift(r),r=r.prev;for(;null!=i;)n.push(i),i=i.next;return n},t.getAttributeValue=function(e,t){var n;return null===(n=e.attribs)||void 0===n?void 0:n[t]},t.hasAttrib=function(e,t){return null!=e.attribs&&Object.prototype.hasOwnProperty.call(e.attribs,t)&&null!=e.attribs[t]},t.getName=function(e){return e.name},t.nextElementSibling=function(e){for(var t=e.next;null!==t&&!(0,r.isTag)(t);)t=t.next;return t},t.prevElementSibling=function(e){for(var t=e.prev;null!==t&&!(0,r.isTag)(t);)t=t.prev;return t}},4076:function(e,t,n){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.decodeHTML=t.decodeHTMLStrict=t.decodeXML=void 0;var i=r(n(9323)),s=r(n(9591)),o=r(n(2586)),a=r(n(26));function l(e){var t=Object.keys(e).join("|"),n=d(e),r=new RegExp("&(?:"+(t+="|#[xX][\\da-fA-F]+|#\\d+")+");","g");return function(e){return String(e).replace(r,n)}}t.decodeXML=l(o.default),t.decodeHTMLStrict=l(i.default);var c=function(e,t){return e<t?1:-1};function d(e){return function(t){if("#"===t.charAt(1)){var n=t.charAt(2);return"X"===n||"x"===n?a.default(parseInt(t.substr(3),16)):a.default(parseInt(t.substr(2),10))}return e[t.slice(1,-1)]}}t.decodeHTML=function(){for(var e=Object.keys(s.default).sort(c),t=Object.keys(i.default).sort(c),n=0,r=0;n<t.length;n++)e[r]===t[n]?(t[n]+=";?",r++):t[n]+=";";var o=new RegExp("&(?:"+t.join("|")+"|#[xX][\\da-fA-F]+;?|#\\d+;?)","g"),a=d(i.default);function l(e){return";"!==e.substr(-1)&&(e+=";"),a(e)}return function(e){return String(e).replace(o,l)}}()},26:function(e,t,n){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var i=r(n(3600));t.default=function(e){if(e>=55296&&e<=57343||e>1114111)return"";e in i.default&&(e=i.default[e]);var t="";return e>65535&&(e-=65536,t+=String.fromCharCode(e>>>10&1023|55296),e=56320|1023&e),t+String.fromCharCode(e)}},7322:function(e,t,n){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.escape=t.encodeHTML=t.encodeXML=void 0;var i=l(r(n(2586)).default),s=c(i);t.encodeXML=h(i,s);var o=l(r(n(9323)).default),a=c(o);function l(e){return Object.keys(e).sort().reduce((function(t,n){return t[e[n]]="&"+n+";",t}),{})}function c(e){for(var t=[],n=[],r=0,i=Object.keys(e);r<i.length;r++){var s=i[r];1===s.length?t.push("\\"+s):n.push(s)}t.sort();for(var o=0;o<t.length-1;o++){for(var a=o;a<t.length-1&&t[a].charCodeAt(1)+1===t[a+1].charCodeAt(1);)a+=1;var l=1+a-o;l<3||t.splice(o,l,t[o]+"-"+t[a])}return n.unshift("["+t.join("")+"]"),new RegExp(n.join("|"),"g")}t.encodeHTML=h(o,a);var d=/(?:[\x80-\uD7FF\uE000-\uFFFF]|[\uD800-\uDBFF][\uDC00-\uDFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF])/g;function u(e){return"&#x"+e.codePointAt(0).toString(16).toUpperCase()+";"}function h(e,t){return function(n){return n.replace(t,(function(t){return e[t]})).replace(d,u)}}var p=c(i);t.escape=function(e){return e.replace(p,u).replace(d,u)}},5863:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.encode=t.decodeStrict=t.decode=void 0;var r=n(4076),i=n(7322);t.decode=function(e,t){return(!t||t<=0?r.decodeXML:r.decodeHTML)(e)},t.decodeStrict=function(e,t){return(!t||t<=0?r.decodeXML:r.decodeHTMLStrict)(e)},t.encode=function(e,t){return(!t||t<=0?i.encodeXML:i.encodeHTML)(e)};var s=n(7322);Object.defineProperty(t,"encodeXML",{enumerable:!0,get:function(){return s.encodeXML}}),Object.defineProperty(t,"encodeHTML",{enumerable:!0,get:function(){return s.encodeHTML}}),Object.defineProperty(t,"escape",{enumerable:!0,get:function(){return s.escape}}),Object.defineProperty(t,"encodeHTML4",{enumerable:!0,get:function(){return s.encodeHTML}}),Object.defineProperty(t,"encodeHTML5",{enumerable:!0,get:function(){return s.encodeHTML}});var o=n(4076);Object.defineProperty(t,"decodeXML",{enumerable:!0,get:function(){return o.decodeXML}}),Object.defineProperty(t,"decodeHTML",{enumerable:!0,get:function(){return o.decodeHTML}}),Object.defineProperty(t,"decodeHTMLStrict",{enumerable:!0,get:function(){return o.decodeHTMLStrict}}),Object.defineProperty(t,"decodeHTML4",{enumerable:!0,get:function(){return o.decodeHTML}}),Object.defineProperty(t,"decodeHTML5",{enumerable:!0,get:function(){return o.decodeHTML}}),Object.defineProperty(t,"decodeHTML4Strict",{enumerable:!0,get:function(){return o.decodeHTMLStrict}}),Object.defineProperty(t,"decodeHTML5Strict",{enumerable:!0,get:function(){return o.decodeHTMLStrict}}),Object.defineProperty(t,"decodeXMLStrict",{enumerable:!0,get:function(){return o.decodeXML}})},7187:e=>{"use strict";var t,n="object"==typeof Reflect?Reflect:null,r=n&&"function"==typeof n.apply?n.apply:function(e,t,n){return Function.prototype.apply.call(e,t,n)};t=n&&"function"==typeof n.ownKeys?n.ownKeys:Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:function(e){return Object.getOwnPropertyNames(e)};var i=Number.isNaN||function(e){return e!=e};function s(){s.init.call(this)}e.exports=s,e.exports.once=function(e,t){return new Promise((function(n,r){function i(n){e.removeListener(t,s),r(n)}function s(){"function"==typeof e.removeListener&&e.removeListener("error",i),n([].slice.call(arguments))}g(e,t,s,{once:!0}),"error"!==t&&function(e,t,n){"function"==typeof e.on&&g(e,"error",t,{once:!0})}(e,i)}))},s.EventEmitter=s,s.prototype._events=void 0,s.prototype._eventsCount=0,s.prototype._maxListeners=void 0;var o=10;function a(e){if("function"!=typeof e)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof e)}function l(e){return void 0===e._maxListeners?s.defaultMaxListeners:e._maxListeners}function c(e,t,n,r){var i,s,o,c;if(a(n),void 0===(s=e._events)?(s=e._events=Object.create(null),e._eventsCount=0):(void 0!==s.newListener&&(e.emit("newListener",t,n.listener?n.listener:n),s=e._events),o=s[t]),void 0===o)o=s[t]=n,++e._eventsCount;else if("function"==typeof o?o=s[t]=r?[n,o]:[o,n]:r?o.unshift(n):o.push(n),(i=l(e))>0&&o.length>i&&!o.warned){o.warned=!0;var d=new Error("Possible EventEmitter memory leak detected. "+o.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit");d.name="MaxListenersExceededWarning",d.emitter=e,d.type=t,d.count=o.length,c=d,console&&console.warn&&console.warn(c)}return e}function d(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function u(e,t,n){var r={fired:!1,wrapFn:void 0,target:e,type:t,listener:n},i=d.bind(r);return i.listener=n,r.wrapFn=i,i}function h(e,t,n){var r=e._events;if(void 0===r)return[];var i=r[t];return void 0===i?[]:"function"==typeof i?n?[i.listener||i]:[i]:n?function(e){for(var t=new Array(e.length),n=0;n<t.length;++n)t[n]=e[n].listener||e[n];return t}(i):m(i,i.length)}function p(e){var t=this._events;if(void 0!==t){var n=t[e];if("function"==typeof n)return 1;if(void 0!==n)return n.length}return 0}function m(e,t){for(var n=new Array(t),r=0;r<t;++r)n[r]=e[r];return n}function g(e,t,n,r){if("function"==typeof e.on)r.once?e.once(t,n):e.on(t,n);else{if("function"!=typeof e.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof e);e.addEventListener(t,(function i(s){r.once&&e.removeEventListener(t,i),n(s)}))}}Object.defineProperty(s,"defaultMaxListeners",{enumerable:!0,get:function(){return o},set:function(e){if("number"!=typeof e||e<0||i(e))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+e+".");o=e}}),s.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},s.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||i(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this},s.prototype.getMaxListeners=function(){return l(this)},s.prototype.emit=function(e){for(var t=[],n=1;n<arguments.length;n++)t.push(arguments[n]);var i="error"===e,s=this._events;if(void 0!==s)i=i&&void 0===s.error;else if(!i)return!1;if(i){var o;if(t.length>0&&(o=t[0]),o instanceof Error)throw o;var a=new Error("Unhandled error."+(o?" ("+o.message+")":""));throw a.context=o,a}var l=s[e];if(void 0===l)return!1;if("function"==typeof l)r(l,this,t);else{var c=l.length,d=m(l,c);for(n=0;n<c;++n)r(d[n],this,t)}return!0},s.prototype.addListener=function(e,t){return c(this,e,t,!1)},s.prototype.on=s.prototype.addListener,s.prototype.prependListener=function(e,t){return c(this,e,t,!0)},s.prototype.once=function(e,t){return a(t),this.on(e,u(this,e,t)),this},s.prototype.prependOnceListener=function(e,t){return a(t),this.prependListener(e,u(this,e,t)),this},s.prototype.removeListener=function(e,t){var n,r,i,s,o;if(a(t),void 0===(r=this._events))return this;if(void 0===(n=r[e]))return this;if(n===t||n.listener===t)0==--this._eventsCount?this._events=Object.create(null):(delete r[e],r.removeListener&&this.emit("removeListener",e,n.listener||t));else if("function"!=typeof n){for(i=-1,s=n.length-1;s>=0;s--)if(n[s]===t||n[s].listener===t){o=n[s].listener,i=s;break}if(i<0)return this;0===i?n.shift():function(e,t){for(;t+1<e.length;t++)e[t]=e[t+1];e.pop()}(n,i),1===n.length&&(r[e]=n[0]),void 0!==r.removeListener&&this.emit("removeListener",e,o||t)}return this},s.prototype.off=s.prototype.removeListener,s.prototype.removeAllListeners=function(e){var t,n,r;if(void 0===(n=this._events))return this;if(void 0===n.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==n[e]&&(0==--this._eventsCount?this._events=Object.create(null):delete n[e]),this;if(0===arguments.length){var i,s=Object.keys(n);for(r=0;r<s.length;++r)"removeListener"!==(i=s[r])&&this.removeAllListeners(i);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(t=n[e]))this.removeListener(e,t);else if(void 0!==t)for(r=t.length-1;r>=0;r--)this.removeListener(e,t[r]);return this},s.prototype.listeners=function(e){return h(this,e,!0)},s.prototype.rawListeners=function(e){return h(this,e,!1)},s.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):p.call(e,t)},s.prototype.listenerCount=p,s.prototype.eventNames=function(){return this._eventsCount>0?t(this._events):[]}},7648:e=>{"use strict";var t="Function.prototype.bind called on incompatible ",n=Array.prototype.slice,r=Object.prototype.toString,i="[object Function]";e.exports=function(e){var s=this;if("function"!=typeof s||r.call(s)!==i)throw new TypeError(t+s);for(var o,a=n.call(arguments,1),l=function(){if(this instanceof o){var t=s.apply(this,a.concat(n.call(arguments)));return Object(t)===t?t:this}return s.apply(e,a.concat(n.call(arguments)))},c=Math.max(0,s.length-a.length),d=[],u=0;u<c;u++)d.push("$"+u);if(o=Function("binder","return function ("+d.join(",")+"){ return binder.apply(this,arguments); }")(l),s.prototype){var h=function(){};h.prototype=s.prototype,o.prototype=new h,h.prototype=null}return o}},8612:(e,t,n)=>{"use strict";var r=n(7648);e.exports=Function.prototype.bind||r},210:(e,t,n)=>{"use strict";var r,i=SyntaxError,s=Function,o=TypeError,a=function(e){try{return s('"use strict"; return ('+e+").constructor;")()}catch(e){}},l=Object.getOwnPropertyDescriptor;if(l)try{l({},"")}catch(e){l=null}var c=function(){throw new o},d=l?function(){try{return c}catch(e){try{return l(arguments,"callee").get}catch(e){return c}}}():c,u=n(1405)(),h=Object.getPrototypeOf||function(e){return e.__proto__},p={},m="undefined"==typeof Uint8Array?r:h(Uint8Array),g={"%AggregateError%":"undefined"==typeof AggregateError?r:AggregateError,"%Array%":Array,"%ArrayBuffer%":"undefined"==typeof ArrayBuffer?r:ArrayBuffer,"%ArrayIteratorPrototype%":u?h([][Symbol.iterator]()):r,"%AsyncFromSyncIteratorPrototype%":r,"%AsyncFunction%":p,"%AsyncGenerator%":p,"%AsyncGeneratorFunction%":p,"%AsyncIteratorPrototype%":p,"%Atomics%":"undefined"==typeof Atomics?r:Atomics,"%BigInt%":"undefined"==typeof BigInt?r:BigInt,"%Boolean%":Boolean,"%DataView%":"undefined"==typeof DataView?r:DataView,"%Date%":Date,"%decodeURI%":decodeURI,"%decodeURIComponent%":decodeURIComponent,"%encodeURI%":encodeURI,"%encodeURIComponent%":encodeURIComponent,"%Error%":Error,"%eval%":eval,"%EvalError%":EvalError,"%Float32Array%":"undefined"==typeof Float32Array?r:Float32Array,"%Float64Array%":"undefined"==typeof Float64Array?r:Float64Array,"%FinalizationRegistry%":"undefined"==typeof FinalizationRegistry?r:FinalizationRegistry,"%Function%":s,"%GeneratorFunction%":p,"%Int8Array%":"undefined"==typeof Int8Array?r:Int8Array,"%Int16Array%":"undefined"==typeof Int16Array?r:Int16Array,"%Int32Array%":"undefined"==typeof Int32Array?r:Int32Array,"%isFinite%":isFinite,"%isNaN%":isNaN,"%IteratorPrototype%":u?h(h([][Symbol.iterator]())):r,"%JSON%":"object"==typeof JSON?JSON:r,"%Map%":"undefined"==typeof Map?r:Map,"%MapIteratorPrototype%":"undefined"!=typeof Map&&u?h((new Map)[Symbol.iterator]()):r,"%Math%":Math,"%Number%":Number,"%Object%":Object,"%parseFloat%":parseFloat,"%parseInt%":parseInt,"%Promise%":"undefined"==typeof Promise?r:Promise,"%Proxy%":"undefined"==typeof Proxy?r:Proxy,"%RangeError%":RangeError,"%ReferenceError%":ReferenceError,"%Reflect%":"undefined"==typeof Reflect?r:Reflect,"%RegExp%":RegExp,"%Set%":"undefined"==typeof Set?r:Set,"%SetIteratorPrototype%":"undefined"!=typeof Set&&u?h((new Set)[Symbol.iterator]()):r,"%SharedArrayBuffer%":"undefined"==typeof SharedArrayBuffer?r:SharedArrayBuffer,"%String%":String,"%StringIteratorPrototype%":u?h(""[Symbol.iterator]()):r,"%Symbol%":u?Symbol:r,"%SyntaxError%":i,"%ThrowTypeError%":d,"%TypedArray%":m,"%TypeError%":o,"%Uint8Array%":"undefined"==typeof Uint8Array?r:Uint8Array,"%Uint8ClampedArray%":"undefined"==typeof Uint8ClampedArray?r:Uint8ClampedArray,"%Uint16Array%":"undefined"==typeof Uint16Array?r:Uint16Array,"%Uint32Array%":"undefined"==typeof Uint32Array?r:Uint32Array,"%URIError%":URIError,"%WeakMap%":"undefined"==typeof WeakMap?r:WeakMap,"%WeakRef%":"undefined"==typeof WeakRef?r:WeakRef,"%WeakSet%":"undefined"==typeof WeakSet?r:WeakSet},f=function e(t){var n;if("%AsyncFunction%"===t)n=a("async function () {}");else if("%GeneratorFunction%"===t)n=a("function* () {}");else if("%AsyncGeneratorFunction%"===t)n=a("async function* () {}");else if("%AsyncGenerator%"===t){var r=e("%AsyncGeneratorFunction%");r&&(n=r.prototype)}else if("%AsyncIteratorPrototype%"===t){var i=e("%AsyncGenerator%");i&&(n=h(i.prototype))}return g[t]=n,n},y={"%ArrayBufferPrototype%":["ArrayBuffer","prototype"],"%ArrayPrototype%":["Array","prototype"],"%ArrayProto_entries%":["Array","prototype","entries"],"%ArrayProto_forEach%":["Array","prototype","forEach"],"%ArrayProto_keys%":["Array","prototype","keys"],"%ArrayProto_values%":["Array","prototype","values"],"%AsyncFunctionPrototype%":["AsyncFunction","prototype"],"%AsyncGenerator%":["AsyncGeneratorFunction","prototype"],"%AsyncGeneratorPrototype%":["AsyncGeneratorFunction","prototype","prototype"],"%BooleanPrototype%":["Boolean","prototype"],"%DataViewPrototype%":["DataView","prototype"],"%DatePrototype%":["Date","prototype"],"%ErrorPrototype%":["Error","prototype"],"%EvalErrorPrototype%":["EvalError","prototype"],"%Float32ArrayPrototype%":["Float32Array","prototype"],"%Float64ArrayPrototype%":["Float64Array","prototype"],"%FunctionPrototype%":["Function","prototype"],"%Generator%":["GeneratorFunction","prototype"],"%GeneratorPrototype%":["GeneratorFunction","prototype","prototype"],"%Int8ArrayPrototype%":["Int8Array","prototype"],"%Int16ArrayPrototype%":["Int16Array","prototype"],"%Int32ArrayPrototype%":["Int32Array","prototype"],"%JSONParse%":["JSON","parse"],"%JSONStringify%":["JSON","stringify"],"%MapPrototype%":["Map","prototype"],"%NumberPrototype%":["Number","prototype"],"%ObjectPrototype%":["Object","prototype"],"%ObjProto_toString%":["Object","prototype","toString"],"%ObjProto_valueOf%":["Object","prototype","valueOf"],"%PromisePrototype%":["Promise","prototype"],"%PromiseProto_then%":["Promise","prototype","then"],"%Promise_all%":["Promise","all"],"%Promise_reject%":["Promise","reject"],"%Promise_resolve%":["Promise","resolve"],"%RangeErrorPrototype%":["RangeError","prototype"],"%ReferenceErrorPrototype%":["ReferenceError","prototype"],"%RegExpPrototype%":["RegExp","prototype"],"%SetPrototype%":["Set","prototype"],"%SharedArrayBufferPrototype%":["SharedArrayBuffer","prototype"],"%StringPrototype%":["String","prototype"],"%SymbolPrototype%":["Symbol","prototype"],"%SyntaxErrorPrototype%":["SyntaxError","prototype"],"%TypedArrayPrototype%":["TypedArray","prototype"],"%TypeErrorPrototype%":["TypeError","prototype"],"%Uint8ArrayPrototype%":["Uint8Array","prototype"],"%Uint8ClampedArrayPrototype%":["Uint8ClampedArray","prototype"],"%Uint16ArrayPrototype%":["Uint16Array","prototype"],"%Uint32ArrayPrototype%":["Uint32Array","prototype"],"%URIErrorPrototype%":["URIError","prototype"],"%WeakMapPrototype%":["WeakMap","prototype"],"%WeakSetPrototype%":["WeakSet","prototype"]},v=n(8612),b=n(7642),w=v.call(Function.call,Array.prototype.concat),S=v.call(Function.apply,Array.prototype.splice),_=v.call(Function.call,String.prototype.replace),k=v.call(Function.call,String.prototype.slice),x=/[^%.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|%$))/g,E=/\\(\\)?/g,T=function(e){var t=k(e,0,1),n=k(e,-1);if("%"===t&&"%"!==n)throw new i("invalid intrinsic syntax, expected closing `%`");if("%"===n&&"%"!==t)throw new i("invalid intrinsic syntax, expected opening `%`");var r=[];return _(e,x,(function(e,t,n,i){r[r.length]=n?_(i,E,"$1"):t||e})),r},C=function(e,t){var n,r=e;if(b(y,r)&&(r="%"+(n=y[r])[0]+"%"),b(g,r)){var s=g[r];if(s===p&&(s=f(r)),void 0===s&&!t)throw new o("intrinsic "+e+" exists, but is not available. Please file an issue!");return{alias:n,name:r,value:s}}throw new i("intrinsic "+e+" does not exist!")};e.exports=function(e,t){if("string"!=typeof e||0===e.length)throw new o("intrinsic name must be a non-empty string");if(arguments.length>1&&"boolean"!=typeof t)throw new o('"allowMissing" argument must be a boolean');var n=T(e),r=n.length>0?n[0]:"",s=C("%"+r+"%",t),a=s.name,c=s.value,d=!1,u=s.alias;u&&(r=u[0],S(n,w([0,1],u)));for(var h=1,p=!0;h<n.length;h+=1){var m=n[h],f=k(m,0,1),y=k(m,-1);if(('"'===f||"'"===f||"`"===f||'"'===y||"'"===y||"`"===y)&&f!==y)throw new i("property names with quotes must have matching quotes");if("constructor"!==m&&p||(d=!0),b(g,a="%"+(r+="."+m)+"%"))c=g[a];else if(null!=c){if(!(m in c)){if(!t)throw new o("base intrinsic for "+e+" exists, but the property is not available.");return}if(l&&h+1>=n.length){var v=l(c,m);c=(p=!!v)&&"get"in v&&!("originalValue"in v.get)?v.get:c[m]}else p=b(c,m),c=c[m];p&&!d&&(g[a]=c)}}return c}},1405:(e,t,n)=>{"use strict";var r="undefined"!=typeof Symbol&&Symbol,i=n(5419);e.exports=function(){return"function"==typeof r&&"function"==typeof Symbol&&"symbol"==typeof r("foo")&&"symbol"==typeof Symbol("bar")&&i()}},5419:e=>{"use strict";e.exports=function(){if("function"!=typeof Symbol||"function"!=typeof Object.getOwnPropertySymbols)return!1;if("symbol"==typeof Symbol.iterator)return!0;var e={},t=Symbol("test"),n=Object(t);if("string"==typeof t)return!1;if("[object Symbol]"!==Object.prototype.toString.call(t))return!1;if("[object Symbol]"!==Object.prototype.toString.call(n))return!1;for(t in e[t]=42,e)return!1;if("function"==typeof Object.keys&&0!==Object.keys(e).length)return!1;if("function"==typeof Object.getOwnPropertyNames&&0!==Object.getOwnPropertyNames(e).length)return!1;var r=Object.getOwnPropertySymbols(e);if(1!==r.length||r[0]!==t)return!1;if(!Object.prototype.propertyIsEnumerable.call(e,t))return!1;if("function"==typeof Object.getOwnPropertyDescriptor){var i=Object.getOwnPropertyDescriptor(e,t);if(42!==i.value||!0!==i.enumerable)return!1}return!0}},7642:(e,t,n)=>{"use strict";var r=n(8612);e.exports=r.call(Function.call,Object.prototype.hasOwnProperty)},3870:function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},r(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),s=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n),Object.defineProperty(e,r,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),o=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),a=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&s(t,e,n);return o(t,e),t},l=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.parseFeed=t.FeedHandler=void 0;var c,d,u=l(n(7915)),h=a(n(9432)),p=n(763);!function(e){e[e.image=0]="image",e[e.audio=1]="audio",e[e.video=2]="video",e[e.document=3]="document",e[e.executable=4]="executable"}(c||(c={})),function(e){e[e.sample=0]="sample",e[e.full=1]="full",e[e.nonstop=2]="nonstop"}(d||(d={}));var m=function(e){function t(t,n){return"object"==typeof t&&(n=t=void 0),e.call(this,t,n)||this}return i(t,e),t.prototype.onend=function(){var e,t,n=y(S,this.dom);if(n){var r={};if("feed"===n.name){var i=n.children;r.type="atom",w(r,"id","id",i),w(r,"title","title",i);var s=b("href",y("link",i));s&&(r.link=s),w(r,"description","subtitle",i),(o=v("updated",i))&&(r.updated=new Date(o)),w(r,"author","email",i,!0),r.items=f("entry",i).map((function(e){var t={},n=e.children;w(t,"id","id",n),w(t,"title","title",n);var r=b("href",y("link",n));r&&(t.link=r);var i=v("summary",n)||v("content",n);i&&(t.description=i);var s=v("updated",n);return s&&(t.pubDate=new Date(s)),t.media=g(n),t}))}else{var o;i=null!==(t=null===(e=y("channel",n.children))||void 0===e?void 0:e.children)&&void 0!==t?t:[],r.type=n.name.substr(0,3),r.id="",w(r,"title","title",i),w(r,"link","link",i),w(r,"description","description",i),(o=v("lastBuildDate",i))&&(r.updated=new Date(o)),w(r,"author","managingEditor",i,!0),r.items=f("item",n.children).map((function(e){var t={},n=e.children;w(t,"id","guid",n),w(t,"title","title",n),w(t,"link","link",n),w(t,"description","description",n);var r=v("pubDate",n);return r&&(t.pubDate=new Date(r)),t.media=g(n),t}))}this.feed=r,this.handleCallback(null)}else this.handleCallback(new Error("couldn't find root of feed"))},t}(u.default);function g(e){return f("media:content",e).map((function(e){var t={medium:e.attribs.medium,isDefault:!!e.attribs.isDefault};return e.attribs.url&&(t.url=e.attribs.url),e.attribs.fileSize&&(t.fileSize=parseInt(e.attribs.fileSize,10)),e.attribs.type&&(t.type=e.attribs.type),e.attribs.expression&&(t.expression=e.attribs.expression),e.attribs.bitrate&&(t.bitrate=parseInt(e.attribs.bitrate,10)),e.attribs.framerate&&(t.framerate=parseInt(e.attribs.framerate,10)),e.attribs.samplingrate&&(t.samplingrate=parseInt(e.attribs.samplingrate,10)),e.attribs.channels&&(t.channels=parseInt(e.attribs.channels,10)),e.attribs.duration&&(t.duration=parseInt(e.attribs.duration,10)),e.attribs.height&&(t.height=parseInt(e.attribs.height,10)),e.attribs.width&&(t.width=parseInt(e.attribs.width,10)),e.attribs.lang&&(t.lang=e.attribs.lang),t}))}function f(e,t){return h.getElementsByTagName(e,t,!0)}function y(e,t){return h.getElementsByTagName(e,t,!0,1)[0]}function v(e,t,n){return void 0===n&&(n=!1),h.getText(h.getElementsByTagName(e,t,n,1)).trim()}function b(e,t){return t?t.attribs[e]:null}function w(e,t,n,r,i){void 0===i&&(i=!1);var s=v(n,r,i);s&&(e[t]=s)}function S(e){return"rss"===e||"feed"===e||"rdf:RDF"===e}t.FeedHandler=m,t.parseFeed=function(e,t){void 0===t&&(t={xmlMode:!0});var n=new m(t);return new p.Parser(n,t).end(e),n.feed}},763:function(e,t,n){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.Parser=void 0;var i=r(n(9889)),s=new Set(["input","option","optgroup","select","button","datalist","textarea"]),o=new Set(["p"]),a={tr:new Set(["tr","th","td"]),th:new Set(["th"]),td:new Set(["thead","th","td"]),body:new Set(["head","link","script"]),li:new Set(["li"]),p:o,h1:o,h2:o,h3:o,h4:o,h5:o,h6:o,select:s,input:s,output:s,button:s,datalist:s,textarea:s,option:new Set(["option"]),optgroup:new Set(["optgroup","option"]),dd:new Set(["dt","dd"]),dt:new Set(["dt","dd"]),address:o,article:o,aside:o,blockquote:o,details:o,div:o,dl:o,fieldset:o,figcaption:o,figure:o,footer:o,form:o,header:o,hr:o,main:o,nav:o,ol:o,pre:o,section:o,table:o,ul:o,rt:new Set(["rt","rp"]),rp:new Set(["rt","rp"]),tbody:new Set(["thead","tbody"]),tfoot:new Set(["thead","tbody"])},l=new Set(["area","base","basefont","br","col","command","embed","frame","hr","img","input","isindex","keygen","link","meta","param","source","track","wbr"]),c=new Set(["math","svg"]),d=new Set(["mi","mo","mn","ms","mtext","annotation-xml","foreignObject","desc","title"]),u=/\s|\//,h=function(){function e(e,t){var n,r,s,o,a;void 0===t&&(t={}),this.startIndex=0,this.endIndex=null,this.tagname="",this.attribname="",this.attribvalue="",this.attribs=null,this.stack=[],this.foreignContext=[],this.options=t,this.cbs=null!=e?e:{},this.lowerCaseTagNames=null!==(n=t.lowerCaseTags)&&void 0!==n?n:!t.xmlMode,this.lowerCaseAttributeNames=null!==(r=t.lowerCaseAttributeNames)&&void 0!==r?r:!t.xmlMode,this.tokenizer=new(null!==(s=t.Tokenizer)&&void 0!==s?s:i.default)(this.options,this),null===(a=(o=this.cbs).onparserinit)||void 0===a||a.call(o,this)}return e.prototype.updatePosition=function(e){null===this.endIndex?this.tokenizer.sectionStart<=e?this.startIndex=0:this.startIndex=this.tokenizer.sectionStart-e:this.startIndex=this.endIndex+1,this.endIndex=this.tokenizer.getAbsoluteIndex()},e.prototype.ontext=function(e){var t,n;this.updatePosition(1),this.endIndex--,null===(n=(t=this.cbs).ontext)||void 0===n||n.call(t,e)},e.prototype.onopentagname=function(e){var t,n;if(this.lowerCaseTagNames&&(e=e.toLowerCase()),this.tagname=e,!this.options.xmlMode&&Object.prototype.hasOwnProperty.call(a,e))for(var r=void 0;this.stack.length>0&&a[e].has(r=this.stack[this.stack.length-1]);)this.onclosetag(r);!this.options.xmlMode&&l.has(e)||(this.stack.push(e),c.has(e)?this.foreignContext.push(!0):d.has(e)&&this.foreignContext.push(!1)),null===(n=(t=this.cbs).onopentagname)||void 0===n||n.call(t,e),this.cbs.onopentag&&(this.attribs={})},e.prototype.onopentagend=function(){var e,t;this.updatePosition(1),this.attribs&&(null===(t=(e=this.cbs).onopentag)||void 0===t||t.call(e,this.tagname,this.attribs),this.attribs=null),!this.options.xmlMode&&this.cbs.onclosetag&&l.has(this.tagname)&&this.cbs.onclosetag(this.tagname),this.tagname=""},e.prototype.onclosetag=function(e){if(this.updatePosition(1),this.lowerCaseTagNames&&(e=e.toLowerCase()),(c.has(e)||d.has(e))&&this.foreignContext.pop(),!this.stack.length||!this.options.xmlMode&&l.has(e))this.options.xmlMode||"br"!==e&&"p"!==e||(this.onopentagname(e),this.closeCurrentTag());else{var t=this.stack.lastIndexOf(e);if(-1!==t)if(this.cbs.onclosetag)for(t=this.stack.length-t;t--;)this.cbs.onclosetag(this.stack.pop());else this.stack.length=t;else"p"!==e||this.options.xmlMode||(this.onopentagname(e),this.closeCurrentTag())}},e.prototype.onselfclosingtag=function(){this.options.xmlMode||this.options.recognizeSelfClosing||this.foreignContext[this.foreignContext.length-1]?this.closeCurrentTag():this.onopentagend()},e.prototype.closeCurrentTag=function(){var e,t,n=this.tagname;this.onopentagend(),this.stack[this.stack.length-1]===n&&(null===(t=(e=this.cbs).onclosetag)||void 0===t||t.call(e,n),this.stack.pop())},e.prototype.onattribname=function(e){this.lowerCaseAttributeNames&&(e=e.toLowerCase()),this.attribname=e},e.prototype.onattribdata=function(e){this.attribvalue+=e},e.prototype.onattribend=function(e){var t,n;null===(n=(t=this.cbs).onattribute)||void 0===n||n.call(t,this.attribname,this.attribvalue,e),this.attribs&&!Object.prototype.hasOwnProperty.call(this.attribs,this.attribname)&&(this.attribs[this.attribname]=this.attribvalue),this.attribname="",this.attribvalue=""},e.prototype.getInstructionName=function(e){var t=e.search(u),n=t<0?e:e.substr(0,t);return this.lowerCaseTagNames&&(n=n.toLowerCase()),n},e.prototype.ondeclaration=function(e){if(this.cbs.onprocessinginstruction){var t=this.getInstructionName(e);this.cbs.onprocessinginstruction("!"+t,"!"+e)}},e.prototype.onprocessinginstruction=function(e){if(this.cbs.onprocessinginstruction){var t=this.getInstructionName(e);this.cbs.onprocessinginstruction("?"+t,"?"+e)}},e.prototype.oncomment=function(e){var t,n,r,i;this.updatePosition(4),null===(n=(t=this.cbs).oncomment)||void 0===n||n.call(t,e),null===(i=(r=this.cbs).oncommentend)||void 0===i||i.call(r)},e.prototype.oncdata=function(e){var t,n,r,i,s,o;this.updatePosition(1),this.options.xmlMode||this.options.recognizeCDATA?(null===(n=(t=this.cbs).oncdatastart)||void 0===n||n.call(t),null===(i=(r=this.cbs).ontext)||void 0===i||i.call(r,e),null===(o=(s=this.cbs).oncdataend)||void 0===o||o.call(s)):this.oncomment("[CDATA["+e+"]]")},e.prototype.onerror=function(e){var t,n;null===(n=(t=this.cbs).onerror)||void 0===n||n.call(t,e)},e.prototype.onend=function(){var e,t;if(this.cbs.onclosetag)for(var n=this.stack.length;n>0;this.cbs.onclosetag(this.stack[--n]));null===(t=(e=this.cbs).onend)||void 0===t||t.call(e)},e.prototype.reset=function(){var e,t,n,r;null===(t=(e=this.cbs).onreset)||void 0===t||t.call(e),this.tokenizer.reset(),this.tagname="",this.attribname="",this.attribs=null,this.stack=[],null===(r=(n=this.cbs).onparserinit)||void 0===r||r.call(n,this)},e.prototype.parseComplete=function(e){this.reset(),this.end(e)},e.prototype.write=function(e){this.tokenizer.write(e)},e.prototype.end=function(e){this.tokenizer.end(e)},e.prototype.pause=function(){this.tokenizer.pause()},e.prototype.resume=function(){this.tokenizer.resume()},e.prototype.parseChunk=function(e){this.write(e)},e.prototype.done=function(e){this.end(e)},e}();t.Parser=h},9889:function(e,t,n){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var i=r(n(26)),s=r(n(9323)),o=r(n(9591)),a=r(n(2586));function l(e){return" "===e||"\n"===e||"\t"===e||"\f"===e||"\r"===e}function c(e){return e>="a"&&e<="z"||e>="A"&&e<="Z"}function d(e,t,n){var r=e.toLowerCase();return e===r?function(e,i){i===r?e._state=t:(e._state=n,e._index--)}:function(i,s){s===r||s===e?i._state=t:(i._state=n,i._index--)}}function u(e,t){var n=e.toLowerCase();return function(r,i){i===n||i===e?r._state=t:(r._state=3,r._index--)}}var h=d("C",24,16),p=d("D",25,16),m=d("A",26,16),g=d("T",27,16),f=d("A",28,16),y=u("R",35),v=u("I",36),b=u("P",37),w=u("T",38),S=d("R",40,1),_=d("I",41,1),k=d("P",42,1),x=d("T",43,1),E=u("Y",45),T=u("L",46),C=u("E",47),A=d("Y",49,1),I=d("L",50,1),R=d("E",51,1),O=u("I",54),P=u("T",55),M=u("L",56),D=u("E",57),L=d("I",58,1),F=d("T",59,1),N=d("L",60,1),j=d("E",61,1),U=d("#",63,64),B=d("X",66,65),q=function(){function e(e,t){var n;this._state=1,this.buffer="",this.sectionStart=0,this._index=0,this.bufferOffset=0,this.baseState=1,this.special=1,this.running=!0,this.ended=!1,this.cbs=t,this.xmlMode=!!(null==e?void 0:e.xmlMode),this.decodeEntities=null===(n=null==e?void 0:e.decodeEntities)||void 0===n||n}return e.prototype.reset=function(){this._state=1,this.buffer="",this.sectionStart=0,this._index=0,this.bufferOffset=0,this.baseState=1,this.special=1,this.running=!0,this.ended=!1},e.prototype.write=function(e){this.ended&&this.cbs.onerror(Error(".write() after done!")),this.buffer+=e,this.parse()},e.prototype.end=function(e){this.ended&&this.cbs.onerror(Error(".end() after done!")),e&&this.write(e),this.ended=!0,this.running&&this.finish()},e.prototype.pause=function(){this.running=!1},e.prototype.resume=function(){this.running=!0,this._index<this.buffer.length&&this.parse(),this.ended&&this.finish()},e.prototype.getAbsoluteIndex=function(){return this.bufferOffset+this._index},e.prototype.stateText=function(e){"<"===e?(this._index>this.sectionStart&&this.cbs.ontext(this.getSection()),this._state=2,this.sectionStart=this._index):!this.decodeEntities||"&"!==e||1!==this.special&&4!==this.special||(this._index>this.sectionStart&&this.cbs.ontext(this.getSection()),this.baseState=1,this._state=62,this.sectionStart=this._index)},e.prototype.isTagStartChar=function(e){return c(e)||this.xmlMode&&!l(e)&&"/"!==e&&">"!==e},e.prototype.stateBeforeTagName=function(e){"/"===e?this._state=5:"<"===e?(this.cbs.ontext(this.getSection()),this.sectionStart=this._index):">"===e||1!==this.special||l(e)?this._state=1:"!"===e?(this._state=15,this.sectionStart=this._index+1):"?"===e?(this._state=17,this.sectionStart=this._index+1):this.isTagStartChar(e)?(this._state=this.xmlMode||"s"!==e&&"S"!==e?this.xmlMode||"t"!==e&&"T"!==e?3:52:32,this.sectionStart=this._index):this._state=1},e.prototype.stateInTagName=function(e){("/"===e||">"===e||l(e))&&(this.emitToken("onopentagname"),this._state=8,this._index--)},e.prototype.stateBeforeClosingTagName=function(e){l(e)||(">"===e?this._state=1:1!==this.special?4===this.special||"s"!==e&&"S"!==e?4!==this.special||"t"!==e&&"T"!==e?(this._state=1,this._index--):this._state=53:this._state=33:this.isTagStartChar(e)?(this._state=6,this.sectionStart=this._index):(this._state=20,this.sectionStart=this._index))},e.prototype.stateInClosingTagName=function(e){(">"===e||l(e))&&(this.emitToken("onclosetag"),this._state=7,this._index--)},e.prototype.stateAfterClosingTagName=function(e){">"===e&&(this._state=1,this.sectionStart=this._index+1)},e.prototype.stateBeforeAttributeName=function(e){">"===e?(this.cbs.onopentagend(),this._state=1,this.sectionStart=this._index+1):"/"===e?this._state=4:l(e)||(this._state=9,this.sectionStart=this._index)},e.prototype.stateInSelfClosingTag=function(e){">"===e?(this.cbs.onselfclosingtag(),this._state=1,this.sectionStart=this._index+1,this.special=1):l(e)||(this._state=8,this._index--)},e.prototype.stateInAttributeName=function(e){("="===e||"/"===e||">"===e||l(e))&&(this.cbs.onattribname(this.getSection()),this.sectionStart=-1,this._state=10,this._index--)},e.prototype.stateAfterAttributeName=function(e){"="===e?this._state=11:"/"===e||">"===e?(this.cbs.onattribend(void 0),this._state=8,this._index--):l(e)||(this.cbs.onattribend(void 0),this._state=9,this.sectionStart=this._index)},e.prototype.stateBeforeAttributeValue=function(e){'"'===e?(this._state=12,this.sectionStart=this._index+1):"'"===e?(this._state=13,this.sectionStart=this._index+1):l(e)||(this._state=14,this.sectionStart=this._index,this._index--)},e.prototype.handleInAttributeValue=function(e,t){e===t?(this.emitToken("onattribdata"),this.cbs.onattribend(t),this._state=8):this.decodeEntities&&"&"===e&&(this.emitToken("onattribdata"),this.baseState=this._state,this._state=62,this.sectionStart=this._index)},e.prototype.stateInAttributeValueDoubleQuotes=function(e){this.handleInAttributeValue(e,'"')},e.prototype.stateInAttributeValueSingleQuotes=function(e){this.handleInAttributeValue(e,"'")},e.prototype.stateInAttributeValueNoQuotes=function(e){l(e)||">"===e?(this.emitToken("onattribdata"),this.cbs.onattribend(null),this._state=8,this._index--):this.decodeEntities&&"&"===e&&(this.emitToken("onattribdata"),this.baseState=this._state,this._state=62,this.sectionStart=this._index)},e.prototype.stateBeforeDeclaration=function(e){this._state="["===e?23:"-"===e?18:16},e.prototype.stateInDeclaration=function(e){">"===e&&(this.cbs.ondeclaration(this.getSection()),this._state=1,this.sectionStart=this._index+1)},e.prototype.stateInProcessingInstruction=function(e){">"===e&&(this.cbs.onprocessinginstruction(this.getSection()),this._state=1,this.sectionStart=this._index+1)},e.prototype.stateBeforeComment=function(e){"-"===e?(this._state=19,this.sectionStart=this._index+1):this._state=16},e.prototype.stateInComment=function(e){"-"===e&&(this._state=21)},e.prototype.stateInSpecialComment=function(e){">"===e&&(this.cbs.oncomment(this.buffer.substring(this.sectionStart,this._index)),this._state=1,this.sectionStart=this._index+1)},e.prototype.stateAfterComment1=function(e){this._state="-"===e?22:19},e.prototype.stateAfterComment2=function(e){">"===e?(this.cbs.oncomment(this.buffer.substring(this.sectionStart,this._index-2)),this._state=1,this.sectionStart=this._index+1):"-"!==e&&(this._state=19)},e.prototype.stateBeforeCdata6=function(e){"["===e?(this._state=29,this.sectionStart=this._index+1):(this._state=16,this._index--)},e.prototype.stateInCdata=function(e){"]"===e&&(this._state=30)},e.prototype.stateAfterCdata1=function(e){this._state="]"===e?31:29},e.prototype.stateAfterCdata2=function(e){">"===e?(this.cbs.oncdata(this.buffer.substring(this.sectionStart,this._index-2)),this._state=1,this.sectionStart=this._index+1):"]"!==e&&(this._state=29)},e.prototype.stateBeforeSpecialS=function(e){"c"===e||"C"===e?this._state=34:"t"===e||"T"===e?this._state=44:(this._state=3,this._index--)},e.prototype.stateBeforeSpecialSEnd=function(e){2!==this.special||"c"!==e&&"C"!==e?3!==this.special||"t"!==e&&"T"!==e?this._state=1:this._state=48:this._state=39},e.prototype.stateBeforeSpecialLast=function(e,t){("/"===e||">"===e||l(e))&&(this.special=t),this._state=3,this._index--},e.prototype.stateAfterSpecialLast=function(e,t){">"===e||l(e)?(this.special=1,this._state=6,this.sectionStart=this._index-t,this._index--):this._state=1},e.prototype.parseFixedEntity=function(e){if(void 0===e&&(e=this.xmlMode?a.default:s.default),this.sectionStart+1<this._index){var t=this.buffer.substring(this.sectionStart+1,this._index);Object.prototype.hasOwnProperty.call(e,t)&&(this.emitPartial(e[t]),this.sectionStart=this._index+1)}},e.prototype.parseLegacyEntity=function(){for(var e=this.sectionStart+1,t=Math.min(this._index-e,6);t>=2;){var n=this.buffer.substr(e,t);if(Object.prototype.hasOwnProperty.call(o.default,n))return this.emitPartial(o.default[n]),void(this.sectionStart+=t+1);t--}},e.prototype.stateInNamedEntity=function(e){";"===e?(this.parseFixedEntity(),1===this.baseState&&this.sectionStart+1<this._index&&!this.xmlMode&&this.parseLegacyEntity(),this._state=this.baseState):(e<"0"||e>"9")&&!c(e)&&(this.xmlMode||this.sectionStart+1===this._index||(1!==this.baseState?"="!==e&&this.parseFixedEntity(o.default):this.parseLegacyEntity()),this._state=this.baseState,this._index--)},e.prototype.decodeNumericEntity=function(e,t,n){var r=this.sectionStart+e;if(r!==this._index){var s=this.buffer.substring(r,this._index),o=parseInt(s,t);this.emitPartial(i.default(o)),this.sectionStart=n?this._index+1:this._index}this._state=this.baseState},e.prototype.stateInNumericEntity=function(e){";"===e?this.decodeNumericEntity(2,10,!0):(e<"0"||e>"9")&&(this.xmlMode?this._state=this.baseState:this.decodeNumericEntity(2,10,!1),this._index--)},e.prototype.stateInHexEntity=function(e){";"===e?this.decodeNumericEntity(3,16,!0):(e<"a"||e>"f")&&(e<"A"||e>"F")&&(e<"0"||e>"9")&&(this.xmlMode?this._state=this.baseState:this.decodeNumericEntity(3,16,!1),this._index--)},e.prototype.cleanup=function(){this.sectionStart<0?(this.buffer="",this.bufferOffset+=this._index,this._index=0):this.running&&(1===this._state?(this.sectionStart!==this._index&&this.cbs.ontext(this.buffer.substr(this.sectionStart)),this.buffer="",this.bufferOffset+=this._index,this._index=0):this.sectionStart===this._index?(this.buffer="",this.bufferOffset+=this._index,this._index=0):(this.buffer=this.buffer.substr(this.sectionStart),this._index-=this.sectionStart,this.bufferOffset+=this.sectionStart),this.sectionStart=0)},e.prototype.parse=function(){for(;this._index<this.buffer.length&&this.running;){var e=this.buffer.charAt(this._index);1===this._state?this.stateText(e):12===this._state?this.stateInAttributeValueDoubleQuotes(e):9===this._state?this.stateInAttributeName(e):19===this._state?this.stateInComment(e):20===this._state?this.stateInSpecialComment(e):8===this._state?this.stateBeforeAttributeName(e):3===this._state?this.stateInTagName(e):6===this._state?this.stateInClosingTagName(e):2===this._state?this.stateBeforeTagName(e):10===this._state?this.stateAfterAttributeName(e):13===this._state?this.stateInAttributeValueSingleQuotes(e):11===this._state?this.stateBeforeAttributeValue(e):5===this._state?this.stateBeforeClosingTagName(e):7===this._state?this.stateAfterClosingTagName(e):32===this._state?this.stateBeforeSpecialS(e):21===this._state?this.stateAfterComment1(e):14===this._state?this.stateInAttributeValueNoQuotes(e):4===this._state?this.stateInSelfClosingTag(e):16===this._state?this.stateInDeclaration(e):15===this._state?this.stateBeforeDeclaration(e):22===this._state?this.stateAfterComment2(e):18===this._state?this.stateBeforeComment(e):33===this._state?this.stateBeforeSpecialSEnd(e):53===this._state?L(this,e):39===this._state?S(this,e):40===this._state?_(this,e):41===this._state?k(this,e):34===this._state?y(this,e):35===this._state?v(this,e):36===this._state?b(this,e):37===this._state?w(this,e):38===this._state?this.stateBeforeSpecialLast(e,2):42===this._state?x(this,e):43===this._state?this.stateAfterSpecialLast(e,6):44===this._state?E(this,e):29===this._state?this.stateInCdata(e):45===this._state?T(this,e):46===this._state?C(this,e):47===this._state?this.stateBeforeSpecialLast(e,3):48===this._state?A(this,e):49===this._state?I(this,e):50===this._state?R(this,e):51===this._state?this.stateAfterSpecialLast(e,5):52===this._state?O(this,e):54===this._state?P(this,e):55===this._state?M(this,e):56===this._state?D(this,e):57===this._state?this.stateBeforeSpecialLast(e,4):58===this._state?F(this,e):59===this._state?N(this,e):60===this._state?j(this,e):61===this._state?this.stateAfterSpecialLast(e,5):17===this._state?this.stateInProcessingInstruction(e):64===this._state?this.stateInNamedEntity(e):23===this._state?h(this,e):62===this._state?U(this,e):24===this._state?p(this,e):25===this._state?m(this,e):30===this._state?this.stateAfterCdata1(e):31===this._state?this.stateAfterCdata2(e):26===this._state?g(this,e):27===this._state?f(this,e):28===this._state?this.stateBeforeCdata6(e):66===this._state?this.stateInHexEntity(e):65===this._state?this.stateInNumericEntity(e):63===this._state?B(this,e):this.cbs.onerror(Error("unknown _state"),this._state),this._index++}this.cleanup()},e.prototype.finish=function(){this.sectionStart<this._index&&this.handleTrailingData(),this.cbs.onend()},e.prototype.handleTrailingData=function(){var e=this.buffer.substr(this.sectionStart);29===this._state||30===this._state||31===this._state?this.cbs.oncdata(e):19===this._state||21===this._state||22===this._state?this.cbs.oncomment(e):64!==this._state||this.xmlMode?65!==this._state||this.xmlMode?66!==this._state||this.xmlMode?3!==this._state&&8!==this._state&&11!==this._state&&10!==this._state&&9!==this._state&&13!==this._state&&12!==this._state&&14!==this._state&&6!==this._state&&this.cbs.ontext(e):(this.decodeNumericEntity(3,16,!1),this.sectionStart<this._index&&(this._state=this.baseState,this.handleTrailingData())):(this.decodeNumericEntity(2,10,!1),this.sectionStart<this._index&&(this._state=this.baseState,this.handleTrailingData())):(this.parseLegacyEntity(),this.sectionStart<this._index&&(this._state=this.baseState,this.handleTrailingData()))},e.prototype.getSection=function(){return this.buffer.substring(this.sectionStart,this._index)},e.prototype.emitToken=function(e){this.cbs[e](this.getSection()),this.sectionStart=-1},e.prototype.emitPartial=function(e){1!==this.baseState?this.cbs.onattribdata(e):this.cbs.ontext(e)},e}();t.default=q},3719:function(e,t,n){"use strict";var r=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n),Object.defineProperty(e,r,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),s=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&r(t,e,n);return i(t,e),t},o=this&&this.__exportStar||function(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||r(t,e,n)},a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.RssHandler=t.DefaultHandler=t.DomUtils=t.ElementType=t.Tokenizer=t.createDomStream=t.parseDOM=t.parseDocument=t.DomHandler=t.Parser=void 0;var l=n(763);Object.defineProperty(t,"Parser",{enumerable:!0,get:function(){return l.Parser}});var c=n(7915);function d(e,t){var n=new c.DomHandler(void 0,t);return new l.Parser(n,t).end(e),n.root}Object.defineProperty(t,"DomHandler",{enumerable:!0,get:function(){return c.DomHandler}}),Object.defineProperty(t,"DefaultHandler",{enumerable:!0,get:function(){return c.DomHandler}}),t.parseDocument=d,t.parseDOM=function(e,t){return d(e,t).children},t.createDomStream=function(e,t,n){var r=new c.DomHandler(e,t,n);return new l.Parser(r,t)};var u=n(9889);Object.defineProperty(t,"Tokenizer",{enumerable:!0,get:function(){return a(u).default}});var h=s(n(9960));t.ElementType=h,o(n(3870),t),t.DomUtils=s(n(9432));var p=n(3870);Object.defineProperty(t,"RssHandler",{enumerable:!0,get:function(){return p.FeedHandler}})},645:(e,t)=>{t.read=function(e,t,n,r,i){var s,o,a=8*i-r-1,l=(1<<a)-1,c=l>>1,d=-7,u=n?i-1:0,h=n?-1:1,p=e[t+u];for(u+=h,s=p&(1<<-d)-1,p>>=-d,d+=a;d>0;s=256*s+e[t+u],u+=h,d-=8);for(o=s&(1<<-d)-1,s>>=-d,d+=r;d>0;o=256*o+e[t+u],u+=h,d-=8);if(0===s)s=1-c;else{if(s===l)return o?NaN:1/0*(p?-1:1);o+=Math.pow(2,r),s-=c}return(p?-1:1)*o*Math.pow(2,s-r)},t.write=function(e,t,n,r,i,s){var o,a,l,c=8*s-i-1,d=(1<<c)-1,u=d>>1,h=23===i?Math.pow(2,-24)-Math.pow(2,-77):0,p=r?0:s-1,m=r?1:-1,g=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(a=isNaN(t)?1:0,o=d):(o=Math.floor(Math.log(t)/Math.LN2),t*(l=Math.pow(2,-o))<1&&(o--,l*=2),(t+=o+u>=1?h/l:h*Math.pow(2,1-u))*l>=2&&(o++,l/=2),o+u>=d?(a=0,o=d):o+u>=1?(a=(t*l-1)*Math.pow(2,i),o+=u):(a=t*Math.pow(2,u-1)*Math.pow(2,i),o=0));i>=8;e[n+p]=255&a,p+=m,a/=256,i-=8);for(o=o<<i|a,c+=i;c>0;e[n+p]=255&o,p+=m,o/=256,c-=8);e[n+p-m]|=128*g}},6057:(e,t)=>{"use strict";function n(e){return"[object Object]"===Object.prototype.toString.call(e)}Object.defineProperty(t,"__esModule",{value:!0}),t.isPlainObject=function(e){var t,r;return!1!==n(e)&&(void 0===(t=e.constructor)||!1!==n(r=t.prototype)&&!1!==r.hasOwnProperty("isPrototypeOf"))}},2043:function(e,t,n){var r,i;!function(s,o){"use strict";r=function(){var e=function(){},t="undefined",n=typeof window!==t&&typeof window.navigator!==t&&/Trident\/|MSIE /.test(window.navigator.userAgent),r=["trace","debug","info","warn","error"];function i(e,t){var n=e[t];if("function"==typeof n.bind)return n.bind(e);try{return Function.prototype.bind.call(n,e)}catch(t){return function(){return Function.prototype.apply.apply(n,[e,arguments])}}}function s(){console.log&&(console.log.apply?console.log.apply(console,arguments):Function.prototype.apply.apply(console.log,[console,arguments])),console.trace&&console.trace()}function o(r){return"debug"===r&&(r="log"),typeof console!==t&&("trace"===r&&n?s:void 0!==console[r]?i(console,r):void 0!==console.log?i(console,"log"):e)}function a(t,n){for(var i=0;i<r.length;i++){var s=r[i];this[s]=i<t?e:this.methodFactory(s,t,n)}this.log=this.debug}function l(e,n,r){return function(){typeof console!==t&&(a.call(this,n,r),this[e].apply(this,arguments))}}function c(e,t,n){return o(e)||l.apply(this,arguments)}function d(e,n,i){var s,o=this;n=null==n?"WARN":n;var l="loglevel";function d(){var e;if(typeof window!==t&&l){try{e=window.localStorage[l]}catch(e){}if(typeof e===t)try{var n=window.document.cookie,r=n.indexOf(encodeURIComponent(l)+"=");-1!==r&&(e=/^([^;]+)/.exec(n.slice(r))[1])}catch(e){}return void 0===o.levels[e]&&(e=void 0),e}}"string"==typeof e?l+=":"+e:"symbol"==typeof e&&(l=void 0),o.name=e,o.levels={TRACE:0,DEBUG:1,INFO:2,WARN:3,ERROR:4,SILENT:5},o.methodFactory=i||c,o.getLevel=function(){return s},o.setLevel=function(n,i){if("string"==typeof n&&void 0!==o.levels[n.toUpperCase()]&&(n=o.levels[n.toUpperCase()]),!("number"==typeof n&&n>=0&&n<=o.levels.SILENT))throw"log.setLevel() called with invalid level: "+n;if(s=n,!1!==i&&function(e){var n=(r[e]||"silent").toUpperCase();if(typeof window!==t&&l){try{return void(window.localStorage[l]=n)}catch(e){}try{window.document.cookie=encodeURIComponent(l)+"="+n+";"}catch(e){}}}(n),a.call(o,n,e),typeof console===t&&n<o.levels.SILENT)return"No console available for logging"},o.setDefaultLevel=function(e){n=e,d()||o.setLevel(e,!1)},o.resetLevel=function(){o.setLevel(n,!1),function(){if(typeof window!==t&&l){try{return void window.localStorage.removeItem(l)}catch(e){}try{window.document.cookie=encodeURIComponent(l)+"=; expires=Thu, 01 Jan 1970 00:00:00 UTC"}catch(e){}}}()},o.enableAll=function(e){o.setLevel(o.levels.TRACE,e)},o.disableAll=function(e){o.setLevel(o.levels.SILENT,e)};var u=d();null==u&&(u=n),o.setLevel(u,!1)}var u=new d,h={};u.getLogger=function(e){if("symbol"!=typeof e&&"string"!=typeof e||""===e)throw new TypeError("You must supply a name when creating a logger.");var t=h[e];return t||(t=h[e]=new d(e,u.getLevel(),u.methodFactory)),t};var p=typeof window!==t?window.log:void 0;return u.noConflict=function(){return typeof window!==t&&window.log===u&&(window.log=p),u},u.getLoggers=function(){return h},u.default=u,u},void 0===(i=r.call(t,n,t,e))||(e.exports=i)}()},686:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ExtensibleEvents=void 0;var r=n(5998),i=n(1940),s=n(5617),o=n(4600),a=n(6931),l=n(3637),c=n(5492);function d(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function u(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function h(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var p=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),h(this,"interpreters",new r.NamespacedMap([[s.LEGACY_M_ROOM_MESSAGE,s.parseMRoomMessage],[a.M_MESSAGE,o.parseMMessage],[a.M_EMOTE,o.parseMMessage],[a.M_NOTICE,o.parseMMessage],[l.M_POLL_START,c.parseMPoll],[l.M_POLL_RESPONSE,c.parseMPoll],[l.M_POLL_END,c.parseMPoll]])),h(this,"_unknownInterpretOrder",[a.M_MESSAGE])}var t,n,p;return t=e,p=[{key:"defaultInstance",get:function(){return e._defaultInstance}},{key:"unknownInterpretOrder",get:function(){return e.defaultInstance.unknownInterpretOrder},set:function(t){e.defaultInstance.unknownInterpretOrder=t}},{key:"registerInterpreter",value:function(t,n){e.defaultInstance.registerInterpreter(t,n)}},{key:"parse",value:function(t){return e.defaultInstance.parse(t)}}],(n=[{key:"unknownInterpretOrder",get:function(){var e;return null!==(e=this._unknownInterpretOrder)&&void 0!==e?e:[]},set:function(e){this._unknownInterpretOrder=e}},{key:"registerInterpreter",value:function(e,t){this.interpreters.set(e,t)}},{key:"parse",value:function(e){try{if(this.interpreters.hasNamespaced(e.type))return this.interpreters.getNamespaced(e.type)(e);var t,n=function(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return d(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?d(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var s,o=!0,a=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){a=!0,s=e},f:function(){try{o||null==n.return||n.return()}finally{if(a)throw s}}}}(this.unknownInterpretOrder);try{for(n.s();!(t=n.n()).done;){var r=t.value;if(this.interpreters.has(r)){var s=this.interpreters.get(r)(e);if(s)return s}}}catch(e){n.e(e)}finally{n.f()}return null}catch(e){if(e instanceof i.InvalidEventError)return null;throw e}}}])&&u(t.prototype,n),p&&u(t,p),Object.defineProperty(t,"prototype",{writable:!1}),e}();t.ExtensibleEvents=p,h(p,"_defaultInstance",new p)},2508:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0})},1940:(e,t)=>{"use strict";function n(e){return n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n(e)}function r(e,t){if(t&&("object"===n(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function i(e){var t="function"==typeof Map?new Map:void 0;return i=function(e){if(null===e||(n=e,-1===Function.toString.call(n).indexOf("[native code]")))return e;var n;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,r)}function r(){return s(e,arguments,l(this).constructor)}return r.prototype=Object.create(e.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}}),a(r,e)},i(e)}function s(e,t,n){return s=o()?Reflect.construct:function(e,t,n){var r=[null];r.push.apply(r,t);var i=new(Function.bind.apply(e,r));return n&&a(i,n.prototype),i},s.apply(null,arguments)}function o(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}function a(e,t){return a=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},a(e,t)}function l(e){return l=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},l(e)}Object.defineProperty(t,"__esModule",{value:!0}),t.InvalidEventError=void 0;var c=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&a(e,t)}(c,e);var t,n,i,s=(t=c,n=o(),function(){var e,i=l(t);if(n){var s=l(this).constructor;e=Reflect.construct(i,arguments,s)}else e=i.apply(this,arguments);return r(this,e)});function c(e){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,c),s.call(this,e)}return i=c,Object.defineProperty(i,"prototype",{writable:!1}),i}(i(Error));t.InvalidEventError=c},5998:(e,t)=>{"use strict";function n(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}Object.defineProperty(t,"__esModule",{value:!0}),t.NamespacedMap=void 0;var i=function(){function e(t){var r,i,s;if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),r=this,i="internalMap",s=new Map,i in r?Object.defineProperty(r,i,{value:s,enumerable:!0,configurable:!0,writable:!0}):r[i]=s,t){var o,a=function(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(e){if("string"==typeof e)return n(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?n(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var i=0,s=function(){};return{s,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:s}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,l=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return a=e.done,e},e:function(e){l=!0,o=e},f:function(){try{a||null==r.return||r.return()}finally{if(l)throw o}}}}(t);try{for(a.s();!(o=a.n()).done;){var l=o.value;this.set(l[0],l[1])}}catch(e){a.e(e)}finally{a.f()}}}var t,i;return t=e,(i=[{key:"get",value:function(e){return e.name&&this.internalMap.has(e.name)?this.internalMap.get(e.name):e.altName&&this.internalMap.has(e.altName)?this.internalMap.get(e.altName):null}},{key:"set",value:function(e,t){e.name&&this.internalMap.set(e.name,t),e.altName&&this.internalMap.set(e.altName,t)}},{key:"has",value:function(e){return!!this.get(e)}},{key:"delete",value:function(e){e.name&&this.internalMap.delete(e.name),e.altName&&this.internalMap.delete(e.altName)}},{key:"hasNamespaced",value:function(e){return this.internalMap.has(e)}},{key:"getNamespaced",value:function(e){return this.internalMap.get(e)}}])&&r(t.prototype,i),Object.defineProperty(t,"prototype",{writable:!1}),e}();t.NamespacedMap=i},4355:(e,t)=>{"use strict";function n(e){return n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n(e)}function r(e,t){return r=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},r(e,t)}function i(e,t){if(t&&("object"===n(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function s(e){return s=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},s(e)}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function l(e,t,n){return t&&a(e.prototype,t),n&&a(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}Object.defineProperty(t,"__esModule",{value:!0}),t.UnstableValue=t.NamespacedValue=void 0;var c=function(){function e(t,n){if(o(this,e),this.stable=t,this.unstable=n,!this.unstable&&!this.stable)throw new Error("One of stable or unstable values must be supplied")}return l(e,[{key:"name",get:function(){return this.stable?this.stable:this.unstable}},{key:"altName",get:function(){return this.stable?this.unstable:null}},{key:"matches",value:function(e){return!!this.name&&this.name===e||!!this.altName&&this.altName===e}},{key:"findIn",value:function(e){var t;return this.name&&(t=null==e?void 0:e[this.name]),!t&&this.altName&&(t=null==e?void 0:e[this.altName]),t}},{key:"includedIn",value:function(e){var t=!1;return this.name&&(t=e.includes(this.name)),!t&&this.altName&&(t=e.includes(this.altName)),t}}]),e}();t.NamespacedValue=c;var d=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&r(e,t)}(c,e);var t,n,a=(t=c,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,r=s(t);if(n){var o=s(this).constructor;e=Reflect.construct(r,arguments,o)}else e=r.apply(this,arguments);return i(this,e)});function c(e,t){var n;if(o(this,c),!(n=a.call(this,e,t)).unstable)throw new Error("Unstable value must be supplied");return n}return l(c,[{key:"name",get:function(){return this.unstable}},{key:"altName",get:function(){return this.stable}}]),c}(c);t.UnstableValue=d},4449:(e,t,n)=>{"use strict";function r(e){return r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r(e)}Object.defineProperty(t,"__esModule",{value:!0}),t.EmoteEvent=void 0;var i=n(3240),s=n(6931),o=n(8472);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function l(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function c(){return c="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=d(e,t);if(r){var i=Object.getOwnPropertyDescriptor(r,t);return i.get?i.get.call(arguments.length<3?e:n):i.value}},c.apply(this,arguments)}function d(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=p(e)););return e}function u(e,t){return u=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},u(e,t)}function h(e,t){if(t&&("object"===r(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function p(e){return p=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},p(e)}var m=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&u(e,t)}(g,e);var t,n,r,i,d,m=(i=g,d=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=p(i);if(d){var n=p(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return h(this,e)});function g(e){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,g),m.call(this,e)}return t=g,r=[{key:"from",value:function(e,t){var n;return new g({type:s.M_EMOTE.name,content:(n={},a(n,s.M_TEXT.name,e),a(n,s.M_HTML.name,t),n)})}}],(n=[{key:"isEmote",get:function(){return!0}},{key:"isEquivalentTo",value:function(e){return(0,o.isEventTypeSame)(e,s.M_EMOTE)||c(p(g.prototype),"isEquivalentTo",this).call(this,e)}},{key:"serialize",value:function(){var e=c(p(g.prototype),"serialize",this).call(this);return e.content.msgtype="m.emote",e}}])&&l(t.prototype,n),r&&l(t,r),Object.defineProperty(t,"prototype",{writable:!1}),g}(i.MessageEvent);t.EmoteEvent=m},2869:(e,t)=>{"use strict";function n(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}Object.defineProperty(t,"__esModule",{value:!0}),t.ExtensibleEvent=void 0;var r=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.wireFormat=t}var t,r;return t=e,(r=[{key:"wireContent",get:function(){return this.wireFormat.content}}])&&n(t.prototype,r),Object.defineProperty(t,"prototype",{writable:!1}),e}();t.ExtensibleEvent=r},3240:(e,t,n)=>{"use strict";function r(e){return r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r(e)}Object.defineProperty(t,"__esModule",{value:!0}),t.MessageEvent=void 0;var i=n(2869),s=n(2932),o=n(1940),a=n(6931),l=n(8472);function c(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function d(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?c(Object(n),!0).forEach((function(t){f(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):c(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function u(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function h(e,t){return h=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},h(e,t)}function p(e,t){if(t&&("object"===r(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return m(e)}function m(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function g(e){return g=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},g(e)}function f(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var y=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&h(e,t)}(v,e);var t,n,r,i,c,y=(i=v,c=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=g(i);if(c){var n=g(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return p(this,e)});function v(e){var t;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,v),f(m(t=y.call(this,e)),"text",void 0),f(m(t),"html",void 0),f(m(t),"renderings",void 0);var n=a.M_MESSAGE.findIn(t.wireContent),r=a.M_TEXT.findIn(t.wireContent),i=a.M_HTML.findIn(t.wireContent);if((0,s.isProvided)(n)){if(!Array.isArray(n))throw new o.InvalidEventError("m.message contents must be an array");var l=n.find((function(e){return!(0,s.isProvided)(e.mimetype)||"text/plain"===e.mimetype})),c=n.find((function(e){return"text/html"===e.mimetype}));if(!l)throw new o.InvalidEventError("m.message is missing a plain text representation");t.text=l.body,t.html=null==c?void 0:c.body,t.renderings=n}else{if(!(0,s.isOptionalAString)(r))throw new o.InvalidEventError("Missing textual representation for event");t.text=r,t.html=i,t.renderings=[{body:r,mimetype:"text/plain"}],t.html&&t.renderings.push({body:t.html,mimetype:"text/html"})}return t}return t=v,r=[{key:"from",value:function(e,t){var n;return new v({type:a.M_MESSAGE.name,content:(n={},f(n,a.M_TEXT.name,e),f(n,a.M_HTML.name,t),n)})}}],(n=[{key:"isEmote",get:function(){return a.M_EMOTE.matches(this.wireFormat.type)||(0,s.isProvided)(a.M_EMOTE.findIn(this.wireFormat.content))}},{key:"isNotice",get:function(){return a.M_NOTICE.matches(this.wireFormat.type)||(0,s.isProvided)(a.M_NOTICE.findIn(this.wireFormat.content))}},{key:"isEquivalentTo",value:function(e){return(0,l.isEventTypeSame)(e,a.M_MESSAGE)}},{key:"serializeMMessageOnly",value:function(){var e=f({},a.M_MESSAGE.name,this.renderings);if(1===this.renderings.length){var t=this.renderings[0].mimetype;void 0!==t&&"text/plain"!==t||(e=f({},a.M_TEXT.name,this.renderings[0].body))}return e}},{key:"serialize",value:function(){var e;return{type:"m.room.message",content:d(d({},this.serializeMMessageOnly()),{},{body:this.text,msgtype:"m.text",format:this.html?"org.matrix.custom.html":void 0,formatted_body:null!==(e=this.html)&&void 0!==e?e:void 0})}}}])&&u(t.prototype,n),r&&u(t,r),Object.defineProperty(t,"prototype",{writable:!1}),v}(i.ExtensibleEvent);t.MessageEvent=y},4808:(e,t,n)=>{"use strict";function r(e){return r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r(e)}Object.defineProperty(t,"__esModule",{value:!0}),t.NoticeEvent=void 0;var i=n(3240),s=n(6931),o=n(8472);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function l(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function c(){return c="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=d(e,t);if(r){var i=Object.getOwnPropertyDescriptor(r,t);return i.get?i.get.call(arguments.length<3?e:n):i.value}},c.apply(this,arguments)}function d(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=p(e)););return e}function u(e,t){return u=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},u(e,t)}function h(e,t){if(t&&("object"===r(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function p(e){return p=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},p(e)}var m=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&u(e,t)}(g,e);var t,n,r,i,d,m=(i=g,d=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=p(i);if(d){var n=p(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return h(this,e)});function g(e){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,g),m.call(this,e)}return t=g,r=[{key:"from",value:function(e,t){var n;return new g({type:s.M_NOTICE.name,content:(n={},a(n,s.M_TEXT.name,e),a(n,s.M_HTML.name,t),n)})}}],(n=[{key:"isNotice",get:function(){return!0}},{key:"isEquivalentTo",value:function(e){return(0,o.isEventTypeSame)(e,s.M_NOTICE)||c(p(g.prototype),"isEquivalentTo",this).call(this,e)}},{key:"serialize",value:function(){var e=c(p(g.prototype),"serialize",this).call(this);return e.content.msgtype="m.notice",e}}])&&l(t.prototype,n),r&&l(t,r),Object.defineProperty(t,"prototype",{writable:!1}),g}(i.MessageEvent);t.NoticeEvent=m},5510:(e,t,n)=>{"use strict";function r(e){return r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r(e)}Object.defineProperty(t,"__esModule",{value:!0}),t.PollEndEvent=void 0;var i=n(3637),s=n(1940),o=n(1210),a=n(3240),l=n(6931),c=n(8472);function d(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function u(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?d(Object(n),!0).forEach((function(t){y(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):d(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function h(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function p(e,t){return p=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},p(e,t)}function m(e,t){if(t&&("object"===r(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return g(e)}function g(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function f(e){return f=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},f(e)}function y(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var v=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&p(e,t)}(w,e);var t,n,r,d,v,b=(d=w,v=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=f(d);if(v){var n=f(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return m(this,e)});function w(e){var t;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,w),y(g(t=b.call(this,e)),"pollEventId",void 0),y(g(t),"closingMessage",void 0);var n=t.wireContent["m.relates_to"];if(!o.REFERENCE_RELATION.matches(null==n?void 0:n.rel_type)||"string"!=typeof(null==n?void 0:n.event_id))throw new s.InvalidEventError("Relationship must be a reference to an event");return t.pollEventId=n.event_id,t.closingMessage=new a.MessageEvent(t.wireFormat),t}return t=w,r=[{key:"from",value:function(e,t){var n;return new w({type:i.M_POLL_END.name,content:(n={"m.relates_to":{rel_type:o.REFERENCE_RELATION.name,event_id:e}},y(n,i.M_POLL_END.name,{}),y(n,l.M_TEXT.name,t),n)})}}],(n=[{key:"isEquivalentTo",value:function(e){return(0,c.isEventTypeSame)(e,i.M_POLL_END)}},{key:"serialize",value:function(){return{type:i.M_POLL_END.name,content:u(y({"m.relates_to":{rel_type:o.REFERENCE_RELATION.name,event_id:this.pollEventId}},i.M_POLL_END.name,{}),this.closingMessage.serialize().content)}}}])&&h(t.prototype,n),r&&h(t,r),Object.defineProperty(t,"prototype",{writable:!1}),w}(n(2869).ExtensibleEvent);t.PollEndEvent=v},4648:(e,t,n)=>{"use strict";function r(e){return r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r(e)}Object.defineProperty(t,"__esModule",{value:!0}),t.PollResponseEvent=void 0;var i=n(2869),s=n(3637),o=n(1940),a=n(1210),l=n(8472);function c(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function d(e,t){return d=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},d(e,t)}function u(e,t){if(t&&("object"===r(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return h(e)}function h(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function p(e){return p=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},p(e)}function m(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var g=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&d(e,t)}(y,e);var t,n,r,i,g,f=(i=y,g=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=p(i);if(g){var n=p(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return u(this,e)});function y(e){var t;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,y),m(h(t=f.call(this,e)),"internalAnswerIds",void 0),m(h(t),"internalSpoiled",void 0),m(h(t),"pollEventId",void 0);var n=t.wireContent["m.relates_to"];if(!a.REFERENCE_RELATION.matches(null==n?void 0:n.rel_type)||"string"!=typeof(null==n?void 0:n.event_id))throw new o.InvalidEventError("Relationship must be a reference to an event");return t.pollEventId=n.event_id,t.validateAgainst(null),t}return t=y,r=[{key:"from",value:function(e,t){return new y({type:s.M_POLL_RESPONSE.name,content:m({"m.relates_to":{rel_type:a.REFERENCE_RELATION.name,event_id:t}},s.M_POLL_RESPONSE.name,{answers:e})})}}],(n=[{key:"answerIds",get:function(){return this.internalAnswerIds}},{key:"spoiled",get:function(){return this.internalSpoiled}},{key:"validateAgainst",value:function(e){var t=s.M_POLL_RESPONSE.findIn(this.wireContent);if(!Array.isArray(null==t?void 0:t.answers))return this.internalSpoiled=!0,void(this.internalAnswerIds=[]);var n=t.answers;if(n.some((function(e){return"string"!=typeof e}))||0===n.length)return this.internalSpoiled=!0,void(this.internalAnswerIds=[]);if(e){if(n.some((function(t){return!e.answers.some((function(e){return e.id===t}))})))return this.internalSpoiled=!0,void(this.internalAnswerIds=[]);n=n.slice(0,e.maxSelections)}this.internalAnswerIds=n,this.internalSpoiled=!1}},{key:"isEquivalentTo",value:function(e){return(0,l.isEventTypeSame)(e,s.M_POLL_RESPONSE)}},{key:"serialize",value:function(){return{type:s.M_POLL_RESPONSE.name,content:m({"m.relates_to":{rel_type:a.REFERENCE_RELATION.name,event_id:this.pollEventId}},s.M_POLL_RESPONSE.name,{answers:this.spoiled?void 0:this.answerIds})}}}])&&c(t.prototype,n),r&&c(t,r),Object.defineProperty(t,"prototype",{writable:!1}),y}(i.ExtensibleEvent);t.PollResponseEvent=g},8267:(e,t,n)=>{"use strict";function r(e){return r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r(e)}Object.defineProperty(t,"__esModule",{value:!0}),t.PollStartEvent=t.PollAnswerSubevent=void 0;var i=n(3637),s=n(3240),o=n(6931),a=n(1940),l=n(4355),c=n(8472),d=n(2869);function u(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function h(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function p(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?h(Object(n),!0).forEach((function(t){k(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):h(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function m(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function g(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function f(e,t,n){return t&&g(e.prototype,t),n&&g(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function y(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&v(e,t)}function v(e,t){return v=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},v(e,t)}function b(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=_(e);if(t){var i=_(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return w(this,n)}}function w(e,t){if(t&&("object"===r(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return S(e)}function S(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _(e){return _=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},_(e)}function k(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var x=function(e){y(n,e);var t=b(n);function n(e){var r;m(this,n),k(S(r=t.call(this,e)),"id",void 0);var i=e.content.id;if(!i||"string"!=typeof i)throw new a.InvalidEventError("Answer ID must be a non-empty string");return r.id=i,r}return f(n,[{key:"serialize",value:function(){return{type:"org.matrix.sdk.poll.answer",content:p({id:this.id},this.serializeMMessageOnly())}}}],[{key:"from",value:function(e,t){return new n({type:"org.matrix.sdk.poll.answer",content:k({id:e},o.M_TEXT.name,t)})}}]),n}(s.MessageEvent);t.PollAnswerSubevent=x;var E=function(e){y(n,e);var t=b(n);function n(e){var r;m(this,n),k(S(r=t.call(this,e)),"question",void 0),k(S(r),"kind",void 0),k(S(r),"rawKind",void 0),k(S(r),"maxSelections",void 0),k(S(r),"answers",void 0);var o=i.M_POLL_START.findIn(r.wireContent);if(!o.question)throw new a.InvalidEventError("A question is required");if(r.question=new s.MessageEvent({type:"org.matrix.sdk.poll.question",content:o.question}),r.rawKind=o.kind,i.M_POLL_KIND_DISCLOSED.matches(r.rawKind)?r.kind=i.M_POLL_KIND_DISCLOSED:r.kind=i.M_POLL_KIND_UNDISCLOSED,r.maxSelections=Number.isFinite(o.max_selections)&&o.max_selections>0?o.max_selections:1,!Array.isArray(o.answers))throw new a.InvalidEventError("Poll answers must be an array");var l=o.answers.slice(0,20).map((function(e){return new x({type:"org.matrix.sdk.poll.answer",content:e})}));if(l.length<=0)throw new a.InvalidEventError("No answers available");return r.answers=l,r}return f(n,[{key:"isEquivalentTo",value:function(e){return(0,c.isEventTypeSame)(e,i.M_POLL_START)}},{key:"serialize",value:function(){var e;return{type:i.M_POLL_START.name,content:(e={},k(e,i.M_POLL_START.name,{question:this.question.serialize().content,kind:this.rawKind,max_selections:this.maxSelections,answers:this.answers.map((function(e){return e.serialize().content}))}),k(e,o.M_TEXT.name,"".concat(this.question.text,"\n").concat(this.answers.map((function(e,t){return"".concat(t+1,". ").concat(e.text)})).join("\n"))),e)}}}],[{key:"from",value:function(e,t,r){var s,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;return new n({type:i.M_POLL_START.name,content:(s={},k(s,o.M_TEXT.name,e),k(s,i.M_POLL_START.name,{question:k({},o.M_TEXT.name,e),kind:r instanceof l.NamespacedValue?r.name:r,max_selections:a,answers:t.map((function(e){return k({id:C()},o.M_TEXT.name,e)}))}),s)})}}]),n}(d.ExtensibleEvent);t.PollStartEvent=E;var T="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789";function C(){return(e=Array(16),function(e){if(Array.isArray(e))return u(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(e){if("string"==typeof e)return u(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?u(e,t):void 0}}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()).map((function(){return T.charAt(Math.floor(Math.random()*T.length))})).join("");var e}},6931:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.M_TEXT=t.M_NOTICE=t.M_MESSAGE=t.M_HTML=t.M_EMOTE=void 0;var r=n(4355),i=new r.UnstableValue("m.message","org.matrix.msc1767.message");t.M_MESSAGE=i;var s=new r.UnstableValue("m.text","org.matrix.msc1767.text");t.M_TEXT=s;var o=new r.UnstableValue("m.html","org.matrix.msc1767.html");t.M_HTML=o;var a=new r.UnstableValue("m.emote","org.matrix.msc1767.emote");t.M_EMOTE=a;var l=new r.UnstableValue("m.notice","org.matrix.msc1767.notice");t.M_NOTICE=l},3637:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.M_POLL_START=t.M_POLL_RESPONSE=t.M_POLL_KIND_UNDISCLOSED=t.M_POLL_KIND_DISCLOSED=t.M_POLL_END=void 0;var r=n(4355),i=new r.UnstableValue("m.poll.disclosed","org.matrix.msc3381.poll.disclosed");t.M_POLL_KIND_DISCLOSED=i;var s=new r.UnstableValue("m.poll.undisclosed","org.matrix.msc3381.poll.undisclosed");t.M_POLL_KIND_UNDISCLOSED=s;var o=new r.UnstableValue("m.poll.start","org.matrix.msc3381.poll.start");t.M_POLL_START=o;var a=new r.UnstableValue("m.poll.response","org.matrix.msc3381.poll.response");t.M_POLL_RESPONSE=a;var l=new r.UnstableValue("m.poll.end","org.matrix.msc3381.poll.end");t.M_POLL_END=l},1210:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.REFERENCE_RELATION=void 0;var r=new(n(4355).NamespacedValue)("m.reference");t.REFERENCE_RELATION=r},1333:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(686);Object.keys(r).forEach((function(e){"default"!==e&&"__esModule"!==e&&(e in t&&t[e]===r[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return r[e]}}))}));var i=n(2508);Object.keys(i).forEach((function(e){"default"!==e&&"__esModule"!==e&&(e in t&&t[e]===i[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return i[e]}}))}));var s=n(1940);Object.keys(s).forEach((function(e){"default"!==e&&"__esModule"!==e&&(e in t&&t[e]===s[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return s[e]}}))}));var o=n(4355);Object.keys(o).forEach((function(e){"default"!==e&&"__esModule"!==e&&(e in t&&t[e]===o[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return o[e]}}))}));var a=n(5998);Object.keys(a).forEach((function(e){"default"!==e&&"__esModule"!==e&&(e in t&&t[e]===a[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return a[e]}}))}));var l=n(2932);Object.keys(l).forEach((function(e){"default"!==e&&"__esModule"!==e&&(e in t&&t[e]===l[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return l[e]}}))}));var c=n(2117);Object.keys(c).forEach((function(e){"default"!==e&&"__esModule"!==e&&(e in t&&t[e]===c[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return c[e]}}))}));var d=n(8472);Object.keys(d).forEach((function(e){"default"!==e&&"__esModule"!==e&&(e in t&&t[e]===d[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return d[e]}}))}));var u=n(5617);Object.keys(u).forEach((function(e){"default"!==e&&"__esModule"!==e&&(e in t&&t[e]===u[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return u[e]}}))}));var h=n(4600);Object.keys(h).forEach((function(e){"default"!==e&&"__esModule"!==e&&(e in t&&t[e]===h[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return h[e]}}))}));var p=n(5492);Object.keys(p).forEach((function(e){"default"!==e&&"__esModule"!==e&&(e in t&&t[e]===p[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return p[e]}}))}));var m=n(1210);Object.keys(m).forEach((function(e){"default"!==e&&"__esModule"!==e&&(e in t&&t[e]===m[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return m[e]}}))}));var g=n(2869);Object.keys(g).forEach((function(e){"default"!==e&&"__esModule"!==e&&(e in t&&t[e]===g[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return g[e]}}))}));var f=n(6931);Object.keys(f).forEach((function(e){"default"!==e&&"__esModule"!==e&&(e in t&&t[e]===f[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return f[e]}}))}));var y=n(3240);Object.keys(y).forEach((function(e){"default"!==e&&"__esModule"!==e&&(e in t&&t[e]===y[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return y[e]}}))}));var v=n(4449);Object.keys(v).forEach((function(e){"default"!==e&&"__esModule"!==e&&(e in t&&t[e]===v[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return v[e]}}))}));var b=n(4808);Object.keys(b).forEach((function(e){"default"!==e&&"__esModule"!==e&&(e in t&&t[e]===b[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return b[e]}}))}));var w=n(3637);Object.keys(w).forEach((function(e){"default"!==e&&"__esModule"!==e&&(e in t&&t[e]===w[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return w[e]}}))}));var S=n(8267);Object.keys(S).forEach((function(e){"default"!==e&&"__esModule"!==e&&(e in t&&t[e]===S[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return S[e]}}))}));var _=n(4648);Object.keys(_).forEach((function(e){"default"!==e&&"__esModule"!==e&&(e in t&&t[e]===_[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return _[e]}}))}));var k=n(5510);Object.keys(k).forEach((function(e){"default"!==e&&"__esModule"!==e&&(e in t&&t[e]===k[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return k[e]}}))}))},5617:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LEGACY_M_ROOM_MESSAGE=void 0,t.parseMRoomMessage=function(e){var t,n,o;if(a.M_MESSAGE.findIn(e.content)||a.M_TEXT.findIn(e.content))return new r.MessageEvent(e);var l,u,h,p=null===(t=e.content)||void 0===t?void 0:t.msgtype,m=null===(n=e.content)||void 0===n?void 0:n.body,g="org.matrix.custom.html"===(null===(o=e.content)||void 0===o?void 0:o.format)?e.content.formatted_body:null;return"m.text"===p?new r.MessageEvent(c(c({},e),{},{content:c(c({},e.content),{},(l={},d(l,a.M_TEXT.name,m),d(l,a.M_HTML.name,g),l))})):"m.notice"===p?new i.NoticeEvent(c(c({},e),{},{content:c(c({},e.content),{},(u={},d(u,a.M_TEXT.name,m),d(u,a.M_HTML.name,g),u))})):"m.emote"===p?new s.EmoteEvent(c(c({},e),{},{content:c(c({},e.content),{},(h={},d(h,a.M_TEXT.name,m),d(h,a.M_HTML.name,g),h))})):null};var r=n(3240),i=n(4808),s=n(4449),o=n(4355),a=n(6931);function l(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function c(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?l(Object(n),!0).forEach((function(t){d(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):l(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function d(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var u=new o.NamespacedValue("m.room.message");t.LEGACY_M_ROOM_MESSAGE=u},4600:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.parseMMessage=function(e){return i.M_EMOTE.matches(e.type)?new s.EmoteEvent(e):i.M_NOTICE.matches(e.type)?new o.NoticeEvent(e):new r.MessageEvent(e)};var r=n(3240),i=n(6931),s=n(4449),o=n(4808)},5492:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.parseMPoll=function(e){return r.M_POLL_START.matches(e.type)?new i.PollStartEvent(e):r.M_POLL_RESPONSE.matches(e.type)?new s.PollResponseEvent(e):r.M_POLL_END.matches(e.type)?new o.PollEndEvent(e):null};var r=n(3637),i=n(8267),s=n(4648),o=n(5510)},2932:(e,t)=>{"use strict";function n(e){return null!=e}Object.defineProperty(t,"__esModule",{value:!0}),t.isOptionalAString=function(e){return n(e)&&"string"==typeof e},t.isProvided=n},2117:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LegacyMsgType=void 0,t.isEventLike=function(e,t){var n=e.content;return t===r.Text?i.M_MESSAGE.matches(e.type)||"m.room.message"===e.type&&"m.text"===(null==n?void 0:n.msgtype):t===r.Emote?i.M_EMOTE.matches(e.type)||"m.room.message"===e.type&&"m.emote"===(null==n?void 0:n.msgtype):t===r.Notice&&(i.M_NOTICE.matches(e.type)||"m.room.message"===e.type&&"m.notice"===(null==n?void 0:n.msgtype))};var r,i=n(6931);t.LegacyMsgType=r,function(e){e.Text="m.text",e.Notice="m.notice",e.Emote="m.emote"}(r||(t.LegacyMsgType=r={}))},8472:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isEventTypeSame=function(e,t){if("string"==typeof e)return"string"==typeof t?t===e:t.matches(e);if("string"==typeof t)return e.matches(t);var n=t,r=e;return n.matches(r.name)||n.matches(r.altName)}},1470:(e,t)=>{"use strict";let n,r,i,s,o,a;Object.defineProperty(t,"__esModule",{value:!0}),t.TweakName=t.RuleId=t.PushRuleKind=t.PushRuleActionName=t.DMMemberCountCondition=t.ConditionOperator=t.ConditionKind=void 0,t.isDmMemberCountCondition=function(e){return"==2"===e||"2"===e},t.PushRuleActionName=n,function(e){e.DontNotify="dont_notify",e.Notify="notify",e.Coalesce="coalesce"}(n||(t.PushRuleActionName=n={})),t.TweakName=r,function(e){e.Highlight="highlight",e.Sound="sound"}(r||(t.TweakName=r={})),t.ConditionOperator=i,function(e){e.ExactEquals="==",e.LessThan="<",e.GreaterThan=">",e.GreaterThanOrEqual=">=",e.LessThanOrEqual="<="}(i||(t.ConditionOperator=i={})),t.DMMemberCountCondition="2",t.ConditionKind=s,function(e){e.EventMatch="event_match",e.ContainsDisplayName="contains_display_name",e.RoomMemberCount="room_member_count",e.SenderNotificationPermission="sender_notification_permission"}(s||(t.ConditionKind=s={})),t.PushRuleKind=o,function(e){e.Override="override",e.ContentSpecific="content",e.RoomSpecific="room",e.SenderSpecific="sender",e.Underride="underride"}(o||(t.PushRuleKind=o={})),t.RuleId=a,function(e){e.Master=".m.rule.master",e.ContainsDisplayName=".m.rule.contains_display_name",e.ContainsUserName=".m.rule.contains_user_name",e.AtRoomNotification=".m.rule.roomnotif",e.DM=".m.rule.room_one_to_one",e.EncryptedDM=".m.rule.encrypted_room_one_to_one",e.Message=".m.rule.message",e.EncryptedMessage=".m.rule.encrypted",e.InviteToSelf=".m.rule.invite_for_me",e.MemberEvent=".m.rule.member_event",e.IncomingCall=".m.rule.call",e.SuppressNotices=".m.rule.suppress_notices",e.Tombstone=".m.rule.tombstone"}(a||(t.RuleId=a={}))},2481:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.UNSTABLE_MSC3089_TREE_SUBTYPE=t.UNSTABLE_MSC3089_LEAF=t.UNSTABLE_MSC3089_BRANCH=t.UNSTABLE_MSC3088_PURPOSE=t.UNSTABLE_MSC3088_ENABLED=t.UNSTABLE_ELEMENT_FUNCTIONAL_USERS=t.RoomType=t.RoomCreateTypeField=t.RelationType=t.MsgType=t.EventType=t.EVENT_VISIBILITY_CHANGE_TYPE=void 0;var r=n(7048);let i,s,o,a;t.EventType=i,function(e){e.RoomCanonicalAlias="m.room.canonical_alias",e.RoomCreate="m.room.create",e.RoomJoinRules="m.room.join_rules",e.RoomMember="m.room.member",e.RoomThirdPartyInvite="m.room.third_party_invite",e.RoomPowerLevels="m.room.power_levels",e.RoomName="m.room.name",e.RoomTopic="m.room.topic",e.RoomAvatar="m.room.avatar",e.RoomPinnedEvents="m.room.pinned_events",e.RoomEncryption="m.room.encryption",e.RoomHistoryVisibility="m.room.history_visibility",e.RoomGuestAccess="m.room.guest_access",e.RoomServerAcl="m.room.server_acl",e.RoomTombstone="m.room.tombstone",e.RoomAliases="m.room.aliases",e.SpaceChild="m.space.child",e.SpaceParent="m.space.parent",e.RoomRedaction="m.room.redaction",e.RoomMessage="m.room.message",e.RoomMessageEncrypted="m.room.encrypted",e.Sticker="m.sticker",e.CallInvite="m.call.invite",e.CallCandidates="m.call.candidates",e.CallAnswer="m.call.answer",e.CallHangup="m.call.hangup",e.CallReject="m.call.reject",e.CallSelectAnswer="m.call.select_answer",e.CallNegotiate="m.call.negotiate",e.CallSDPStreamMetadataChanged="m.call.sdp_stream_metadata_changed",e.CallSDPStreamMetadataChangedPrefix="org.matrix.call.sdp_stream_metadata_changed",e.CallReplaces="m.call.replaces",e.CallAssertedIdentity="m.call.asserted_identity",e.CallAssertedIdentityPrefix="org.matrix.call.asserted_identity",e.KeyVerificationRequest="m.key.verification.request",e.KeyVerificationStart="m.key.verification.start",e.KeyVerificationCancel="m.key.verification.cancel",e.KeyVerificationMac="m.key.verification.mac",e.KeyVerificationDone="m.key.verification.done",e.RoomMessageFeedback="m.room.message.feedback",e.Reaction="m.reaction",e.Typing="m.typing",e.Receipt="m.receipt",e.Presence="m.presence",e.FullyRead="m.fully_read",e.Tag="m.tag",e.SpaceOrder="org.matrix.msc3230.space_order",e.PushRules="m.push_rules",e.Direct="m.direct",e.IgnoredUserList="m.ignored_user_list",e.RoomKey="m.room_key",e.RoomKeyRequest="m.room_key_request",e.ForwardedRoomKey="m.forwarded_room_key",e.Dummy="m.dummy"}(i||(t.EventType=i={})),t.RelationType=s,function(e){e.Annotation="m.annotation",e.Replace="m.replace",e.Thread="io.element.thread"}(s||(t.RelationType=s={})),t.MsgType=o,function(e){e.Text="m.text",e.Emote="m.emote",e.Notice="m.notice",e.Image="m.image",e.File="m.file",e.Audio="m.audio",e.Location="m.location",e.Video="m.video",e.KeyVerificationRequest="m.key.verification.request"}(o||(t.MsgType=o={})),t.RoomCreateTypeField="type",t.RoomType=a,function(e){e.Space="m.space"}(a||(t.RoomType=a={}));const l=new r.UnstableValue("m.room.purpose","org.matrix.msc3088.purpose");t.UNSTABLE_MSC3088_PURPOSE=l;const c=new r.UnstableValue("m.enabled","org.matrix.msc3088.enabled");t.UNSTABLE_MSC3088_ENABLED=c;const d=new r.UnstableValue("m.data_tree","org.matrix.msc3089.data_tree");t.UNSTABLE_MSC3089_TREE_SUBTYPE=d;const u=new r.UnstableValue("m.leaf","org.matrix.msc3089.leaf");t.UNSTABLE_MSC3089_LEAF=u;const h=new r.UnstableValue("m.branch","org.matrix.msc3089.branch");t.UNSTABLE_MSC3089_BRANCH=h;const p=new r.UnstableValue("io.element.functional_members","io.element.functional_members");t.UNSTABLE_ELEMENT_FUNCTIONAL_USERS=p;const m=new r.UnstableValue("m.visibility","org.matrix.msc3531.visibility");t.EVENT_VISIBILITY_CHANGE_TYPE=m},6548:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TEXT_NODE_TYPE=void 0;const r=new(n(7048).UnstableValue)("m.text","org.matrix.msc1767.text");t.TEXT_NODE_TYPE=r},6709:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TIMESTAMP_NODE_TYPE=t.LOCATION_EVENT_TYPE=t.ASSET_TYPE_SELF=t.ASSET_NODE_TYPE=void 0;var r=n(7048);n(6548);const i=new r.UnstableValue("m.location","org.matrix.msc3488.location");t.LOCATION_EVENT_TYPE=i;const s=new r.UnstableValue("m.asset","org.matrix.msc3488.asset");t.ASSET_NODE_TYPE=s;const o=new r.UnstableValue("m.ts","org.matrix.msc3488.ts");t.TIMESTAMP_NODE_TYPE=o,t.ASSET_TYPE_SELF="m.self"},4702:(e,t)=>{"use strict";let n,r,i,s,o,a;Object.defineProperty(t,"__esModule",{value:!0}),t.Visibility=t.RestrictedAllowType=t.Preset=t.JoinRule=t.HistoryVisibility=t.GuestAccess=void 0,t.Visibility=n,function(e){e.Public="public",e.Private="private"}(n||(t.Visibility=n={})),t.Preset=r,function(e){e.PrivateChat="private_chat",e.TrustedPrivateChat="trusted_private_chat",e.PublicChat="public_chat"}(r||(t.Preset=r={})),t.JoinRule=i,function(e){e.Public="public",e.Invite="invite",e.Private="private",e.Knock="knock",e.Restricted="restricted"}(i||(t.JoinRule=i={})),t.RestrictedAllowType=s,function(e){e.RoomMembership="m.room_membership"}(s||(t.RestrictedAllowType=s={})),t.GuestAccess=o,function(e){e.CanJoin="can_join",e.Forbidden="forbidden"}(o||(t.GuestAccess=o={})),t.HistoryVisibility=a,function(e){e.Invited="invited",e.Joined="joined",e.Shared="shared",e.WorldReadable="world_readable"}(a||(t.HistoryVisibility=a={}))},6513:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0})},9162:(e,t)=>{"use strict";var n;let r;Object.defineProperty(t,"__esModule",{value:!0}),t.SearchOrderBy=void 0,function(e){e.RoomId="room_id",e.Sender="sender"}(n||(n={})),t.SearchOrderBy=r,function(e){e.Recent="recent",e.Rank="rank"}(r||(t.SearchOrderBy=r={}))},7048:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.UnstableValue=t.NamespacedValue=void 0;class n{constructor(e,t){if(this.stable=e,this.unstable=t,!this.unstable&&!this.stable)throw new Error("One of stable or unstable values must be supplied")}get name(){return this.stable?this.stable:this.unstable}get altName(){return this.stable?this.unstable:null}matches(e){return this.name===e||this.altName===e}findIn(e){let t;return this.name&&(t=null==e?void 0:e[this.name]),!t&&this.altName&&(t=null==e?void 0:e[this.altName]),t}includedIn(e){let t=!1;return this.name&&(t=e.includes(this.name)),!t&&this.altName&&(t=e.includes(this.altName)),t}}t.NamespacedValue=n,t.UnstableValue=class extends n{constructor(e,t){if(super(e,t),!this.unstable)throw new Error("Unstable value must be supplied")}get name(){return this.unstable}get altName(){return this.stable}}},771:(e,t,n)=>{"use strict";var r=n(5318);Object.defineProperty(t,"__esModule",{value:!0}),t.ReEmitter=void 0;var i=r(n(9713));t.ReEmitter=class{constructor(e){(0,i.default)(this,"target",void 0),this.target=e}reEmit(e,t){for(const n of t){const t=(...t)=>{"error"===n&&0===this.target.listenerCount("error")||this.target.emit(n,...t,e)};e.on(n,t)}}}},9118:(e,t,n)=>{"use strict";var r=n(5318);Object.defineProperty(t,"__esModule",{value:!0}),t.AutoDiscoveryAction=t.AutoDiscovery=void 0;var i=r(n(9713)),s=n(8575),o=n(7434);let a;t.AutoDiscoveryAction=a,function(e){e.SUCCESS="SUCCESS",e.IGNORE="IGNORE",e.PROMPT="PROMPT",e.FAIL_PROMPT="FAIL_PROMPT",e.FAIL_ERROR="FAIL_ERROR"}(a||(t.AutoDiscoveryAction=a={}));class l{static async fromDiscoveryConfig(e){const t={"m.homeserver":{state:l.FAIL_ERROR,error:l.ERROR_INVALID,base_url:null},"m.identity_server":{state:l.PROMPT,error:null,base_url:null}};if(!e||!e["m.homeserver"])return o.logger.error("No m.homeserver key in config"),t["m.homeserver"].state=l.FAIL_PROMPT,t["m.homeserver"].error=l.ERROR_INVALID,Promise.resolve(t);if(!e["m.homeserver"].base_url)return o.logger.error("No m.homeserver base_url in config"),t["m.homeserver"].state=l.FAIL_PROMPT,t["m.homeserver"].error=l.ERROR_INVALID_HS_BASE_URL,Promise.resolve(t);const n=this.sanitizeWellKnownUrl(e["m.homeserver"].base_url);if(!n)return o.logger.error("Invalid base_url for m.homeserver"),t["m.homeserver"].error=l.ERROR_INVALID_HS_BASE_URL,Promise.resolve(t);const r=await this.fetchWellKnownObject(`${n}/_matrix/client/versions`);if(!r||!r.raw.versions)return o.logger.error("Invalid /versions response"),t["m.homeserver"].error=l.ERROR_INVALID_HOMESERVER,t["m.homeserver"].base_url=n,Promise.resolve(t);t["m.homeserver"]={state:l.SUCCESS,error:null,base_url:n};let i="";if(e["m.identity_server"]){const n={"m.homeserver":t["m.homeserver"],"m.identity_server":{state:l.FAIL_PROMPT,error:l.ERROR_INVALID_IS,base_url:null}};if(i=this.sanitizeWellKnownUrl(e["m.identity_server"].base_url),!i)return o.logger.error("Invalid base_url for m.identity_server"),n["m.identity_server"].error=l.ERROR_INVALID_IS_BASE_URL,Promise.resolve(n);const r=await this.fetchWellKnownObject(`${i}/_matrix/identity/api/v1`);if(!r||!r.raw||r.action!==a.SUCCESS)return o.logger.error("Invalid /api/v1 response"),n["m.identity_server"].error=l.ERROR_INVALID_IDENTITY_SERVER,n["m.identity_server"].base_url=i,Promise.resolve(n)}return i&&i.toString().length>0&&(t["m.identity_server"]={state:l.SUCCESS,error:null,base_url:i}),Object.keys(e).map((n=>{if("m.homeserver"===n||"m.identity_server"===n){const r=["error","state","base_url"];for(const i of Object.keys(e[n]))r.includes(i)||(t[n][i]=e[n][i])}else t[n]=e[n]})),Promise.resolve(t)}static async findClientConfig(e){if(!e||"string"!=typeof e||0===e.length)throw new Error("'domain' must be a string of non-zero length");const t={"m.homeserver":{state:l.FAIL_ERROR,error:l.ERROR_INVALID,base_url:null},"m.identity_server":{state:l.PROMPT,error:null,base_url:null}},n=await this.fetchWellKnownObject(`https://${e}/.well-known/matrix/client`);return n&&n.action===a.SUCCESS?l.fromDiscoveryConfig(n.raw):(o.logger.error("No response or error when parsing .well-known"),n.reason&&o.logger.error(n.reason),n.action===a.IGNORE?t["m.homeserver"]={state:l.PROMPT,error:null,base_url:null}:(t["m.homeserver"].state=l.FAIL_PROMPT,t["m.homeserver"].error=l.ERROR_INVALID),Promise.resolve(t))}static async getRawClientConfig(e){if(!e||"string"!=typeof e||0===e.length)throw new Error("'domain' must be a string of non-zero length");const t=await this.fetchWellKnownObject(`https://${e}/.well-known/matrix/client`);return t&&t.raw||{}}static sanitizeWellKnownUrl(e){if(!e)return!1;try{let t=null;try{t=s.URL?new s.URL(e):new URL(e)}catch(n){t=new URL(e)}if(!t||!t.hostname)return!1;if("http:"!==t.protocol&&"https:"!==t.protocol)return!1;const n=t.port?`:${t.port}`:"",r=t.pathname?t.pathname:"";let i=`${t.protocol}//${t.hostname}${n}${r}`;return i.endsWith("/")&&(i=i.substring(0,i.length-1)),i}catch(e){return o.logger.error(e),!1}}static async fetchWellKnownObject(e){return new Promise((function(t,r){const i=n(8070).getRequest();if(!i)throw new Error("No request library available");i({method:"GET",uri:e,timeout:5e3},((e,n,r)=>{if(e||n&&(n.statusCode<200||n.statusCode>=300)){let r=a.FAIL_PROMPT,i=(e?e.message:null)||"General failure";return n&&404===n.statusCode&&(r=a.IGNORE,i=l.ERROR_MISSING_WELLKNOWN),void t({raw:{},action:r,reason:i,error:e})}try{t({raw:JSON.parse(r),action:a.SUCCESS})}catch(e){let n=l.ERROR_INVALID;"SyntaxError"===e.name&&(n=l.ERROR_INVALID_JSON),t({raw:{},action:a.FAIL_PROMPT,reason:n,error:e})}}))}))}}t.AutoDiscovery=l,(0,i.default)(l,"ERROR_INVALID","Invalid homeserver discovery response"),(0,i.default)(l,"ERROR_GENERIC_FAILURE","Failed to get autodiscovery configuration from server"),(0,i.default)(l,"ERROR_INVALID_HS_BASE_URL","Invalid base_url for m.homeserver"),(0,i.default)(l,"ERROR_INVALID_HOMESERVER","Homeserver URL does not appear to be a valid Matrix homeserver"),(0,i.default)(l,"ERROR_INVALID_IS_BASE_URL","Invalid base_url for m.identity_server"),(0,i.default)(l,"ERROR_INVALID_IDENTITY_SERVER","Identity server URL does not appear to be a valid identity server"),(0,i.default)(l,"ERROR_INVALID_IS","Invalid identity server discovery response"),(0,i.default)(l,"ERROR_MISSING_WELLKNOWN","No .well-known JSON file found"),(0,i.default)(l,"ERROR_INVALID_JSON","Invalid JSON"),(0,i.default)(l,"ALL_ERRORS",[l.ERROR_INVALID,l.ERROR_GENERIC_FAILURE,l.ERROR_INVALID_HS_BASE_URL,l.ERROR_INVALID_HOMESERVER,l.ERROR_INVALID_IS_BASE_URL,l.ERROR_INVALID_IDENTITY_SERVER,l.ERROR_INVALID_IS,l.ERROR_MISSING_WELLKNOWN,l.ERROR_INVALID_JSON]),(0,i.default)(l,"FAIL_ERROR",a.FAIL_ERROR),(0,i.default)(l,"FAIL_PROMPT",a.FAIL_PROMPT),(0,i.default)(l,"PROMPT",a.PROMPT),(0,i.default)(l,"SUCCESS",a.SUCCESS)},8743:(e,t,n)=>{"use strict";var r=n(5318);Object.defineProperty(t,"__esModule",{value:!0});var i={};t.default=void 0;var s=r(n(4770)),o=r(n(129)),a=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var n=l(t);if(n&&n.has(e))return n.get(e);var r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var s in e)if("default"!==s&&Object.prototype.hasOwnProperty.call(e,s)){var o=i?Object.getOwnPropertyDescriptor(e,s):null;o&&(o.get||o.set)?Object.defineProperty(r,s,o):r[s]=e[s]}return r.default=e,n&&n.set(e,r),r}(n(8070));function l(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(l=function(e){return e?n:t})(e)}let c;Object.keys(a).forEach((function(e){"default"!==e&&"__esModule"!==e&&(Object.prototype.hasOwnProperty.call(i,e)||e in t&&t[e]===a[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return a[e]}}))})),a.request((function(e,t){return e.qs=o.default.stringify(e.qs||{},e.qsStringifyOptions),(0,s.default)(e,t)}));try{c=n.g.indexedDB}catch(e){}c&&a.setCryptoStoreFactory((function(){return new a.IndexedDBCryptoStore(c,"matrix-js-sdk:crypto")}));var d=a;t.default=d,n.g.matrixcs=a},2168:(e,t,n)=>{"use strict";var r=n(5318);Object.defineProperty(t,"__esModule",{value:!0}),t.RoomVersionStability=t.PendingEventOrdering=t.MatrixClient=t.CRYPTO_ENABLED=void 0;var i=r(n(9713)),s=n(7187),o=n(1333),a=n(4551),l=n(4369),c=n(5641),d=n(9679),u=n(7906),h=n(2931),p=z(n(3102)),m=n(8910),g=n(1707),f=n(9118),y=z(n(2772)),v=n(771),b=n(635),w=n(7434),S=n(1415),_=n(7715),k=n(2600),x=n(4077),E=n(1597),T=n(3998),C=n(3667),A=n(1398),I=n(4830),R=n(8070),O=n(764),P=z(n(4656)),M=n(2481),D=n(4702),L=n(1166),F=n(8401),N=n(5537),j=n(6170),U=n(9162),B=n(1470),q=n(7626);function K(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(K=function(e){return e?n:t})(e)}function z(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var n=K(t);if(n&&n.has(e))return n.get(e);var r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var s in e)if("default"!==s&&Object.prototype.hasOwnProperty.call(e,s)){var o=i?Object.getOwnPropertyDescriptor(e,s):null;o&&(o.get||o.set)?Object.defineProperty(r,s,o):r[s]=e[s]}return r.default=e,n&&n.set(e,r),r}function $(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function V(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?$(Object(n),!0).forEach((function(t){(0,i.default)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):$(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}const H=(0,k.isCryptoAvailable)();t.CRYPTO_ENABLED=H;const W=6e5;let G,Y;var X;t.PendingEventOrdering=G,function(e){e.Chronological="chronological",e.Detached="detached"}(G||(t.PendingEventOrdering=G={})),t.RoomVersionStability=Y,function(e){e.Stable="stable",e.Unstable="unstable"}(Y||(t.RoomVersionStability=Y={})),function(e){e.MasterKey="master_key",e.SelfSigningKey="self_signing_key",e.UserSigningKey="user_signing_key"}(X||(X={}));const Z="$";class J extends s.EventEmitter{constructor(e){super(),(0,i.default)(this,"reEmitter",new v.ReEmitter(this)),(0,i.default)(this,"olmVersion",null),(0,i.default)(this,"usingExternalCrypto",!1),(0,i.default)(this,"store",void 0),(0,i.default)(this,"deviceId",void 0),(0,i.default)(this,"credentials",void 0),(0,i.default)(this,"pickleKey",void 0),(0,i.default)(this,"scheduler",void 0),(0,i.default)(this,"clientRunning",!1),(0,i.default)(this,"timelineSupport",!1),(0,i.default)(this,"urlPreviewCache",{}),(0,i.default)(this,"unstableClientRelationAggregation",!1),(0,i.default)(this,"identityServer",void 0),(0,i.default)(this,"sessionStore",void 0),(0,i.default)(this,"http",void 0),(0,i.default)(this,"crypto",void 0),(0,i.default)(this,"cryptoCallbacks",void 0),(0,i.default)(this,"callEventHandler",void 0),(0,i.default)(this,"supportsCallTransfer",!1),(0,i.default)(this,"forceTURN",!1),(0,i.default)(this,"iceCandidatePoolSize",0),(0,i.default)(this,"idBaseUrl",void 0),(0,i.default)(this,"baseUrl",void 0),(0,i.default)(this,"canSupportVoip",!1),(0,i.default)(this,"peekSync",null),(0,i.default)(this,"isGuestAccount",!1),(0,i.default)(this,"ongoingScrollbacks",{}),(0,i.default)(this,"notifTimelineSet",null),(0,i.default)(this,"cryptoStore",void 0),(0,i.default)(this,"verificationMethods",void 0),(0,i.default)(this,"fallbackICEServerAllowed",!1),(0,i.default)(this,"roomList",void 0),(0,i.default)(this,"syncApi",void 0),(0,i.default)(this,"pushRules",void 0),(0,i.default)(this,"syncLeftRoomsPromise",void 0),(0,i.default)(this,"syncedLeftRooms",!1),(0,i.default)(this,"clientOpts",void 0),(0,i.default)(this,"clientWellKnownIntervalID",void 0),(0,i.default)(this,"canResetTimelineCallback",void 0),(0,i.default)(this,"pushProcessor",new g.PushProcessor(this)),(0,i.default)(this,"serverVersionsPromise",void 0),(0,i.default)(this,"cachedCapabilities",void 0),(0,i.default)(this,"clientWellKnown",void 0),(0,i.default)(this,"clientWellKnownPromise",void 0),(0,i.default)(this,"turnServers",[]),(0,i.default)(this,"turnServersExpiry",0),(0,i.default)(this,"checkTurnServersIntervalID",void 0),(0,i.default)(this,"exportedOlmDeviceToImport",void 0),(0,i.default)(this,"txnCtr",0),(0,i.default)(this,"mediaHandler",new q.MediaHandler),(0,i.default)(this,"pendingEventEncryption",new Map),(0,i.default)(this,"startCallEventHandler",(()=>{this.isInitialSyncComplete()&&(this.callEventHandler.start(),this.off("sync",this.startCallEventHandler))})),e.baseUrl=p.ensureNoTrailingSlash(e.baseUrl),e.idBaseUrl=p.ensureNoTrailingSlash(e.idBaseUrl),this.baseUrl=e.baseUrl,this.idBaseUrl=e.idBaseUrl,this.usingExternalCrypto=e.usingExternalCrypto,this.store=e.store||new c.StubStore,this.deviceId=e.deviceId||null;const t=e.userId||null;this.credentials={userId:t},this.http=new _.MatrixHttpApi(this,{baseUrl:e.baseUrl,idBaseUrl:e.idBaseUrl,accessToken:e.accessToken,request:e.request,prefix:_.PREFIX_R0,onlyData:!0,extraParams:e.queryParams,localTimeoutMs:e.localTimeoutMs,useAuthorizationHeader:e.useAuthorizationHeader}),e.deviceToImport?this.deviceId?w.logger.warn("not importing device because device ID is provided to constructor independently of exported data"):this.credentials.userId?w.logger.warn("not importing device because user ID is provided to constructor independently of exported data"):e.deviceToImport.deviceId?(this.deviceId=e.deviceToImport.deviceId,this.credentials.userId=e.deviceToImport.userId,this.exportedOlmDeviceToImport=e.deviceToImport.olmDevice):w.logger.warn("not importing device because no device ID in exported data"):e.pickleKey&&(this.pickleKey=e.pickleKey),this.scheduler=e.scheduler,this.scheduler&&this.scheduler.setProcessFunction((async e=>{const t=this.getRoom(e.getRoomId());e.status!==l.EventStatus.SENDING&&this.updatePendingEventStatus(t,e,l.EventStatus.SENDING);const n=await this.sendEventHttpRequest(e);return t&&t.updatePendingEvent(e,l.EventStatus.SENT,n.event_id),n})),(0,d.createNewMatrixCall)(this,void 0,void 0)&&(this.callEventHandler=new h.CallEventHandler(this),this.canSupportVoip=!0,this.on("sync",this.startCallEventHandler)),this.timelineSupport=Boolean(e.timelineSupport),this.unstableClientRelationAggregation=!!e.unstableClientRelationAggregation,this.cryptoStore=e.cryptoStore,this.sessionStore=e.sessionStore,this.verificationMethods=e.verificationMethods,this.cryptoCallbacks=e.cryptoCallbacks||{},this.forceTURN=e.forceTURN||!1,this.iceCandidatePoolSize=void 0===e.iceCandidatePoolSize?0:e.iceCandidatePoolSize,this.supportsCallTransfer=e.supportsCallTransfer||!1,this.fallbackICEServerAllowed=e.fallbackICEServerAllowed||!1,this.roomList=new b.RoomList(this.cryptoStore),this.on("Event.decrypted",(e=>{var t,n;const r=e.getPushActions(),i=this.getPushActionsForEvent(e,!0),s=this.getRoom(e.getRoomId());if(!s)return;const o=s.getUnreadNotificationCount(R.NotificationCountType.Highlight),a=!(null==r||null===(t=r.tweaks)||void 0===t||!t.highlight),l=!(null==i||null===(n=i.tweaks)||void 0===n||!n.highlight);if((a!==l||o>0)&&!s.hasUserReadEvent(this.getUserId(),e.getId())){let e=o;l&&!a&&e++,!l&&a&&e--,s.setUnreadNotificationCount(R.NotificationCountType.Highlight,e),s.getUnreadNotificationCount(R.NotificationCountType.Total)<e&&s.setUnreadNotificationCount(R.NotificationCountType.Total,e)}})),this.on("Room.receipt",((e,t)=>{if(t&&this.isRoomEncrypted(t.roomId)){const n=e.getContent();if(!(Object.keys(n).filter((e=>Object.keys(n[e]["m.read"]).includes(this.getUserId()))).length>0))return;const r=20,i=t.getLiveTimeline().getEvents();let s=0;for(let e=i.length-1;e>=0;e--){if(e===i.length-r)return;const n=i[e];if(t.hasUserReadEvent(this.getUserId(),n.getId()))break;const o=this.getPushActionsForEvent(n);s+=o.tweaks&&o.tweaks.highlight?1:0}t.setUnreadNotificationCount("highlight",s)}}))}async startClient(e){if(this.clientRunning)return;this.clientRunning=!0,"number"==typeof e&&(e={initialSyncLimit:e});const t=this.getUserId();t&&this.store.storeUser(new T.User(t)),this.crypto&&(this.crypto.uploadDeviceKeys(),this.crypto.start()),this.canSupportVoip&&(this.checkTurnServersIntervalID=setInterval((()=>{this.checkTurnServers()}),W),this.checkTurnServers()),this.syncApi&&(w.logger.error("Still have sync object whilst not running: stopping old one"),this.syncApi.stop()),await this.getCapabilities(!0),this.clientOpts=Object.assign({},e),this.clientOpts.crypto=this.crypto,this.clientOpts.canResetEntireTimeline=e=>!!this.canResetTimelineCallback&&this.canResetTimelineCallback(e),this.syncApi=new a.SyncApi(this,this.clientOpts),this.syncApi.sync(),void 0!==this.clientOpts.clientWellKnownPollPeriod&&(this.clientWellKnownIntervalID=setInterval((()=>{this.fetchClientWellKnown()}),1e3*this.clientOpts.clientWellKnownPollPeriod),this.fetchClientWellKnown())}stopClient(){var e,t,r,i;w.logger.log("stopping MatrixClient"),this.clientRunning=!1,null===(e=this.syncApi)||void 0===e||e.stop(),this.syncApi=null,null===(t=this.crypto)||void 0===t||t.stop(),null===(r=this.peekSync)||void 0===r||r.stopPeeking(),null===(i=this.callEventHandler)||void 0===i||i.stop(),this.callEventHandler=null,n.g.clearInterval(this.checkTurnServersIntervalID),void 0!==this.clientWellKnownIntervalID&&n.g.clearInterval(this.clientWellKnownIntervalID)}async rehydrateDevice(){if(this.crypto)throw new Error("Cannot rehydrate device after crypto is initialized");if(!this.cryptoCallbacks.getDehydrationKey)return;const e=await this.getDehydratedDevice();if(!e)return;if(!e.device_data||!e.device_id)return void w.logger.info("no dehydrated device found");const t=new n.g.Olm.Account;try{const n=e.device_data;if(n.algorithm!==I.DEHYDRATION_ALGORITHM)return void w.logger.warn("Wrong algorithm for dehydrated device");w.logger.log("unpickling dehydrated device");const r=await this.cryptoCallbacks.getDehydrationKey(n,(e=>{t.unpickle(new Uint8Array(e),n.account)}));if(t.unpickle(r,n.account),w.logger.log("unpickled device"),!0===(await this.http.authedRequest(void 0,_.Method.Post,"/dehydrated_device/claim",void 0,{device_id:e.device_id},{prefix:"/_matrix/client/unstable/org.matrix.msc2697.v2"})).success){this.deviceId=e.device_id,w.logger.info("using dehydrated device");const n=this.pickleKey||"DEFAULT_KEY";return this.exportedOlmDeviceToImport={pickledAccount:t.pickle(n),sessions:[],pickleKey:n},t.free(),this.deviceId}return t.free(),void w.logger.info("not using dehydrated device")}catch(e){t.free(),w.logger.warn("could not unpickle",e)}}async getDehydratedDevice(){try{return await this.http.authedRequest(void 0,_.Method.Get,"/dehydrated_device",void 0,void 0,{prefix:"/_matrix/client/unstable/org.matrix.msc2697.v2"})}catch(e){return void w.logger.info("could not get dehydrated device",e.toString())}}async setDehydrationKey(e,t,n){if(this.crypto)return await this.crypto.dehydrationManager.setKeyAndQueueDehydration(e,t,n);w.logger.warn("not dehydrating device if crypto is not enabled")}async createDehydratedDevice(e,t,n){if(this.crypto)return await this.crypto.dehydrationManager.setKey(e,t,n),await this.crypto.dehydrationManager.dehydrateDevice();w.logger.warn("not dehydrating device if crypto is not enabled")}async exportDevice(){if(this.crypto)return{userId:this.credentials.userId,deviceId:this.deviceId,olmDevice:await this.crypto.olmDevice.export()};w.logger.warn("not exporting device if crypto is not enabled")}clearStores(){if(this.clientRunning)throw new Error("Cannot clear stores while client is running");const e=[];return e.push(this.store.deleteAllData()),this.cryptoStore&&e.push(this.cryptoStore.deleteAllData()),Promise.all(e).then()}getUserId(){return this.credentials&&this.credentials.userId?this.credentials.userId:null}getDomain(){return this.credentials&&this.credentials.userId?this.credentials.userId.replace(/^.*?:/,""):null}getUserIdLocalpart(){return this.credentials&&this.credentials.userId?this.credentials.userId.split(":")[0].substring(1):null}getDeviceId(){return this.deviceId}supportsVoip(){return this.canSupportVoip}getMediaHandler(){return this.mediaHandler}setForceTURN(e){this.forceTURN=e}setSupportsCallTransfer(e){this.supportsCallTransfer=e}createCall(e){return(0,d.createNewMatrixCall)(this,e)}getSyncState(){return this.syncApi?this.syncApi.getSyncState():null}getSyncStateData(){return this.syncApi?this.syncApi.getSyncStateData():null}isInitialSyncComplete(){const e=this.getSyncState();return!!e&&(e===a.SyncState.Prepared||e===a.SyncState.Syncing)}isGuest(){return this.isGuestAccount}setGuest(e){this.isGuestAccount=e}getScheduler(){return this.scheduler}retryImmediately(){return this.syncApi.retryImmediately()}getNotifTimelineSet(){return this.notifTimelineSet}setNotifTimelineSet(e){this.notifTimelineSet=e}getCapabilities(e=!1){const t=(new Date).getTime();return this.cachedCapabilities&&!e&&t<this.cachedCapabilities.expiration?(w.logger.log("Returning cached capabilities"),Promise.resolve(this.cachedCapabilities.capabilities)):this.http.authedRequest(void 0,_.Method.Get,"/capabilities").catch((e=>{w.logger.error(e)})).then(((e={})=>{const n=e.capabilities||{},r=Object.keys(n).length?216e5:6e4+5e3*Math.random();return this.cachedCapabilities={capabilities:n,expiration:t+r},w.logger.log("Caching capabilities: ",n),n}))}async initCrypto(){if(!(0,k.isCryptoAvailable)())throw new Error("End-to-end encryption not supported in this js-sdk build: did you remember to load the olm library?");if(this.crypto)return void w.logger.warn("Attempt to re-initialise e2e encryption on MatrixClient");if(!this.sessionStore)throw new Error("Cannot enable encryption: no sessionStore provided");if(!this.cryptoStore)throw new Error("Cannot enable encryption: no cryptoStore provided");w.logger.log("Crypto: Starting up crypto store..."),await this.cryptoStore.startup(),w.logger.log("Crypto: initialising roomlist..."),await this.roomList.init();const e=this.getUserId();if(null===e)throw new Error("Cannot enable encryption on MatrixClient with unknown userId: ensure userId is passed in createClient().");if(null===this.deviceId)throw new Error("Cannot enable encryption on MatrixClient with unknown deviceId: ensure deviceId is passed in createClient().");const t=new k.Crypto(this,this.sessionStore,e,this.deviceId,this.store,this.cryptoStore,this.roomList,this.verificationMethods);this.reEmitter.reEmit(t,["crypto.keyBackupFailed","crypto.keyBackupSessionsRemaining","crypto.roomKeyRequest","crypto.roomKeyRequestCancellation","crypto.warning","crypto.devicesUpdated","crypto.willUpdateDevices","deviceVerificationChanged","userTrustStatusChanged","crossSigning.keysChanged"]),w.logger.log("Crypto: initialising crypto object..."),await t.init({exportedOlmDevice:this.exportedOlmDeviceToImport,pickleKey:this.pickleKey}),delete this.exportedOlmDeviceToImport,this.olmVersion=k.Crypto.getOlmVersion(),t.registerEventHandlers(this),this.crypto=t}isCryptoEnabled(){return!!this.crypto}getDeviceEd25519Key(){return this.crypto?this.crypto.getDeviceEd25519Key():null}getDeviceCurve25519Key(){return this.crypto?this.crypto.getDeviceCurve25519Key():null}async uploadKeys(){if(!this.crypto)throw new Error("End-to-end encryption disabled");await this.crypto.uploadDeviceKeys()}downloadKeys(e,t){return this.crypto?this.crypto.downloadKeys(e,t):Promise.reject(new Error("End-to-end encryption disabled"))}getStoredDevicesForUser(e){if(!this.crypto)throw new Error("End-to-end encryption disabled");return this.crypto.getStoredDevicesForUser(e)||[]}getStoredDevice(e,t){if(!this.crypto)throw new Error("End-to-end encryption disabled");return this.crypto.getStoredDevice(e,t)||null}setDeviceVerified(e,t,n=!0){const r=this.setDeviceVerification(e,t,n,null,null);return e==this.credentials.userId&&this.checkKeyBackup(),r}setDeviceBlocked(e,t,n=!0){return this.setDeviceVerification(e,t,null,n,null)}setDeviceKnown(e,t,n=!0){return this.setDeviceVerification(e,t,null,null,n)}async setDeviceVerification(e,t,n,r,i){if(!this.crypto)throw new Error("End-to-end encryption disabled");await this.crypto.setDeviceVerification(e,t,n,r,i)}requestVerificationDM(e,t){if(!this.crypto)throw new Error("End-to-end encryption disabled");return this.crypto.requestVerificationDM(e,t)}findVerificationRequestDMInProgress(e){if(!this.crypto)throw new Error("End-to-end encryption disabled");return this.crypto.findVerificationRequestDMInProgress(e)}getVerificationRequestsToDeviceInProgress(e){if(!this.crypto)throw new Error("End-to-end encryption disabled");return this.crypto.getVerificationRequestsToDeviceInProgress(e)}requestVerification(e,t){if(!this.crypto)throw new Error("End-to-end encryption disabled");return this.crypto.requestVerification(e,t)}beginKeyVerification(e,t,n){if(!this.crypto)throw new Error("End-to-end encryption disabled");return this.crypto.beginKeyVerification(e,t,n)}checkSecretStorageKey(e,t){if(!this.crypto)throw new Error("End-to-end encryption disabled");return this.crypto.checkSecretStorageKey(e,t)}setGlobalBlacklistUnverifiedDevices(e){if(!this.crypto)throw new Error("End-to-end encryption disabled");return this.crypto.setGlobalBlacklistUnverifiedDevices(e)}getGlobalBlacklistUnverifiedDevices(){if(!this.crypto)throw new Error("End-to-end encryption disabled");return this.crypto.getGlobalBlacklistUnverifiedDevices()}setGlobalErrorOnUnknownDevices(e){if(!this.crypto)throw new Error("End-to-end encryption disabled");return this.crypto.setGlobalErrorOnUnknownDevices(e)}getGlobalErrorOnUnknownDevices(){if(!this.crypto)throw new Error("End-to-end encryption disabled");return this.crypto.getGlobalErrorOnUnknownDevices()}getCrossSigningId(e=O.CrossSigningKey.Master){if(!this.crypto)throw new Error("End-to-end encryption disabled");return this.crypto.getCrossSigningId(e)}getStoredCrossSigningForUser(e){if(!this.crypto)throw new Error("End-to-end encryption disabled");return this.crypto.getStoredCrossSigningForUser(e)}checkUserTrust(e){if(!this.crypto)throw new Error("End-to-end encryption disabled");return this.crypto.checkUserTrust(e)}checkDeviceTrust(e,t){if(!this.crypto)throw new Error("End-to-end encryption disabled");return this.crypto.checkDeviceTrust(e,t)}checkOwnCrossSigningTrust(e){if(!this.crypto)throw new Error("End-to-end encryption disabled");return this.crypto.checkOwnCrossSigningTrust(e)}checkCrossSigningPrivateKey(e,t){if(!this.crypto)throw new Error("End-to-end encryption disabled");return this.crypto.checkCrossSigningPrivateKey(e,t)}legacyDeviceVerification(e,t,n){if(!this.crypto)throw new Error("End-to-end encryption disabled");return this.crypto.legacyDeviceVerification(e,t,n)}prepareToEncrypt(e){if(!this.crypto)throw new Error("End-to-end encryption disabled");return this.crypto.prepareToEncrypt(e)}isCrossSigningReady(){if(!this.crypto)throw new Error("End-to-end encryption disabled");return this.crypto.isCrossSigningReady()}bootstrapCrossSigning(e){if(!this.crypto)throw new Error("End-to-end encryption disabled");return this.crypto.bootstrapCrossSigning(e)}getCryptoTrustCrossSignedDevices(){if(!this.crypto)throw new Error("End-to-end encryption disabled");return this.crypto.getCryptoTrustCrossSignedDevices()}setCryptoTrustCrossSignedDevices(e){if(!this.crypto)throw new Error("End-to-end encryption disabled");return this.crypto.setCryptoTrustCrossSignedDevices(e)}countSessionsNeedingBackup(){if(!this.crypto)throw new Error("End-to-end encryption disabled");return this.crypto.countSessionsNeedingBackup()}getEventEncryptionInfo(e){if(!this.crypto)throw new Error("End-to-end encryption disabled");return this.crypto.getEventEncryptionInfo(e)}createRecoveryKeyFromPassphrase(e){if(!this.crypto)throw new Error("End-to-end encryption disabled");return this.crypto.createRecoveryKeyFromPassphrase(e)}isSecretStorageReady(){if(!this.crypto)throw new Error("End-to-end encryption disabled");return this.crypto.isSecretStorageReady()}bootstrapSecretStorage(e){if(!this.crypto)throw new Error("End-to-end encryption disabled");return this.crypto.bootstrapSecretStorage(e)}addSecretStorageKey(e,t,n){if(!this.crypto)throw new Error("End-to-end encryption disabled");return this.crypto.addSecretStorageKey(e,t,n)}hasSecretStorageKey(e){if(!this.crypto)throw new Error("End-to-end encryption disabled");return this.crypto.hasSecretStorageKey(e)}storeSecret(e,t,n){if(!this.crypto)throw new Error("End-to-end encryption disabled");return this.crypto.storeSecret(e,t,n)}getSecret(e){if(!this.crypto)throw new Error("End-to-end encryption disabled");return this.crypto.getSecret(e)}isSecretStored(e,t){if(!this.crypto)throw new Error("End-to-end encryption disabled");return this.crypto.isSecretStored(e,t)}requestSecret(e,t){if(!this.crypto)throw new Error("End-to-end encryption disabled");return this.crypto.requestSecret(e,t)}getDefaultSecretStorageKeyId(){if(!this.crypto)throw new Error("End-to-end encryption disabled");return this.crypto.getDefaultSecretStorageKeyId()}setDefaultSecretStorageKeyId(e){if(!this.crypto)throw new Error("End-to-end encryption disabled");return this.crypto.setDefaultSecretStorageKeyId(e)}checkSecretStoragePrivateKey(e,t){if(!this.crypto)throw new Error("End-to-end encryption disabled");return this.crypto.checkSecretStoragePrivateKey(e,t)}async getEventSenderDeviceInfo(e){return this.crypto?this.crypto.getEventSenderDeviceInfo(e):null}async isEventSenderVerified(e){const t=await this.getEventSenderDeviceInfo(e);return!!t&&t.isVerified()}cancelAndResendEventRoomKeyRequest(e){return e.cancelAndResendKeyRequest(this.crypto,this.getUserId())}setRoomEncryption(e,t){if(!this.crypto)throw new Error("End-to-End encryption disabled");return this.crypto.setRoomEncryption(e,t)}isRoomEncrypted(e){const t=this.getRoom(e);return!!t&&(!!t.currentState.getStateEvents(M.EventType.RoomEncryption,"")||this.roomList.isRoomEncrypted(e))}forceDiscardSession(e){if(!this.crypto)throw new Error("End-to-End encryption disabled");this.crypto.forceDiscardSession(e)}exportRoomKeys(){return this.crypto?this.crypto.exportRoomKeys():Promise.reject(new Error("End-to-end encryption disabled"))}importRoomKeys(e,t){if(!this.crypto)throw new Error("End-to-end encryption disabled");return this.crypto.importRoomKeys(e,t)}checkKeyBackup(){return this.crypto.backupManager.checkKeyBackup()}async getKeyBackupVersion(){let e;try{e=await this.http.authedRequest(void 0,_.Method.Get,"/room_keys/version",void 0,void 0,{prefix:_.PREFIX_UNSTABLE})}catch(e){if("M_NOT_FOUND"===e.errcode)return null;throw e}try{N.BackupManager.checkBackupVersion(e)}catch(e){throw e}return e}isKeyBackupTrusted(e){return this.crypto.backupManager.isKeyBackupTrusted(e)}getKeyBackupEnabled(){if(!this.crypto)throw new Error("End-to-end encryption disabled");return this.crypto.backupManager.getKeyBackupEnabled()}enableKeyBackup(e){if(!this.crypto)throw new Error("End-to-end encryption disabled");return this.crypto.backupManager.enableKeyBackup(e)}disableKeyBackup(){if(!this.crypto)throw new Error("End-to-end encryption disabled");this.crypto.backupManager.disableKeyBackup()}async prepareKeyBackupVersion(e,t={secureSecretStorage:!1}){if(!this.crypto)throw new Error("End-to-end encryption disabled");const{algorithm:n,auth_data:r,recovery_key:i,privateKey:s}=await this.crypto.backupManager.prepareKeyBackupVersion(e);return t.secureSecretStorage&&(await this.storeSecret("m.megolm_backup.v1",(0,y.encodeBase64)(s)),w.logger.info("Key backup private key stored in secret storage")),{algorithm:n,auth_data:r,recovery_key:i}}isKeyBackupKeyStored(){return Promise.resolve(this.isSecretStored("m.megolm_backup.v1",!1))}async createKeyBackupVersion(e){if(!this.crypto)throw new Error("End-to-end encryption disabled");await this.crypto.backupManager.createKeyBackupVersion(e);const t={algorithm:e.algorithm,auth_data:e.auth_data};await this.crypto.signObject(t.auth_data),this.cryptoCallbacks.getCrossSigningKey&&this.crypto.crossSigningInfo.getId()&&await this.crypto.crossSigningInfo.signObject(t.auth_data,"master");const n=await this.http.authedRequest(void 0,_.Method.Post,"/room_keys/version",void 0,t,{prefix:_.PREFIX_UNSTABLE});return await this.checkKeyBackup(),this.getKeyBackupEnabled()||w.logger.error("Key backup not usable even though we just created it"),n}deleteKeyBackupVersion(e){if(!this.crypto)throw new Error("End-to-end encryption disabled");this.crypto.backupManager.version&&this.crypto.backupManager.disableKeyBackup();const t=p.encodeUri("/room_keys/version/$version",{$version:e});return this.http.authedRequest(void 0,_.Method.Delete,t,void 0,void 0,{prefix:_.PREFIX_UNSTABLE})}makeKeyBackupPath(e,t,n){let r;return r=void 0!==t?p.encodeUri("/room_keys/keys/$roomId/$sessionId",{$roomId:e,$sessionId:t}):void 0!==e?p.encodeUri("/room_keys/keys/$roomId",{$roomId:e}):"/room_keys/keys",{path:r,queryData:void 0===n?void 0:{version:n}}}sendKeyBackup(e,t,n,r){if(!this.crypto)throw new Error("End-to-end encryption disabled");const i=this.makeKeyBackupPath(e,t,n);return this.http.authedRequest(void 0,_.Method.Put,i.path,i.queryData,r,{prefix:_.PREFIX_UNSTABLE})}async scheduleAllGroupSessionsForBackup(){if(!this.crypto)throw new Error("End-to-end encryption disabled");await this.crypto.backupManager.scheduleAllGroupSessionsForBackup()}flagAllGroupSessionsForBackup(){if(!this.crypto)throw new Error("End-to-end encryption disabled");return this.crypto.backupManager.flagAllGroupSessionsForBackup()}isValidRecoveryKey(e){try{return(0,x.decodeRecoveryKey)(e),!0}catch(e){return!1}}keyBackupKeyFromPassword(e,t){return(0,E.keyFromAuthData)(t.auth_data,e)}keyBackupKeyFromRecoveryKey(e){return(0,x.decodeRecoveryKey)(e)}async restoreKeyBackupWithPassword(e,t,n,r,i){const s=await(0,E.keyFromAuthData)(r.auth_data,e);return this.restoreKeyBackup(s,t,n,r,i)}async restoreKeyBackupWithSecretStorage(e,t,n,r){const i=await this.getSecret("m.megolm_backup.v1"),s=(0,k.fixBackupKey)(i);if(s){const[e]=await this.crypto.getSecretStorageKey();await this.storeSecret("m.megolm_backup.v1",s,[e])}const o=(0,y.decodeBase64)(s||i);return this.restoreKeyBackup(o,t,n,e,r)}restoreKeyBackupWithRecoveryKey(e,t,n,r,i){const s=(0,x.decodeRecoveryKey)(e);return this.restoreKeyBackup(s,t,n,r,i)}async restoreKeyBackupWithCache(e,t,n,r){const i=await this.crypto.getSessionBackupPrivateKey();if(!i)throw new Error("Couldn't get key");return this.restoreKeyBackup(i,e,t,n,r)}async restoreKeyBackup(e,t,n,r,i){const s=null==i?void 0:i.cacheCompleteCallback,o=null==i?void 0:i.progressCallback;if(!this.crypto)throw new Error("End-to-end encryption disabled");let a=0,l=[];const c=this.makeKeyBackupPath(t,n,r.version),d=await N.BackupManager.makeAlgorithm(r,(async()=>e)),u=d.untrusted;try{if(!await d.keyMatches(e))return Promise.reject(new _.MatrixError({errcode:J.RESTORE_BACKUP_ERROR_BAD_KEY}));this.crypto.storeSessionBackupPrivateKey(e).catch((e=>{w.logger.warn("Error caching session backup key:",e)})).then(s),o&&o({stage:"fetch"});const r=await this.http.authedRequest(void 0,_.Method.Get,c.path,c.queryData,void 0,{prefix:_.PREFIX_UNSTABLE});if(r.rooms){const e=r.rooms;for(const[t,n]of Object.entries(e)){if(!n.sessions)continue;a+=Object.keys(n.sessions).length;const e=await d.decryptSessions(n.sessions);for(const n of e)n.room_id=t,l.push(n)}}else if(r.sessions){const e=r.sessions;a=Object.keys(e).length,l=await d.decryptSessions(e);for(const e of l)e.room_id=t}else{a=1;try{const[e]=await d.decryptSessions({[n]:r});e.room_id=t,e.session_id=n,l.push(e)}catch(e){w.logger.log("Failed to decrypt megolm session from backup",e)}}}finally{d.free()}return await this.importRoomKeys(l,{progressCallback:o,untrusted:u,source:"backup"}),await this.checkKeyBackup(),{total:a,imported:l.length}}deleteKeysFromBackup(e,t,n){if(!this.crypto)throw new Error("End-to-end encryption disabled");const r=this.makeKeyBackupPath(e,t,n);return this.http.authedRequest(void 0,_.Method.Delete,r.path,r.queryData,void 0,{prefix:_.PREFIX_UNSTABLE})}async sendSharedHistoryKeys(e,t){if(!this.crypto)throw new Error("End-to-end encryption disabled");const n=this.roomList.getRoomEncryption(e);if(!n)return void w.logger.error("Unknown room.  Not sharing decryption keys");const r=await this.crypto.downloadKeys(t),i={};for(const[e,t]of Object.entries(r))i[e]=Object.values(t);const s=this.crypto.getRoomDecryptor(e,n.algorithm);s.sendSharedHistoryInboundSessions?await s.sendSharedHistoryInboundSessions(i):w.logger.warn("Algorithm does not support sharing previous keys",n.algorithm)}getGroup(e){return this.store.getGroup(e)}getGroups(){return this.store.getGroups()}getMediaConfig(e){return this.http.authedRequest(e,_.Method.Get,"/config",void 0,void 0,{prefix:_.PREFIX_MEDIA_R0})}getRoom(e){return this.store.getRoom(e)}getRooms(){return this.store.getRooms()}getVisibleRooms(){const e=this.store.getRooms(),t=new Set;for(const n of e){const e=n.currentState.getStateEvents(M.EventType.RoomCreate,"");if(e){const n=e.getContent().predecessor;n&&n.room_id&&t.add(n.room_id)}}return e.filter((e=>!e.currentState.getStateEvents(M.EventType.RoomTombstone,"")||!t.has(e.roomId)))}getUser(e){return this.store.getUser(e)}getUsers(){return this.store.getUsers()}setAccountData(e,t,n){const r=p.encodeUri("/user/$userId/account_data/$type",{$userId:this.credentials.userId,$type:e}),i=(0,_.retryNetworkOperation)(5,(()=>this.http.authedRequest(void 0,_.Method.Put,r,void 0,t)));return n&&i.then((e=>n(null,e)),n),i}getAccountData(e){return this.store.getAccountData(e)}async getAccountDataFromServer(e){if(this.isInitialSyncComplete()){const t=this.store.getAccountData(e);return t?t.getContent():null}const t=p.encodeUri("/user/$userId/account_data/$type",{$userId:this.credentials.userId,$type:e});try{return await this.http.authedRequest(void 0,_.Method.Get,t,void 0)}catch(e){if(e.data&&"M_NOT_FOUND"===e.data.errcode)return null;throw e}}getIgnoredUsers(){const e=this.getAccountData("m.ignored_user_list");return e&&e.getContent()&&e.getContent().ignored_users?Object.keys(e.getContent().ignored_users):[]}setIgnoredUsers(e,t){const n={ignored_users:{}};return e.map((e=>n.ignored_users[e]={})),this.setAccountData("m.ignored_user_list",n,t)}isUserIgnored(e){return this.getIgnoredUsers().includes(e)}async joinRoom(e,t,n){if(p.isFunction(t))throw new Error("Expected 'opts' object, got function.");void 0===(t=t||{}).syncRoom&&(t.syncRoom=!0);const r=this.getRoom(e);if(r&&r.hasMembershipState(this.credentials.userId,"join"))return Promise.resolve(r);let i=Promise.resolve();t.inviteSignUrl&&(i=this.http.requestOtherUrl(void 0,_.Method.Post,t.inviteSignUrl,{mxid:this.credentials.userId}));const s={};t.viaServers&&(s.server_name=t.viaServers);const o={qsStringifyOptions:{arrayFormat:"repeat"}};try{const r={},l=await i;l&&(r.third_party_signed=l);const c=p.encodeUri("/join/$roomid",{$roomid:e}),d=(await this.http.authedRequest(void 0,_.Method.Post,c,s,r,o)).room_id,u=new a.SyncApi(this,this.clientOpts).createRoom(d);return t.syncRoom,null==n||n(null,u),u}catch(e){throw null==n||n(e),e}}resendEvent(e,t){return this.updatePendingEventStatus(t,e,l.EventStatus.SENDING),this.encryptAndSendEvent(t,e)}cancelPendingEvent(e){if(![l.EventStatus.QUEUED,l.EventStatus.NOT_SENT,l.EventStatus.ENCRYPTING].includes(e.status))throw new Error("cannot cancel an event with status "+e.status);e.status===l.EventStatus.ENCRYPTING?this.pendingEventEncryption.delete(e.getId()):this.scheduler&&e.status===l.EventStatus.QUEUED&&this.scheduler.removeEventFromQueue(e);const t=this.getRoom(e.getRoomId());this.updatePendingEventStatus(t,e,l.EventStatus.CANCELLED)}setRoomName(e,t,n){return this.sendStateEvent(e,M.EventType.RoomName,{name:t},void 0,n)}setRoomTopic(e,t,n){return this.sendStateEvent(e,M.EventType.RoomTopic,{topic:t},void 0,n)}getRoomTags(e,t){const n=p.encodeUri("/user/$userId/rooms/$roomId/tags/",{$userId:this.credentials.userId,$roomId:e});return this.http.authedRequest(t,_.Method.Get,n,void 0)}setRoomTag(e,t,n,r){const i=p.encodeUri("/user/$userId/rooms/$roomId/tags/$tag",{$userId:this.credentials.userId,$roomId:e,$tag:t});return this.http.authedRequest(r,_.Method.Put,i,void 0,n)}deleteRoomTag(e,t,n){const r=p.encodeUri("/user/$userId/rooms/$roomId/tags/$tag",{$userId:this.credentials.userId,$roomId:e,$tag:t});return this.http.authedRequest(n,_.Method.Delete,r,void 0,void 0)}setRoomAccountData(e,t,n,r){const i=p.encodeUri("/user/$userId/rooms/$roomId/account_data/$type",{$userId:this.credentials.userId,$roomId:e,$type:t});return this.http.authedRequest(r,_.Method.Put,i,void 0,n)}setPowerLevel(e,t,n,r,i){let s={users:{}};(null==r?void 0:r.getType())===M.EventType.RoomPowerLevels&&(s=p.deepCopy(r.getContent())),s.users[t]=n;const o=p.encodeUri("/rooms/$roomId/state/m.room.power_levels",{$roomId:e});return this.http.authedRequest(i,_.Method.Put,o,void 0,s)}sendEvent(e,t,n,r,i,s){var o,a;if(null!==(o=t)&&void 0!==o&&o.startsWith(Z)||null===t||(s=i,i=r,r=n,n=t,t=null),t&&(null===(a=r["m.relates_to"])||void 0===a?void 0:a.rel_type)!==M.RelationType.Thread){var l;r["m.relates_to"]=V(V({},r["m.relates_to"]),{},{rel_type:M.RelationType.Thread,event_id:t});const n=null===(l=this.getRoom(e))||void 0===l?void 0:l.threads.get(t);n&&(r["m.relates_to"]["m.in_reply_to"]={event_id:n.replyToEvent.getId()})}return this.sendCompleteEvent(e,t,{type:n,content:r},i,s)}sendCompleteEvent(e,t,n,r,i){p.isFunction(r)&&(i=r,r=void 0),r||(r=this.makeTxnId());const s=new l.MatrixEvent(Object.assign(n,{event_id:"~"+e+":"+r,user_id:this.credentials.userId,sender:this.credentials.userId,room_id:e,origin_server_ts:(new Date).getTime()})),o=this.getRoom(e),a=null==o?void 0:o.threads.get(t);a&&s.setThread(a);const c=s.getAssociatedId();if(c&&c.startsWith("~")){const e=o.getPendingEvents().find((e=>e.getId()===c));e.once("Event.localEventIdReplaced",(()=>{s.updateAssociatedId(e.getId())}))}const d=s.getType();return w.logger.log(`sendEvent of type ${d} in ${e} with txnId ${r}`),s.setTxnId(r),s.setStatus(l.EventStatus.SENDING),o&&o.addPendingEvent(s,r),s.status===l.EventStatus.NOT_SENT?Promise.reject(new Error("Event blocked by other events not yet sent")):this.encryptAndSendEvent(o,s,i)}encryptAndSendEvent(e,t,n){let r=!1;return Promise.resolve().then((()=>{const n=this.encryptEventIfNeeded(t,e);return n?(this.pendingEventEncryption.set(t.getId(),n),this.updatePendingEventStatus(e,t,l.EventStatus.ENCRYPTING),n.then((()=>{this.pendingEventEncryption.has(t.getId())?this.updatePendingEventStatus(e,t,l.EventStatus.SENDING):r=!0}))):null})).then((()=>{if(r)return{};let n;return this.scheduler&&(n=this.scheduler.queueEvent(t),n&&this.scheduler.getQueueForEvent(t).length>1&&this.updatePendingEventStatus(e,t,l.EventStatus.QUEUED)),n||(n=this.sendEventHttpRequest(t),e&&(n=n.then((n=>(e.updatePendingEvent(t,l.EventStatus.SENT,n.event_id),n))))),n})).then((e=>(null==n||n(null,e),e))).catch((r=>{w.logger.error("Error sending event",r.stack||r);try{t.error=r,this.updatePendingEventStatus(e,t,l.EventStatus.NOT_SENT),r.event=t,null==n||n(r)}catch(e){w.logger.error("Exception in error handler!",e.stack||r)}throw r}))}encryptEventIfNeeded(e,t){if(e.isEncrypted())return null;if(e.isRedaction())return null;if(!this.isRoomEncrypted(e.getRoomId()))return null;if(!this.crypto&&this.usingExternalCrypto)return null;if(e.getType()===M.EventType.Reaction)return null;if(!this.crypto)throw new Error("This room is configured to use encryption, but your client does not support encryption.");return this.crypto.encryptEvent(e,t)}getEncryptedIfNeededEventType(e,t){return t===M.EventType.Reaction?t:this.isRoomEncrypted(e)?M.EventType.RoomMessageEncrypted:t}updatePendingEventStatus(e,t,n){e?e.updatePendingEvent(t,n):t.setStatus(n)}sendEventHttpRequest(e){let t=e.getTxnId();t||(t=this.makeTxnId(),e.setTxnId(t));const n={$roomId:e.getRoomId(),$eventType:e.getWireType(),$stateKey:e.getStateKey(),$txnId:t};let r;if(e.isState()){let t="/rooms/$roomId/state/$eventType";e.getStateKey()&&e.getStateKey().length>0&&(t="/rooms/$roomId/state/$eventType/$stateKey"),r=p.encodeUri(t,n)}else if(e.isRedaction()){const t="/rooms/$roomId/redact/$redactsEventId/$txnId";r=p.encodeUri(t,Object.assign({$redactsEventId:e.event.redacts},n))}else r=p.encodeUri("/rooms/$roomId/send/$eventType/$txnId",n);return this.http.authedRequest(void 0,_.Method.Put,r,void 0,e.getWireContent()).then((t=>(w.logger.log(`Event sent to ${e.getRoomId()} with event id ${t.event_id}`),t)))}redactEvent(e,t,n,r,i){var s;null!==(s=n)&&void 0!==s&&s.startsWith(Z)||(i=r,r=n,n=t,t=null);const o=("object"==typeof i?i:{}).reason,a="function"==typeof i?i:void 0;return this.sendCompleteEvent(e,t,{type:M.EventType.RoomRedaction,content:{reason:o},redacts:n},r,a)}sendMessage(e,t,n,r,i){"string"!=typeof t&&null!==t&&(i=r,r=n,n=t,t=null),p.isFunction(r)&&(i=r,r=void 0);let s=M.EventType.RoomMessage,a=n;const l=(e={},t=!0)=>{let n=null;if(e.msgtype===M.MsgType.Text?n=o.MessageEvent.from(e.body,e.formatted_body).serialize():e.msgtype===M.MsgType.Emote?n=o.EmoteEvent.from(e.body,e.formatted_body).serialize():e.msgtype===M.MsgType.Notice&&(n=o.NoticeEvent.from(e.body,e.formatted_body).serialize()),n&&e["m.new_content"]&&t){const t=l(e["m.new_content"],!1);t&&(n.content["m.new_content"]=t.content)}if(n)for(const[t,r]of Object.entries(e))n.content.hasOwnProperty(t)||(n.content[t]=r);return n},c=l(a);return c&&(s=c.type,a=c.content),this.sendEvent(e,t,s,a,r,i)}sendTextMessage(e,t,n,r,i){var s;null!==(s=t)&&void 0!==s&&s.startsWith(Z)||null===t||(i=r,r=n,n=t,t=null);const o=P.makeTextMessage(n);return this.sendMessage(e,t,o,r,i)}sendNotice(e,t,n,r,i){var s;null!==(s=t)&&void 0!==s&&s.startsWith(Z)||null===t||(i=r,r=n,n=t,t=null);const o=P.makeNotice(n);return this.sendMessage(e,t,o,r,i)}sendEmoteMessage(e,t,n,r,i){var s;null!==(s=t)&&void 0!==s&&s.startsWith(Z)||null===t||(i=r,r=n,n=t,t=null);const o=P.makeEmoteMessage(n);return this.sendMessage(e,t,o,r,i)}sendImageMessage(e,t,n,r,i="Image",s){var o;null!==(o=t)&&void 0!==o&&o.startsWith(Z)||null===t||(s=i,i=r||"Image",r=n,n=t,t=null),p.isFunction(i)&&(s=i,i=void 0);const a={msgtype:M.MsgType.Image,url:n,info:r,body:i};return this.sendMessage(e,t,a,void 0,s)}sendStickerMessage(e,t,n,r,i="Sticker",s){var o;null!==(o=t)&&void 0!==o&&o.startsWith(Z)||null===t||(s=i,i=r||"Sticker",r=n,n=t,t=null),p.isFunction(i)&&(s=i,i=void 0);const a={url:n,info:r,body:i};return this.sendEvent(e,t,M.EventType.Sticker,a,void 0,s)}sendHtmlMessage(e,t,n,r,i){var s;null!==(s=t)&&void 0!==s&&s.startsWith(Z)||null===t||(i=r,r=n,n=t,t=null);const o=P.makeHtmlMessage(n,r);return this.sendMessage(e,t,o,void 0,i)}sendHtmlNotice(e,t,n,r,i){var s;null!==(s=t)&&void 0!==s&&s.startsWith(Z)||null===t||(i=r,r=n,n=t,t=null);const o=P.makeHtmlNotice(n,r);return this.sendMessage(e,t,o,void 0,i)}sendHtmlEmote(e,t,n,r,i){var s;null!==(s=t)&&void 0!==s&&s.startsWith(Z)||null===t||(i=r,r=n,n=t,t=null);const o=P.makeHtmlEmote(n,r);return this.sendMessage(e,t,o,void 0,i)}sendReceipt(e,t,n,r){if("function"==typeof n&&(r=n,n={}),this.isGuest())return Promise.resolve({});const i=p.encodeUri("/rooms/$roomId/receipt/$receiptType/$eventId",{$roomId:e.getRoomId(),$receiptType:t,$eventId:e.getId()}),s=this.http.authedRequest(r,_.Method.Post,i,void 0,n||{}),o=this.getRoom(e.getRoomId());return o&&o.addLocalEchoReceipt(this.credentials.userId,e,t),s}async sendReadReceipt(e,t,n){"function"==typeof t&&(n=t,t={}),t||(t={});const r=e.getId(),i=this.getRoom(e.getRoomId());if(i&&i.hasPendingEvent(r))throw new Error(`Cannot set read receipt to a pending event (${r})`);const s={"org.matrix.msc2285.hidden":Boolean(t.hidden)};return this.sendReceipt(e,"m.read",s,n)}async setRoomReadMarkers(e,t,n,r){const i=this.getRoom(e);if(i&&i.hasPendingEvent(t))throw new Error(`Cannot set read marker to a pending event (${t})`);let s;if(n){if(s=n.getId(),i&&i.hasPendingEvent(s))throw new Error(`Cannot set read receipt to a pending event (${s})`);i&&i.addLocalEchoReceipt(this.credentials.userId,n,"m.read")}return this.setRoomReadMarkersHttpRequest(e,t,s,r)}getUrlPreview(e,t,n){t=6e4*Math.floor(t/6e4);const r=new URL(e);r.hash="";const i=t+"_"+(e=r.toString()),s=this.urlPreviewCache[i];if(s)return n&&s.then(n).catch(n),s;const o=this.http.authedRequest(n,_.Method.Get,"/preview_url",{url:e,ts:t.toString()},void 0,{prefix:_.PREFIX_MEDIA_R0});return this.urlPreviewCache[i]=o,o}sendTyping(e,t,n,r){if(this.isGuest())return Promise.resolve({});const i=p.encodeUri("/rooms/$roomId/typing/$userId",{$roomId:e,$userId:this.credentials.userId}),s={typing:t};return t&&(s.timeout=n||2e4),this.http.authedRequest(r,_.Method.Put,i,void 0,s)}getRoomUpgradeHistory(e,t=!1){let n=this.getRoom(e);if(!n)return[];const r=[n];let i=n.currentState.getStateEvents(M.EventType.RoomCreate,"");for(;i;){const e=i.getContent().predecessor;if(!e||!e.room_id)break;{const n=this.getRoom(e.room_id);if(!n)break;if(t){const e=n.currentState.getStateEvents(M.EventType.RoomTombstone,"");if(!e||e.getContent().replacement_room!==n.roomId)break}r.splice(0,0,n),i=n.currentState.getStateEvents(M.EventType.RoomCreate,"")}}let s=n.currentState.getStateEvents(M.EventType.RoomTombstone,"");for(;s;){const e=this.getRoom(s.getContent().replacement_room);if(!e)break;if(e.roomId===n.roomId)break;if(t){if(i=e.currentState.getStateEvents(M.EventType.RoomCreate,""),!i||!i.getContent().predecessor)break;if(i.getContent().predecessor.room_id!==n.roomId)break}if(r.push(e),new Set(r.map((e=>e.roomId))).size<r.length)return r.slice(0,r.length-1);n=e,s=n.currentState.getStateEvents(M.EventType.RoomTombstone,"")}return r}invite(e,t,n,r){return this.membershipChange(e,t,"invite",r,n)}inviteByEmail(e,t,n){return this.inviteByThreePid(e,"email",t,n)}async inviteByThreePid(e,t,n,r){const i=p.encodeUri("/rooms/$roomId/invite",{$roomId:e}),s=this.getIdentityServerUrl(!0);if(!s)return Promise.reject(new _.MatrixError({error:"No supplied identity server URL",errcode:"ORG.MATRIX.JSSDK_MISSING_PARAM"}));const o={id_server:s,medium:t,address:n};if(this.identityServer&&this.identityServer.getAccessToken&&await this.doesServerAcceptIdentityAccessToken()){const e=await this.identityServer.getAccessToken();e&&(o.id_access_token=e)}return this.http.authedRequest(r,_.Method.Post,i,void 0,o)}leave(e,t){return this.membershipChange(e,void 0,"leave",void 0,t)}leaveRoomChain(e,t=!0){const n=this.getRoomUpgradeHistory(e);let r=n;if(!t){r=[];for(const t of n)if(r.push(t),t.roomId===e)break}const i={},s=[],o=e=>this.leave(e).then((()=>{i[e]=null})).catch((t=>(i[e]=t,null)));for(const e of r)s.push(o(e.roomId));return Promise.all(s).then((()=>i))}ban(e,t,n,r){return this.membershipChange(e,t,"ban",n,r)}forget(e,t,n){void 0===t&&(t=!0);const r=this.membershipChange(e,void 0,"forget",void 0,n);return t?r.then((t=>(this.store.removeRoom(e),this.emit("deleteRoom",e),t))):r}unban(e,t,n){const r=p.encodeUri("/rooms/$roomId/unban",{$roomId:e}),i={user_id:t};return this.http.authedRequest(n,_.Method.Post,r,void 0,i)}kick(e,t,n,r){const i=p.encodeUri("/rooms/$roomId/kick",{$roomId:e}),s={user_id:t,reason:n};return this.http.authedRequest(r,_.Method.Post,i,void 0,s)}setMembershipState(e,t,n,r,i){p.isFunction(r)&&(i=r,r=void 0);const s=p.encodeUri("/rooms/$roomId/state/m.room.member/$userId",{$roomId:e,$userId:t});return this.http.authedRequest(i,_.Method.Put,s,void 0,{membership:n,reason:r})}membershipChange(e,t,n,r,i){p.isFunction(r)&&(i=r,r=void 0);const s=p.encodeUri("/rooms/$room_id/$membership",{$room_id:e,$membership:n});return this.http.authedRequest(i,_.Method.Post,s,void 0,{user_id:t,reason:r})}getPushActionsForEvent(e,t=!1){return e.getPushActions()&&!t||e.setPushActions(this.pushProcessor.actionsForEvent(e)),e.getPushActions()}setProfileInfo(e,t,n){const r=p.encodeUri("/profile/$userId/$info",{$userId:this.credentials.userId,$info:e});return this.http.authedRequest(n,_.Method.Put,r,void 0,t)}async setDisplayName(e,t){const n=await this.setProfileInfo("displayname",{displayname:e},t),r=this.getUser(this.getUserId());return r&&(r.displayName=e,r.emit("User.displayName",r.events.presence,r)),n}async setAvatarUrl(e,t){const n=await this.setProfileInfo("avatar_url",{avatar_url:e},t),r=this.getUser(this.getUserId());return r&&(r.avatarUrl=e,r.emit("User.avatarUrl",r.events.presence,r)),n}mxcUrlToHttp(e,t,n,r,i){return(0,C.getHttpUriForMxc)(this.baseUrl,e,t,n,r,i)}_unstable_setStatusMessage(e){const t="im.vector.user_status";return Promise.all(this.getRooms().map((async n=>{const r="join"===n.getMyMembership(),i=2===n.getInvitedAndJoinedMemberCount();r&&i&&n.currentState.mayClientSendStateEvent(t,this)&&await this.sendStateEvent(n.roomId,t,{status:e},this.getUserId())}))).then()}setPresence(e,t){const n=p.encodeUri("/presence/$userId/status",{$userId:this.credentials.userId});if("string"==typeof e&&(e={presence:e}),-1===["offline","online","unavailable"].indexOf(e.presence))throw new Error("Bad presence value: "+e.presence);return this.http.authedRequest(t,_.Method.Put,n,void 0,e)}getPresence(e,t){const n=p.encodeUri("/presence/$userId/status",{$userId:e});return this.http.authedRequest(t,_.Method.Get,n,void 0,void 0)}scrollback(e,t=30,n){p.isFunction(t)&&(n=t,t=void 0);let r=0,i=this.ongoingScrollbacks[e.roomId]||{};if(i.promise)return i.promise;if(i.errorTs){const e=Date.now()-i.errorTs;r=Math.max(3e3-e,0)}if(null===e.oldState.paginationToken)return Promise.resolve(e);const s=this.store.scrollback(e,t).length;if(s===t)return Promise.resolve(e);t-=s;const o=new Promise(((i,s)=>{(0,p.sleep)(r).then((()=>this.createMessagesRequest(e.roomId,e.oldState.paginationToken,t,m.Direction.Backward))).then((async t=>{var r;const s=t.chunk.map(this.getEventMapper());if(t.state){const n=t.state.map(this.getEventMapper());e.currentState.setUnknownStateEvents(n)}const[o,a]=this.partitionThreadedEvents(s);e.addEventsToTimeline(o,!0,e.getLiveTimeline()),await this.processThreadEvents(e,a),e.oldState.paginationToken=t.end,0===t.chunk.length&&(e.oldState.paginationToken=null),this.store.storeEvents(e,s,t.end,!0),this.ongoingScrollbacks[e.roomId]=null,null===(r=n)||void 0===r||r(null,e),i(e)})).catch((t=>{var r;this.ongoingScrollbacks[e.roomId]={errorTs:Date.now()},null===(r=n)||void 0===r||r(t),s(t)}))}));return i={promise:o,errorTs:null},this.ongoingScrollbacks[e.roomId]=i,o}getEventMapper(e){return(0,L.eventMapperFor)(this,e||{})}getEventTimeline(e,t){if(!this.timelineSupport)throw new Error("timeline support is disabled. Set the 'timelineSupport' parameter to true when creating MatrixClient to enable it.");if(e.getTimelineForEvent(t))return Promise.resolve(e.getTimelineForEvent(t));const n=p.encodeUri("/rooms/$roomId/context/$eventId",{$roomId:e.room.roomId,$eventId:t});let r;return this.clientOpts.lazyLoadMembers&&(r={filter:JSON.stringify(u.Filter.LAZY_LOADING_MESSAGES_FILTER)}),this.http.authedRequest(void 0,_.Method.Get,n,r).then((async n=>{if(!n.event)throw new Error("'event' not in '/context' result - homeserver too old?");if(e.getTimelineForEvent(t))return e.getTimelineForEvent(t);n.events_after.reverse();const r=n.events_after.concat([n.event]).concat(n.events_before).map(this.getEventMapper());let i=e.getTimelineForEvent(r[0].getId());if(i){const e=n.state.map(this.getEventMapper());i.getState(m.EventTimeline.BACKWARDS).setUnknownStateEvents(e)}else i=e.addTimeline(),i.initialiseState(n.state.map(this.getEventMapper())),i.getState(m.EventTimeline.FORWARDS).paginationToken=n.end;const[s,o]=this.partitionThreadedEvents(r);return e.addEventsToTimeline(s,!0,i,n.start),await this.processThreadEvents(e.room,o),e.getTimelineForEvent(t)||i}))}createMessagesRequest(e,t,n=30,r,i){const s=p.encodeUri("/rooms/$roomId/messages",{$roomId:e}),o={limit:n.toString(),dir:r};t&&(o.from=t);let a=null;var l;return this.clientOpts.lazyLoadMembers&&(a=Object.assign({},u.Filter.LAZY_LOADING_MESSAGES_FILTER)),i&&(a=a||{},Object.assign(a,null===(l=i.getRoomTimelineFilterComponent())||void 0===l?void 0:l.toJSON())),a&&(o.filter=JSON.stringify(a)),this.http.authedRequest(void 0,_.Method.Get,s,o)}paginateEventTimeline(e,t){const n=e.getTimelineSet()===this.notifTimelineSet,r=(t=t||{}).backwards||!1;if(n&&!r)throw new Error("paginateNotifTimeline can only paginate backwards");const i=r?m.EventTimeline.BACKWARDS:m.EventTimeline.FORWARDS,s=e.getPaginationToken(i),o=e.paginationRequests[i];if(o)return o;let a,l,c;if(n){var d;a="/notifications",l={limit:(null!==(d=t.limit)&&void 0!==d?d:30).toString(),only:"highlight"},s&&"end"!==s&&(l.from=s),c=this.http.authedRequest(void 0,_.Method.Get,"/notifications",l,void 0).then((async t=>{const n=t.next_token,s=[];for(let e=0;e<t.notifications.length;e++){const n=t.notifications[e],r=this.getEventMapper()(n.event);r.setPushActions(g.PushProcessor.actionListToActionsObject(n.actions)),r.event.room_id=n.room_id,s[e]=r}const[o,a]=this.partitionThreadedEvents(s),l=e.getTimelineSet();return l.addEventsToTimeline(o,r,e,n),await this.processThreadEvents(l.room,a),r&&!t.next_token&&e.setPaginationToken(null,i),!!t.next_token})).finally((()=>{e.paginationRequests[i]=null})),e.paginationRequests[i]=c}else{const n=this.getRoom(e.getRoomId());if(!n)throw new Error("Unknown room "+e.getRoomId());c=this.createMessagesRequest(e.getRoomId(),s,t.limit,i,e.getFilter()).then((async t=>{if(t.state){const n=e.getState(i),r=t.state.map(this.getEventMapper());n.setUnknownStateEvents(r)}const s=t.end,o=t.chunk.map(this.getEventMapper()),[a,l]=this.partitionThreadedEvents(o);return e.getTimelineSet().addEventsToTimeline(a,r,e,s),await this.processThreadEvents(n,l),r&&t.end==t.start&&e.setPaginationToken(null,i),t.end!=t.start})).finally((()=>{e.paginationRequests[i]=null})),e.paginationRequests[i]=c}return c}resetNotifTimelineSet(){this.notifTimelineSet&&this.notifTimelineSet.resetLiveTimeline("end",null)}peekInRoom(e){return this.peekSync&&this.peekSync.stopPeeking(),this.peekSync=new a.SyncApi(this,this.clientOpts),this.peekSync.peek(e)}stopPeeking(){this.peekSync&&(this.peekSync.stopPeeking(),this.peekSync=null)}setGuestAccess(e,t){const n=this.sendStateEvent(e,M.EventType.RoomGuestAccess,{guest_access:t.allowJoin?"can_join":"forbidden"},"");let r=Promise.resolve(void 0);return t.allowRead&&(r=this.sendStateEvent(e,M.EventType.RoomHistoryVisibility,{history_visibility:"world_readable"},"")),Promise.all([r,n]).then()}requestRegisterEmailToken(e,t,n,r){return this.requestTokenFromEndpoint("/register/email/requestToken",{email:e,client_secret:t,send_attempt:n,next_link:r})}requestRegisterMsisdnToken(e,t,n,r,i){return this.requestTokenFromEndpoint("/register/msisdn/requestToken",{country:e,phone_number:t,client_secret:n,send_attempt:r,next_link:i})}requestAdd3pidEmailToken(e,t,n,r){return this.requestTokenFromEndpoint("/account/3pid/email/requestToken",{email:e,client_secret:t,send_attempt:n,next_link:r})}requestAdd3pidMsisdnToken(e,t,n,r,i){return this.requestTokenFromEndpoint("/account/3pid/msisdn/requestToken",{country:e,phone_number:t,client_secret:n,send_attempt:r,next_link:i})}requestPasswordEmailToken(e,t,n,r){return this.requestTokenFromEndpoint("/account/password/email/requestToken",{email:e,client_secret:t,send_attempt:n,next_link:r})}requestPasswordMsisdnToken(e,t,n,r,i){return this.requestTokenFromEndpoint("/account/password/msisdn/requestToken",{country:e,phone_number:t,client_secret:n,send_attempt:r,next_link:i})}async requestTokenFromEndpoint(e,t){const n=Object.assign({},t);if(!await this.doesServerSupportSeparateAddAndBind()&&this.idBaseUrl){const e=new URL(this.idBaseUrl);if(n.id_server=e.host,this.identityServer&&this.identityServer.getAccessToken&&await this.doesServerAcceptIdentityAccessToken()){const e=await this.identityServer.getAccessToken();e&&(n.id_access_token=e)}}return this.http.request(void 0,_.Method.Post,e,void 0,n)}getRoomPushRule(e,t){if(!this.pushRules)throw new Error("SyncApi.sync() must be done before accessing to push rules.");for(let n=0;n<this.pushRules[e].room.length;n++){const r=this.pushRules[e].room[n];if(r.rule_id===t)return r}}setRoomMutePushRule(e,t,n){let r,i;const s=this.getRoomPushRule(e,t);if(s&&0<=s.actions.indexOf("dont_notify")&&(i=!0),n)if(s){if(!i){const n=p.defer();this.deletePushRule(e,B.PushRuleKind.RoomSpecific,s.rule_id).then((()=>{this.addPushRule(e,B.PushRuleKind.RoomSpecific,t,{actions:["dont_notify"]}).then((()=>{n.resolve()})).catch((e=>{n.reject(e)}))})).catch((e=>{n.reject(e)})),r=n.promise}}else r=this.addPushRule(e,B.PushRuleKind.RoomSpecific,t,{actions:["dont_notify"]});else i&&(r=this.deletePushRule(e,B.PushRuleKind.RoomSpecific,s.rule_id));if(r)return new Promise(((e,t)=>{r.then((()=>{this.getPushRules().then((t=>{this.pushRules=t,e()})).catch((e=>{t(e)}))})).catch((e=>{this.getPushRules().then((n=>{this.pushRules=n,t(e)})).catch((n=>{t(e)}))}))}))}searchMessageText(e,t){const n={search_term:e.query};return"keys"in e&&(n.keys=e.keys),this.search({body:{search_categories:{room_events:n}}},t)}searchRoomEvents(e){const t={search_categories:{room_events:{search_term:e.term,filter:e.filter,order_by:U.SearchOrderBy.Recent,event_context:{before_limit:1,after_limit:1,include_profile:!0}}}},n={_query:t,results:[],highlights:[]};return this.search({body:t}).then((e=>this.processRoomEventsSearch(n,e)))}backPaginateRoomEventsSearch(e){if(!e.next_batch)return Promise.reject(new Error("Cannot backpaginate event search any further"));if(e.pendingRequest)return e.pendingRequest;const t={body:e._query,next_batch:e.next_batch},n=this.search(t).then((t=>this.processRoomEventsSearch(e,t))).finally((()=>{e.pendingRequest=null}));return e.pendingRequest=n,n}processRoomEventsSearch(e,t){const n=t.search_categories.room_events;e.count=n.count,e.next_batch=n.next_batch;const r=new Set(n.highlights);e.highlights.forEach((e=>{r.add(e)})),e.highlights=Array.from(r);const i=n.results?n.results.length:0;for(let t=0;t<i;t++){const r=A.SearchResult.fromJson(n.results[t],this.getEventMapper()),i=this.getRoom(r.context.getEvent().getRoomId());if(i)for(const e of r.context.getTimeline()){const t=i.getMember(e.getSender());!e.sender&&t&&(e.sender=t)}e.results.push(r)}return e}syncLeftRooms(){if(this.syncedLeftRooms)return Promise.resolve([]);if(this.syncLeftRoomsPromise)return this.syncLeftRoomsPromise;const e=new a.SyncApi(this,this.clientOpts);return this.syncLeftRoomsPromise=e.syncLeftRooms(),this.syncLeftRoomsPromise.then((e=>{w.logger.log("Marking success of sync left room request"),this.syncedLeftRooms=!0})).finally((()=>{this.syncLeftRoomsPromise=null})),this.syncLeftRoomsPromise}createFilter(e){const t=p.encodeUri("/user/$userId/filter",{$userId:this.credentials.userId});return this.http.authedRequest(void 0,_.Method.Post,t,void 0,e).then((t=>{const n=u.Filter.fromJson(this.credentials.userId,t.filter_id,e);return this.store.storeFilter(n),n}))}getFilter(e,t,n){if(n){const n=this.store.getFilter(e,t);if(n)return Promise.resolve(n)}const r=p.encodeUri("/user/$userId/filter/$filterId",{$userId:e,$filterId:t});return this.http.authedRequest(void 0,_.Method.Get,r,void 0,void 0).then((n=>{const r=u.Filter.fromJson(e,t,n);return this.store.storeFilter(r),r}))}async getOrCreateFilter(e,t){const n=this.store.getFilterIdByName(e);let r;if(n){try{const e=await this.getFilter(this.credentials.userId,n,!0);if(e){const i=e.getDefinition(),s=t.getDefinition();p.deepCompare(i,s)&&(r=n)}}catch(e){if("M_UNKNOWN"!==e.errcode&&"M_NOT_FOUND"!==e.errcode)throw e}r||this.store.setFilterIdByName(e,void 0)}if(r)return r;const i=await this.createFilter(t.getDefinition());return this.store.setFilterIdByName(e,i.filterId),i.filterId}getOpenIdToken(){const e=p.encodeUri("/user/$userId/openid/request_token",{$userId:this.credentials.userId});return this.http.authedRequest(void 0,_.Method.Post,e,void 0,{})}turnServer(e){return this.http.authedRequest(e,_.Method.Get,"/voip/turnServer")}getTurnServers(){return this.turnServers||[]}getTurnServersExpiry(){return this.turnServersExpiry}async checkTurnServers(){if(!this.canSupportVoip)return;let e=!1;const t=this.turnServersExpiry-Date.now();if(t>W)w.logger.debug("TURN creds are valid for another "+t+" ms: not fetching new ones."),e=!0;else{w.logger.debug("Fetching new TURN credentials");try{const t=await this.turnServer();if(t.uris){w.logger.log("Got TURN URIs: "+t.uris+" refresh in "+t.ttl+" secs");const n={urls:t.uris,username:t.username,credential:t.password};this.turnServers=[n],this.turnServersExpiry=Date.now()+1e3*t.ttl,e=!0}}catch(e){w.logger.error("Failed to get TURN URIs",e),403===e.httpStatus&&(w.logger.info("TURN access unavailable for this account: stopping credentials checks"),null!==this.checkTurnServersIntervalID&&n.g.clearInterval(this.checkTurnServersIntervalID),this.checkTurnServersIntervalID=null)}}return e}setFallbackICEServerAllowed(e){this.fallbackICEServerAllowed=e}isFallbackICEServerAllowed(){return this.fallbackICEServerAllowed}isSynapseAdministrator(){const e=p.encodeUri("/_synapse/admin/v1/users/$userId/admin",{$userId:this.getUserId()});return this.http.authedRequest(void 0,_.Method.Get,e,void 0,void 0,{prefix:""}).then((e=>e.admin))}whoisSynapseUser(e){const t=p.encodeUri("/_synapse/admin/v1/whois/$userId",{$userId:e});return this.http.authedRequest(void 0,_.Method.Get,t,void 0,void 0,{prefix:""})}deactivateSynapseUser(e){const t=p.encodeUri("/_synapse/admin/v1/deactivate/$userId",{$userId:e});return this.http.authedRequest(void 0,_.Method.Post,t,void 0,void 0,{prefix:""})}async fetchClientWellKnown(){this.clientWellKnownPromise=f.AutoDiscovery.getRawClientConfig(this.getDomain()),this.clientWellKnown=await this.clientWellKnownPromise,this.emit("WellKnown.client",this.clientWellKnown)}getClientWellKnown(){return this.clientWellKnown}waitForClientWellKnown(){return this.clientWellKnownPromise}storeClientOptions(){const e=["boolean","string","number"],t=Object.entries(this.clientOpts).filter((([t,n])=>e.includes(typeof n))).reduce(((e,[t,n])=>(e[t]=n,e)),{});return this.store.storeClientOptions(t)}async _unstable_getSharedRooms(e){if(!await this.doesServerSupportUnstableFeature("uk.half-shot.msc2666"))throw Error("Server does not support shared_rooms API");const t=p.encodeUri("/uk.half-shot.msc2666/user/shared_rooms/$userId",{$userId:e});return(await this.http.authedRequest(void 0,_.Method.Get,t,void 0,void 0,{prefix:_.PREFIX_UNSTABLE})).joined}getVersions(){return this.serverVersionsPromise||(this.serverVersionsPromise=this.http.request(void 0,_.Method.Get,"/_matrix/client/versions",void 0,void 0,{prefix:""}).catch((e=>{throw this.serverVersionsPromise=null,e}))),this.serverVersionsPromise}async isVersionSupported(e){const{versions:t}=await this.getVersions();return t&&t.includes(e)}async doesServerSupportLazyLoading(){const e=await this.getVersions();if(!e)return!1;const t=e.versions,n=e.unstable_features;return t&&t.includes("r0.5.0")||n&&n["m.lazy_load_members"]}async doesServerRequireIdServerParam(){const e=await this.getVersions();if(!e)return!0;const t=e.versions;if(t&&t.includes("r0.6.0"))return!1;const n=e.unstable_features;return!n||void 0===n["m.require_identity_server"]||n["m.require_identity_server"]}async doesServerAcceptIdentityAccessToken(){const e=await this.getVersions();if(!e)return!1;const t=e.versions,n=e.unstable_features;return t&&t.includes("r0.6.0")||n&&n["m.id_access_token"]}async doesServerSupportSeparateAddAndBind(){const e=await this.getVersions();if(!e)return!1;const t=e.versions,n=e.unstable_features;return t&&t.includes("r0.6.0")||n&&n["m.separate_add_and_bind"]}async doesServerSupportUnstableFeature(e){const t=await this.getVersions();if(!t)return!1;const n=t.unstable_features;return n&&!!n[e]}async doesServerForceEncryptionForPreset(e){const t=await this.getVersions();if(!t)return!1;const n=t.unstable_features,r=e.includes("_chat")?e.substring(0,e.indexOf("_chat")):e;return n&&!!n[`io.element.e2ee_forced.${r}`]}hasLazyLoadMembersEnabled(){return!!this.clientOpts.lazyLoadMembers}setCanResetTimelineCallback(e){this.canResetTimelineCallback=e}getCanResetTimelineCallback(){return this.canResetTimelineCallback}async relations(e,t,n,r,i={}){const s=this.getEncryptedIfNeededEventType(e,r),o=await this.fetchRelations(e,t,n,s,i),a=this.getEventMapper();let l;o.original_event&&(l=a(o.original_event));let c=o.chunk.map(a);if(s===M.EventType.RoomMessageEncrypted){const e=l?c.concat(l):c;await Promise.all(e.map((e=>{if(e.isEncrypted())return new Promise((t=>e.once("Event.decrypted",t)))}))),c=c.filter((e=>e.getType()===r))}return l&&n===M.RelationType.Replace&&(c=c.filter((e=>e.getSender()===l.getSender()))),{originalEvent:l,events:c,nextBatch:o.next_batch,prevBatch:o.prev_batch}}getCrossSigningCacheCallbacks(){var e;return null===(e=this.crypto)||void 0===e?void 0:e.crossSigningInfo.getCacheCallbacks()}generateClientSecret(){return(0,F.randomString)(32)}decryptEventIfNeeded(e,t){return e.shouldAttemptDecryption()&&e.attemptDecryption(this.crypto,t),e.isBeingDecrypted()?e.getDecryptionPromise():Promise.resolve()}termsUrlForService(e,t){switch(e){case S.SERVICE_TYPES.IS:return t+_.PREFIX_IDENTITY_V2+"/terms";case S.SERVICE_TYPES.IM:return t+"/_matrix/integrations/v1/terms";default:throw new Error("Unsupported service type")}}getHomeserverUrl(){return this.baseUrl}getIdentityServerUrl(e=!1){return e&&(this.idBaseUrl.startsWith("http://")||this.idBaseUrl.startsWith("https://"))?this.idBaseUrl.split("://")[1]:this.idBaseUrl}setIdentityServerUrl(e){this.idBaseUrl=p.ensureNoTrailingSlash(e),this.http.setIdBaseUrl(this.idBaseUrl)}getAccessToken(){return this.http.opts.accessToken||null}isLoggedIn(){return void 0!==this.http.opts.accessToken}makeTxnId(){return"m"+(new Date).getTime()+"."+this.txnCtr++}isUsernameAvailable(e){return this.http.authedRequest(void 0,_.Method.Get,"/register/available",{username:e}).then((e=>e.available)).catch((e=>"M_USER_IN_USE"!==e.errcode&&Promise.reject(e)))}register(e,t,n,r,i,s,o,a){!0===i?i={email:!0}:null!=i&&!1!==i||(i={}),"function"==typeof o&&(a=o,o=void 0),n&&(r.session=n);const l={auth:r};return null!=e&&(l.username=e),null!=t&&(l.password=t),i.email&&(l.bind_email=!0),i.msisdn&&(l.bind_msisdn=!0),null!=s&&(l.guest_access_token=s),null!=o&&(l.inhibit_login=o),null!=t&&(l.x_show_msisdn=!0),this.registerRequest(l,void 0,a)}registerGuest(e,t){return(e=e||{}).body=e.body||{},this.registerRequest(e.body,"guest",t)}registerRequest(e,t,n){const r={};return t&&(r.kind=t),this.http.request(n,_.Method.Post,"/register",r,e)}loginFlows(e){return this.http.request(e,_.Method.Get,"/login")}login(e,t,n){const r={type:e};return Object.assign(r,t),this.http.authedRequest(((e,t)=>{t&&t.access_token&&t.user_id&&(this.http.opts.accessToken=t.access_token,this.credentials={userId:t.user_id}),n&&n(e,t)}),_.Method.Post,"/login",void 0,r)}loginWithPassword(e,t,n){return this.login("m.login.password",{user:e,password:t},n)}loginWithSAML2(e,t){return this.login("m.login.saml2",{relay_state:e},t)}getCasLoginUrl(e){return this.getSsoLoginUrl(e,"cas")}getSsoLoginUrl(e,t="sso",n){let r="/login/"+t+"/redirect";return n&&(r+="/"+n),this.http.getUrl(r,{redirectUrl:e},_.PREFIX_R0)}loginWithToken(e,t){return this.login("m.login.token",{token:e},t)}logout(e){return this.http.authedRequest(e,_.Method.Post,"/logout")}deactivateAccount(e,t){if("function"==typeof t)throw new Error("deactivateAccount no longer accepts a callback parameter");const n={};return e&&(n.auth=e),void 0!==t&&(n.erase=t),this.http.authedRequest(void 0,_.Method.Post,"/account/deactivate",void 0,n)}getFallbackAuthUrl(e,t){const n=p.encodeUri("/auth/$loginType/fallback/web",{$loginType:e});return this.http.getUrl(n,{session:t},_.PREFIX_R0)}async createRoom(e,t){const n=(e.invite_3pid||[]).filter((e=>!e.id_access_token));if(n.length>0&&this.identityServer&&this.identityServer.getAccessToken&&await this.doesServerAcceptIdentityAccessToken()){const e=await this.identityServer.getAccessToken();if(e)for(const t of n)t.id_access_token=e}return this.http.authedRequest(t,_.Method.Post,"/createRoom",void 0,e)}async fetchRelations(e,t,n,r,i={}){const s=p.encodeParams(i);let o="/rooms/$roomId/relations/$eventId";null!==n&&(o+="/$relationType"),null!==r&&(o+="/$eventType");const a=p.encodeUri(o+"?"+s,{$roomId:e,$eventId:t,$relationType:n,$eventType:r});return await this.http.authedRequest(void 0,_.Method.Get,a,null,null,{prefix:_.PREFIX_UNSTABLE})}roomState(e,t){const n=p.encodeUri("/rooms/$roomId/state",{$roomId:e});return this.http.authedRequest(t,_.Method.Get,n)}fetchRoomEvent(e,t,n){const r=p.encodeUri("/rooms/$roomId/event/$eventId",{$roomId:e,$eventId:t});return this.http.authedRequest(n,_.Method.Get,r)}members(e,t,n,r,i){const s={};t&&(s.membership=t),n&&(s.not_membership=n),r&&(s.at=r);const o=p.encodeParams(s),a=p.encodeUri("/rooms/$roomId/members?"+o,{$roomId:e});return this.http.authedRequest(i,_.Method.Get,a)}upgradeRoom(e,t){const n=p.encodeUri("/rooms/$roomId/upgrade",{$roomId:e});return this.http.authedRequest(void 0,_.Method.Post,n,void 0,{new_version:t})}getStateEvent(e,t,n,r){const i={$roomId:e,$eventType:t,$stateKey:n};let s=p.encodeUri("/rooms/$roomId/state/$eventType",i);return void 0!==n&&(s=p.encodeUri(s+"/$stateKey",i)),this.http.authedRequest(r,_.Method.Get,s)}sendStateEvent(e,t,n,r="",i){const s={$roomId:e,$eventType:t,$stateKey:r};let o=p.encodeUri("/rooms/$roomId/state/$eventType",s);return void 0!==r&&(o=p.encodeUri(o+"/$stateKey",s)),this.http.authedRequest(i,_.Method.Put,o,void 0,n)}roomInitialSync(e,t,n){var r,i;p.isFunction(t)&&(n=t,t=void 0);const s=p.encodeUri("/rooms/$roomId/initialSync",{$roomId:e});return this.http.authedRequest(n,_.Method.Get,s,{limit:null!==(r=null===(i=t)||void 0===i?void 0:i.toString())&&void 0!==r?r:"30"})}setRoomReadMarkersHttpRequest(e,t,n,r){const i=p.encodeUri("/rooms/$roomId/read_markers",{$roomId:e}),s={"m.fully_read":t,"m.read":n,"org.matrix.msc2285.hidden":Boolean(!!r&&r.hidden)};return this.http.authedRequest(void 0,_.Method.Post,i,void 0,s)}getJoinedRooms(){const e=p.encodeUri("/joined_rooms",{});return this.http.authedRequest(void 0,_.Method.Get,e)}getJoinedRoomMembers(e){const t=p.encodeUri("/rooms/$roomId/joined_members",{$roomId:e});return this.http.authedRequest(void 0,_.Method.Get,t)}publicRooms(e,t){"function"==typeof e&&(t=e,e={}),void 0===e&&(e={});const n={};return e.server&&(n.server=e.server,delete e.server),0===Object.keys(e).length&&0===Object.keys(n).length?this.http.authedRequest(t,_.Method.Get,"/publicRooms"):this.http.authedRequest(t,_.Method.Post,"/publicRooms",n,e)}createAlias(e,t,n){const r=p.encodeUri("/directory/room/$alias",{$alias:e}),i={room_id:t};return this.http.authedRequest(n,_.Method.Put,r,void 0,i)}deleteAlias(e,t){const n=p.encodeUri("/directory/room/$alias",{$alias:e});return this.http.authedRequest(t,_.Method.Delete,n,void 0,void 0)}unstableGetLocalAliases(e,t){const n=p.encodeUri("/rooms/$roomId/aliases",{$roomId:e}),r=_.PREFIX_UNSTABLE+"/org.matrix.msc2432";return this.http.authedRequest(t,_.Method.Get,n,null,null,{prefix:r})}getRoomIdForAlias(e,t){const n=p.encodeUri("/directory/room/$alias",{$alias:e});return this.http.authedRequest(t,_.Method.Get,n)}resolveRoomAlias(e,t){const n=p.encodeUri("/directory/room/$alias",{$alias:e});return this.http.request(t,_.Method.Get,n)}getRoomDirectoryVisibility(e,t){const n=p.encodeUri("/directory/list/room/$roomId",{$roomId:e});return this.http.authedRequest(t,_.Method.Get,n)}setRoomDirectoryVisibility(e,t,n){const r=p.encodeUri("/directory/list/room/$roomId",{$roomId:e});return this.http.authedRequest(n,_.Method.Put,r,void 0,{visibility:t})}setRoomDirectoryVisibilityAppService(e,t,n,r){const i=p.encodeUri("/directory/list/appservice/$networkId/$roomId",{$networkId:e,$roomId:t});return this.http.authedRequest(r,_.Method.Put,i,void 0,{visibility:n})}searchUserDirectory(e){const t={search_term:e.term};return void 0!==e.limit&&(t.limit=e.limit),this.http.authedRequest(void 0,_.Method.Post,"/user_directory/search",void 0,t)}uploadContent(e,t){return this.http.uploadContent(e,t)}cancelUpload(e){return this.http.cancelUpload(e)}getCurrentUploads(){return this.http.getCurrentUploads()}getProfileInfo(e,t,n){p.isFunction(t)&&(n=t,t=void 0);const r=t?p.encodeUri("/profile/$userId/$info",{$userId:e,$info:t}):p.encodeUri("/profile/$userId",{$userId:e});return this.http.authedRequest(n,_.Method.Get,r)}getThreePids(e){return this.http.authedRequest(e,_.Method.Get,"/account/3pid",void 0,void 0)}addThreePid(e,t,n){const r={threePidCreds:e,bind:t};return this.http.authedRequest(n,_.Method.Post,"/account/3pid",null,r)}async addThreePidOnly(e){const t=await this.isVersionSupported("r0.6.0")?_.PREFIX_R0:_.PREFIX_UNSTABLE;return this.http.authedRequest(void 0,_.Method.Post,"/account/3pid/add",null,e,{prefix:t})}async bindThreePid(e){const t=await this.isVersionSupported("r0.6.0")?_.PREFIX_R0:_.PREFIX_UNSTABLE;return this.http.authedRequest(void 0,_.Method.Post,"/account/3pid/bind",null,e,{prefix:t})}async unbindThreePid(e,t){const n={medium:e,address:t,id_server:this.getIdentityServerUrl(!0)},r=await this.isVersionSupported("r0.6.0")?_.PREFIX_R0:_.PREFIX_UNSTABLE;return this.http.authedRequest(void 0,_.Method.Post,"/account/3pid/unbind",null,n,{prefix:r})}deleteThreePid(e,t){return this.http.authedRequest(void 0,_.Method.Post,"/account/3pid/delete",null,{medium:e,address:t})}setPassword(e,t,n){const r={auth:e,new_password:t};return this.http.authedRequest(n,_.Method.Post,"/account/password",null,r)}getDevices(){return this.http.authedRequest(void 0,_.Method.Get,"/devices",void 0,void 0)}getDevice(e){const t=p.encodeUri("/devices/$device_id",{$device_id:e});return this.http.authedRequest(void 0,_.Method.Get,t,void 0,void 0)}setDeviceDetails(e,t){const n=p.encodeUri("/devices/$device_id",{$device_id:e});return this.http.authedRequest(void 0,_.Method.Put,n,void 0,t)}deleteDevice(e,t){const n=p.encodeUri("/devices/$device_id",{$device_id:e}),r={};return t&&(r.auth=t),this.http.authedRequest(void 0,_.Method.Delete,n,void 0,r)}deleteMultipleDevices(e,t){const n={devices:e};return t&&(n.auth=t),this.http.authedRequest(void 0,_.Method.Post,"/delete_devices",void 0,n)}getPushers(e){return this.http.authedRequest(e,_.Method.Get,"/pushers",void 0,void 0)}setPusher(e,t){return this.http.authedRequest(t,_.Method.Post,"/pushers/set",null,e)}getPushRules(e){return this.http.authedRequest(e,_.Method.Get,"/pushrules/").then((e=>g.PushProcessor.rewriteDefaultRules(e)))}addPushRule(e,t,n,r,i){const s=p.encodeUri("/pushrules/"+e+"/$kind/$ruleId",{$kind:t,$ruleId:n});return this.http.authedRequest(i,_.Method.Put,s,void 0,r)}deletePushRule(e,t,n,r){const i=p.encodeUri("/pushrules/"+e+"/$kind/$ruleId",{$kind:t,$ruleId:n});return this.http.authedRequest(r,_.Method.Delete,i)}setPushRuleEnabled(e,t,n,r,i){const s=p.encodeUri("/pushrules/"+e+"/$kind/$ruleId/enabled",{$kind:t,$ruleId:n});return this.http.authedRequest(i,_.Method.Put,s,void 0,{enabled:r})}setPushRuleActions(e,t,n,r,i){const s=p.encodeUri("/pushrules/"+e+"/$kind/$ruleId/actions",{$kind:t,$ruleId:n});return this.http.authedRequest(i,_.Method.Put,s,void 0,{actions:r})}search(e,t){const n={};return e.next_batch&&(n.next_batch=e.next_batch),this.http.authedRequest(t,_.Method.Post,"/search",n,e.body)}uploadKeysRequest(e,t,n){return this.http.authedRequest(n,_.Method.Post,"/keys/upload",void 0,e)}uploadKeySignatures(e){return this.http.authedRequest(void 0,_.Method.Post,"/keys/signatures/upload",void 0,e,{prefix:_.PREFIX_UNSTABLE})}downloadKeysForUsers(e,t){if(p.isFunction(t))throw new Error("downloadKeysForUsers no longer accepts a callback parameter");const n={device_keys:{}};return"token"in(t=t||{})&&(n.token=t.token),e.forEach((e=>{n.device_keys[e]=[]})),this.http.authedRequest(void 0,_.Method.Post,"/keys/query",void 0,n)}claimOneTimeKeys(e,t="signed_curve25519",n){const r={};void 0===t&&(t="signed_curve25519");for(let n=0;n<e.length;++n){const i=e[n][0],s=e[n][1],o=r[i]||{};r[i]=o,o[s]=t}const i={one_time_keys:r};return n&&(i.timeout=n),this.http.authedRequest(void 0,_.Method.Post,"/keys/claim",void 0,i)}getKeyChanges(e,t){const n={from:e,to:t};return this.http.authedRequest(void 0,_.Method.Get,"/keys/changes",n,void 0)}uploadDeviceSigningKeys(e,t){const n=Object.assign({},t);return e&&Object.assign(n,{auth:e}),this.http.authedRequest(void 0,_.Method.Post,"/keys/device_signing/upload",void 0,n,{prefix:_.PREFIX_UNSTABLE})}registerWithIdentityServer(e){if(!this.idBaseUrl)throw new Error("No identity server base URL set");const t=this.idBaseUrl+_.PREFIX_IDENTITY_V2+"/account/register";return this.http.requestOtherUrl(void 0,_.Method.Post,t,null,e)}async requestEmailToken(e,t,n,r,i,s){const o={client_secret:t,email:e,send_attempt:null==n?void 0:n.toString(),next_link:r};return await this.http.idServerRequest(i,_.Method.Post,"/validate/email/requestToken",o,_.PREFIX_IDENTITY_V2,s)}async requestMsisdnToken(e,t,n,r,i,s,o){const a={client_secret:n,country:e,phone_number:t,send_attempt:null==r?void 0:r.toString(),next_link:i};return await this.http.idServerRequest(s,_.Method.Post,"/validate/msisdn/requestToken",a,_.PREFIX_IDENTITY_V2,o)}async submitMsisdnToken(e,t,n,r){const i={sid:e,client_secret:t,token:n};return await this.http.idServerRequest(void 0,_.Method.Post,"/validate/msisdn/submitToken",i,_.PREFIX_IDENTITY_V2,r)}submitMsisdnTokenOtherUrl(e,t,n,r){const i={sid:t,client_secret:n,token:r};return this.http.requestOtherUrl(void 0,_.Method.Post,e,void 0,i)}getIdentityHashDetails(e){return this.http.idServerRequest(void 0,_.Method.Get,"/hash_details",null,_.PREFIX_IDENTITY_V2,e)}async identityHashedLookup(e,t){const r={},i=await this.getIdentityHashDetails(t);if(!i||!i.lookup_pepper||!i.algorithms)throw new Error("Unsupported identity server: bad response");r.pepper=i.lookup_pepper;const s={};if(i.algorithms.includes("sha256")){const t=new n.g.Olm.Utility;r.addresses=e.map((e=>{const n=e[0].toLowerCase(),i=e[1].toLowerCase(),o=t.sha256(`${n} ${i} ${r.pepper}`).replace(/\+/g,"-").replace(/\//g,"_");return s[o]=e[0],o})),r.algorithm="sha256"}else{if(!i.algorithms.includes("none"))throw new Error("Unsupported identity server: unknown hash algorithm");r.addresses=e.map((e=>{const t=`${e[0].toLowerCase()} ${e[1].toLowerCase()}`;return s[t]=e[0],t})),r.algorithm="none"}const o=await this.http.idServerRequest(void 0,_.Method.Post,"/lookup",r,_.PREFIX_IDENTITY_V2,t);if(!o||!o.mappings)return[];const a=[];for(const e of Object.keys(o.mappings)){const t=o.mappings[e],n=s[e];if(!n)throw new Error("Identity server returned more results than expected");a.push({address:n,mxid:t})}return a}async lookupThreePid(e,t,n,r){const i=(await this.identityHashedLookup([[t,e]],r)).find((e=>e.address===t));if(!i)return n&&n(null,{}),{};const s={address:t,medium:e,mxid:i.mxid};return n&&n(null,s),s}async bulkLookupThreePids(e,t){const n=await this.identityHashedLookup(e.map((e=>[e[1],e[0]])),t),r=[];for(const t of n){const n=e.find((e=>e[1]===t.address));if(!n)throw new Error("Identity sever returned unexpected results");r.push([n[0],t.address,t.mxid])}return{threepids:r}}getIdentityAccount(e){return this.http.idServerRequest(void 0,_.Method.Get,"/account",void 0,_.PREFIX_IDENTITY_V2,e)}sendToDevice(e,t,n){const r=p.encodeUri("/sendToDevice/$eventType/$txnId",{$eventType:e,$txnId:n||this.makeTxnId()}),i={messages:t},s=Object.keys(t).reduce(((e,n)=>(e[n]=Object.keys(t[n]),e)),{});return w.logger.log(`PUT ${r}`,s),this.http.authedRequest(void 0,_.Method.Put,r,void 0,i)}getThirdpartyProtocols(){return this.http.authedRequest(void 0,_.Method.Get,"/thirdparty/protocols",void 0,void 0).then((e=>{if(!e||"object"!=typeof e)throw new Error(`/thirdparty/protocols did not return an object: ${e}`);return e}))}getThirdpartyLocation(e,t){const n=p.encodeUri("/thirdparty/location/$protocol",{$protocol:e});return this.http.authedRequest(void 0,_.Method.Get,n,t,void 0)}getThirdpartyUser(e,t){const n=p.encodeUri("/thirdparty/user/$protocol",{$protocol:e});return this.http.authedRequest(void 0,_.Method.Get,n,t,void 0)}getTerms(e,t){const n=this.termsUrlForService(e,t);return this.http.requestOtherUrl(void 0,_.Method.Get,n)}agreeToTerms(e,t,n,r){const i=this.termsUrlForService(e,t),s={Authorization:"Bearer "+n};return this.http.requestOtherUrl(void 0,_.Method.Post,i,null,{user_accepts:r},{headers:s})}reportEvent(e,t,n,r){const i=p.encodeUri("/rooms/$roomId/report/$eventId",{$roomId:e,$eventId:t});return this.http.authedRequest(void 0,_.Method.Post,i,null,{score:n,reason:r})}getSpaceSummary(e,t,n,r,i,s){const o=p.encodeUri("/rooms/$roomId/spaces",{$roomId:e});return this.http.authedRequest(void 0,_.Method.Post,o,null,{max_rooms_per_space:t,suggested_only:n,auto_join_only:r,limit:i,batch:s},{prefix:"/_matrix/client/unstable/org.matrix.msc2946"})}getRoomHierarchy(e,t,n,r=!1,i){const s=p.encodeUri("/rooms/$roomId/hierarchy",{$roomId:e});return this.http.authedRequest(void 0,_.Method.Get,s,{suggested_only:String(r),max_depth:null==n?void 0:n.toString(),from:i,limit:null==t?void 0:t.toString()},void 0,{prefix:"/_matrix/client/unstable/org.matrix.msc2946"}).catch((n=>{if("M_UNRECOGNIZED"===n.errcode)return this.getSpaceSummary(e,void 0,r,void 0,t).then((({rooms:e,events:t})=>{const n=new Map(e.map((e=>[e.room_id,V(V({},e),{},{children_state:[]})])));return t.forEach((e=>{var t;null===(t=n.get(e.room_id))||void 0===t||t.children_state.push(e)})),{rooms:Array.from(n.values())}}));throw n}))}async unstableCreateFileTree(e){const{room_id:t}=await this.createRoom({name:e,preset:D.Preset.PrivateChat,power_level_content_override:V(V({},j.DEFAULT_TREE_POWER_LEVELS_TEMPLATE),{},{users:{[this.getUserId()]:100}}),creation_content:{[M.RoomCreateTypeField]:M.RoomType.Space},initial_state:[{type:M.UNSTABLE_MSC3088_PURPOSE.name,state_key:M.UNSTABLE_MSC3089_TREE_SUBTYPE.name,content:{[M.UNSTABLE_MSC3088_ENABLED.name]:!0}},{type:M.EventType.RoomEncryption,state_key:"",content:{algorithm:y.MEGOLM_ALGORITHM}}]});return new j.MSC3089TreeSpace(this,t)}unstableGetFileTreeSpace(e){var t,n;const r=this.getRoom(e);if("join"!==(null==r?void 0:r.getMyMembership()))return null;const i=r.currentState.getStateEvents(M.EventType.RoomCreate,""),s=r.currentState.getStateEvents(M.UNSTABLE_MSC3088_PURPOSE.name,M.UNSTABLE_MSC3089_TREE_SUBTYPE.name);if(!i)throw new Error("Expected single room create event");return null!=s&&null!==(t=s.getContent())&&void 0!==t&&t[M.UNSTABLE_MSC3088_ENABLED.name]?(null===(n=i.getContent())||void 0===n?void 0:n[M.RoomCreateTypeField])!==M.RoomType.Space?null:new j.MSC3089TreeSpace(this,e):null}getGroupSummary(e){const t=p.encodeUri("/groups/$groupId/summary",{$groupId:e});return this.http.authedRequest(void 0,_.Method.Get,t)}getGroupProfile(e){const t=p.encodeUri("/groups/$groupId/profile",{$groupId:e});return this.http.authedRequest(void 0,_.Method.Get,t)}setGroupProfile(e,t){const n=p.encodeUri("/groups/$groupId/profile",{$groupId:e});return this.http.authedRequest(void 0,_.Method.Post,n,void 0,t)}setGroupJoinPolicy(e,t){const n=p.encodeUri("/groups/$groupId/settings/m.join_policy",{$groupId:e});return this.http.authedRequest(void 0,_.Method.Put,n,void 0,{"m.join_policy":t})}getGroupUsers(e){const t=p.encodeUri("/groups/$groupId/users",{$groupId:e});return this.http.authedRequest(void 0,_.Method.Get,t)}getGroupInvitedUsers(e){const t=p.encodeUri("/groups/$groupId/invited_users",{$groupId:e});return this.http.authedRequest(void 0,_.Method.Get,t)}getGroupRooms(e){const t=p.encodeUri("/groups/$groupId/rooms",{$groupId:e});return this.http.authedRequest(void 0,_.Method.Get,t)}inviteUserToGroup(e,t){const n=p.encodeUri("/groups/$groupId/admin/users/invite/$userId",{$groupId:e,$userId:t});return this.http.authedRequest(void 0,_.Method.Put,n,void 0,{})}removeUserFromGroup(e,t){const n=p.encodeUri("/groups/$groupId/admin/users/remove/$userId",{$groupId:e,$userId:t});return this.http.authedRequest(void 0,_.Method.Put,n,void 0,{})}addUserToGroupSummary(e,t,n){const r=p.encodeUri(n?"/groups/$groupId/summary/$roleId/users/$userId":"/groups/$groupId/summary/users/$userId",{$groupId:e,$roleId:n,$userId:t});return this.http.authedRequest(void 0,_.Method.Put,r,void 0,{})}removeUserFromGroupSummary(e,t){const n=p.encodeUri("/groups/$groupId/summary/users/$userId",{$groupId:e,$userId:t});return this.http.authedRequest(void 0,_.Method.Delete,n,void 0,{})}addRoomToGroupSummary(e,t,n){const r=p.encodeUri(n?"/groups/$groupId/summary/$categoryId/rooms/$roomId":"/groups/$groupId/summary/rooms/$roomId",{$groupId:e,$categoryId:n,$roomId:t});return this.http.authedRequest(void 0,_.Method.Put,r,void 0,{})}removeRoomFromGroupSummary(e,t){const n=p.encodeUri("/groups/$groupId/summary/rooms/$roomId",{$groupId:e,$roomId:t});return this.http.authedRequest(void 0,_.Method.Delete,n,void 0,{})}addRoomToGroup(e,t,n){void 0===n&&(n=!0);const r=p.encodeUri("/groups/$groupId/admin/rooms/$roomId",{$groupId:e,$roomId:t});return this.http.authedRequest(void 0,_.Method.Put,r,void 0,{"m.visibility":{type:n?"public":"private"}})}updateGroupRoomVisibility(e,t,n){const r=p.encodeUri("/groups/$groupId/admin/rooms/$roomId/config/m.visibility",{$groupId:e,$roomId:t});return this.http.authedRequest(void 0,_.Method.Put,r,void 0,{type:n?"public":"private"})}removeRoomFromGroup(e,t){const n=p.encodeUri("/groups/$groupId/admin/rooms/$roomId",{$groupId:e,$roomId:t});return this.http.authedRequest(void 0,_.Method.Delete,n,void 0,{})}acceptGroupInvite(e,t=null){const n=p.encodeUri("/groups/$groupId/self/accept_invite",{$groupId:e});return this.http.authedRequest(void 0,_.Method.Put,n,void 0,t||{})}joinGroup(e){const t=p.encodeUri("/groups/$groupId/self/join",{$groupId:e});return this.http.authedRequest(void 0,_.Method.Put,t,void 0,{})}leaveGroup(e){const t=p.encodeUri("/groups/$groupId/self/leave",{$groupId:e});return this.http.authedRequest(void 0,_.Method.Put,t,void 0,{})}getJoinedGroups(){const e=p.encodeUri("/joined_groups",{});return this.http.authedRequest(void 0,_.Method.Get,e)}createGroup(e){const t=p.encodeUri("/create_group",{});return this.http.authedRequest(void 0,_.Method.Post,t,void 0,e)}getPublicisedGroups(e){const t=p.encodeUri("/publicised_groups",{});return this.http.authedRequest(void 0,_.Method.Post,t,void 0,{user_ids:e})}setGroupPublicity(e,t){const n=p.encodeUri("/groups/$groupId/self/update_publicity",{$groupId:e});return this.http.authedRequest(void 0,_.Method.Put,n,void 0,{publicise:t})}supportsExperimentalThreads(){var e;return(null===(e=this.clientOpts)||void 0===e?void 0:e.experimentalThreadSupport)||!1}async getRoomSummary(e,t){const n=p.encodeUri("/rooms/$roomid/summary",{$roomid:e});return this.http.authedRequest(void 0,_.Method.Get,n,{via:t},null,{qsStringifyOptions:{arrayFormat:"repeat"},prefix:"/_matrix/client/unstable/im.nheko.summary"})}findThreadRoots(e){const t=new Set;for(const n of e)n.isThreadRelation&&t.add(n.relationEventId);return t}partitionThreadedEvents(e){if(this.supportsExperimentalThreads()){const t=this.findThreadRoots(e);return e.reduce(((n,r)=>{const i=this.getRoom(r.getRoomId());let s=r.isThreadRelation;if(!s){const o=r.parentEventId,a=(null==i?void 0:i.findEventById(o))||e.find((e=>e.getId()===o));if(((null==a?void 0:a.isThreadRoot)||t.has(r.relationEventId))&&!r.isThreadRelation&&r.relationEventId){const e=r.toSnapshot();e.setThreadId(o),n[1].push(e)}else null!=a&&a.isThreadRelation&&(s=!0,r.setThreadId(a.threadRootId))}return n[s?1:0].push(r),n}),[[],[]])}return[e,[]]}async processThreadEvents(e,t){t.sort(((e,t)=>e.getTs()-t.getTs()));for(const n of t)await e.addThreadedEvent(n)}async whoami(){return this.http.authedRequest(void 0,_.Method.Get,"/account/whoami")}async timestampToEvent(e,t,n){const r=p.encodeUri("/rooms/$roomId/timestamp_to_event",{$roomId:e});return await this.http.authedRequest(void 0,_.Method.Get,r,{ts:t.toString(),dir:n},void 0,{prefix:"/_matrix/client/unstable/org.matrix.msc3030"})}}t.MatrixClient=J,(0,i.default)(J,"RESTORE_BACKUP_ERROR_BAD_KEY","RESTORE_BACKUP_ERROR_BAD_KEY")},4656:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.makeEmoteMessage=function(e){return{msgtype:r.MsgType.Emote,body:e}},t.makeHtmlEmote=function(e,t){return{msgtype:r.MsgType.Emote,format:"org.matrix.custom.html",body:e,formatted_body:t}},t.makeHtmlMessage=function(e,t){return{msgtype:r.MsgType.Text,format:"org.matrix.custom.html",body:e,formatted_body:t}},t.makeHtmlNotice=function(e,t){return{msgtype:r.MsgType.Notice,format:"org.matrix.custom.html",body:e,formatted_body:t}},t.makeLocationContent=function(e,t,n,o,a){return{body:e,msgtype:r.MsgType.Location,geo_uri:t,[s.LOCATION_EVENT_TYPE.name]:{uri:t,description:o},[s.ASSET_NODE_TYPE.name]:{type:null!=a?a:s.ASSET_TYPE_SELF},[i.TEXT_NODE_TYPE.name]:e,[s.TIMESTAMP_NODE_TYPE.name]:n}},t.makeNotice=function(e){return{msgtype:r.MsgType.Notice,body:e}},t.makeTextMessage=function(e){return{msgtype:r.MsgType.Text,body:e}};var r=n(2481),i=n(6548),s=n(6709)},3667:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getHttpUriForMxc=function(e,t,n,i,s,o=!1){if("string"!=typeof t||!t)return"";if(0!==t.indexOf("mxc://"))return o?t:"";let a=t.slice(6),l="/_matrix/media/r0/download/";const c={};n&&(c.width=Math.round(n).toString()),i&&(c.height=Math.round(i).toString()),s&&(c.method=s),Object.keys(c).length>0&&(l="/_matrix/media/r0/thumbnail/");const d=a.indexOf("#");let u="";d>=0&&(u=a.substr(d),a=a.substr(0,d));return e+l+a+(0===Object.keys(c).length?"":"?"+r.encodeParams(c))+u};var r=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var n=i(t);if(n&&n.has(e))return n.get(e);var r={},s=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e)if("default"!==o&&Object.prototype.hasOwnProperty.call(e,o)){var a=s?Object.getOwnPropertyDescriptor(e,o):null;a&&(a.get||a.set)?Object.defineProperty(r,o,a):r[o]=e[o]}return r.default=e,n&&n.set(e,r),r}(n(3102));function i(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(i=function(e){return e?n:t})(e)}},3075:(e,t,n)=>{"use strict";var r=n(5318);Object.defineProperty(t,"__esModule",{value:!0}),t.UserTrustLevel=t.DeviceTrustLevel=t.CrossSigningLevel=t.CrossSigningInfo=void 0,t.createCryptoStoreCacheCallbacks=function(e,t){return{getCrossSigningKeyCache:async function(n,r){const i=await new Promise((t=>e.doTxn("readonly",[l.IndexedDBCryptoStore.STORE_ACCOUNT],(r=>{e.getSecretStorePrivateKey(r,t,n)}))));if(i&&i.ciphertext){const e=Buffer.from(t.pickleKey),r=await(0,c.decryptAES)(i,e,n);return(0,o.decodeBase64)(r)}return i},storeCrossSigningKeyCache:async function(n,r){if(!(r instanceof Uint8Array))throw new Error(`storeCrossSigningKeyCache expects Uint8Array, got ${r}`);const i=Buffer.from(t.pickleKey),s=await(0,c.encryptAES)((0,o.encodeBase64)(r),i,n);return e.doTxn("readwrite",[l.IndexedDBCryptoStore.STORE_ACCOUNT],(t=>{e.storeSecretStorePrivateKey(t,n,s)}))}}},t.requestKeysDuringVerification=function(e,t,n){if(e.getUserId()===t)return a.logger.log("Cross-signing: Self-verification done; requesting keys"),new Promise(((t,r)=>{const i=e,s=i.crypto.crossSigningInfo,l=new u(s.userId,{getCrossSigningKey:async e=>{a.logger.debug("Cross-signing: requesting secret",e,n);const{promise:t}=i.requestSecret(`m.cross_signing.${e}`,[n]),r=await t,s=(0,o.decodeBase64)(r);return Uint8Array.from(s)}},s.getCacheCallbacks());l.keys=s.keys;const c=new Promise((e=>{setTimeout(e,6e4,new Error("Timeout"))})),d=(async()=>{if(!await i.crypto.getSessionBackupPrivateKey()){a.logger.info("No cached backup key found. Requesting...");const e=i.requestSecret("m.megolm_backup.v1",[n]),t=await e.promise;a.logger.info("Got key backup key, decoding...");const r=(0,o.decodeBase64)(t);a.logger.info("Decoded backup key, storing..."),await i.crypto.storeSessionBackupPrivateKey(Uint8Array.from(r)),a.logger.info("Backup key stored. Starting backup restore...");const s=await i.getKeyBackupVersion();i.restoreKeyBackupWithCache(void 0,void 0,s).then((()=>{a.logger.info("Backup restored.")}))}})();return Promise.race([Promise.all([l.getCrossSigningKey("master"),l.getCrossSigningKey("self_signing"),l.getCrossSigningKey("user_signing"),d]),c]).then(t,r)})).catch((e=>{a.logger.warn("Cross-signing: failure while requesting keys:",e)}))};var i=r(n(9713)),s=n(7187),o=n(2772),a=n(7434),l=n(7585),c=n(2611);function d(e){return Object.values(e.keys)[0]}class u extends s.EventEmitter{constructor(e,t={},n={}){super(),this.userId=e,this.callbacks=t,this.cacheCallbacks=n,(0,i.default)(this,"keys",{}),(0,i.default)(this,"firstUse",!0),(0,i.default)(this,"crossSigningVerifiedBefore",!1)}static fromStorage(e,t){const n=new u(t);for(const t in e)e.hasOwnProperty(t)&&(n[t]=e[t]);return n}toStorage(){return{keys:this.keys,firstUse:this.firstUse,crossSigningVerifiedBefore:this.crossSigningVerifiedBefore}}async getCrossSigningKey(e,t){const r=["master","self_signing","user_signing"].indexOf(e)>=0;if(!this.callbacks.getCrossSigningKey)throw new Error("No getCrossSigningKey callback supplied");function i(e){if(!e)return;const r=new n.g.Olm.PkSigning,i=r.init_with_seed(e);if(i===t)return[i,r];r.free()}let s;void 0===t&&(t=this.getId(e)),this.cacheCallbacks.getCrossSigningKeyCache&&r&&(s=await this.cacheCallbacks.getCrossSigningKeyCache(e,t));const o=i(s);if(o)return o;s=await this.callbacks.getCrossSigningKey(e,t);const a=i(s);if(a)return this.cacheCallbacks.storeCrossSigningKeyCache&&r&&await this.cacheCallbacks.storeCrossSigningKeyCache(e,s),a;if(!s)throw new Error("getCrossSigningKey callback for "+e+" returned falsey");throw new Error("Key type "+e+" from getCrossSigningKey callback did not match")}async isStoredInSecretStorage(e){const t=await e.isStored("m.cross_signing.master",!1)||{};function n(e){for(const n of Object.keys(t))e[n]||delete t[n]}for(const t of["self_signing","user_signing"])n(await e.isStored(`m.cross_signing.${t}`,!1)||{});return Object.keys(t).length?t:null}static async storeInSecretStorage(e,t){for(const[n,r]of e){const e=(0,o.encodeBase64)(r);await t.store(`m.cross_signing.${n}`,e)}}static async getFromSecretStorage(e,t){const n=await t.get(`m.cross_signing.${e}`);return n?(0,o.decodeBase64)(n):null}async isStoredInKeyCache(e){const t=this.cacheCallbacks;if(!t)return!1;const n=e?[e]:["master","self_signing","user_signing"];for(const e of n)if(!await t.getCrossSigningKeyCache(e))return!1;return!0}async getCrossSigningKeysFromCache(){const e=new Map,t=this.cacheCallbacks;if(!t)return e;for(const n of["master","self_signing","user_signing"]){const r=await t.getCrossSigningKeyCache(n);r&&e.set(n,r)}return e}getId(e="master"){return this.keys[e]?d(this.keys[e]):null}async resetKeys(e){if(!this.callbacks.saveCrossSigningKeys)throw new Error("No saveCrossSigningKeys callback supplied");if(void 0===e||e&h.MASTER||!this.keys.master)e=h.MASTER|h.USER_SIGNING|h.SELF_SIGNING;else if(0===e)return;const t={},r={};let i,s;try{if(e&h.MASTER?(i=new n.g.Olm.PkSigning,t.master=i.generate_seed(),s=i.init_with_seed(t.master),r.master={user_id:this.userId,usage:["master"],keys:{["ed25519:"+s]:s}}):[s,i]=await this.getCrossSigningKey("master"),e&h.SELF_SIGNING){const e=new n.g.Olm.PkSigning;try{t.self_signing=e.generate_seed();const n=e.init_with_seed(t.self_signing);r.self_signing={user_id:this.userId,usage:["self_signing"],keys:{["ed25519:"+n]:n}},(0,o.pkSign)(r.self_signing,i,this.userId,s)}finally{e.free()}}if(e&h.USER_SIGNING){const e=new n.g.Olm.PkSigning;try{t.user_signing=e.generate_seed();const n=e.init_with_seed(t.user_signing);r.user_signing={user_id:this.userId,usage:["user_signing"],keys:{["ed25519:"+n]:n}},(0,o.pkSign)(r.user_signing,i,this.userId,s)}finally{e.free()}}Object.assign(this.keys,r),this.callbacks.saveCrossSigningKeys(t)}finally{i&&i.free()}}clearKeys(){this.keys={}}setKeys(e){const t={};if(e.master){if(e.master.user_id!==this.userId){const t="Mismatched user ID "+e.master.user_id+" in master key from "+this.userId;throw a.logger.error(t),new Error(t)}this.keys.master?d(e.master)!==this.getId()&&(this.firstUse=!1):this.firstUse=!0,t.master=e.master}else{if(!this.keys.master)throw new Error("Tried to set cross-signing keys without a master key");t.master=this.keys.master}const n=d(t.master);if(e.user_signing){if(e.user_signing.user_id!==this.userId){const t="Mismatched user ID "+e.master.user_id+" in user_signing key from "+this.userId;throw a.logger.error(t),new Error(t)}try{(0,o.pkVerify)(e.user_signing,n,this.userId)}catch(e){throw a.logger.error("invalid signature on user-signing key"),e}}if(e.self_signing){if(e.self_signing.user_id!==this.userId){const t="Mismatched user ID "+e.master.user_id+" in self_signing key from "+this.userId;throw a.logger.error(t),new Error(t)}try{(0,o.pkVerify)(e.self_signing,n,this.userId)}catch(e){throw a.logger.error("invalid signature on self-signing key"),e}}e.master&&(this.keys.master=e.master,this.keys.self_signing=null,this.keys.user_signing=null),e.self_signing&&(this.keys.self_signing=e.self_signing),e.user_signing&&(this.keys.user_signing=e.user_signing)}updateCrossSigningVerifiedBefore(e){!this.crossSigningVerifiedBefore&&e&&(this.crossSigningVerifiedBefore=!0)}async signObject(e,t){if(!this.keys[t])throw new Error("Attempted to sign with "+t+" key but no such key present");const[n,r]=await this.getCrossSigningKey(t);try{return(0,o.pkSign)(e,r,this.userId,n),e}finally{r.free()}}async signUser(e){if(this.keys.user_signing)return this.signObject(e.keys.master,"user_signing");a.logger.info("No user signing key: not signing user")}async signDevice(e,t){if(e!==this.userId)throw new Error(`Trying to sign ${e}'s device; can only sign our own device`);if(this.keys.self_signing)return this.signObject({algorithms:t.algorithms,keys:t.keys,device_id:t.deviceId,user_id:e},"self_signing");a.logger.info("No self signing key: not signing device")}checkUserTrust(e){if(this.userId===e.userId&&this.getId()&&this.getId()===e.getId()&&this.getId("self_signing")&&this.getId("self_signing")===e.getId("self_signing"))return new p(!0,!0,this.firstUse);if(!this.keys.user_signing)return new p(!1,!1,e.firstUse);let t;const n=e.keys.master,r=this.getId("user_signing");try{(0,o.pkVerify)(n,r,this.userId),t=!0}catch(e){t=!1}return new p(t,e.crossSigningVerifiedBefore,e.firstUse)}checkDeviceTrust(e,t,n,r){const i=this.checkUserTrust(e),s=e.keys.self_signing;if(!s)return new m(!1,!1,n,r);const a=function(e,t){return{algorithms:e.algorithms,keys:e.keys,device_id:e.deviceId,user_id:t,signatures:e.signatures}}(t,e.userId);try{return(0,o.pkVerify)(s,e.getId(),e.userId),(0,o.pkVerify)(a,d(s),e.userId),m.fromUserTrustLevel(i,n,r)}catch(e){return new m(!1,!1,n,r)}}getCacheCallbacks(){return this.cacheCallbacks}}let h;t.CrossSigningInfo=u,t.CrossSigningLevel=h,function(e){e[e.MASTER=4]="MASTER",e[e.USER_SIGNING=2]="USER_SIGNING",e[e.SELF_SIGNING=1]="SELF_SIGNING"}(h||(t.CrossSigningLevel=h={}));class p{constructor(e,t,n){this.crossSigningVerified=e,this.crossSigningVerifiedBefore=t,this.tofu=n}isVerified(){return this.isCrossSigningVerified()}isCrossSigningVerified(){return this.crossSigningVerified}wasCrossSigningVerified(){return this.crossSigningVerifiedBefore}isTofu(){return this.tofu}}t.UserTrustLevel=p;class m{constructor(e,t,n,r){this.crossSigningVerified=e,this.tofu=t,this.localVerified=n,this.trustCrossSignedDevices=r}static fromUserTrustLevel(e,t,n){return new m(e.isCrossSigningVerified(),e.isTofu(),t,n)}isVerified(){return Boolean(this.isLocallyVerified()||this.trustCrossSignedDevices&&this.isCrossSigningVerified())}isCrossSigningVerified(){return this.crossSigningVerified}isLocallyVerified(){return this.localVerified}isTofu(){return this.tofu}}t.DeviceTrustLevel=m},6670:(e,t,n)=>{"use strict";var r=n(5318);Object.defineProperty(t,"__esModule",{value:!0}),t.TrackingStatus=t.DeviceList=void 0;var i=r(n(9713)),s=n(7187),o=n(7434),a=n(3272),l=n(3075),c=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var n=h(t);if(n&&n.has(e))return n.get(e);var r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var s in e)if("default"!==s&&Object.prototype.hasOwnProperty.call(e,s)){var o=i?Object.getOwnPropertyDescriptor(e,s):null;o&&(o.get||o.set)?Object.defineProperty(r,s,o):r[s]=e[s]}return r.default=e,n&&n.set(e,r),r}(n(2772)),d=n(7585),u=n(3102);function h(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(h=function(e){return e?n:t})(e)}let p;t.TrackingStatus=p,function(e){e[e.NotTracked=0]="NotTracked",e[e.PendingDownload=1]="PendingDownload",e[e.DownloadInProgress=2]="DownloadInProgress",e[e.UpToDate=3]="UpToDate"}(p||(t.TrackingStatus=p={}));class m extends s.EventEmitter{constructor(e,t,n,r=250){super(),this.cryptoStore=t,this.keyDownloadChunkSize=r,(0,i.default)(this,"devices",{}),(0,i.default)(this,"crossSigningInfo",{}),(0,i.default)(this,"userByIdentityKey",{}),(0,i.default)(this,"deviceTrackingStatus",{}),(0,i.default)(this,"syncToken",null),(0,i.default)(this,"keyDownloadsInProgressByUser",{}),(0,i.default)(this,"dirty",!1),(0,i.default)(this,"savePromise",null),(0,i.default)(this,"resolveSavePromise",null),(0,i.default)(this,"savePromiseTime",null),(0,i.default)(this,"saveTimer",null),(0,i.default)(this,"hasFetched",null),(0,i.default)(this,"serialiser",void 0),this.serialiser=new g(e,n,this)}async load(){await this.cryptoStore.doTxn("readonly",[d.IndexedDBCryptoStore.STORE_DEVICE_DATA],(e=>{this.cryptoStore.getEndToEndDeviceData(e,(e=>{this.hasFetched=Boolean(e&&e.devices),this.devices=e?e.devices:{},this.crossSigningInfo=e&&e.crossSigningInfo||{},this.deviceTrackingStatus=e?e.trackingStatus:{},this.syncToken=e?e.syncToken:null,this.userByIdentityKey={};for(const e of Object.keys(this.devices)){const t=this.devices[e];for(const n of Object.keys(t)){const r=t[n].keys["curve25519:"+n];void 0!==r&&(this.userByIdentityKey[r]=e)}}}))}));for(const e of Object.keys(this.deviceTrackingStatus))this.deviceTrackingStatus[e]==p.DownloadInProgress&&(this.deviceTrackingStatus[e]=p.PendingDownload)}stop(){null!==this.saveTimer&&clearTimeout(this.saveTimer)}async saveIfDirty(e=500){if(!this.dirty)return Promise.resolve(!1);const t=Date.now()+e;this.savePromiseTime&&t<this.savePromiseTime&&(clearTimeout(this.saveTimer),this.saveTimer=null,this.savePromiseTime=null);let n=this.savePromise;if(null===n&&(n=new Promise(((e,t)=>{this.resolveSavePromise=e})),this.savePromise=n),null===this.saveTimer){const n=this.resolveSavePromise;this.savePromiseTime=t,this.saveTimer=setTimeout((()=>{o.logger.log("Saving device tracking data",this.syncToken),this.savePromiseTime=null,this.saveTimer=null,this.savePromise=null,this.resolveSavePromise=null,this.cryptoStore.doTxn("readwrite",[d.IndexedDBCryptoStore.STORE_DEVICE_DATA],(e=>{this.cryptoStore.storeEndToEndDeviceData({devices:this.devices,crossSigningInfo:this.crossSigningInfo,trackingStatus:this.deviceTrackingStatus,syncToken:this.syncToken},e)})).then((()=>{this.dirty=!1,n(!0)}),(e=>{o.logger.error("Failed to save device tracking data",this.syncToken),o.logger.error(e)}))}),e)}return n}getSyncToken(){return this.syncToken}setSyncToken(e){this.syncToken=e}downloadKeys(e,t){const n=[],r=[];if(e.forEach((e=>{const i=this.deviceTrackingStatus[e];this.keyDownloadsInProgressByUser[e]?(o.logger.log(`downloadKeys: already have a download in progress for ${e}: awaiting its result`),r.push(this.keyDownloadsInProgressByUser[e])):(t||i!=p.UpToDate)&&n.push(e)})),0!=n.length){o.logger.log("downloadKeys: downloading for",n);const e=this.doKeyDownload(n);r.push(e)}return 0===r.length&&o.logger.log("downloadKeys: already have all necessary keys"),Promise.all(r).then((()=>this.getDevicesFromStore(e)))}getDevicesFromStore(e){const t={};return e.map((e=>{t[e]={},(this.getStoredDevicesForUser(e)||[]).map((function(n){t[e][n.deviceId]=n}))})),t}getKnownUserIds(){return Object.keys(this.devices)}getStoredDevicesForUser(e){const t=this.devices[e];if(!t)return null;const n=[];for(const e in t)t.hasOwnProperty(e)&&n.push(a.DeviceInfo.fromStorage(t[e],e));return n}getRawStoredDevicesForUser(e){return this.devices[e]}getStoredCrossSigningForUser(e){return this.crossSigningInfo[e]?l.CrossSigningInfo.fromStorage(this.crossSigningInfo[e],e):null}storeCrossSigningForUser(e,t){this.crossSigningInfo[e]=t,this.dirty=!0}getStoredDevice(e,t){const n=this.devices[e];if(n&&n[t])return a.DeviceInfo.fromStorage(n[t],t)}getUserByIdentityKey(e,t){return e!==c.OLM_ALGORITHM&&e!==c.MEGOLM_ALGORITHM?null:this.userByIdentityKey[t]}getDeviceByIdentityKey(e,t){const n=this.getUserByIdentityKey(e,t);if(!n)return null;const r=this.devices[n];if(!r)return null;for(const e in r){if(!r.hasOwnProperty(e))continue;const n=r[e];for(const r in n.keys)if(n.keys.hasOwnProperty(r)&&0===r.indexOf("curve25519:")&&n.keys[r]==t)return a.DeviceInfo.fromStorage(n,e)}return null}storeDevicesForUser(e,t){this.setRawStoredDevicesForUser(e,t),this.dirty=!0}startTrackingDeviceList(e){if("string"!=typeof e)throw new Error("userId must be a string; was "+e);this.deviceTrackingStatus[e]||(o.logger.log("Now tracking device list for "+e),this.deviceTrackingStatus[e]=p.PendingDownload,this.dirty=!0)}stopTrackingDeviceList(e){this.deviceTrackingStatus[e]&&(o.logger.log("No longer tracking device list for "+e),this.deviceTrackingStatus[e]=p.NotTracked,this.dirty=!0)}stopTrackingAllDeviceLists(){for(const e of Object.keys(this.deviceTrackingStatus))this.deviceTrackingStatus[e]=p.NotTracked;this.dirty=!0}invalidateUserDeviceList(e){this.deviceTrackingStatus[e]&&(o.logger.log("Marking device list outdated for",e),this.deviceTrackingStatus[e]=p.PendingDownload,this.dirty=!0)}refreshOutdatedDeviceLists(){this.saveIfDirty();const e=[];for(const t of Object.keys(this.deviceTrackingStatus))this.deviceTrackingStatus[t]==p.PendingDownload&&e.push(t);return this.doKeyDownload(e)}setRawStoredDevicesForUser(e,t){if(void 0!==this.devices[e])for(const[t,n]of Object.entries(this.devices[e])){const e=n.keys["curve25519:"+t];delete this.userByIdentityKey[e]}this.devices[e]=t;for(const[n,r]of Object.entries(t)){const t=r.keys["curve25519:"+n];this.userByIdentityKey[t]=e}}setRawStoredCrossSigningForUser(e,t){this.crossSigningInfo[e]=t}doKeyDownload(e){if(0===e.length)return Promise.resolve();const t=this.serialiser.updateDevicesForUsers(e,this.syncToken).then((()=>{n(!0)}),(t=>{throw o.logger.error("Error downloading keys for "+e+":",t),n(!1),t}));e.forEach((e=>{this.keyDownloadsInProgressByUser[e]=t,this.deviceTrackingStatus[e]==p.PendingDownload&&(this.deviceTrackingStatus[e]=p.DownloadInProgress)}));const n=n=>{this.emit("crypto.willUpdateDevices",e,!this.hasFetched),e.forEach((e=>{this.dirty=!0,this.keyDownloadsInProgressByUser[e]===t?(delete this.keyDownloadsInProgressByUser[e],this.deviceTrackingStatus[e]==p.DownloadInProgress&&(n?(this.deviceTrackingStatus[e]=p.UpToDate,o.logger.log("Device list for",e,"now up to date")):this.deviceTrackingStatus[e]=p.PendingDownload)):o.logger.log("Another update in the queue for",e,"- not marking up-to-date")})),this.saveIfDirty(),this.emit("crypto.devicesUpdated",e,!this.hasFetched),this.hasFetched=!0};return t}}t.DeviceList=m;class g{constructor(e,t,n){this.baseApis=e,this.olmDevice=t,this.deviceList=n,(0,i.default)(this,"downloadInProgress",!1),(0,i.default)(this,"keyDownloadsQueuedByUser",{}),(0,i.default)(this,"queuedQueryDeferred",null),(0,i.default)(this,"syncToken",null)}updateDevicesForUsers(e,t){return e.forEach((e=>{this.keyDownloadsQueuedByUser[e]=!0})),this.queuedQueryDeferred||(this.queuedQueryDeferred=(0,u.defer)()),this.syncToken=t,this.downloadInProgress?(o.logger.log("Queued key download for",e),this.queuedQueryDeferred.promise):this.doQueuedQueries()}doQueuedQueries(){if(this.downloadInProgress)throw new Error("DeviceListUpdateSerialiser.doQueuedQueries called with request active");const e=Object.keys(this.keyDownloadsQueuedByUser);this.keyDownloadsQueuedByUser={};const t=this.queuedQueryDeferred;this.queuedQueryDeferred=null,o.logger.log("Starting key download for",e),this.downloadInProgress=!0;const n={};this.syncToken&&(n.token=this.syncToken);const r=[];for(let t=0;t<e.length;t+=this.deviceList.keyDownloadChunkSize){const i=e.slice(t,t+this.deviceList.keyDownloadChunkSize);r.push((()=>this.baseApis.downloadKeysForUsers(i,n)))}return(0,u.chunkPromises)(r,3).then((async t=>{const n=Object.assign({},...t.map((e=>e.device_keys||{}))),r=Object.assign({},...t.map((e=>e.master_keys||{}))),i=Object.assign({},...t.map((e=>e.self_signing_keys||{}))),s=Object.assign({},...t.map((e=>e.user_signing_keys||{})));for(const t of e){await(0,u.sleep)(5);try{await this.processQueryResponseForUser(t,n[t],{master:r[t],self_signing:i[t],user_signing:s[t]})}catch(e){o.logger.error(`Error processing keys for ${t}:`,e)}}})).then((()=>{o.logger.log("Completed key download for "+e),this.downloadInProgress=!1,t.resolve(),this.queuedQueryDeferred&&this.doQueuedQueries()}),(n=>{o.logger.warn("Error downloading keys for "+e+":",n),this.downloadInProgress=!1,t.reject(n)})),t.promise}async processQueryResponseForUser(e,t,n){o.logger.log("got device keys for "+e+":",t),o.logger.log("got cross-signing keys for "+e+":",n);{const n={},r=this.deviceList.getRawStoredDevicesForUser(e);r&&Object.keys(r).forEach((e=>{const t=a.DeviceInfo.fromStorage(r[e],e);n[e]=t})),await async function(e,t,n,r,i,s){let a=!1;for(const e in n)if(n.hasOwnProperty(e)&&!(e in r)){if(t===i&&e===s){o.logger.warn(`Local device ${e} missing from sync, skipping removal`);continue}o.logger.log("Device "+t+":"+e+" has been removed"),delete n[e],a=!0}for(const i in r){if(!r.hasOwnProperty(i))continue;const s=r[i];s.user_id===t?s.device_id===i?await f(e,n,s)&&(a=!0):o.logger.warn("Mismatched device_id "+s.device_id+" in keys from "+t+":"+i):o.logger.warn("Mismatched user_id "+s.user_id+" in keys from "+t+":"+i)}return a}(this.olmDevice,e,n,t||{},this.baseApis.getUserId(),this.baseApis.deviceId);const i={};Object.keys(n).forEach((e=>{i[e]=n[e].toStorage()})),this.deviceList.setRawStoredDevicesForUser(e,i)}if(n&&(n.master||n.self_signing||n.user_signing)){const t=this.deviceList.getStoredCrossSigningForUser(e)||new l.CrossSigningInfo(e);t.setKeys(n),this.deviceList.setRawStoredCrossSigningForUser(e,t.toStorage()),this.deviceList.emit("userCrossSigningUpdated",e)}}}async function f(e,t,n){if(!n.keys)return!1;const r=n.device_id,i=n.user_id,s="ed25519:"+r,l=n.keys[s];if(!l)return o.logger.warn("Device "+i+":"+r+" has no ed25519 key"),!1;const d=n.unsigned||{},u=n.signatures||{};try{await c.verifySignature(e,n,i,r,l)}catch(e){return o.logger.warn("Unable to verify signature on device "+i+":"+r+":"+e),!1}let h;if(r in t){if(h=t[r],h.getFingerprint()!=l)return o.logger.warn("Ed25519 key for device "+i+":"+r+" has changed"),!1}else t[r]=h=new a.DeviceInfo(r);return h.keys=n.keys||{},h.algorithms=n.algorithms||[],h.unsigned=d,h.signatures=u,!0}},636:(e,t,n)=>{"use strict";var r=n(5318);Object.defineProperty(t,"__esModule",{value:!0}),t.EncryptionSetupOperation=t.EncryptionSetupBuilder=void 0;var i=r(n(9713)),s=n(7187),o=n(7434),a=n(4369),l=n(3075),c=n(7585),d=n(7715);t.EncryptionSetupBuilder=class{constructor(e,t){(0,i.default)(this,"accountDataClientAdapter",void 0),(0,i.default)(this,"crossSigningCallbacks",void 0),(0,i.default)(this,"ssssCryptoCallbacks",void 0),(0,i.default)(this,"crossSigningKeys",null),(0,i.default)(this,"keySignatures",null),(0,i.default)(this,"keyBackupInfo",null),(0,i.default)(this,"sessionBackupPrivateKey",void 0),this.accountDataClientAdapter=new h(e),this.crossSigningCallbacks=new p,this.ssssCryptoCallbacks=new m(t)}addCrossSigningKeys(e,t){this.crossSigningKeys={authUpload:e,keys:t}}addSessionBackup(e){this.keyBackupInfo=e}addSessionBackupPrivateKeyToCache(e){this.sessionBackupPrivateKey=e}addKeySignature(e,t,n){this.keySignatures||(this.keySignatures={});const r=this.keySignatures[e]||{};this.keySignatures[e]=r,r[t]=n}async setAccountData(e,t){await this.accountDataClientAdapter.setAccountData(e,t)}buildOperation(){const e=this.accountDataClientAdapter.values;return new u(e,this.crossSigningKeys,this.keyBackupInfo,this.keySignatures)}async persist(e){if(this.crossSigningKeys){const t=(0,l.createCryptoStoreCacheCallbacks)(e.cryptoStore,e.olmDevice);for(const e of["master","self_signing","user_signing"]){o.logger.log(`Cache ${e} cross-signing private key locally`);const n=this.crossSigningCallbacks.privateKeys.get(e);await t.storeCrossSigningKeyCache(e,n)}await e.cryptoStore.doTxn("readwrite",[c.IndexedDBCryptoStore.STORE_ACCOUNT],(t=>{e.cryptoStore.storeCrossSigningKeys(t,this.crossSigningKeys.keys)}))}this.sessionBackupPrivateKey&&await e.storeSessionBackupPrivateKey(this.sessionBackupPrivateKey)}};class u{constructor(e,t,n,r){this.accountData=e,this.crossSigningKeys=t,this.keyBackupInfo=n,this.keySignatures=r}async apply(e){const t=e.baseApis;if(this.crossSigningKeys){const n={};for(const[e,t]of Object.entries(this.crossSigningKeys.keys))n[e+"_key"]=t;await this.crossSigningKeys.authUpload((e=>t.uploadDeviceSigningKeys(e,n))),e.crossSigningInfo.setKeys(this.crossSigningKeys.keys)}if(this.accountData)for(const[e,n]of this.accountData)await t.setAccountData(e,n);this.keySignatures&&await t.uploadKeySignatures(this.keySignatures),this.keyBackupInfo&&(this.keyBackupInfo.version?await t.http.authedRequest(void 0,d.Method.Put,"/room_keys/version/"+this.keyBackupInfo.version,void 0,{algorithm:this.keyBackupInfo.algorithm,auth_data:this.keyBackupInfo.auth_data},{prefix:d.PREFIX_UNSTABLE}):await t.http.authedRequest(void 0,d.Method.Post,"/room_keys/version",void 0,this.keyBackupInfo,{prefix:d.PREFIX_UNSTABLE}))}}t.EncryptionSetupOperation=u;class h extends s.EventEmitter{constructor(e){super(),this.existingValues=e,(0,i.default)(this,"values",new Map)}getAccountDataFromServer(e){return Promise.resolve(this.getAccountData(e))}getAccountData(e){const t=this.values.get(e);if(t)return t;const n=this.existingValues[e];return n?n.getContent():null}setAccountData(e,t){const n=this.values.get(e);return this.values.set(e,t),Promise.resolve().then((()=>{const r=new a.MatrixEvent({type:e,content:t});return this.emit("accountData",r,n),{}}))}}class p{constructor(){(0,i.default)(this,"privateKeys",new Map)}getCrossSigningKeyCache(e,t){return this.getCrossSigningKey(e,t)}storeCrossSigningKeyCache(e,t){return this.privateKeys.set(e,t),Promise.resolve()}getCrossSigningKey(e,t){return Promise.resolve(this.privateKeys.get(e))}saveCrossSigningKeys(e){for(const[t,n]of Object.entries(e))this.privateKeys.set(t,n)}}class m{constructor(e){this.delegateCryptoCallbacks=e,(0,i.default)(this,"privateKeys",new Map)}async getSecretStorageKey({keys:e},t){var n;for(const t of Object.keys(e)){const e=this.privateKeys.get(t);if(e)return[t,e]}if(null!=this&&null!==(n=this.delegateCryptoCallbacks)&&void 0!==n&&n.getSecretStorageKey){const n=await this.delegateCryptoCallbacks.getSecretStorageKey({keys:e},t);if(n){const[e,t]=n;this.privateKeys.set(e,t)}return n}return null}addPrivateKey(e,t,n){var r,i;this.privateKeys.set(e,n),null===(r=this.delegateCryptoCallbacks)||void 0===r||null===(i=r.cacheSecretStorageKey)||void 0===i||i.call(r,e,t,n)}}},2573:(e,t,n)=>{"use strict";var r=n(5318);Object.defineProperty(t,"__esModule",{value:!0}),t.WITHHELD_MESSAGES=t.OlmDevice=void 0;var i=r(n(9713)),s=n(7434),o=n(7585),a=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var n=l(t);if(n&&n.has(e))return n.get(e);var r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var s in e)if("default"!==s&&Object.prototype.hasOwnProperty.call(e,s)){var o=i?Object.getOwnPropertyDescriptor(e,s):null;o&&(o.get||o.set)?Object.defineProperty(r,s,o):r[s]=e[s]}return r.default=e,n&&n.set(e,r),r}(n(1994));function l(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(l=function(e){return e?n:t})(e)}function c(e){if(void 0===e)throw new Error("payloadString undefined");if(e.length>49152){const t=new Error("Message too long ("+e.length+" bytes). The maximum for an encrypted message is 49152 bytes.");throw t.data={errcode:"M_TOO_LARGE",error:"Payload too large for encrypted message"},t}}t.OlmDevice=class{constructor(e){this.cryptoStore=e,(0,i.default)(this,"pickleKey","DEFAULT_KEY"),(0,i.default)(this,"deviceCurve25519Key",null),(0,i.default)(this,"deviceEd25519Key",null),(0,i.default)(this,"maxOneTimeKeys",null),(0,i.default)(this,"outboundGroupSessionStore",{}),(0,i.default)(this,"inboundGroupSessionMessageIndexes",{}),(0,i.default)(this,"sessionsInProgress",{}),(0,i.default)(this,"olmPrekeyPromise",Promise.resolve())}static getOlmVersion(){return n.g.Olm.get_library_version()}async init({pickleKey:e,fromExportedDevice:t}={}){let r;const i=new n.g.Olm.Account;try{t?(e&&s.logger.warn("ignoring opts.pickleKey because opts.fromExportedDevice is present."),this.pickleKey=t.pickleKey,await this.initialiseFromExportedDevice(t,i)):(e&&(this.pickleKey=e),await this.initialiseAccount(i)),r=JSON.parse(i.identity_keys()),this.maxOneTimeKeys=i.max_number_of_one_time_keys()}finally{i.free()}this.deviceCurve25519Key=r.curve25519,this.deviceEd25519Key=r.ed25519}async initialiseFromExportedDevice(e,t){await this.cryptoStore.doTxn("readwrite",[o.IndexedDBCryptoStore.STORE_ACCOUNT,o.IndexedDBCryptoStore.STORE_SESSIONS],(t=>{this.cryptoStore.storeAccount(t,e.pickledAccount),e.sessions.forEach((e=>{const{deviceKey:n,sessionId:r}=e,i={session:e.session,lastReceivedMessageTs:e.lastReceivedMessageTs};this.cryptoStore.storeEndToEndSession(n,r,i,t)}))})),t.unpickle(this.pickleKey,e.pickledAccount)}async initialiseAccount(e){await this.cryptoStore.doTxn("readwrite",[o.IndexedDBCryptoStore.STORE_ACCOUNT],(t=>{this.cryptoStore.getAccount(t,(n=>{null!==n?e.unpickle(this.pickleKey,n):(e.create(),n=e.pickle(this.pickleKey),this.cryptoStore.storeAccount(t,n))}))}))}getAccount(e,t){this.cryptoStore.getAccount(e,(e=>{const r=new n.g.Olm.Account;try{r.unpickle(this.pickleKey,e),t(r)}finally{r.free()}}))}storeAccount(e,t){this.cryptoStore.storeAccount(e,t.pickle(this.pickleKey))}async export(){const e={pickleKey:this.pickleKey};return await this.cryptoStore.doTxn("readonly",[o.IndexedDBCryptoStore.STORE_ACCOUNT,o.IndexedDBCryptoStore.STORE_SESSIONS],(t=>{this.cryptoStore.getAccount(t,(t=>{e.pickledAccount=t})),e.sessions=[],this.cryptoStore.getAllEndToEndSessions(t,(t=>{e.sessions.push(t)}))})),e}getSession(e,t,n,r){this.cryptoStore.getEndToEndSession(e,t,n,(e=>{this.unpickleSession(e,r)}))}unpickleSession(e,t){const r=new n.g.Olm.Session;try{r.unpickle(this.pickleKey,e.session),t(Object.assign({},e,{session:r}))}finally{r.free()}}saveSession(e,t,n){const r=t.session.session_id(),i=Object.assign(t,{session:t.session.pickle(this.pickleKey)});this.cryptoStore.storeEndToEndSession(e,r,i,n)}getUtility(e){const t=new n.g.Olm.Utility;try{return e(t)}finally{t.free()}}async sign(e){let t;return await this.cryptoStore.doTxn("readonly",[o.IndexedDBCryptoStore.STORE_ACCOUNT],(n=>{this.getAccount(n,(n=>{t=n.sign(e)}))})),t}async getOneTimeKeys(){let e;return await this.cryptoStore.doTxn("readonly",[o.IndexedDBCryptoStore.STORE_ACCOUNT],(t=>{this.getAccount(t,(t=>{e=JSON.parse(t.one_time_keys())}))})),e}maxNumberOfOneTimeKeys(){return this.maxOneTimeKeys}async markKeysAsPublished(){await this.cryptoStore.doTxn("readwrite",[o.IndexedDBCryptoStore.STORE_ACCOUNT],(e=>{this.getAccount(e,(t=>{t.mark_keys_as_published(),this.storeAccount(e,t)}))}))}generateOneTimeKeys(e){return this.cryptoStore.doTxn("readwrite",[o.IndexedDBCryptoStore.STORE_ACCOUNT],(t=>{this.getAccount(t,(n=>{n.generate_one_time_keys(e),this.storeAccount(t,n)}))}))}async generateFallbackKey(){await this.cryptoStore.doTxn("readwrite",[o.IndexedDBCryptoStore.STORE_ACCOUNT],(e=>{this.getAccount(e,(t=>{t.generate_fallback_key(),this.storeAccount(e,t)}))}))}async getFallbackKey(){let e;return await this.cryptoStore.doTxn("readonly",[o.IndexedDBCryptoStore.STORE_ACCOUNT],(t=>{this.getAccount(t,(t=>{e=JSON.parse(t.unpublished_fallback_key())}))})),e}async forgetOldFallbackKey(){await this.cryptoStore.doTxn("readwrite",[o.IndexedDBCryptoStore.STORE_ACCOUNT],(e=>{this.getAccount(e,(t=>{t.forget_old_fallback_key(),this.storeAccount(e,t)}))}))}async createOutboundSession(e,t){let r;return await this.cryptoStore.doTxn("readwrite",[o.IndexedDBCryptoStore.STORE_ACCOUNT,o.IndexedDBCryptoStore.STORE_SESSIONS],(i=>{this.getAccount(i,(s=>{const o=new n.g.Olm.Session;try{o.create_outbound(s,e,t),r=o.session_id(),this.storeAccount(i,s);const n={session:o,lastReceivedMessageTs:Date.now()};this.saveSession(e,n,i)}finally{o.free()}}))}),s.logger.withPrefix("[createOutboundSession]")),r}async createInboundSession(e,t,r){if(0!==t)throw new Error("Need messageType == 0 to create inbound session");let i;return await this.cryptoStore.doTxn("readwrite",[o.IndexedDBCryptoStore.STORE_ACCOUNT,o.IndexedDBCryptoStore.STORE_SESSIONS],(s=>{this.getAccount(s,(o=>{const a=new n.g.Olm.Session;try{a.create_inbound_from(o,e,r),o.remove_one_time_keys(a),this.storeAccount(s,o);const n=a.decrypt(t,r),l={session:a,lastReceivedMessageTs:Date.now()};this.saveSession(e,l,s),i={payload:n,session_id:a.session_id()}}finally{a.free()}}))}),s.logger.withPrefix("[createInboundSession]")),i}async getSessionIdsForDevice(e){const t=s.logger.withPrefix("[getSessionIdsForDevice]");if(this.sessionsInProgress[e]){t.debug(`Waiting for Olm session for ${e} to be created`);try{await this.sessionsInProgress[e]}catch(e){}}let n;return await this.cryptoStore.doTxn("readonly",[o.IndexedDBCryptoStore.STORE_SESSIONS],(t=>{this.cryptoStore.getEndToEndSessions(e,t,(e=>{n=Object.keys(e)}))}),t),n}async getSessionIdForDevice(e,t=!1,n){const r=await this.getSessionInfoForDevice(e,t,n);if(0===r.length)return null;let i=0;for(let e=1;e<r.length;e++){const t=r[e],n=void 0===t.lastReceivedMessageTs?0:t.lastReceivedMessageTs,s=r[i],o=void 0===s.lastReceivedMessageTs?0:s.lastReceivedMessageTs;(n>o||n===o&&t.sessionId<s.sessionId)&&(i=e)}return r[i].sessionId}async getSessionInfoForDevice(e,t=!1,n=s.logger){if(n=n.withPrefix("[getSessionInfoForDevice]"),this.sessionsInProgress[e]&&!t){n.debug(`Waiting for Olm session for ${e} to be created`);try{await this.sessionsInProgress[e]}catch(e){}}const r=[];return await this.cryptoStore.doTxn("readonly",[o.IndexedDBCryptoStore.STORE_SESSIONS],(t=>{this.cryptoStore.getEndToEndSessions(e,t,(e=>{const t=Object.keys(e).sort();for(const n of t)this.unpickleSession(e[n],(e=>{r.push({lastReceivedMessageTs:e.lastReceivedMessageTs,hasReceivedMessage:e.session.has_received_message(),sessionId:n})}))}))}),n),r}async encryptMessage(e,t,n){let r;return c(n),await this.cryptoStore.doTxn("readwrite",[o.IndexedDBCryptoStore.STORE_SESSIONS],(i=>{this.getSession(e,t,i,(o=>{const a=o.session.describe();s.logger.log("encryptMessage: Olm Session ID "+t+" to "+e+": "+a),r=o.session.encrypt(n),this.saveSession(e,o,i)}))}),s.logger.withPrefix("[encryptMessage]")),r}async decryptMessage(e,t,n,r){let i;return await this.cryptoStore.doTxn("readwrite",[o.IndexedDBCryptoStore.STORE_SESSIONS],(o=>{this.getSession(e,t,o,(a=>{const l=a.session.describe();s.logger.log("decryptMessage: Olm Session ID "+t+" from "+e+": "+l),i=a.session.decrypt(n,r),a.lastReceivedMessageTs=Date.now(),this.saveSession(e,a,o)}))}),s.logger.withPrefix("[decryptMessage]")),i}async matchesSession(e,t,n,r){if(0!==n)return!1;let i;return await this.cryptoStore.doTxn("readonly",[o.IndexedDBCryptoStore.STORE_SESSIONS],(n=>{this.getSession(e,t,n,(e=>{i=e.session.matches_inbound(r)}))}),s.logger.withPrefix("[matchesSession]")),i}async recordSessionProblem(e,t,n){await this.cryptoStore.storeEndToEndSessionProblem(e,t,n)}async sessionMayHaveProblems(e,t){return await this.cryptoStore.getEndToEndSessionProblem(e,t)}async filterOutNotifiedErrorDevices(e){return await this.cryptoStore.filterOutNotifiedErrorDevices(e)}saveOutboundGroupSession(e){this.outboundGroupSessionStore[e.session_id()]=e.pickle(this.pickleKey)}getOutboundGroupSession(e,t){const r=this.outboundGroupSessionStore[e];if(void 0===r)throw new Error("Unknown outbound group session "+e);const i=new n.g.Olm.OutboundGroupSession;try{return i.unpickle(this.pickleKey,r),t(i)}finally{i.free()}}createOutboundGroupSession(){const e=new n.g.Olm.OutboundGroupSession;try{return e.create(),this.saveOutboundGroupSession(e),e.session_id()}finally{e.free()}}encryptGroupMessage(e,t){return s.logger.log(`encrypting msg with megolm session ${e}`),c(t),this.getOutboundGroupSession(e,(e=>{const n=e.encrypt(t);return this.saveOutboundGroupSession(e),n}))}getOutboundGroupSessionKey(e){return this.getOutboundGroupSession(e,(function(e){return{chain_index:e.message_index(),key:e.session_key()}}))}unpickleInboundGroupSession(e,t){const r=new n.g.Olm.InboundGroupSession;try{return r.unpickle(this.pickleKey,e.session),t(r)}finally{r.free()}}getInboundGroupSession(e,t,n,r,i){this.cryptoStore.getEndToEndInboundGroupSession(t,n,r,((t,n)=>{if(null!==t){if(null!==e&&e!==t.room_id)throw new Error("Mismatched room_id for inbound group session (expected "+t.room_id+", was "+e+")");this.unpickleInboundGroupSession(t,(e=>{i(e,t,n)}))}else i(null,null,n)}))}async addInboundGroupSession(e,t,r,i,a,l,c,d={}){await this.cryptoStore.doTxn("readwrite",[o.IndexedDBCryptoStore.STORE_INBOUND_GROUP_SESSIONS,o.IndexedDBCryptoStore.STORE_INBOUND_GROUP_SESSIONS_WITHHELD,o.IndexedDBCryptoStore.STORE_SHARED_HISTORY_INBOUND_GROUP_SESSIONS],(o=>{this.getInboundGroupSession(e,t,i,o,((u,h)=>{const p=new n.g.Olm.InboundGroupSession;try{if(c?p.import_session(a):p.create(a),i!=p.session_id())throw new Error("Mismatched group session ID from senderKey: "+t);if(u&&(s.logger.log("Update for megolm session "+t+"/"+i),u.first_known_index()<=p.first_known_index()&&(u.first_known_index()!=p.first_known_index()||d.untrusted||!h.untrusted)))return void s.logger.log(`Keeping existing megolm session ${i}`);s.logger.info("Storing megolm session "+t+"/"+i+" with first index "+p.first_known_index());const n=Object.assign({},d,{room_id:e,session:p.pickle(this.pickleKey),keysClaimed:l,forwardingCurve25519KeyChain:r});this.cryptoStore.storeEndToEndInboundGroupSession(t,i,n,o),!u&&d.sharedHistory&&this.cryptoStore.addSharedHistoryInboundGroupSession(e,t,i,o)}finally{p.free()}}))}),s.logger.withPrefix("[addInboundGroupSession]"))}async addInboundGroupSessionWithheld(e,t,n,r,i){await this.cryptoStore.doTxn("readwrite",[o.IndexedDBCryptoStore.STORE_INBOUND_GROUP_SESSIONS_WITHHELD],(s=>{this.cryptoStore.storeEndToEndInboundGroupSessionWithheld(t,n,{room_id:e,code:r,reason:i},s)}))}async decryptGroupMessage(e,t,n,r,i,l){let c,d;if(await this.cryptoStore.doTxn("readwrite",[o.IndexedDBCryptoStore.STORE_INBOUND_GROUP_SESSIONS,o.IndexedDBCryptoStore.STORE_INBOUND_GROUP_SESSIONS_WITHHELD],(s=>{this.getInboundGroupSession(e,t,n,s,((e,o,h)=>{if(null===e)return h&&(d=new a.DecryptionError("MEGOLM_UNKNOWN_INBOUND_SESSION_ID",u(h),{session:t+"|"+n})),void(c=null);let p;try{p=e.decrypt(r)}catch(e){return void(d=e&&"OLM.UNKNOWN_MESSAGE_INDEX"===e.message&&h?new a.DecryptionError("MEGOLM_UNKNOWN_INBOUND_SESSION_ID",u(h),{session:t+"|"+n}):e)}let m=p.plaintext;if(void 0===m)m=p;else{const e=t+"|"+n+"|"+p.message_index;if(e in this.inboundGroupSessionMessageIndexes){const t=this.inboundGroupSessionMessageIndexes[e];if(t.id!==i||t.timestamp!==l)return void(d=new Error("Duplicate message index, possible replay attack: "+e))}this.inboundGroupSessionMessageIndexes[e]={id:i,timestamp:l}}o.session=e.pickle(this.pickleKey),this.cryptoStore.storeEndToEndInboundGroupSession(t,n,o,s),c={result:m,keysClaimed:o.keysClaimed||{},senderKey:t,forwardingCurve25519KeyChain:o.forwardingCurve25519KeyChain||[],untrusted:o.untrusted}}))}),s.logger.withPrefix("[decryptGroupMessage]")),d)throw d;return c}async hasInboundSessionKeys(e,t,n){let r;return await this.cryptoStore.doTxn("readonly",[o.IndexedDBCryptoStore.STORE_INBOUND_GROUP_SESSIONS,o.IndexedDBCryptoStore.STORE_INBOUND_GROUP_SESSIONS_WITHHELD],(i=>{this.cryptoStore.getEndToEndInboundGroupSession(t,n,i,(i=>{null!==i?e!==i.room_id?(s.logger.warn(`requested keys for inbound group session ${t}|${n}, with incorrect room_id (expected ${i.room_id}, was ${e})`),r=!1):r=!0:r=!1}))}),s.logger.withPrefix("[hasInboundSessionKeys]")),r}async getInboundGroupSessionKey(e,t,n,r){let i;return await this.cryptoStore.doTxn("readonly",[o.IndexedDBCryptoStore.STORE_INBOUND_GROUP_SESSIONS,o.IndexedDBCryptoStore.STORE_INBOUND_GROUP_SESSIONS_WITHHELD],(s=>{this.getInboundGroupSession(e,t,n,s,((e,t)=>{if(null===e)return void(i=null);void 0===r&&(r=e.first_known_index());const n=e.export_session(r),s=(t.keysClaimed||{}).ed25519||null;i={chain_index:r,key:n,forwarding_curve25519_key_chain:t.forwardingCurve25519KeyChain||[],sender_claimed_ed25519_key:s,shared_history:t.sharedHistory||!1}}))}),s.logger.withPrefix("[getInboundGroupSessionKey]")),i}exportInboundGroupSession(e,t,n){return this.unpickleInboundGroupSession(n,(r=>{const i=r.first_known_index();return{sender_key:e,sender_claimed_keys:n.keysClaimed,room_id:n.room_id,session_id:t,session_key:r.export_session(i),forwarding_curve25519_key_chain:n.forwardingCurve25519KeyChain||[],first_known_index:r.first_known_index(),"org.matrix.msc3061.shared_history":n.sharedHistory||!1}}))}async getSharedHistoryInboundGroupSessions(e){let t;return await this.cryptoStore.doTxn("readonly",[o.IndexedDBCryptoStore.STORE_SHARED_HISTORY_INBOUND_GROUP_SESSIONS],(n=>{t=this.cryptoStore.getSharedHistoryInboundGroupSessions(e,n)}),s.logger.withPrefix("[getSharedHistoryInboundGroupSessionsForRoom]")),t}verifySignature(e,t,n){this.getUtility((function(r){r.ed25519_verify(e,t,n)}))}};const d={"m.unverified":"The sender has disabled encrypting to unverified devices.","m.blacklisted":"The sender has blocked you.","m.unauthorised":"You are not authorised to read the message.","m.no_olm":"Unable to establish a secure channel."};function u(e){return e.code&&e.code in d?d[e.code]:e.reason?e.reason:"decryption key withheld"}t.WITHHELD_MESSAGES=d},6617:(e,t,n)=>{"use strict";var r=n(5318);Object.defineProperty(t,"__esModule",{value:!0}),t.RoomKeyRequestState=t.OutgoingRoomKeyRequestManager=void 0;var i=r(n(9713)),s=n(7434),o=n(2481);let a;function l(e){return e.room_id+" / "+e.session_id}function c(e){return"["+e.map((e=>`${e.userId}:${e.deviceId}`)).join(",")+"]"}t.RoomKeyRequestState=a,function(e){e[e.Unsent=0]="Unsent",e[e.Sent=1]="Sent",e[e.CancellationPending=2]="CancellationPending",e[e.CancellationPendingAndWillResend=3]="CancellationPendingAndWillResend"}(a||(t.RoomKeyRequestState=a={})),t.OutgoingRoomKeyRequestManager=class{constructor(e,t,n){this.baseApis=e,this.deviceId=t,this.cryptoStore=n,(0,i.default)(this,"sendOutgoingRoomKeyRequestsTimer",null),(0,i.default)(this,"sendOutgoingRoomKeyRequestsRunning",!1),(0,i.default)(this,"clientRunning",!1)}start(){this.clientRunning=!0}stop(){s.logger.log("stopping OutgoingRoomKeyRequestManager"),this.clientRunning=!1}sendQueuedRequests(){this.startTimer()}async queueRoomKeyRequest(e,t,n=!1){const r=await this.cryptoStore.getOutgoingRoomKeyRequest(e);if(r)switch(r.state){case a.CancellationPendingAndWillResend:case a.Unsent:return;case a.CancellationPending:{const e=n?a.CancellationPendingAndWillResend:a.Sent;await this.cryptoStore.updateOutgoingRoomKeyRequest(r.requestId,a.CancellationPending,{state:e,cancellationTxnId:this.baseApis.makeTxnId()});break}case a.Sent:if(n){const i=a.CancellationPendingAndWillResend,o=await this.cryptoStore.updateOutgoingRoomKeyRequest(r.requestId,a.Sent,{state:i,cancellationTxnId:this.baseApis.makeTxnId(),requestTxnId:this.baseApis.makeTxnId()});if(!o)return await this.queueRoomKeyRequest(e,t,n);try{await this.sendOutgoingRoomKeyRequestCancellation(o,!0)}catch(e){s.logger.error("Error sending room key request cancellation; will retry later.",e)}}break;default:throw new Error("unhandled state: "+r.state)}else await this.cryptoStore.getOrAddOutgoingRoomKeyRequest({requestBody:e,recipients:t,requestId:this.baseApis.makeTxnId(),state:a.Unsent})}cancelRoomKeyRequest(e){return this.cryptoStore.getOutgoingRoomKeyRequest(e).then((t=>{if(t)switch(t.state){case a.CancellationPending:case a.CancellationPendingAndWillResend:return;case a.Unsent:return s.logger.log("deleting unnecessary room key request for "+l(e)),this.cryptoStore.deleteOutgoingRoomKeyRequest(t.requestId,a.Unsent);case a.Sent:return this.cryptoStore.updateOutgoingRoomKeyRequest(t.requestId,a.Sent,{state:a.CancellationPending,cancellationTxnId:this.baseApis.makeTxnId()}).then((t=>{t?this.sendOutgoingRoomKeyRequestCancellation(t).catch((e=>{s.logger.error("Error sending room key request cancellation; will retry later.",e),this.startTimer()})):s.logger.log("Tried to cancel room key request for "+l(e)+" but it was already cancelled in another tab")}));default:throw new Error("unhandled state: "+t.state)}}))}getOutgoingSentRoomKeyRequest(e,t){return this.cryptoStore.getOutgoingRoomKeyRequestsByTarget(e,t,[a.Sent])}async cancelAndResendAllOutgoingRequests(){const e=await this.cryptoStore.getAllOutgoingRoomKeyRequestsByState(a.Sent);return Promise.all(e.map((({requestBody:e,recipients:t})=>this.queueRoomKeyRequest(e,t,!0))))}startTimer(){this.sendOutgoingRoomKeyRequestsTimer||(this.sendOutgoingRoomKeyRequestsTimer=setTimeout((()=>{if(this.sendOutgoingRoomKeyRequestsRunning)throw new Error("RoomKeyRequestSend already in progress!");this.sendOutgoingRoomKeyRequestsRunning=!0,this.sendOutgoingRoomKeyRequests().finally((()=>{this.sendOutgoingRoomKeyRequestsRunning=!1})).catch((e=>{s.logger.warn(`error in OutgoingRoomKeyRequestManager: ${e}`)}))}),500))}sendOutgoingRoomKeyRequests(){return this.clientRunning?this.cryptoStore.getOutgoingRoomKeyRequestByState([a.CancellationPending,a.CancellationPendingAndWillResend,a.Unsent]).then((e=>{if(!e)return void(this.sendOutgoingRoomKeyRequestsTimer=null);let t;switch(e.state){case a.Unsent:t=this.sendOutgoingRoomKeyRequest(e);break;case a.CancellationPending:t=this.sendOutgoingRoomKeyRequestCancellation(e);break;case a.CancellationPendingAndWillResend:t=this.sendOutgoingRoomKeyRequestCancellation(e,!0)}return t.then((()=>this.sendOutgoingRoomKeyRequests())).catch((e=>{s.logger.error("Error sending room key request; will retry later.",e),this.sendOutgoingRoomKeyRequestsTimer=null}))})):(this.sendOutgoingRoomKeyRequestsTimer=null,Promise.resolve())}sendOutgoingRoomKeyRequest(e){s.logger.log(`Requesting keys for ${l(e.requestBody)} from ${c(e.recipients)}(id ${e.requestId})`);const t={action:"request",requesting_device_id:this.deviceId,request_id:e.requestId,body:e.requestBody};return this.sendMessageToDevices(t,e.recipients,e.requestTxnId||e.requestId).then((()=>this.cryptoStore.updateOutgoingRoomKeyRequest(e.requestId,a.Unsent,{state:a.Sent})))}sendOutgoingRoomKeyRequestCancellation(e,t=!1){s.logger.log(`Sending cancellation for key request for ${l(e.requestBody)} to ${c(e.recipients)} (cancellation id ${e.cancellationTxnId})`);const n={action:"request_cancellation",requesting_device_id:this.deviceId,request_id:e.requestId};return this.sendMessageToDevices(n,e.recipients,e.cancellationTxnId).then((()=>t?this.cryptoStore.updateOutgoingRoomKeyRequest(e.requestId,a.CancellationPendingAndWillResend,{state:a.Unsent}):this.cryptoStore.deleteOutgoingRoomKeyRequest(e.requestId,a.CancellationPending)))}sendMessageToDevices(e,t,n){const r={};for(const n of t)r[n.userId]||(r[n.userId]={}),r[n.userId][n.deviceId]=e;return this.baseApis.sendToDevice(o.EventType.RoomKeyRequest,r,n)}}},635:(e,t,n)=>{"use strict";var r=n(5318);Object.defineProperty(t,"__esModule",{value:!0}),t.RoomList=void 0;var i=r(n(9713)),s=n(7585);t.RoomList=class{constructor(e){this.cryptoStore=e,(0,i.default)(this,"roomEncryption",{})}async init(){await this.cryptoStore.doTxn("readwrite",[s.IndexedDBCryptoStore.STORE_ROOMS],(e=>{this.cryptoStore.getEndToEndRooms(e,(e=>{this.roomEncryption=e}))}))}getRoomEncryption(e){return this.roomEncryption[e]||null}isRoomEncrypted(e){return Boolean(this.getRoomEncryption(e))}async setRoomEncryption(e,t){this.roomEncryption[e]=t,await this.cryptoStore.doTxn("readwrite",[s.IndexedDBCryptoStore.STORE_ROOMS],(n=>{this.cryptoStore.storeEndToEndRoom(e,t,n)}))}}},4823:(e,t,n)=>{"use strict";var r=n(5318);Object.defineProperty(t,"__esModule",{value:!0}),t.SecretStorage=t.SECRET_STORAGE_ALGORITHM_V1_AES=void 0;var i=r(n(9713)),s=n(7434),o=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var n=c(t);if(n&&n.has(e))return n.get(e);var r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var s in e)if("default"!==s&&Object.prototype.hasOwnProperty.call(e,s)){var o=i?Object.getOwnPropertyDescriptor(e,s):null;o&&(o.get||o.set)?Object.defineProperty(r,s,o):r[s]=e[s]}return r.default=e,n&&n.set(e,r),r}(n(2772)),a=n(8401),l=n(2611);function c(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(c=function(e){return e?n:t})(e)}const d="m.secret_storage.v1.aes-hmac-sha2";t.SECRET_STORAGE_ALGORITHM_V1_AES=d,t.SecretStorage=class{constructor(e,t,n){this.accountDataAdapter=e,this.cryptoCallbacks=t,this.baseApis=n,(0,i.default)(this,"requests",new Map)}async getDefaultKeyId(){const e=await this.accountDataAdapter.getAccountDataFromServer("m.secret_storage.default_key");return e?e.key:null}setDefaultKeyId(e){return new Promise(((t,n)=>{const r=n=>{"m.secret_storage.default_key"===n.getType()&&n.getContent().key===e&&(this.accountDataAdapter.removeListener("accountData",r),t())};this.accountDataAdapter.on("accountData",r),this.accountDataAdapter.setAccountData("m.secret_storage.default_key",{key:e}).catch((e=>{this.accountDataAdapter.removeListener("accountData",r),n(e)}))}))}async addKey(e,t,n){const r={algorithm:e};if(t||(t={}),t.name&&(r.name=t.name),e!==d)throw new Error(`Unknown key algorithm ${e}`);if(t.passphrase&&(r.passphrase=t.passphrase),t.key){const{iv:e,mac:n}=await(0,l.calculateKeyCheck)(t.key);r.iv=e,r.mac=n}if(!n)do{n=(0,a.randomString)(32)}while(await this.accountDataAdapter.getAccountDataFromServer(`m.secret_storage.key.${n}`));return await this.accountDataAdapter.setAccountData(`m.secret_storage.key.${n}`,r),{keyId:n,keyInfo:r}}async getKey(e){if(e||(e=await this.getDefaultKeyId()),!e)return null;const t=await this.accountDataAdapter.getAccountDataFromServer("m.secret_storage.key."+e);return t?[e,t]:null}async hasKey(e){return Boolean(await this.getKey(e))}async checkKey(e,t){if(t.algorithm===d){if(t.mac){const{mac:n}=await(0,l.calculateKeyCheck)(e,t.iv);return t.mac.replace(/=+$/g,"")===n.replace(/=+$/g,"")}return!0}throw new Error("Unknown algorithm")}async store(e,t,n){const r={};if(!n){const e=await this.getDefaultKeyId();if(!e)throw new Error("No keys specified and no default key present");n=[e]}if(0===n.length)throw new Error("Zero keys given to encrypt with!");for(const i of n){const n=await this.accountDataAdapter.getAccountDataFromServer("m.secret_storage.key."+i);if(!n)throw new Error("Unknown key: "+i);if(n.algorithm===d){const s={[i]:n},[,o]=await this.getSecretStorageKey(s,e);r[i]=await o.encrypt(t)}else s.logger.warn("unknown algorithm for secret storage key "+i+": "+n.algorithm)}await this.accountDataAdapter.setAccountData(e,{encrypted:r})}async get(e){const t=await this.accountDataAdapter.getAccountDataFromServer(e);if(!t)return;if(!t.encrypted)throw new Error("Content is not encrypted!");const n={};for(const e of Object.keys(t.encrypted)){const r=await this.accountDataAdapter.getAccountDataFromServer("m.secret_storage.key."+e),i=t.encrypted[e];r.algorithm===d&&i.iv&&i.ciphertext&&i.mac&&(n[e]=r)}if(0===Object.keys(n).length)throw new Error(`Could not decrypt ${e} because none of the keys it is encrypted with are for a supported algorithm`);let r,i;try{[r,i]=await this.getSecretStorageKey(n,e);const s=t.encrypted[r];return s.passthrough?(0,o.encodeBase64)(i.get_private_key()):await i.decrypt(s)}finally{i&&i.free&&i.free()}}async isStored(e,t){const n=await this.accountDataAdapter.getAccountDataFromServer(e);if(!n)return null;if(!n.encrypted)return null;void 0===t&&(t=!0);const r={};for(const e of Object.keys(n.encrypted)){const t=await this.accountDataAdapter.getAccountDataFromServer("m.secret_storage.key."+e);if(!t)continue;const i=n.encrypted[e];t.algorithm===d&&i.iv&&i.ciphertext&&i.mac&&(r[e]=t)}return Object.keys(r).length?r:null}request(e,t){const n=this.baseApis.makeTxnId();let r,i;const o=new Promise(((e,t)=>{r=e,i=t}));this.requests.set(n,{name:e,devices:t,resolve:r,reject:i});const a={name:e,action:"request",requesting_device_id:this.baseApis.deviceId,request_id:n},l={};for(const e of t)l[e]=a;return s.logger.info(`Request secret ${e} from ${t}, id ${n}`),this.baseApis.sendToDevice("m.secret.request",{[this.baseApis.getUserId()]:l}),{requestId:n,promise:o,cancel:e=>{const r={action:"request_cancellation",requesting_device_id:this.baseApis.deviceId,request_id:n},s={};for(const e of t)s[e]=r;this.baseApis.sendToDevice("m.secret.request",{[this.baseApis.getUserId()]:s}),i(new Error(e||"Cancelled"))}}}async onRequestReceived(e){const t=e.getSender(),n=e.getContent();if(t!==this.baseApis.getUserId()||!(n.name&&n.action&&n.requesting_device_id&&n.request_id))return;const r=n.requesting_device_id;if("request_cancellation"===n.action);else if("request"===n.action){if(r===this.baseApis.deviceId)return;if(s.logger.info("received request for secret ("+t+", "+r+", "+n.request_id+")"),!this.cryptoCallbacks.onSecretRequested)return;const e=await this.cryptoCallbacks.onSecretRequested(t,r,n.request_id,n.name,this.baseApis.checkDeviceTrust(t,r));if(e){s.logger.info(`Preparing ${n.name} secret for ${r}`);const i={type:"m.secret.send",content:{request_id:n.request_id,secret:e}},a={algorithm:o.OLM_ALGORITHM,sender_key:this.baseApis.crypto.olmDevice.deviceCurve25519Key,ciphertext:{}};await o.ensureOlmSessionsForDevices(this.baseApis.crypto.olmDevice,this.baseApis,{[t]:[this.baseApis.getStoredDevice(t,r)]}),await o.encryptMessageForDevice(a.ciphertext,this.baseApis.getUserId(),this.baseApis.deviceId,this.baseApis.crypto.olmDevice,t,this.baseApis.getStoredDevice(t,r),i);const l={[t]:{[r]:a}};s.logger.info(`Sending ${n.name} secret for ${r}`),this.baseApis.sendToDevice("m.room.encrypted",l)}else s.logger.info(`Request denied for ${n.name} secret for ${r}`)}}onSecretReceived(e){if(e.getSender()!==this.baseApis.getUserId())return;const t=e.getContent();s.logger.log("got secret share for request",t.request_id);const n=this.requests.get(t.request_id);if(n){const r=this.baseApis.crypto.deviceList.getDeviceByIdentityKey(o.OLM_ALGORITHM,e.getSenderKey());if(!r)return void s.logger.log("secret share from unknown device with key",e.getSenderKey());if(!n.devices.includes(r.deviceId))return void s.logger.log("unsolicited secret share from device",r.deviceId);s.logger.log(`Successfully received secret ${n.name} from ${r.deviceId}`),n.resolve(t.secret)}}async getSecretStorageKey(e,t){if(!this.cryptoCallbacks.getSecretStorageKey)throw new Error("No getSecretStorageKey callback supplied");const n=await this.cryptoCallbacks.getSecretStorageKey({keys:e},t);if(!n)throw new Error("getSecretStorageKey callback returned falsey");if(n.length<2)throw new Error("getSecretStorageKey callback returned invalid data");const[r,i]=n;if(!e[r])throw new Error("App returned unknown key from getSecretStorageKey!");if(e[r].algorithm===d)return[r,{encrypt:async function(e){return await(0,l.encryptAES)(e,i,t)},decrypt:async function(e){return await(0,l.decryptAES)(e,i,t)}}];throw new Error("Unknown key type: "+e[r].algorithm)}}},2611:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.calculateKeyCheck=function(e,t){return c("\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0",e,"",t)},t.decryptAES=function(e,t,n){return s?async function(e,t,n){const[r,o]=await l(t,n),a=(0,i.decodeBase64)(e.ciphertext);if(!await s.verify({name:"HMAC"},o,(0,i.decodeBase64)(e.mac),a))throw new Error(`Error decrypting secret ${n}: bad MAC`);const c=await s.decrypt({name:"AES-CTR",counter:(0,i.decodeBase64)(e.iv),length:64},r,a);return(new TextDecoder).decode(new Uint8Array(c))}(e,t,n):async function(e,t,n){const s=(0,r.getCrypto)();if(!s)throw new Error("No usable crypto implementation");const[o,l]=a(t,n);if(s.createHmac("sha256",l).update(Buffer.from(e.ciphertext,"base64")).digest("base64").replace(/=+$/g,"")!==e.mac.replace(/=+$/g,""))throw new Error(`Error decrypting secret ${n}: bad MAC`);const c=s.createDecipheriv("aes-256-ctr",o,(0,i.decodeBase64)(e.iv));return c.update(e.ciphertext,"base64","utf8")+c.final("utf8")}(e,t,n)},t.encryptAES=c;var r=n(3102),i=n(2772);const s="undefined"!=typeof window&&window.crypto?window.crypto.subtle||window.crypto.webkitSubtle:null,o=new Uint8Array(8);function a(e,t){const n=(0,r.getCrypto)(),i=n.createHmac("sha256",o).update(e).digest(),s=Buffer.alloc(1,1),a=n.createHmac("sha256",i).update(t,"utf8").update(s).digest();return s[0]=2,[a,n.createHmac("sha256",i).update(a).update(t,"utf8").update(s).digest()]}async function l(e,t){const n=await s.importKey("raw",e,{name:"HKDF"},!1,["deriveBits"]),r=await s.deriveBits({name:"HKDF",salt:o,info:(new TextEncoder).encode(t),hash:"SHA-256"},n,512),i=r.slice(0,32),a=r.slice(32),l=s.importKey("raw",i,{name:"AES-CTR"},!1,["encrypt","decrypt"]),c=s.importKey("raw",a,{name:"HMAC",hash:{name:"SHA-256"}},!1,["sign","verify"]);return await Promise.all([l,c])}function c(e,t,n,o){return s?async function(e,t,n,r){let o;r?o=(0,i.decodeBase64)(r):(o=new Uint8Array(16),window.crypto.getRandomValues(o),o[8]&=127);const[a,c]=await l(t,n),d=(new TextEncoder).encode(e),u=await s.encrypt({name:"AES-CTR",counter:o,length:64},a,d),h=await s.sign({name:"HMAC"},c,u);return{iv:(0,i.encodeBase64)(o),ciphertext:(0,i.encodeBase64)(u),mac:(0,i.encodeBase64)(h)}}(e,t,n,o):async function(e,t,n,s){const o=(0,r.getCrypto)();if(!o)throw new Error("No usable crypto implementation");let l;s?l=(0,i.decodeBase64)(s):(l=o.randomBytes(16),l[8]&=127);const[c,d]=a(t,n),u=o.createCipheriv("aes-256-ctr",c,l),h=Buffer.concat([u.update(e,"utf8"),u.final()]),p=o.createHmac("sha256",d).update(h).digest("base64");return{iv:(0,i.encodeBase64)(l),ciphertext:h.toString("base64"),mac:p}}(e,t,n,o)}},1897:(e,t,n)=>{"use strict";var r=n(5318);Object.defineProperty(t,"__esModule",{value:!0}),t.UnknownDeviceError=t.EncryptionAlgorithm=t.ENCRYPTION_CLASSES=t.DecryptionError=t.DecryptionAlgorithm=t.DECRYPTION_CLASSES=void 0,t.registerAlgorithm=function(e,t,n){s[e]=t,o[e]=n};var i=r(n(9713));const s={};t.ENCRYPTION_CLASSES=s;const o={};t.DECRYPTION_CLASSES=o,t.EncryptionAlgorithm=class{constructor(e){(0,i.default)(this,"userId",void 0),(0,i.default)(this,"deviceId",void 0),(0,i.default)(this,"crypto",void 0),(0,i.default)(this,"olmDevice",void 0),(0,i.default)(this,"baseApis",void 0),(0,i.default)(this,"roomId",void 0),this.userId=e.userId,this.deviceId=e.deviceId,this.crypto=e.crypto,this.olmDevice=e.olmDevice,this.baseApis=e.baseApis,this.roomId=e.roomId}prepareToEncrypt(e){}onRoomMembership(e,t,n){}},t.DecryptionAlgorithm=class{constructor(e){(0,i.default)(this,"userId",void 0),(0,i.default)(this,"crypto",void 0),(0,i.default)(this,"olmDevice",void 0),(0,i.default)(this,"baseApis",void 0),(0,i.default)(this,"roomId",void 0),this.userId=e.userId,this.crypto=e.crypto,this.olmDevice=e.olmDevice,this.baseApis=e.baseApis,this.roomId=e.roomId}onRoomKeyEvent(e){}async importRoomKey(e,t){}hasKeysForKeyRequest(e){return Promise.resolve(!1)}shareKeysWithDevice(e){throw new Error("shareKeysWithDevice not supported for this DecryptionAlgorithm")}async retryDecryptionFromSender(e){return!1}};class a extends Error{constructor(e,t,n){super(t),this.code=e,(0,i.default)(this,"detailedString",void 0),this.code=e,this.name="DecryptionError",this.detailedString=function(e,t){let n=e.name+"[msg: "+e.message;return t&&(n+=", "+Object.keys(t).map((e=>e+": "+t[e])).join(", ")),n+="]",n}(this,n)}}t.DecryptionError=a;class l extends Error{constructor(e,t){super(e),this.devices=t,this.name="UnknownDeviceError",this.devices=t}}t.UnknownDeviceError=l},1994:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n(3072),n(7125);var r=n(1897);Object.keys(r).forEach((function(e){"default"!==e&&"__esModule"!==e&&(e in t&&t[e]===r[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return r[e]}}))}))},7125:(e,t,n)=>{"use strict";var r=n(5318);Object.defineProperty(t,"__esModule",{value:!0}),t.isRoomSharedHistory=d;var i=r(n(9713)),s=n(7434),o=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var n=c(t);if(n&&n.has(e))return n.get(e);var r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var s in e)if("default"!==s&&Object.prototype.hasOwnProperty.call(e,s)){var o=i?Object.getOwnPropertyDescriptor(e,s):null;o&&(o.get||o.set)?Object.defineProperty(r,s,o):r[s]=e[s]}return r.default=e,n&&n.set(e,r),r}(n(2772)),a=n(1897),l=n(2573);function c(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(c=function(e){return e?n:t})(e)}function d(e){var t,n;const r=null==e||null===(t=e.currentState)||void 0===t?void 0:t.getStateEvents("m.room.history_visibility",""),i=null==r||null===(n=r.getContent())||void 0===n?void 0:n.history_visibility;return["world_readable","shared"].includes(i)}class u{constructor(e,t=!1){this.sessionId=e,this.sharedHistory=t,(0,i.default)(this,"useCount",0),(0,i.default)(this,"creationTime",void 0),(0,i.default)(this,"sharedWithDevices",{}),(0,i.default)(this,"blockedDevicesNotified",{}),this.creationTime=(new Date).getTime()}needsRotation(e,t){const n=(new Date).getTime()-this.creationTime;return(this.useCount>=e||n>=t)&&(s.logger.log("Rotating megolm session after "+this.useCount+" messages, "+n+"ms"),!0)}markSharedWithDevice(e,t,n,r){this.sharedWithDevices[e]||(this.sharedWithDevices[e]={}),this.sharedWithDevices[e][t]={deviceKey:n,messageIndex:r}}markNotifiedBlockedDevice(e,t){this.blockedDevicesNotified[e]||(this.blockedDevicesNotified[e]={}),this.blockedDevicesNotified[e][t]=!0}sharedWithTooManyDevices(e){for(const t in this.sharedWithDevices)if(this.sharedWithDevices.hasOwnProperty(t)){if(!e.hasOwnProperty(t))return s.logger.log("Starting new megolm session because we shared with "+t),!0;for(const n in this.sharedWithDevices[t])if(this.sharedWithDevices[t].hasOwnProperty(n)&&!e[t].hasOwnProperty(n))return s.logger.log("Starting new megolm session because we shared with "+t+":"+n),!0}}}class h extends a.EncryptionAlgorithm{constructor(e){var t,n,r,s;super(e),(0,i.default)(this,"setupPromise",Promise.resolve(void 0)),(0,i.default)(this,"outboundSessions",{}),(0,i.default)(this,"sessionRotationPeriodMsgs",void 0),(0,i.default)(this,"sessionRotationPeriodMs",void 0),(0,i.default)(this,"encryptionPreparation",void 0),(0,i.default)(this,"encryptionPreparationMetadata",void 0),this.sessionRotationPeriodMsgs=null!==(t=null===(n=e.config)||void 0===n?void 0:n.rotation_period_msgs)&&void 0!==t?t:100,this.sessionRotationPeriodMs=null!==(r=null===(s=e.config)||void 0===s?void 0:s.rotation_period_ms)&&void 0!==r?r:6048e5}async ensureOutboundSession(e,t,n,r=!1){let i;function a(){return i}const l=this.setupPromise.then((async a=>{i=a;const l=d(e);i&&l!==i.sharedHistory&&(i=null),i&&i.needsRotation(this.sessionRotationPeriodMsgs,this.sessionRotationPeriodMs)&&(s.logger.log("Starting new megolm session because we need to rotate."),i=null),i&&i.sharedWithTooManyDevices(t)&&(i=null),i||(s.logger.log(`Starting new megolm session for room ${this.roomId}`),i=await this.prepareNewSession(l),s.logger.log(`Started new megolm session ${i.sessionId} for room ${this.roomId}`),this.outboundSessions[i.sessionId]=i);const c={};for(const[e,n]of Object.entries(t))for(const[t,r]of Object.entries(n))r.getIdentityKey()!=this.olmDevice.deviceCurve25519Key&&(i.sharedWithDevices[e]&&void 0!==i.sharedWithDevices[e][t]||(c[e]=c[e]||[],c[e].push(r)));const u=this.olmDevice.getOutboundGroupSessionKey(i.sessionId),h={type:"m.room_key",content:{algorithm:o.MEGOLM_ALGORITHM,room_id:this.roomId,session_id:i.sessionId,session_key:u.key,chain_index:u.chain_index,"org.matrix.msc3061.shared_history":l}},[p,m]=await o.getExistingOlmSessions(this.olmDevice,this.baseApis,c);await Promise.all([(async()=>{s.logger.debug(`Sharing keys with existing Olm sessions in ${this.roomId}`,m),await this.shareKeyWithOlmSessions(i,u,h,m),s.logger.debug(`Shared keys with existing Olm sessions in ${this.roomId}`)})(),(async()=>{s.logger.debug(`Sharing keys (start phase 1) with new Olm sessions in ${this.roomId}`,p);const e=[],t=Date.now(),n=[];await this.shareKeyWithDevices(i,u,h,p,e,r?1e4:2e3,n),s.logger.debug(`Shared keys (end phase 1) with new Olm sessions in ${this.roomId}`),!r&&Date.now()-t<1e4?(async()=>{const t={},r=new Set;for(const e of n)r.add(e);const o=[];for(const{userId:n,deviceInfo:i}of e){const e=n.slice(n.indexOf(":")+1);r.has(e)?(t[n]=t[n]||[],t[n].push(i)):o.push({userId:n,deviceInfo:i})}s.logger.debug(`Sharing keys (start phase 2) with new Olm sessions in ${this.roomId}`),await this.shareKeyWithDevices(i,u,h,t,o,3e4),s.logger.debug(`Shared keys (end phase 2) with new Olm sessions in ${this.roomId}`),await this.notifyFailedOlmDevices(i,u,o)})():await this.notifyFailedOlmDevices(i,u,e),s.logger.debug(`Shared keys (all phases done) with new Olm sessions in ${this.roomId}`)})(),(async()=>{s.logger.debug(`There are ${Object.entries(n).length} blocked devices in ${this.roomId}`,Object.entries(n)),s.logger.debug(`Notifying newly blocked devices in ${this.roomId}`);const e={};let t=0;for(const[r,s]of Object.entries(n))for(const[n,o]of Object.entries(s))i.blockedDevicesNotified[r]&&void 0!==i.blockedDevicesNotified[r][n]||(e[r]=e[r]||{},e[r][n]={device:o},t++);await this.notifyBlockedDevices(i,e),s.logger.debug(`Notified ${t} newly blocked devices in ${this.roomId}`,e)})()])}));return l.catch((e=>{s.logger.error(`Failed to ensure outbound session in ${this.roomId}`,e)})),this.setupPromise=l.then(a,a),l.then(a)}async prepareNewSession(e){const t=this.olmDevice.createOutboundGroupSession(),n=this.olmDevice.getOutboundGroupSessionKey(t);return await this.olmDevice.addInboundGroupSession(this.roomId,this.olmDevice.deviceCurve25519Key,[],t,n.key,{ed25519:this.olmDevice.deviceEd25519Key},!1,{sharedHistory:e}),this.crypto.backupManager.backupGroupSession(this.olmDevice.deviceCurve25519Key,t),new u(t,e)}getDevicesWithoutSessions(e,t,n=[]){for(const[r,i]of Object.entries(t)){const t=e[r];for(const e of i){const i=e.deviceId;t[i].sessionId||(n.push({userId:r,deviceInfo:e}),delete t[i])}}return n}splitDevices(e){let t=[];const n=[t];for(const[r,i]of Object.entries(e)){for(const e of Object.values(i))t.push({userId:r,deviceInfo:e.device});t.length>20&&(t=[],n.push(t))}return 0===t.length&&n.pop(),n}encryptAndSendKeysToDevices(e,t,n,r){const i={},a=new Map,l=[];for(let e=0;e<n.length;e++){const t={algorithm:o.OLM_ALGORITHM,sender_key:this.olmDevice.deviceCurve25519Key,ciphertext:{}},s=n[e],c=s.userId,d=s.deviceInfo,u=d.deviceId;a.set(u,d),i[c]||(i[c]={}),i[c][u]=t,l.push(o.encryptMessageForDevice(t.ciphertext,this.userId,this.deviceId,this.olmDevice,c,d,r))}return Promise.all(l).then((()=>{for(const e of Object.keys(i)){for(const t of Object.keys(i[e]))0===Object.keys(i[e][t].ciphertext).length&&(s.logger.log("No ciphertext for device "+e+":"+t+": pruning"),delete i[e][t]);0===Object.keys(i[e]).length&&(s.logger.log("Pruned all devices for user "+e),delete i[e])}if(0!==Object.keys(i).length)return this.baseApis.sendToDevice("m.room.encrypted",i).then((()=>{for(const n of Object.keys(i))for(const r of Object.keys(i[n]))e.markSharedWithDevice(n,r,a.get(r).getIdentityKey(),t)}));s.logger.log("No users left to send to: aborting")}))}async sendBlockedNotificationsToDevices(e,t,n){const r={};for(const e of t){const t=e.userId,i=e.deviceInfo,s=i.deviceInfo.deviceId,o=Object.assign({},n);o.code=i.code,o.reason=i.reason,"m.no_olm"===o.code&&(delete o.room_id,delete o.session_id),r[t]||(r[t]={}),r[t][s]=o}await this.baseApis.sendToDevice("org.matrix.room_key.withheld",r);for(const t of Object.keys(r))for(const n of Object.keys(r[t]))e.markNotifiedBlockedDevice(t,n)}async reshareKeyWithDevice(e,t,n,r){const i=this.outboundSessions[t];if(!i)return void s.logger.debug(`megolm session ${t} not found: not re-sharing keys`);if(void 0===i.sharedWithDevices[n])return void s.logger.debug(`megolm session ${t} never shared with user ${n}`);const a=i.sharedWithDevices[n][r.deviceId];if(void 0===a)return void s.logger.debug("megolm session ID "+t+" never shared with device "+n+":"+r.deviceId);if(a.deviceKey!==r.getIdentityKey())return void s.logger.warn(`Session has been shared with device ${r.deviceId} but with identity key ${a.deviceKey}. Key is now ${r.getIdentityKey()}!`);const l=await this.olmDevice.getInboundGroupSessionKey(this.roomId,e,t,a.messageIndex);if(!l)return void s.logger.warn(`No inbound session key found for megolm ${t}: not re-sharing keys`);await o.ensureOlmSessionsForDevices(this.olmDevice,this.baseApis,{[n]:[r]});const c={type:"m.forwarded_room_key",content:{algorithm:o.MEGOLM_ALGORITHM,room_id:this.roomId,session_id:t,session_key:l.key,chain_index:l.chain_index,sender_key:e,sender_claimed_ed25519_key:l.sender_claimed_ed25519_key,forwarding_curve25519_key_chain:l.forwarding_curve25519_key_chain,"org.matrix.msc3061.shared_history":l.shared_history||!1}},d={algorithm:o.OLM_ALGORITHM,sender_key:this.olmDevice.deviceCurve25519Key,ciphertext:{}};await o.encryptMessageForDevice(d.ciphertext,this.userId,this.deviceId,this.olmDevice,n,r,c),await this.baseApis.sendToDevice("m.room.encrypted",{[n]:{[r.deviceId]:d}}),s.logger.debug(`Re-shared key for megolm session ${t} with ${n}:${r.deviceId}`)}async shareKeyWithDevices(e,t,n,r,i,a,l){s.logger.debug(`Ensuring Olm sessions for devices in ${this.roomId}`);const c=await o.ensureOlmSessionsForDevices(this.olmDevice,this.baseApis,r,!1,a,l,s.logger.withPrefix(`[${this.roomId}]`));s.logger.debug(`Ensured Olm sessions for devices in ${this.roomId}`),this.getDevicesWithoutSessions(c,r,i),s.logger.debug(`Sharing keys with newly created Olm sessions in ${this.roomId}`),await this.shareKeyWithOlmSessions(e,t,n,c),s.logger.debug(`Shared keys with newly created Olm sessions in ${this.roomId}`)}async shareKeyWithOlmSessions(e,t,n,r){const i=this.splitDevices(r);for(let r=0;r<i.length;r++){const o=`megolm keys for ${e.sessionId} in ${this.roomId} (slice ${r+1}/${i.length})`;try{s.logger.debug(`Sharing ${o}`,i[r].map((e=>`${e.userId}/${e.deviceInfo.deviceId}`))),await this.encryptAndSendKeysToDevices(e,t.chain_index,i[r],n),s.logger.debug(`Shared ${o}`)}catch(e){throw s.logger.error(`Failed to share ${o}`),e}}}async notifyFailedOlmDevices(e,t,n){s.logger.debug(`Notifying ${n.length} devices we failed to create Olm sessions in ${this.roomId}`);for(const{userId:r,deviceInfo:i}of n){const n=i.deviceId;e.markSharedWithDevice(r,n,i.getIdentityKey(),t.chain_index)}const r=await this.olmDevice.filterOutNotifiedErrorDevices(n);s.logger.debug(`Need to notify ${r.length} failed devices which haven't been notified before in ${this.roomId}`);const i={};for(const{userId:e,deviceInfo:t}of r)i[e]=i[e]||{},i[e][t.deviceId]={device:{code:"m.no_olm",reason:l.WITHHELD_MESSAGES["m.no_olm"],deviceInfo:t}};await this.notifyBlockedDevices(e,i),s.logger.debug(`Notified ${r.length} devices we failed to create Olm sessions in ${this.roomId}`)}async notifyBlockedDevices(e,t){const n={room_id:this.roomId,session_id:e.sessionId,algorithm:o.MEGOLM_ALGORITHM,sender_key:this.olmDevice.deviceCurve25519Key},r=this.splitDevices(t);for(let t=0;t<r.length;t++)try{await this.sendBlockedNotificationsToDevices(e,r[t],n),s.logger.log(`Completed blacklist notification for ${e.sessionId} in ${this.roomId} (slice ${t+1}/${r.length})`)}catch(n){throw s.logger.log(`blacklist notification for ${e.sessionId} in ${this.roomId} (slice ${t+1}/${r.length}) failed`),n}}prepareToEncrypt(e){if(this.encryptionPreparation){const e=Date.now()-this.encryptionPreparationMetadata.startTime;s.logger.debug(`Already started preparing to encrypt for ${this.roomId} ${e} ms ago, skipping`)}else s.logger.debug(`Preparing to encrypt events for ${this.roomId}`),this.encryptionPreparationMetadata={startTime:Date.now()},this.encryptionPreparation=(async()=>{try{s.logger.debug(`Getting devices in ${this.roomId}`);const[t,n]=await this.getDevicesInRoom(e);this.crypto.getGlobalErrorOnUnknownDevices()&&this.removeUnknownDevices(t),s.logger.debug(`Ensuring outbound session in ${this.roomId}`),await this.ensureOutboundSession(e,t,n,!0),s.logger.debug(`Ready to encrypt events for ${this.roomId}`)}catch(e){s.logger.error(`Failed to prepare to encrypt events for ${this.roomId}`,e)}finally{delete this.encryptionPreparationMetadata,delete this.encryptionPreparation}})()}async encryptMessage(e,t,n){if(s.logger.log(`Starting to encrypt event for ${this.roomId}`),this.encryptionPreparation)try{await this.encryptionPreparation}catch(e){}const[r,i]=await this.getDevicesInRoom(e);this.crypto.getGlobalErrorOnUnknownDevices()&&this.checkForUnknownDevices(r);const a=await this.ensureOutboundSession(e,r,i),l={room_id:this.roomId,type:t,content:n},c=this.olmDevice.encryptGroupMessage(a.sessionId,JSON.stringify(l)),d={algorithm:o.MEGOLM_ALGORITHM,sender_key:this.olmDevice.deviceCurve25519Key,ciphertext:c,session_id:a.sessionId,device_id:this.deviceId};return a.useCount++,d}forceDiscardSession(){this.setupPromise=this.setupPromise.then((()=>null))}checkForUnknownDevices(e){const t={};if(Object.keys(e).forEach((n=>{Object.keys(e[n]).forEach((r=>{const i=e[n][r];i.isUnverified()&&!i.isKnown()&&(t[n]||(t[n]={}),t[n][r]=i)}))})),Object.keys(t).length)throw new a.UnknownDeviceError("This room contains unknown devices which have not been verified. We strongly recommend you verify them before continuing.",t)}removeUnknownDevices(e){for(const[t,n]of Object.entries(e)){for(const[e,t]of Object.entries(n))t.isUnverified()&&!t.isKnown()&&delete n[e];0===Object.keys(n).length&&delete e[t]}}async getDevicesInRoom(e){const t=(await e.getEncryptionTargetMembers()).map((function(e){return e.userId}));let n=this.crypto.getGlobalBlacklistUnverifiedDevices();"boolean"==typeof e.getBlacklistUnverifiedDevices()&&(n=e.getBlacklistUnverifiedDevices());const r=await this.crypto.downloadKeys(t,!1),i={};for(const e in r){if(!r.hasOwnProperty(e))continue;const t=r[e];for(const r in t){if(!t.hasOwnProperty(r))continue;const s=this.crypto.checkDeviceTrust(e,r);if(t[r].isBlocked()||!s.isVerified()&&n){i[e]||(i[e]={});const n=t[r].isBlocked();i[e][r]={code:n?"m.blacklisted":"m.unverified",reason:l.WITHHELD_MESSAGES[n?"m.blacklisted":"m.unverified"],deviceInfo:t[r]},delete t[r]}}}return[r,i]}}class p extends a.DecryptionAlgorithm{constructor(...e){super(...e),(0,i.default)(this,"pendingEvents",{}),(0,i.default)(this,"olmlib",o)}async decryptEvent(e){const t=e.getWireContent();if(!t.sender_key||!t.session_id||!t.ciphertext)throw new a.DecryptionError("MEGOLM_MISSING_FIELDS","Missing fields in input");let n;this.addEventToPendingList(e);try{n=await this.olmDevice.decryptGroupMessage(e.getRoomId(),t.sender_key,t.session_id,t.ciphertext,e.getId(),e.getTs())}catch(n){if("DecryptionError"===n.name)throw n;let r="OLM_DECRYPT_GROUP_MESSAGE_ERROR";throw n&&"OLM.UNKNOWN_MESSAGE_INDEX"===n.message&&(this.requestKeysForEvent(e),r="OLM_UNKNOWN_MESSAGE_INDEX"),new a.DecryptionError(r,n?n.toString():"Unknown Error: Error is undefined",{session:t.sender_key+"|"+t.session_id})}if(null===n){this.requestKeysForEvent(e);const n=await this.olmDevice.sessionMayHaveProblems(t.sender_key,e.getTs()-12e4);if(n){let e=m[n.type]||m.unknown;throw n.fixed&&(e+=" Trying to create a new secure channel and re-requesting the keys."),new a.DecryptionError("MEGOLM_UNKNOWN_INBOUND_SESSION_ID",e,{session:t.sender_key+"|"+t.session_id})}throw new a.DecryptionError("MEGOLM_UNKNOWN_INBOUND_SESSION_ID","The sender's device has not sent us the keys for this message.",{session:t.sender_key+"|"+t.session_id})}this.removeEventFromPendingList(e);const r=JSON.parse(n.result);if(r.room_id!==e.getRoomId())throw new a.DecryptionError("MEGOLM_BAD_ROOM","Message intended for room "+r.room_id);return{clearEvent:r,senderCurve25519Key:n.senderKey,claimedEd25519Key:n.keysClaimed.ed25519,forwardingCurve25519KeyChain:n.forwardingCurve25519KeyChain,untrusted:n.untrusted}}requestKeysForEvent(e){const t=e.getWireContent(),n=e.getKeyRequestRecipients(this.userId);this.crypto.requestRoomKey({room_id:e.getRoomId(),algorithm:t.algorithm,sender_key:t.sender_key,session_id:t.session_id},n)}addEventToPendingList(e){const t=e.getWireContent(),n=t.sender_key,r=t.session_id;this.pendingEvents[n]||(this.pendingEvents[n]=new Map);const i=this.pendingEvents[n];i.has(r)||i.set(r,new Set),i.get(r).add(e)}removeEventFromPendingList(e){const t=e.getWireContent(),n=t.sender_key,r=t.session_id,i=this.pendingEvents[n],s=null==i?void 0:i.get(r);s&&(s.delete(e),0===s.size&&i.delete(r),0===i.size&&delete this.pendingEvents[n])}onRoomKeyEvent(e){const t=e.getContent(),n=t.session_id;let r,i=e.getSenderKey(),o=[],a=!1;if(!t.room_id||!n||!t.session_key)return void s.logger.error("key event is missing fields");if(!i)return void s.logger.error("key event has no sender key (not encrypted?)");if("m.forwarded_room_key"==e.getType()){if(a=!0,o=t.forwarding_curve25519_key_chain,Array.isArray(o)||(o=[]),o=o.slice(),o.push(i),i=t.sender_key,!i)return void s.logger.error("forwarded_room_key event is missing sender_key field");const e=t.sender_claimed_ed25519_key;if(!e)return void s.logger.error("forwarded_room_key_event is missing sender_claimed_ed25519_key field");r={ed25519:e}}else r=e.getKeysClaimed();const l={};return t["org.matrix.msc3061.shared_history"]&&(l.sharedHistory=!0),this.olmDevice.addInboundGroupSession(t.room_id,i,o,n,t.session_key,r,a,l).then((()=>{this.retryDecryption(i,n).then((e=>{e&&this.crypto.cancelRoomKeyRequest({algorithm:t.algorithm,room_id:t.room_id,session_id:t.session_id,sender_key:i})}))})).then((()=>{this.crypto.backupManager.backupGroupSession(i,t.session_id)})).catch((e=>{s.logger.error(`Error handling m.room_key_event: ${e}`)}))}async onRoomKeyWithheldEvent(e){const t=e.getContent(),n=t.sender_key;if("m.no_olm"===t.code){const r=e.getSender();if(s.logger.warn(`${r}:${n} was unable to establish an olm session with us`),await this.olmDevice.getSessionIdForDevice(n))return s.logger.debug("New session already created.  Not creating a new one."),await this.olmDevice.recordSessionProblem(n,"no_olm",!0),void this.retryDecryptionFromSender(n);let i=this.crypto.deviceList.getDeviceByIdentityKey(t.algorithm,n);if(!i&&(await this.crypto.downloadKeys([r],!1),i=this.crypto.deviceList.getDeviceByIdentityKey(t.algorithm,n),!i))return s.logger.info("Couldn't find device for identity key "+n+": not establishing session"),await this.olmDevice.recordSessionProblem(n,"no_olm",!1),void this.retryDecryptionFromSender(n);await o.ensureOlmSessionsForDevices(this.olmDevice,this.baseApis,{[r]:[i]},!1);const a={algorithm:o.OLM_ALGORITHM,sender_key:this.olmDevice.deviceCurve25519Key,ciphertext:{}};await o.encryptMessageForDevice(a.ciphertext,this.userId,void 0,this.olmDevice,r,i,{type:"m.dummy"}),await this.olmDevice.recordSessionProblem(n,"no_olm",!0),this.retryDecryptionFromSender(n),await this.baseApis.sendToDevice("m.room.encrypted",{[r]:{[i.deviceId]:a}})}else await this.olmDevice.addInboundGroupSessionWithheld(t.room_id,n,t.session_id,t.code,t.reason)}hasKeysForKeyRequest(e){const t=e.requestBody;return this.olmDevice.hasInboundSessionKeys(t.room_id,t.sender_key,t.session_id)}shareKeysWithDevice(e){const t=e.userId,n=e.deviceId,r=this.crypto.getStoredDevice(t,n),i=e.requestBody;this.olmlib.ensureOlmSessionsForDevices(this.olmDevice,this.baseApis,{[t]:[r]}).then((e=>e[t][n].sessionId?(s.logger.log("sharing keys for session "+i.sender_key+"|"+i.session_id+" with device "+t+":"+n),this.buildKeyForwardingMessage(i.room_id,i.sender_key,i.session_id)):null)).then((e=>{const i={algorithm:o.OLM_ALGORITHM,sender_key:this.olmDevice.deviceCurve25519Key,ciphertext:{}};return this.olmlib.encryptMessageForDevice(i.ciphertext,this.userId,void 0,this.olmDevice,t,r,e).then((()=>{const e={[t]:{[n]:i}};return this.baseApis.sendToDevice("m.room.encrypted",e)}))}))}async buildKeyForwardingMessage(e,t,n){const r=await this.olmDevice.getInboundGroupSessionKey(e,t,n);return{type:"m.forwarded_room_key",content:{algorithm:o.MEGOLM_ALGORITHM,room_id:e,sender_key:t,sender_claimed_ed25519_key:r.sender_claimed_ed25519_key,session_id:n,session_key:r.key,chain_index:r.chain_index,forwarding_curve25519_key_chain:r.forwarding_curve25519_key_chain,"org.matrix.msc3061.shared_history":r.shared_history||!1}}}importRoomKey(e,t={}){const n={};return(t.untrusted||e.untrusted)&&(n.untrusted=!0),e["org.matrix.msc3061.shared_history"]&&(n.sharedHistory=!0),this.olmDevice.addInboundGroupSession(e.room_id,e.sender_key,e.forwarding_curve25519_key_chain,e.session_id,e.session_key,e.sender_claimed_keys,!0,n).then((()=>{"backup"!==t.source&&this.crypto.backupManager.backupGroupSession(e.sender_key,e.session_id).catch((e=>{s.logger.log("Failed to back up megolm session",e)})),this.retryDecryption(e.sender_key,e.session_id)}))}async retryDecryption(e,t){var n;const r=this.pendingEvents[e];if(!r)return!0;const i=r.get(t);return!(i&&(s.logger.debug("Retrying decryption on events",[...i]),await Promise.all([...i].map((async e=>{try{await e.attemptDecryption(this.crypto,{isRetry:!0})}catch(e){}}))),null!==(n=this.pendingEvents[e])&&void 0!==n&&n.has(t)))}async retryDecryptionFromSender(e){const t=this.pendingEvents[e];return!t||(delete this.pendingEvents[e],await Promise.all([...t].map((async([e,t])=>{await Promise.all([...t].map((async e=>{try{await e.attemptDecryption(this.crypto)}catch(e){}})))}))),!this.pendingEvents[e])}async sendSharedHistoryInboundSessions(e){await o.ensureOlmSessionsForDevices(this.olmDevice,this.baseApis,e),s.logger.log("sendSharedHistoryInboundSessions to users",Object.keys(e));const t=await this.olmDevice.getSharedHistoryInboundGroupSessions(this.roomId);s.logger.log("shared-history sessions",t);for(const[n,r]of t){const t=await this.buildKeyForwardingMessage(this.roomId,n,r),i=[],a={};for(const[n,r]of Object.entries(e)){a[n]={};for(const e of r){const r={algorithm:o.OLM_ALGORITHM,sender_key:this.olmDevice.deviceCurve25519Key,ciphertext:{}};a[n][e.deviceId]=r,i.push(o.encryptMessageForDevice(r.ciphertext,this.userId,void 0,this.olmDevice,n,e,t))}}await Promise.all(i);for(const e of Object.keys(a)){for(const t of Object.keys(a[e]))0===Object.keys(a[e][t].ciphertext).length&&(s.logger.log("No ciphertext for device "+e+":"+t+": pruning"),delete a[e][t]);0===Object.keys(a[e]).length&&(s.logger.log("Pruned all devices for user "+e),delete a[e])}if(0===Object.keys(a).length)return void s.logger.log("No users left to send to: aborting");await this.baseApis.sendToDevice("m.room.encrypted",a)}}}const m={no_olm:"The sender was unable to establish a secure channel.",unknown:"The secure channel with the sender was corrupted."};(0,a.registerAlgorithm)(o.MEGOLM_ALGORITHM,h,p)},3072:(e,t,n)=>{"use strict";var r=n(5318)(n(9713)),i=n(7434),s=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var n=l(t);if(n&&n.has(e))return n.get(e);var r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var s in e)if("default"!==s&&Object.prototype.hasOwnProperty.call(e,s)){var o=i?Object.getOwnPropertyDescriptor(e,s):null;o&&(o.get||o.set)?Object.defineProperty(r,s,o):r[s]=e[s]}return r.default=e,n&&n.set(e,r),r}(n(2772)),o=n(3272),a=n(1897);function l(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(l=function(e){return e?n:t})(e)}const c=o.DeviceInfo.DeviceVerification;class d extends a.EncryptionAlgorithm{constructor(...e){super(...e),(0,r.default)(this,"sessionPrepared",!1),(0,r.default)(this,"prepPromise",null)}ensureSession(e){return this.prepPromise?this.prepPromise:this.sessionPrepared?Promise.resolve():(this.prepPromise=this.crypto.downloadKeys(e).then((t=>this.crypto.ensureOlmSessionsForUsers(e))).then((()=>{this.sessionPrepared=!0})).finally((()=>{this.prepPromise=null})),this.prepPromise)}async encryptMessage(e,t,n){const r=(await e.getEncryptionTargetMembers()).map((function(e){return e.userId}));await this.ensureSession(r);const i={room_id:e.roomId,type:t,content:n},o={algorithm:s.OLM_ALGORITHM,sender_key:this.olmDevice.deviceCurve25519Key,ciphertext:{}},a=[];for(let e=0;e<r.length;++e){const t=r[e],n=this.crypto.getStoredDevicesForUser(t);for(let e=0;e<n.length;++e){const r=n[e];r.getIdentityKey()!=this.olmDevice.deviceCurve25519Key&&r.verified!=c.BLOCKED&&a.push(s.encryptMessageForDevice(o.ciphertext,this.userId,this.deviceId,this.olmDevice,t,r,i))}}return await Promise.all(a).then((()=>o))}}class u extends a.DecryptionAlgorithm{async decryptEvent(e){const t=e.getWireContent(),n=t.sender_key,r=t.ciphertext;if(!r)throw new a.DecryptionError("OLM_MISSING_CIPHERTEXT","Missing ciphertext");if(!(this.olmDevice.deviceCurve25519Key in r))throw new a.DecryptionError("OLM_NOT_INCLUDED_IN_RECIPIENTS","Not included in recipients");const i=r[this.olmDevice.deviceCurve25519Key];let s;try{s=await this.decryptMessage(n,i)}catch(e){throw new a.DecryptionError("OLM_BAD_ENCRYPTED_MESSAGE","Bad Encrypted Message",{sender:n,err:e})}const o=JSON.parse(s);if(o.recipient!=this.userId)throw new a.DecryptionError("OLM_BAD_RECIPIENT","Message was intented for "+o.recipient);if(o.recipient_keys.ed25519!=this.olmDevice.deviceEd25519Key)throw new a.DecryptionError("OLM_BAD_RECIPIENT_KEY","Message not intended for this device",{intended:o.recipient_keys.ed25519,our_key:this.olmDevice.deviceEd25519Key});if(o.sender!=e.getSender())throw new a.DecryptionError("OLM_FORWARDED_MESSAGE","Message forwarded from "+o.sender,{reported_sender:e.getSender()});if(o.room_id!==e.getRoomId())throw new a.DecryptionError("OLM_BAD_ROOM","Message intended for room "+o.room_id,{reported_room:e.getRoomId()});return{clearEvent:o,senderCurve25519Key:n,claimedEd25519Key:(o.keys||{}).ed25519||null}}async decryptMessage(e,t){if(0!==t.type)return this.reallyDecryptMessage(e,t);{const n=this.olmDevice.olmPrekeyPromise.then((()=>this.reallyDecryptMessage(e,t)));return this.olmDevice.olmPrekeyPromise=n.catch((()=>{})),await n}}async reallyDecryptMessage(e,t){const n=await this.olmDevice.getSessionIdsForDevice(e),r={};for(let s=0;s<n.length;s++){const o=n[s];try{const n=await this.olmDevice.decryptMessage(e,o,t.type,t.body);return i.logger.log("Decrypted Olm message from "+e+" with session "+o),n}catch(n){if(await this.olmDevice.matchesSession(e,o,t.type,t.body))throw new Error("Error decrypting prekey message with existing session id "+o+": "+n.message);r[o]=n.message}}if(0!==t.type){if(0===n.length)throw new Error("No existing sessions");throw new Error("Error decrypting non-prekey message with existing sessions: "+JSON.stringify(r))}let s;try{s=await this.olmDevice.createInboundSession(e,t.type,t.body)}catch(e){throw r["(new)"]=e.message,new Error("Error decrypting prekey message: "+JSON.stringify(r))}return i.logger.log("created new inbound Olm session ID "+s.session_id+" with "+e),s.payload}}(0,a.registerAlgorithm)(s.OLM_ALGORITHM,d,u)},764:(e,t)=>{"use strict";let n;Object.defineProperty(t,"__esModule",{value:!0}),t.CrossSigningKey=void 0,t.CrossSigningKey=n,function(e){e.Master="master",e.SelfSigning="self_signing",e.UserSigning="user_signing"}(n||(t.CrossSigningKey=n={}))},5537:(e,t,n)=>{"use strict";var r=n(5318);Object.defineProperty(t,"__esModule",{value:!0}),t.algorithmsByName=t.DefaultAlgorithm=t.Curve25519=t.BackupManager=t.Aes256=void 0;var i=r(n(9713)),s=n(2168),o=n(7434),a=n(2772),l=n(1597),c=n(3102),d=n(7585),u=n(4077),h=n(2611),p=n(7048);class m{constructor(e,t){this.baseApis=e,this.getKey=t,(0,i.default)(this,"algorithm",void 0),(0,i.default)(this,"backupInfo",void 0),(0,i.default)(this,"checkedForBackup",void 0),(0,i.default)(this,"sendingBackups",void 0),this.checkedForBackup=!1,this.sendingBackups=!1}get version(){return this.backupInfo&&this.backupInfo.version}static checkBackupVersion(e){const t=v[e.algorithm];if(!t)throw new Error("Unknown backup algorithm: "+e.algorithm);if("object"!=typeof e.auth_data)throw new Error("Invalid backup data returned");return t.checkBackupVersion(e)}static async makeAlgorithm(e,t){const n=v[e.algorithm];if(!n)throw new Error("Unknown backup algorithm");return await n.init(e.auth_data,t)}async enableKeyBackup(e){this.backupInfo=e,this.algorithm&&this.algorithm.free(),this.algorithm=await m.makeAlgorithm(e,this.getKey),this.baseApis.emit("crypto.keyBackupStatus",!0),this.scheduleKeyBackupSend()}disableKeyBackup(){this.algorithm&&this.algorithm.free(),this.algorithm=void 0,this.backupInfo=void 0,this.baseApis.emit("crypto.keyBackupStatus",!1)}getKeyBackupEnabled(){return this.checkedForBackup?Boolean(this.algorithm):null}async prepareKeyBackupVersion(e,t){const n=t?v[t]:b;if(!n)throw new Error("Unknown backup algorithm");const[r,i]=await n.prepare(e),s=(0,u.encodeRecoveryKey)(r);return{algorithm:n.algorithmName,auth_data:i,recovery_key:s,privateKey:r}}async createKeyBackupVersion(e){this.algorithm=await m.makeAlgorithm(e,this.getKey)}async checkAndStart(){if(o.logger.log("Checking key backup status..."),this.baseApis.isGuest())return o.logger.log("Skipping key backup check since user is guest"),this.checkedForBackup=!0,null;let e;try{e=await this.baseApis.getKeyBackupVersion()}catch(e){return o.logger.log("Error checking for active key backup",e),404===e.httpStatus&&(this.checkedForBackup=!0),null}this.checkedForBackup=!0;const t=await this.isKeyBackupTrusted(e);return t.usable&&!this.backupInfo?(o.logger.log("Found usable key backup v"+e.version+": enabling key backups"),await this.enableKeyBackup(e)):!t.usable&&this.backupInfo?(o.logger.log("No usable key backup: disabling key backup"),this.disableKeyBackup()):t.usable||this.backupInfo?t.usable&&this.backupInfo&&(e.version!==this.backupInfo.version?(o.logger.log("On backup version "+this.backupInfo.version+" but found version "+e.version+": switching."),this.disableKeyBackup(),await this.enableKeyBackup(e),await this.scheduleAllGroupSessionsForBackup()):o.logger.log("Backup version "+e.version+" still current")):o.logger.log("No usable key backup: not enabling key backup"),{backupInfo:e,trustInfo:t}}async checkKeyBackup(){return this.checkedForBackup=!1,this.checkAndStart()}async isKeyBackupTrusted(e){const t={usable:!1,trusted_locally:!1,sigs:[]};if(!(e&&e.algorithm&&e.auth_data&&e.auth_data.signatures))return o.logger.info("Key backup is absent or missing required data"),t;const n=this.baseApis.crypto.sessionStore.getLocalTrustedBackupPubKey();"public_key"in e.auth_data&&e.auth_data.public_key===n&&(o.logger.info("Backup public key "+n+" is trusted locally"),t.trusted_locally=!0);const r=e.auth_data.signatures[this.baseApis.getUserId()]||{};for(const n of Object.keys(r)){const r=n.split(":");if("ed25519"!==r[0]){o.logger.log("Ignoring unknown signature type: "+r[0]);continue}const i={deviceId:r[1]},s=this.baseApis.crypto.crossSigningInfo.getId();if(s===i.deviceId){i.crossSigningId=!0;try{await(0,a.verifySignature)(this.baseApis.crypto.olmDevice,e.auth_data,this.baseApis.getUserId(),i.deviceId,s),i.valid=!0}catch(e){o.logger.warn("Bad signature from cross signing key "+s,e),i.valid=!1}t.sigs.push(i);continue}const l=this.baseApis.crypto.deviceList.getStoredDevice(this.baseApis.getUserId(),i.deviceId);if(l){i.device=l,i.deviceTrust=await this.baseApis.checkDeviceTrust(this.baseApis.getUserId(),i.deviceId);try{await(0,a.verifySignature)(this.baseApis.crypto.olmDevice,e.auth_data,this.baseApis.getUserId(),l.deviceId,l.getFingerprint()),i.valid=!0}catch(t){o.logger.info("Bad signature from key ID "+n+" userID "+this.baseApis.getUserId()+" device ID "+l.deviceId+" fingerprint: "+l.getFingerprint(),e.auth_data,t),i.valid=!1}}else i.valid=null,o.logger.info("Ignoring signature from unknown key "+n);t.sigs.push(i)}return t.usable=t.sigs.some((e=>e.valid&&(e.device&&e.deviceTrust.isVerified()||e.crossSigningId))),t.usable=t.usable||t.trusted_locally,t}async scheduleKeyBackupSend(e=1e4){if(!this.sendingBackups){this.sendingBackups=!0;try{const t=Math.random()*e;await(0,c.sleep)(t,void 0);let n=0;for(;;){if(!this.algorithm)return;try{if(0===await this.backupPendingKeys(200))return;n=0}catch(e){if(n++,o.logger.log("Key backup request failed",e),e.data&&("M_NOT_FOUND"==e.data.errcode||"M_WRONG_ROOM_KEYS_VERSION"==e.data.errcode))throw await this.checkKeyBackup(),this.baseApis.crypto.emit("crypto.keyBackupFailed",e.data.errcode),e}n&&await(0,c.sleep)(1e3*Math.pow(2,Math.min(n-1,4)),void 0)}}finally{this.sendingBackups=!1}}}async backupPendingKeys(e){const t=await this.baseApis.crypto.cryptoStore.getSessionsNeedingBackup(e);if(!t.length)return 0;let n=await this.baseApis.crypto.cryptoStore.countSessionsNeedingBackup();this.baseApis.crypto.emit("crypto.keyBackupSessionsRemaining",n);const r={};for(const e of t){const t=e.sessionData.room_id;void 0===r[t]&&(r[t]={sessions:{}});const n=await this.baseApis.crypto.olmDevice.exportInboundGroupSession(e.senderKey,e.sessionId,e.sessionData);n.algorithm=a.MEGOLM_ALGORITHM;const i=(n.forwarding_curve25519_key_chain||[]).length,s=this.baseApis.crypto.deviceList.getUserByIdentityKey(a.MEGOLM_ALGORITHM,e.senderKey),o=this.baseApis.crypto.deviceList.getDeviceByIdentityKey(a.MEGOLM_ALGORITHM,e.senderKey),l=this.baseApis.crypto.checkDeviceInfoTrust(s,o).isVerified();r[t].sessions[e.sessionId]={first_message_index:n.first_known_index,forwarded_count:i,is_verified:l,session_data:await this.algorithm.encryptSession(n)}}return await this.baseApis.sendKeyBackup(void 0,void 0,this.backupInfo.version,{rooms:r}),await this.baseApis.crypto.cryptoStore.unmarkSessionsNeedingBackup(t),n=await this.baseApis.crypto.cryptoStore.countSessionsNeedingBackup(),this.baseApis.crypto.emit("crypto.keyBackupSessionsRemaining",n),t.length}async backupGroupSession(e,t){await this.baseApis.crypto.cryptoStore.markSessionsNeedingBackup([{senderKey:e,sessionId:t}]),this.backupInfo&&this.scheduleKeyBackupSend()}async scheduleAllGroupSessionsForBackup(){await this.flagAllGroupSessionsForBackup(),this.scheduleKeyBackupSend(0)}async flagAllGroupSessionsForBackup(){await this.baseApis.crypto.cryptoStore.doTxn("readwrite",[d.IndexedDBCryptoStore.STORE_INBOUND_GROUP_SESSIONS,d.IndexedDBCryptoStore.STORE_BACKUP],(e=>{this.baseApis.crypto.cryptoStore.getAllEndToEndInboundGroupSessions(e,(t=>{null!==t&&this.baseApis.crypto.cryptoStore.markSessionsNeedingBackup([t],e)}))}));const e=await this.baseApis.crypto.cryptoStore.countSessionsNeedingBackup();return this.baseApis.emit("crypto.keyBackupSessionsRemaining",e),e}countSessionsNeedingBackup(){return this.baseApis.crypto.cryptoStore.countSessionsNeedingBackup()}}t.BackupManager=m;class g{constructor(e,t,n){this.authData=e,this.publicKey=t,this.getKey=n}static async init(e,t){if(!e||!("public_key"in e))throw new Error("auth_data missing required information");const r=new n.g.Olm.PkEncryption;return r.set_recipient_key(e.public_key),new g(e,r,t)}static async prepare(e){const t=new n.g.Olm.PkDecryption;try{const r={};if(e)if(e instanceof Uint8Array)r.public_key=t.init_with_private_key(e);else{const n=await(0,l.keyFromPassphrase)(e);r.private_key_salt=n.salt,r.private_key_iterations=n.iterations,r.public_key=t.init_with_private_key(n.key)}else r.public_key=t.generate_key();return(new n.g.Olm.PkEncryption).set_recipient_key(r.public_key),[t.get_private_key(),r]}finally{t.free()}}static checkBackupVersion(e){if(!("public_key"in e.auth_data))throw new Error("Invalid backup data returned")}get untrusted(){return!0}async encryptSession(e){const t=Object.assign({},e);return delete t.session_id,delete t.room_id,delete t.first_known_index,this.publicKey.encrypt(JSON.stringify(t))}async decryptSessions(e){const t=await this.getKey(),r=new n.g.Olm.PkDecryption;try{if(r.init_with_private_key(t)!==this.authData.public_key)throw{errcode:s.MatrixClient.RESTORE_BACKUP_ERROR_BAD_KEY};const n=[];for(const[t,i]of Object.entries(e))try{const e=JSON.parse(r.decrypt(i.session_data.ephemeral,i.session_data.mac,i.session_data.ciphertext));e.session_id=t,n.push(e)}catch(e){o.logger.log("Failed to decrypt megolm session from backup",e,i)}return n}finally{r.free()}}async keyMatches(e){const t=new n.g.Olm.PkDecryption;let r;try{r=t.init_with_private_key(e)}finally{t.free()}return r===this.authData.public_key}free(){this.publicKey.free()}}t.Curve25519=g,(0,i.default)(g,"algorithmName","m.megolm_backup.v1.curve25519-aes-sha2");const f=new p.UnstableValue(null,"org.matrix.msc3270.v1.aes-hmac-sha2");class y{constructor(e,t){this.authData=e,this.key=t}static async init(e,t){if(!e)throw new Error("auth_data missing");const n=await t();if(e.mac){const{mac:t}=await(0,h.calculateKeyCheck)(n,e.iv);if(e.mac.replace(/=+$/g,"")!==t.replace(/=+/g,""))throw new Error("Key does not match")}return new y(e,n)}static async prepare(e){let t;const n={};if(e)if(e instanceof Uint8Array)t=new Uint8Array(e);else{const r=await(0,l.keyFromPassphrase)(e);n.private_key_salt=r.salt,n.private_key_iterations=r.iterations,t=r.key}else t=function(e){var t;const n=(0,c.getCrypto)();if(n)return n.randomBytes(32);if(null!==(t=window)&&void 0!==t&&t.crypto){const e=new Uint8Array(32);return window.crypto.getRandomValues(e),e}throw new Error("No usable crypto implementation")}();const{iv:r,mac:i}=await(0,h.calculateKeyCheck)(t);return n.iv=r,n.mac=i,[t,n]}static checkBackupVersion(e){if(!("iv"in e.auth_data)||!("mac"in e.auth_data))throw new Error("Invalid backup data returned")}get untrusted(){return!1}async encryptSession(e){const t=Object.assign({},e);return delete t.session_id,delete t.room_id,delete t.first_known_index,await(0,h.encryptAES)(JSON.stringify(t),this.key,e.session_id)}async decryptSessions(e){const t=[];for(const[n,r]of Object.entries(e))try{const e=JSON.parse(await(0,h.decryptAES)(r.session_data,this.key,n));e.session_id=n,t.push(e)}catch(e){o.logger.log("Failed to decrypt megolm session from backup",e,r)}return t}async keyMatches(e){if(this.authData.mac){const{mac:t}=await(0,h.calculateKeyCheck)(e,this.authData.iv);return this.authData.mac.replace(/=+$/g,"")===t.replace(/=+/g,"")}return!0}free(){this.key.fill(0)}}t.Aes256=y,(0,i.default)(y,"algorithmName",f.name);const v={[g.algorithmName]:g,[y.algorithmName]:y};t.algorithmsByName=v;const b=g;t.DefaultAlgorithm=b},4830:(e,t,n)=>{"use strict";var r=n(5318);Object.defineProperty(t,"__esModule",{value:!0}),t.DehydrationManager=t.DEHYDRATION_ALGORITHM=void 0;var i=r(n(9713)),s=r(n(9141)),o=n(2772),a=n(7585),l=n(2611),c=n(7434),d=n(7715);const u="org.matrix.msc2697.v1.olm.libolm_pickle";t.DEHYDRATION_ALGORITHM=u;const h=6048e5;t.DehydrationManager=class{constructor(e){this.crypto=e,(0,i.default)(this,"inProgress",!1),(0,i.default)(this,"timeoutId",void 0),(0,i.default)(this,"key",void 0),(0,i.default)(this,"keyInfo",void 0),(0,i.default)(this,"deviceDisplayName",void 0),this.getDehydrationKeyFromCache()}async getDehydrationKeyFromCache(){return await this.crypto.cryptoStore.doTxn("readonly",[a.IndexedDBCryptoStore.STORE_ACCOUNT],(e=>{this.crypto.cryptoStore.getSecretStorePrivateKey(e,(async e=>{if(e){const{key:t,keyInfo:r,deviceDisplayName:i,time:s}=e,a=Buffer.from(this.crypto.olmDevice.pickleKey),c=await(0,l.decryptAES)(t,a,u);this.key=(0,o.decodeBase64)(c),this.keyInfo=r,this.deviceDisplayName=i;const d=Date.now(),p=Math.max(1,s+h-d);this.timeoutId=n.g.setTimeout(this.dehydrateDevice.bind(this),p)}}),"dehydration")}))}async setKeyAndQueueDehydration(e,t={},n){await this.setKey(e,t,n)||this.dehydrateDevice()}async setKey(e,t={},r){if(!e)return this.timeoutId&&(n.g.clearTimeout(this.timeoutId),this.timeoutId=void 0),await this.crypto.cryptoStore.doTxn("readwrite",[a.IndexedDBCryptoStore.STORE_ACCOUNT],(e=>{this.crypto.cryptoStore.storeSecretStorePrivateKey(e,"dehydration",null)})),this.key=void 0,void(this.keyInfo=void 0);let i=this.key&&e.length==this.key.length;for(let t=0;i&&t<e.length;t++)e[t]!=this.key[t]&&(i=!1);return i||(this.key=e,this.keyInfo=t,this.deviceDisplayName=r),i}async dehydrateDevice(){if(this.inProgress)c.logger.log("Dehydration already in progress -- not starting new dehydration");else{this.inProgress=!0,this.timeoutId&&(n.g.clearTimeout(this.timeoutId),this.timeoutId=void 0);try{const e=Buffer.from(this.crypto.olmDevice.pickleKey),t=await(0,l.encryptAES)((0,o.encodeBase64)(this.key),e,u);await this.crypto.cryptoStore.doTxn("readwrite",[a.IndexedDBCryptoStore.STORE_ACCOUNT],(e=>{this.crypto.cryptoStore.storeSecretStorePrivateKey(e,"dehydration",{keyInfo:this.keyInfo,key:t,deviceDisplayName:this.deviceDisplayName,time:Date.now()})})),c.logger.log("Attempting to dehydrate device"),c.logger.log("Creating account");const r=new n.g.Olm.Account;r.create();const i=JSON.parse(r.identity_keys()),p=r.max_number_of_one_time_keys();r.generate_one_time_keys(p/2),r.generate_fallback_key();const m=JSON.parse(r.one_time_keys()),g=JSON.parse(r.fallback_key());r.mark_keys_as_published();const f=r.pickle(new Uint8Array(this.key)),y={algorithm:u,account:f};this.keyInfo.passphrase&&(y.passphrase=this.keyInfo.passphrase),c.logger.log("Uploading account to server");const v=(await this.crypto.baseApis.http.authedRequest(void 0,d.Method.Put,"/dehydrated_device",void 0,{device_data:y,initial_device_display_name:this.deviceDisplayName},{prefix:"/_matrix/client/unstable/org.matrix.msc2697.v2"})).device_id;c.logger.log("Preparing device keys",v);const b={algorithms:this.crypto.supportedAlgorithms,device_id:v,user_id:this.crypto.userId,keys:{[`ed25519:${v}`]:i.ed25519,[`curve25519:${v}`]:i.curve25519}},w=r.sign(s.default.stringify(b));b.signatures={[this.crypto.userId]:{[`ed25519:${v}`]:w}},this.crypto.crossSigningInfo.getId("self_signing")&&await this.crypto.crossSigningInfo.signObject(b,"self_signing"),c.logger.log("Preparing one-time keys");const S={};for(const[e,t]of Object.entries(m.curve25519)){const n={key:t},i=r.sign(s.default.stringify(n));n.signatures={[this.crypto.userId]:{[`ed25519:${v}`]:i}},S[`signed_curve25519:${e}`]=n}c.logger.log("Preparing fallback keys");const _={};for(const[e,t]of Object.entries(g.curve25519)){const n={key:t,fallback:!0},i=r.sign(s.default.stringify(n));n.signatures={[this.crypto.userId]:{[`ed25519:${v}`]:i}},_[`signed_curve25519:${e}`]=n}return c.logger.log("Uploading keys to server"),await this.crypto.baseApis.http.authedRequest(void 0,d.Method.Post,"/keys/upload/"+encodeURI(v),void 0,{device_keys:b,one_time_keys:S,"org.matrix.msc2732.fallback_keys":_}),c.logger.log("Done dehydrating"),this.timeoutId=n.g.setTimeout(this.dehydrateDevice.bind(this),h),v}finally{this.inProgress=!1}}}stop(){this.timeoutId&&(n.g.clearTimeout(this.timeoutId),this.timeoutId=void 0)}}},3272:(e,t,n)=>{"use strict";var r=n(5318);Object.defineProperty(t,"__esModule",{value:!0}),t.DeviceInfo=void 0;var i,s=r(n(9713));!function(e){e[e.Blocked=-1]="Blocked",e[e.Unverified=0]="Unverified",e[e.Verified=1]="Verified"}(i||(i={}));class o{static fromStorage(e,t){const n=new o(t);for(const t in e)e.hasOwnProperty(t)&&(n[t]=e[t]);return n}constructor(e){this.deviceId=e,(0,s.default)(this,"algorithms",void 0),(0,s.default)(this,"keys",{}),(0,s.default)(this,"verified",i.Unverified),(0,s.default)(this,"known",!1),(0,s.default)(this,"unsigned",{}),(0,s.default)(this,"signatures",{})}toStorage(){return{algorithms:this.algorithms,keys:this.keys,verified:this.verified,known:this.known,unsigned:this.unsigned,signatures:this.signatures}}getFingerprint(){return this.keys["ed25519:"+this.deviceId]}getIdentityKey(){return this.keys["curve25519:"+this.deviceId]}getDisplayName(){return this.unsigned.device_display_name||null}isBlocked(){return this.verified==i.Blocked}isVerified(){return this.verified==i.Verified}isUnverified(){return this.verified==i.Unverified}isKnown(){return!0===this.known}}t.DeviceInfo=o,(0,s.default)(o,"DeviceVerification",{VERIFIED:i.Verified,UNVERIFIED:i.Unverified,BLOCKED:i.Blocked})},2600:(e,t,n)=>{"use strict";var r=n(5318);Object.defineProperty(t,"__esModule",{value:!0}),t.IncomingRoomKeyRequest=t.Crypto=void 0,t.fixBackupKey=j,t.isCryptoAvailable=function(){return Boolean(n.g.Olm)},t.verificationMethods=void 0;var i=r(n(9713)),s=r(n(9141)),o=n(7187),a=n(771),l=n(7434),c=n(2573),d=M(n(2772)),u=n(6670),h=n(3272),p=M(n(1994)),m=n(3075),g=n(636),f=n(4823),y=n(6617),v=n(7585),b=n(1696),w=n(6381),S=n(1597),_=n(4077),k=n(5279),x=n(2842),E=n(9588),T=n(4028),C=n(9489),A=n(2611),I=n(4830),R=n(5537),O=n(4369);function P(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(P=function(e){return e?n:t})(e)}function M(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var n=P(t);if(n&&n.has(e))return n.get(e);var r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var s in e)if("default"!==s&&Object.prototype.hasOwnProperty.call(e,s)){var o=i?Object.getOwnPropertyDescriptor(e,s):null;o&&(o.get||o.set)?Object.defineProperty(r,s,o):r[s]=e[s]}return r.default=e,n&&n.set(e,r),r}const D=h.DeviceInfo.DeviceVerification,L={[b.ReciprocateQRCode.NAME]:b.ReciprocateQRCode,[w.SAS.NAME]:w.SAS,[b.SHOW_QR_CODE_METHOD]:T.IllegalMethod,[b.SCAN_QR_CODE_METHOD]:T.IllegalMethod},F={RECIPROCATE_QR_CODE:b.ReciprocateQRCode.NAME,SAS:w.SAS.NAME};t.verificationMethods=F;class N extends o.EventEmitter{static getOlmVersion(){return c.OlmDevice.getOlmVersion()}constructor(e,t,n,r,s,o,h,g){if(super(),this.baseApis=e,this.sessionStore=t,this.userId=n,this.deviceId=r,this.clientStore=s,this.cryptoStore=o,this.roomList=h,(0,i.default)(this,"backupManager",void 0),(0,i.default)(this,"crossSigningInfo",void 0),(0,i.default)(this,"olmDevice",void 0),(0,i.default)(this,"deviceList",void 0),(0,i.default)(this,"dehydrationManager",void 0),(0,i.default)(this,"secretStorage",void 0),(0,i.default)(this,"reEmitter",void 0),(0,i.default)(this,"verificationMethods",void 0),(0,i.default)(this,"supportedAlgorithms",void 0),(0,i.default)(this,"outgoingRoomKeyRequestManager",void 0),(0,i.default)(this,"toDeviceVerificationRequests",void 0),(0,i.default)(this,"inRoomVerificationRequests",void 0),(0,i.default)(this,"trustCrossSignedDevices",!0),(0,i.default)(this,"lastOneTimeKeyCheck",null),(0,i.default)(this,"oneTimeKeyCheckInProgress",!1),(0,i.default)(this,"roomEncryptors",{}),(0,i.default)(this,"roomDecryptors",{}),(0,i.default)(this,"deviceKeys",{}),(0,i.default)(this,"globalBlacklistUnverifiedDevices",!1),(0,i.default)(this,"globalErrorOnUnknownDevices",!0),(0,i.default)(this,"receivedRoomKeyRequests",[]),(0,i.default)(this,"receivedRoomKeyRequestCancellations",[]),(0,i.default)(this,"processingRoomKeyRequests",!1),(0,i.default)(this,"lazyLoadMembers",!1),(0,i.default)(this,"roomDeviceTrackingState",{}),(0,i.default)(this,"lastNewSessionForced",{}),(0,i.default)(this,"sendKeyRequestsImmediately",!1),(0,i.default)(this,"oneTimeKeyCount",void 0),(0,i.default)(this,"needsNewFallback",void 0),(0,i.default)(this,"fallbackCleanup",void 0),(0,i.default)(this,"onDeviceListUserCrossSigningUpdated",(async e=>{if(e===this.userId){const t=this.deviceList.getStoredCrossSigningForUser(e),n=t?t.getId():null,r=this.crossSigningInfo.getId(),i=r!==n;r&&n&&!i?await this.checkOwnCrossSigningTrust():(this.storeTrustedSelfKeys(null),this.emit("crossSigning.keysChanged",{}),this.emit("userTrustStatusChanged",this.userId,this.checkUserTrust(e)))}else{await this.checkDeviceVerifications(e);const t=this.deviceList.getStoredCrossSigningForUser(e);t&&(t.updateCrossSigningVerifiedBefore(this.checkUserTrust(e).isCrossSigningVerified()),this.deviceList.setRawStoredCrossSigningForUser(e,t.toStorage())),this.emit("userTrustStatusChanged",e,this.checkUserTrust(e))}})),(0,i.default)(this,"onToDeviceEvent",(e=>{try{l.logger.log(`received to_device ${e.getType()} from: ${e.getSender()} id: ${e.getId()}`),"m.room_key"==e.getType()||"m.forwarded_room_key"==e.getType()?this.onRoomKeyEvent(e):"m.room_key_request"==e.getType()?this.onRoomKeyRequestEvent(e):"m.secret.request"===e.getType()?this.secretStorage.onRequestReceived(e):"m.secret.send"===e.getType()?this.secretStorage.onSecretReceived(e):"org.matrix.room_key.withheld"===e.getType()?this.onRoomKeyWithheldEvent(e):e.getContent().transaction_id?this.onKeyVerificationMessage(e):"m.bad.encrypted"===e.getContent().msgtype?this.onToDeviceBadEncrypted(e):(e.isBeingDecrypted()||e.shouldAttemptDecryption())&&(e.isBeingDecrypted()||e.attemptDecryption(this),e.once("Event.decrypted",(e=>{this.onToDeviceEvent(e)})))}catch(e){l.logger.error("Error handling toDeviceEvent:",e)}})),(0,i.default)(this,"onTimelineEvent",((e,t,n,r,{liveEvent:i=!0}={})=>{x.InRoomChannel.validateEvent(e,this.baseApis)&&this.handleVerificationEvent(e,this.inRoomVerificationRequests,(e=>{const t=new x.InRoomChannel(this.baseApis,e.getRoomId());return new k.VerificationRequest(t,this.verificationMethods,this.baseApis)}),i)})),this.reEmitter=new a.ReEmitter(this),g){this.verificationMethods=new Map;for(const e of g)"string"==typeof e?L[e]&&this.verificationMethods.set(e,L[e]):e.NAME?this.verificationMethods.set(e.NAME,e):l.logger.warn(`Excluding unknown verification method ${e}`)}else this.verificationMethods=L;this.backupManager=new R.BackupManager(e,(async()=>{const e=await this.getSessionBackupPrivateKey();if(e)return e;const t=await this.getSecret("m.megolm_backup.v1");if(t){const e=j(t);if(e){const[t]=await this.getSecretStorageKey();await this.storeSecret("m.megolm_backup.v1",e,[t])}return d.decodeBase64(e||t)}if(this.baseApis.cryptoCallbacks&&this.baseApis.cryptoCallbacks.getBackupKey)return await this.baseApis.cryptoCallbacks.getBackupKey();throw new Error("Unable to get private key")})),this.olmDevice=new c.OlmDevice(o),this.deviceList=new u.DeviceList(e,o,this.olmDevice),this.deviceList.on("userCrossSigningUpdated",this.onDeviceListUserCrossSigningUpdated),this.reEmitter.reEmit(this.deviceList,["crypto.devicesUpdated","crypto.willUpdateDevices"]),this.supportedAlgorithms=Object.keys(p.DECRYPTION_CLASSES),this.outgoingRoomKeyRequestManager=new y.OutgoingRoomKeyRequestManager(e,this.deviceId,this.cryptoStore),this.toDeviceVerificationRequests=new E.ToDeviceRequests,this.inRoomVerificationRequests=new x.InRoomRequests;const v=this.baseApis.cryptoCallbacks||{},b=(0,m.createCryptoStoreCacheCallbacks)(o,this.olmDevice);this.crossSigningInfo=new m.CrossSigningInfo(n,v,b),this.secretStorage=new f.SecretStorage(e,v,e),this.dehydrationManager=new I.DehydrationManager(this),!v.getCrossSigningKey&&v.getSecretStorageKey&&(v.getCrossSigningKey=async e=>m.CrossSigningInfo.getFromSecretStorage(e,this.secretStorage))}async init({exportedOlmDevice:e,pickleKey:t}={}){l.logger.log("Crypto: initialising Olm..."),await n.g.Olm.init(),l.logger.log(e?"Crypto: initialising Olm device from exported device...":"Crypto: initialising Olm device..."),await this.olmDevice.init({fromExportedDevice:e,pickleKey:t}),l.logger.log("Crypto: loading device list..."),await this.deviceList.load(),this.deviceKeys["ed25519:"+this.deviceId]=this.olmDevice.deviceEd25519Key,this.deviceKeys["curve25519:"+this.deviceId]=this.olmDevice.deviceCurve25519Key,l.logger.log("Crypto: fetching own devices...");let r=this.deviceList.getRawStoredDevicesForUser(this.userId);if(r||(r={}),!r[this.deviceId]){l.logger.log("Crypto: adding this device to the store...");const e={keys:this.deviceKeys,algorithms:this.supportedAlgorithms,verified:D.VERIFIED,known:!0};r[this.deviceId]=e,this.deviceList.storeDevicesForUser(this.userId,r),this.deviceList.saveIfDirty()}await this.cryptoStore.doTxn("readonly",[v.IndexedDBCryptoStore.STORE_ACCOUNT],(e=>{this.cryptoStore.getCrossSigningKeys(e,(e=>{e&&0!==Object.keys(e).length&&(l.logger.log("Loaded cross-signing public keys from crypto store"),this.crossSigningInfo.setKeys(e))}))})),this.deviceList.startTrackingDeviceList(this.userId),l.logger.log("Crypto: checking for key backup..."),this.backupManager.checkAndStart()}getCryptoTrustCrossSignedDevices(){return this.trustCrossSignedDevices}setCryptoTrustCrossSignedDevices(e){this.trustCrossSignedDevices=e;for(const e of this.deviceList.getKnownUserIds()){const t=this.deviceList.getRawStoredDevicesForUser(e);for(const n of Object.keys(t)){const t=this.checkDeviceTrust(e,n);if(!t.isLocallyVerified()&&t.isCrossSigningVerified()){const t=this.deviceList.getStoredDevice(e,n);this.emit("deviceVerificationChanged",e,n,t)}}}}async createRecoveryKeyFromPassphrase(e){const t=new n.g.Olm.PkDecryption;try{const n={};if(e){const r=await(0,S.keyFromPassphrase)(e);n.passphrase={algorithm:"m.pbkdf2",iterations:r.iterations,salt:r.salt},n.pubkey=t.init_with_private_key(r.key)}else n.pubkey=t.generate_key();const r=t.get_private_key();return{keyInfo:n,encodedPrivateKey:(0,_.encodeRecoveryKey)(r),privateKey:r}}finally{t&&t.free()}}async isCrossSigningReady(){const e=this.crossSigningInfo.getId(),t=await this.crossSigningInfo.isStoredInKeyCache()||await this.crossSigningInfo.isStoredInSecretStorage(this.secretStorage);return!(!e||!t)}async isSecretStorageReady(){const e=await this.secretStorage.hasKey(),t=await this.crossSigningInfo.isStoredInSecretStorage(this.secretStorage),n=!this.backupManager.getKeyBackupEnabled()||await this.baseApis.isKeyBackupKeyStored();return!!(e&&t&&n)}async bootstrapCrossSigning({authUploadDeviceSigningKeys:e,setupNewCrossSigning:t}={}){l.logger.log("Bootstrapping cross-signing");const n=this.baseApis.cryptoCallbacks,r=new g.EncryptionSetupBuilder(this.baseApis.store.accountData,n),i=new m.CrossSigningInfo(this.userId,r.crossSigningCallbacks,r.crossSigningCallbacks),s=this.crossSigningInfo.getId(),o=await this.crossSigningInfo.isStoredInKeyCache(),a=await this.crossSigningInfo.isStoredInSecretStorage(this.secretStorage),c=o||a;l.logger.log({setupNewCrossSigning:t,publicKeysOnDevice:s,privateKeysInCache:o,privateKeysInStorage:a,privateKeysExistSomewhere:c}),!c||t?(l.logger.log("Cross-signing private keys not found locally or in secret storage, creating new keys"),await(async()=>{i.resetKeys(),await this.signObject(i.keys.master),r.addCrossSigningKeys(e,i.keys);const t=this.deviceList.getStoredDevice(this.userId,this.deviceId),n=await i.signDevice(this.userId,t);r.addKeySignature(this.userId,this.deviceId,n),this.backupManager.backupInfo&&(await i.signObject(this.backupManager.backupInfo.auth_data,"master"),r.addSessionBackup(this.backupManager.backupInfo))})()):s&&o?l.logger.log("Cross-signing public keys trusted and private keys found locally"):a&&(l.logger.log("Cross-signing private keys not found locally, but they are available in secret storage, reading storage and caching locally"),await this.checkOwnCrossSigningTrust({allowPrivateKeyRequests:!0}));const d=r.crossSigningCallbacks.privateKeys;if(d.size&&!this.baseApis.cryptoCallbacks.saveCrossSigningKeys){const e=new f.SecretStorage(r.accountDataClientAdapter,r.ssssCryptoCallbacks);await e.hasKey()&&(l.logger.log("Storing new cross-signing private keys in secret storage"),await m.CrossSigningInfo.storeInSecretStorage(d,e))}const u=r.buildOperation();await u.apply(this),await r.persist(this),l.logger.log("Cross-signing ready")}async bootstrapSecretStorage({createSecretStorageKey:e=(async()=>({})),keyBackupInfo:t,setupNewKeyBackup:n,setupNewSecretStorage:r,getKeyBackupPassphrase:i}={}){l.logger.log("Bootstrapping Secure Secret Storage");const s=this.baseApis.cryptoCallbacks,o=new g.EncryptionSetupBuilder(this.baseApis.store.accountData,s),a=new f.SecretStorage(o.accountDataClientAdapter,o.ssssCryptoCallbacks);let c=null;const u=async(e,t)=>{t&&(e.key=t);const{keyId:n,keyInfo:r}=await a.addKey(f.SECRET_STORAGE_ALGORITHM_V1_AES,e);return t&&o.ssssCryptoCallbacks.addPrivateKey(n,r,t),await a.setDefaultKeyId(n),n},h=async e=>{if(this.crossSigningInfo.getId()&&await this.crossSigningInfo.isStoredInKeyCache("master"))try{l.logger.log("Adding cross-signing signature to key backup"),await this.crossSigningInfo.signObject(e,"master")}catch(e){l.logger.error("Signing key backup with cross-signing keys failed",e)}else l.logger.warn("Cross-signing keys not available, skipping signature on key backup")},p=await this.getSecretStorageKey(),[y,v]=p||[null,null],b=!r&&v&&v.algorithm===f.SECRET_STORAGE_ALGORITHM_V1_AES;if(l.logger.log({keyBackupInfo:t,setupNewKeyBackup:n,setupNewSecretStorage:r,storageExists:b,oldKeyInfo:v}),b||t)if(!b&&t){l.logger.log("Secret storage does not exist, using key backup key");const e=await this.getSessionBackupPrivateKey()||await i(),n={};t.auth_data.private_key_salt&&t.auth_data.private_key_iterations&&(n.passphrase={algorithm:"m.pbkdf2",iterations:t.auth_data.private_key_iterations,salt:t.auth_data.private_key_salt,bits:256}),c=await u(n,e),await a.store("m.megolm_backup.v1",d.encodeBase64(e),[c]),await h(t.auth_data),o.addSessionBackup(t)}else l.logger.log("Secret storage exists"),v&&v.algorithm===f.SECRET_STORAGE_ALGORITHM_V1_AES&&await(async(e,t)=>{if(!t.mac){const n=await this.baseApis.cryptoCallbacks.getSecretStorageKey({keys:{[e]:t}},"");if(n){const r=n[1];o.ssssCryptoCallbacks.addPrivateKey(e,t,r);const{iv:i,mac:s}=await(0,A.calculateKeyCheck)(r);t.iv=i,t.mac=s,await o.setAccountData(`m.secret_storage.key.${e}`,t)}}})(y,v);else{l.logger.log("Secret storage does not exist, creating new storage key");const{keyInfo:t,privateKey:n}=await e();c=await u(t,n)}if(!this.baseApis.cryptoCallbacks.saveCrossSigningKeys&&await this.isCrossSigningReady()&&(c||!await this.crossSigningInfo.isStoredInSecretStorage(a))){l.logger.log("Copying cross-signing private keys from cache to secret storage");const e=await this.crossSigningInfo.getCrossSigningKeysFromCache();await m.CrossSigningInfo.storeInSecretStorage(e,a)}if(n&&!t){l.logger.log("Creating new message key backup version");const e=await this.baseApis.prepareKeyBackupVersion(null,{secureSecretStorage:!1}),t=(0,_.decodeRecoveryKey)(e.recovery_key);await a.store("m.megolm_backup.v1",d.encodeBase64(t));const n={algorithm:e.algorithm,auth_data:e.auth_data};await h(n.auth_data),await this.signObject(n.auth_data),o.addSessionBackup(n)}const w=await a.get("m.megolm_backup.v1");if(w){l.logger.info("Got session backup key from secret storage: caching");const e=j(w);e&&await a.store("m.megolm_backup.v1",e,[c||y]);const t=new Uint8Array(d.decodeBase64(e||w));await o.addSessionBackupPrivateKeyToCache(t)}else if(this.backupManager.getKeyBackupEnabled()){const e=await this.getSessionBackupPrivateKey()||await i();if(!e)return void l.logger.error("Key backup is enabled but couldn't get key backup key!");l.logger.info("Got session backup key from cache/user that wasn't in SSSS: saving to SSSS"),await a.store("m.megolm_backup.v1",d.encodeBase64(e))}const S=o.buildOperation();await S.apply(this),await o.persist(this),l.logger.log("Secure Secret Storage ready")}addSecretStorageKey(e,t,n){return this.secretStorage.addKey(e,t,n)}hasSecretStorageKey(e){return this.secretStorage.hasKey(e)}getSecretStorageKey(e){return this.secretStorage.getKey(e)}storeSecret(e,t,n){return this.secretStorage.store(e,t,n)}getSecret(e){return this.secretStorage.get(e)}isSecretStored(e,t){return this.secretStorage.isStored(e,t)}requestSecret(e,t){return t||(t=Object.keys(this.deviceList.getRawStoredDevicesForUser(this.userId))),this.secretStorage.request(e,t)}getDefaultSecretStorageKeyId(){return this.secretStorage.getDefaultKeyId()}setDefaultSecretStorageKeyId(e){return this.secretStorage.setDefaultKeyId(e)}checkSecretStorageKey(e,t){return this.secretStorage.checkKey(e,t)}checkSecretStoragePrivateKey(e,t){let r=null;try{return r=new n.g.Olm.PkDecryption,r.init_with_private_key(e)===t}finally{r&&r.free()}}async getSessionBackupPrivateKey(){let e=await new Promise((e=>{this.cryptoStore.doTxn("readonly",[v.IndexedDBCryptoStore.STORE_ACCOUNT],(t=>{this.cryptoStore.getSecretStorePrivateKey(t,e,"m.megolm_backup.v1")}))}));if(e&&"string"==typeof e&&(e=new Uint8Array(d.decodeBase64(j(e)||e)),await this.storeSessionBackupPrivateKey(e)),e&&e.ciphertext){const t=Buffer.from(this.olmDevice.pickleKey),n=await(0,A.decryptAES)(e,t,"m.megolm_backup.v1");e=d.decodeBase64(n)}return e}async storeSessionBackupPrivateKey(e){if(!(e instanceof Uint8Array))throw new Error(`storeSessionBackupPrivateKey expects Uint8Array, got ${e}`);const t=Buffer.from(this.olmDevice.pickleKey),n=await(0,A.encryptAES)(d.encodeBase64(e),t,"m.megolm_backup.v1");return this.cryptoStore.doTxn("readwrite",[v.IndexedDBCryptoStore.STORE_ACCOUNT],(e=>{this.cryptoStore.storeSecretStorePrivateKey(e,"m.megolm_backup.v1",n)}))}checkCrossSigningPrivateKey(e,t){let r=null;try{return r=new n.g.Olm.PkSigning,r.init_with_seed(e)===t}finally{r&&r.free()}}async afterCrossSigningLocalKeyChange(){l.logger.info("Starting cross-signing key change post-processing");const e=this.deviceList.getStoredDevice(this.userId,this.deviceId),t=await this.crossSigningInfo.signDevice(this.userId,e);l.logger.info(`Starting background key sig upload for ${this.deviceId}`);const n=({shouldEmit:e=!1})=>this.baseApis.uploadKeySignatures({[this.userId]:{[this.deviceId]:t}}).then((t=>{const{failures:r}=t||{};if(Object.keys(r||[]).length>0)throw e&&this.baseApis.emit("crypto.keySignatureUploadFailure",r,"afterCrossSigningLocalKeyChange",n),new C.KeySignatureUploadError("Key upload failed",{failures:r});l.logger.info(`Finished background key sig upload for ${this.deviceId}`)})).catch((e=>{l.logger.error(`Error during background key sig upload for ${this.deviceId}`,e)}));n({shouldEmit:!0});const r=this.baseApis.cryptoCallbacks.shouldUpgradeDeviceVerifications;if(r){l.logger.info("Starting device verification upgrade");const e={};for(const[t,n]of Object.entries(this.deviceList.crossSigningInfo)){const r=await this.checkForDeviceVerificationUpgrade(t,m.CrossSigningInfo.fromStorage(n,t));r&&(e[t]=r)}if(Object.keys(e).length>0){l.logger.info(`Found ${Object.keys(e).length} verif users to upgrade`);try{const t=await r({users:e});if(t)for(const n of t)n in e&&await this.baseApis.setDeviceVerified(n,e[n].crossSigningInfo.getId())}catch(e){l.logger.log("shouldUpgradeDeviceVerifications threw an error: not upgrading",e)}}l.logger.info("Finished device verification upgrade")}l.logger.info("Finished cross-signing key change post-processing")}async checkForDeviceVerificationUpgrade(e,t){const n=this.crossSigningInfo.checkUserTrust(t);if(t.firstUse&&!n.isVerified()){const n=this.deviceList.getRawStoredDevicesForUser(e),r=await this.checkForValidDeviceSignature(e,t.keys.master,n);if(r.length)return{devices:r.map((e=>h.DeviceInfo.fromStorage(n[e],e))),crossSigningInfo:t}}}async checkForValidDeviceSignature(e,t,n){const r=[];if(n&&t.signatures&&t.signatures[e])for(const i of Object.keys(t.signatures[e])){const[,s]=i.split(":",2);if(s in n&&n[s].verified===D.VERIFIED)try{await d.verifySignature(this.olmDevice,t,e,s,n[s].keys[i]),r.push(s)}catch(e){}}return r}getCrossSigningId(e){return this.crossSigningInfo.getId(e)}getStoredCrossSigningForUser(e){return this.deviceList.getStoredCrossSigningForUser(e)}checkUserTrust(e){const t=this.deviceList.getStoredCrossSigningForUser(e);return t?this.crossSigningInfo.checkUserTrust(t):new m.UserTrustLevel(!1,!1,!1)}checkDeviceTrust(e,t){const n=this.deviceList.getStoredDevice(e,t);return this.checkDeviceInfoTrust(e,n)}checkDeviceInfoTrust(e,t){const n=!(!t||!t.isVerified()),r=this.deviceList.getStoredCrossSigningForUser(e);if(t&&r){const i=this.trustCrossSignedDevices||e===this.userId;return this.crossSigningInfo.checkDeviceTrust(r,t,n,i)}return new m.DeviceTrustLevel(!1,!1,n,!1)}async checkOwnCrossSigningTrust({allowPrivateKeyRequests:e=!1}={}){const t=this.userId;await this.downloadKeys([this.userId]);const n=await this.crossSigningInfo.getCrossSigningKeysFromCache(),r=this.deviceList.getStoredCrossSigningForUser(t);if(!r)return void l.logger.error("Got cross-signing update event for user "+t+" but no new cross-signing information found!");const i=r.getId(),s=this.crossSigningInfo.getId()!==i,o=r.getId()&&!n.has("master");if(s&&l.logger.info("Got new master public key",i),e&&(s||o)){l.logger.info("Attempting to retrieve cross-signing master private key");let e=null;try{e=(await this.crossSigningInfo.getCrossSigningKey("master",i))[1],l.logger.info("Got cross-signing master private key")}finally{e&&e.free()}}const a=this.crossSigningInfo.getId("self_signing"),c=this.crossSigningInfo.getId("user_signing");this.storeTrustedSelfKeys(r.keys);const d=a!==r.getId("self_signing"),u=c!==r.getId("user_signing"),h=r.getId("self_signing")&&!n.has("self_signing"),p=r.getId("user_signing")&&!n.has("user_signing"),m={};if(d&&l.logger.info("Got new self-signing key",r.getId("self_signing")),e&&(d||h)){l.logger.info("Attempting to retrieve cross-signing self-signing private key");let e=null;try{e=(await this.crossSigningInfo.getCrossSigningKey("self_signing",r.getId("self_signing")))[1],l.logger.info("Got cross-signing self-signing private key")}finally{e&&e.free()}const t=this.deviceList.getStoredDevice(this.userId,this.deviceId),n=await this.crossSigningInfo.signDevice(this.userId,t);m[this.deviceId]=n}if(u&&l.logger.info("Got new user-signing key",r.getId("user_signing")),e&&(u||p)){l.logger.info("Attempting to retrieve cross-signing user-signing private key");let e=null;try{e=(await this.crossSigningInfo.getCrossSigningKey("user_signing",r.getId("user_signing")))[1],l.logger.info("Got cross-signing user-signing private key")}finally{e&&e.free()}}if(s){const e=this.crossSigningInfo.keys.master;await this.signObject(e);const t=e.signatures[this.userId]["ed25519:"+this.deviceId];m[this.crossSigningInfo.getId()]=Object.assign({},e,{signatures:{[this.userId]:{["ed25519:"+this.deviceId]:t}}})}const g=Object.keys(m);if(g.length){const e=({shouldEmit:t=!1})=>(l.logger.info(`Starting background key sig upload for ${g}`),this.baseApis.uploadKeySignatures({[this.userId]:m}).then((n=>{const{failures:r}=n||{};if(l.logger.info(`Finished background key sig upload for ${g}`),Object.keys(r||[]).length>0)throw t&&this.baseApis.emit("crypto.keySignatureUploadFailure",r,"checkOwnCrossSigningTrust",e),new C.KeySignatureUploadError("Key upload failed",{failures:r})})).catch((e=>{l.logger.error(`Error during background key sig upload for ${g}`,e)})));e({shouldEmit:!0})}this.emit("userTrustStatusChanged",t,this.checkUserTrust(t)),s&&(this.baseApis.emit("crossSigning.keysChanged",{}),await this.afterCrossSigningLocalKeyChange()),await this.backupManager.checkKeyBackup()}async storeTrustedSelfKeys(e){e?this.crossSigningInfo.setKeys(e):this.crossSigningInfo.clearKeys(),await this.cryptoStore.doTxn("readwrite",[v.IndexedDBCryptoStore.STORE_ACCOUNT],(e=>{this.cryptoStore.storeCrossSigningKeys(e,this.crossSigningInfo.keys)}))}async checkDeviceVerifications(e){const t=this.baseApis.cryptoCallbacks.shouldUpgradeDeviceVerifications;if(t){if(l.logger.info(`Starting device verification upgrade for ${e}`),this.crossSigningInfo.keys.user_signing){const n=this.deviceList.getStoredCrossSigningForUser(e);if(n){const r=await this.checkForDeviceVerificationUpgrade(e,n);r&&(await t({users:{[e]:r}})).includes(e)&&await this.baseApis.setDeviceVerified(e,n.getId())}}l.logger.info(`Finished device verification upgrade for ${e}`)}}async setTrustedBackupPubKey(e){this.sessionStore.setLocalTrustedBackupPubKey(e),await this.backupManager.checkKeyBackup()}enableLazyLoading(){this.lazyLoadMembers=!0}registerEventHandlers(e){e.on("RoomMember.membership",((e,t,n)=>{try{this.onRoomMembership(e,t,n)}catch(e){l.logger.error("Error handling membership change:",e)}})),e.on("toDeviceEvent",this.onToDeviceEvent),e.on("Room.timeline",this.onTimelineEvent),e.on("Event.decrypted",this.onTimelineEvent)}start(){this.outgoingRoomKeyRequestManager.start()}stop(){this.outgoingRoomKeyRequestManager.stop(),this.deviceList.stop(),this.dehydrationManager.stop()}getDeviceEd25519Key(){return this.olmDevice.deviceEd25519Key}getDeviceCurve25519Key(){return this.olmDevice.deviceCurve25519Key}setGlobalBlacklistUnverifiedDevices(e){this.globalBlacklistUnverifiedDevices=e}getGlobalBlacklistUnverifiedDevices(){return this.globalBlacklistUnverifiedDevices}setGlobalErrorOnUnknownDevices(e){this.globalErrorOnUnknownDevices=e}getGlobalErrorOnUnknownDevices(){return this.globalErrorOnUnknownDevices}uploadDeviceKeys(){const e={algorithms:this.supportedAlgorithms,device_id:this.deviceId,keys:this.deviceKeys,user_id:this.userId};return this.signObject(e).then((()=>this.baseApis.uploadKeysRequest({device_keys:e})))}updateOneTimeKeyCount(e){if(!isFinite(e))throw new TypeError("Parameter for updateOneTimeKeyCount has to be a number");this.oneTimeKeyCount=e}setNeedsNewFallback(e){this.needsNewFallback=!!e}getNeedsNewFallback(){return this.needsNewFallback}maybeUploadOneTimeKeys(){if(this.oneTimeKeyCheckInProgress)return;const e=Date.now();if(null!==this.lastOneTimeKeyCheck&&e-this.lastOneTimeKeyCheck<6e4)return;this.lastOneTimeKeyCheck=e;const t=this.olmDevice.maxNumberOfOneTimeKeys(),n=Math.floor(t/2),r=async e=>{for(;n>e||this.getNeedsNewFallback();){if(n>e){l.logger.info("generating oneTimeKeys");const t=Math.min(n-e,5);await this.olmDevice.generateOneTimeKeys(t)}if(this.getNeedsNewFallback()){const e=await this.olmDevice.getFallbackKey();e.curve25519&&0!=Object.keys(e.curve25519).length||(l.logger.info("generating fallback key"),this.fallbackCleanup&&(clearTimeout(this.fallbackCleanup),delete this.fallbackCleanup),await this.olmDevice.generateFallbackKey())}l.logger.info("calling uploadOneTimeKeys");const t=await this.uploadOneTimeKeys();if(!t.one_time_key_counts||!t.one_time_key_counts.signed_curve25519)throw new Error("response for uploading keys does not contain one_time_key_counts.signed_curve25519");e=t.one_time_key_counts.signed_curve25519}};this.oneTimeKeyCheckInProgress=!0,Promise.resolve().then((()=>void 0!==this.oneTimeKeyCount?Promise.resolve(this.oneTimeKeyCount):this.baseApis.uploadKeysRequest({}).then((e=>e.one_time_key_counts.signed_curve25519||0)))).then((e=>r(e))).catch((e=>{l.logger.error("Error uploading one-time keys",e.stack||e)})).finally((()=>{this.oneTimeKeyCount=void 0,this.oneTimeKeyCheckInProgress=!1}))}async uploadOneTimeKeys(){const e=[];let t;if(this.getNeedsNewFallback()){t={};const n=await this.olmDevice.getFallbackKey();for(const[r,i]of Object.entries(n.curve25519)){const n={key:i,fallback:!0};t["signed_curve25519:"+r]=n,e.push(this.signObject(n))}this.setNeedsNewFallback(!1)}const n=await this.olmDevice.getOneTimeKeys(),r={};for(const t in n.curve25519)if(n.curve25519.hasOwnProperty(t)){const i={key:n.curve25519[t]};r["signed_curve25519:"+t]=i,e.push(this.signObject(i))}await Promise.all(e);const i={one_time_keys:r};t&&(i["org.matrix.msc2732.fallback_keys"]=t,i.fallback_keys=t);const s=await this.baseApis.uploadKeysRequest(i);return t&&(this.fallbackCleanup=setTimeout((()=>{delete this.fallbackCleanup,this.olmDevice.forgetOldFallbackKey()}),36e5)),await this.olmDevice.markKeysAsPublished(),s}downloadKeys(e,t){return this.deviceList.downloadKeys(e,t)}getStoredDevicesForUser(e){return this.deviceList.getStoredDevicesForUser(e)}getStoredDevice(e,t){return this.deviceList.getStoredDevice(e,t)}saveDeviceList(e){return this.deviceList.saveIfDirty(e)}async setDeviceVerification(e,t,n,r,i){void 0===n&&(n=null),void 0===r&&(r=null),void 0===i&&(i=null);const s=this.deviceList.getStoredCrossSigningForUser(e);if(s&&s.getId()===t){if(null!==r||null!==i)throw new Error("Cannot set blocked or known for a cross-signing key");if(!n)throw new Error("Cannot set a cross-signing key as unverified");if(this.crossSigningInfo.getId()||e!==this.crossSigningInfo.userId||(this.storeTrustedSelfKeys(s.keys),this.emit("userTrustStatusChanged",this.userId,this.checkUserTrust(e))),e!==this.userId){l.logger.info("Master key "+s.getId()+" for "+e+" marked verified. Signing...");const n=await this.crossSigningInfo.signUser(s);if(n){const r=async({shouldEmit:i=!1})=>{l.logger.info("Uploading signature for "+e+"...");const s=await this.baseApis.uploadKeySignatures({[e]:{[t]:n}}),{failures:o}=s||{};if(Object.keys(o||[]).length>0)throw i&&this.baseApis.emit("crypto.keySignatureUploadFailure",o,"setDeviceVerification",r),new C.KeySignatureUploadError("Key upload failed",{failures:o})};await r({shouldEmit:!0})}return n}return s}const o=this.deviceList.getRawStoredDevicesForUser(e);if(!o||!o[t])throw new Error("Unknown device "+e+":"+t);const a=o[t];let c=a.verified;n?c=D.VERIFIED:null!==n&&c==D.VERIFIED&&(c=D.UNVERIFIED),r?c=D.BLOCKED:null!==r&&c==D.BLOCKED&&(c=D.UNVERIFIED);let d=a.known;if(null!==i&&(d=i),a.verified===c&&a.known===d||(a.verified=c,a.known=d,this.deviceList.storeDevicesForUser(e,o),this.deviceList.saveIfDirty()),n&&e===this.userId){let n;if(l.logger.info("Own device "+t+" marked verified: signing"),this.checkDeviceTrust(e,t).isCrossSigningVerified()?l.logger.log(`Own device ${t} already cross-signing verified`):n=await this.crossSigningInfo.signDevice(e,h.DeviceInfo.fromStorage(a,t)),n){const r=async({shouldEmit:i=!1})=>{l.logger.info("Uploading signature for "+t);const s=await this.baseApis.uploadKeySignatures({[e]:{[t]:n}}),{failures:o}=s||{};if(Object.keys(o||[]).length>0)throw i&&this.baseApis.emit("crypto.keySignatureUploadFailure",o,"setDeviceVerification",r),new C.KeySignatureUploadError("Key upload failed",{failures:o})};await r({shouldEmit:!0})}}const u=h.DeviceInfo.fromStorage(a,t);return this.emit("deviceVerificationChanged",e,t,u),u}findVerificationRequestDMInProgress(e){return this.inRoomVerificationRequests.findRequestInProgress(e)}getVerificationRequestsToDeviceInProgress(e){return this.toDeviceVerificationRequests.getRequestsInProgress(e)}requestVerificationDM(e,t){const n=this.inRoomVerificationRequests.findRequestInProgress(t);if(n)return Promise.resolve(n);const r=new x.InRoomChannel(this.baseApis,t,e);return this.requestVerificationWithChannel(e,r,this.inRoomVerificationRequests)}requestVerification(e,t){t||(t=Object.keys(this.deviceList.getRawStoredDevicesForUser(e)));const n=this.toDeviceVerificationRequests.findRequestInProgress(e,t);if(n)return Promise.resolve(n);const r=new E.ToDeviceChannel(this.baseApis,e,t,E.ToDeviceChannel.makeTransactionId());return this.requestVerificationWithChannel(e,r,this.toDeviceVerificationRequests)}async requestVerificationWithChannel(e,t,n){let r=new k.VerificationRequest(t,this.verificationMethods,this.baseApis);t.transactionId&&n.setRequestByChannel(t,r),await r.sendRequest();const i=n.getRequestByChannel(t);return i?r=i:(l.logger.log(`Crypto: adding new request to requestsByTxnId with id ${t.transactionId} ${t.roomId}`),n.setRequestByChannel(t,r)),r}beginKeyVerification(e,t,n,r=null){let i;if(r){if(i=this.toDeviceVerificationRequests.getRequestBySenderAndTxnId(t,r),!i)throw new Error(`No request found for user ${t} with transactionId ${r}`)}else{r=E.ToDeviceChannel.makeTransactionId();const e=new E.ToDeviceChannel(this.baseApis,t,[n],r,n);i=new k.VerificationRequest(e,this.verificationMethods,this.baseApis),this.toDeviceVerificationRequests.setRequestBySenderAndTxnId(t,r,i)}return i.beginKeyVerification(e,{userId:t,deviceId:n})}async legacyDeviceVerification(e,t,n){const r=E.ToDeviceChannel.makeTransactionId(),i=new E.ToDeviceChannel(this.baseApis,e,[t],r,t),s=new k.VerificationRequest(i,this.verificationMethods,this.baseApis);this.toDeviceVerificationRequests.setRequestBySenderAndTxnId(e,r,s);const o=s.beginKeyVerification(n,{userId:e,deviceId:t});return await Promise.race([o.verify(),s.waitFor((e=>e.started))]),s}async getOlmSessionsForUser(e){const t=this.getStoredDevicesForUser(e)||[],n={};for(let e=0;e<t.length;++e){const r=t[e],i=r.getIdentityKey(),s=await this.olmDevice.getSessionInfoForDevice(i);n[r.deviceId]={deviceIdKey:i,sessions:s}}return n}getEventSenderDeviceInfo(e){const t=e.getSenderKey(),n=e.getWireContent().algorithm;if(!t||!n)return null;if(e.getForwardingCurve25519KeyChain().length>0)return null;if(e.isKeySourceUntrusted())return null;const r=this.deviceList.getDeviceByIdentityKey(n,t);if(null===r)return null;const i=e.getClaimedEd25519Key();return i?i!==r.getFingerprint()?(l.logger.warn("Event "+e.getId()+" claims ed25519 key "+i+" but sender device has key "+r.getFingerprint()),null):r:(l.logger.warn("Event "+e.getId()+" claims no ed25519 key: cannot verify sending device"),null)}getEventEncryptionInfo(e){const t={};if(t.senderKey=e.getSenderKey(),t.algorithm=e.getWireContent().algorithm,!t.senderKey||!t.algorithm)return t.encrypted=!1,t;t.encrypted=!0,e.getForwardingCurve25519KeyChain().length>0||e.isKeySourceUntrusted()?t.authenticated=!1:t.authenticated=!0,t.sender=this.deviceList.getDeviceByIdentityKey(t.algorithm,t.senderKey);const n=e.getClaimedEd25519Key();return n||(l.logger.warn("Event "+e.getId()+" claims no ed25519 key: cannot verify sending device"),t.mismatchedSender=!0),t.sender&&n!==t.sender.getFingerprint()&&(l.logger.warn("Event "+e.getId()+" claims ed25519 key "+n+"but sender device has key "+t.sender.getFingerprint()),t.mismatchedSender=!0),t}forceDiscardSession(e){const t=this.roomEncryptors[e];if(void 0===t)throw new Error("Room not encrypted");if(void 0===t.forceDiscardSession)throw new Error("Room encryption algorithm doesn't support session discarding");t.forceDiscardSession()}async setRoomEncryption(e,t,n){if(!t.algorithm)return void l.logger.log("Ignoring setRoomEncryption with no algorithm");const r=this.roomList.getRoomEncryption(e);if(r&&JSON.stringify(r)!=JSON.stringify(t))return void l.logger.error("Ignoring m.room.encryption event which requests a change of config in "+e);if(this.roomEncryptors[e])return;let i=null;r||(i=this.roomList.setRoomEncryption(e,t));const s=p.ENCRYPTION_CLASSES[t.algorithm];if(!s)throw new Error("Unable to encrypt with "+t.algorithm);const o=new s({userId:this.userId,deviceId:this.deviceId,crypto:this,olmDevice:this.olmDevice,baseApis:this.baseApis,roomId:e,config:t});this.roomEncryptors[e]=o,i&&await i,this.lazyLoadMembers?l.logger.log("Enabling encryption in "+e):(l.logger.log("Enabling encryption in "+e+"; starting to track device lists for all users therein"),await this.trackRoomDevices(e),n||this.deviceList.refreshOutdatedDeviceLists())}trackRoomDevices(e){let t=this.roomDeviceTrackingState[e];return t||(t=(async()=>{if(!this.roomEncryptors[e])return;const t=this.clientStore.getRoom(e);if(!t)throw new Error(`Unable to start tracking devices in unknown room ${e}`);l.logger.log(`Starting to track devices for room ${e} ...`),(await t.getEncryptionTargetMembers()).forEach((e=>{this.deviceList.startTrackingDeviceList(e.userId)}))})(),this.roomDeviceTrackingState[e]=t.catch((t=>{throw this.roomDeviceTrackingState[e]=null,t}))),t}ensureOlmSessionsForUsers(e,t){const n={};for(let t=0;t<e.length;++t){const r=e[t];n[r]=[];const i=this.getStoredDevicesForUser(r)||[];for(let e=0;e<i.length;++e){const t=i[e];t.getIdentityKey()!=this.olmDevice.deviceCurve25519Key&&t.verified!=D.BLOCKED&&n[r].push(t)}}return d.ensureOlmSessionsForDevices(this.olmDevice,this.baseApis,n,t)}async exportRoomKeys(){const e=[];return await this.cryptoStore.doTxn("readonly",[v.IndexedDBCryptoStore.STORE_INBOUND_GROUP_SESSIONS],(t=>{this.cryptoStore.getAllEndToEndInboundGroupSessions(t,(t=>{if(null===t)return;const n=this.olmDevice.exportInboundGroupSession(t.senderKey,t.sessionId,t.sessionData);delete n.first_known_index,n.algorithm=d.MEGOLM_ALGORITHM,e.push(n)}))})),e}importRoomKeys(e,t={}){let n=0,r=0;const i=e.length;function s(){t.progressCallback({stage:"load_keys",successes:n,failures:r,total:i})}return Promise.all(e.map((e=>e.room_id&&e.algorithm?this.getRoomDecryptor(e.room_id,e.algorithm).importRoomKey(e,t).finally((()=>{n++,t.progressCallback&&s()})):(l.logger.warn("ignoring room key entry with missing fields",e),r++,t.progressCallback&&s(),null)))).then()}countSessionsNeedingBackup(){return this.backupManager.countSessionsNeedingBackup()}prepareToEncrypt(e){const t=this.roomEncryptors[e.roomId];t&&t.prepareToEncrypt(e)}async encryptEvent(e,t){if(!t)throw new Error("Cannot send encrypted messages in unknown rooms");const n=e.getRoomId(),r=this.roomEncryptors[n];if(!r)throw new Error("Room was previously configured to use encryption, but is no longer. Perhaps the homeserver is hiding the configuration event.");this.roomDeviceTrackingState[n]||this.trackRoomDevices(n),await this.roomDeviceTrackingState[n];let i=e.getContent();const s=i["m.relates_to"];s&&(i=Object.assign({},i),delete i["m.relates_to"]);const o=i["io.element.performance_metrics"];o&&(i=Object.assign({},i),delete i["io.element.performance_metrics"]);const a=await r.encryptMessage(t,e.getType(),i);s&&(a["m.relates_to"]=s),o&&(a["io.element.performance_metrics"]=o),e.makeEncrypted("m.room.encrypted",a,this.olmDevice.deviceCurve25519Key,this.olmDevice.deviceEd25519Key)}async decryptEvent(e){if(e.isRedacted()){const t=new O.MatrixEvent(e.getUnsigned().redacted_because),n=await this.decryptEvent(t);return{clearEvent:{room_id:e.getRoomId(),type:"m.room.message",content:{},unsigned:{redacted_because:n.clearEvent}}}}{const t=e.getWireContent(),n=this.getRoomDecryptor(e.getRoomId(),t.algorithm);return await n.decryptEvent(e)}}async handleDeviceListChanges(e,t){e.oldSyncToken&&await this.evalDeviceListChanges(t)}requestRoomKey(e,t,n=!1){return this.outgoingRoomKeyRequestManager.queueRoomKeyRequest(e,t,n).then((()=>{this.sendKeyRequestsImmediately&&this.outgoingRoomKeyRequestManager.sendQueuedRequests()})).catch((e=>{l.logger.error("Error requesting key for event",e)}))}cancelRoomKeyRequest(e){this.outgoingRoomKeyRequestManager.cancelRoomKeyRequest(e).catch((e=>{l.logger.warn("Error clearing pending room key requests",e)}))}async cancelAndResendAllOutgoingKeyRequests(){await this.outgoingRoomKeyRequestManager.cancelAndResendAllOutgoingRequests()}async onCryptoEvent(e){const t=e.getRoomId(),n=e.getContent();try{await this.setRoomEncryption(t,n,!0)}catch(e){l.logger.error("Error configuring encryption in room "+t+":",e)}}async onSyncWillProcess(e){e.oldSyncToken||(l.logger.log("Initial sync performed - resetting device tracking state"),this.deviceList.stopTrackingAllDeviceLists(),this.deviceList.startTrackingDeviceList(this.userId),this.roomDeviceTrackingState={}),this.sendKeyRequestsImmediately=!1}async onSyncCompleted(e){this.deviceList.setSyncToken(e.nextSyncToken),this.deviceList.saveIfDirty(),this.deviceList.startTrackingDeviceList(this.userId),this.deviceList.refreshOutdatedDeviceLists(),e.catchingUp||(this.maybeUploadOneTimeKeys(),this.processReceivedRoomKeyRequests(),this.outgoingRoomKeyRequestManager.sendQueuedRequests(),this.sendKeyRequestsImmediately=!0)}async evalDeviceListChanges(e){if(e.changed&&Array.isArray(e.changed)&&e.changed.forEach((e=>{this.deviceList.invalidateUserDeviceList(e)})),e.left&&Array.isArray(e.left)&&e.left.length){const t=new Set(await this.getTrackedE2eUsers());e.left.forEach((e=>{t.has(e)||this.deviceList.stopTrackingDeviceList(e)}))}}async getTrackedE2eUsers(){const e=[];for(const t of this.getTrackedE2eRooms()){const n=await t.getEncryptionTargetMembers();for(const t of n)e.push(t.userId)}return e}getTrackedE2eRooms(){return this.clientStore.getRooms().filter((e=>{if(!this.roomEncryptors[e.roomId])return!1;if(!this.roomDeviceTrackingState[e.roomId])return!1;const t=e.getMyMembership();return"join"===t||"invite"===t}))}onRoomKeyEvent(e){const t=e.getContent();t.room_id&&t.algorithm?(this.backupManager.checkedForBackup||this.backupManager.checkAndStart(),this.getRoomDecryptor(t.room_id,t.algorithm).onRoomKeyEvent(e)):l.logger.error("key event is missing fields")}onRoomKeyWithheldEvent(e){const t=e.getContent();if(!(("m.no_olm"===t.code||t.room_id&&t.session_id)&&t.algorithm&&t.sender_key))return void l.logger.error("key withheld event is missing fields");l.logger.info(`Got room key withheld event from ${e.getSender()} (${t.sender_key}) for ${t.algorithm}/${t.room_id}/${t.session_id} with reason ${t.code} (${t.reason})`);const n=this.getRoomDecryptor(t.room_id,t.algorithm);if(n.onRoomKeyWithheldEvent&&n.onRoomKeyWithheldEvent(e),!t.room_id){const e=this.getRoomDecryptors(t.algorithm);for(const n of e)n.retryDecryptionFromSender(t.sender_key)}}onKeyVerificationMessage(e){E.ToDeviceChannel.validateEvent(e,this.baseApis)&&this.handleVerificationEvent(e,this.toDeviceVerificationRequests,(e=>{if(!E.ToDeviceChannel.canCreateRequest(E.ToDeviceChannel.getEventType(e)))return;const t=e.getContent(),n=t&&t.from_device;if(!n)return;const r=e.getSender(),i=new E.ToDeviceChannel(this.baseApis,r,[n]);return new k.VerificationRequest(i,this.verificationMethods,this.baseApis)}))}async handleVerificationEvent(e,t,n,r=!0){if(e.isSending()&&e.status!=O.EventStatus.SENT){let t,n;try{await new Promise(((r,i)=>{t=r,n=()=>{e.status==O.EventStatus.CANCELLED&&i(new Error("Event status set to CANCELLED."))},e.once("Event.localEventIdReplaced",t),e.on("Event.status",n)}))}catch(e){return void l.logger.error("error while waiting for the verification event to be sent: "+e.message)}finally{e.removeListener("Event.localEventIdReplaced",t),e.removeListener("Event.status",n)}}let i=t.getRequest(e),s=!1;if(!i){if(i=n(e),!i)return void l.logger.log(`Crypto: could not find VerificationRequest for ${e.getType()}, and could not create one, so ignoring.`);s=!0,t.setRequest(e,i)}e.setVerificationRequest(i);try{await i.channel.handleEvent(e,i,r)}catch(e){l.logger.error("error while handling verification event: "+e.message)}s&&!i.initiatedByMe&&!i.invalid&&!i.observeOnly&&this.baseApis.emit("crypto.verification.request",i)}async onToDeviceBadEncrypted(e){const t=e.getWireContent(),n=e.getSender(),r=t.algorithm,i=t.sender_key,s=()=>{const e=this.getRoomDecryptors(d.MEGOLM_ALGORITHM);for(const t of e)t.retryDecryptionFromSender(i)};if(void 0===n||void 0===i||void 0===i)return;this.lastNewSessionForced[n]=this.lastNewSessionForced[n]||{};const o=this.lastNewSessionForced[n][i]||0;if(o+36e5>Date.now())return l.logger.debug("New session already forced with device "+n+":"+i+" at "+o+": not forcing another"),await this.olmDevice.recordSessionProblem(i,"wedged",!0),void s();let a=this.deviceList.getDeviceByIdentityKey(r,i);if(!a&&(await this.downloadKeys([n],!1),a=this.deviceList.getDeviceByIdentityKey(r,i),!a))return l.logger.info("Couldn't find device for identity key "+i+": not re-establishing session"),await this.olmDevice.recordSessionProblem(i,"wedged",!1),void s();const c={};c[n]=[a],await d.ensureOlmSessionsForDevices(this.olmDevice,this.baseApis,c,!0),this.lastNewSessionForced[n][i]=Date.now();const u={algorithm:d.OLM_ALGORITHM,sender_key:this.olmDevice.deviceCurve25519Key,ciphertext:{}};await d.encryptMessageForDevice(u.ciphertext,this.userId,this.deviceId,this.olmDevice,n,a,{type:"m.dummy"}),await this.olmDevice.recordSessionProblem(i,"wedged",!0),s(),await this.baseApis.sendToDevice("m.room.encrypted",{[n]:{[a.deviceId]:u}});const h=await this.outgoingRoomKeyRequestManager.getOutgoingSentRoomKeyRequest(n,a.deviceId);for(const e of h)this.requestRoomKey(e.requestBody,e.recipients,!0)}onRoomMembership(e,t,n){const r=t.roomId,i=this.roomEncryptors[r];i&&(this.roomDeviceTrackingState[r]&&("join"==t.membership?(l.logger.log("Join event for "+t.userId+" in "+r),this.deviceList.startTrackingDeviceList(t.userId)):"invite"==t.membership&&this.clientStore.getRoom(r).shouldEncryptForInvitedMembers()&&(l.logger.log("Invite event for "+t.userId+" in "+r),this.deviceList.startTrackingDeviceList(t.userId))),i.onRoomMembership(e,t,n))}onRoomKeyRequestEvent(e){const t=e.getContent();if("request"===t.action){const t=new U(e);this.receivedRoomKeyRequests.push(t)}else if("request_cancellation"===t.action){const t=new B(e);this.receivedRoomKeyRequestCancellations.push(t)}}async processReceivedRoomKeyRequests(){if(!this.processingRoomKeyRequests){this.processingRoomKeyRequests=!0;try{const e=this.receivedRoomKeyRequests;this.receivedRoomKeyRequests=[];const t=this.receivedRoomKeyRequestCancellations;this.receivedRoomKeyRequestCancellations=[],await Promise.all(e.map((e=>this.processReceivedRoomKeyRequest(e)))),await Promise.all(t.map((e=>this.processReceivedRoomKeyRequestCancellation(e))))}catch(e){l.logger.error(`Error processing room key requsts: ${e}`)}finally{this.processingRoomKeyRequests=!1}}}async processReceivedRoomKeyRequest(e){const t=e.userId,n=e.deviceId,r=e.requestBody,i=r.room_id,s=r.algorithm;if(l.logger.log(`m.room_key_request from ${t}:${n} for ${i} / ${r.session_id} (id ${e.requestId})`),t!==this.userId){if(!this.roomEncryptors[i])return void l.logger.debug(`room key request for unencrypted room ${i}`);const e=this.roomEncryptors[i],s=this.deviceList.getStoredDevice(t,n);if(!s)return void l.logger.debug(`Ignoring keyshare for unknown device ${t}:${n}`);try{await e.reshareKeyWithDevice(r.sender_key,r.session_id,t,s)}catch(e){l.logger.warn("Failed to re-share keys for session "+r.session_id+" with device "+t+":"+s.deviceId,e)}return}if(n===this.deviceId)return void l.logger.log("Ignoring room key request from ourselves");if(!this.roomDecryptors[i])return void l.logger.log(`room key request for unencrypted room ${i}`);const o=this.roomDecryptors[i][s];if(o)if(await o.hasKeysForKeyRequest(e)){if(e.share=()=>{o.shareKeysWithDevice(e)},this.checkDeviceTrust(t,n).isVerified())return l.logger.log("device is already verified: sharing keys"),void e.share();this.emit("crypto.roomKeyRequest",e)}else l.logger.log(`room key request for unknown session ${i} / `+r.session_id);else l.logger.log(`room key request for unknown alg ${s} in room ${i}`)}async processReceivedRoomKeyRequestCancellation(e){l.logger.log(`m.room_key_request cancellation for ${e.userId}:${e.deviceId} (id ${e.requestId})`),this.emit("crypto.roomKeyRequestCancellation",e)}getRoomDecryptor(e,t){let n,r;if((e=e||null)&&(n=this.roomDecryptors[e],n||(this.roomDecryptors[e]=n={}),r=n[t],r))return r;const i=p.DECRYPTION_CLASSES[t];if(!i)throw new p.DecryptionError("UNKNOWN_ENCRYPTION_ALGORITHM",'Unknown encryption algorithm "'+t+'".');return r=new i({userId:this.userId,crypto:this,olmDevice:this.olmDevice,baseApis:this.baseApis,roomId:e}),n&&(n[t]=r),r}getRoomDecryptors(e){const t=[];for(const n of Object.values(this.roomDecryptors))e in n&&t.push(n[e]);return t}async signObject(e){const t=e.signatures||{},n=e.unsigned;delete e.signatures,delete e.unsigned,t[this.userId]=t[this.userId]||{},t[this.userId]["ed25519:"+this.deviceId]=await this.olmDevice.sign(s.default.stringify(e)),e.signatures=t,void 0!==n&&(e.unsigned=n)}}function j(e){if("string"!=typeof e||e.indexOf(",")<0)return null;const t=Uint8Array.from(e.split(","),(e=>parseInt(e)));return d.encodeBase64(t)}t.Crypto=N;class U{constructor(e){(0,i.default)(this,"userId",void 0),(0,i.default)(this,"deviceId",void 0),(0,i.default)(this,"requestId",void 0),(0,i.default)(this,"requestBody",void 0),(0,i.default)(this,"share",void 0);const t=e.getContent();this.userId=e.getSender(),this.deviceId=t.requesting_device_id,this.requestId=t.request_id,this.requestBody=t.body||{},this.share=()=>{throw new Error("don't know how to share keys for this request yet")}}}t.IncomingRoomKeyRequest=U;class B{constructor(e){(0,i.default)(this,"userId",void 0),(0,i.default)(this,"deviceId",void 0),(0,i.default)(this,"requestId",void 0);const t=e.getContent();this.userId=e.getSender(),this.deviceId=t.requesting_device_id,this.requestId=t.request_id}}},1597:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.deriveKey=a,t.keyFromAuthData=async function(e,t){if(!n.g.Olm)throw new Error("Olm is not available");if(!e.private_key_salt||!e.private_key_iterations)throw new Error("Salt and/or iterations not found: this backup cannot be restored with a passphrase");return await a(t,e.private_key_salt,e.private_key_iterations,e.private_key_bits||256)},t.keyFromPassphrase=async function(e){if(!n.g.Olm)throw new Error("Olm is not available");const t=(0,r.randomString)(32);return{key:await a(e,t,o,256),salt:t,iterations:o}};var r=n(8401),i=n(3102);const s="undefined"!=typeof window&&window.crypto?window.crypto.subtle||window.crypto.webkitSubtle:null,o=5e5;async function a(e,t,r,o=256){return s?async function(e,t,r,i){const s=n.g.crypto.subtle,o=n.g.TextEncoder;if(!s||!o)throw new Error("Password-based backup is not avaiable on this platform");const a=await s.importKey("raw",(new o).encode(e),{name:"PBKDF2"},!1,["deriveBits"]),l=await s.deriveBits({name:"PBKDF2",salt:(new o).encode(t),iterations:r,hash:"SHA-512"},a,i);return new Uint8Array(l)}(e,t,r,o):async function(e,t,n,r){const s=(0,i.getCrypto)();if(!s)throw new Error("No usable crypto implementation");return s.pbkdf2Sync(e,Buffer.from(t,"binary"),n,r,"sha512")}(e,t,r,o)}},2772:(e,t,n)=>{"use strict";var r=n(5318);Object.defineProperty(t,"__esModule",{value:!0}),t.OLM_ALGORITHM=t.MEGOLM_BACKUP_ALGORITHM=t.MEGOLM_ALGORITHM=void 0,t.decodeBase64=function(e){return Buffer.from(e,"base64")},t.encodeBase64=h,t.encodeUnpaddedBase64=function(e){return h(e).replace(/=+$/g,"")},t.encryptMessageForDevice=async function(e,t,n,r,i,s,a){const l=s.getIdentityKey(),c=await r.getSessionIdForDevice(l);if(null===c)return;o.logger.log("Using sessionid "+c+" for device "+i+":"+s.deviceId);const d={sender:t,sender_device:n,keys:{ed25519:r.deviceEd25519Key},recipient:i,recipient_keys:{ed25519:s.getFingerprint()}};Object.assign(d,a),e[l]=await r.encryptMessage(l,c,JSON.stringify(d))},t.ensureOlmSessionsForDevices=async function(e,t,n,r=!1,i,s,a=o.logger){"number"==typeof r&&(a=s,s=i,i=r,r=!1);const l=[],c={},u={};for(const[,t]of Object.entries(n))for(const n of t){const t=n.getIdentityKey();t!==e.deviceCurve25519Key&&(e.sessionsInProgress[t]||(e.sessionsInProgress[t]=new Promise((n=>{u[t]=r=>{delete e.sessionsInProgress[t],n(r)}}))))}for(const[t,i]of Object.entries(n)){c[t]={};for(const n of i){const i=n.deviceId,s=n.getIdentityKey();if(s===e.deviceCurve25519Key){a.info("Attempted to start session with ourself! Ignoring"),c[t][i]={device:n,sessionId:null};continue}const o=`for ${s} (${t}:${i})`,d=await e.getSessionIdForDevice(s,!!u[s],a);null!==d&&u[s]&&u[s](),(null===d||r)&&(r?a.info(`Forcing new Olm session ${o}`):a.info(`Making new Olm session ${o}`),l.push([t,i])),c[t][i]={device:n,sessionId:d}}}if(0===l.length)return c;let h,p=`one-time keys for ${l.length} devices`;try{a.debug(`Claiming ${p}`),h=await t.claimOneTimeKeys(l,"signed_curve25519",i),a.debug(`Claimed ${p}`)}catch(e){for(const e of Object.values(u))e();throw a.log(`Failed to claim ${p}`,e,l),e}s&&"failures"in h&&s.push(...Object.keys(h.failures));const m=h.one_time_keys||{},g=[];for(const[t,i]of Object.entries(n)){const n=m[t]||{};for(let s=0;s<i.length;s++){const o=i[s],l=o.deviceId,h=o.getIdentityKey();if(h===e.deviceCurve25519Key)continue;if(c[t][l].sessionId&&!r)continue;const p=n[l]||{};let m=null;for(const e in p)0===e.indexOf("signed_curve25519:")&&(m=p[e]);m?g.push(d(e,m,t,o).then((e=>{u[h]&&u[h](e),c[t][l].sessionId=e}),(e=>{throw u[h]&&u[h](),e}))):(a.warn(`No one-time keys (alg=signed_curve25519) for device ${t}:${l}`),u[h]&&u[h]())}}return p=`Olm sessions for ${g.length} devices`,a.debug(`Starting ${p}`),await Promise.all(g),a.debug(`Started ${p}`),c},t.getExistingOlmSessions=async function(e,t,n){const r={},i={},s=[];for(const[t,o]of Object.entries(n))for(const n of o){const o=n.deviceId,a=n.getIdentityKey();s.push((async()=>{const s=await e.getSessionIdForDevice(a,!0);null===s?(r[t]=r[t]||[],r[t].push(n)):(i[t]=i[t]||{},i[t][o]={device:n,sessionId:s})})())}return await Promise.all(s),[r,i]},t.pkSign=function(e,t,r,i){let o=!1;if(t instanceof Uint8Array){const e=new n.g.Olm.PkSigning;i=e.init_with_seed(t),t=e,o=!0}const a=e.signatures||{};delete e.signatures;const l=e.unsigned;e.unsigned&&delete e.unsigned;try{const n=a[r]||{};return a[r]=n,n["ed25519:"+i]=t.sign(s.default.stringify(e))}finally{e.signatures=a,l&&(e.unsigned=l),o&&t.free()}},t.pkVerify=function(e,t,r){const i="ed25519:"+t;if(!(e.signatures&&e.signatures[r]&&e.signatures[r][i]))throw new Error("No signature");const o=e.signatures[r][i],a=new n.g.Olm.Utility,l=e.signatures;delete e.signatures;const c=e.unsigned;e.unsigned&&delete e.unsigned;try{a.ed25519_verify(t,s.default.stringify(e),o)}finally{e.signatures=l,c&&(e.unsigned=c),a.free()}},t.verifySignature=u;var i,s=r(n(9141)),o=n(7434);!function(e){e.Olm="m.olm.v1.curve25519-aes-sha2",e.Megolm="m.megolm.v1.aes-sha2",e.MegolmBackup="m.megolm_backup.v1.curve25519-aes-sha2"}(i||(i={}));const a=i.Olm;t.OLM_ALGORITHM=a;const l=i.Megolm;t.MEGOLM_ALGORITHM=l;const c=i.MegolmBackup;async function d(e,t,n,r){const i=r.deviceId;try{await u(e,t,n,i,r.getFingerprint())}catch(e){return o.logger.error("Unable to verify signature on one-time key for device "+n+":"+i+":",e),null}let s;try{s=await e.createOutboundSession(r.getIdentityKey(),t.key)}catch(e){return o.logger.error("Error starting olm session with device "+n+":"+i+": "+e),null}return o.logger.log("Started new olm sessionid "+s+" for device "+n+":"+i),s}async function u(e,t,n,r,i){const o="ed25519:"+r,a=((t.signatures||{})[n]||{})[o];if(!a)throw Error("No signature");const l=Object.assign({},t);"unsigned"in l&&delete l.unsigned,delete l.signatures;const c=s.default.stringify(l);e.verifySignature(i,c,a)}function h(e){return Buffer.from(e).toString("base64")}t.MEGOLM_BACKUP_ALGORITHM=c},4077:(e,t,n)=>{"use strict";var r=n(5318);Object.defineProperty(t,"__esModule",{value:!0}),t.decodeRecoveryKey=function(e){const t=i.default.decode(e.replace(/ /g,""));let r=0;for(const e of t)r^=e;if(0!==r)throw new Error("Incorrect parity");for(let e=0;e<s.length;++e)if(t[e]!==s[e])throw new Error("Incorrect prefix");if(t.length!==s.length+n.g.Olm.PRIVATE_KEY_LENGTH+1)throw new Error("Incorrect length");return Uint8Array.from(t.slice(s.length,s.length+n.g.Olm.PRIVATE_KEY_LENGTH))},t.encodeRecoveryKey=function(e){const t=new Buffer(s.length+e.length+1);t.set(s,0),t.set(e,s.length);let n=0;for(let e=0;e<t.length-1;++e)n^=t[e];return t[t.length-1]=n,i.default.encode(t).match(/.{1,4}/g).join(" ")};var i=r(n(7191));const s=[139,1]},5251:(e,t,n)=>{"use strict";var r=n(5318);Object.defineProperty(t,"__esModule",{value:!0}),t.VERSION=t.Backend=void 0,t.upgradeDatabase=function(e,t){s.logger.log(`Upgrading IndexedDBCryptoStore from version ${t} to 10`),t<1&&function(e){const t=e.createObjectStore("outgoingRoomKeyRequests",{keyPath:"requestId"});t.createIndex("session",["requestBody.room_id","requestBody.session_id"]),t.createIndex("state","state")}(e),t<2&&e.createObjectStore("account"),t<3&&e.createObjectStore("sessions",{keyPath:["deviceKey","sessionId"]}).createIndex("deviceKey","deviceKey"),t<4&&e.createObjectStore("inbound_group_sessions",{keyPath:["senderCurve25519Key","sessionId"]}),t<5&&e.createObjectStore("device_data"),t<6&&e.createObjectStore("rooms"),t<7&&e.createObjectStore("sessions_needing_backup",{keyPath:["senderCurve25519Key","sessionId"]}),t<8&&e.createObjectStore("inbound_group_sessions_withheld",{keyPath:["senderCurve25519Key","sessionId"]}),t<9&&(e.createObjectStore("session_problems",{keyPath:["deviceKey","time"]}).createIndex("deviceKey","deviceKey"),e.createObjectStore("notified_error_devices",{keyPath:["userId","deviceId"]})),t<10&&e.createObjectStore("shared_history_inbound_group_sessions",{keyPath:["roomId"]})};var i=r(n(9713)),s=n(7434),o=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var n=a(t);if(n&&n.has(e))return n.get(e);var r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var s in e)if("default"!==s&&Object.prototype.hasOwnProperty.call(e,s)){var o=i?Object.getOwnPropertyDescriptor(e,s):null;o&&(o.get||o.set)?Object.defineProperty(r,s,o):r[s]=e[s]}return r.default=e,n&&n.set(e,r),r}(n(3102));function a(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(a=function(e){return e?n:t})(e)}function l(e,t){e._mx_abortexception=t;try{e.abort()}catch(t){}}function c(e){return new Promise(((t,n)=>{e.oncomplete=()=>{void 0!==e._mx_abortexception&&n(e._mx_abortexception),t(null)},e.onerror=t=>{void 0!==e._mx_abortexception?n(e._mx_abortexception):(s.logger.log("Error performing indexeddb txn",t),n(e.error))},e.onabort=t=>{void 0!==e._mx_abortexception?n(e._mx_abortexception):(s.logger.log("Error performing indexeddb txn",t),n(e.error))}}))}t.VERSION=10,t.Backend=class{constructor(e){this.db=e,(0,i.default)(this,"nextTxnId",0),e.onversionchange=()=>{s.logger.log(`versionchange for indexeddb ${this.db.name}: closing`),e.close()}}async startup(){return this}async deleteAllData(){throw Error("This is not implemented, call IDBFactory::deleteDatabase(dbName) instead.")}getOrAddOutgoingRoomKeyRequest(e){const t=e.requestBody;return new Promise(((n,r)=>{const i=this.db.transaction("outgoingRoomKeyRequests","readwrite");i.onerror=r,this._getOutgoingRoomKeyRequest(i,t,(r=>{if(r)return s.logger.log(`already have key request outstanding for ${t.room_id} / ${t.session_id}: not sending another`),void n(r);s.logger.log(`enqueueing key request for ${t.room_id} / `+t.session_id),i.oncomplete=()=>{n(e)},i.objectStore("outgoingRoomKeyRequests").add(e)}))}))}getOutgoingRoomKeyRequest(e){return new Promise(((t,n)=>{const r=this.db.transaction("outgoingRoomKeyRequests","readonly");r.onerror=n,this._getOutgoingRoomKeyRequest(r,e,(e=>{t(e)}))}))}_getOutgoingRoomKeyRequest(e,t,n){const r=e.objectStore("outgoingRoomKeyRequests").index("session").openCursor([t.room_id,t.session_id]);r.onsuccess=()=>{const e=r.result;if(!e)return void n(null);const i=e.value;o.deepCompare(i.requestBody,t)?n(i):e.continue()}}getOutgoingRoomKeyRequestByState(e){if(0===e.length)return Promise.resolve(null);let t,n=0;const r=this.db.transaction("outgoingRoomKeyRequests","readonly"),i=r.objectStore("outgoingRoomKeyRequests"),s=e[n];return i.index("state").openCursor(s).onsuccess=function r(){const i=this.result;if(i)return void(t=i.value);if(n++,n>=e.length)return;const s=e[n];this.source.openCursor(s).onsuccess=r},c(r).then((()=>t))}getAllOutgoingRoomKeyRequestsByState(e){return new Promise(((t,n)=>{const r=this.db.transaction("outgoingRoomKeyRequests","readonly").objectStore("outgoingRoomKeyRequests").index("state").getAll(e);r.onsuccess=()=>t(r.result),r.onerror=()=>n(r.error)}))}getOutgoingRoomKeyRequestsByTarget(e,t,n){let r=0;const i=[],s=this.db.transaction("outgoingRoomKeyRequests","readonly"),o=s.objectStore("outgoingRoomKeyRequests"),a=n[r];return o.index("state").openCursor(a).onsuccess=function s(){const o=this.result;if(o){const n=o.value;n.recipients.includes({userId:e,deviceId:t})&&i.push(n),o.continue()}else{if(r++,r>=n.length)return;const e=n[r];this.source.openCursor(e).onsuccess=s}},c(s).then((()=>i))}updateOutgoingRoomKeyRequest(e,t,n){let r=null;const i=this.db.transaction("outgoingRoomKeyRequests","readwrite");return i.objectStore("outgoingRoomKeyRequests").openCursor(e).onsuccess=function(){const e=this.result;if(!e)return;const i=e.value;i.state==t?(Object.assign(i,n),e.update(i),r=i):s.logger.warn(`Cannot update room key request from ${t} as it was already updated to ${i.state}`)},c(i).then((()=>r))}deleteOutgoingRoomKeyRequest(e,t){const n=this.db.transaction("outgoingRoomKeyRequests","readwrite"),r=n.objectStore("outgoingRoomKeyRequests").openCursor(e);return r.onsuccess=()=>{const e=r.result;if(!e)return;const n=e.value;n.state==t?e.delete():s.logger.warn(`Cannot delete room key request in state ${n.state} (expected ${t})`)},c(n)}getAccount(e,t){const n=e.objectStore("account").get("-");n.onsuccess=function(){try{t(n.result||null)}catch(t){l(e,t)}}}storeAccount(e,t){e.objectStore("account").put(t,"-")}getCrossSigningKeys(e,t){const n=e.objectStore("account").get("crossSigningKeys");n.onsuccess=function(){try{t(n.result||null)}catch(t){l(e,t)}}}getSecretStorePrivateKey(e,t,n){const r=e.objectStore("account").get(`ssss_cache:${n}`);r.onsuccess=function(){try{t(r.result||null)}catch(t){l(e,t)}}}storeCrossSigningKeys(e,t){e.objectStore("account").put(t,"crossSigningKeys")}storeSecretStorePrivateKey(e,t,n){e.objectStore("account").put(n,`ssss_cache:${t}`)}countEndToEndSessions(e,t){const n=e.objectStore("sessions").count();n.onsuccess=function(){try{t(n.result)}catch(t){l(e,t)}}}getEndToEndSessions(e,t,n){const r=t.objectStore("sessions").index("deviceKey").openCursor(e),i={};r.onsuccess=function(){const e=r.result;if(e)i[e.value.sessionId]={session:e.value.session,lastReceivedMessageTs:e.value.lastReceivedMessageTs},e.continue();else try{n(i)}catch(e){l(t,e)}}}getEndToEndSession(e,t,n,r){const i=n.objectStore("sessions").get([e,t]);i.onsuccess=function(){try{i.result?r({session:i.result.session,lastReceivedMessageTs:i.result.lastReceivedMessageTs}):r(null)}catch(e){l(n,e)}}}getAllEndToEndSessions(e,t){const n=e.objectStore("sessions").openCursor();n.onsuccess=function(){try{const e=n.result;e?(t(e.value),e.continue()):t(null)}catch(t){l(e,t)}}}storeEndToEndSession(e,t,n,r){r.objectStore("sessions").put({deviceKey:e,sessionId:t,session:n.session,lastReceivedMessageTs:n.lastReceivedMessageTs})}async storeEndToEndSessionProblem(e,t,n){const r=this.db.transaction("session_problems","readwrite");return r.objectStore("session_problems").put({deviceKey:e,type:t,fixed:n,time:Date.now()}),c(r)}async getEndToEndSessionProblem(e,t){let n;const r=this.db.transaction("session_problems","readwrite"),i=r.objectStore("session_problems").index("deviceKey").getAll(e);return i.onsuccess=()=>{const e=i.result;if(!e.length)return void(n=null);e.sort(((e,t)=>e.time-t.time));const r=e[e.length-1];for(const i of e)if(i.time>t)return void(n=Object.assign({},i,{fixed:r.fixed}));n=r.fixed?null:r},await c(r),n}async filterOutNotifiedErrorDevices(e){const t=this.db.transaction("notified_error_devices","readwrite").objectStore("notified_error_devices"),n=[];return await Promise.all(e.map((e=>new Promise((r=>{const{userId:i,deviceInfo:s}=e,o=t.get([i,s.deviceId]);o.onsuccess=function(){o.result||(t.put({userId:i,deviceId:s.deviceId}),n.push(e)),r()}}))))),n}getEndToEndInboundGroupSession(e,t,n,r){let i=!1,s=!1;const o=n.objectStore("inbound_group_sessions").get([e,t]);o.onsuccess=function(){try{i=o.result?o.result.session:null,!1!==s&&r(i,s)}catch(e){l(n,e)}};const a=n.objectStore("inbound_group_sessions_withheld").get([e,t]);a.onsuccess=function(){try{s=a.result?a.result.session:null,!1!==i&&r(i,s)}catch(e){l(n,e)}}}getAllEndToEndInboundGroupSessions(e,t){const n=e.objectStore("inbound_group_sessions").openCursor();n.onsuccess=function(){const r=n.result;if(r){try{t({senderKey:r.value.senderCurve25519Key,sessionId:r.value.sessionId,sessionData:r.value.session})}catch(t){l(e,t)}r.continue()}else try{t(null)}catch(t){l(e,t)}}}addEndToEndInboundGroupSession(e,t,n,r){const i=r.objectStore("inbound_group_sessions").add({senderCurve25519Key:e,sessionId:t,session:n});i.onerror=n=>{"ConstraintError"===i.error.name?(n.stopPropagation(),n.preventDefault(),s.logger.log("Ignoring duplicate inbound group session: "+e+" / "+t)):l(r,new Error("Failed to add inbound group session: "+i.error))}}storeEndToEndInboundGroupSession(e,t,n,r){r.objectStore("inbound_group_sessions").put({senderCurve25519Key:e,sessionId:t,session:n})}storeEndToEndInboundGroupSessionWithheld(e,t,n,r){r.objectStore("inbound_group_sessions_withheld").put({senderCurve25519Key:e,sessionId:t,session:n})}getEndToEndDeviceData(e,t){const n=e.objectStore("device_data").get("-");n.onsuccess=function(){try{t(n.result||null)}catch(t){l(e,t)}}}storeEndToEndDeviceData(e,t){t.objectStore("device_data").put(e,"-")}storeEndToEndRoom(e,t,n){n.objectStore("rooms").put(t,e)}getEndToEndRooms(e,t){const n={},r=e.objectStore("rooms").openCursor();r.onsuccess=function(){const i=r.result;if(i)n[i.key]=i.value,i.continue();else try{t(n)}catch(t){l(e,t)}}}getSessionsNeedingBackup(e){return new Promise(((t,n)=>{const r=[],i=this.db.transaction(["sessions_needing_backup","inbound_group_sessions"],"readonly");i.onerror=n,i.oncomplete=function(){t(r)};const s=i.objectStore("sessions_needing_backup"),o=i.objectStore("inbound_group_sessions"),a=s.openCursor();a.onsuccess=function(){const t=a.result;if(t){const n=o.get(t.key);n.onsuccess=function(){r.push({senderKey:n.result.senderCurve25519Key,sessionId:n.result.sessionId,sessionData:n.result.session})},(!e||r.length<e)&&t.continue()}}}))}countSessionsNeedingBackup(e){e||(e=this.db.transaction("sessions_needing_backup","readonly"));const t=e.objectStore("sessions_needing_backup");return new Promise(((e,n)=>{const r=t.count();r.onerror=n,r.onsuccess=()=>e(r.result)}))}async unmarkSessionsNeedingBackup(e,t){t||(t=this.db.transaction("sessions_needing_backup","readwrite"));const n=t.objectStore("sessions_needing_backup");await Promise.all(e.map((e=>new Promise(((t,r)=>{const i=n.delete([e.senderKey,e.sessionId]);i.onsuccess=t,i.onerror=r})))))}async markSessionsNeedingBackup(e,t){t||(t=this.db.transaction("sessions_needing_backup","readwrite"));const n=t.objectStore("sessions_needing_backup");await Promise.all(e.map((e=>new Promise(((t,r)=>{const i=n.put({senderCurve25519Key:e.senderKey,sessionId:e.sessionId});i.onsuccess=t,i.onerror=r})))))}addSharedHistoryInboundGroupSession(e,t,n,r){r||(r=this.db.transaction("shared_history_inbound_group_sessions","readwrite"));const i=r.objectStore("shared_history_inbound_group_sessions"),s=i.get([e]);s.onsuccess=()=>{const{sessions:r}=s.result||{sessions:[]};r.push([t,n]),i.put({roomId:e,sessions:r})}}getSharedHistoryInboundGroupSessions(e,t){t||(t=this.db.transaction("shared_history_inbound_group_sessions","readonly"));const n=t.objectStore("shared_history_inbound_group_sessions").get([e]);return new Promise(((e,t)=>{n.onsuccess=()=>{const{sessions:t}=n.result||{sessions:[]};e(t)},n.onerror=t}))}doTxn(e,t,n,r=s.logger){const i=this.db.transaction(t,e),o=c(i),a=n(i);return o.then((()=>a))}}},7585:(e,t,n)=>{"use strict";var r=n(5318);Object.defineProperty(t,"__esModule",{value:!0}),t.IndexedDBCryptoStore=void 0;var i=r(n(9713)),s=n(7434),o=n(4250),a=n(1045),l=h(n(5251)),c=n(9489),d=h(n(3415));function u(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(u=function(e){return e?n:t})(e)}function h(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var n=u(t);if(n&&n.has(e))return n.get(e);var r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var s in e)if("default"!==s&&Object.prototype.hasOwnProperty.call(e,s)){var o=i?Object.getOwnPropertyDescriptor(e,s):null;o&&(o.get||o.set)?Object.defineProperty(r,s,o):r[s]=e[s]}return r.default=e,n&&n.set(e,r),r}class p{static exists(e,t){return d.exists(e,t)}constructor(e,t){this.indexedDB=e,this.dbName=t,(0,i.default)(this,"backendPromise",null),(0,i.default)(this,"backend",null)}startup(){return this.backendPromise||(this.backendPromise=new Promise(((e,t)=>{if(!this.indexedDB)return void t(new Error("no indexeddb support available"));s.logger.log(`connecting to indexeddb ${this.dbName}`);const n=this.indexedDB.open(this.dbName,l.VERSION);n.onupgradeneeded=e=>{const t=n.result,r=e.oldVersion;l.upgradeDatabase(t,r)},n.onblocked=()=>{s.logger.log("can't yet open IndexedDBCryptoStore because it is open elsewhere")},n.onerror=e=>{s.logger.log("Error connecting to indexeddb",e),t(n.error)},n.onsuccess=()=>{const t=n.result;s.logger.log(`connected to indexeddb ${this.dbName}`),e(new l.Backend(t))}})).then((e=>e.doTxn("readonly",[p.STORE_INBOUND_GROUP_SESSIONS,p.STORE_INBOUND_GROUP_SESSIONS_WITHHELD],(t=>{e.getEndToEndInboundGroupSession("","",t,(()=>{}))})).then((()=>e)))).catch((e=>{if("VersionError"===e.name)throw s.logger.warn("Crypto DB is too new for us to use!",e),new c.InvalidCryptoStoreError(c.InvalidCryptoStoreError.TOO_NEW);s.logger.warn(`unable to connect to indexeddb ${this.dbName}: falling back to localStorage store: ${e}`);try{return new o.LocalStorageCryptoStore(n.g.localStorage)}catch(e){return s.logger.warn(`unable to open localStorage: falling back to in-memory store: ${e}`),new a.MemoryCryptoStore}})).then((e=>(this.backend=e,e)))),this.backendPromise}deleteAllData(){return new Promise(((e,t)=>{if(!this.indexedDB)return void t(new Error("no indexeddb support available"));s.logger.log(`Removing indexeddb instance: ${this.dbName}`);const n=this.indexedDB.deleteDatabase(this.dbName);n.onblocked=()=>{s.logger.log("can't yet delete IndexedDBCryptoStore because it is open elsewhere")},n.onerror=e=>{s.logger.log("Error deleting data from indexeddb",e),t(n.error)},n.onsuccess=()=>{s.logger.log(`Removed indexeddb instance: ${this.dbName}`),e()}})).catch((e=>{s.logger.warn(`unable to delete IndexedDBCryptoStore: ${e}`)}))}getOrAddOutgoingRoomKeyRequest(e){return this.backend.getOrAddOutgoingRoomKeyRequest(e)}getOutgoingRoomKeyRequest(e){return this.backend.getOutgoingRoomKeyRequest(e)}getOutgoingRoomKeyRequestByState(e){return this.backend.getOutgoingRoomKeyRequestByState(e)}getAllOutgoingRoomKeyRequestsByState(e){return this.backend.getAllOutgoingRoomKeyRequestsByState(e)}getOutgoingRoomKeyRequestsByTarget(e,t,n){return this.backend.getOutgoingRoomKeyRequestsByTarget(e,t,n)}updateOutgoingRoomKeyRequest(e,t,n){return this.backend.updateOutgoingRoomKeyRequest(e,t,n)}deleteOutgoingRoomKeyRequest(e,t){return this.backend.deleteOutgoingRoomKeyRequest(e,t)}getAccount(e,t){this.backend.getAccount(e,t)}storeAccount(e,t){this.backend.storeAccount(e,t)}getCrossSigningKeys(e,t){this.backend.getCrossSigningKeys(e,t)}getSecretStorePrivateKey(e,t,n){this.backend.getSecretStorePrivateKey(e,t,n)}storeCrossSigningKeys(e,t){this.backend.storeCrossSigningKeys(e,t)}storeSecretStorePrivateKey(e,t,n){this.backend.storeSecretStorePrivateKey(e,t,n)}countEndToEndSessions(e,t){this.backend.countEndToEndSessions(e,t)}getEndToEndSession(e,t,n,r){this.backend.getEndToEndSession(e,t,n,r)}getEndToEndSessions(e,t,n){this.backend.getEndToEndSessions(e,t,n)}getAllEndToEndSessions(e,t){this.backend.getAllEndToEndSessions(e,t)}storeEndToEndSession(e,t,n,r){this.backend.storeEndToEndSession(e,t,n,r)}storeEndToEndSessionProblem(e,t,n){return this.backend.storeEndToEndSessionProblem(e,t,n)}getEndToEndSessionProblem(e,t){return this.backend.getEndToEndSessionProblem(e,t)}filterOutNotifiedErrorDevices(e){return this.backend.filterOutNotifiedErrorDevices(e)}getEndToEndInboundGroupSession(e,t,n,r){this.backend.getEndToEndInboundGroupSession(e,t,n,r)}getAllEndToEndInboundGroupSessions(e,t){this.backend.getAllEndToEndInboundGroupSessions(e,t)}addEndToEndInboundGroupSession(e,t,n,r){this.backend.addEndToEndInboundGroupSession(e,t,n,r)}storeEndToEndInboundGroupSession(e,t,n,r){this.backend.storeEndToEndInboundGroupSession(e,t,n,r)}storeEndToEndInboundGroupSessionWithheld(e,t,n,r){this.backend.storeEndToEndInboundGroupSessionWithheld(e,t,n,r)}storeEndToEndDeviceData(e,t){this.backend.storeEndToEndDeviceData(e,t)}getEndToEndDeviceData(e,t){this.backend.getEndToEndDeviceData(e,t)}storeEndToEndRoom(e,t,n){this.backend.storeEndToEndRoom(e,t,n)}getEndToEndRooms(e,t){this.backend.getEndToEndRooms(e,t)}getSessionsNeedingBackup(e){return this.backend.getSessionsNeedingBackup(e)}countSessionsNeedingBackup(e){return this.backend.countSessionsNeedingBackup(e)}unmarkSessionsNeedingBackup(e,t){return this.backend.unmarkSessionsNeedingBackup(e,t)}markSessionsNeedingBackup(e,t){return this.backend.markSessionsNeedingBackup(e,t)}addSharedHistoryInboundGroupSession(e,t,n,r){this.backend.addSharedHistoryInboundGroupSession(e,t,n,r)}getSharedHistoryInboundGroupSessions(e,t){return this.backend.getSharedHistoryInboundGroupSessions(e,t)}doTxn(e,t,n,r){return this.backend.doTxn(e,t,n,r)}}t.IndexedDBCryptoStore=p,(0,i.default)(p,"STORE_ACCOUNT","account"),(0,i.default)(p,"STORE_SESSIONS","sessions"),(0,i.default)(p,"STORE_INBOUND_GROUP_SESSIONS","inbound_group_sessions"),(0,i.default)(p,"STORE_INBOUND_GROUP_SESSIONS_WITHHELD","inbound_group_sessions_withheld"),(0,i.default)(p,"STORE_SHARED_HISTORY_INBOUND_GROUP_SESSIONS","shared_history_inbound_group_sessions"),(0,i.default)(p,"STORE_DEVICE_DATA","device_data"),(0,i.default)(p,"STORE_ROOMS","rooms"),(0,i.default)(p,"STORE_BACKUP","sessions_needing_backup")},4250:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LocalStorageCryptoStore=void 0;var r=n(7434),i=n(1045);const s="crypto.account",o="crypto.cross_signing_keys",a="crypto.notified_error_devices",l="crypto.device_data",c="crypto.inboundgroupsessions/",d="crypto.sessionsneedingbackup";function u(e){return"crypto.sessions/"+e}function h(e){return"crypto.session.problems/"+e}function p(e,t){return c+e+"/"+t}function m(e,t){return"crypto.inboundgroupsessions.withheld/"+e+"/"+t}function g(e){return"crypto.rooms/"+e}class f extends i.MemoryCryptoStore{static exists(e){const t=e.length;for(let n=0;n<t;n++)if(e.key(n).startsWith("crypto."))return!0;return!1}constructor(e){super(),this.store=e}countEndToEndSessions(e,t){let n=0;for(let e=0;e<this.store.length;++e)this.store.key(e).startsWith(u(""))&&++n;t(n)}_getEndToEndSessions(e){const t=y(this.store,u(e)),n={};for(const[e,r]of Object.entries(t||{}))n[e]="string"==typeof r?{session:r}:r;return n}getEndToEndSession(e,t,n,r){r(this._getEndToEndSessions(e)[t]||{})}getEndToEndSessions(e,t,n){n(this._getEndToEndSessions(e)||{})}getAllEndToEndSessions(e,t){for(let e=0;e<this.store.length;++e)if(this.store.key(e).startsWith(u(""))){const n=this.store.key(e).split("/")[1];for(const e of Object.values(this._getEndToEndSessions(n)))t(e)}}storeEndToEndSession(e,t,n,r){const i=this._getEndToEndSessions(e)||{};i[t]=n,v(this.store,u(e),i)}async storeEndToEndSessionProblem(e,t,n){const r=h(e),i=y(this.store,r)||[];i.push({type:t,fixed:n,time:Date.now()}),i.sort(((e,t)=>e.time-t.time)),v(this.store,r,i)}async getEndToEndSessionProblem(e,t){const n=h(e),r=y(this.store,n)||[];if(!r.length)return null;const i=r[r.length-1];for(const e of r)if(e.time>t)return Object.assign({},e,{fixed:i.fixed});return i.fixed?null:i}async filterOutNotifiedErrorDevices(e){const t=y(this.store,a)||{},n=[];for(const r of e){const{userId:e,deviceInfo:i}=r;e in t?i.deviceId in t[e]||(n.push(r),t[e][i.deviceId]=!0):(n.push(r),t[e]={[i.deviceId]:!0})}return v(this.store,a,t),n}getEndToEndInboundGroupSession(e,t,n,r){r(y(this.store,p(e,t)),y(this.store,m(e,t)))}getAllEndToEndInboundGroupSessions(e,t){for(let e=0;e<this.store.length;++e){const n=this.store.key(e);n.startsWith(c)&&t({senderKey:n.substr(c.length,43),sessionId:n.substr(c.length+44),sessionData:y(this.store,n)})}t(null)}addEndToEndInboundGroupSession(e,t,n,r){y(this.store,p(e,t))||this.storeEndToEndInboundGroupSession(e,t,n,r)}storeEndToEndInboundGroupSession(e,t,n,r){v(this.store,p(e,t),n)}storeEndToEndInboundGroupSessionWithheld(e,t,n,r){v(this.store,m(e,t),n)}getEndToEndDeviceData(e,t){t(y(this.store,l))}storeEndToEndDeviceData(e,t){v(this.store,l,e)}storeEndToEndRoom(e,t,n){v(this.store,g(e),t)}getEndToEndRooms(e,t){const n={},r=g("");for(let e=0;e<this.store.length;++e){const t=this.store.key(e);t.startsWith(r)&&(n[t.substr(r.length)]=y(this.store,t))}t(n)}getSessionsNeedingBackup(e){const t=y(this.store,d)||{},n=[];for(const r in t)if(Object.prototype.hasOwnProperty.call(t,r)){const t=r.substr(0,43),i=r.substr(44);if(this.getEndToEndInboundGroupSession(t,i,null,(e=>{n.push({senderKey:t,sessionId:i,sessionData:e})})),e&&r.length>=e)break}return Promise.resolve(n)}countSessionsNeedingBackup(){const e=y(this.store,d)||{};return Promise.resolve(Object.keys(e).length)}unmarkSessionsNeedingBackup(e){const t=y(this.store,d)||{};for(const n of e)delete t[n.senderKey+"/"+n.sessionId];return v(this.store,d,t),Promise.resolve()}markSessionsNeedingBackup(e){const t=y(this.store,d)||{};for(const n of e)t[n.senderKey+"/"+n.sessionId]=!0;return v(this.store,d,t),Promise.resolve()}deleteAllData(){return this.store.removeItem(s),Promise.resolve()}getAccount(e,t){t(y(this.store,s))}storeAccount(e,t){v(this.store,s,t)}getCrossSigningKeys(e,t){t(y(this.store,o))}getSecretStorePrivateKey(e,t,n){t(y(this.store,`crypto.ssss_cache.${n}`))}storeCrossSigningKeys(e,t){v(this.store,o,t)}storeSecretStorePrivateKey(e,t,n){v(this.store,`crypto.ssss_cache.${t}`,n)}doTxn(e,t,n){return Promise.resolve(n(null))}}function y(e,t){try{return JSON.parse(e.getItem(t))}catch(e){r.logger.log("Error: Failed to get key %s: %s",t,e.stack||e),r.logger.log(e.stack)}return null}function v(e,t,n){e.setItem(t,JSON.stringify(n))}t.LocalStorageCryptoStore=f},1045:(e,t,n)=>{"use strict";var r=n(5318);Object.defineProperty(t,"__esModule",{value:!0}),t.MemoryCryptoStore=void 0;var i=r(n(9713)),s=n(7434),o=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var n=a(t);if(n&&n.has(e))return n.get(e);var r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var s in e)if("default"!==s&&Object.prototype.hasOwnProperty.call(e,s)){var o=i?Object.getOwnPropertyDescriptor(e,s):null;o&&(o.get||o.set)?Object.defineProperty(r,s,o):r[s]=e[s]}return r.default=e,n&&n.set(e,r),r}(n(3102));function a(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(a=function(e){return e?n:t})(e)}function l(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function c(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?l(Object(n),!0).forEach((function(t){(0,i.default)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):l(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}t.MemoryCryptoStore=class{constructor(){(0,i.default)(this,"outgoingRoomKeyRequests",[]),(0,i.default)(this,"account",null),(0,i.default)(this,"crossSigningKeys",null),(0,i.default)(this,"privateKeys",{}),(0,i.default)(this,"sessions",{}),(0,i.default)(this,"sessionProblems",{}),(0,i.default)(this,"notifiedErrorDevices",{}),(0,i.default)(this,"inboundGroupSessions",{}),(0,i.default)(this,"inboundGroupSessionsWithheld",{}),(0,i.default)(this,"deviceData",null),(0,i.default)(this,"rooms",{}),(0,i.default)(this,"sessionsNeedingBackup",{}),(0,i.default)(this,"sharedHistoryInboundGroupSessions",{})}async startup(){return this}deleteAllData(){return Promise.resolve()}getOrAddOutgoingRoomKeyRequest(e){const t=e.requestBody;return o.promiseTry((()=>{const n=this._getOutgoingRoomKeyRequest(t);return n?(s.logger.log(`already have key request outstanding for ${t.room_id} / ${t.session_id}: not sending another`),n):(s.logger.log(`enqueueing key request for ${t.room_id} / `+t.session_id),this.outgoingRoomKeyRequests.push(e),e)}))}getOutgoingRoomKeyRequest(e){return Promise.resolve(this._getOutgoingRoomKeyRequest(e))}_getOutgoingRoomKeyRequest(e){for(const t of this.outgoingRoomKeyRequests)if(o.deepCompare(t.requestBody,e))return t;return null}getOutgoingRoomKeyRequestByState(e){for(const t of this.outgoingRoomKeyRequests)for(const n of e)if(t.state===n)return Promise.resolve(t);return Promise.resolve(null)}getAllOutgoingRoomKeyRequestsByState(e){return Promise.resolve(this.outgoingRoomKeyRequests.filter((t=>t.state==e)))}getOutgoingRoomKeyRequestsByTarget(e,t,n){const r=[];for(const i of this.outgoingRoomKeyRequests)for(const s of n)i.state===s&&i.recipients.includes({userId:e,deviceId:t})&&r.push(i);return Promise.resolve(r)}updateOutgoingRoomKeyRequest(e,t,n){for(const r of this.outgoingRoomKeyRequests)if(r.requestId===e)return r.state!==t?(s.logger.warn(`Cannot update room key request from ${t} as it was already updated to ${r.state}`),Promise.resolve(null)):(Object.assign(r,n),Promise.resolve(r));return Promise.resolve(null)}deleteOutgoingRoomKeyRequest(e,t){for(let n=0;n<this.outgoingRoomKeyRequests.length;n++){const r=this.outgoingRoomKeyRequests[n];if(r.requestId===e)return r.state!=t?(s.logger.warn(`Cannot delete room key request in state ${r.state} (expected ${t})`),Promise.resolve(null)):(this.outgoingRoomKeyRequests.splice(n,1),Promise.resolve(r))}return Promise.resolve(null)}getAccount(e,t){t(this.account)}storeAccount(e,t){this.account=t}getCrossSigningKeys(e,t){t(this.crossSigningKeys)}getSecretStorePrivateKey(e,t,n){t(this.privateKeys[n]||null)}storeCrossSigningKeys(e,t){this.crossSigningKeys=t}storeSecretStorePrivateKey(e,t,n){this.privateKeys[t]=n}countEndToEndSessions(e,t){t(Object.keys(this.sessions).length)}getEndToEndSession(e,t,n,r){r((this.sessions[e]||{})[t]||null)}getEndToEndSessions(e,t,n){n(this.sessions[e]||{})}getAllEndToEndSessions(e,t){Object.entries(this.sessions).forEach((([e,n])=>{Object.entries(n).forEach((([n,r])=>{t(c(c({},r),{},{deviceKey:e,sessionId:n}))}))}))}storeEndToEndSession(e,t,n,r){let i=this.sessions[e];void 0===i&&(i={},this.sessions[e]=i),i[t]=n}async storeEndToEndSessionProblem(e,t,n){const r=this.sessionProblems[e]=this.sessionProblems[e]||[];r.push({type:t,fixed:n,time:Date.now()}),r.sort(((e,t)=>e.time-t.time))}async getEndToEndSessionProblem(e,t){const n=this.sessionProblems[e]||[];if(!n.length)return null;const r=n[n.length-1];for(const e of n)if(e.time>t)return Object.assign({},e,{fixed:r.fixed});return r.fixed?null:r}async filterOutNotifiedErrorDevices(e){const t=this.notifiedErrorDevices,n=[];for(const r of e){const{userId:e,deviceInfo:i}=r;e in t?i.deviceId in t[e]||(n.push(r),t[e][i.deviceId]=!0):(n.push(r),t[e]={[i.deviceId]:!0})}return n}getEndToEndInboundGroupSession(e,t,n,r){const i=e+"/"+t;r(this.inboundGroupSessions[i]||null,this.inboundGroupSessionsWithheld[i]||null)}getAllEndToEndInboundGroupSessions(e,t){for(const e of Object.keys(this.inboundGroupSessions))t({senderKey:e.substr(0,43),sessionId:e.substr(44),sessionData:this.inboundGroupSessions[e]});t(null)}addEndToEndInboundGroupSession(e,t,n,r){const i=e+"/"+t;void 0===this.inboundGroupSessions[i]&&(this.inboundGroupSessions[i]=n)}storeEndToEndInboundGroupSession(e,t,n,r){this.inboundGroupSessions[e+"/"+t]=n}storeEndToEndInboundGroupSessionWithheld(e,t,n,r){const i=e+"/"+t;this.inboundGroupSessionsWithheld[i]=n}getEndToEndDeviceData(e,t){t(this.deviceData)}storeEndToEndDeviceData(e,t){this.deviceData=e}storeEndToEndRoom(e,t,n){this.rooms[e]=t}getEndToEndRooms(e,t){t(this.rooms)}getSessionsNeedingBackup(e){const t=[];for(const n in this.sessionsNeedingBackup)if(this.inboundGroupSessions[n]&&(t.push({senderKey:n.substr(0,43),sessionId:n.substr(44),sessionData:this.inboundGroupSessions[n]}),e&&n.length>=e))break;return Promise.resolve(t)}countSessionsNeedingBackup(){return Promise.resolve(Object.keys(this.sessionsNeedingBackup).length)}unmarkSessionsNeedingBackup(e){for(const t of e){const e=t.senderKey+"/"+t.sessionId;delete this.sessionsNeedingBackup[e]}return Promise.resolve()}markSessionsNeedingBackup(e){for(const t of e){const e=t.senderKey+"/"+t.sessionId;this.sessionsNeedingBackup[e]=!0}return Promise.resolve()}addSharedHistoryInboundGroupSession(e,t,n){const r=this.sharedHistoryInboundGroupSessions[e]||[];r.push([t,n]),this.sharedHistoryInboundGroupSessions[e]=r}getSharedHistoryInboundGroupSessions(e){return Promise.resolve(this.sharedHistoryInboundGroupSessions[e]||[])}doTxn(e,t,n){return Promise.resolve(n(null))}}},1631:(e,t,n)=>{"use strict";var r=n(5318);Object.defineProperty(t,"__esModule",{value:!0}),t.VerificationBase=t.SwitchStartEventError=void 0;var i=r(n(9713)),s=n(7187),o=n(4369),a=n(7434),l=n(3272),c=n(6702),d=n(3075);const u=new Error("Verification timed out");class h extends Error{constructor(e){super(),this.startEvent=e}}t.SwitchStartEventError=h;class p extends s.EventEmitter{constructor(e,t,n,r,s,o){super(),this.channel=e,this.baseApis=t,this.userId=n,this.deviceId=r,this.startEvent=s,this.request=o,(0,i.default)(this,"cancelled",!1),(0,i.default)(this,"_done",!1),(0,i.default)(this,"promise",null),(0,i.default)(this,"transactionTimeoutTimer",null),(0,i.default)(this,"expectedEvent",void 0),(0,i.default)(this,"resolve",void 0),(0,i.default)(this,"reject",void 0),(0,i.default)(this,"resolveEvent",void 0),(0,i.default)(this,"rejectEvent",void 0),(0,i.default)(this,"started",void 0),(0,i.default)(this,"doVerification",void 0)}get initiatedByMe(){if(!this.startEvent)return!0;const e=this.startEvent.getSender(),t=this.startEvent.getContent();return e===this.baseApis.getUserId()&&t.from_device===this.baseApis.getDeviceId()}get hasBeenCancelled(){return this.cancelled}resetTimer(){a.logger.info("Refreshing/starting the verification transaction timeout timer"),null!==this.transactionTimeoutTimer&&clearTimeout(this.transactionTimeoutTimer),this.transactionTimeoutTimer=setTimeout((()=>{this._done||this.cancelled||(a.logger.info("Triggering verification timeout"),this.cancel(u))}),6e5)}endTimer(){null!==this.transactionTimeoutTimer&&(clearTimeout(this.transactionTimeoutTimer),this.transactionTimeoutTimer=null)}send(e,t){return this.channel.send(e,t)}waitForEvent(e){if(this._done)return Promise.reject(new Error("Verification is already done"));const t=this.request.getEventFromOtherParty(e);return t?Promise.resolve(t):(this.expectedEvent=e,new Promise(((e,t)=>{this.resolveEvent=e,this.rejectEvent=t})))}canSwitchStartEvent(e){return!1}switchStartEvent(e){if(this.canSwitchStartEvent(e))if(a.logger.log("Verification Base: switching verification start event",{restartingFlow:!!this.rejectEvent}),this.rejectEvent){const t=this.rejectEvent;this.rejectEvent=void 0,t(new h(e))}else this.startEvent=e}handleEvent(e){if(!this._done)if(e.getType()===this.expectedEvent)"m.key.verification.done"!==this.expectedEvent&&(this.expectedEvent=void 0,this.rejectEvent=void 0,this.resetTimer(),this.resolveEvent(e));else if("m.key.verification.cancel"===e.getType()){const t=this.reject;if(this.reject=void 0,t){const n=e.getContent(),{reason:r,code:i}=n;t(new Error(`Other side cancelled verification because ${r} (${i})`))}}else if(this.expectedEvent){const t=new Error("Unexpected message: expecting "+this.expectedEvent+" but got "+e.getType());if(this.expectedEvent=void 0,this.rejectEvent){const e=this.rejectEvent;this.rejectEvent=void 0,e(t)}this.cancel(t)}}done(){if(this.endTimer(),!this._done)return this.request.onVerifierFinished(),this.resolve(),(0,d.requestKeysDuringVerification)(this.baseApis,this.userId,this.deviceId)}cancel(e){if(this.endTimer(),!this._done){if(this.cancelled=!0,this.request.onVerifierCancelled(),this.userId&&this.deviceId)if(e===u){const e=(0,c.newTimeoutError)();this.send(e.getType(),e.getContent())}else if(e instanceof o.MatrixEvent){if(e.getSender()!==this.userId){const t=e.getContent();"m.key.verification.cancel"===e.getType()?(t.code=t.code||"m.unknown",t.reason=t.reason||t.body||"Unknown reason",this.send("m.key.verification.cancel",t)):this.send("m.key.verification.cancel",{code:"m.unknown",reason:t.body||"Unknown reason"})}}else this.send("m.key.verification.cancel",{code:"m.unknown",reason:e.toString()});null!==this.promise?this.reject&&this.reject(e):this.promise=Promise.reject(e),this.emit("cancel",e)}}verify(){return this.promise||(this.promise=new Promise(((e,t)=>{this.resolve=(...t)=>{this._done=!0,this.endTimer(),e(...t)},this.reject=e=>{this._done=!0,this.endTimer(),t(e)}})),this.doVerification&&!this.started&&(this.started=!0,this.resetTimer(),Promise.resolve(this.doVerification()).then(this.done.bind(this),this.cancel.bind(this)))),this.promise}async verifyKeys(e,t,n){const r=[];for(const[i,s]of Object.entries(t)){const t=i.split(":",2)[1],o=this.baseApis.getStoredDevice(e,t);if(o)n(i,o,s),r.push(t);else{const o=this.baseApis.crypto.deviceList.getStoredCrossSigningForUser(e);o&&o.getId()===t?(n(i,l.DeviceInfo.fromStorage({keys:{[i]:t}},t),s),r.push(t)):a.logger.warn(`verification: Could not find device ${t} to verify`)}}if(!r.length)throw new Error("No devices could be verified");a.logger.info("Verification completed! Marking devices verified: ",r);for(const t of r)await this.baseApis.setDeviceVerified(e,t)}get events(){}}t.VerificationBase=p},6702:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.errorFactory=s,t.errorFromEvent=function(e){const t=e.getContent();if(t){const{code:e,reason:n}=t;return{code:e,reason:n}}return{code:"Unknown error",reason:"m.unknown"}},t.newUserMismatchError=t.newUserCancelledError=t.newUnknownTransactionError=t.newUnknownMethodError=t.newUnexpectedMessageError=t.newTimeoutError=t.newKeyMismatchError=t.newInvalidMessageError=void 0,t.newVerificationError=i;var r=n(4369);function i(e,t,n){const i=Object.assign({},{code:e,reason:t},n);return new r.MatrixEvent({type:"m.key.verification.cancel",content:i})}function s(e,t){return function(n){return i(e,t,n)}}const o=s("m.user","Cancelled by user");t.newUserCancelledError=o;const a=s("m.timeout","Timed out");t.newTimeoutError=a;const l=s("m.unknown_transaction","Unknown transaction");t.newUnknownTransactionError=l;const c=s("m.unknown_method","Unknown method");t.newUnknownMethodError=c;const d=s("m.unexpected_message","Unexpected message");t.newUnexpectedMessageError=d;const u=s("m.key_mismatch","Key mismatch");t.newKeyMismatchError=u;const h=s("m.user_error","User mismatch");t.newUserMismatchError=h;const p=s("m.invalid_message","Invalid message");t.newInvalidMessageError=p},4028:(e,t,n)=>{"use strict";var r=n(5318);Object.defineProperty(t,"__esModule",{value:!0}),t.IllegalMethod=void 0;var i=r(n(9713)),s=n(1631);class o extends s.VerificationBase{constructor(...e){super(...e),(0,i.default)(this,"doVerification",(async()=>{throw new Error("Verification is not possible with this method")}))}static factory(e,t,n,r,i,s){return new o(e,t,n,r,i,s)}static get NAME(){return"org.matrix.illegal_method"}}t.IllegalMethod=o},1696:(e,t,n)=>{"use strict";var r=n(5318);Object.defineProperty(t,"__esModule",{value:!0}),t.SHOW_QR_CODE_METHOD=t.SCAN_QR_CODE_METHOD=t.ReciprocateQRCode=t.QRCodeData=void 0;var i,s=r(n(9713)),o=n(1631),a=n(6702),l=n(2772),c=n(7434);t.SHOW_QR_CODE_METHOD="m.qr_code.show.v1",t.SCAN_QR_CODE_METHOD="m.qr_code.scan.v1";class d extends o.VerificationBase{constructor(...e){super(...e),(0,s.default)(this,"reciprocateQREvent",void 0),(0,s.default)(this,"doVerification",(async()=>{if(!this.startEvent)throw new Error("It is not currently possible to start verificationwith this method yet.");const{qrCodeData:e}=this.request;if(this.startEvent.getContent().secret!==e.encodedSharedSecret)throw(0,a.newKeyMismatchError)();await new Promise(((e,t)=>{this.reciprocateQREvent={confirm:e,cancel:()=>t((0,a.newUserCancelledError)())},this.emit("show_reciprocate_qr",this.reciprocateQREvent)}));const t={};switch(e.mode){case i.VerifyOtherUser:{const n=e.otherUserMasterKey;t[`ed25519:${n}`]=n;break}case i.VerifySelfTrusted:{const n=this.request.targetDevice.deviceId;t[`ed25519:${n}`]=e.otherDeviceKey;break}case i.VerifySelfUntrusted:{const n=e.myMasterKey;t[`ed25519:${n}`]=n;break}}await this.verifyKeys(this.userId,t,((e,n,r)=>{const i=t[e];if(!i)throw(0,a.newKeyMismatchError)();if(r!==i)throw c.logger.error("key ID from key info does not match"),(0,a.newKeyMismatchError)();for(const e in n.keys){if(!e.startsWith("ed25519"))continue;const r=t[e];if(!r)throw(0,a.newKeyMismatchError)();if(n.keys[e]!==r)throw c.logger.error("master key does not match"),(0,a.newKeyMismatchError)()}}))}))}static factory(e,t,n,r,i,s){return new d(e,t,n,r,i,s)}static get NAME(){return"m.reciprocate.v1"}}t.ReciprocateQRCode=d,function(e){e[e.VerifyOtherUser=0]="VerifyOtherUser",e[e.VerifySelfTrusted=1]="VerifySelfTrusted",e[e.VerifySelfUntrusted=2]="VerifySelfUntrusted"}(i||(i={}));class u{constructor(e,t,n,r,i,s){this.mode=e,this.sharedSecret=t,this.otherUserMasterKey=n,this.otherDeviceKey=r,this.myMasterKey=i,this.buffer=s}static async create(e,t){const n=u.generateSharedSecret(),r=u.determineMode(e,t);let s=null,o=null,a=null;if(r===i.VerifyOtherUser)s=t.getStoredCrossSigningForUser(e.otherUserId).getId("master");else if(r===i.VerifySelfTrusted)o=await u.getOtherDeviceKey(e,t);else if(r===i.VerifySelfUntrusted){const e=t.getUserId();a=t.getStoredCrossSigningForUser(e).getId("master")}const l=u.generateQrData(e,t,r,n,s,o,a),c=u.generateBuffer(l);return new u(r,n,s,o,a,c)}get encodedSharedSecret(){return this.sharedSecret}getBuffer(){return this.buffer}static generateSharedSecret(){const e=new Uint8Array(11);return n.g.crypto.getRandomValues(e),(0,l.encodeUnpaddedBase64)(e)}static async getOtherDeviceKey(e,t){const n=t.getUserId(),r=e.targetDevice,i=r?r.deviceId:null,s=t.getStoredDevice(n,i);if(!s)throw new Error("could not find device "+i);return s.getFingerprint()}static determineMode(e,t){const n=t.getUserId(),r=e.otherUserId;let s=i.VerifyOtherUser;return n===r&&(s=t.checkUserTrust(n).isCrossSigningVerified()?i.VerifySelfTrusted:i.VerifySelfUntrusted),s}static generateQrData(e,t,n,r,s,o,a){const l=t.getUserId(),c={prefix:"MATRIX",version:2,mode:n,transactionId:e.channel.transactionId,firstKeyB64:"",secondKeyB64:"",secretB64:r},d=t.getStoredCrossSigningForUser(l);return n===i.VerifyOtherUser?(c.firstKeyB64=d.getId("master"),c.secondKeyB64=s):n===i.VerifySelfTrusted?(c.firstKeyB64=d.getId("master"),c.secondKeyB64=o):n===i.VerifySelfUntrusted&&(c.firstKeyB64=t.getDeviceEd25519Key(),c.secondKeyB64=a),c}static generateBuffer(e){let t=Buffer.alloc(0);const n=e=>{const n=Buffer.from([e]);t=Buffer.concat([t,n])},r=(e,n,r=!0)=>{const i=Buffer.from(e,n);r&&(e=>{const n=Buffer.alloc(2);n.writeInt16BE(e,0),t=Buffer.concat([t,n])})(i.byteLength),t=Buffer.concat([t,i])},i=e=>{const n=(0,l.decodeBase64)(e),r=Buffer.from(n);t=Buffer.concat([t,r])};return r(e.prefix,"ascii",!1),n(e.version),n(e.mode),r(e.transactionId,"utf-8"),i(e.firstKeyB64),i(e.secondKeyB64),i(e.secretB64),t}}t.QRCodeData=u},6381:(e,t,n)=>{"use strict";var r=n(5318);Object.defineProperty(t,"__esModule",{value:!0}),t.SAS=void 0;var i=r(n(9713)),s=r(n(9141)),o=n(1631),a=n(6702),l=n(7434);const c="m.key.verification.start",d=["m.key.verification.accept","m.key.verification.key","m.key.verification.mac"];let u;const h=(0,a.errorFactory)("m.mismatched_sas","Mismatched short authentication string"),p=(0,a.errorFactory)("m.mismatched_commitment","Mismatched commitment"),m=[["","dog"],["","cat"],["","lion"],["","horse"],["","unicorn"],["","pig"],["","elephant"],["","rabbit"],["","panda"],["","rooster"],["","penguin"],["","turtle"],["","fish"],["","octopus"],["","butterfly"],["","flower"],["","tree"],["","cactus"],["","mushroom"],["","globe"],["","moon"],["","cloud"],["","fire"],["","banana"],["","apple"],["","strawberry"],["","corn"],["","pizza"],["","cake"],["","heart"],["","smiley"],["","robot"],["","hat"],["","glasses"],["","spanner"],["","santa"],["","thumbs up"],["","umbrella"],["","hourglass"],["","clock"],["","gift"],["","light bulb"],["","book"],["","pencil"],["","paperclip"],["","scissors"],["","lock"],["","key"],["","hammer"],["","telephone"],["","flag"],["","train"],["","bicycle"],["","aeroplane"],["","rocket"],["","trophy"],["","ball"],["","guitar"],["","trumpet"],["","bell"],["","anchor"],["","headphones"],["","folder"],["","pin"]],g={decimal:function(e){return[1e3+(e[0]<<5|e[1]>>3),1e3+((7&e[1])<<10|e[2]<<2|e[3]>>6),1e3+((63&e[3])<<7|e[4]>>1)]},emoji:function(e){return[e[0]>>2,(3&e[0])<<4|e[1]>>4,(15&e[1])<<2|e[2]>>6,63&e[2],e[3]>>2,(3&e[3])<<4|e[4]>>4,(15&e[4])<<2|e[5]>>6].map((e=>m[e]))}};function f(e,t){const n={};for(const r of t)r in g&&(n[r]=g[r](e));return n}const y={"hkdf-hmac-sha256":"calculate_mac","hmac-sha256":"calculate_mac_long_kdf"};function v(e,t){return function(...n){const r=e[y[t]].apply(e,n);return l.logger.log("SAS calculateMAC:",t,n,r),r}}const b={"curve25519-hkdf-sha256":function(e,t,n){const r=`${e.baseApis.getUserId()}|${e.baseApis.deviceId}|${e.ourSASPubKey}|`,i=`${e.userId}|${e.deviceId}|${e.theirSASPubKey}|`,s="MATRIX_KEY_VERIFICATION_SAS|"+(e.initiatedByMe?r+i:i+r)+e.channel.transactionId;return t.generate_bytes(s,n)},curve25519:function(e,t,n){const r=`${e.baseApis.getUserId()}${e.baseApis.deviceId}`,i=`${e.userId}${e.deviceId}`,s="MATRIX_KEY_VERIFICATION_SAS"+(e.initiatedByMe?r+i:i+r)+e.channel.transactionId;return t.generate_bytes(s,n)}},w=["curve25519-hkdf-sha256","curve25519"],S=["sha256"],_=["hkdf-hmac-sha256","hmac-sha256"],k=Object.keys(g),x=new Set(w),E=new Set(S),T=new Set(_),C=new Set(k);function A(e,t){return e instanceof Array?e.filter((e=>t.has(e))):[]}class I extends o.VerificationBase{constructor(...e){super(...e),(0,i.default)(this,"waitingForAccept",void 0),(0,i.default)(this,"ourSASPubKey",void 0),(0,i.default)(this,"theirSASPubKey",void 0),(0,i.default)(this,"sasEvent",void 0),(0,i.default)(this,"doVerification",(async()=>{await n.g.Olm.init(),u=u||new n.g.Olm.Utility,await this.baseApis.downloadKeys([this.userId]);let e=!1;do{try{return this.initiatedByMe?await this.doSendVerification():await this.doRespondVerification()}catch(t){if(!(t instanceof o.SwitchStartEventError))throw t;this.startEvent=t.startEvent,e=!0}}while(e)}))}static get NAME(){return"m.sas.v1"}get events(){return d}canSwitchStartEvent(e){if(e.getType()!==c)return!1;const t=e.getContent();return t&&t.method===I.NAME&&this.waitingForAccept}async sendStart(){const e=this.channel.completeContent(c,{method:I.NAME,from_device:this.baseApis.deviceId,key_agreement_protocols:w,hashes:S,message_authentication_codes:_,short_authentication_string:k});return await this.channel.sendCompleted(c,e),e}async doSendVerification(){let e,t;if(this.waitingForAccept=!0,e=this.startEvent?this.channel.completedContentFromEvent(this.startEvent):await this.sendStart(),!this.initiatedByMe)throw new o.SwitchStartEventError(this.startEvent);try{t=await this.waitForEvent("m.key.verification.accept")}finally{this.waitingForAccept=!1}let r=t.getContent();const i=A(r.short_authentication_string,C);if(!(x.has(r.key_agreement_protocol)&&E.has(r.hash)&&T.has(r.message_authentication_code)&&i.length))throw(0,a.newUnknownMethodError)();if("string"!=typeof r.commitment)throw(0,a.newInvalidMessageError)();const l=r.key_agreement_protocol,c=r.message_authentication_code,d=r.commitment,m=new n.g.Olm.SAS;try{this.ourSASPubKey=m.get_pubkey(),await this.send("m.key.verification.key",{key:this.ourSASPubKey}),t=await this.waitForEvent("m.key.verification.key"),r=t.getContent();const n=r.key+s.default.stringify(e);if(u.sha256(n)!==d)throw p();this.theirSASPubKey=r.key,m.set_their_key(r.key);const o=b[l](this,m,6),g=new Promise(((e,t)=>{this.sasEvent={sas:f(o,i),confirm:async()=>{try{await this.sendMAC(m,c),e()}catch(e){t(e)}},cancel:()=>t((0,a.newUserCancelledError)()),mismatch:()=>t(h())},this.emit("show_sas",this.sasEvent)}));[t]=await Promise.all([this.waitForEvent("m.key.verification.mac").then((e=>(this.expectedEvent="m.key.verification.done",e))),g]),r=t.getContent(),await this.checkMAC(m,r,c)}finally{m.free()}}async doRespondVerification(){let e=this.channel.completedContentFromEvent(this.startEvent);const t=A(w,new Set(e.key_agreement_protocols))[0],r=A(S,new Set(e.hashes))[0],i=A(_,new Set(e.message_authentication_codes))[0],o=A(e.short_authentication_string,C);if(void 0===t||void 0===r||void 0===i||!o.length)throw(0,a.newUnknownMethodError)();const l=new n.g.Olm.SAS;try{const n=l.get_pubkey()+s.default.stringify(e);await this.send("m.key.verification.accept",{key_agreement_protocol:t,hash:r,message_authentication_code:i,short_authentication_string:o,commitment:u.sha256(n)});let c=await this.waitForEvent("m.key.verification.key");e=c.getContent(),this.theirSASPubKey=e.key,l.set_their_key(e.key),this.ourSASPubKey=l.get_pubkey(),await this.send("m.key.verification.key",{key:this.ourSASPubKey});const d=b[t](this,l,6),p=new Promise(((e,t)=>{this.sasEvent={sas:f(d,o),confirm:async()=>{try{await this.sendMAC(l,i),e()}catch(e){t(e)}},cancel:()=>t((0,a.newUserCancelledError)()),mismatch:()=>t(h())},this.emit("show_sas",this.sasEvent)}));[c]=await Promise.all([this.waitForEvent("m.key.verification.mac").then((e=>(this.expectedEvent="m.key.verification.done",e))),p]),e=c.getContent(),await this.checkMAC(l,e,i)}finally{l.free()}}sendMAC(e,t){const n={},r=[],i="MATRIX_KEY_VERIFICATION_MAC"+this.baseApis.getUserId()+this.baseApis.deviceId+this.userId+this.deviceId+this.channel.transactionId,s=`ed25519:${this.baseApis.deviceId}`;n[s]=v(e,t)(this.baseApis.getDeviceEd25519Key(),i+s),r.push(s);const o=this.baseApis.getCrossSigningId();if(o){const s=`ed25519:${o}`;n[s]=v(e,t)(o,i+s),r.push(s)}const a=v(e,t)(r.sort().join(","),i+"KEY_IDS");return this.send("m.key.verification.mac",{mac:n,keys:a})}async checkMAC(e,t,n){const r="MATRIX_KEY_VERIFICATION_MAC"+this.userId+this.deviceId+this.baseApis.getUserId()+this.baseApis.deviceId+this.channel.transactionId;if(t.keys!==v(e,n)(Object.keys(t.mac).sort().join(","),r+"KEY_IDS"))throw(0,a.newKeyMismatchError)();await this.verifyKeys(this.userId,t.mac,((t,i,s)=>{if(s!==v(e,n)(i.keys[t],r+t))throw(0,a.newKeyMismatchError)()}))}}t.SAS=I},2842:(e,t,n)=>{"use strict";var r=n(5318);Object.defineProperty(t,"__esModule",{value:!0}),t.InRoomRequests=t.InRoomChannel=void 0;var i=r(n(9713)),s=n(5279),o=n(7434);const a=n(2481).EventType.RoomMessage,l="m.reference",c="m.relates_to";class d{constructor(e,t,n=null){this.client=e,this.roomId=t,this.userId=n,(0,i.default)(this,"requestEventId",null)}get receiveStartFromOtherDevices(){return!0}get transactionId(){return this.requestEventId}static getOtherPartyUserId(e,t){if(d.getEventType(e)!==s.REQUEST_TYPE)return;const n=t.getUserId(),r=e.getSender(),i=e.getContent().to;return r===n?i:i===n?r:void 0}getTimestamp(e){return e.getTs()}static canCreateRequest(e){return e===s.REQUEST_TYPE}canCreateRequest(e){return d.canCreateRequest(e)}static getTransactionId(e){if(d.getEventType(e)===s.REQUEST_TYPE)return e.getId();{const t=e.getRelation();if(t&&t.rel_type===l)return t.event_id}}static validateEvent(e,t){const n=d.getTransactionId(e);if("string"!=typeof n||0===n.length)return!1;const r=d.getEventType(e),i=e.getContent();if(r===s.REQUEST_TYPE){if(!i||"string"!=typeof i.to||!i.to.length)return o.logger.log("InRoomChannel: validateEvent: no valid to "+(i&&i.to)),!1;if(!d.getOtherPartyUserId(e,t))return o.logger.log(`InRoomChannel: validateEvent: not directed to or sent by me: ${e.getSender()}, ${i&&i.to}`),!1}return s.VerificationRequest.validateEvent(r,e,t)}static getEventType(e){const t=e.getType();if(t===a){const t=e.getContent();if(t){const{msgtype:e}=t;if(e===s.REQUEST_TYPE)return s.REQUEST_TYPE}}return t&&t!==s.REQUEST_TYPE?t:""}async handleEvent(e,t,n=!1){if(t.hasEventId(e.getId()))return;const r=d.getEventType(e);if(e.getRoomId()!==this.roomId)return;if(null===this.userId){const t=d.getOtherPartyUserId(e,this.client);t&&(this.userId=t)}const i=this.client.getUserId(),s=e.getSender();if(null!==this.userId&&s!==i&&s!==this.userId)return void o.logger.log(`InRoomChannel: ignoring verification event from non-participating sender ${s}`);null===this.requestEventId&&(this.requestEventId=d.getTransactionId(e));const a=!!e.getUnsigned().transaction_id,l=e.getSender()===this.client.getUserId();return await t.handleEvent(r,e,n,a,l)}completedContentFromEvent(e){const t=Object.assign({},e.getContent());return t[c]=e.getRelation(),t}completeContent(e,t){return t=Object.assign({},t),e!==s.REQUEST_TYPE&&e!==s.READY_TYPE&&e!==s.START_TYPE||(t.from_device=this.client.getDeviceId()),e===s.REQUEST_TYPE?t={body:this.client.getUserId()+" is requesting to verify your key, but your client does not support in-chat key verification.  You will need to use legacy key verification to verify keys.",msgtype:s.REQUEST_TYPE,to:this.userId,from_device:t.from_device,methods:t.methods}:t[c]={rel_type:l,event_id:this.transactionId},t}send(e,t){const n=this.completeContent(e,t);return this.sendCompleted(e,n)}async sendCompleted(e,t){let n=e;e===s.REQUEST_TYPE&&(n=a);const r=await this.client.sendEvent(this.roomId,n,t);e===s.REQUEST_TYPE&&(this.requestEventId=r.event_id)}}t.InRoomChannel=d,t.InRoomRequests=class{constructor(){(0,i.default)(this,"requestsByRoomId",new Map)}getRequest(e){const t=e.getRoomId(),n=d.getTransactionId(e);return this.getRequestByTxnId(t,n)}getRequestByChannel(e){return this.getRequestByTxnId(e.roomId,e.transactionId)}getRequestByTxnId(e,t){const n=this.requestsByRoomId.get(e);if(n)return n.get(t)}setRequest(e,t){this.doSetRequest(e.getRoomId(),d.getTransactionId(e),t)}setRequestByChannel(e,t){this.doSetRequest(e.roomId,e.transactionId,t)}doSetRequest(e,t,n){let r=this.requestsByRoomId.get(e);r||(r=new Map,this.requestsByRoomId.set(e,r)),r.set(t,n)}removeRequest(e){const t=e.getRoomId(),n=this.requestsByRoomId.get(t);n&&(n.delete(d.getTransactionId(e)),0===n.size&&this.requestsByRoomId.delete(t))}findRequestInProgress(e){const t=this.requestsByRoomId.get(e);if(t)for(const e of t.values())if(e.pending)return e}}},9588:(e,t,n)=>{"use strict";var r=n(5318);Object.defineProperty(t,"__esModule",{value:!0}),t.ToDeviceRequests=t.ToDeviceChannel=void 0;var i=r(n(9713)),s=n(8401),o=n(7434),a=n(5279),l=n(6702),c=n(4369);class d{constructor(e,t,n,r=null,s=null){this.client=e,this.userId=t,this.devices=n,this.transactionId=r,this.deviceId=s,(0,i.default)(this,"request",void 0)}isToDevices(e){if(e.length===this.devices.length){for(const t of e)if(!this.devices.includes(t))return!1;return!0}return!1}static getEventType(e){return e.getType()}static getTransactionId(e){const t=e.getContent();return t&&t.transaction_id}static canCreateRequest(e){return e===a.REQUEST_TYPE||e===a.START_TYPE}canCreateRequest(e){return d.canCreateRequest(e)}static validateEvent(e,t){if(e.isCancelled())return o.logger.warn("Ignoring flagged verification request from "+e.getSender()),!1;const n=e.getContent();if(!n)return o.logger.warn("ToDeviceChannel.validateEvent: invalid: no content"),!1;if(!n.transaction_id)return o.logger.warn("ToDeviceChannel.validateEvent: invalid: no transaction_id"),!1;const r=e.getType();if(r===a.REQUEST_TYPE){if(!Number.isFinite(n.timestamp))return o.logger.warn("ToDeviceChannel.validateEvent: invalid: no timestamp"),!1;if(e.getSender()===t.getUserId()&&n.from_device==t.getDeviceId())return o.logger.warn("ToDeviceChannel.validateEvent: invalid: from own device"),!1}return a.VerificationRequest.validateEvent(r,e,t)}getTimestamp(e){const t=e.getContent();return t&&t.timestamp}async handleEvent(e,t,n=!1){const r=e.getType(),i=e.getContent();if(r===a.REQUEST_TYPE||r===a.READY_TYPE||r===a.START_TYPE){this.transactionId||(this.transactionId=i.transaction_id);const e=i.from_device;if(!this.deviceId&&this.devices.includes(e)&&(this.deviceId=e),!this.deviceId||this.deviceId!==e){const t=this.completeContent(a.CANCEL_TYPE,(0,l.errorFromEvent)((0,l.newUnexpectedMessageError)()));return this.sendToDevices(a.CANCEL_TYPE,t,[e])}}const s=t.phase===a.PHASE_STARTED||t.phase===a.PHASE_READY;await t.handleEvent(e.getType(),e,n,!1,!1);const o=t.phase===a.PHASE_STARTED||t.phase===a.PHASE_READY;if((r===a.START_TYPE||r===a.READY_TYPE)&&!s&&o&&this.deviceId){const e=this.devices.filter((e=>e!==this.deviceId&&e!==this.client.getDeviceId()));if(e.length){const t=this.completeContent(a.CANCEL_TYPE,{code:"m.accepted",reason:"Verification request accepted by another device"});await this.sendToDevices(a.CANCEL_TYPE,t,e)}}}completedContentFromEvent(e){return e.getContent()}completeContent(e,t){return t=Object.assign({},t),this.transactionId&&(t.transaction_id=this.transactionId),e!==a.REQUEST_TYPE&&e!==a.READY_TYPE&&e!==a.START_TYPE||(t.from_device=this.client.getDeviceId()),e===a.REQUEST_TYPE&&(t.timestamp=Date.now()),t}send(e,t={}){e!==a.REQUEST_TYPE&&e!==a.START_TYPE||this.transactionId||(this.transactionId=d.makeTransactionId());const n=this.completeContent(e,t);return this.sendCompleted(e,n)}async sendCompleted(e,t){let n;n=e===a.REQUEST_TYPE||e===a.CANCEL_TYPE&&!this.deviceId?await this.sendToDevices(e,t,this.devices):await this.sendToDevices(e,t,[this.deviceId]);const r=new c.MatrixEvent({sender:this.client.getUserId(),content:t,type:e});return await this.request.handleEvent(e,r,!0,!0,!0),n}async sendToDevices(e,t,n){if(n.length){const r={};for(const e of n)r[e]=t;await this.client.sendToDevice(e,{[this.userId]:r})}}static makeTransactionId(){return(0,s.randomString)(32)}}t.ToDeviceChannel=d,t.ToDeviceRequests=class{constructor(){(0,i.default)(this,"requestsByUserId",new Map)}getRequest(e){return this.getRequestBySenderAndTxnId(e.getSender(),d.getTransactionId(e))}getRequestByChannel(e){return this.getRequestBySenderAndTxnId(e.userId,e.transactionId)}getRequestBySenderAndTxnId(e,t){const n=this.requestsByUserId.get(e);if(n)return n.get(t)}setRequest(e,t){this.setRequestBySenderAndTxnId(e.getSender(),d.getTransactionId(e),t)}setRequestByChannel(e,t){this.setRequestBySenderAndTxnId(e.userId,e.transactionId,t)}setRequestBySenderAndTxnId(e,t,n){let r=this.requestsByUserId.get(e);r||(r=new Map,this.requestsByUserId.set(e,r)),r.set(t,n)}removeRequest(e){const t=e.getSender(),n=this.requestsByUserId.get(t);n&&(n.delete(d.getTransactionId(e)),0===n.size&&this.requestsByUserId.delete(t))}findRequestInProgress(e,t){const n=this.requestsByUserId.get(e);if(n)for(const e of n.values())if(e.pending&&e.channel.isToDevices(t))return e}getRequestsInProgress(e){const t=this.requestsByUserId.get(e);return t?Array.from(t.values()).filter((e=>e.pending)):[]}}},5279:(e,t,n)=>{"use strict";var r=n(5318);Object.defineProperty(t,"__esModule",{value:!0}),t.VerificationRequest=t.START_TYPE=t.REQUEST_TYPE=t.READY_TYPE=t.Phase=t.PHASE_UNSENT=t.PHASE_STARTED=t.PHASE_REQUESTED=t.PHASE_READY=t.PHASE_DONE=t.PHASE_CANCELLED=t.EVENT_PREFIX=t.DONE_TYPE=t.CANCEL_TYPE=void 0;var i=r(n(9713)),s=n(7187),o=n(7434),a=n(6702),l=n(1696);const c="m.key.verification.";t.EVENT_PREFIX=c;const d=c+"request";t.REQUEST_TYPE=d;const u=c+"start";t.START_TYPE=u;const h=c+"cancel";t.CANCEL_TYPE=h;const p=c+"done";t.DONE_TYPE=p;const m=c+"ready";let g;t.READY_TYPE=m,t.Phase=g,function(e){e[e.Unsent=1]="Unsent",e[e.Requested=2]="Requested",e[e.Ready=3]="Ready",e[e.Started=4]="Started",e[e.Cancelled=5]="Cancelled",e[e.Done=6]="Done"}(g||(t.Phase=g={}));const f=g.Unsent;t.PHASE_UNSENT=f;const y=g.Requested;t.PHASE_REQUESTED=y;const v=g.Ready;t.PHASE_READY=v;const b=g.Started;t.PHASE_STARTED=b;const w=g.Cancelled;t.PHASE_CANCELLED=w;const S=g.Done;t.PHASE_DONE=S;class _ extends s.EventEmitter{constructor(e,t,n){super(),this.channel=e,this.verificationMethods=t,this.client=n,(0,i.default)(this,"eventsByUs",new Map),(0,i.default)(this,"eventsByThem",new Map),(0,i.default)(this,"_observeOnly",!1),(0,i.default)(this,"timeoutTimer",null),(0,i.default)(this,"_accepting",!1),(0,i.default)(this,"_declining",!1),(0,i.default)(this,"verifierHasFinished",!1),(0,i.default)(this,"_cancelled",!1),(0,i.default)(this,"_chosenMethod",null),(0,i.default)(this,"_qrCodeData",null),(0,i.default)(this,"requestReceivedAt",null),(0,i.default)(this,"commonMethods",[]),(0,i.default)(this,"_phase",void 0),(0,i.default)(this,"_cancellingUserId",void 0),(0,i.default)(this,"_verifier",void 0),(0,i.default)(this,"cancelOnTimeout",(()=>{try{this.initiatedByMe?this.cancel({reason:"Other party didn't accept in time",code:"m.timeout"}):this.cancel({reason:"User didn't accept in time",code:"m.timeout"})}catch(e){o.logger.error("Error while cancelling verification request",e)}})),this.channel.request=this,this.setPhase(f,!1)}static validateEvent(e,t,n){const r=t.getContent();return!(!e||!e.startsWith(c))&&(r?e!==d&&e!==m||Array.isArray(r.methods)?e!==d&&e!==m&&e!==u||"string"==typeof r.from_device&&0!==r.from_device.length||(o.logger.log("VerificationRequest: validateEvent: fail because from_device"),!1):(o.logger.log("VerificationRequest: validateEvent: fail because methods"),!1):(o.logger.log("VerificationRequest: validateEvent: no content"),!1))}get invalid(){return this.phase===f}get requested(){return this.phase===y}get cancelled(){return this.phase===w}get ready(){return this.phase===v}get started(){return this.phase===b}get done(){return this.phase===S}get methods(){return this.commonMethods}get chosenMethod(){return this._chosenMethod}calculateEventTimeout(e){let t=this.channel.getTimestamp(e)+6e5;if(this.requestReceivedAt&&!this.initiatedByMe&&this.phase<=y){const e=this.requestReceivedAt+12e4;t=Math.min(t,e)}return Math.max(0,t-Date.now())}get timeout(){const e=this.getEventByEither(d);return e?this.calculateEventTimeout(e):0}get requestEvent(){return this.getEventByEither(d)}get phase(){return this._phase}get verifier(){return this._verifier}get canAccept(){return this.phase<v&&!this._accepting&&!this._declining}get accepting(){return this._accepting}get declining(){return this._declining}get pending(){return!this.observeOnly&&this._phase!==S&&this._phase!==w}get qrCodeData(){return this._qrCodeData}otherPartySupportsMethod(e,t=!1){if(!t&&!this.ready&&!this.started)return!1;const n=this.eventsByThem.get(d)||this.eventsByThem.get(m);if(!n){if(this.started&&this.initiatedByMe){const t=this.eventsByUs.get(u),n=t&&t.getContent();return e==(n&&n.method)}return!1}const r=n.getContent();if(!r)return!1;const{methods:i}=r;return!!Array.isArray(i)&&i.includes(e)}get initiatedByMe(){const e=this.eventsByUs.size+this.eventsByThem.size===0;if(this._phase===f&&e)return!0;const t=this.eventsByUs.has(d),n=this.eventsByThem.has(d);if(t&&!n)return!0;if(!t&&n)return!1;const r=this.eventsByUs.has(u),i=this.eventsByThem.has(u);return!(!r||i)}get requestingUserId(){return this.initiatedByMe?this.client.getUserId():this.otherUserId}get receivingUserId(){return this.initiatedByMe?this.otherUserId:this.client.getUserId()}get otherUserId(){return this.channel.userId}get isSelfVerification(){return this.client.getUserId()===this.otherUserId}get cancellingUserId(){const e=this.eventsByUs.get(h),t=this.eventsByThem.get(h);return e&&(!t||e.getId()<t.getId())?e.getSender():t?t.getSender():void 0}get cancellationCode(){const e=this.getEventByEither(h);return e?e.getContent().code:null}get observeOnly(){return this._observeOnly}get targetDevice(){const e=(this.eventsByThem.get(d)||this.eventsByThem.get(m)||this.eventsByThem.get(u)).getContent().from_device;return{userId:this.otherUserId,deviceId:e}}beginKeyVerification(e,t=null){if(!this.observeOnly&&!this._verifier&&(this.phase===y||this.phase===v||this.phase===f&&this.channel.canCreateRequest(u))){if(this.commonMethods.length&&!this.commonMethods.includes(e))throw(0,a.newUnknownMethodError)();if(this._verifier=this.createVerifier(e,null,t),!this._verifier)throw(0,a.newUnknownMethodError)();this._chosenMethod=e}return this._verifier}async sendRequest(){if(!this.observeOnly&&this._phase===f){const e=[...this.verificationMethods.keys()];await this.channel.send(d,{methods:e})}}async cancel({reason:e="User declined",code:t="m.user"}={}){if(!this.observeOnly&&this._phase!==w){if(this._declining=!0,this.emit("change"),this._verifier)return this._verifier.cancel((0,a.errorFactory)(t,e)());this._cancellingUserId=this.client.getUserId(),await this.channel.send(h,{code:t,reason:e})}}async accept(){if(!this.observeOnly&&this.phase===y&&!this.initiatedByMe){const e=[...this.verificationMethods.keys()];this._accepting=!0,this.emit("change"),await this.channel.send(m,{methods:e})}}waitFor(e){return new Promise(((t,n)=>{const r=()=>{let i=!1;return e(this)?(t(this),i=!0):this.cancelled&&(n(new Error("cancelled")),i=!0),i&&this.off("change",r),i};r()||this.on("change",r)}))}setPhase(e,t=!0){this._phase=e,t&&this.emit("change")}getEventByEither(e){return this.eventsByThem.get(e)||this.eventsByUs.get(e)}getEventBy(e,t=!1){return t?this.eventsByThem.get(e):this.eventsByUs.get(e)}calculatePhaseTransitions(){const e=[{phase:f}],t=()=>e[e.length-1].phase,n=this.eventsByThem.has(d),r=this.getEventBy(d,n);r&&e.push({phase:y,event:r});const i=r&&this.getEventBy(m,!n);let s;if(i&&t()===y&&e.push({phase:v,event:i}),i||!r){const e=this.eventsByThem.get(u),t=this.eventsByUs.get(u);s=e&&t?e.getSender()<t.getSender()?e:t:e||t}else s=this.getEventBy(u,!n);if(s){const n=t()===y&&r.getSender()!==s.getSender(),i=t()===f&&this.channel.canCreateRequest(u);(n||t()===v||i)&&e.push({phase:b,event:s})}const o=this.eventsByUs.get(p);(this.verifierHasFinished||o&&t()===b)&&e.push({phase:S});const a=this.getEventByEither(h);return(this._cancelled||a)&&t()!==S?(e.push({phase:w,event:a}),e):e}transitionToPhase(e){const{phase:t,event:n}=e;if((t===y||t===v)&&!this.wasSentByOwnDevice(n)){const e=n.getContent();this.commonMethods=e.methods.filter((e=>this.verificationMethods.has(e)))}if(this.observeOnly||t!==y&&t!==b&&t!==v||this.channel.receiveStartFromOtherDevices&&this.wasSentByOwnUser(n)&&!this.wasSentByOwnDevice(n)&&(this._observeOnly=!0),t===b){const{method:e}=n.getContent();this._verifier||this.observeOnly||(this._verifier=this.createVerifier(e,n),this._verifier?this._chosenMethod=e:this.cancel({code:"m.unknown_method",reason:`Unknown method: ${e}`}))}}applyPhaseTransitions(){const e=this.calculatePhaseTransitions(),t=e.findIndex((e=>e.phase===this.phase)),n=e.slice(t+1);for(const e of n)this.transitionToPhase(e);return n}isWinningStartRace(e){if(e.getType()!==u)return!1;const t=this._verifier.startEvent;let n,r;if(this.isSelfVerification)if(t){const e=t.getContent();n=e&&e.from_device}else n=this.client.getDeviceId();else n=t?t.getSender():this.client.getUserId();if(this.isSelfVerification){const t=e.getContent();r=t&&t.from_device}else r=e.getSender();return r<n}hasEventId(e){for(const t of this.eventsByUs.values())if(t.getId()===e)return!0;for(const t of this.eventsByThem.values())if(t.getId()===e)return!0;return!1}async handleEvent(e,t,n,r,i){if(this.done||this.cancelled)return;const s=this._observeOnly;if(this.adjustObserveOnly(t,n),!this.observeOnly&&!r&&await this.cancelOnError(e,t))return;if(i?this.eventsByUs.has(e):this.eventsByThem.has(e))return;const a=this.phase;this.addEvent(e,t,i);const c=this.applyPhaseTransitions();try{if(this._verifier&&!this.observeOnly){const n=this.isWinningStartRace(t);if(this._verifier.canSwitchStartEvent(t)&&n)this._verifier.switchStartEvent(t);else if(!r){var d;(e===h||null!==(d=this._verifier.events)&&void 0!==d&&d.includes(e))&&this._verifier.handleEvent(t)}}if(c.length){n&&c.some((e=>e.phase===v))&&this.otherPartySupportsMethod(l.SCAN_QR_CODE_METHOD,!0)&&(this._qrCodeData=await l.QRCodeData.create(this,this.client));const e=c[c.length-1],{phase:t}=e;this.setupTimeout(t),this.setPhase(t)}else this._observeOnly!==s&&this.emit("change")}finally{o.logger.log(`Verification request ${this.channel.transactionId}: ${e} event with id:${t.getId()}, content:${JSON.stringify(t.getContent())} deviceId:${this.channel.deviceId}, sender:${t.getSender()}, isSentByUs:${i}, isLiveEvent:${n}, isRemoteEcho:${r}, phase:${a}=>${this.phase}, observeOnly:${s}=>${this._observeOnly}`)}}setupTimeout(e){!this.timeoutTimer&&!this.observeOnly&&e===y&&(this.timeoutTimer=setTimeout(this.cancelOnTimeout,this.timeout)),this.timeoutTimer&&(e===b||e===v||e===S||e===w)&&(clearTimeout(this.timeoutTimer),this.timeoutTimer=null)}async cancelOnError(e,t){if(e===u){const e=t.getContent().method;if(!this.verificationMethods.has(e))return await this.cancel((0,a.errorFromEvent)((0,a.newUnknownMethodError)())),!0}const n=e===d&&this.phase!==f,r=e===m&&this.phase!==y;if(this.phase!==f&&(n||r)){o.logger.warn(`Cancelling, unexpected ${e} verification event from ${t.getSender()}`);const n=`Unexpected ${e} event in phase ${this.phase}`;return await this.cancel((0,a.errorFromEvent)((0,a.newUnexpectedMessageError)({reason:n}))),!0}return!1}adjustObserveOnly(e,t=!1){t||(this._observeOnly=!0),this.calculateEventTimeout(e)<3e3&&(this._observeOnly=!0)}addEvent(e,t,n=!1){if(n?this.eventsByUs.set(e,t):this.eventsByThem.set(e,t),e===d){for(const[e,t]of this.eventsByThem.entries())t.getSender()!==this.otherUserId&&this.eventsByThem.delete(e);this.requestReceivedAt=Date.now()}}createVerifier(e,t=null,n=null){n||(n=this.targetDevice);const{userId:r,deviceId:i}=n,s=this.verificationMethods.get(e);if(s)return new s(this.channel,this.client,r,i,t,this);o.logger.warn("could not find verifier constructor for method",e)}wasSentByOwnUser(e){return e.getSender()===this.client.getUserId()}wasSentByOwnDevice(e){if(!this.wasSentByOwnUser(e))return!1;const t=e.getContent();return!(!t||t.from_device!==this.client.getDeviceId())}onVerifierCancelled(){this._cancelled=!0;const e=this.applyPhaseTransitions();e.length&&this.setPhase(e[e.length-1].phase)}onVerifierFinished(){this.channel.send("m.key.verification.done",{}),this.verifierHasFinished=!0;const e=this.applyPhaseTransitions();e.length&&this.setPhase(e[e.length-1].phase)}getEventFromOtherParty(e){return this.eventsByThem.get(e)}}t.VerificationRequest=_},9489:(e,t)=>{"use strict";function n(e,t){const n=`Store is invalid because ${e}, please stop the client, delete all data and start the client again`,r=Reflect.construct(Error,[n]);return Reflect.setPrototypeOf(r,Reflect.getPrototypeOf(this)),r.reason=e,r.value=t,r}function r(e){const t=`Crypto store is invalid because ${e}, please stop the client, delete all data and start the client again`,n=Reflect.construct(Error,[t]);return Reflect.setPrototypeOf(n,Reflect.getPrototypeOf(this)),n.reason=e,n.name="InvalidCryptoStoreError",n}Object.defineProperty(t,"__esModule",{value:!0}),t.InvalidCryptoStoreError=r,t.InvalidStoreError=n,t.KeySignatureUploadError=void 0,n.TOGGLED_LAZY_LOADING="TOGGLED_LAZY_LOADING",n.prototype=Object.create(Error.prototype,{constructor:{value:Error,enumerable:!1,writable:!0,configurable:!0}}),Reflect.setPrototypeOf(n,Error),r.TOO_NEW="TOO_NEW",r.prototype=Object.create(Error.prototype,{constructor:{value:Error,enumerable:!1,writable:!0,configurable:!0}}),Reflect.setPrototypeOf(r,Error);class i extends Error{constructor(e,t){super(e),this.value=t}}t.KeySignatureUploadError=i},1166:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.eventMapperFor=function(e,t){const n=Boolean(t.preventReEmit),i=!1!==t.decrypt;return function(t){const s=new r.MatrixEvent(t);return s.isEncrypted()&&(n||e.reEmitter.reEmit(s,["Event.decrypted"]),i&&e.decryptEventIfNeeded(s)),n||e.reEmitter.reEmit(s,["Event.replaced","Event.visibilityChange"]),s}};var r=n(4369)},3564:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.FilterComponent=void 0;var r=n(2481),i=n(7906);t.FilterComponent=class{constructor(e,t){this.filterJson=e,this.userId=t}check(e){var t,n;const i=(null===(t=e.getUnsigned())||void 0===t?void 0:t["m.relations"])||{},s=Object.keys(i),o=[];return this.userId&&null!=s&&null!==(n=s[r.RelationType.Thread])&&void 0!==n&&n.current_user_participated&&o.push(this.userId),this.checkFields(e.getRoomId(),e.getSender(),e.getType(),!!e.getContent()&&void 0!==e.getContent().url,s,o)}toJSON(){return{types:this.filterJson.types||null,not_types:this.filterJson.not_types||[],rooms:this.filterJson.rooms||null,not_rooms:this.filterJson.not_rooms||[],senders:this.filterJson.senders||null,not_senders:this.filterJson.not_senders||[],contains_url:this.filterJson.contains_url||null,[i.UNSTABLE_FILTER_RELATION_SENDERS.name]:i.UNSTABLE_FILTER_RELATION_SENDERS.findIn(this.filterJson),[i.UNSTABLE_FILTER_RELATION_TYPES.name]:i.UNSTABLE_FILTER_RELATION_TYPES.findIn(this.filterJson)}}checkFields(e,t,n,r,s,o){const a={rooms:function(t){return e===t},senders:function(e){return t===e},types:function(e){return function(e,t){if(t.endsWith("*")){const n=t.slice(0,-1);return e.substr(0,n.length)===n}return e===t}(n,e)}};for(let e=0;e<Object.keys(a).length;e++){const t=Object.keys(a)[e],n=a[t],r="not_"+t,i=this.filterJson[r];if(null!=i&&i.some(n))return!1;const s=this.filterJson[t];if(s&&!s.some(n))return!1}const l=this.filterJson.contains_url;if(void 0!==l&&l!==r)return!1;const c=this.filterJson[i.UNSTABLE_FILTER_RELATION_TYPES.name];if(void 0!==c&&!this.arrayMatchesFilter(c,s))return!1;const d=this.filterJson[i.UNSTABLE_FILTER_RELATION_SENDERS.name];return!(void 0!==d&&!this.arrayMatchesFilter(d,o))}arrayMatchesFilter(e,t){return t.length>0&&t.every((t=>e.includes(t)))}filter(e){return e.filter(this.check,this)}limit(){return void 0!==this.filterJson.limit?this.filterJson.limit:10}}},7906:(e,t,n)=>{"use strict";var r=n(5318);Object.defineProperty(t,"__esModule",{value:!0}),t.UNSTABLE_FILTER_RELATION_TYPES=t.UNSTABLE_FILTER_RELATION_SENDERS=t.Filter=void 0;var i=r(n(9713)),s=n(3564),o=n(7048);const a=new o.UnstableValue("relation_senders","io.element.relation_senders");t.UNSTABLE_FILTER_RELATION_SENDERS=a;const l=new o.UnstableValue("relation_types","io.element.relation_types");function c(e,t,n){const r=t.split(".");let i=e;for(let e=0;e<r.length-1;e++)i[r[e]]||(i[r[e]]={}),i=i[r[e]];i[r[r.length-1]]=n}t.UNSTABLE_FILTER_RELATION_TYPES=l;class d{static fromJson(e,t,n){const r=new d(e,t);return r.setDefinition(n),r}constructor(e,t){this.userId=e,this.filterId=t,(0,i.default)(this,"definition",{}),(0,i.default)(this,"roomFilter",void 0),(0,i.default)(this,"roomTimelineFilter",void 0)}getFilterId(){return this.filterId}getDefinition(){return this.definition}setDefinition(e){this.definition=e;const t=e.room,n={};t&&(t.rooms&&(n.rooms=t.rooms),t.rooms&&(n.not_rooms=t.not_rooms)),this.roomFilter=new s.FilterComponent(n,this.userId),this.roomTimelineFilter=new s.FilterComponent((null==t?void 0:t.timeline)||{},this.userId)}getRoomTimelineFilterComponent(){return this.roomTimelineFilter}filterRoomTimeline(e){return this.roomTimelineFilter.filter(this.roomFilter.filter(e))}setTimelineLimit(e){c(this.definition,"room.timeline.limit",e)}setLazyLoadMembers(e){c(this.definition,"room.state.lazy_load_members",!!e)}setIncludeLeaveRooms(e){c(this.definition,"room.include_leave",e)}}t.Filter=d,(0,i.default)(d,"LAZY_LOADING_MESSAGES_FILTER",{lazy_load_members:!0})},7715:(e,t,n)=>{"use strict";var r=n(5318);Object.defineProperty(t,"__esModule",{value:!0}),t.PREFIX_V1=t.PREFIX_UNSTABLE=t.PREFIX_R0=t.PREFIX_MEDIA_R0=t.PREFIX_IDENTITY_V2=t.PREFIX_IDENTITY_V1=t.Method=t.MatrixHttpApi=t.MatrixError=t.ConnectionError=t.AbortError=void 0,t.retryNetworkOperation=async function(e,t){let n=0,r=null;for(;n<e;)try{if(n>0){const e=1e3*Math.pow(2,n);l.logger.log(`network operation failed ${n} times, retrying in ${e}ms...`),await new Promise((t=>setTimeout(t,e)))}return await t()}catch(e){if(!(e instanceof y))throw e;n+=1,r=e}throw r};var i=r(n(9713)),s=n(7811),o=d(n(2731)),a=d(n(3102)),l=n(7434);function c(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(c=function(e){return e?n:t})(e)}function d(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var n=c(t);if(n&&n.has(e))return n.get(e);var r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var s in e)if("default"!==s&&Object.prototype.hasOwnProperty.call(e,s)){var o=i?Object.getOwnPropertyDescriptor(e,s):null;o&&(o.get||o.set)?Object.defineProperty(r,s,o):r[s]=e[s]}return r.default=e,n&&n.set(e,r),r}function u(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function h(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?u(Object(n),!0).forEach((function(t){(0,i.default)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):u(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}let p;function m(e){return e.status||e.statusCode}function g(e,t,n=!1,r){return function(i,o,a){i&&("AbortError"===i.name||"aborted"===i||i instanceof f||(i=new y("request failed",i)));let l=a;if(!i)try{m(o)>=400?i=function(e,t){const n=m(e),r=function(e){let t;if(e.getResponseHeader?t=e.getResponseHeader("Content-Type"):e.headers&&(t=e.headers["content-type"]||null),!t)return null;try{return(0,s.parse)(t)}catch(e){throw new Error(`Error parsing Content-Type '${t}': ${e}`)}}(e);let i;if(r)if("application/json"===r.type){const e="object"==typeof t?t:JSON.parse(t);i=new f(e)}else"text/plain"===r.type&&(i=new Error(`Server returned ${n} error: ${t}`));return i||(i=new Error(`Server returned ${n} error`)),i.httpStatus=n,i}(o,a):r&&(l=r(a))}catch(e){i=new Error(`Error parsing server response: ${e}`)}if(i)e.reject(i),null==t||t(i);else if(n)e.resolve(l),null==t||t(null,l);else{const n={code:m(o),headers:o.headers,data:l};e.resolve(n),null==t||t(null,n)}}}t.PREFIX_R0="/_matrix/client/r0",t.PREFIX_V1="/_matrix/client/v1",t.PREFIX_UNSTABLE="/_matrix/client/unstable",t.PREFIX_IDENTITY_V1="/_matrix/identity/api/v1",t.PREFIX_IDENTITY_V2="/_matrix/identity/v2",t.PREFIX_MEDIA_R0="/_matrix/media/r0",t.Method=p,function(e){e.Get="GET",e.Put="PUT",e.Post="POST",e.Delete="DELETE"}(p||(t.Method=p={})),t.MatrixHttpApi=class{constructor(e,t){this.eventEmitter=e,this.opts=t,(0,i.default)(this,"uploads",[]),a.checkObjectHasKeys(t,["baseUrl","request","prefix"]),t.onlyData=!!t.onlyData,t.useAuthorizationHeader=!!t.useAuthorizationHeader}setIdBaseUrl(e){this.opts.idBaseUrl=e}getContentUri(){return{base:this.opts.baseUrl,path:"/_matrix/media/r0/upload",params:{access_token:this.opts.accessToken}}}uploadContent(e,t){a.isFunction(t)?t={callback:t}:t||(t={});const r=!1!==t.includeFilename,i=t.type||e.type||"application/octet-stream",s=t.name||e.name;let c=e;const d=c.stream;d&&"function"!=typeof d&&(l.logger.warn("Using `file.stream` as the content to upload. Future versions of the js-sdk will change this to expect `file` to be the content directly."),c=d);let u=t.rawResponse;void 0===u&&(n.g.XMLHttpRequest?u=!1:(l.logger.warn("Returning the raw JSON from uploadContent(). Future versions of the js-sdk will change this default, to return the parsed object. Set opts.rawResponse=false to change this behaviour now."),u=!0));let h=t.onlyContentUri;u||void 0!==h||(n.g.XMLHttpRequest?(l.logger.warn("Returning only the content-uri from uploadContent(). Future versions of the js-sdk will change this default, to return the whole response object. Set opts.onlyContentUri=false to change this behaviour now."),h=!0):h=!1);const m={loaded:0,total:0};let f,y=null;if(u||(y=function(e){let t=JSON.parse(e);if(h&&(t=t.content_uri,void 0===t))throw Error("Bad response");return t}),n.g.XMLHttpRequest){const e=a.defer(),l=new n.g.XMLHttpRequest,d=g(e,t.callback,this.opts.onlyData),u=function(){l.abort(),d(new Error("Timeout"))};let h=o.setTimeout(u,3e4);l.onreadystatechange=function(){let e;if(l.readyState===n.g.XMLHttpRequest.DONE){o.clearTimeout(h);try{if(0===l.status)throw new v;if(!l.responseText)throw new Error("No response body.");e=l.responseText,y&&(e=y(e))}catch(e){return e.http_status=l.status,void d(e)}d(void 0,l,e)}},l.upload.addEventListener("progress",(function(e){o.clearTimeout(h),m.loaded=e.loaded,m.total=e.total,h=o.setTimeout(u,3e4),t.progressHandler&&t.progressHandler({loaded:e.loaded,total:e.total})}));let p=this.opts.baseUrl+"/_matrix/media/r0/upload";const b=[];r&&s&&b.push("filename="+encodeURIComponent(s)),this.opts.useAuthorizationHeader||b.push("access_token="+encodeURIComponent(this.opts.accessToken)),b.length>0&&(p+="?"+b.join("&")),l.open("POST",p),this.opts.useAuthorizationHeader&&l.setRequestHeader("Authorization","Bearer "+this.opts.accessToken),l.setRequestHeader("Content-Type",i),l.send(c),f=e.promise,f.abort=l.abort.bind(l)}else{const e={};r&&s&&(e.filename=s),f=this.authedRequest(t.callback,p.Post,"/upload",e,c,{prefix:"/_matrix/media/r0",headers:{"Content-Type":i},json:!1,bodyParser:y})}return m.promise=f.finally((()=>{for(let e=0;e<this.uploads.length;++e)if(this.uploads[e]===m)return void this.uploads.splice(e,1)})),m.promise.abort=f.abort,this.uploads.push(m),m.promise}cancelUpload(e){return!!e.abort&&(e.abort(),!0)}getCurrentUploads(){return this.uploads}idServerRequest(e,t,n,r,i,s){if(!this.opts.idBaseUrl)throw new Error("No identity server base URL set");const o=this.opts.idBaseUrl+i+n;if(void 0!==e&&!a.isFunction(e))throw Error("Expected callback to be a function but got "+typeof e);const l={uri:o,method:t,withCredentials:!1,json:!0,_matrix_opts:this.opts,headers:{}};t===p.Get?l.qs=r:"object"==typeof r&&(l.json=r),s&&(l.headers.Authorization=`Bearer ${s}`);const c=a.defer();return this.opts.request(l,g(c,e,this.opts.onlyData)),c.promise}authedRequest(e,t,n,r,i,s){r||(r={});let o=s||{};this.opts.useAuthorizationHeader?(isFinite(s)&&(o={localTimeoutMs:s}),o.headers||(o.headers={}),o.headers.Authorization||(o.headers.Authorization="Bearer "+this.opts.accessToken),r.access_token&&delete r.access_token):r.access_token||(r.access_token=this.opts.accessToken);const a=this.request(e,t,n,r,i,o);return a.catch((e=>{"M_UNKNOWN_TOKEN"==e.errcode?this.eventEmitter.emit("Session.logged_out",e):"M_CONSENT_NOT_GIVEN"==e.errcode&&this.eventEmitter.emit("no_consent",e.message,e.data.consent_uri)})),a}request(e,t,n,r,i,s){var o;const a=null!==(o=null==s?void 0:s.prefix)&&void 0!==o?o:this.opts.prefix,l=this.opts.baseUrl+a+n;return this.requestOtherUrl(e,t,l,r,i,s)}requestOtherUrl(e,t,n,r,i,s){let o=s||{};return isFinite(s)&&(o={localTimeoutMs:s}),this.doRequest(e,t,n,r,i,o)}getUrl(e,t,n){let r="";return t&&(r="?"+a.encodeParams(t)),this.opts.baseUrl+n+e+r}doRequest(e,t,n,r,i,s){var l;if(void 0!==e&&!a.isFunction(e))throw Error("Expected callback to be a function but got "+typeof e);this.opts.extraParams&&(r=h(h({},r||{}),this.opts.extraParams));const c=Object.assign({},s.headers||{});s||(s={});const d=null===(l=s.json)||void 0===l||l;let u=s.bodyParser;d&&(i&&(i=JSON.stringify(i),c["content-type"]="application/json"),c.accept||(c.accept="application/json"),void 0===u&&(u=function(e){return JSON.parse(e)}));const p=a.defer();let m,y,v=!1;const b=s.localTimeoutMs||this.opts.localTimeoutMs,w=()=>{b&&(m&&o.clearTimeout(m),m=o.setTimeout((function(){var e,t;v=!0,null===(e=y)||void 0===e||null===(t=e.abort)||void 0===t||t.call(e),p.reject(new f({error:"Locally timed out waiting for a response",errcode:"ORG.MATRIX.JSSDK_TIMEOUT",timeout:b}))}),b))};w();const S=p.promise;try{y=this.opts.request({uri:n,method:t,withCredentials:!1,qs:r,qsStringifyOptions:s.qsStringifyOptions,useQuerystring:!0,body:i,json:!1,timeout:b,headers:c||{},_matrix_opts:this.opts},((t,n,r)=>{b&&(o.clearTimeout(m),v)||g(p,e,this.opts.onlyData,u)(t,n,r)})),y&&("onprogress"in y&&(y.onprogress=e=>{w()}),y.abort&&(S.abort=y.abort.bind(y)))}catch(t){p.reject(t),e&&e(t)}return S}};class f extends Error{constructor(e={}){super(`MatrixError: ${e.errcode}`),(0,i.default)(this,"errcode",void 0),(0,i.default)(this,"data",void 0),(0,i.default)(this,"httpStatus",void 0),this.errcode=e.errcode,this.name=e.errcode||"Unknown error code",this.message=e.error||"Unknown message",this.data=e}}t.MatrixError=f;class y extends Error{constructor(e,t){super(e+(t?`: ${t.message}`:"")),this.cause=t}get name(){return"ConnectionError"}}t.ConnectionError=y;class v extends Error{constructor(){super("Operation aborted")}get name(){return"AbortError"}}t.AbortError=v},3415:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.exists=function(e,t){return new Promise(((n,r)=>{let i=!0;const s=e.open(t);s.onupgradeneeded=()=>{i=!1},s.onblocked=()=>r(s.error),s.onsuccess=()=>{s.result.close(),i||e.deleteDatabase(t),n(i)},s.onerror=e=>r(s.error)}))}},8670:(e,t,n)=>{"use strict";var r=n(5318);Object.defineProperty(t,"__esModule",{value:!0}),t.InteractiveAuth=t.AuthType=void 0;var i=r(n(9713)),s=n(7434),o=n(3102);const a="m.login.email.identity",l="m.login.msisdn";let c;t.AuthType=c,function(e){e.Password="m.login.password",e.Recaptcha="m.login.recaptcha",e.Terms="m.login.terms",e.Email="m.login.email.identity",e.Msisdn="m.login.msisdn",e.Sso="m.login.sso",e.SsoUnstable="org.matrix.login.sso",e.Dummy="m.login.dummy",e.RegistrationToken="org.matrix.msc3231.login.registration_token"}(c||(t.AuthType=c={}));class d extends Error{constructor(e,t,n){super(e),this.required_stages=t,this.flows=n,(0,i.default)(this,"name","NoAuthFlowFoundError")}}t.InteractiveAuth=class{constructor(e){var t;(0,i.default)(this,"matrixClient",void 0),(0,i.default)(this,"inputs",void 0),(0,i.default)(this,"clientSecret",void 0),(0,i.default)(this,"requestCallback",void 0),(0,i.default)(this,"busyChangedCallback",void 0),(0,i.default)(this,"stateUpdatedCallback",void 0),(0,i.default)(this,"requestEmailTokenCallback",void 0),(0,i.default)(this,"data",void 0),(0,i.default)(this,"emailSid",void 0),(0,i.default)(this,"requestingEmailToken",!1),(0,i.default)(this,"attemptAuthDeferred",null),(0,i.default)(this,"chosenFlow",null),(0,i.default)(this,"currentStage",null),(0,i.default)(this,"submitPromise",null),this.matrixClient=e.matrixClient,this.data=e.authData||{},this.requestCallback=e.doRequest,this.busyChangedCallback=e.busyChanged,this.stateUpdatedCallback=e.stateUpdated||e.startAuthStage,this.requestEmailTokenCallback=e.requestEmailToken,this.inputs=e.inputs||{},e.sessionId&&(this.data.session=e.sessionId),this.clientSecret=e.clientSecret||this.matrixClient.generateClientSecret(),this.emailSid=null!==(t=e.emailSid)&&void 0!==t?t:null}attemptAuth(){var e;this.attemptAuthDeferred=(0,o.defer)();const t=this.attemptAuthDeferred.promise;if(null!==(e=this.data)&&void 0!==e&&e.flows)this.startNextAuthStage();else{var n;null===(n=this.busyChangedCallback)||void 0===n||n.call(this,!0);let e=null;this.data.session&&(e={session:this.data.session}),this.doRequest(e).finally((()=>{var e;null===(e=this.busyChangedCallback)||void 0===e||e.call(this,!1)}))}return t}async poll(){if(!this.data.session)return;if(!this.attemptAuthDeferred)return;if(this.submitPromise)return;let e={};if(this.currentStage==a&&this.emailSid){const t={sid:this.emailSid,client_secret:this.clientSecret};if(await this.matrixClient.doesServerRequireIdServerParam()){const e=new URL(this.matrixClient.getIdentityServerUrl());t.id_server=e.host}e={type:a,threepid_creds:t,threepidCreds:t}}this.submitAuthDict(e,!0)}getSessionId(){return this.data?this.data.session:void 0}getClientSecret(){return this.clientSecret}getStageParams(e){var t;return null===(t=this.data.params)||void 0===t?void 0:t[e]}getChosenFlow(){return this.chosenFlow}async submitAuthDict(e,t=!1){if(!this.attemptAuthDeferred)throw new Error("submitAuthDict() called before attemptAuth()");var n;for(t||null===(n=this.busyChangedCallback)||void 0===n||n.call(this,!0);this.submitPromise;)try{await this.submitPromise}catch(e){}let r;this.data.session?(r={session:this.data.session},Object.assign(r,e)):r=e;try{this.submitPromise=this.doRequest(r,t),await this.submitPromise}finally{var i;this.submitPromise=null,t||null===(i=this.busyChangedCallback)||void 0===i||i.call(this,!1)}}getEmailSid(){return this.emailSid}setEmailSid(e){this.emailSid=e}async doRequest(e,t=!1){try{const n=await this.requestCallback(e,t);this.attemptAuthDeferred.resolve(n),this.attemptAuthDeferred=null}catch(e){var n,r;const o=null!==(n=null===(r=e.data)||void 0===r?void 0:r.flows)&&void 0!==n?n:null,a=this.data.flows||Boolean(o);var i;401===e.httpStatus&&e.data&&a||(t?s.logger.log("Background poll request failed doing UI auth: ignoring",e):null===(i=this.attemptAuthDeferred)||void 0===i||i.reject(e)),e.data.flows||e.data.completed||e.data.session||(e.data.flows=this.data.flows,e.data.completed=this.data.completed,e.data.session=this.data.session),this.data=e.data;try{this.startNextAuthStage()}catch(e){return this.attemptAuthDeferred.reject(e),void(this.attemptAuthDeferred=null)}if(!this.emailSid&&!this.requestingEmailToken&&this.chosenFlow.stages.includes(c.Email)){this.requestingEmailToken=!0;try{const e=await this.requestEmailTokenCallback(this.inputs.emailAddress,this.clientSecret,1,this.data.session);this.emailSid=e.sid}catch(e){this.attemptAuthDeferred.reject(e),this.attemptAuthDeferred=null}finally{this.requestingEmailToken=!1}}}}startNextAuthStage(){const e=this.chooseStage();if(!e)throw new Error("No incomplete flows from the server");if(this.currentStage=e,e===c.Dummy)return void this.submitAuthDict({type:"m.login.dummy"});if(this.data&&this.data.errcode||this.data.error)return void this.stateUpdatedCallback(e,{errcode:this.data.errcode||"",error:this.data.error||""});const t={};e==a&&(t.emailSid=this.emailSid),this.stateUpdatedCallback(e,t)}chooseStage(){null===this.chosenFlow&&(this.chosenFlow=this.chooseFlow()),s.logger.log("Active flow => %s",JSON.stringify(this.chosenFlow));const e=this.firstUncompletedStage(this.chosenFlow);return s.logger.log("Next stage: %s",e),e}chooseFlow(){const e=this.data.flows||[],t=Boolean(this.inputs.emailAddress)||Boolean(this.emailSid),n=Boolean(this.inputs.phoneCountry)&&Boolean(this.inputs.phoneNumber);for(const r of e){let e=!1,i=!1;for(const t of r.stages)t===a?e=!0:t==l&&(i=!0);if(e==t&&i==n)return r}const r=[];throw t&&r.push(a),n&&r.push(l),new d("No appropriate authentication flow found",r,e)}firstUncompletedStage(e){const t=this.data.completed||[];for(let n=0;n<e.stages.length;++n){const r=e.stages[n];if(-1===t.indexOf(r))return r}}}},7434:(e,t,n)=>{"use strict";var r=n(5318);Object.defineProperty(t,"__esModule",{value:!0}),t.logger=void 0;var i=r(n(2043));i.default.methodFactory=function(e,t,n){return function(...t){return this.prefix&&t.unshift(this.prefix),"error"===e||"warn"===e||"trace"===e||"info"===e?console[e](...t):console.log(...t)}};const s=i.default.getLogger("matrix");t.logger=s,s.setLevel(i.default.levels.DEBUG,!1),function e(t){t.withPrefix=function(t){return function(t){const n=i.default.getLogger(`matrix-${t}`);return n.prefix!==t&&(e(n),n.prefix=t,n.setLevel(i.default.levels.DEBUG,!1)),n}((this.prefix||"")+t)}}(s)},8070:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r={request:!0,getRequest:!0,wrapRequest:!0,setCryptoStoreFactory:!0,createClient:!0,ContentHelpers:!0,createNewMatrixCall:!0};t.ContentHelpers=void 0,t.createClient=function(e){return"string"==typeof e&&(e={baseUrl:e}),e.request=e.request||F,e.store=e.store||new s.MemoryStore({localStorage:n.g.localStorage}),e.scheduler=e.scheduler||new o.MatrixScheduler,e.cryptoStore=e.cryptoStore||N(),new a.MatrixClient(e)},Object.defineProperty(t,"createNewMatrixCall",{enumerable:!0,get:function(){return D.createNewMatrixCall}}),t.getRequest=function(){return F},t.request=function(e){F=e},t.setCryptoStoreFactory=function(e){N=e},t.wrapRequest=function(e){const t=F;F=function(n,r){return e(t,n,r)}};var i=n(1045);Object.keys(i).forEach((function(e){"default"!==e&&"__esModule"!==e&&(Object.prototype.hasOwnProperty.call(r,e)||e in t&&t[e]===i[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return i[e]}}))}));var s=n(1703);Object.keys(s).forEach((function(e){"default"!==e&&"__esModule"!==e&&(Object.prototype.hasOwnProperty.call(r,e)||e in t&&t[e]===s[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return s[e]}}))}));var o=n(9443);Object.keys(o).forEach((function(e){"default"!==e&&"__esModule"!==e&&(Object.prototype.hasOwnProperty.call(r,e)||e in t&&t[e]===o[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return o[e]}}))}));var a=n(2168);Object.keys(a).forEach((function(e){"default"!==e&&"__esModule"!==e&&(Object.prototype.hasOwnProperty.call(r,e)||e in t&&t[e]===a[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return a[e]}}))}));var l=n(7715);Object.keys(l).forEach((function(e){"default"!==e&&"__esModule"!==e&&(Object.prototype.hasOwnProperty.call(r,e)||e in t&&t[e]===l[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return l[e]}}))}));var c=n(9118);Object.keys(c).forEach((function(e){"default"!==e&&"__esModule"!==e&&(Object.prototype.hasOwnProperty.call(r,e)||e in t&&t[e]===c[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return c[e]}}))}));var d=n(2741);Object.keys(d).forEach((function(e){"default"!==e&&"__esModule"!==e&&(Object.prototype.hasOwnProperty.call(r,e)||e in t&&t[e]===d[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return d[e]}}))}));var u=n(9489);Object.keys(u).forEach((function(e){"default"!==e&&"__esModule"!==e&&(Object.prototype.hasOwnProperty.call(r,e)||e in t&&t[e]===u[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return u[e]}}))}));var h=n(4369);Object.keys(h).forEach((function(e){"default"!==e&&"__esModule"!==e&&(Object.prototype.hasOwnProperty.call(r,e)||e in t&&t[e]===h[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return h[e]}}))}));var p=n(7366);Object.keys(p).forEach((function(e){"default"!==e&&"__esModule"!==e&&(Object.prototype.hasOwnProperty.call(r,e)||e in t&&t[e]===p[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return p[e]}}))}));var m=n(142);Object.keys(m).forEach((function(e){"default"!==e&&"__esModule"!==e&&(Object.prototype.hasOwnProperty.call(r,e)||e in t&&t[e]===m[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return m[e]}}))}));var g=n(8910);Object.keys(g).forEach((function(e){"default"!==e&&"__esModule"!==e&&(Object.prototype.hasOwnProperty.call(r,e)||e in t&&t[e]===g[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return g[e]}}))}));var f=n(3705);Object.keys(f).forEach((function(e){"default"!==e&&"__esModule"!==e&&(Object.prototype.hasOwnProperty.call(r,e)||e in t&&t[e]===f[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return f[e]}}))}));var y=n(2848);Object.keys(y).forEach((function(e){"default"!==e&&"__esModule"!==e&&(Object.prototype.hasOwnProperty.call(r,e)||e in t&&t[e]===y[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return y[e]}}))}));var v=n(6860);Object.keys(v).forEach((function(e){"default"!==e&&"__esModule"!==e&&(Object.prototype.hasOwnProperty.call(r,e)||e in t&&t[e]===v[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return v[e]}}))}));var b=n(3998);Object.keys(b).forEach((function(e){"default"!==e&&"__esModule"!==e&&(Object.prototype.hasOwnProperty.call(r,e)||e in t&&t[e]===b[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return b[e]}}))}));var w=n(7906);Object.keys(w).forEach((function(e){"default"!==e&&"__esModule"!==e&&(Object.prototype.hasOwnProperty.call(r,e)||e in t&&t[e]===w[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return w[e]}}))}));var S=n(4969);Object.keys(S).forEach((function(e){"default"!==e&&"__esModule"!==e&&(Object.prototype.hasOwnProperty.call(r,e)||e in t&&t[e]===S[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return S[e]}}))}));var _=n(8670);Object.keys(_).forEach((function(e){"default"!==e&&"__esModule"!==e&&(Object.prototype.hasOwnProperty.call(r,e)||e in t&&t[e]===_[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return _[e]}}))}));var k=n(1415);Object.keys(k).forEach((function(e){"default"!==e&&"__esModule"!==e&&(Object.prototype.hasOwnProperty.call(r,e)||e in t&&t[e]===k[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return k[e]}}))}));var x=n(9789);Object.keys(x).forEach((function(e){"default"!==e&&"__esModule"!==e&&(Object.prototype.hasOwnProperty.call(r,e)||e in t&&t[e]===x[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return x[e]}}))}));var E=n(5837);Object.keys(E).forEach((function(e){"default"!==e&&"__esModule"!==e&&(Object.prototype.hasOwnProperty.call(r,e)||e in t&&t[e]===E[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return E[e]}}))}));var T=n(7585);Object.keys(T).forEach((function(e){"default"!==e&&"__esModule"!==e&&(Object.prototype.hasOwnProperty.call(r,e)||e in t&&t[e]===T[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return T[e]}}))}));var C=n(3667);Object.keys(C).forEach((function(e){"default"!==e&&"__esModule"!==e&&(Object.prototype.hasOwnProperty.call(r,e)||e in t&&t[e]===C[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return C[e]}}))}));var A=n(2481);Object.keys(A).forEach((function(e){"default"!==e&&"__esModule"!==e&&(Object.prototype.hasOwnProperty.call(r,e)||e in t&&t[e]===A[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return A[e]}}))}));var I=n(1470);Object.keys(I).forEach((function(e){"default"!==e&&"__esModule"!==e&&(Object.prototype.hasOwnProperty.call(r,e)||e in t&&t[e]===I[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return I[e]}}))}));var R=n(6513);Object.keys(R).forEach((function(e){"default"!==e&&"__esModule"!==e&&(Object.prototype.hasOwnProperty.call(r,e)||e in t&&t[e]===R[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return R[e]}}))}));var O=n(9162);Object.keys(O).forEach((function(e){"default"!==e&&"__esModule"!==e&&(Object.prototype.hasOwnProperty.call(r,e)||e in t&&t[e]===O[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return O[e]}}))}));var P=n(5205);Object.keys(P).forEach((function(e){"default"!==e&&"__esModule"!==e&&(Object.prototype.hasOwnProperty.call(r,e)||e in t&&t[e]===P[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return P[e]}}))}));var M=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var n=L(t);if(n&&n.has(e))return n.get(e);var r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var s in e)if("default"!==s&&Object.prototype.hasOwnProperty.call(e,s)){var o=i?Object.getOwnPropertyDescriptor(e,s):null;o&&(o.get||o.set)?Object.defineProperty(r,s,o):r[s]=e[s]}return r.default=e,n&&n.set(e,r),r}(n(4656));t.ContentHelpers=M;var D=n(9679);function L(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(L=function(e){return e?n:t})(e)}let F,N=()=>new i.MemoryCryptoStore},8807:(e,t,n)=>{"use strict";var r=n(5318);Object.defineProperty(t,"__esModule",{value:!0}),t.MSC3089Branch=void 0;var i=r(n(9713)),s=n(2481),o=n(8910);function a(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function l(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?a(Object(n),!0).forEach((function(t){(0,i.default)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):a(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}t.MSC3089Branch=class{constructor(e,t,n){this.client=e,this.indexEvent=t,this.directory=n}get id(){const e=this.indexEvent.getStateKey();if(!e)throw new Error("State key not found for branch");return e}get isActive(){return!0===this.indexEvent.getContent().active}get version(){var e;return null!==(e=this.indexEvent.getContent().version)&&void 0!==e?e:1}get roomId(){return this.indexEvent.getRoomId()}async delete(){await this.client.sendStateEvent(this.roomId,s.UNSTABLE_MSC3089_BRANCH.name,{},this.id),await this.client.redactEvent(this.roomId,this.id);const e=(await this.getVersionHistory())[1];e&&await e.delete()}getName(){return this.indexEvent.getContent().name||"Unnamed File"}async setName(e){await this.client.sendStateEvent(this.roomId,s.UNSTABLE_MSC3089_BRANCH.name,l(l({},this.indexEvent.getContent()),{},{name:e}),this.id)}isLocked(){return this.indexEvent.getContent().locked||!1}async setLocked(e){await this.client.sendStateEvent(this.roomId,s.UNSTABLE_MSC3089_BRANCH.name,l(l({},this.indexEvent.getContent()),{},{locked:e}),this.id)}async getFileInfo(){const e=(await this.getFileEvent()).getOriginalContent().file,t=this.client.mxcUrlToHttp(e.url);if(!t)throw new Error(`No HTTP URL available for ${e.url}`);return{info:e,httpUrl:t}}async getFileEvent(){const e=this.client.getRoom(this.roomId);if(!e)throw new Error("Unknown room");let t=e.getUnfilteredTimelineSet().findEventById(this.id);for(;!t&&e.getLiveTimeline().getState(o.EventTimeline.BACKWARDS).paginationToken;)await this.client.scrollback(e,100),t=e.getUnfilteredTimelineSet().findEventById(this.id);if(!t)throw new Error("Failed to find event");return await this.client.decryptEventIfNeeded(t,{emit:!0,isRetry:!0}),t}async createNewVersion(e,t,n,r){const i=await this.directory.createFile(e,t,n,l(l({},null!=r?r:{}),{},{"m.new_content":!0,"m.relates_to":{rel_type:s.RelationType.Replace,event_id:this.id}}));await this.client.sendStateEvent(this.roomId,s.UNSTABLE_MSC3089_BRANCH.name,{active:!0,name:e,version:this.version+1},i.event_id),await this.client.sendStateEvent(this.roomId,s.UNSTABLE_MSC3089_BRANCH.name,l(l({},this.indexEvent.getContent()),{},{active:!1}),this.id)}async getVersionHistory(){const e=[];e.push(this);const t=this.client.getRoom(this.roomId);if(!t)throw new Error("Invalid or unknown room");const n=[...t.getLiveTimeline().getEvents()].reverse();let r,i=await this.getFileEvent();do{if(r=n.find((e=>e.replacingEventId()===i.getId())),r){const t=this.directory.getFile(r.getId());if(!t)break;e.push(t),i=r}}while(r);return e}}},6170:(e,t,n)=>{"use strict";var r=n(5318);Object.defineProperty(t,"__esModule",{value:!0}),t.TreePermissions=t.MSC3089TreeSpace=t.DEFAULT_TREE_POWER_LEVELS_TEMPLATE=void 0;var i=r(n(9713)),s=r(n(2693)),o=n(2481),a=n(7434),l=n(3102),c=n(8807),d=n(7125);function u(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function h(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?u(Object(n),!0).forEach((function(t){(0,i.default)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):u(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}const p={invite:100,kick:100,ban:100,redact:50,state_default:50,events_default:50,users_default:0,events:{[o.EventType.RoomPowerLevels]:100,[o.EventType.RoomHistoryVisibility]:100,[o.EventType.RoomTombstone]:100,[o.EventType.RoomEncryption]:100,[o.EventType.RoomName]:50,[o.EventType.RoomMessage]:50,[o.EventType.RoomMessageEncrypted]:50,[o.EventType.Sticker]:50},users:{}};let m;t.DEFAULT_TREE_POWER_LEVELS_TEMPLATE=p,t.TreePermissions=m,function(e){e.Viewer="viewer",e.Editor="editor",e.Owner="owner"}(m||(t.TreePermissions=m={})),t.MSC3089TreeSpace=class{constructor(e,t){if(this.client=e,this.roomId=t,(0,i.default)(this,"room",void 0),this.room=this.client.getRoom(this.roomId),!this.room)throw new Error("Unknown room")}get id(){return this.roomId}get isTopLevel(){const e=this.room.currentState.getStateEvents(o.EventType.SpaceParent);return null==e||!e.length||e.every((e=>{var t;return!(null!==(t=e.getContent())&&void 0!==t&&t.via)}))}async setName(e){await this.client.sendStateEvent(this.roomId,o.EventType.RoomName,{name:e},"")}async invite(e,t=!0,n=!0){const r=[this.retryInvite(e)];return t&&r.push(...this.getDirectories().map((r=>r.invite(e,t,n)))),Promise.all(r).then((()=>{n&&(0,d.isRoomSharedHistory)(this.room)&&this.client.sendSharedHistoryKeys(this.roomId,[e])}))}retryInvite(e){return(0,l.simpleRetryOperation)((async()=>{await this.client.invite(this.roomId,e).catch((e=>{if("M_FORBIDDEN"===(null==e?void 0:e.errcode))throw new s.default.AbortError(e);throw e}))}))}async setPermissions(e,t){var n;const r=this.room.currentState.getStateEvents(o.EventType.RoomPowerLevels,"");if(Array.isArray(r))throw new Error("Unexpected return type for power levels");const i=r.getContent()||{},s=i.users_default||0,a=i.events_default||50,l=(null===(n=i.events)||void 0===n?void 0:n[o.EventType.RoomPowerLevels])||100,c=i.users||{};switch(t){case m.Viewer:c[e]=s;break;case m.Editor:c[e]=a;break;case m.Owner:c[e]=l;break;default:throw new Error("Invalid role: "+t)}i.users=c,await this.client.sendStateEvent(this.roomId,o.EventType.RoomPowerLevels,i,"")}getPermissions(e){var t,n;const r=this.room.currentState.getStateEvents(o.EventType.RoomPowerLevels,"");if(Array.isArray(r))throw new Error("Unexpected return type for power levels");const i=r.getContent()||{},s=i.users_default||0,a=i.events_default||50,l=(null===(t=i.events)||void 0===t?void 0:t[o.EventType.RoomPowerLevels])||100,c=(null===(n=i.users)||void 0===n?void 0:n[e])||s;return c>=l?m.Owner:c>=a?m.Editor:m.Viewer}async createDirectory(e){const t=await this.client.unstableCreateFileTree(e);return await this.client.sendStateEvent(this.roomId,o.EventType.SpaceChild,{via:[this.client.getDomain()]},t.roomId),await this.client.sendStateEvent(t.roomId,o.EventType.SpaceParent,{via:[this.client.getDomain()]},this.roomId),t}getDirectories(){const e=[],t=this.room.currentState.getStateEvents(o.EventType.SpaceChild);for(const n of t)try{const t=n.getStateKey();if(t){const n=this.client.unstableGetFileTreeSpace(t);n&&e.push(n)}}catch(e){a.logger.warn("Unable to create tree space instance for listing. Are we joined?",e)}return e}getDirectory(e){return this.getDirectories().find((t=>t.roomId===e))}async delete(){const e=this.getDirectories();for(const t of e)await t.delete();const t=["invite","knock","join"],n=this.room.currentState.getStateEvents(o.EventType.RoomMember);for(const e of n)if(e.getStateKey()!==this.client.getUserId()&&t.includes(e.getContent().membership)){const t=e.getStateKey();if(!t)throw new Error("State key not found for branch");await this.client.kick(this.roomId,t,"Room deleted")}await this.client.leave(this.roomId)}getOrderedChildren(e){const t=e.map((e=>({roomId:e.getStateKey(),order:e.getContent().order}))).filter((e=>e.roomId));return t.sort(((e,t)=>{if(e.order&&!t.order)return-1;if(!e.order&&t.order)return 1;if(e.order||t.order)return(0,l.lexicographicCompare)(e.order,t.order);{var n,r,i,s;const a=this.client.getRoom(e.roomId),c=this.client.getRoom(t.roomId);if(!a||!c)return(0,l.lexicographicCompare)(e.roomId,t.roomId);const d=null!==(n=null===(r=a.currentState.getStateEvents(o.EventType.RoomCreate,""))||void 0===r?void 0:r.getTs())&&void 0!==n?n:0,u=null!==(i=null===(s=c.currentState.getStateEvents(o.EventType.RoomCreate,""))||void 0===s?void 0:s.getTs())&&void 0!==i?i:0;return d===u?(0,l.lexicographicCompare)(e.roomId,t.roomId):d-u}})),t}getParentRoom(){const e=this.room.currentState.getStateEvents(o.EventType.SpaceParent)[0];if(!e)throw new Error("Expected to have a parent in a non-top level space");const t=e.getStateKey();if(!t)throw new Error("No state key found for parent");const n=this.client.getRoom(t);if(!n)throw new Error("Unable to locate room for parent");return n}getOrder(){if(this.isTopLevel)return-1;const e=this.getParentRoom().currentState.getStateEvents(o.EventType.SpaceChild);return this.getOrderedChildren(e).findIndex((e=>e.roomId===this.roomId))}async setOrder(e){var t;if(this.isTopLevel)throw new Error("Cannot set order of top level spaces currently");const n=this.getParentRoom(),r=n.currentState.getStateEvents(o.EventType.SpaceChild),i=this.getOrderedChildren(r);e=Math.max(Math.min(e,i.length-1),0);const s=this.getOrder()<e;s&&e===i.length-1?e--:s||0!==e||e++;const a=i[s?e:e-1],c=i[s?e+1:e];let d=l.DEFAULT_ALPHABET[0],u=!1;if(a)if(e===i.length-1)null!=c&&c.order&&(d=(0,l.nextString)(c.order));else{const e=null==a?void 0:a.order,t=null==c?void 0:c.order;e&&t?d=e===t?(0,l.nextString)(e):(0,l.averageBetweenStrings)(e,t):e?d=(0,l.nextString)(e):t?d=(0,l.prevString)(t):u=!0}else null!=c&&c.order&&(d=(0,l.prevString)(c.order));if(u){let t;for(let r=0;r<=e;r++){const e=i[r];if(0===r&&(t=e.order),e.order)t=e.order;else{var p;t=t?(0,l.nextString)(t):l.DEFAULT_ALPHABET[0];const r=n.currentState.getStateEvents(o.EventType.SpaceChild,e.roomId),i=null!==(p=null==r?void 0:r.getContent())&&void 0!==p?p:{via:[this.client.getDomain()]};await this.client.sendStateEvent(n.roomId,o.EventType.SpaceChild,h(h({},i),{},{order:t}),e.roomId)}}t&&(d=(0,l.nextString)(t))}const m=n.currentState.getStateEvents(o.EventType.SpaceChild,this.roomId),g=null!==(t=null==m?void 0:m.getContent())&&void 0!==t?t:{via:[this.client.getDomain()]};await this.client.sendStateEvent(n.roomId,o.EventType.SpaceChild,h(h({},g),{},{order:d}),this.roomId)}async createFile(e,t,n,r){var i;const s=await this.client.uploadContent(t,{includeFilename:!1,onlyContentUri:!0,rawResponse:!1});n.url=s;const a={msgtype:o.MsgType.File,body:e,url:s,file:n};(r=null!==(i=r)&&void 0!==i?i:{})["m.new_content"]&&(r["m.new_content"]=a);const l=await this.client.sendMessage(this.roomId,h(h(h({},r),a),{},{[o.UNSTABLE_MSC3089_LEAF.name]:{}}));return await this.client.sendStateEvent(this.roomId,o.UNSTABLE_MSC3089_BRANCH.name,{active:!0,name:e},l.event_id),l}getFile(e){const t=this.room.currentState.getStateEvents(o.UNSTABLE_MSC3089_BRANCH.name,e);return t?new c.MSC3089Branch(this.client,t,this):null}listFiles(){return this.listAllFiles().filter((e=>e.isActive))}listAllFiles(){var e;return(null!==(e=this.room.currentState.getStateEvents(o.UNSTABLE_MSC3089_BRANCH.name))&&void 0!==e?e:[]).map((e=>new c.MSC3089Branch(this.client,e,this)))}}},3558:(e,t,n)=>{"use strict";var r=n(5318);Object.defineProperty(t,"__esModule",{value:!0}),t.EventContext=void 0;var i=r(n(9713)),s=n(8910);t.EventContext=class{constructor(e){(0,i.default)(this,"timeline",void 0),(0,i.default)(this,"ourEventIndex",0),(0,i.default)(this,"paginateTokens",{[s.Direction.Backward]:null,[s.Direction.Forward]:null}),this.timeline=[e]}getEvent(){return this.timeline[this.ourEventIndex]}getTimeline(){return this.timeline}getOurEventIndex(){return this.ourEventIndex}getPaginateToken(e=!1){return this.paginateTokens[e?s.Direction.Backward:s.Direction.Forward]}setPaginateToken(e,t=!1){this.paginateTokens[t?s.Direction.Backward:s.Direction.Forward]=e}addEvents(e,t=!1){t?(this.timeline=e.concat(this.timeline),this.ourEventIndex+=e.length):this.timeline=this.timeline.concat(e)}}},3705:(e,t,n)=>{"use strict";var r=n(5318);Object.defineProperty(t,"__esModule",{value:!0}),t.EventTimelineSet=t.DuplicateStrategy=void 0;var i=r(n(9713)),s=n(7187),o=n(8910),a=n(4369),l=n(7434),c=n(9690);let d,u;d=l.logger.log.bind(l.logger),t.DuplicateStrategy=u,function(e){e.Ignore="ignore",e.Replace="replace"}(u||(t.DuplicateStrategy=u={}));class h extends s.EventEmitter{constructor(e,t){super(),this.room=e,(0,i.default)(this,"timelineSupport",void 0),(0,i.default)(this,"unstableClientRelationAggregation",void 0),(0,i.default)(this,"displayPendingEvents",void 0),(0,i.default)(this,"liveTimeline",void 0),(0,i.default)(this,"timelines",void 0),(0,i.default)(this,"_eventIdToTimeline",void 0),(0,i.default)(this,"filter",void 0),(0,i.default)(this,"relations",void 0),this.timelineSupport=Boolean(t.timelineSupport),this.liveTimeline=new o.EventTimeline(this),this.unstableClientRelationAggregation=!!t.unstableClientRelationAggregation,this.displayPendingEvents=!1!==t.pendingEvents,this.timelines=[this.liveTimeline],this._eventIdToTimeline={},this.filter=t.filter,this.unstableClientRelationAggregation&&(this.relations={})}getTimelines(){return this.timelines}getFilter(){return this.filter}setFilter(e){this.filter=e}getPendingEvents(e){if(!this.room||!this.displayPendingEvents)return[];const t=this.room.getPendingEvents(e);return this.filter?this.filter.filterRoomTimeline(t):t}getLiveTimeline(){return this.liveTimeline}eventIdToTimeline(e){return this._eventIdToTimeline[e]}replaceEventId(e,t){const n=this._eventIdToTimeline[e];n&&(delete this._eventIdToTimeline[e],this._eventIdToTimeline[t]=n)}resetLiveTimeline(e,t){const n=!this.timelineSupport||!t,r=this.liveTimeline,i=n?r.forkLive(o.EventTimeline.FORWARDS):r.fork(o.EventTimeline.FORWARDS);n?(this.timelines=[i],this._eventIdToTimeline={}):this.timelines.push(i),t&&r.setPaginationToken(t,o.EventTimeline.FORWARDS),i.setPaginationToken(e,o.EventTimeline.BACKWARDS),this.liveTimeline=i,this.emit("Room.timelineReset",this.room,this,n)}getTimelineForEvent(e){const t=this._eventIdToTimeline[e];return void 0===t?null:t}findEventById(e){const t=this.getTimelineForEvent(e);if(t)return t.getEvents().find((function(t){return t.getId()==e}))}addTimeline(){if(!this.timelineSupport)throw new Error("timeline support is disabled. Set the 'timelineSupport' parameter to true when creating MatrixClient to enable it.");const e=new o.EventTimeline(this);return this.timelines.push(e),e}addEventsToTimeline(e,t,n,r){if(!n)throw new Error("'timeline' not specified for EventTimelineSet.addEventsToTimeline");if(!t&&n==this.liveTimeline)throw new Error("EventTimelineSet.addEventsToTimeline cannot be used for adding events to the live timeline - use Room.addLiveEvents instead");if(this.filter&&!(e=this.filter.filterRoomTimeline(e)).length)return;const i=t?o.EventTimeline.BACKWARDS:o.EventTimeline.FORWARDS,s=t?o.EventTimeline.FORWARDS:o.EventTimeline.BACKWARDS;let a=!1,c=!1;for(let r=0;r<e.length;r++){const u=e[r],h=u.getId(),p=this._eventIdToTimeline[h];if(!p){this.addEventToTimeline(u,n,t),c=!0,a=!0;continue}if(c=!1,p==n){d("Event "+h+" already in timeline "+n);continue}const m=n.getNeighbouringTimeline(i);if(m){d(p==m?"Event "+h+" in neighbouring timeline - switching to "+p:"Event "+h+" already in a different timeline "+p),n=p;continue}l.logger.info("Already have timeline for "+h+" - joining timeline "+n+" to "+p);const g=p===this.liveTimeline,f=n===this.liveTimeline,y=i===o.EventTimeline.BACKWARDS&&g,v=i===o.EventTimeline.FORWARDS&&f;y||v?(y&&l.logger.warn("Refusing to set a preceding existingTimeLine on our timeline as the existingTimeLine is live ("+p+")"),v&&l.logger.warn("Refusing to set our preceding timeline on a existingTimeLine as our timeline is live ("+n+")")):(n.setNeighbouringTimeline(p,i),p.setNeighbouringTimeline(n,s),n=p,a=!0)}if(c||!a){if(i===o.EventTimeline.FORWARDS&&n===this.liveTimeline)return l.logger.warn({lastEventWasNew:c,didUpdate:a}),void l.logger.warn(`Refusing to set forwards pagination token of live timeline ${n} to ${r}`);n.setPaginationToken(r,i)}}addLiveEvent(e,t=u.Ignore,n=!1,r){if(this.filter&&!this.filter.filterRoomTimeline([e]).length)return;const i=this._eventIdToTimeline[e.getId()];if(i)if(t===u.Replace){d("EventTimelineSet.addLiveEvent: replacing duplicate event "+e.getId());const t=i.getEvents();for(let n=0;n<t.length;n++)if(t[n].getId()===e.getId()){r||(r=i.getState(o.EventTimeline.FORWARDS)),o.EventTimeline.setEventMetadata(e,r,!1),t[n]=e;break}}else d("EventTimelineSet.addLiveEvent: ignoring duplicate event "+e.getId());else this.addEventToTimeline(e,this.liveTimeline,!1,n,r)}addEventToTimeline(e,t,n,r=!1,i){const s=e.getId();t.addEvent(e,n,i),this._eventIdToTimeline[s]=t,this.setRelationsTarget(e),this.aggregateRelations(e);const o={timeline:t,liveEvent:!n&&t==this.liveTimeline&&!r};this.emit("Room.timeline",e,this.room,Boolean(n),!1,o)}handleRemoteEcho(e,t,n){const r=this._eventIdToTimeline[t];r?(delete this._eventIdToTimeline[t],this._eventIdToTimeline[n]=r):this.filter?this.filter.filterRoomTimeline([e]).length&&this.addEventToTimeline(e,this.liveTimeline,!1):this.addEventToTimeline(e,this.liveTimeline,!1)}removeEvent(e){const t=this._eventIdToTimeline[e];if(!t)return null;const n=t.removeEvent(e);if(n){delete this._eventIdToTimeline[e];const r={timeline:t};this.emit("Room.timeline",n,this.room,void 0,!0,r)}return n}compareEventOrdering(e,t){if(e==t)return 0;const n=this._eventIdToTimeline[e],r=this._eventIdToTimeline[t];if(void 0===n)return null;if(void 0===r)return null;if(n===r){let r,i;const s=n.getEvents();for(let n=0;n<s.length&&(void 0===r||void 0===i);n++){const o=s[n].getId();o==e&&(r=n),o==t&&(i=n)}return r-i}let i=n;for(;i;){if(i===r)return-1;i=i.getNeighbouringTimeline(o.EventTimeline.FORWARDS)}for(i=n;i;){if(i===r)return 1;i=i.getNeighbouringTimeline(o.EventTimeline.BACKWARDS)}return null}getRelationsForEvent(e,t,n){if(!this.unstableClientRelationAggregation)throw new Error("Client-side relation aggregation is disabled");if(!e||!t||!n)throw new Error("Invalid arguments for `getRelationsForEvent`");return((this.relations[e]||{})[t]||{})[n]}setRelationsTarget(e){if(!this.unstableClientRelationAggregation)return;const t=this.relations[e.getId()];if(t)for(const n of Object.values(t))for(const t of Object.values(n))t.setTargetEvent(e)}aggregateRelations(e){if(!this.unstableClientRelationAggregation)return;if(e.isRedacted()||e.status===a.EventStatus.CANCELLED)return;if(e.isBeingDecrypted()||e.shouldAttemptDecryption())return void e.once("Event.decrypted",(()=>{this.aggregateRelations(e)}));const t=e.getRelation();if(!t)return;const n=t.event_id,r=t.rel_type,i=e.getType();let s=this.relations[n];s||(s=this.relations[n]={});let o=s[r];o||(o=s[r]={});let l,d=o[i];d||(d=o[i]=new c.Relations(r,i,this.room),l=this.findEventById(n)||this.room.getPendingEvent(n),l&&d.setTargetEvent(l)),d.addEvent(e)}}t.EventTimelineSet=h},8910:(e,t,n)=>{"use strict";var r=n(5318);Object.defineProperty(t,"__esModule",{value:!0}),t.EventTimeline=t.Direction=void 0;var i=r(n(9713)),s=n(6860),o=n(2481);let a;t.Direction=a,function(e){e.Backward="b",e.Forward="f"}(a||(t.Direction=a={}));class l{static setEventMetadata(e,t,n){var r,i,s,a;null!==(r=e.sender)&&void 0!==r&&null!==(i=r.events)&&void 0!==i&&i.member||(e.sender=t.getSentinelMember(e.getSender())),null!==(s=e.target)&&void 0!==s&&null!==(a=s.events)&&void 0!==a&&a.member||e.getType()!==o.EventType.RoomMember||(e.target=t.getSentinelMember(e.getStateKey())),e.isState()&&n&&(e.forwardLooking=!1)}constructor(e){var t,n;this.eventTimelineSet=e,(0,i.default)(this,"roomId",void 0),(0,i.default)(this,"name",void 0),(0,i.default)(this,"events",[]),(0,i.default)(this,"baseIndex",0),(0,i.default)(this,"startState",void 0),(0,i.default)(this,"endState",void 0),(0,i.default)(this,"prevTimeline",void 0),(0,i.default)(this,"nextTimeline",void 0),(0,i.default)(this,"paginationRequests",{[a.Backward]:null,[a.Forward]:null}),this.roomId=null!==(t=null===(n=e.room)||void 0===n?void 0:n.roomId)&&void 0!==t?t:null,this.startState=new s.RoomState(this.roomId),this.startState.paginationToken=null,this.endState=new s.RoomState(this.roomId),this.endState.paginationToken=null,this.prevTimeline=null,this.nextTimeline=null,this.paginationRequests={b:null,f:null},this.name=this.roomId+":"+(new Date).toISOString()}initialiseState(e){if(this.events.length>0)throw new Error("Cannot initialise state after events are added");for(const t of e)Object.freeze(t);this.startState.setStateEvents(e),this.endState.setStateEvents(e)}forkLive(e){const t=this.getState(e),n=new l(this.eventTimelineSet);return n.startState=t.clone(),n.endState=t,this.endState=t.clone(),n}fork(e){const t=this.getState(e),n=new l(this.eventTimelineSet);return n.startState=t.clone(),n.endState=t.clone(),n}getRoomId(){return this.roomId}getFilter(){return this.eventTimelineSet.getFilter()}getTimelineSet(){return this.eventTimelineSet}getBaseIndex(){return this.baseIndex}getEvents(){return this.events}getState(e){if(e==l.BACKWARDS)return this.startState;if(e==l.FORWARDS)return this.endState;throw new Error("Invalid direction '"+e+"'")}getPaginationToken(e){return this.getState(e).paginationToken}setPaginationToken(e,t){this.getState(t).paginationToken=e}getNeighbouringTimeline(e){if(e==l.BACKWARDS)return this.prevTimeline;if(e==l.FORWARDS)return this.nextTimeline;throw new Error("Invalid direction '"+e+"'")}setNeighbouringTimeline(e,t){if(this.getNeighbouringTimeline(t))throw new Error("timeline already has a neighbouring timeline - cannot reset neighbour (direction: "+t+")");if(t==l.BACKWARDS)this.prevTimeline=e;else{if(t!=l.FORWARDS)throw new Error("Invalid direction '"+t+"'");this.nextTimeline=e}this.setPaginationToken(null,t)}addEvent(e,t,n){n||(n=t?this.startState:this.endState);const r=this.getTimelineSet();let i;r.room&&(l.setEventMetadata(e,n,t),e.isState()&&r.room.getUnfilteredTimelineSet()===r&&(n.setStateEvents([e]),e.sender&&("m.room.member"!==e.getType()||t)||l.setEventMetadata(e,n,t))),i=t?0:this.events.length,this.events.splice(i,0,e),t&&this.baseIndex++}removeEvent(e){for(let t=this.events.length-1;t>=0;t--){const n=this.events[t];if(n.getId()==e)return this.events.splice(t,1),t<this.baseIndex&&this.baseIndex--,n}return null}toString(){return this.name}}t.EventTimeline=l,(0,i.default)(l,"BACKWARDS",a.Backward),(0,i.default)(l,"FORWARDS",a.Forward)},4369:(e,t,n)=>{"use strict";var r=n(5318);Object.defineProperty(t,"__esModule",{value:!0}),t.MatrixEvent=t.EventStatus=void 0;var i=r(n(9713)),s=n(7187),o=n(1333),a=n(7434),l=n(2481),c=n(3102),d=n(6969),u=n(771);let h;t.EventStatus=h,function(e){e.NOT_SENT="not_sent",e.ENCRYPTING="encrypting",e.SENDING="sending",e.QUEUED="queued",e.SENT="sent",e.CANCELLED="cancelled"}(h||(t.EventStatus=h={}));const p={};function m(e){return p[e]||(p[e]=e),p[e]}const g=Object.freeze({visible:!0});class f extends s.EventEmitter{constructor(e={}){var t;super(),this.event=e,(0,i.default)(this,"pushActions",null),(0,i.default)(this,"_replacingEvent",null),(0,i.default)(this,"_localRedactionEvent",null),(0,i.default)(this,"_isCancelled",!1),(0,i.default)(this,"clearEvent",void 0),(0,i.default)(this,"visibility",g),(0,i.default)(this,"_hasCachedExtEv",!1),(0,i.default)(this,"_cachedExtEv",void 0),(0,i.default)(this,"senderCurve25519Key",null),(0,i.default)(this,"claimedEd25519Key",null),(0,i.default)(this,"forwardingCurve25519KeyChain",[]),(0,i.default)(this,"untrusted",null),(0,i.default)(this,"_decryptionPromise",null),(0,i.default)(this,"retryDecryption",!1),(0,i.default)(this,"txnId",null),(0,i.default)(this,"thread",null),(0,i.default)(this,"threadId",void 0),(0,i.default)(this,"localTimestamp",void 0),(0,i.default)(this,"sender",null),(0,i.default)(this,"target",null),(0,i.default)(this,"status",null),(0,i.default)(this,"error",null),(0,i.default)(this,"forwardLooking",!0),(0,i.default)(this,"verificationRequest",null),(0,i.default)(this,"reEmitter",void 0),["state_key","type","sender","room_id","membership"].forEach((t=>{"string"==typeof e[t]&&(e[t]=m(e[t]))})),["membership","avatar_url","displayname"].forEach((t=>{var n;"string"==typeof(null===(n=e.content)||void 0===n?void 0:n[t])&&(e.content[t]=m(e.content[t]))})),["rel_type"].forEach((t=>{var n,r;"string"==typeof(null===(n=e.content)||void 0===n||null===(r=n["m.relates_to"])||void 0===r?void 0:r[t])&&(e.content["m.relates_to"][t]=m(e.content["m.relates_to"][t]))})),this.txnId=e.txn_id||null,this.localTimestamp=Date.now()-(null!==(t=this.getAge())&&void 0!==t?t:0),this.reEmitter=new u.ReEmitter(this)}get unstableExtensibleEvent(){return this._hasCachedExtEv||(this._cachedExtEv=o.ExtensibleEvents.parse(this.getEffectiveEvent())),this._cachedExtEv}invalidateExtensibleEvent(){this._hasCachedExtEv=!1}getEffectiveEvent(){const e=Object.assign({},this.getContent());if(this.getWireType()===l.EventType.RoomMessageEncrypted)for(const[t,n]of Object.entries(this.getWireContent()))["algorithm","ciphertext","device_id","sender_key","session_id"].includes(t)||void 0===e[t]&&(e[t]=n);return Object.assign({},this.event,this.clearEvent,{content:e})}getId(){return this.event.event_id}getSender(){return this.event.sender||this.event.user_id}getType(){return this.clearEvent?this.clearEvent.type:this.event.type}getWireType(){return this.event.type}getRoomId(){return this.event.room_id}getTs(){return this.event.origin_server_ts}getDate(){return this.event.origin_server_ts?new Date(this.event.origin_server_ts):null}getOriginalContent(){return this._localRedactionEvent?{}:this.clearEvent?this.clearEvent.content||{}:this.event.content||{}}getContent(){return this._localRedactionEvent?{}:this._replacingEvent?this._replacingEvent.getContent()["m.new_content"]||{}:this.getOriginalContent()}getWireContent(){return this.event.content||{}}get threadRootId(){var e;const t=null===(e=this.getWireContent())||void 0===e?void 0:e["m.relates_to"];return(null==t?void 0:t.rel_type)===l.RelationType.Thread?t.event_id:this.threadId||(null===(n=this.getThread())||void 0===n?void 0:n.id);var n}get isThreadRelation(){return!!this.threadRootId&&this.threadId!==this.getId()}get isThreadRoot(){var e;return!!this.getServerAggregatedRelation(l.RelationType.Thread)||(null===(e=this.getThread())||void 0===e?void 0:e.id)===this.getId()}get parentEventId(){return this.replyEventId||this.relationEventId}get replyEventId(){var e;const t=this.getContent()["m.relates_to"]||this.getWireContent()["m.relates_to"];return null==t||null===(e=t["m.in_reply_to"])||void 0===e?void 0:e.event_id}get relationEventId(){var e,t;return null===(e=this.getWireContent())||void 0===e||null===(t=e["m.relates_to"])||void 0===t?void 0:t.event_id}getPrevContent(){return this.getUnsigned().prev_content||this.event.prev_content||{}}getDirectionalContent(){return this.forwardLooking?this.getContent():this.getPrevContent()}getAge(){return this.getUnsigned().age||this.event.age}getLocalAge(){return Date.now()-this.localTimestamp}getStateKey(){return this.event.state_key}isState(){return void 0!==this.event.state_key}makeEncrypted(e,t,n,r){this.clearEvent={type:this.event.type,content:this.event.content},this.event.type=e,this.event.content=t,this.senderCurve25519Key=n,this.claimedEd25519Key=r}isBeingDecrypted(){return null!=this._decryptionPromise}getDecryptionPromise(){return this._decryptionPromise}isDecryptionFailure(){var e,t;return"m.bad.encrypted"===(null===(e=this.clearEvent)||void 0===e||null===(t=e.content)||void 0===t?void 0:t.msgtype)}shouldAttemptDecryption(){return!(this.isRedacted()||this.isBeingDecrypted()||this.clearEvent||!this.isEncrypted())}async attemptDecryption(e,t={}){if("boolean"==typeof t&&(t={isRetry:t}),!this.isEncrypted())throw new Error("Attempt to decrypt event which isn't encrypted");if(this.clearEvent&&!this.isDecryptionFailure())throw new Error("Attempt to decrypt event which has already been decrypted");return this._decryptionPromise?(a.logger.log(`Event ${this.getId()} already being decrypted; queueing a retry`),this.retryDecryption=!0,this._decryptionPromise):(this._decryptionPromise=this.decryptionLoop(e,t),this._decryptionPromise)}cancelAndResendKeyRequest(e,t){const n=this.getWireContent();return e.requestRoomKey({algorithm:n.algorithm,room_id:this.getRoomId(),session_id:n.session_id,sender_key:n.sender_key},this.getKeyRequestRecipients(t),!0)}getKeyRequestRecipients(e){const t=this.getWireContent(),n=[{userId:e,deviceId:"*"}],r=this.getSender();return r!==e&&n.push({userId:r,deviceId:t.device_id}),n}async decryptionLoop(e,t={}){for(await Promise.resolve();;){let n,r;this.retryDecryption=!1;try{e?(n=await e.decryptEvent(this),!0===t.isRetry&&a.logger.info(`Decrypted event on retry (id=${this.getId()})`)):n=this.badEncryptedMessage("Encryption not enabled")}catch(e){if("DecryptionError"!==e.name){const n=t.isRetry?"re":"";return a.logger.error(`Error ${n}decrypting event (id=${this.getId()}): ${e.stack||e}`),this._decryptionPromise=null,void(this.retryDecryption=!1)}if(r=e,this.retryDecryption){a.logger.log(`Got error decrypting event (id=${this.getId()}: ${e}), but retrying`);continue}a.logger.warn(`Error decrypting event (id=${this.getId()}): ${e.detailedString}`),n=this.badEncryptedMessage(e.message)}return this._decryptionPromise=null,this.retryDecryption=!1,this.setClearData(n),this.setPushActions(null),void(!1!==t.emit&&this.emit("Event.decrypted",this,r))}}badEncryptedMessage(e){return{clearEvent:{type:l.EventType.RoomMessage,content:{msgtype:"m.bad.encrypted",body:"** Unable to decrypt: "+e+" **"}}}}setClearData(e){this.clearEvent=e.clearEvent,this.senderCurve25519Key=e.senderCurve25519Key||null,this.claimedEd25519Key=e.claimedEd25519Key||null,this.forwardingCurve25519KeyChain=e.forwardingCurve25519KeyChain||[],this.untrusted=e.untrusted||!1,this.invalidateExtensibleEvent()}getClearContent(){return this.clearEvent?this.clearEvent.content:null}isEncrypted(){return!this.isState()&&this.event.type===l.EventType.RoomMessageEncrypted}getSenderKey(){return this.senderCurve25519Key}getKeysClaimed(){return{ed25519:this.claimedEd25519Key}}getClaimedEd25519Key(){return this.claimedEd25519Key}getForwardingCurve25519KeyChain(){return this.forwardingCurve25519KeyChain}isKeySourceUntrusted(){return this.untrusted}getUnsigned(){return this.event.unsigned||{}}setUnsigned(e){this.event.unsigned=e}unmarkLocallyRedacted(){const e=this._localRedactionEvent;return this._localRedactionEvent=null,this.event.unsigned&&(this.event.unsigned.redacted_because=null),!!e}markLocallyRedacted(e){this._localRedactionEvent||(this.emit("Event.beforeRedaction",this,e),this._localRedactionEvent=e,this.event.unsigned||(this.event.unsigned={}),this.event.unsigned.redacted_because=e.event)}applyVisibilityEvent(e){const t=!e||e.visible,n=e?e.reason:null;let r=!1;this.visibility.visible!==e.visible?r=!0:this.visibility.visible||this.visibility.reason===n||(r=!0),r&&(this.visibility=t?g:Object.freeze({visible:!1,reason:n}),r&&this.emit("Event.visibilityChange",this,t))}messageVisibility(){return this.visibility}makeRedacted(e){if(!e.event)throw new Error("invalid redactionEvent in makeRedacted");let t;for(t in this._localRedactionEvent=null,this.emit("Event.beforeRedaction",this,e),this._replacingEvent=null,this.event.unsigned||(this.event.unsigned={}),this.event.unsigned.redacted_because=e.event,this.event)this.event.hasOwnProperty(t)&&(y.has(t)||delete this.event[t]);const n=v[this.getType()]||{},r=this.getContent();for(t in r)r.hasOwnProperty(t)&&(n[t]||delete r[t]);this.invalidateExtensibleEvent()}isRedacted(){return Boolean(this.getUnsigned().redacted_because)}isRedaction(){return this.getType()===l.EventType.RoomRedaction}asVisibilityChange(){if(!l.EVENT_VISIBILITY_CHANGE_TYPE.matches(this.getType()))return null;const e=this.getRelation();if(!e||"m.reference"!=e.rel_type)return null;const t=e.event_id;if(!t)return null;const n=this.getWireContent(),r=!!n.visible,i=n.reason;return i&&"string"!=typeof i?null:{visible:r,reason:i,eventId:t}}isVisibilityEvent(){return l.EVENT_VISIBILITY_CHANGE_TYPE.matches(this.getType())}getRedactionEvent(){var e,t;return this.isRedacted()?null!==(e=this.clearEvent)&&void 0!==e&&e.unsigned?null===(t=this.clearEvent)||void 0===t?void 0:t.unsigned.redacted_because:this.event.unsigned.redacted_because?this.event.unsigned.redacted_because:{}:null}getPushActions(){return this.pushActions}setPushActions(e){this.pushActions=e}handleRemoteEcho(e){const t=this.getUnsigned(),n=this.getId();this.event=e,t.redacted_because&&(this.event.unsigned||(this.event.unsigned={}),this.event.unsigned.redacted_because=t.redacted_because),this.setStatus(null),this.getId()!==n&&this.emit("Event.localEventIdReplaced",this),this.localTimestamp=Date.now()-this.getAge()}isSending(){return!!this.status}setStatus(e){this.status=e,this.emit("Event.status",this,e)}replaceLocalEventId(e){this.event.event_id=e,this.emit("Event.localEventIdReplaced",this)}isRelation(e){const t=this.getWireContent(),n=t&&t["m.relates_to"];return n&&n.rel_type&&n.event_id&&(e&&n.rel_type===e||!e)}getRelation(){return this.isRelation()?this.getWireContent()["m.relates_to"]:null}makeReplaced(e){this.isRedacted()&&e||this._replacingEvent!==e&&(this._replacingEvent=e,this.emit("Event.replaced",this),this.invalidateExtensibleEvent())}getAssociatedStatus(){return this._replacingEvent?this._replacingEvent.status:this._localRedactionEvent?this._localRedactionEvent.status:this.status}getServerAggregatedRelation(e){var t;return null===(t=this.getUnsigned()["m.relations"])||void 0===t?void 0:t[e]}replacingEventId(){const e=this.getServerAggregatedRelation(l.RelationType.Replace);return e?e.event_id:this._replacingEvent?this._replacingEvent.getId():void 0}replacingEvent(){return this._replacingEvent}replacingEventDate(){const e=this.getServerAggregatedRelation(l.RelationType.Replace);if(e){const t=e.origin_server_ts;if(Number.isFinite(t))return new Date(t)}else if(this._replacingEvent)return this._replacingEvent.getDate()}localRedactionEvent(){return this._localRedactionEvent}getAssociatedId(){const e=this.getRelation();return e?e.event_id:this.isRedaction()?this.event.redacts:void 0}hasAssocation(){return!!this.getAssociatedId()}updateAssociatedId(e){const t=this.getRelation();t?t.event_id=e:this.isRedaction()&&(this.event.redacts=e)}flagCancelled(e=!0){this._isCancelled=e}isCancelled(){return this._isCancelled}toSnapshot(){const e=new f(JSON.parse(JSON.stringify(this.event)));for(const[t,n]of Object.entries(this))"event"!==t&&(e[t]=n);return e}isEquivalentTo(e){if(!e)return!1;if(e===this)return!0;const t=(0,c.deepSortedObjectEntries)(this.event),n=(0,c.deepSortedObjectEntries)(e.event);return JSON.stringify(t)===JSON.stringify(n)}toJSON(){const e=this.getEffectiveEvent();return this.isEncrypted()?{decrypted:e,encrypted:this.event}:e}setVerificationRequest(e){this.verificationRequest=e}setTxnId(e){this.txnId=e}getTxnId(){return this.txnId}setThread(e){this.thread=e,this.reEmitter.reEmit(e,[d.ThreadEvent.Ready,d.ThreadEvent.Update])}getThread(){return this.thread}setThreadId(e){this.threadId=e}}t.MatrixEvent=f;const y=new Set(["event_id","type","room_id","user_id","sender","state_key","prev_state","content","unsigned","origin_server_ts"]),v={[l.EventType.RoomMember]:{membership:1},[l.EventType.RoomCreate]:{creator:1},[l.EventType.RoomJoinRules]:{join_rule:1},[l.EventType.RoomPowerLevels]:{ban:1,events:1,events_default:1,kick:1,redact:1,state_default:1,users:1,users_default:1},[l.EventType.RoomAliases]:{aliases:1}}},142:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Group=s;var r=n(7187);function i(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(i=function(e){return e?n:t})(e)}function s(e){this.groupId=e,this.name=null,this.avatarUrl=null,this.myMembership=null,this.inviter=null}(function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var n=i(t);if(n&&n.has(e))return n.get(e);var r={},s=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e)if("default"!==o&&Object.prototype.hasOwnProperty.call(e,o)){var a=s?Object.getOwnPropertyDescriptor(e,o):null;a&&(a.get||a.set)?Object.defineProperty(r,o,a):r[o]=e[o]}return r.default=e,n&&n.set(e,r),r})(n(3102)).inherits(s,r.EventEmitter),s.prototype.setProfile=function(e,t){this.name===e&&this.avatarUrl===t||(this.name=e||this.groupId,this.avatarUrl=t,this.emit("Group.profile",this))},s.prototype.setMyMembership=function(e){this.myMembership!==e&&(this.myMembership=e,this.emit("Group.myMembership",this))},s.prototype.setInviter=function(e){this.inviter=e}},9690:(e,t,n)=>{"use strict";var r=n(5318);Object.defineProperty(t,"__esModule",{value:!0}),t.Relations=void 0;var i=r(n(9713)),s=n(7187),o=n(4369),a=n(7434),l=n(2481);class c extends s.EventEmitter{constructor(e,t,n){super(),this.relationType=e,this.eventType=t,this.room=n,(0,i.default)(this,"relationEventIds",new Set),(0,i.default)(this,"relations",new Set),(0,i.default)(this,"annotationsByKey",{}),(0,i.default)(this,"annotationsBySender",{}),(0,i.default)(this,"sortedAnnotationsByKey",[]),(0,i.default)(this,"targetEvent",null),(0,i.default)(this,"creationEmitted",!1),(0,i.default)(this,"onEventStatus",((e,t)=>{e.isSending()?t===o.EventStatus.CANCELLED&&(e.removeListener("Event.status",this.onEventStatus),this.removeEvent(e)):e.removeListener("Event.status",this.onEventStatus)})),(0,i.default)(this,"onBeforeRedaction",(async e=>{if(this.relations.has(e)){if(this.relations.delete(e),this.relationType===l.RelationType.Annotation)this.removeAnnotationFromAggregation(e);else if(this.relationType===l.RelationType.Replace&&this.targetEvent){const e=await this.getLastReplacement();this.targetEvent.makeReplaced(e)}e.removeListener("Event.beforeRedaction",this.onBeforeRedaction),this.emit("Relations.redaction",e)}}))}async addEvent(e){if(this.relationEventIds.has(e.getId()))return;const t=e.getRelation();if(!t)return void a.logger.error("Event must have relation info");const n=t.rel_type,r=e.getType();if(this.relationType===n&&this.eventType===r){if(e.isSending()&&e.on("Event.status",this.onEventStatus),this.relations.add(e),this.relationEventIds.add(e.getId()),this.relationType===l.RelationType.Annotation)this.addAnnotationToAggregation(e);else if(this.relationType===l.RelationType.Replace&&this.targetEvent){const e=await this.getLastReplacement();this.targetEvent.makeReplaced(e)}e.on("Event.beforeRedaction",this.onBeforeRedaction),this.emit("Relations.add",e),this.maybeEmitCreated()}else a.logger.error("Event relation info doesn't match this container")}async removeEvent(e){if(!this.relations.has(e))return;const t=e.getRelation();if(!t)return void a.logger.error("Event must have relation info");const n=t.rel_type,r=e.getType();if(this.relationType===n&&this.eventType===r){if(this.relations.delete(e),this.relationType===l.RelationType.Annotation)this.removeAnnotationFromAggregation(e);else if(this.relationType===l.RelationType.Replace&&this.targetEvent){const e=await this.getLastReplacement();this.targetEvent.makeReplaced(e)}this.emit("Relations.remove",e)}else a.logger.error("Event relation info doesn't match this container")}getRelations(){return[...this.relations]}addAnnotationToAggregation(e){const{key:t}=e.getRelation();if(!t)return;let n=this.annotationsByKey[t];n||(n=this.annotationsByKey[t]=new Set,this.sortedAnnotationsByKey.push([t,n])),n.add(e),this.sortedAnnotationsByKey.sort(((e,t)=>{const n=e[1];return t[1].size-n.size}));const r=e.getSender();let i=this.annotationsBySender[r];i||(i=this.annotationsBySender[r]=new Set),i.add(e)}removeAnnotationFromAggregation(e){const{key:t}=e.getRelation();if(!t)return;const n=this.annotationsByKey[t];n&&(n.delete(e),this.sortedAnnotationsByKey.sort(((e,t)=>{const n=e[1];return t[1].size-n.size})));const r=e.getSender(),i=this.annotationsBySender[r];i&&i.delete(e)}getSortedAnnotationsByKey(){return this.relationType!==l.RelationType.Annotation?null:this.sortedAnnotationsByKey}getAnnotationsBySender(){return this.relationType!==l.RelationType.Annotation?null:this.annotationsBySender}async getLastReplacement(){if(this.relationType!==l.RelationType.Replace)return null;if(!this.targetEvent)return null;const e=this.targetEvent.getServerAggregatedRelation(l.RelationType.Replace),t=e&&e.origin_server_ts,n=this.getRelations().reduce(((e,n)=>n.getSender()!==this.targetEvent.getSender()||t&&t>n.getTs()||e&&e.getTs()>n.getTs()?e:n),null);return null!=n&&n.shouldAttemptDecryption()?await n.attemptDecryption(this.room.client.crypto):null!=n&&n.isBeingDecrypted()&&await n.getDecryptionPromise(),n}async setTargetEvent(e){if(!this.targetEvent){if(this.targetEvent=e,this.relationType===l.RelationType.Replace){const e=await this.getLastReplacement();e&&this.targetEvent.makeReplaced(e)}this.maybeEmitCreated()}}maybeEmitCreated(){this.creationEmitted||this.targetEvent&&this.relations.size&&(this.creationEmitted=!0,this.targetEvent.emit("Event.relationsCreated",this.relationType,this.eventType))}}t.Relations=c},2848:(e,t,n)=>{"use strict";var r=n(5318);Object.defineProperty(t,"__esModule",{value:!0}),t.RoomMember=void 0;var i=r(n(9713)),s=n(7187),o=n(3667),a=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var n=l(t);if(n&&n.has(e))return n.get(e);var r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var s in e)if("default"!==s&&Object.prototype.hasOwnProperty.call(e,s)){var o=i?Object.getOwnPropertyDescriptor(e,s):null;o&&(o.get||o.set)?Object.defineProperty(r,s,o):r[s]=e[s]}return r.default=e,n&&n.set(e,r),r}(n(3102));function l(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(l=function(e){return e?n:t})(e)}class c extends s.EventEmitter{constructor(e,t){super(),this.roomId=e,this.userId=t,(0,i.default)(this,"_isOutOfBand",!1),(0,i.default)(this,"_modified",void 0),(0,i.default)(this,"_requestedProfileInfo",void 0),(0,i.default)(this,"typing",!1),(0,i.default)(this,"name",void 0),(0,i.default)(this,"rawDisplayName",void 0),(0,i.default)(this,"powerLevel",0),(0,i.default)(this,"powerLevelNorm",0),(0,i.default)(this,"user",null),(0,i.default)(this,"membership",null),(0,i.default)(this,"disambiguate",!1),(0,i.default)(this,"events",{member:null}),this.name=t,this.rawDisplayName=t,this.updateModifiedTime()}markOutOfBand(){this._isOutOfBand=!0}isOutOfBand(){return this._isOutOfBand}setMembershipEvent(e,t){const n=e.getDirectionalContent().displayname;if("m.room.member"!==e.getType())return;this._isOutOfBand=!1,this.events.member=e;const r=this.membership;this.membership=e.getDirectionalContent().membership,this.disambiguate=function(e,t,n){return!(!t||t===e)&&(!!a.removeHiddenChars(t)&&(!!n&&(!!d.test(t)||(!!u.test(t)||!!n.getUserIdsWithDisplayName(t).some((t=>t!==e))))))}(this.userId,n,t);const i=this.name;this.name=function(e,t,n,r){return r?a.removeDirectionOverrideChars(t)+" ("+e+")":t&&t!==e&&a.removeHiddenChars(t)?a.removeDirectionOverrideChars(t):e}(this.userId,n,0,this.disambiguate),this.rawDisplayName=a.removeDirectionOverrideChars(e.getDirectionalContent().displayname),this.rawDisplayName&&a.removeHiddenChars(this.rawDisplayName)||(this.rawDisplayName=this.userId),r!==this.membership&&(this.updateModifiedTime(),this.emit("RoomMember.membership",e,this,r)),i!==this.name&&(this.updateModifiedTime(),this.emit("RoomMember.name",e,this,i))}setPowerLevelEvent(e){if("m.room.power_levels"!==e.getType())return;const t=e.getDirectionalContent();let n=t.users_default||0;const r=t.users||{};Object.values(r).forEach((function(e){n=Math.max(n,e)}));const i=this.powerLevel,s=this.powerLevelNorm;void 0!==r[this.userId]&&Number.isInteger(r[this.userId])?this.powerLevel=r[this.userId]:void 0!==t.users_default?this.powerLevel=t.users_default:this.powerLevel=0,this.powerLevelNorm=0,n>0&&(this.powerLevelNorm=100*this.powerLevel/n),i===this.powerLevel&&s===this.powerLevelNorm||(this.updateModifiedTime(),this.emit("RoomMember.powerLevel",e,this))}setTypingEvent(e){if("m.typing"!==e.getType())return;const t=this.typing;this.typing=!1;const n=e.getContent().user_ids;Array.isArray(n)&&(-1!==n.indexOf(this.userId)&&(this.typing=!0),t!==this.typing&&(this.updateModifiedTime(),this.emit("RoomMember.typing",e,this)))}updateModifiedTime(){this._modified=Date.now()}getLastModifiedTime(){return this._modified}isKicked(){return"leave"===this.membership&&this.events.member.getSender()!==this.events.member.getStateKey()}getDMInviter(){if(this.events.member){const e=this.events.member;let t=e.getContent(),n=e.getSender();if("join"===t.membership&&(t=e.getPrevContent(),n=e.getUnsigned().prev_sender),"invite"===t.membership&&t.is_direct)return n}}getAvatarUrl(e,t,n,r,i=!0,s){const a=this.getMxcAvatarUrl();if(!a&&!i)return null;return(0,o.getHttpUriForMxc)(e,a,t,n,r,s)||null}getMxcAvatarUrl(){return this.events.member?this.events.member.getDirectionalContent().avatar_url:this.user?this.user.avatarUrl:null}}t.RoomMember=c;const d=/@.+:.+/,u=/[\u200E\u200F\u202A-\u202F]/},6860:(e,t,n)=>{"use strict";var r=n(5318);Object.defineProperty(t,"__esModule",{value:!0}),t.RoomState=void 0;var i,s=r(n(9713)),o=n(7187),a=n(2848),l=n(7434),c=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var n=h(t);if(n&&n.has(e))return n.get(e);var r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var s in e)if("default"!==s&&Object.prototype.hasOwnProperty.call(e,s)){var o=i?Object.getOwnPropertyDescriptor(e,s):null;o&&(o.get||o.set)?Object.defineProperty(r,s,o):r[s]=e[s]}return r.default=e,n&&n.set(e,r),r}(n(3102)),d=n(2481),u=n(4702);function h(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(h=function(e){return e?n:t})(e)}!function(e){e[e.NotStarted=0]="NotStarted",e[e.InProgress=1]="InProgress",e[e.Finished=2]="Finished"}(i||(i={}));class p extends o.EventEmitter{constructor(e,t={status:i.NotStarted}){super(),this.roomId=e,this.oobMemberFlags=t,(0,s.default)(this,"sentinels",{}),(0,s.default)(this,"displayNameToUserIds",{}),(0,s.default)(this,"userIdsToDisplayNames",{}),(0,s.default)(this,"tokenToInvite",{}),(0,s.default)(this,"joinedMemberCount",null),(0,s.default)(this,"summaryJoinedMemberCount",null),(0,s.default)(this,"invitedMemberCount",null),(0,s.default)(this,"summaryInvitedMemberCount",null),(0,s.default)(this,"modified",void 0),(0,s.default)(this,"members",{}),(0,s.default)(this,"events",new Map),(0,s.default)(this,"paginationToken",null),this.updateModifiedTime()}getJoinedMemberCount(){return null!==this.summaryJoinedMemberCount?this.summaryJoinedMemberCount:(null===this.joinedMemberCount&&(this.joinedMemberCount=this.getMembers().reduce(((e,t)=>"join"===t.membership?e+1:e),0)),this.joinedMemberCount)}setJoinedMemberCount(e){this.summaryJoinedMemberCount=e}getInvitedMemberCount(){return null!==this.summaryInvitedMemberCount?this.summaryInvitedMemberCount:(null===this.invitedMemberCount&&(this.invitedMemberCount=this.getMembers().reduce(((e,t)=>"invite"===t.membership?e+1:e),0)),this.invitedMemberCount)}setInvitedMemberCount(e){this.summaryInvitedMemberCount=e}getMembers(){return Object.values(this.members)}getMembersExcept(e){return this.getMembers().filter((t=>!e.includes(t.userId)))}getMember(e){return this.members[e]||null}getSentinelMember(e){if(!e)return null;let t=this.sentinels[e];if(void 0===t){t=new a.RoomMember(this.roomId,e);const n=this.members[e];n&&t.setMembershipEvent(n.events.member,this),this.sentinels[e]=t}return t}getStateEvents(e,t){if(!this.events.has(e))return void 0===t?[]:null;if(void 0===t)return Array.from(this.events.get(e).values());return this.events.get(e).get(t)||null}clone(){const e=new p(this.roomId,this.oobMemberFlags),t=this.oobMemberFlags.status;return this.oobMemberFlags.status=i.NotStarted,Array.from(this.events.values()).forEach((t=>{e.setStateEvents(Array.from(t.values()))})),this.oobMemberFlags.status=t,null!==this.summaryInvitedMemberCount&&e.setInvitedMemberCount(this.getInvitedMemberCount()),null!==this.summaryJoinedMemberCount&&e.setJoinedMemberCount(this.getJoinedMemberCount()),this.oobMemberFlags.status==i.Finished&&this.getMembers().forEach((t=>{t.isOutOfBand()&&e.getMember(t.userId).markOutOfBand()})),e}setUnknownStateEvents(e){const t=e.filter((e=>!this.events.has(e.getType())||!this.events.get(e.getType()).has(e.getStateKey())));this.setStateEvents(t)}setStateEvents(e){this.updateModifiedTime(),e.forEach((e=>{if(e.getRoomId()!==this.roomId)return;if(!e.isState())return;const t=this.getStateEventMatching(e);this.setStateEvent(e),e.getType()===d.EventType.RoomMember&&(this.updateDisplayNameCache(e.getStateKey(),e.getContent().displayname),this.updateThirdPartyTokenCache(e)),this.emit("RoomState.events",e,this,t)})),e.forEach((e=>{if(e.getRoomId()===this.roomId&&e.isState())if(e.getType()===d.EventType.RoomMember){const t=e.getStateKey();"leave"!==e.getContent().membership&&"ban"!==e.getContent().membership||(e.getContent().avatar_url=e.getContent().avatar_url||e.getPrevContent().avatar_url,e.getContent().displayname=e.getContent().displayname||e.getPrevContent().displayname);const n=this.getOrCreateMember(t,e);n.setMembershipEvent(e,this),this.updateMember(n),this.emit("RoomState.members",e,this,n)}else if(e.getType()===d.EventType.RoomPowerLevels){if(""!==e.getStateKey())return;Object.values(this.members).forEach((t=>{const n=t.getLastModifiedTime();t.setPowerLevelEvent(e),n!==t.getLastModifiedTime()&&this.emit("RoomState.members",e,this,t)})),this.sentinels={}}}))}getOrCreateMember(e,t){let n=this.members[e];return n||(n=new a.RoomMember(this.roomId,e),this.members[e]=n,this.emit("RoomState.newMember",t,this,n)),n}setStateEvent(e){this.events.has(e.getType())||this.events.set(e.getType(),new Map),this.events.get(e.getType()).set(e.getStateKey(),e)}getStateEventMatching(e){return this.events.has(e.getType())?this.events.get(e.getType()).get(e.getStateKey()):null}updateMember(e){const t=this.getStateEvents(d.EventType.RoomPowerLevels,"");t&&e.setPowerLevelEvent(t),delete this.sentinels[e.userId],this.members[e.userId]=e,this.joinedMemberCount=null,this.invitedMemberCount=null}needsOutOfBandMembers(){return this.oobMemberFlags.status===i.NotStarted}markOutOfBandMembersStarted(){this.oobMemberFlags.status===i.NotStarted&&(this.oobMemberFlags.status=i.InProgress)}markOutOfBandMembersFailed(){this.oobMemberFlags.status===i.InProgress&&(this.oobMemberFlags.status=i.NotStarted)}clearOutOfBandMembers(){let e=0;Object.keys(this.members).forEach((t=>{this.members[t].isOutOfBand()&&(++e,delete this.members[t])})),l.logger.log(`LL: RoomState removed ${e} members...`),this.oobMemberFlags.status=i.NotStarted}setOutOfBandMembers(e){l.logger.log(`LL: RoomState about to set ${e.length} OOB members ...`),this.oobMemberFlags.status===i.InProgress&&(l.logger.log("LL: RoomState put in finished state ..."),this.oobMemberFlags.status=i.Finished,e.forEach((e=>this.setOutOfBandMember(e))))}setOutOfBandMember(e){if(e.getType()!==d.EventType.RoomMember)return;const t=e.getStateKey(),n=this.getMember(t);if(n&&!n.isOutOfBand())return;const r=this.getOrCreateMember(t,e);r.setMembershipEvent(e,this),r.markOutOfBand(),this.updateDisplayNameCache(r.userId,r.name),this.setStateEvent(e),this.updateMember(r),this.emit("RoomState.members",e,this,r)}setTypingEvent(e){Object.values(this.members).forEach((function(t){t.setTypingEvent(e)}))}getInviteForThreePidToken(e){return this.tokenToInvite[e]||null}updateModifiedTime(){this.modified=Date.now()}getLastModifiedTime(){return this.modified}getUserIdsWithDisplayName(e){return this.displayNameToUserIds[c.removeHiddenChars(e)]||[]}maySendRedactionForEvent(e,t){const n=this.getMember(t);if(!n||"leave"===n.membership)return!1;if(e.status||e.isRedacted())return!1;const r=this.maySendEvent(d.EventType.RoomRedaction,t);return e.getSender()===t?r:this.hasSufficientPowerLevelFor("redact",n.powerLevel)}hasSufficientPowerLevelFor(e,t){const n=this.getStateEvents(d.EventType.RoomPowerLevels,"");let r={};n&&(r=n.getContent());let i=50;return c.isNumber(r[e])&&(i=r[e]),t>=i}maySendMessage(e){return this.maySendEventOfType(d.EventType.RoomMessage,e,!1)}maySendEvent(e,t){return this.maySendEventOfType(e,t,!1)}mayClientSendStateEvent(e,t){return!t.isGuest()&&this.maySendStateEvent(e,t.credentials.userId)}maySendStateEvent(e,t){return this.maySendEventOfType(e,t,!0)}maySendEventOfType(e,t,n){const r=this.getStateEvents(d.EventType.RoomPowerLevels,"");let i,s={},o=0,a=0,l=0;if(r){i=r.getContent(),s=i.events||{},o=Number.isSafeInteger(i.state_default)?i.state_default:50;const e=i.users&&i.users[t];Number.isSafeInteger(e)?l=e:Number.isSafeInteger(i.users_default)&&(l=i.users_default),Number.isSafeInteger(i.events_default)&&(a=i.events_default)}let c=n?o:a;return Number.isSafeInteger(s[e])&&(c=s[e]),l>=c}mayTriggerNotifOfType(e,t){const n=this.getMember(t);if(!n)return!1;const r=this.getStateEvents(d.EventType.RoomPowerLevels,"");let i=50;return r&&r.getContent()&&r.getContent().notifications&&c.isNumber(r.getContent().notifications[e])&&(i=r.getContent().notifications[e]),n.powerLevel>=i}getJoinRule(){var e;const t=this.getStateEvents(d.EventType.RoomJoinRules,"");return(null!==(e=null==t?void 0:t.getContent())&&void 0!==e?e:{}).join_rule||u.JoinRule.Invite}getHistoryVisibility(){var e;const t=this.getStateEvents(d.EventType.RoomHistoryVisibility,"");return(null!==(e=null==t?void 0:t.getContent())&&void 0!==e?e:{}).history_visibility||u.HistoryVisibility.Shared}getGuestAccess(){var e;const t=this.getStateEvents(d.EventType.RoomGuestAccess,"");return(null!==(e=null==t?void 0:t.getContent())&&void 0!==e?e:{}).guest_access||u.GuestAccess.Forbidden}updateThirdPartyTokenCache(e){if(!e.getContent().third_party_invite)return;const t=(e.getContent().third_party_invite.signed||{}).token;t&&this.getStateEvents(d.EventType.RoomThirdPartyInvite,t)&&(this.tokenToInvite[t]=e)}updateDisplayNameCache(e,t){const n=this.userIdsToDisplayNames[e];if(delete this.userIdsToDisplayNames[e],n){const t=c.removeHiddenChars(n),r=this.displayNameToUserIds[t];if(r){const n=r.filter((t=>t!==e));this.displayNameToUserIds[t]=n}}this.userIdsToDisplayNames[e]=t;const r=t&&c.removeHiddenChars(t);r&&(this.displayNameToUserIds[r]||(this.displayNameToUserIds[r]=[]),this.displayNameToUserIds[r].push(e))}}t.RoomState=p},5205:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.RoomSummary=void 0,t.RoomSummary=class{constructor(e,t){this.roomId=e}}},7366:(e,t,n)=>{"use strict";var r=n(5318);Object.defineProperty(t,"__esModule",{value:!0}),t.Room=t.NotificationCountType=void 0;var i=r(n(9713)),s=n(7187),o=n(3705),a=n(8910),l=n(3667),c=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var n=b(t);if(n&&n.has(e))return n.get(e);var r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var s in e)if("default"!==s&&Object.prototype.hasOwnProperty.call(e,s)){var o=i?Object.getOwnPropertyDescriptor(e,s):null;o&&(o.get||o.set)?Object.defineProperty(r,s,o):r[s]=e[s]}return r.default=e,n&&n.set(e,r),r}(n(3102)),d=n(4369),u=n(2848),h=n(5205),p=n(7434),m=n(771),g=n(2481),f=n(2168),y=n(6969),v=n(7715);function b(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(b=function(e){return e?n:t})(e)}function w(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function S(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?w(Object(n),!0).forEach((function(t){(0,i.default)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):w(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}const _=["1","2","3","4","5","6"];function k(e,t,n){return new d.MatrixEvent({content:{[t.getId()]:{[n]:{[e]:{ts:t.getTs()}}}},type:"m.receipt",room_id:t.getRoomId()})}let x;t.NotificationCountType=x,function(e){e.Highlight="highlight",e.Total="total"}(x||(t.NotificationCountType=x={}));class E extends s.EventEmitter{constructor(e,t,n,r={}){if(super(),this.roomId=e,this.client=t,this.myUserId=n,this.opts=r,(0,i.default)(this,"reEmitter",void 0),(0,i.default)(this,"txnToEvent",{}),(0,i.default)(this,"receipts",{}),(0,i.default)(this,"receiptCacheByEventId",{}),(0,i.default)(this,"notificationCounts",{}),(0,i.default)(this,"timelineSets",void 0),(0,i.default)(this,"filteredTimelineSets",{}),(0,i.default)(this,"pendingEventList",void 0),(0,i.default)(this,"blacklistUnverifiedDevices",null),(0,i.default)(this,"selfMembership",null),(0,i.default)(this,"summaryHeroes",null),(0,i.default)(this,"getTypeWarning",!1),(0,i.default)(this,"getVersionWarning",!1),(0,i.default)(this,"membersPromise",void 0),(0,i.default)(this,"name",void 0),(0,i.default)(this,"normalizedName",void 0),(0,i.default)(this,"tags",{}),(0,i.default)(this,"accountData",{}),(0,i.default)(this,"summary",null),(0,i.default)(this,"storageToken",void 0),(0,i.default)(this,"timeline",void 0),(0,i.default)(this,"oldState",void 0),(0,i.default)(this,"currentState",void 0),(0,i.default)(this,"threads",new Map),(0,i.default)(this,"lastThread",void 0),(0,i.default)(this,"visibilityEvents",new Map),this.setMaxListeners(100),this.reEmitter=new m.ReEmitter(this),r.pendingEventOrdering=r.pendingEventOrdering||f.PendingEventOrdering.Chronological,this.name=e,this.timelineSets=[new o.EventTimelineSet(this,r)],this.reEmitter.reEmit(this.getUnfilteredTimelineSet(),["Room.timeline","Room.timelineReset"]),this.fixUpLegacyTimelineFields(),this.opts.pendingEventOrdering===f.PendingEventOrdering.Detached){this.pendingEventList=[];const e=t.sessionStore.store.getItem(T(this.roomId));e&&JSON.parse(e).forEach((async e=>{const t=new d.MatrixEvent(e);t.getType()===g.EventType.RoomMessageEncrypted&&await t.attemptDecryption(this.client.crypto),t.setStatus(d.EventStatus.NOT_SENT),this.addPendingEvent(t,t.getTxnId())}))}this.opts.lazyLoadMembers?this.membersPromise=null:this.membersPromise=Promise.resolve(!1)}decryptCriticalEvents(){const e=this.getEventReadUpTo(this.client.getUserId(),!0),t=this.getLiveTimeline().getEvents(),n=t.findIndex((t=>t.event.event_id===e)),r=t.slice(n).filter((e=>e.shouldAttemptDecryption())).reverse().map((e=>e.attemptDecryption(this.client.crypto,{isRetry:!0})));return Promise.allSettled(r)}decryptAllEvents(){const e=this.getUnfilteredTimelineSet().getLiveTimeline().getEvents().filter((e=>e.shouldAttemptDecryption())).reverse().map((e=>e.attemptDecryption(this.client.crypto,{isRetry:!0})));return Promise.allSettled(e)}getVersion(){const e=this.currentState.getStateEvents(g.EventType.RoomCreate,"");if(!e)return this.getVersionWarning||(p.logger.warn("[getVersion] Room "+this.roomId+" does not have an m.room.create event"),this.getVersionWarning=!0),"1";const t=e.getContent().room_version;return void 0===t?"1":t}shouldUpgradeToVersion(){return _.includes(this.getVersion())?null:"6"}async getRecommendedVersion(){let e=(await this.client.getCapabilities())["m.room_versions"];if(!e){e={default:"6",available:{}};for(const t of _)e.available[t]=f.RoomVersionStability.Stable}let t=this.checkVersionAgainstCapability(e);if(t.urgent&&t.needsUpgrade){if(p.logger.warn("Refreshing room version capability because the server looks to be supporting a newer room version we don't know about."),e=(await this.client.getCapabilities(!0))["m.room_versions"],!e)return p.logger.warn("No room version capability - assuming upgrade required."),t;t=this.checkVersionAgainstCapability(e)}return t}checkVersionAgainstCapability(e){const t=this.getVersion();p.logger.log(`[${this.roomId}] Current version: ${t}`),p.logger.log(`[${this.roomId}] Version capability: `,e);const n={version:t,needsUpgrade:!1,urgent:!1};return t===e.default||Object.keys(e.available).filter((t=>"stable"===e.available[t])).includes(t)||(n.version=e.default,n.needsUpgrade=!0,n.urgent=!!this.getVersion().match(/^[0-9]+[0-9.]*$/g),n.urgent?p.logger.warn(`URGENT upgrade required on ${this.roomId}`):p.logger.warn(`Non-urgent upgrade required on ${this.roomId}`)),n}userMayUpgradeRoom(e){return this.currentState.maySendStateEvent(g.EventType.RoomTombstone,e)}getPendingEvents(e){if(this.opts.pendingEventOrdering!==f.PendingEventOrdering.Detached)throw new Error("Cannot call getPendingEvents with pendingEventOrdering == "+this.opts.pendingEventOrdering);return this.pendingEventList.filter((t=>!e||e.id===t.threadRootId))}removePendingEvent(e){if(this.opts.pendingEventOrdering!==f.PendingEventOrdering.Detached)throw new Error("Cannot call removePendingEvent with pendingEventOrdering == "+this.opts.pendingEventOrdering);const t=c.removeElement(this.pendingEventList,(function(t){return t.getId()==e}),!1);return this.savePendingEvents(),t}hasPendingEvent(e){return this.opts.pendingEventOrdering===f.PendingEventOrdering.Detached&&this.pendingEventList.some((t=>t.getId()===e))}getPendingEvent(e){return this.opts.pendingEventOrdering!==f.PendingEventOrdering.Detached?null:this.pendingEventList.find((t=>t.getId()===e))}getLiveTimeline(){return this.getUnfilteredTimelineSet().getLiveTimeline()}getLastActiveTimestamp(){const e=this.getLiveTimeline().getEvents();return e.length?e[e.length-1].getTs():Number.MIN_SAFE_INTEGER}getMyMembership(){return this.selfMembership}getDMInviter(){if(this.myUserId){const e=this.getMember(this.myUserId);if(e)return e.getDMInviter()}if("invite"===this.selfMembership&&2==this.getInvitedAndJoinedMemberCount()&&this.summaryHeroes.length)return this.summaryHeroes[0]}guessDMUserId(){const e=this.getMember(this.myUserId);if(e){const t=e.getDMInviter();if(t)return t}if(Array.isArray(this.summaryHeroes)&&this.summaryHeroes.length)return this.summaryHeroes[0];const t=this.currentState.getMembers().find((e=>e.userId!==this.myUserId));return t?t.userId:this.myUserId}getAvatarFallbackMember(){if(this.getInvitedAndJoinedMemberCount()>2)return;const e=Array.isArray(this.summaryHeroes)&&this.summaryHeroes.length;if(e){const e=this.summaryHeroes.map((e=>this.getMember(e))).find((e=>!!e));if(e)return e}const t=this.currentState.getMembers();if(t.length<=2){const e=t.find((e=>e.userId!==this.myUserId));if(e)return e}if(e){const e=this.summaryHeroes.map((e=>this.client.getUser(e))).find((e=>!!e));if(e){const t=new u.RoomMember(this.roomId,e.userId);return t.user=e,t}}}updateMyMembership(e){const t=this.selfMembership;this.selfMembership=e,t!==e&&("leave"===e&&this.cleanupAfterLeaving(),this.emit("Room.myMembership",this,e,t))}async loadMembersFromServer(){const e=this.client.store.getSyncToken(),t=c.encodeParams({not_membership:"leave",at:e}),n=c.encodeUri("/rooms/$roomId/members?"+t,{$roomId:this.roomId}),r=this.client.http;return(await r.authedRequest(void 0,v.Method.Get,n)).chunk}async loadMembers(){let e=!1,t=await this.client.store.getOutOfBandMembers(this.roomId);return(null===t||this.client.isCryptoEnabled()&&this.client.isRoomEncrypted(this.roomId))&&(e=!0,t=await this.loadMembersFromServer(),p.logger.log(`LL: got ${t.length} members from server for room ${this.roomId}`)),{memberEvents:t.map(this.client.getEventMapper()),fromServer:e}}loadMembersIfNeeded(){if(this.membersPromise)return this.membersPromise;this.currentState.markOutOfBandMembersStarted();const e=this.loadMembers().then((e=>(this.currentState.setOutOfBandMembers(e.memberEvents),this.client.isCryptoEnabled()&&this.client.isRoomEncrypted(this.roomId)&&this.client.crypto.trackRoomDevices(this.roomId),e.fromServer))).catch((e=>{throw this.membersPromise=null,this.currentState.markOutOfBandMembersFailed(),e}));return e.then((e=>{if(e){const e=this.currentState.getMembers().filter((e=>e.isOutOfBand())).map((e=>e.events.member.event));return p.logger.log(`LL: telling store to write ${e.length} members for room ${this.roomId}`),this.client.store.setOutOfBandMembers(this.roomId,e).catch((e=>{p.logger.log("LL: storing OOB room members failed, oh well",e)}))}})).catch((e=>{p.logger.error(e)})),this.membersPromise=e,this.membersPromise}async clearLoadedMembersIfNeeded(){this.opts.lazyLoadMembers&&this.membersPromise&&(await this.loadMembersIfNeeded(),await this.client.store.clearOutOfBandMembers(this.roomId),this.currentState.clearOutOfBandMembers(),this.membersPromise=null)}cleanupAfterLeaving(){this.clearLoadedMembersIfNeeded().catch((e=>{p.logger.error(`error after clearing loaded members from room ${this.roomId} after leaving`),p.logger.log(e)}))}resetLiveTimeline(e,t){for(let n=0;n<this.timelineSets.length;n++)this.timelineSets[n].resetLiveTimeline(e,t);this.fixUpLegacyTimelineFields()}fixUpLegacyTimelineFields(){this.timeline=this.getLiveTimeline().getEvents(),this.oldState=this.getLiveTimeline().getState(a.EventTimeline.BACKWARDS),this.currentState=this.getLiveTimeline().getState(a.EventTimeline.FORWARDS)}async hasUnverifiedDevices(){if(!this.client.isRoomEncrypted(this.roomId))return!1;const e=await this.getEncryptionTargetMembers();for(const t of e)if(this.client.getStoredDevicesForUser(t.userId).some((e=>e.isUnverified())))return!0;return!1}getTimelineSets(){return this.timelineSets}getUnfilteredTimelineSet(){return this.timelineSets[0]}getTimelineForEvent(e){const t=this.findEventById(e),n=this.findThreadForEvent(t);return n?n.timelineSet.getLiveTimeline():this.getUnfilteredTimelineSet().getTimelineForEvent(e)}addTimeline(){return this.getUnfilteredTimelineSet().addTimeline()}findEventById(e){let t=this.getUnfilteredTimelineSet().findEventById(e);if(t)return t;{const n=this.getThreads();for(let r=0;r<n.length;r++)if(t=n[r].findEventById(e),t)return t}}getUnreadNotificationCount(e=x.Total){return this.notificationCounts[e]}setUnreadNotificationCount(e,t){this.notificationCounts[e]=t}setSummary(e){const t=e["m.heroes"],n=e["m.joined_member_count"],r=e["m.invited_member_count"];Number.isInteger(n)&&this.currentState.setJoinedMemberCount(n),Number.isInteger(r)&&this.currentState.setInvitedMemberCount(r),Array.isArray(t)&&(this.summaryHeroes=t.filter((e=>e!==this.myUserId)))}setBlacklistUnverifiedDevices(e){this.blacklistUnverifiedDevices=e}getBlacklistUnverifiedDevices(){return this.blacklistUnverifiedDevices}getAvatarUrl(e,t,n,r,i=!0){const s=this.currentState.getStateEvents(g.EventType.RoomAvatar,"");if(!s&&!i)return null;const o=s?s.getContent().url:null;return o?(0,l.getHttpUriForMxc)(e,o,t,n,r):null}getMxcAvatarUrl(){var e,t;return(null===(e=this.currentState.getStateEvents(g.EventType.RoomAvatar,""))||void 0===e||null===(t=e.getContent())||void 0===t?void 0:t.url)||null}getAliases(){const e=[],t=this.currentState.getStateEvents(g.EventType.RoomAliases);if(t)for(let n=0;n<t.length;++n){const r=t[n];if(Array.isArray(r.getContent().aliases)){const t=r.getContent().aliases.filter((e=>"string"==typeof e&&"#"===e[0]&&!!e.endsWith(`:${r.getStateKey()}`)));Array.prototype.push.apply(e,t)}}return e}getCanonicalAlias(){const e=this.currentState.getStateEvents(g.EventType.RoomCanonicalAlias,"");return e&&e.getContent().alias||null}getAltAliases(){const e=this.currentState.getStateEvents(g.EventType.RoomCanonicalAlias,"");return e&&e.getContent().alt_aliases||[]}addEventsToTimeline(e,t,n,r){n.getTimelineSet().addEventsToTimeline(e,t,n,r)}getThread(e){return this.getThreads().find((t=>t.id===e))}getThreads(){return Array.from(this.threads.values())}getMember(e){return this.currentState.getMember(e)}getMembers(){return this.currentState.getMembers()}getJoinedMembers(){return this.getMembersWithMembership("join")}getJoinedMemberCount(){return this.currentState.getJoinedMemberCount()}getInvitedMemberCount(){return this.currentState.getInvitedMemberCount()}getInvitedAndJoinedMemberCount(){return this.getInvitedMemberCount()+this.getJoinedMemberCount()}getMembersWithMembership(e){return this.currentState.getMembers().filter((function(t){return t.membership===e}))}async getEncryptionTargetMembers(){await this.loadMembersIfNeeded();let e=this.getMembersWithMembership("join");return this.shouldEncryptForInvitedMembers()&&(e=e.concat(this.getMembersWithMembership("invite"))),e}shouldEncryptForInvitedMembers(){var e;const t=this.currentState.getStateEvents(g.EventType.RoomHistoryVisibility,"");return"joined"!==(null==t||null===(e=t.getContent())||void 0===e?void 0:e.history_visibility)}getDefaultRoomName(e){return this.calculateRoomName(e,!0)}hasMembershipState(e,t){const n=this.getMember(e);return!!n&&n.membership===t}getOrCreateFilteredTimelineSet(e,{prepopulateTimeline:t=!0}={}){if(this.filteredTimelineSets[e.filterId])return this.filteredTimelineSets[e.filterId];const n=Object.assign({filter:e},this.opts),r=new o.EventTimelineSet(this,n);this.reEmitter.reEmit(r,["Room.timeline","Room.timelineReset"]),this.filteredTimelineSets[e.filterId]=r,this.timelineSets.push(r);const i=this.getLiveTimeline();if(t){i.getEvents().forEach((function(e){r.addLiveEvent(e)}));let e=i;for(;e.getNeighbouringTimeline(a.EventTimeline.BACKWARDS);)e=e.getNeighbouringTimeline(a.EventTimeline.BACKWARDS);r.getLiveTimeline().setPaginationToken(e.getPaginationToken(a.EventTimeline.BACKWARDS),a.EventTimeline.BACKWARDS)}else{const e=i.getPaginationToken(a.Direction.Forward);r.getLiveTimeline().setPaginationToken(e,a.Direction.Backward)}return r}removeFilteredTimelineSet(e){const t=this.filteredTimelineSets[e.filterId];delete this.filteredTimelineSets[e.filterId];const n=this.timelineSets.indexOf(t);n>-1&&this.timelineSets.splice(n,1)}findThreadForEvent(e){if(!e)return null;if(e.isThreadRelation)return this.threads.get(e.threadRootId);if(e.isThreadRoot)return this.threads.get(e.getId());{const t=this.findEventById(e.parentEventId);return this.findThreadForEvent(t)}}async addThreadedEvent(e){let t=this.findThreadForEvent(e);if(t)t.addEvent(e);else{const n=[e];let r=this.findEventById(e.threadRootId);try{let i;e.threadRootId&&(i=await this.client.fetchRoomEvent(this.roomId,e.threadRootId)),r?r.setUnsigned(i.unsigned):r=new d.MatrixEvent(i)}finally{t=this.createThread(r,n)}}if(e.getUnsigned().transaction_id){const t=this.txnToEvent[e.getUnsigned().transaction_id];if(t)return void this.handleRemoteEcho(e,t)}this.emit(y.ThreadEvent.Update,t)}createThread(e,t){const n=new y.Thread(e,{initialEvents:t,room:this,client:this.client});if(n.id)return this.threads.set(n.id,n),this.reEmitter.reEmit(n,[y.ThreadEvent.Update,y.ThreadEvent.Ready,"Room.timeline","Room.timelineReset"]),(!this.lastThread||this.lastThread.rootEvent.localTimestamp<e.localTimestamp)&&(this.lastThread=n),this.emit(y.ThreadEvent.New,n),n}addLiveEvent(e,t,n=!1){if(e.isRedaction()){const t=e.event.redacts,n=this.findEventById(t);n&&(n.makeRedacted(e),n.getStateKey()&&this.currentState.getStateEvents(n.getType(),n.getStateKey()).getId()===n.getId()&&this.currentState.setStateEvents([n]),this.emit("Room.redaction",e,this),this.visibilityEvents.delete(t),n.isVisibilityEvent()&&this.redactVisibilityChangeEvent(e))}if(e.isVisibilityEvent()&&this.applyNewVisibilityEvent(e),this.applyPendingVisibilityEvents(e),e.getUnsigned().transaction_id){const t=this.txnToEvent[e.getUnsigned().transaction_id];if(t)return void this.handleRemoteEcho(e,t)}for(let r=0;r<this.timelineSets.length;r++)this.timelineSets[r].addLiveEvent(e,t,n);e.sender&&e.getType()!==g.EventType.RoomRedaction&&this.addReceipt(k(e.sender.userId,e,"m.read"),!0)}addPendingEvent(e,t){if(e.status!==d.EventStatus.SENDING&&e.status!==d.EventStatus.NOT_SENT)throw new Error("addPendingEvent called on an event with status "+e.status);if(this.txnToEvent[t])throw new Error("addPendingEvent called on an event with known txnId "+t);a.EventTimeline.setEventMetadata(e,this.getLiveTimeline().getState(a.EventTimeline.FORWARDS),!1),this.txnToEvent[t]=e;const n=this.findThreadForEvent(e);if(this.opts.pendingEventOrdering!==f.PendingEventOrdering.Detached||n)if(n)n.addEvent(e,!1);else for(let t=0;t<this.timelineSets.length;t++){const n=this.timelineSets[t];n.getFilter()?n.getFilter().filterRoomTimeline([e]).length&&n.addEventToTimeline(e,n.getLiveTimeline(),!1):n.addEventToTimeline(e,n.getLiveTimeline(),!1)}else if(this.pendingEventList.some((e=>e.status===d.EventStatus.NOT_SENT))&&(p.logger.warn("Setting event as NOT_SENT due to messages in the same state"),e.setStatus(d.EventStatus.NOT_SENT)),this.pendingEventList.push(e),this.savePendingEvents(),e.isRelation()&&this.aggregateNonLiveRelation(e),e.isRedaction()){const t=e.event.redacts;let n=this.pendingEventList&&this.pendingEventList.find((e=>e.getId()===t));n||(n=this.findEventById(t)),n&&(n.markLocallyRedacted(e),this.emit("Room.redaction",e,this))}this.emit("Room.localEchoUpdated",e,this,null,null)}savePendingEvents(){if(this.pendingEventList){const e=this.pendingEventList.map((e=>S(S({},e.event),{},{txn_id:e.getTxnId()}))).filter((e=>{const t=e.type===g.EventType.RoomMessageEncrypted,n=this.client.isRoomEncrypted(this.roomId);return t||!n})),{store:t}=this.client.sessionStore;this.pendingEventList.length>0?t.setItem(T(this.roomId),JSON.stringify(e)):t.removeItem(T(this.roomId))}}aggregateNonLiveRelation(e){const t=this.findThreadForEvent(e);if(t)t.timelineSet.aggregateRelations(e);else for(let t=0;t<this.timelineSets.length;t++){const n=this.timelineSets[t];n.getFilter()?n.getFilter().filterRoomTimeline([e]).length&&n.aggregateRelations(e):n.aggregateRelations(e)}}handleRemoteEcho(e,t){const n=t.getId(),r=e.getId(),i=t.status;p.logger.debug(`Got remote echo for event ${n} -> ${r} old status ${i}`),delete this.txnToEvent[e.getUnsigned().transaction_id],this.pendingEventList&&this.removePendingEvent(n),t.handleRemoteEcho(e.event);const s=this.findThreadForEvent(e);if(s)s.timelineSet.handleRemoteEcho(t,n,r);else for(let e=0;e<this.timelineSets.length;e++)this.timelineSets[e].handleRemoteEcho(t,n,r);this.emit("Room.localEchoUpdated",t,this,n,i)}updatePendingEvent(e,t,n){if(p.logger.log(`setting pendingEvent status to ${t} in ${e.getRoomId()} event ID ${e.getId()} -> ${n}`),t==d.EventStatus.SENT&&!n)throw new Error("updatePendingEvent called with status=SENT, but no new event id");if(t==d.EventStatus.SENT&&this.getTimelineForEvent(n))return;const r=e.status,i=e.getId();if(!r)throw new Error("updatePendingEventStatus called on an event which is not a local echo.");const s=C[r];if(!s||s.indexOf(t)<0)throw new Error("Invalid EventStatus transition "+r+"->"+t);if(e.setStatus(t),t==d.EventStatus.SENT){e.replaceLocalEventId(n);const t=this.findThreadForEvent(e);if(t)t.timelineSet.replaceEventId(i,n);else for(let e=0;e<this.timelineSets.length;e++)this.timelineSets[e].replaceEventId(i,n)}else if(t==d.EventStatus.CANCELLED){if(this.pendingEventList){const e=this.pendingEventList.findIndex((e=>e.getId()===i));if(-1!==e){const[t]=this.pendingEventList.splice(e,1);t.isRedaction()&&this.revertRedactionLocalEcho(t)}}this.removeEvent(i)}this.savePendingEvents(),this.emit("Room.localEchoUpdated",e,this,i,r)}revertRedactionLocalEcho(e){const t=e.event.redacts;if(!t)return;const n=this.getUnfilteredTimelineSet().findEventById(t);n&&(n.unmarkLocallyRedacted(),this.emit("Room.redactionCancelled",e,this),n.isRelation()&&this.aggregateNonLiveRelation(n))}addLiveEvents(e,t,n=!1){let r;if(t&&-1===["replace","ignore"].indexOf(t))throw new Error("duplicateStrategy MUST be either 'replace' or 'ignore'");for(r=0;r<this.timelineSets.length;r++){const e=this.timelineSets[r].getLiveTimeline();if(e.getPaginationToken(a.EventTimeline.FORWARDS))throw new Error("live timeline "+r+" is no longer live - it has a pagination token ("+e.getPaginationToken(a.EventTimeline.FORWARDS)+")");if(e.getNeighbouringTimeline(a.EventTimeline.FORWARDS))throw new Error("live timeline "+r+" is no longer live - it has a neighbouring timeline")}for(r=0;r<e.length;r++){this.addLiveEvent(e[r],t,n);const i=this.findThreadForEvent(e[r]);i&&i.addEvent(e[r],!0)}}addEphemeralEvents(e){for(const t of e)"m.typing"===t.getType()?this.currentState.setTypingEvent(t):"m.receipt"===t.getType()&&this.addReceipt(t)}removeEvents(e){for(let t=0;t<e.length;++t)this.removeEvent(e[t])}removeEvent(e){let t=!1;for(let n=0;n<this.timelineSets.length;n++){const r=this.timelineSets[n].removeEvent(e);r&&(r.isRedaction()&&this.revertRedactionLocalEcho(r),t=!0)}return t}recalculate(){const e=this.currentState.getStateEvents(g.EventType.RoomMember,this.myUserId);e&&"invite"===e.getContent().membership&&(e.getUnsigned().invite_room_state||[]).forEach((e=>{this.currentState.getStateEvents(e.type,e.state_key)||this.currentState.setStateEvents([new d.MatrixEvent({type:e.type,state_key:e.state_key,content:e.content,event_id:"$fake"+Date.now(),room_id:this.roomId,user_id:this.myUserId})])}));const t=this.name;this.name=this.calculateRoomName(this.myUserId),this.normalizedName=(0,c.normalize)(this.name),this.summary=new h.RoomSummary(this.roomId,{title:this.name}),t!==this.name&&this.emit("Room.name",this)}getUsersReadUpTo(e){return this.getReceiptsForEvent(e).filter((function(e){return"m.read"===e.type})).map((function(e){return e.userId}))}getReadReceiptForUserId(e,t=!1){var n,r;const[i,s]=null!==(n=null===(r=this.receipts["m.read"])||void 0===r?void 0:r[e])&&void 0!==n?n:[];return t?i:null!=s?s:i}getEventReadUpTo(e,t=!1){var n;const r=this.getReadReceiptForUserId(e,t);return null!==(n=null==r?void 0:r.eventId)&&void 0!==n?n:null}hasUserReadEvent(e,t){const n=this.getEventReadUpTo(e,!1);if(n===t)return!0;if(this.timeline.length&&this.timeline[this.timeline.length-1].getSender()&&this.timeline[this.timeline.length-1].getSender()===e)return!0;for(let e=this.timeline.length-1;e>=0;--e){const r=this.timeline[e];if(r.getId()===t)return!1;if(r.getId()===n)return!0}return!1}getReceiptsForEvent(e){return this.receiptCacheByEventId[e.getId()]||[]}addReceipt(e,t=!1){this.addReceiptsToStructure(e,t),this.emit("Room.receipt",e,this)}addReceiptsToStructure(e,t){const n=e.getContent();Object.keys(n).forEach((e=>{Object.keys(n[e]).forEach((r=>{Object.keys(n[e][r]).forEach((i=>{var s,o;const a=n[e][r][i];this.receipts[r]||(this.receipts[r]={}),this.receipts[r][i]||(this.receipts[r][i]=[null,null]);const l=this.receipts[r][i];let c=l[0];var d;if(t&&(c=null!==(d=l[1])&&void 0!==d?d:l[0]),c){const t=this.getUnfilteredTimelineSet().compareEventOrdering(c.eventId,e);if(null!==t&&t>=0)return}const u={eventId:e,data:a},h=t?l[0]:u,p=t?u:l[1];let m=null;h&&p&&(m=this.getUnfilteredTimelineSet().compareEventOrdering(h.eventId,p.eventId));const g=null===m||m<0,f=null!==(s=l[1])&&void 0!==s?s:l[0];if(t&&g?l[1]=u:t||(l[0]=u,g||(l[1]=null)),f!==(null!==(o=l[1])&&void 0!==o?o:l[0])){if(f&&this.receiptCacheByEventId[f.eventId]){const e=f.eventId;this.receiptCacheByEventId[e]=this.receiptCacheByEventId[e].filter((e=>e.type!==r||e.userId!==i)),this.receiptCacheByEventId[e].length<1&&delete this.receiptCacheByEventId[e]}this.receiptCacheByEventId[e]||(this.receiptCacheByEventId[e]=[]),this.receiptCacheByEventId[e].push({userId:i,type:r,data:a})}}))}))}))}addLocalEchoReceipt(e,t,n){this.addReceipt(k(e,t,n),!0)}addTags(e){this.tags=e.getContent().tags||{},this.emit("Room.tags",e,this)}addAccountData(e){for(let t=0;t<e.length;t++){const n=e[t];"m.tag"===n.getType()&&this.addTags(n);const r=this.accountData[n.getType()];this.accountData[n.getType()]=n,this.emit("Room.accountData",n,this,r)}}getAccountData(e){return this.accountData[e]}maySendMessage(){return"join"===this.getMyMembership()&&(this.client.isRoomEncrypted(this.roomId)?this.currentState.maySendEvent(g.EventType.RoomMessageEncrypted,this.myUserId):this.currentState.maySendEvent(g.EventType.RoomMessage,this.myUserId))}canInvite(e){let t="join"===this.getMyMembership();const n=this.currentState.getStateEvents(g.EventType.RoomPowerLevels,""),r=n&&n.getContent(),i=this.getMember(e);return r&&i&&r.invite>i.powerLevel&&(t=!1),t}getJoinRule(){return this.currentState.getJoinRule()}getHistoryVisibility(){return this.currentState.getHistoryVisibility()}getGuestAccess(){return this.currentState.getGuestAccess()}getType(){const e=this.currentState.getStateEvents(g.EventType.RoomCreate,"");if(e)return e.getContent()[g.RoomCreateTypeField];this.getTypeWarning||(p.logger.warn("[getType] Room "+this.roomId+" does not have an m.room.create event"),this.getTypeWarning=!0)}isSpaceRoom(){return this.getType()===g.RoomType.Space}calculateRoomName(e,t=!1){if(!t){const e=this.currentState.getStateEvents(g.EventType.RoomName,"");if(e&&e.getContent()&&e.getContent().name)return e.getContent().name}const n=this.getCanonicalAlias();if(n)return n;let r=this.currentState.getJoinedMemberCount()+this.currentState.getInvitedMemberCount()-1,i=[];const s=this.currentState.getStateEvents(g.UNSTABLE_ELEMENT_FUNCTIONAL_USERS.name,"");Array.isArray(null==s?void 0:s.getContent().service_members)&&(i=s.getContent().service_members);let o=null;if(this.summaryHeroes)o=[],this.summaryHeroes.forEach((e=>{if(i.includes(e))return void r--;const t=this.getMember(e);o.push(t?t.name:e)}));else{let t=this.currentState.getMembers().filter((t=>t.userId!==e&&("invite"===t.membership||"join"===t.membership)));t=t.filter((({userId:e})=>!i.includes(e)||(r--,!1))),t.sort(((e,t)=>c.compare(e.userId,t.userId))),t=t.slice(0,5),o=t.map((e=>e.name))}if(r)return A(o,r);if("join"==this.getMyMembership()){const e=this.currentState.getStateEvents(g.EventType.RoomThirdPartyInvite);if(e&&e.length)return`Inviting ${A(e.map((e=>e.getContent().display_name)))}`}let a=o;return a.length||(a=this.currentState.getMembers().filter((t=>t.userId!==e&&"invite"!==t.membership&&"join"!==t.membership)).map((e=>e.name))),a.length?`Empty room (was ${A(a)})`:"Empty room"}applyNewVisibilityEvent(e){const t=e.asVisibilityChange();if(!t)return;const n=e.getSender();if(!n)return;if(!(g.EVENT_VISIBILITY_CHANGE_TYPE.name&&this.currentState.maySendStateEvent(g.EVENT_VISIBILITY_CHANGE_TYPE.name,n)||g.EVENT_VISIBILITY_CHANGE_TYPE.altName&&this.currentState.maySendStateEvent(g.EVENT_VISIBILITY_CHANGE_TYPE.altName,n)))return;const r=this.visibilityEvents.get(t.eventId);if(r){let t=r.length-1;const n=Math.max(0,r.length-30);for(;t>=n&&!(r[t].getTs()<e.getTs());--t);-1===t?r.unshift(e):r.splice(t+1,0,e)}else this.visibilityEvents.set(t.eventId,[e]);const i=this.findEventById(t.eventId);i&&i.applyVisibilityEvent(t)}redactVisibilityChangeEvent(e){if(!e.isVisibilityEvent)throw new Error("expected a visibility change event");const t=e.getRelation().event_id,n=this.visibilityEvents.get(t);if(!n)return;const r=n.findIndex((t=>t.getId()===e.getId()));if(-1!==r&&(n.splice(r,1),r===n.length)){const e=this.findEventById(t);if(!e)return;if(0===r)this.visibilityEvents.delete(t),e.applyVisibilityEvent();else{const t=n[n.length-1].asVisibilityChange();if(!t)throw new Error("at this stage, visibility changes should be well-formed");e.applyVisibilityEvent(t)}}}applyPendingVisibilityEvents(e){const t=this.visibilityEvents.get(e.getId());if(!t||0==t.length)return;const n=t[t.length-1],r=n.asVisibilityChange();r&&(r.visible,n.getTs()<e.getTs()||e.applyVisibilityEvent(r))}}function T(e){return`mx_pending_events_${e}`}t.Room=E;const C={[d.EventStatus.ENCRYPTING]:[d.EventStatus.SENDING,d.EventStatus.NOT_SENT,d.EventStatus.CANCELLED],[d.EventStatus.SENDING]:[d.EventStatus.ENCRYPTING,d.EventStatus.QUEUED,d.EventStatus.NOT_SENT,d.EventStatus.SENT],[d.EventStatus.QUEUED]:[d.EventStatus.SENDING,d.EventStatus.CANCELLED],[d.EventStatus.SENT]:[],[d.EventStatus.NOT_SENT]:[d.EventStatus.SENDING,d.EventStatus.QUEUED,d.EventStatus.CANCELLED],[d.EventStatus.CANCELLED]:[]};function A(e,t=e.length+1){const n=t-1;return e.length?1===e.length&&n<=1?e[0]:2===e.length&&n<=2?`${e[0]} and ${e[1]}`:n>1?`${e[0]} and ${n} others`:`${e[0]} and 1 other`:"Empty room"}},1398:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SearchResult=void 0;var r=n(3558);class i{static fromJson(e,t){const n=e.context||{},s=n.events_before||[],o=n.events_after||[],a=new r.EventContext(t(e.result));return a.setPaginateToken(n.start,!0),a.addEvents(s.map(t),!0),a.addEvents(o.map(t),!1),a.setPaginateToken(n.end,!1),new i(e.rank,a)}constructor(e,t){this.rank=e,this.context=t}}t.SearchResult=i},6969:(e,t,n)=>{"use strict";var r=n(5318);Object.defineProperty(t,"__esModule",{value:!0}),t.ThreadEvent=t.Thread=void 0;var i=r(n(9713)),s=n(771),o=n(2481),a=n(4369),l=n(8910),c=n(3705),d=n(5861);let u;t.ThreadEvent=u,function(e){e.New="Thread.new",e.Ready="Thread.ready",e.Update="Thread.update",e.NewReply="Thread.newReply",e.ViewThread="Thred.viewThread"}(u||(t.ThreadEvent=u={}));class h extends d.TypedEventEmitter{constructor(e,t){var n,r,o;super(),this.rootEvent=e,(0,i.default)(this,"timelineSet",void 0),(0,i.default)(this,"_currentUserParticipated",!1),(0,i.default)(this,"reEmitter",void 0),(0,i.default)(this,"lastEvent",void 0),(0,i.default)(this,"replyCount",0),(0,i.default)(this,"room",void 0),(0,i.default)(this,"client",void 0),(0,i.default)(this,"initialEventsFetched",!1),(0,i.default)(this,"id",void 0),(0,i.default)(this,"onEcho",(e=>{this.timelineSet.eventIdToTimeline(e.getId())&&this.emit(u.Update,this)})),this.room=t.room,this.client=t.client,this.timelineSet=new c.EventTimelineSet(this.room,{unstableClientRelationAggregation:!0,timelineSupport:!0,pendingEvents:!0}),this.reEmitter=new s.ReEmitter(this),this.reEmitter.reEmit(this.timelineSet,["Room.timeline","Room.timelineReset"]),this.id=e?e.getId():null==t||null===(r=t.initialEvents)||void 0===r||null===(o=r.find((e=>e.isThreadRelation)))||void 0===o?void 0:o.relationEventId,this.initialiseThread(this.rootEvent),null==t||null===(n=t.initialEvents)||void 0===n||n.forEach((e=>this.addEvent(e))),this.room.on("Room.localEchoUpdated",this.onEcho),this.room.on("Room.timeline",this.onEcho)}get hasServerSideSupport(){var e,t,n;return null===(e=this.client.cachedCapabilities)||void 0===e||null===(t=e.capabilities)||void 0===t||null===(n=t[o.RelationType.Thread])||void 0===n?void 0:n.enabled}get roomState(){return this.room.getLiveTimeline().getState(l.EventTimeline.FORWARDS)}async addEvent(e,t=!1){var n;if(!this.hasServerSideSupport){if(this.timelineSet.findEventById(e.getId()))return;e.setThread(this),this.timelineSet.addEventToTimeline(e,this.liveTimeline,t,!1,this.roomState),await this.client.decryptEventIfNeeded(e,{})}this.hasServerSideSupport&&this.initialEventsFetched&&e.localTimestamp>this.lastReply().localTimestamp&&!this.findEventById(e.getId())&&this.timelineSet.addEventToTimeline(e,this.liveTimeline,!1,!1,this.roomState),this._currentUserParticipated||e.getSender()!==this.client.getUserId()||(this._currentUserParticipated=!0);const r=(null===(n=e.getRelation())||void 0===n?void 0:n.rel_type)===o.RelationType.Thread;!this.hasServerSideSupport&&r&&this.replyCount++,(!this.lastEvent||r&&e.localTimestamp>this.replyToEvent.localTimestamp)&&(this.lastEvent=e,this.lastEvent.getId()!==this.id&&(this.hasServerSideSupport&&this.replyCount++,this.emit(u.NewReply,this,e))),this.emit(u.Update,this)}initialiseThread(e){const t=null==e?void 0:e.getServerAggregatedRelation(o.RelationType.Thread);if(this.hasServerSideSupport&&t){this.replyCount=t.count,this._currentUserParticipated=t.current_user_participated;const e=new a.MatrixEvent(t.latest_event);this.setEventMetadata(e),this.lastEvent=e}!t&&e&&this.addEvent(e)}async fetchInitialEvents(){try{return await this.fetchEvents(),this.initialEventsFetched=!0,!0}catch(e){return!1}}setEventMetadata(e){l.EventTimeline.setEventMetadata(e,this.roomState,!1),e.setThread(this)}findEventById(e){return this.timelineSet.findEventById(e)}lastReply(e=(()=>!0)){for(let t=this.events.length-1;t>=0;t--){const n=this.events[t];if(e(n))return n}}get roomId(){return this.room.roomId}get length(){return this.replyCount}get replyToEvent(){return this.lastEvent}get events(){return this.liveTimeline.getEvents()}has(e){return this.timelineSet.findEventById(e)instanceof a.MatrixEvent}get hasCurrentUserParticipated(){return this._currentUserParticipated}get liveTimeline(){return this.timelineSet.getLiveTimeline()}async fetchEvents(e={limit:20}){let{originalEvent:t,events:n,prevBatch:r,nextBatch:i}=await this.client.relations(this.room.roomId,this.id,o.RelationType.Thread,null,e);e.to||i||(n=[t,...n]);for(const e of n)await this.client.decryptEventIfNeeded(e),this.setEventMetadata(e);const s=!e.direction||e.direction===l.Direction.Backward;return this.timelineSet.addEventsToTimeline(n,s,this.liveTimeline,s?i:r),{originalEvent:t,events:n,prevBatch:r,nextBatch:i}}}t.Thread=h},5861:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TypedEventEmitter=void 0;var r,i=n(7187);!function(e){e.NewListener="newListener",e.RemoveListener="removeListener"}(r||(r={}));class s extends i.EventEmitter{addListener(e,t){return super.addListener(e,t)}emit(e,...t){return super.emit(e,...t)}eventNames(){return super.eventNames()}listenerCount(e){return super.listenerCount(e)}listeners(e){return super.listeners(e)}off(e,t){return super.off(e,t)}on(e,t){return super.on(e,t)}once(e,t){return super.once(e,t)}prependListener(e,t){return super.prependListener(e,t)}prependOnceListener(e,t){return super.prependOnceListener(e,t)}removeAllListeners(e){return super.removeAllListeners(e)}removeListener(e,t){return super.removeListener(e,t)}rawListeners(e){return super.rawListeners(e)}}t.TypedEventEmitter=s},3998:(e,t,n)=>{"use strict";var r=n(5318);Object.defineProperty(t,"__esModule",{value:!0}),t.User=void 0;var i=r(n(9713)),s=n(7187);class o extends s.EventEmitter{constructor(e){super(),this.userId=e,(0,i.default)(this,"modified",void 0),(0,i.default)(this,"displayName",void 0),(0,i.default)(this,"rawDisplayName",void 0),(0,i.default)(this,"avatarUrl",void 0),(0,i.default)(this,"presenceStatusMsg",null),(0,i.default)(this,"presence","offline"),(0,i.default)(this,"lastActiveAgo",0),(0,i.default)(this,"lastPresenceTs",0),(0,i.default)(this,"currentlyActive",!1),(0,i.default)(this,"events",{presence:null,profile:null}),(0,i.default)(this,"unstable_statusMessage",""),this.displayName=e,this.rawDisplayName=e,this.avatarUrl=null,this.updateModifiedTime()}setPresenceEvent(e){if("m.presence"!==e.getType())return;const t=null===this.events.presence;this.events.presence=e;const n=[];(e.getContent().presence!==this.presence||t)&&n.push("User.presence"),e.getContent().avatar_url&&e.getContent().avatar_url!==this.avatarUrl&&n.push("User.avatarUrl"),e.getContent().displayname&&e.getContent().displayname!==this.displayName&&n.push("User.displayName"),void 0!==e.getContent().currently_active&&e.getContent().currently_active!==this.currentlyActive&&n.push("User.currentlyActive"),this.presence=e.getContent().presence,n.push("User.lastPresenceTs"),e.getContent().status_msg&&(this.presenceStatusMsg=e.getContent().status_msg),e.getContent().displayname&&(this.displayName=e.getContent().displayname),e.getContent().avatar_url&&(this.avatarUrl=e.getContent().avatar_url),this.lastActiveAgo=e.getContent().last_active_ago,this.lastPresenceTs=Date.now(),this.currentlyActive=e.getContent().currently_active,this.updateModifiedTime();for(let t=0;t<n.length;t++)this.emit(n[t],e,this)}setDisplayName(e){const t=this.displayName;this.displayName="string"==typeof e?e:void 0,e!==t&&this.updateModifiedTime()}setRawDisplayName(e){this.rawDisplayName="string"==typeof e?e:void 0}setAvatarUrl(e){const t=this.avatarUrl;this.avatarUrl=e,e!==t&&this.updateModifiedTime()}updateModifiedTime(){this.modified=Date.now()}getLastModifiedTime(){return this.modified}getLastActiveTs(){return this.lastPresenceTs-this.lastActiveAgo}unstable_updateStatusMessage(e){e.getContent()?this.unstable_statusMessage=e.getContent().status:this.unstable_statusMessage="",this.updateModifiedTime(),this.emit("User.unstable_statusMessage",this)}}t.User=o},1707:(e,t,n)=>{"use strict";var r=n(5318);Object.defineProperty(t,"__esModule",{value:!0}),t.PushProcessor=void 0;var i=r(n(9713)),s=n(3102),o=n(7434),a=n(1470);function l(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function c(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?l(Object(n),!0).forEach((function(t){(0,i.default)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):l(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}const d=[a.PushRuleKind.Override,a.PushRuleKind.ContentSpecific,a.PushRuleKind.RoomSpecific,a.PushRuleKind.SenderSpecific,a.PushRuleKind.Underride],u=[{rule_id:".m.rule.tombstone",default:!0,enabled:!0,conditions:[{kind:a.ConditionKind.EventMatch,key:"type",pattern:"m.room.tombstone"},{kind:a.ConditionKind.EventMatch,key:"state_key",pattern:""}],actions:[a.PushRuleActionName.Notify,{set_tweak:a.TweakName.Highlight,value:!0}]},{rule_id:".m.rule.reaction",default:!0,enabled:!0,conditions:[{kind:a.ConditionKind.EventMatch,key:"type",pattern:"m.reaction"}],actions:[a.PushRuleActionName.DontNotify]}];class h{constructor(e){this.client=e}static actionListToActionsObject(e){const t={notify:!1,tweaks:{}};for(let n=0;n<e.length;++n){const r=e[n];r===a.PushRuleActionName.Notify?t.notify=!0:"object"==typeof r&&(void 0===r.value&&(r.value=!0),t.tweaks[r.set_tweak]=r.value)}return t}static rewriteDefaultRules(e){let t=JSON.parse(JSON.stringify(e));t||(t={}),t.global||(t.global={}),t.global.override||(t.global.override=[]);const n=t.global.override;for(const e of u){const t=n.find((t=>t.rule_id===e.rule_id));if(t)t.default=e.default,t.conditions=e.conditions,t.actions=e.actions;else{const t=e.rule_id;o.logger.warn(`Adding default global override for ${t}`),n.push(e)}}return t}matchingRuleFromKindSet(e,t){for(let n=0;n<d.length;++n){const r=d[n],i=t[r];if(i)for(let t=0;t<i.length;++t){const n=i[t];if(!n.enabled)continue;const s=this.templateRuleToRaw(r,n);if(s&&this.ruleMatchesEvent(s,e))return c(c({},n),{},{kind:r})}}return null}templateRuleToRaw(e,t){const n={rule_id:t.rule_id,actions:t.actions,conditions:[]};switch(e){case a.PushRuleKind.Underride:case a.PushRuleKind.Override:n.conditions=t.conditions;break;case a.PushRuleKind.RoomSpecific:if(!t.rule_id)return null;n.conditions.push({kind:a.ConditionKind.EventMatch,key:"room_id",value:t.rule_id});break;case a.PushRuleKind.SenderSpecific:if(!t.rule_id)return null;n.conditions.push({kind:a.ConditionKind.EventMatch,key:"user_id",value:t.rule_id});break;case a.PushRuleKind.ContentSpecific:if(!t.pattern)return null;n.conditions.push({kind:a.ConditionKind.EventMatch,key:"content.body",pattern:t.pattern})}return n}eventFulfillsCondition(e,t){switch(e.kind){case a.ConditionKind.EventMatch:return this.eventFulfillsEventMatchCondition(e,t);case a.ConditionKind.ContainsDisplayName:return this.eventFulfillsDisplayNameCondition(e,t);case a.ConditionKind.RoomMemberCount:return this.eventFulfillsRoomMemberCountCondition(e,t);case a.ConditionKind.SenderNotificationPermission:return this.eventFulfillsSenderNotifPermCondition(e,t)}return!1}eventFulfillsSenderNotifPermCondition(e,t){const n=e.key;if(!n)return!1;const r=this.client.getRoom(t.getRoomId());return!(null==r||!r.currentState)&&r.currentState.mayTriggerNotifOfType(n,t.getSender())}eventFulfillsRoomMemberCountCondition(e,t){if(!e.is)return!1;const n=this.client.getRoom(t.getRoomId());if(!n||!n.currentState||!n.currentState.members)return!1;const r=n.currentState.getJoinedMemberCount(),i=e.is.match(/^([=<>]*)([0-9]*)$/);if(!i)return!1;const s=i[1],o=parseInt(i[2]);if(isNaN(o))return!1;switch(s){case"":case"==":return r==o;case"<":return r<o;case">":return r>o;case"<=":return r<=o;case">=":return r>=o;default:return!1}}eventFulfillsDisplayNameCondition(e,t){let n=t.getContent();if(t.isEncrypted()&&t.getClearContent()&&(n=t.getClearContent()),!n||!n.body||"string"!=typeof n.body)return!1;const r=this.client.getRoom(t.getRoomId());if(!(r&&r.currentState&&r.currentState.members&&r.currentState.getMember(this.client.credentials.userId)))return!1;const i=r.currentState.getMember(this.client.credentials.userId).name,o=new RegExp("(^|\\W)"+(0,s.escapeRegExp)(i)+"(\\W|$)","i");return n.body.search(o)>-1}eventFulfillsEventMatchCondition(e,t){if(!e.key)return!1;const n=this.valueForDottedKey(e.key,t);if("string"!=typeof n)return!1;if(e.value)return e.value===n;if("string"!=typeof e.pattern)return!1;let r;return r="content.body"==e.key?this.createCachedRegex("(^|\\W)",e.pattern,"(\\W|$)"):this.createCachedRegex("^",e.pattern,"$"),!!n.match(r)}createCachedRegex(e,t,n){return h.cachedGlobToRegex[t]||(h.cachedGlobToRegex[t]=new RegExp(e+(0,s.globToRegexp)(t)+n,"i")),h.cachedGlobToRegex[t]}valueForDottedKey(e,t){const n=e.split(".");let r;const i=n[0];for("content"===i?(r=t.getContent(),n.shift()):"type"===i?(r=t.getType(),n.shift()):r=t.event;n.length>0;){const e=n.shift();if((0,s.isNullOrUndefined)(r[e]))return null;r=r[e]}return r}matchingRuleForEventWithRulesets(e,t){return t?e.getSender()===this.client.credentials.userId?null:this.matchingRuleFromKindSet(e,t.global):null}pushActionsForEventAndRulesets(e,t){const n=this.matchingRuleForEventWithRulesets(e,t);if(!n)return{};const r=h.actionListToActionsObject(n.actions);return void 0===r.tweaks.highlight&&(r.tweaks.highlight=n.kind==a.PushRuleKind.ContentSpecific),r}ruleMatchesEvent(e,t){let n=!0;for(let r=0;r<e.conditions.length;++r){const i=e.conditions[r];n&=this.eventFulfillsCondition(i,t)}return n}actionsForEvent(e){return this.pushActionsForEventAndRulesets(e,this.client.pushRules)}getPushRuleById(e){for(const t of["global"])if(void 0!==this.client.pushRules[t])for(const n of d)if(void 0!==this.client.pushRules[t][n])for(const r of this.client.pushRules[t][n])if(r.rule_id===e)return r;return null}}t.PushProcessor=h,(0,i.default)(h,"cachedGlobToRegex",{})},8401:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.randomLowercaseString=function(e){return i(e,n)},t.randomString=function(e){return i(e,r+n+"0123456789")},t.randomUppercaseString=function(e){return i(e,r)};const n="abcdefghijklmnopqrstuvwxyz",r="ABCDEFGHIJKLMNOPQRSTUVWXYZ";function i(e,t){let n="";for(let r=0;r<e;++r)n+=t.charAt(Math.floor(Math.random()*t.length));return n}},2731:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.clearTimeout=function(e){if(0===o.length)return;let t;for(t=0;t<o.length;t++)if(o[t].key==e){o.splice(t,1);break}0===t&&l()},t.setNow=function(e){a=e||Date.now},t.setTimeout=function(e,t,...n){(t=t||0)<0&&(t=0);const r=a()+t,i=s++,c={runAt:r,func:e,params:n,key:i},d=function(e,t){let n=0,i=e.length;for(;n<i;){const t=n+i>>1;e[t].runAt-r>0?i=t:n=t+1}return n}(o);return o.splice(d,0,c),l(),i};var r=n(7434);let i,s=0;const o=[];let a=Date.now;function l(){i&&n.g.clearTimeout(i);const e=o[0];if(!e)return;const t=a(),r=Math.min(e.runAt-t,1e3);i=n.g.setTimeout(c,r)}function c(){let e;const t=a(),i=[];for(;;){const n=o[0];if(!n||n.runAt>t)break;e=o.shift(),e.key,i.push(e)}l();for(let t=0;t<i.length;t++){e=i[t];try{e.func.apply(n.g,e.params)}catch(e){r.logger.error("Uncaught exception in callback function",e.stack||e)}}}},9443:(e,t,n)=>{"use strict";var r=n(5318);Object.defineProperty(t,"__esModule",{value:!0}),t.MatrixScheduler=void 0;var i=r(n(9713)),s=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var n=a(t);if(n&&n.has(e))return n.get(e);var r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var s in e)if("default"!==s&&Object.prototype.hasOwnProperty.call(e,s)){var o=i?Object.getOwnPropertyDescriptor(e,s):null;o&&(o.get||o.set)?Object.defineProperty(r,s,o):r[s]=e[s]}return r.default=e,n&&n.set(e,r),r}(n(3102)),o=(n(7434),n(2481));function a(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(a=function(e){return e?n:t})(e)}class l{static RETRY_BACKOFF_RATELIMIT(e,t,n){if(400===n.httpStatus||403===n.httpStatus||401===n.httpStatus)return-1;if("rejected"===n.cors)return-1;if("M_TOO_LARGE"===n.name)return-1;if("M_LIMIT_EXCEEDED"===n.name){const e=n.data.retry_after_ms;if(e>0)return e}return t>4?-1:1e3*Math.pow(2,t)}static QUEUE_MESSAGES(e){return e.getType()===o.EventType.RoomMessage||e.hasAssocation()?"message":null}constructor(e=l.RETRY_BACKOFF_RATELIMIT,t=l.QUEUE_MESSAGES){this.retryAlgorithm=e,this.queueAlgorithm=t,(0,i.default)(this,"queues",{}),(0,i.default)(this,"activeQueues",[]),(0,i.default)(this,"procFn",null),(0,i.default)(this,"processQueue",(e=>{const t=this.peekNextEvent(e);if(!t){const t=this.activeQueues.indexOf(e);return t>=0&&this.activeQueues.splice(t,1),void c()}c(this.queues[e].length),Promise.resolve().then((()=>this.procFn(t.event))).then((n=>{this.removeNextEvent(e),c(t.event.getId()),t.defer.resolve(n),this.processQueue(e)}),(n=>{t.attempts+=1;const r=this.retryAlgorithm(t.event,t.attempts,n);c(t.attempts,t.event.getId()),-1===r?(c(t.event.getId()),this.removeNextEvent(e),t.defer.reject(n),this.processQueue(e)):setTimeout(this.processQueue,r,e)}))}))}getQueueForEvent(e){const t=this.queueAlgorithm(e);return t&&this.queues[t]?this.queues[t].map((function(e){return e.event})):null}removeEventFromQueue(e){const t=this.queueAlgorithm(e);if(!t||!this.queues[t])return!1;let n=!1;return s.removeElement(this.queues[t],(t=>{if(t.event.getId()===e.getId())return n=!0,!0})),n}setProcessFunction(e){this.procFn=e,this.startProcessingQueues()}queueEvent(e){const t=this.queueAlgorithm(e);if(!t)return null;this.queues[t]||(this.queues[t]=[]);const n=s.defer();return this.queues[t].push({event:e,defer:n,attempts:0}),c(e.getId()),this.startProcessingQueues(),n.promise}startProcessingQueues(){this.procFn&&Object.keys(this.queues).filter((e=>-1===this.activeQueues.indexOf(e)&&this.queues[e].length>0)).forEach((e=>{this.activeQueues.push(e),c(),this.processQueue(e)}))}peekNextEvent(e){const t=this.queues[e];return Array.isArray(t)?t[0]:null}removeNextEvent(e){const t=this.queues[e];return Array.isArray(t)?t.shift():null}}function c(...e){}t.MatrixScheduler=l},1415:(e,t)=>{"use strict";let n;Object.defineProperty(t,"__esModule",{value:!0}),t.SERVICE_TYPES=void 0,t.SERVICE_TYPES=n,function(e){e.IS="SERVICE_TYPE_IS",e.IM="SERVICE_TYPE_IM"}(n||(t.SERVICE_TYPES=n={}))},3861:(e,t,n)=>{"use strict";var r=n(5318);Object.defineProperty(t,"__esModule",{value:!0}),t.LocalIndexedDBStoreBackend=void 0;var i=r(n(9713)),s=n(2741),o=d(n(3102)),a=d(n(3415)),l=n(7434);function c(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(c=function(e){return e?n:t})(e)}function d(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var n=c(t);if(n&&n.has(e))return n.get(e);var r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var s in e)if("default"!==s&&Object.prototype.hasOwnProperty.call(e,s)){var o=i?Object.getOwnPropertyDescriptor(e,s):null;o&&(o.get||o.set)?Object.defineProperty(r,s,o):r[s]=e[s]}return r.default=e,n&&n.set(e,r),r}function u(e,t,n){const r=e.openCursor(t);return new Promise(((e,t)=>{const i=[];r.onerror=()=>{t(new Error("Query failed: "+r.error))},r.onsuccess=()=>{const t=r.result;t?(i.push(n(t)),t.continue()):e(i)}}))}function h(e){return new Promise(((t,n)=>{e.oncomplete=function(e){t(e)},e.onerror=function(){n(e.error)}}))}function p(e){return new Promise(((t,n)=>{e.onsuccess=function(e){t(e)},e.onerror=function(){n(e.error)}}))}function m(e){return p(e).then((t=>e.result))}t.LocalIndexedDBStoreBackend=class{static exists(e,t){return t="matrix-js-sdk:"+(t||"default"),a.exists(e,t)}constructor(e,t){this.indexedDB=e,(0,i.default)(this,"dbName",void 0),(0,i.default)(this,"syncAccumulator",void 0),(0,i.default)(this,"db",null),(0,i.default)(this,"disconnected",!0),(0,i.default)(this,"_isNewlyCreated",!1),this.dbName="matrix-js-sdk:"+(t||"default"),this.syncAccumulator=new s.SyncAccumulator}connect(){if(!this.disconnected)return l.logger.log("LocalIndexedDBStoreBackend.connect: already connected or connecting"),Promise.resolve();this.disconnected=!1,l.logger.log("LocalIndexedDBStoreBackend.connect: connecting...");const e=this.indexedDB.open(this.dbName,3);return e.onupgradeneeded=t=>{const n=e.result,r=t.oldVersion;l.logger.log(`LocalIndexedDBStoreBackend.connect: upgrading from ${r}`),r<1&&(this._isNewlyCreated=!0,function(e){e.createObjectStore("users",{keyPath:["userId"]}),e.createObjectStore("accountData",{keyPath:["type"]}),e.createObjectStore("sync",{keyPath:["clobber"]})}(n)),r<2&&function(e){e.createObjectStore("oob_membership_events",{keyPath:["room_id","state_key"]}).createIndex("room","room_id")}(n),r<3&&function(e){e.createObjectStore("client_options",{keyPath:["clobber"]})}(n)},e.onblocked=()=>{l.logger.log("can't yet open LocalIndexedDBStoreBackend because it is open elsewhere")},l.logger.log("LocalIndexedDBStoreBackend.connect: awaiting connection..."),p(e).then((()=>(l.logger.log("LocalIndexedDBStoreBackend.connect: connected"),this.db=e.result,this.db.onversionchange=()=>{this.db.close()},this.init())))}isNewlyCreated(){return Promise.resolve(this._isNewlyCreated)}init(){return Promise.all([this.loadAccountData(),this.loadSyncData()]).then((([e,t])=>{l.logger.log("LocalIndexedDBStoreBackend: loaded initial data"),this.syncAccumulator.accumulate({next_batch:t.nextBatch,rooms:t.roomsData,groups:t.groupsData,account_data:{events:e}},!0)}))}getOutOfBandMembers(e){return new Promise(((t,n)=>{const r=this.db.transaction(["oob_membership_events"],"readonly").objectStore("oob_membership_events").index("room"),i=IDBKeyRange.only(e),s=r.openCursor(i),o=[];let a=!1;s.onsuccess=()=>{const e=s.result;if(!e)return o.length||a?t(o):t(null);const n=e.value;n.oob_written?a=!0:o.push(n),e.continue()},s.onerror=e=>{n(e)}})).then((t=>(l.logger.log(`LL: got ${t&&t.length} membershipEvents from storage for room ${e} ...`),t)))}async setOutOfBandMembers(e,t){l.logger.log(`LL: backend about to store ${t.length} members for ${e}`);const n=this.db.transaction(["oob_membership_events"],"readwrite"),r=n.objectStore("oob_membership_events");t.forEach((e=>{r.put(e)}));const i={room_id:e,oob_written:!0,state_key:0};r.put(i),await h(n),l.logger.log(`LL: backend done storing for ${e}!`)}async clearOutOfBandMembers(e){const t=this.db.transaction(["oob_membership_events"],"readonly").objectStore("oob_membership_events").index("room"),n=IDBKeyRange.only(e),r=m(t.openKeyCursor(n,"next")).then((e=>e&&e.primaryKey[1])),i=m(t.openKeyCursor(n,"prev")).then((e=>e&&e.primaryKey[1])),[s,o]=await Promise.all([r,i]),a=this.db.transaction(["oob_membership_events"],"readwrite").objectStore("oob_membership_events"),c=IDBKeyRange.bound([e,s],[e,o]);var d;l.logger.log(`LL: Deleting all users + marker in storage for room ${e}, with key range:`,[e,s],[e,o]),await(d=a.delete(c),new Promise(((e,t)=>{d.onsuccess=()=>e(d),d.onerror=e=>t(e)})))}clearDatabase(){return new Promise((e=>{l.logger.log(`Removing indexeddb instance: ${this.dbName}`);const t=this.indexedDB.deleteDatabase(this.dbName);t.onblocked=()=>{l.logger.log(`can't yet delete indexeddb ${this.dbName} because it is open elsewhere`)},t.onerror=()=>{l.logger.warn(`unable to delete js-sdk store indexeddb: ${t.error}`),e()},t.onsuccess=()=>{l.logger.log(`Removed indexeddb instance: ${this.dbName}`),e()}}))}getSavedSync(e=!0){const t=this.syncAccumulator.getJSON();return t.nextBatch?e?Promise.resolve(o.deepCopy(t)):Promise.resolve(t):Promise.resolve(null)}getNextBatchToken(){return Promise.resolve(this.syncAccumulator.getNextBatchToken())}setSyncData(e){return Promise.resolve().then((()=>{this.syncAccumulator.accumulate(e)}))}async syncToDatabase(e){const t=this.syncAccumulator.getJSON(!0);await Promise.all([this.persistUserPresenceEvents(e),this.persistAccountData(t.accountData),this.persistSyncData(t.nextBatch,t.roomsData,t.groupsData)])}persistSyncData(e,t,n){return l.logger.log("Persisting sync data up to",e),o.promiseTry((()=>{const r=this.db.transaction(["sync"],"readwrite");return r.objectStore("sync").put({clobber:"-",nextBatch:e,roomsData:t,groupsData:n}),h(r).then()}))}persistAccountData(e){return o.promiseTry((()=>{const t=this.db.transaction(["accountData"],"readwrite"),n=t.objectStore("accountData");for(let t=0;t<e.length;t++)n.put(e[t]);return h(t).then()}))}persistUserPresenceEvents(e){return o.promiseTry((()=>{const t=this.db.transaction(["users"],"readwrite"),n=t.objectStore("users");for(const t of e)n.put({userId:t[0],event:t[1]});return h(t).then()}))}getUserPresenceEvents(){return o.promiseTry((()=>u(this.db.transaction(["users"],"readonly").objectStore("users"),void 0,(e=>[e.value.userId,e.value.event]))))}loadAccountData(){return l.logger.log("LocalIndexedDBStoreBackend: loading account data..."),o.promiseTry((()=>u(this.db.transaction(["accountData"],"readonly").objectStore("accountData"),void 0,(e=>e.value)).then((e=>(l.logger.log("LocalIndexedDBStoreBackend: loaded account data"),e)))))}loadSyncData(){return l.logger.log("LocalIndexedDBStoreBackend: loading sync data..."),o.promiseTry((()=>u(this.db.transaction(["sync"],"readonly").objectStore("sync"),void 0,(e=>e.value)).then((e=>(l.logger.log("LocalIndexedDBStoreBackend: loaded sync data"),e.length>1&&l.logger.warn("loadSyncData: More than 1 sync row found."),e.length>0?e[0]:{})))))}getClientOptions(){return Promise.resolve().then((()=>u(this.db.transaction(["client_options"],"readonly").objectStore("client_options"),void 0,(e=>{if(e.value&&e.value&&e.value.options)return e.value.options})).then((e=>e[0]))))}async storeClientOptions(e){const t=this.db.transaction(["client_options"],"readwrite");t.objectStore("client_options").put({clobber:"-",options:e}),await h(t)}}},4215:(e,t,n)=>{"use strict";var r=n(5318);Object.defineProperty(t,"__esModule",{value:!0}),t.RemoteIndexedDBStoreBackend=void 0;var i=r(n(9713)),s=n(7434),o=n(3102);t.RemoteIndexedDBStoreBackend=class{constructor(e,t){this.workerFactory=e,this.dbName=t,(0,i.default)(this,"worker",void 0),(0,i.default)(this,"nextSeq",0),(0,i.default)(this,"inFlight",{}),(0,i.default)(this,"startPromise",null),(0,i.default)(this,"onWorkerMessage",(e=>{const t=e.data;if("cmd_success"==t.command||"cmd_fail"==t.command){if(void 0===t.seq)return void s.logger.error("Got reply from worker with no seq");const e=this.inFlight[t.seq];if(void 0===e)return void s.logger.error("Got reply for unknown seq "+t.seq);if(delete this.inFlight[t.seq],"cmd_success"==t.command)e.resolve(t.result);else{const n=new Error(t.error.message);n.name=t.error.name,e.reject(n)}}else s.logger.warn("Unrecognised message from worker: ",t)}))}connect(){return this.ensureStarted().then((()=>this.doCmd("connect")))}clearDatabase(){return this.ensureStarted().then((()=>this.doCmd("clearDatabase")))}isNewlyCreated(){return this.doCmd("isNewlyCreated")}getSavedSync(){return this.doCmd("getSavedSync")}getNextBatchToken(){return this.doCmd("getNextBatchToken")}setSyncData(e){return this.doCmd("setSyncData",[e])}syncToDatabase(e){return this.doCmd("syncToDatabase",[e])}getOutOfBandMembers(e){return this.doCmd("getOutOfBandMembers",[e])}setOutOfBandMembers(e,t){return this.doCmd("setOutOfBandMembers",[e,t])}clearOutOfBandMembers(e){return this.doCmd("clearOutOfBandMembers",[e])}getClientOptions(){return this.doCmd("getClientOptions")}storeClientOptions(e){return this.doCmd("storeClientOptions",[e])}getUserPresenceEvents(){return this.doCmd("getUserPresenceEvents")}ensureStarted(){return null===this.startPromise&&(this.worker=this.workerFactory(),this.worker.onmessage=this.onWorkerMessage,this.startPromise=this.doCmd("_setupWorker",[this.dbName]).then((()=>{s.logger.log("IndexedDB worker is ready")}))),this.startPromise}doCmd(e,t){return Promise.resolve().then((()=>{const n=this.nextSeq++,r=(0,o.defer)();return this.inFlight[n]=r,this.worker.postMessage({command:e,seq:n,args:t}),r.promise}))}}},9789:(e,t,n)=>{"use strict";var r=n(5318);Object.defineProperty(t,"__esModule",{value:!0}),t.IndexedDBStore=void 0;var i=r(n(9713)),s=n(7187),o=n(1703),a=n(3861),l=n(4215),c=n(3998),d=n(4369),u=n(7434);class h extends o.MemoryStore{static exists(e,t){return a.LocalIndexedDBStoreBackend.exists(e,t)}constructor(e){if(super(e),(0,i.default)(this,"backend",void 0),(0,i.default)(this,"startedUp",!1),(0,i.default)(this,"syncTs",0),(0,i.default)(this,"userModifiedMap",{}),(0,i.default)(this,"emitter",new s.EventEmitter),(0,i.default)(this,"on",this.emitter.on.bind(this.emitter)),(0,i.default)(this,"getSavedSync",this.degradable((()=>this.backend.getSavedSync()),"getSavedSync")),(0,i.default)(this,"isNewlyCreated",this.degradable((()=>this.backend.isNewlyCreated()),"isNewlyCreated")),(0,i.default)(this,"getSavedSyncToken",this.degradable((()=>this.backend.getNextBatchToken()),"getSavedSyncToken")),(0,i.default)(this,"deleteAllData",this.degradable((()=>(super.deleteAllData(),this.backend.clearDatabase().then((()=>{u.logger.log("Deleted indexeddb data.")}),(e=>{throw u.logger.error(`Failed to delete indexeddb data: ${e}`),e})))))),(0,i.default)(this,"reallySave",this.degradable((()=>{this.syncTs=Date.now();const e=[];for(const t of this.getUsers())this.userModifiedMap[t.userId]!==t.getLastModifiedTime()&&t.events.presence&&(e.push([t.userId,t.events.presence.event]),this.userModifiedMap[t.userId]=t.getLastModifiedTime());return this.backend.syncToDatabase(e)}))),(0,i.default)(this,"setSyncData",this.degradable((e=>this.backend.setSyncData(e)),"setSyncData")),(0,i.default)(this,"getOutOfBandMembers",this.degradable((e=>this.backend.getOutOfBandMembers(e)),"getOutOfBandMembers")),(0,i.default)(this,"setOutOfBandMembers",this.degradable(((e,t)=>(super.setOutOfBandMembers(e,t),this.backend.setOutOfBandMembers(e,t))),"setOutOfBandMembers")),(0,i.default)(this,"clearOutOfBandMembers",this.degradable((e=>(super.clearOutOfBandMembers(e),this.backend.clearOutOfBandMembers(e))),"clearOutOfBandMembers")),(0,i.default)(this,"getClientOptions",this.degradable((()=>this.backend.getClientOptions()),"getClientOptions")),(0,i.default)(this,"storeClientOptions",this.degradable((e=>(super.storeClientOptions(e),this.backend.storeClientOptions(e))),"storeClientOptions")),!e.indexedDB)throw new Error("Missing required option: indexedDB");e.workerFactory?this.backend=new l.RemoteIndexedDBStoreBackend(e.workerFactory,e.dbName):this.backend=new a.LocalIndexedDBStoreBackend(e.indexedDB,e.dbName)}startup(){return this.startedUp?(u.logger.log("IndexedDBStore.startup: already started"),Promise.resolve()):(u.logger.log("IndexedDBStore.startup: connecting to backend"),this.backend.connect().then((()=>(u.logger.log("IndexedDBStore.startup: loading presence events"),this.backend.getUserPresenceEvents()))).then((e=>{u.logger.log("IndexedDBStore.startup: processing presence events"),e.forEach((([e,t])=>{const n=new c.User(e);t&&n.setPresenceEvent(new d.MatrixEvent(t)),this.userModifiedMap[n.userId]=n.getLastModifiedTime(),this.storeUser(n)}))})))}wantsSave(){return Date.now()-this.syncTs>3e5}save(e=!1){return e||this.wantsSave()?this.reallySave():Promise.resolve()}degradable(e,t){const n=super[t];return async(...t)=>{try{return e.call(this,...t)}catch(e){u.logger.error("IndexedDBStore failure, degrading to MemoryStore",e),this.emitter.emit("degraded",e);try{u.logger.log("IndexedDBStore trying to delete degraded data"),await this.backend.clearDatabase(),u.logger.log("IndexedDBStore delete after degrading succeeded")}catch(e){u.logger.warn("IndexedDBStore delete after degrading failed",e)}if(n)return n(...t)}}}}t.IndexedDBStore=h},1703:(e,t,n)=>{"use strict";var r=n(5318);Object.defineProperty(t,"__esModule",{value:!0}),t.MemoryStore=void 0;var i=r(n(9713)),s=n(3998);function o(e){return"string"==typeof e&&!!e&&"undefined"!==e&&"null"!==e||"number"==typeof e}t.MemoryStore=class{constructor(e={}){(0,i.default)(this,"rooms",{}),(0,i.default)(this,"groups",{}),(0,i.default)(this,"users",{}),(0,i.default)(this,"syncToken",null),(0,i.default)(this,"filters",{}),(0,i.default)(this,"accountData",{}),(0,i.default)(this,"localStorage",void 0),(0,i.default)(this,"oobMembers",{}),(0,i.default)(this,"clientOptions",{}),(0,i.default)(this,"onRoomMember",((e,t,n)=>{if("invite"===n.membership)return;const r=this.users[n.userId]||new s.User(n.userId);n.name&&(r.setDisplayName(n.name),n.events.member&&r.setRawDisplayName(n.events.member.getDirectionalContent().displayname)),n.events.member&&n.events.member.getContent().avatar_url&&r.setAvatarUrl(n.events.member.getContent().avatar_url),this.users[r.userId]=r})),this.localStorage=e.localStorage}getSyncToken(){return this.syncToken}isNewlyCreated(){return Promise.resolve(!0)}setSyncToken(e){this.syncToken=e}storeGroup(e){this.groups[e.groupId]=e}getGroup(e){return this.groups[e]||null}getGroups(){return Object.values(this.groups)}storeRoom(e){this.rooms[e.roomId]=e,e.currentState.on("RoomState.members",this.onRoomMember),e.currentState.getMembers().forEach((t=>{this.onRoomMember(null,e.currentState,t)}))}getRoom(e){return this.rooms[e]||null}getRooms(){return Object.values(this.rooms)}removeRoom(e){this.rooms[e]&&this.rooms[e].removeListener("RoomState.members",this.onRoomMember),delete this.rooms[e]}getRoomSummaries(){return Object.values(this.rooms).map((function(e){return e.summary}))}storeUser(e){this.users[e.userId]=e}getUser(e){return this.users[e]||null}getUsers(){return Object.values(this.users)}scrollback(e,t){return[]}storeEvents(e,t,n,r){}storeFilter(e){e&&(this.filters[e.userId]||(this.filters[e.userId]={}),this.filters[e.userId][e.filterId]=e)}getFilter(e,t){return this.filters[e]&&this.filters[e][t]?this.filters[e][t]:null}getFilterIdByName(e){if(!this.localStorage)return null;const t="mxjssdk_memory_filter_"+e;try{const e=this.localStorage.getItem(t);if(o(e))return e}catch(e){}return null}setFilterIdByName(e,t){if(!this.localStorage)return;const n="mxjssdk_memory_filter_"+e;try{o(t)?this.localStorage.setItem(n,t):this.localStorage.removeItem(n)}catch(e){}}storeAccountDataEvents(e){e.forEach((e=>{this.accountData[e.getType()]=e}))}getAccountData(e){return this.accountData[e]}setSyncData(e){return Promise.resolve()}wantsSave(){return!1}save(e){}startup(){return Promise.resolve()}getSavedSync(){return Promise.resolve(null)}getSavedSyncToken(){return Promise.resolve(null)}deleteAllData(){return this.rooms={},this.users={},this.syncToken=null,this.filters={},this.accountData={},Promise.resolve()}getOutOfBandMembers(e){return Promise.resolve(this.oobMembers[e]||null)}setOutOfBandMembers(e,t){return this.oobMembers[e]=t,Promise.resolve()}clearOutOfBandMembers(e){return this.oobMembers={},Promise.resolve()}getClientOptions(){return Promise.resolve(this.clientOptions)}storeClientOptions(e){return this.clientOptions=Object.assign({},e),Promise.resolve()}}},5837:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.WebStorageSessionStore=o;var r=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var n=i(t);if(n&&n.has(e))return n.get(e);var r={},s=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e)if("default"!==o&&Object.prototype.hasOwnProperty.call(e,o)){var a=s?Object.getOwnPropertyDescriptor(e,o):null;a&&(a.get||a.set)?Object.defineProperty(r,o,a):r[o]=e[o]}return r.default=e,n&&n.set(e,r),r}(n(3102));function i(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(i=function(e){return e?n:t})(e)}n(7434);const s="session.e2e.";function o(e){if(this.store=e,!(r.isFunction(e.getItem)&&r.isFunction(e.setItem)&&r.isFunction(e.removeItem)&&r.isFunction(e.key)&&"number"==typeof e.length))throw new Error("Supplied webStore does not meet the WebStorage API interface")}o.prototype={removeEndToEndAccount:function(){this.store.removeItem(a)},getEndToEndAccount:function(){return this.store.getItem(a)},getAllEndToEndDevices:function(){const e=u(""),t={};for(let n=0;n<this.store.length;++n){const r=this.store.key(n),i=r.substr(e.length);r.startsWith(e)&&(t[i]=m(this.store,r))}return t},getEndToEndDeviceTrackingStatus:function(){return m(this.store,c)},getEndToEndDeviceSyncToken:function(){return m(this.store,l)},removeEndToEndDeviceData:function(){f(this.store,u("")),f(this.store,c),f(this.store,l)},getEndToEndSessions:function(e){return m(this.store,h(e))},getAllEndToEndSessions:function(){const e=g(this.store,h("")),t={};for(const n of e)t[n.substr(h("").length)]=m(this.store,n);return t},removeAllEndToEndSessions:function(){f(this.store,h(""))},getAllEndToEndInboundGroupSessionKeys:function(){const e=s+"inboundgroupsessions/",t=[];for(let n=0;n<this.store.length;n++){const r=this.store.key(n);r.startsWith(e)&&t.push({senderKey:r.substr(e.length,43),sessionId:r.substr(e.length+44)})}return t},getEndToEndInboundGroupSession:function(e,t){const n=function(e,t){return s+"inboundgroupsessions/"+e+"/"+t}(e,t);return this.store.getItem(n)},removeAllEndToEndInboundGroupSessions:function(){f(this.store,s+"inboundgroupsessions/")},getAllEndToEndRooms:function(){const e=g(this.store,p("")),t={};for(const n of e)t[n.substr(p("").length)]=m(this.store,n);return t},removeAllEndToEndRooms:function(){f(this.store,p(""))},setLocalTrustedBackupPubKey:function(e){this.store.setItem(d,e)},getLocalTrustedBackupPubKey:function(){return this.store.getItem(d)}};const a=s+"account",l=s+"device_sync_token",c=s+"device_tracking",d=s+"trusted_backup_pubkey";function u(e){return s+"devices/"+e}function h(e){return s+"sessions/"+e}function p(e){return s+"rooms/"+e}function m(e,t){try{return JSON.parse(e.getItem(t))}catch(e){y(),y(e.stack)}return null}function g(e,t){const n=[];for(let r=0;r<e.length;++r){const i=e.key(r);i.startsWith(t)&&n.push(i)}return n}function f(e,t){const n=[];for(let r=0;r<e.length;++r){const i=e.key(r);i.startsWith(t)&&n.push(i)}for(const t of n)e.removeItem(t)}function y(...e){}},5641:(e,t,n)=>{"use strict";var r=n(5318);Object.defineProperty(t,"__esModule",{value:!0}),t.StubStore=void 0;var i=r(n(9713));t.StubStore=class{constructor(){(0,i.default)(this,"accountData",{}),(0,i.default)(this,"fromToken",null)}isNewlyCreated(){return Promise.resolve(!0)}getSyncToken(){return this.fromToken}setSyncToken(e){this.fromToken=e}storeGroup(e){}getGroup(e){return null}getGroups(){return[]}storeRoom(e){}getRoom(e){return null}getRooms(){return[]}removeRoom(e){}getRoomSummaries(){return[]}storeUser(e){}getUser(e){return null}getUsers(){return[]}scrollback(e,t){return[]}storeEvents(e,t,n,r){}storeFilter(e){}getFilter(e,t){return null}getFilterIdByName(e){return null}setFilterIdByName(e,t){}storeAccountDataEvents(e){}getAccountData(e){}setSyncData(e){return Promise.resolve()}wantsSave(){return!1}save(){}startup(){return Promise.resolve()}getSavedSync(){return Promise.resolve(null)}getSavedSyncToken(){return Promise.resolve(null)}deleteAllData(){return Promise.resolve()}getOutOfBandMembers(){return Promise.resolve(null)}setOutOfBandMembers(e,t){return Promise.resolve()}clearOutOfBandMembers(){return Promise.resolve()}getClientOptions(){return Promise.resolve({})}storeClientOptions(e){return Promise.resolve()}}},2741:(e,t,n)=>{"use strict";var r=n(5318);Object.defineProperty(t,"__esModule",{value:!0}),t.SyncAccumulator=t.Category=void 0;var i=r(n(9713)),s=n(7434),o=n(3102);let a;function l(e,t){null!==t.state_key&&void 0!==t.state_key&&t.type&&(e[t.type]||(e[t.type]=Object.create(null)),e[t.type][t.state_key]=t)}t.Category=a,function(e){e.Invite="invite",e.Leave="leave",e.Join="join"}(a||(t.Category=a={})),t.SyncAccumulator=class{constructor(e={}){this.opts=e,(0,i.default)(this,"accountData",{}),(0,i.default)(this,"inviteRooms",{}),(0,i.default)(this,"joinRooms",{}),(0,i.default)(this,"nextBatch",null),(0,i.default)(this,"groups",{invite:{},join:{},leave:{}}),this.opts.maxTimelineEntries=this.opts.maxTimelineEntries||50}accumulate(e,t=!1){this.accumulateRooms(e,t),this.accumulateGroups(e),this.accumulateAccountData(e),this.nextBatch=e.next_batch}accumulateAccountData(e){e.account_data&&e.account_data.events&&e.account_data.events.forEach((e=>{this.accountData[e.type]=e}))}accumulateRooms(e,t=!1){e.rooms&&(e.rooms.invite&&Object.keys(e.rooms.invite).forEach((n=>{this.accumulateRoom(n,a.Invite,e.rooms.invite[n],t)})),e.rooms.join&&Object.keys(e.rooms.join).forEach((n=>{this.accumulateRoom(n,a.Join,e.rooms.join[n],t)})),e.rooms.leave&&Object.keys(e.rooms.leave).forEach((n=>{this.accumulateRoom(n,a.Leave,e.rooms.leave[n],t)})))}accumulateRoom(e,t,n,r=!1){switch(t){case a.Invite:this.accumulateInviteState(e,n);break;case a.Join:this.inviteRooms[e]&&delete this.inviteRooms[e],this.accumulateJoinState(e,n,r);break;case a.Leave:this.inviteRooms[e]?delete this.inviteRooms[e]:delete this.joinRooms[e];break;default:s.logger.error("Unknown cateogory: ",t)}}accumulateInviteState(e,t){if(!t.invite_state||!t.invite_state.events)return;if(!this.inviteRooms[e])return void(this.inviteRooms[e]={invite_state:t.invite_state});const n=this.inviteRooms[e];t.invite_state.events.forEach((e=>{let t=!1;for(let r=0;r<n.invite_state.events.length;r++){const i=n.invite_state.events[r];i.type===e.type&&i.state_key==e.state_key&&(n.invite_state.events[r]=e,t=!0)}t||n.invite_state.events.push(e)}))}accumulateJoinState(e,t,n=!1){this.joinRooms[e]||(this.joinRooms[e]={_currentState:Object.create(null),_timeline:[],_accountData:Object.create(null),_unreadNotifications:{},_summary:{},_readReceipts:{}});const r=this.joinRooms[e];if(t.account_data&&t.account_data.events&&t.account_data.events.forEach((e=>{r._accountData[e.type]=e})),t.unread_notifications&&(r._unreadNotifications=t.unread_notifications),t.summary){const e="m.heroes",n="m.invited_member_count",i="m.joined_member_count",s=r._summary,o=t.summary;s[e]=o[e]||s[e],s[i]=o[i]||s[i],s[n]=o[n]||s[n]}if(t.ephemeral&&t.ephemeral.events&&t.ephemeral.events.forEach((e=>{"m.receipt"===e.type&&e.content&&Object.keys(e.content).forEach((t=>{e.content[t]["m.read"]&&Object.keys(e.content[t]["m.read"]).forEach((n=>{r._readReceipts[n]={data:e.content[t]["m.read"][n],eventId:t}}))}))})),t.timeline&&t.timeline.limited&&(r._timeline=[]),t.state&&t.state.events&&t.state.events.forEach((e=>{l(r._currentState,e)})),t.timeline&&t.timeline.events&&t.timeline.events.forEach(((e,i)=>{let s;if(l(r._currentState,e),n)s=e;else{s=Object.assign({},e),void 0!==s.unsigned&&(s.unsigned=Object.assign({},s.unsigned));const t=e.unsigned?e.unsigned.age:e.age;void 0!==t&&(s._localTs=Date.now()-t)}r._timeline.push({event:s,token:0===i?t.timeline.prev_batch:null})})),r._timeline.length>this.opts.maxTimelineEntries)for(let e=r._timeline.length-this.opts.maxTimelineEntries;e<r._timeline.length;e++)if(r._timeline[e].token){r._timeline=r._timeline.slice(e,r._timeline.length);break}}accumulateGroups(e){e.groups&&(e.groups.invite&&Object.keys(e.groups.invite).forEach((t=>{this.accumulateGroup(t,a.Invite,e.groups.invite[t])})),e.groups.join&&Object.keys(e.groups.join).forEach((t=>{this.accumulateGroup(t,a.Join,e.groups.join[t])})),e.groups.leave&&Object.keys(e.groups.leave).forEach((t=>{this.accumulateGroup(t,a.Leave,e.groups.leave[t])})))}accumulateGroup(e,t,n){for(const t of[a.Invite,a.Leave,a.Join])delete this.groups[t][e];this.groups[t][e]=n}getJSON(e=!1){const t={join:{},invite:{},leave:{}};Object.keys(this.inviteRooms).forEach((e=>{t.invite[e]=this.inviteRooms[e]})),Object.keys(this.joinRooms).forEach((n=>{const r=this.joinRooms[n],i={ephemeral:{events:[]},account_data:{events:[]},state:{events:[]},timeline:{events:[],prev_batch:null},unread_notifications:r._unreadNotifications,summary:r._summary};Object.keys(r._accountData).forEach((e=>{i.account_data.events.push(r._accountData[e])}));const s={type:"m.receipt",room_id:n,content:{}};Object.keys(r._readReceipts).forEach((e=>{const t=r._readReceipts[e];s.content[t.eventId]||(s.content[t.eventId]={"m.read":{}}),s.content[t.eventId]["m.read"][e]=t.data})),Object.keys(s.content).length>0&&i.ephemeral.events.push(s),r._timeline.forEach((t=>{if(!i.timeline.prev_batch){if(!t.token)return;i.timeline.prev_batch=t.token}let n;!e&&t.event._localTs?(n=Object.assign({},t.event),void 0!==n.unsigned&&(n.unsigned=Object.assign({},n.unsigned)),delete n._localTs,n.unsigned=n.unsigned||{},n.unsigned.age=Date.now()-t.event._localTs):n=t.event,i.timeline.events.push(n)}));const a=Object.create(null);for(let e=i.timeline.events.length-1;e>=0;e--){const t=i.timeline.events[e];if(null===t.state_key||void 0===t.state_key)continue;const n=(0,o.deepCopy)(t);n.unsigned&&(n.unsigned.prev_content&&(n.content=n.unsigned.prev_content),n.unsigned.prev_sender&&(n.sender=n.unsigned.prev_sender)),l(a,n)}Object.keys(r._currentState).forEach((e=>{Object.keys(r._currentState[e]).forEach((t=>{let n=r._currentState[e][t];a[e]&&a[e][t]&&(n=a[e][t]),i.state.events.push(n)}))})),t.join[n]=i}));const n=[];return Object.keys(this.accountData).forEach((e=>{n.push(this.accountData[e])})),{nextBatch:this.nextBatch,roomsData:t,groupsData:this.groups,accountData:n}}getNextBatchToken(){return this.nextBatch}}},4551:(e,t,n)=>{"use strict";var r=n(5318);Object.defineProperty(t,"__esModule",{value:!0}),t.SyncState=t.SyncApi=void 0;var i=r(n(9713)),s=n(3998),o=n(7366),a=n(142),l=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var n=v(t);if(n&&n.has(e))return n.get(e);var r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var s in e)if("default"!==s&&Object.prototype.hasOwnProperty.call(e,s)){var o=i?Object.getOwnPropertyDescriptor(e,s):null;o&&(o.get||o.set)?Object.defineProperty(r,s,o):r[s]=e[s]}return r.default=e,n&&n.set(e,r),r}(n(3102)),c=n(7906),d=n(8910),u=n(1707),h=n(7434),p=n(9489),m=n(2168),g=n(2741),f=n(7715),y=n(2481);function v(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(v=function(e){return e?n:t})(e)}let b;function w(e,t){return"FILTER_SYNC_"+e+(t?"_"+t:"")}function S(...e){h.logger.log(...e)}var _;function k(e,t){const n=new s.User(t);return e.reEmitter.reEmit(n,["User.avatarUrl","User.displayName","User.presence","User.currentlyActive","User.lastPresenceTs"]),n}t.SyncState=b,function(e){e.Error="ERROR",e.Prepared="PREPARED",e.Stopped="STOPPED",e.Syncing="SYNCING",e.Catchup="CATCHUP",e.Reconnecting="RECONNECTING"}(b||(t.SyncState=b={})),function(e){e.Offline="offline",e.Online="online",e.Unavailable="unavailable"}(_||(_={})),t.SyncApi=class{constructor(e,t={}){var n;this.client=e,this.opts=t,(0,i.default)(this,"_peekRoom",null),(0,i.default)(this,"currentSyncRequest",null),(0,i.default)(this,"syncState",null),(0,i.default)(this,"syncStateData",null),(0,i.default)(this,"catchingUp",!1),(0,i.default)(this,"running",!1),(0,i.default)(this,"keepAliveTimer",null),(0,i.default)(this,"connectionReturnedDefer",null),(0,i.default)(this,"notifEvents",[]),(0,i.default)(this,"failedSyncCount",0),(0,i.default)(this,"storeIsInvalid",!1),(0,i.default)(this,"onOnline",(()=>{S("Browser thinks we are back online"),this.startKeepAlives(0)})),this.opts.initialSyncLimit=null!==(n=this.opts.initialSyncLimit)&&void 0!==n?n:8,this.opts.resolveInvitesToProfiles=this.opts.resolveInvitesToProfiles||!1,this.opts.pollTimeout=this.opts.pollTimeout||3e4,this.opts.pendingEventOrdering=this.opts.pendingEventOrdering||m.PendingEventOrdering.Chronological,this.opts.experimentalThreadSupport=!0===this.opts.experimentalThreadSupport,t.canResetEntireTimeline||(t.canResetEntireTimeline=e=>!1),e.getNotifTimelineSet()&&e.reEmitter.reEmit(e.getNotifTimelineSet(),["Room.timeline","Room.timelineReset"])}createRoom(e){const t=this.client,{timelineSupport:n,unstableClientRelationAggregation:r}=t,i=new o.Room(e,t,t.getUserId(),{lazyLoadMembers:this.opts.lazyLoadMembers,pendingEventOrdering:this.opts.pendingEventOrdering,timelineSupport:n,unstableClientRelationAggregation:r});return t.reEmitter.reEmit(i,["Room.name","Room.timeline","Room.redaction","Room.redactionCancelled","Room.receipt","Room.tags","Room.timelineReset","Room.localEchoUpdated","Room.accountData","Room.myMembership","Room.replaceEvent","Room.visibilityChange"]),this.registerStateListeners(i),i}createGroup(e){const t=this.client,n=new a.Group(e);return t.reEmitter.reEmit(n,["Group.profile","Group.myMembership"]),t.store.storeGroup(n),n}registerStateListeners(e){const t=this.client;t.reEmitter.reEmit(e.currentState,["RoomState.events","RoomState.members","RoomState.newMember"]),e.currentState.on("RoomState.newMember",(function(e,n,r){r.user=t.getUser(r.userId),t.reEmitter.reEmit(r,["RoomMember.name","RoomMember.typing","RoomMember.powerLevel","RoomMember.membership"])}))}deregisterStateListeners(e){e.currentState.removeAllListeners("RoomState.events"),e.currentState.removeAllListeners("RoomState.members"),e.currentState.removeAllListeners("RoomState.newMember")}syncLeftRooms(){const e=this.client,t=new c.Filter(this.client.credentials.userId);t.setTimelineLimit(1),t.setIncludeLeaveRooms(!0);const n=this.opts.pollTimeout+8e4,r={timeout:0};return e.getOrCreateFilter(w(e.credentials.userId,"LEFT_ROOMS"),t).then((function(t){return r.filter=t,e.http.authedRequest(void 0,f.Method.Get,"/sync",r,void 0,n)})).then((t=>{var n;let r=[];null!==(n=t.rooms)&&void 0!==n&&n.leave&&(r=this.mapSyncResponseToRoomArray(t.rooms.leave));const i=[];return r.forEach((async t=>{const n=t.room;if(i.push(n),!t.isBrandNewRoom)return;t.timeline=t.timeline||{};const r=this.mapSyncEventsFormat(t.timeline,n),[s,o]=this.client.partitionThreadedEvents(r),a=this.mapSyncEventsFormat(t.state,n);n.getLiveTimeline().setPaginationToken(t.timeline.prev_batch,d.EventTimeline.BACKWARDS),this.processRoomEvents(n,a,s),await this.processThreadEvents(n,o),n.recalculate(),e.store.storeRoom(n),e.emit("Room",n),this.processEventsForNotifs(n,r)})),i}))}peek(e){if(this._peekRoom&&this._peekRoom.roomId===e)return Promise.resolve(this._peekRoom);const t=this.client;return this._peekRoom=this.createRoom(e),this.client.roomInitialSync(e,20).then((e=>{e.messages=e.messages||{chunk:[]},e.messages.chunk=e.messages.chunk||[],e.state=e.state||[];const n=l.deepCopy(e.state).map(t.getEventMapper()),r=e.state.map(t.getEventMapper()),i=e.messages.chunk.map(t.getEventMapper());return e.presence&&Array.isArray(e.presence)&&e.presence.map(t.getEventMapper()).forEach((function(e){let n=t.store.getUser(e.getContent().user_id);n?n.setPresenceEvent(e):(n=k(t,e.getContent().user_id),n.setPresenceEvent(e),t.store.storeUser(n)),t.emit("event",e)})),e.messages.start&&(this._peekRoom.oldState.paginationToken=e.messages.start),this._peekRoom.oldState.setStateEvents(n),this._peekRoom.currentState.setStateEvents(r),this.resolveInvites(this._peekRoom),this._peekRoom.recalculate(),this._peekRoom.addEventsToTimeline(i.reverse(),!0,this._peekRoom.getLiveTimeline(),e.messages.start),t.store.storeRoom(this._peekRoom),t.emit("Room",this._peekRoom),this.peekPoll(this._peekRoom),this._peekRoom}))}stopPeeking(){this._peekRoom=null}peekPoll(e,t){this._peekRoom===e?this.client.http.authedRequest(void 0,f.Method.Get,"/events",{room_id:e.roomId,timeout:String(3e4),from:t},void 0,5e4).then((t=>{if(this._peekRoom!==e)return void S("Stopped peeking in room %s",e.roomId);t.chunk.filter((function(e){return"m.presence"===e.type})).map(this.client.getEventMapper()).forEach((e=>{let t=this.client.store.getUser(e.getContent().user_id);t?t.setPresenceEvent(e):(t=k(this.client,e.getContent().user_id),t.setPresenceEvent(e),this.client.store.storeUser(t)),this.client.emit("event",e)}));const n=t.chunk.filter((function(t){return t.room_id===e.roomId&&t.event_id})).map(this.client.getEventMapper());e.addLiveEvents(n),this.peekPoll(e,t.end)}),(n=>{h.logger.error("[%s] Peek poll failed: %s",e.roomId,n),setTimeout((()=>{this.peekPoll(e,t)}),3e4)})):S("Stopped peeking in room %s",e.roomId)}getSyncState(){return this.syncState}getSyncStateData(){return this.syncStateData}async recoverFromSyncStartupError(e,t){await e;const n=this.startKeepAlives();this.updateSyncState(b.Error,{error:t}),await n}async wasLazyLoadingToggled(e=!1){let t=!1;if(!await this.client.store.isNewlyCreated()){const n=await this.client.store.getClientOptions();return n&&(t=!!n.lazyLoadMembers),t!==e}return!1}shouldAbortSync(e){return"M_UNKNOWN_TOKEN"===e.errcode&&(h.logger.warn("Token no longer valid - assuming logout"),this.stop(),this.updateSyncState(b.Error,{error:e}),!0)}sync(){const e=this.client;this.running=!0,n.g.window&&n.g.window.addEventListener&&n.g.window.addEventListener("online",this.onOnline,!1);let t=Promise.resolve(),r=null;const i=async()=>{try{S("Getting push rules...");const t=await e.getPushRules();S("Got push rules"),e.pushRules=t}catch(e){if(h.logger.error("Getting push rules failed",e),this.shouldAbortSync(e))return;return S("Waiting for saved sync before retrying push rules..."),await this.recoverFromSyncStartupError(t,e),void i()}o()},s=()=>{const t=new c.Filter(e.credentials.userId);return t.setTimelineLimit(this.opts.initialSyncLimit),t},o=async()=>{if(S("Checking lazy load status..."),this.opts.lazyLoadMembers&&e.isGuest()&&(this.opts.lazyLoadMembers=!1),this.opts.lazyLoadMembers&&(S("Checking server lazy load support..."),await e.doesServerSupportLazyLoading()?(S("Enabling lazy load on sync filter..."),this.opts.filter||(this.opts.filter=s()),this.opts.filter.setLazyLoadMembers(!0)):(S("LL: lazy loading requested but not supported by server, so disabling"),this.opts.lazyLoadMembers=!1)),S("Checking whether lazy loading has changed in store..."),await this.wasLazyLoadingToggled(this.opts.lazyLoadMembers)){this.storeIsInvalid=!0;const e=p.InvalidStoreError.TOGGLED_LAZY_LOADING,t=new p.InvalidStoreError(e,!!this.opts.lazyLoadMembers);return this.updateSyncState(b.Error,{error:t}),void h.logger.warn("InvalidStoreError: store is not usable: stopping sync.")}this.opts.lazyLoadMembers&&this.opts.crypto&&this.opts.crypto.enableLazyLoading();try{S("Storing client options..."),await this.client.storeClientOptions(),S("Stored client options")}catch(e){throw h.logger.error("Storing client options failed",e),e}a()},a=async()=>{let n,i;S("Getting filter..."),n=this.opts.filter?this.opts.filter:s();try{i=await e.getOrCreateFilter(w(e.credentials.userId),n)}catch(e){if(h.logger.error("Getting filter failed",e),this.shouldAbortSync(e))return;return S("Waiting for saved sync before retrying filter..."),await this.recoverFromSyncStartupError(t,e),void a()}e.resetNotifTimelineSet(),null===this.currentSyncRequest&&(S("Sending first sync request..."),this.currentSyncRequest=this.doSyncRequest({filterId:i},r)),S("Waiting for saved sync before starting sync processing..."),await t,this.doSync({filterId:i})};e.isGuest()?this.doSync({}):(S("Getting saved sync token..."),t=e.store.getSavedSyncToken().then((t=>(S("Got saved sync token"),r=t,S("Getting saved sync..."),e.store.getSavedSync()))).then((e=>{if(S(`Got reply from saved sync, exists? ${!!e}`),e)return this.syncFromCache(e)})).catch((e=>{h.logger.error("Getting saved sync failed",e)})),i())}stop(){S("SyncApi.stop"),n.g.window&&n.g.window.removeEventListener&&n.g.window.removeEventListener("online",this.onOnline,!1),this.running=!1,this.currentSyncRequest&&this.currentSyncRequest.abort(),this.keepAliveTimer&&(clearTimeout(this.keepAliveTimer),this.keepAliveTimer=null)}retryImmediately(){return!!this.connectionReturnedDefer&&(this.startKeepAlives(0),!0)}async syncFromCache(e){S("sync(): not doing HTTP hit, instead returning stored /sync data");const t=e.nextBatch;this.client.store.setSyncToken(t);const n={oldSyncToken:null,nextSyncToken:t,catchingUp:!1,fromCache:!0},r={next_batch:t,rooms:e.roomsData,groups:e.groupsData,account_data:{events:e.accountData}};try{await this.processSyncResponse(n,r)}catch(e){h.logger.error("Error processing cached sync",e.stack||e)}this.storeIsInvalid||this.updateSyncState(b.Prepared,n)}async doSync(e){const t=this.client;if(!this.running)return S("Sync no longer running: exiting."),this.connectionReturnedDefer&&(this.connectionReturnedDefer.reject(),this.connectionReturnedDefer=null),void this.updateSyncState(b.Stopped);const n=t.store.getSyncToken();let r;try{null===this.currentSyncRequest&&(this.currentSyncRequest=this.doSyncRequest(e,n)),r=await this.currentSyncRequest}catch(t){return void this.onSyncError(t,e)}finally{this.currentSyncRequest=null}t.store.setSyncToken(r.next_batch),this.failedSyncCount=0,await t.store.setSyncData(r);const i={oldSyncToken:n,nextSyncToken:r.next_batch,catchingUp:this.catchingUp};this.opts.crypto&&await this.opts.crypto.onSyncWillProcess(i);try{await this.processSyncResponse(i,r)}catch(e){h.logger.error("Caught /sync error",e.stack||e),this.client.emit("sync.unexpectedError",e)}i.catchingUp=this.catchingUp,e.hasSyncedBefore||(this.updateSyncState(b.Prepared,i),e.hasSyncedBefore=!0),this.opts.crypto&&await this.opts.crypto.onSyncCompleted(i),this.updateSyncState(b.Syncing,i),t.store.wantsSave()&&(this.opts.crypto&&await this.opts.crypto.saveDeviceList(0),t.store.save()),this.doSync(e)}doSyncRequest(e,t){const n=this.getSyncParams(e,t);return this.client.http.authedRequest(void 0,f.Method.Get,"/sync",n,void 0,n.timeout+8e4)}getSyncParams(e,t){let n=this.opts.pollTimeout;("SYNCING"!==this.getSyncState()||this.catchingUp)&&(this.catchingUp=!0,n=0);let r=e.filterId;this.client.isGuest()&&!r&&(r=this.getGuestFilter());const i={filter:r,timeout:n};return this.opts.disablePresence&&(i.set_presence=_.Offline),t?i.since=t:i._cacheBuster=Date.now(),"ERROR"!=this.getSyncState()&&"RECONNECTING"!=this.getSyncState()||(i.timeout=0),i}onSyncError(e,t){if(!this.running)return S("Sync no longer running: exiting"),this.connectionReturnedDefer&&(this.connectionReturnedDefer.reject(),this.connectionReturnedDefer=null),void this.updateSyncState(b.Stopped);h.logger.error("/sync error %s",e),h.logger.error(e),this.shouldAbortSync(e)||(this.failedSyncCount++,h.logger.log("Number of consecutive failed sync requests:",this.failedSyncCount),S("Starting keep-alive"),this.startKeepAlives().then((e=>{e&&this.getSyncState()===b.Error&&this.updateSyncState(b.Catchup,{oldSyncToken:null,nextSyncToken:null,catchingUp:!0}),this.doSync(t)})),this.currentSyncRequest=null,this.updateSyncState(this.failedSyncCount>=3?b.Error:b.Reconnecting,{error:e}))}async processSyncResponse(e,t){const n=this.client;if(t.presence&&Array.isArray(t.presence.events)&&t.presence.events.map(n.getEventMapper()).forEach((function(e){let t=n.store.getUser(e.getSender());t?t.setPresenceEvent(e):(t=k(n,e.getSender()),t.setPresenceEvent(e),n.store.storeUser(t)),n.emit("event",e)})),t.account_data&&Array.isArray(t.account_data.events)){const e=t.account_data.events.map(n.getEventMapper()),r=e.reduce(((e,t)=>(e[t.getId()]=n.store.getAccountData(t.getType()),e)),{});n.store.storeAccountDataEvents(e),e.forEach((function(e){if(e.getType()===y.EventType.PushRules){const t=e.getContent();n.pushRules=u.PushProcessor.rewriteDefaultRules(t)}const t=r[e.getId()];return n.emit("accountData",e,t),e}))}if(t.to_device&&Array.isArray(t.to_device.events)&&t.to_device.events.length>0){const e=[];t.to_device.events.map(n.getEventMapper()).map((t=>{if("m.key.verification.cancel"===t.getType()){const n=t.getContent().transaction_id;n&&e.push(n)}return t})).forEach((function(t){const r=t.getContent();if("m.room.message"!=t.getType()||"m.bad.encrypted"!=r.msgtype){if("m.key.verification.start"===t.getType()||"m.key.verification.request"===t.getType()){const n=r.transaction_id;e.includes(n)&&t.flagCancelled()}n.emit("toDeviceEvent",t)}else h.logger.log("Ignoring undecryptable to-device event from "+t.getSender())}))}else this.catchingUp=!1;t.groups&&(t.groups.invite&&this.processGroupSyncEntry(t.groups.invite,g.Category.Invite),t.groups.join&&this.processGroupSyncEntry(t.groups.join,g.Category.Join),t.groups.leave&&this.processGroupSyncEntry(t.groups.leave,g.Category.Leave));let r=[],i=[],s=[];if(t.rooms&&(t.rooms.invite&&(r=this.mapSyncResponseToRoomArray(t.rooms.invite)),t.rooms.join&&(i=this.mapSyncResponseToRoomArray(t.rooms.join)),t.rooms.leave&&(s=this.mapSyncResponseToRoomArray(t.rooms.leave))),this.notifEvents=[],r.forEach((e=>{const t=e.room,r=this.mapSyncEventsFormat(e.invite_state,t);this.processRoomEvents(t,r),e.isBrandNewRoom&&(t.recalculate(),n.store.storeRoom(t),n.emit("Room",t)),r.forEach((function(e){n.emit("event",e)})),t.updateMyMembership("invite")})),await l.promiseMapSeries(i,(async t=>{const r=t.room,i=this.mapSyncEventsFormat(t.state,r),s=this.mapSyncEventsFormat(t.timeline,r,!1),a=this.mapSyncEventsFormat(t.ephemeral),c=this.mapSyncEventsFormat(t.account_data),u=n.isRoomEncrypted(r.roomId);if(t.unread_notifications&&(r.setUnreadNotificationCount(o.NotificationCountType.Total,t.unread_notifications.notification_count),(!u||u&&r.getUnreadNotificationCount(o.NotificationCountType.Highlight)<=0)&&r.setUnreadNotificationCount(o.NotificationCountType.Highlight,t.unread_notifications.highlight_count)),t.timeline=t.timeline||{},t.isBrandNewRoom)r.getLiveTimeline().setPaginationToken(t.timeline.prev_batch,d.EventTimeline.BACKWARDS);else if(t.timeline.limited){let i=!0;for(let e=s.length-1;e>=0;e--){const t=s[e].getId();if(r.getTimelineForEvent(t)){S("Already have event "+t+" in limited sync - not resetting"),i=!1,s.splice(0,e);break}}i&&(this.deregisterStateListeners(r),r.resetLiveTimeline(t.timeline.prev_batch,this.opts.canResetEntireTimeline(r.roomId)?null:e.oldSyncToken),n.resetNotifTimelineSet(),this.registerStateListeners(r))}const[h,p]=this.client.partitionThreadedEvents(s);this.processRoomEvents(r,i,h,e.fromCache),await this.processThreadEvents(r,p),t.summary&&r.setSummary(t.summary),r.addEphemeralEvents(a),r.addAccountData(c),r.recalculate(),t.isBrandNewRoom&&(n.store.storeRoom(r),n.emit("Room",r)),this.processEventsForNotifs(r,s);const m=async e=>{if(n.emit("event",e),e.isState()&&"m.room.encryption"==e.getType()&&this.opts.crypto&&await this.opts.crypto.onCryptoEvent(e),e.isState()&&"im.vector.user_status"===e.getType()){let t=n.store.getUser(e.getStateKey());t?t.unstable_updateStatusMessage(e):(t=k(n,e.getStateKey()),t.unstable_updateStatusMessage(e),n.store.storeUser(t))}};await l.promiseMapSeries(i,m),await l.promiseMapSeries(h,m),await l.promiseMapSeries(p,m),a.forEach((function(e){n.emit("event",e)})),c.forEach((function(e){n.emit("event",e)})),r.updateMyMembership("join"),r.decryptCriticalEvents()})),s.forEach((async e=>{const t=e.room,r=this.mapSyncEventsFormat(e.state,t),i=this.mapSyncEventsFormat(e.timeline,t),s=this.mapSyncEventsFormat(e.account_data),[o,a]=this.client.partitionThreadedEvents(i);this.processRoomEvents(t,r,o),await this.processThreadEvents(t,a),t.addAccountData(s),t.recalculate(),e.isBrandNewRoom&&(n.store.storeRoom(t),n.emit("Room",t)),this.processEventsForNotifs(t,i),r.forEach((function(e){n.emit("event",e)})),o.forEach((function(e){n.emit("event",e)})),a.forEach((function(e){n.emit("event",e)})),s.forEach((function(e){n.emit("event",e)})),t.updateMyMembership("leave")})),e.oldSyncToken&&this.notifEvents.length&&(this.notifEvents.sort((function(e,t){return e.getTs()-t.getTs()})),this.notifEvents.forEach((function(e){n.getNotifTimelineSet().addLiveEvent(e)}))),t.device_lists&&this.opts.crypto&&await this.opts.crypto.handleDeviceListChanges(e,t.device_lists),this.opts.crypto&&t.device_one_time_keys_count){const e=t.device_one_time_keys_count.signed_curve25519||0;this.opts.crypto.updateOneTimeKeyCount(e)}if(this.opts.crypto&&(t.device_unused_fallback_key_types||t["org.matrix.msc2732.device_unused_fallback_key_types"])){const e=t.device_unused_fallback_key_types||t["org.matrix.msc2732.device_unused_fallback_key_types"];this.opts.crypto.setNeedsNewFallback(e instanceof Array&&!e.includes("signed_curve25519"))}}startKeepAlives(e){return void 0===e&&(e=2e3+Math.floor(5e3*Math.random())),null!==this.keepAliveTimer&&clearTimeout(this.keepAliveTimer),e>0?this.keepAliveTimer=setTimeout(this.pokeKeepAlive.bind(this),e):this.pokeKeepAlive(),this.connectionReturnedDefer||(this.connectionReturnedDefer=l.defer()),this.connectionReturnedDefer.promise}pokeKeepAlive(e=!1){const t=()=>{clearTimeout(this.keepAliveTimer),this.connectionReturnedDefer&&(this.connectionReturnedDefer.resolve(e),this.connectionReturnedDefer=null)};this.client.http.request(void 0,f.Method.Get,"/_matrix/client/versions",void 0,void 0,{prefix:"",localTimeoutMs:15e3}).then((()=>{t()}),(n=>{400==n.httpStatus||404==n.httpStatus?this.keepAliveTimer=setTimeout(t,2e3):(e=!0,this.keepAliveTimer=setTimeout(this.pokeKeepAlive.bind(this,e),5e3+Math.floor(5e3*Math.random())),this.updateSyncState(b.Error,{error:n}))}))}processGroupSyncEntry(e,t){for(const n of Object.keys(e)){const r=e[n];let i=this.client.store.getGroup(n);const s=null===i;null===i&&(i=this.createGroup(n)),r.profile&&i.setProfile(r.profile.name,r.profile.avatar_url),r.inviter&&i.setInviter({userId:r.inviter}),i.setMyMembership(t),s&&this.client.emit("Group",i)}}mapSyncResponseToRoomArray(e){const t=this.client;return Object.keys(e).map((n=>{const r=e[n];let i=t.store.getRoom(n),s=!1;return i||(i=this.createRoom(n),s=!0),r.room=i,r.isBrandNewRoom=s,r}))}mapSyncEventsFormat(e,t,n=!0){if(!e||!Array.isArray(e.events))return[];const r=this.client.getEventMapper({decrypt:n});return e.events.map((function(e){return t&&(e.room_id=t.roomId),r(e)}))}resolveInvites(e){if(!e||!this.opts.resolveInvitesToProfiles)return;const t=this.client;e.getMembersWithMembership("invite").forEach((function(n){if(n._requestedProfileInfo)return;n._requestedProfileInfo=!0;const r=t.getUser(n.userId);let i;i=r?Promise.resolve({avatar_url:r.avatarUrl,displayname:r.displayName}):t.getProfileInfo(n.userId),i.then((function(t){const r=n.events.member;"invite"===r.getContent().membership&&(r.getContent().avatar_url=t.avatar_url,r.getContent().displayname=t.displayname,n.setMembershipEvent(r,e.currentState))}),(function(e){}))}))}processRoomEvents(e,t,n,r=!1){const i=e.getLiveTimeline(),s=0==i.getEvents().length;if(s){for(const e of t)this.client.getPushActionsForEvent(e);i.initialiseState(t)}this.resolveInvites(e),e.recalculate(),s||(e.oldState.setStateEvents(t||[]),e.currentState.setStateEvents(t||[])),e.addLiveEvents(n||[],null,r)}processThreadEvents(e,t){return this.client.processThreadEvents(e,t)}processEventsForNotifs(e,t){if(this.client.getNotifTimelineSet())for(let e=0;e<t.length;e++){const n=this.client.getPushActionsForEvent(t[e]);n&&n.notify&&n.tweaks&&n.tweaks.highlight&&this.notifEvents.push(t[e])}}getGuestFilter(){return"{}"}updateSyncState(e,t){const n=this.syncState;this.syncState=e,this.syncStateData=t,this.client.emit("sync",this.syncState,n,t)}}},4969:(e,t,n)=>{"use strict";var r=n(5318);Object.defineProperty(t,"__esModule",{value:!0}),t.TimelineWindow=t.TimelineIndex=void 0;var i=r(n(9713)),s=n(8910);n(7434);t.TimelineWindow=class{constructor(e,t,n={}){this.client=e,this.timelineSet=t,(0,i.default)(this,"windowLimit",void 0),(0,i.default)(this,"start",null),(0,i.default)(this,"end",null),(0,i.default)(this,"eventCount",0),this.windowLimit=n.windowLimit||1e3}load(e,t=20){const n=n=>{let r;const i=n.getEvents();if(e){for(let t=0;t<i.length;t++)if(i[t].getId()==e){r=t;break}if(void 0===r)throw new Error("getEventTimeline result didn't include requested event")}else r=i.length;const s=Math.min(i.length,r+Math.ceil(t/2)),a=Math.max(0,s-t);this.start=new o(n,a-n.getBaseIndex()),this.end=new o(n,s-n.getBaseIndex()),this.eventCount=s-a};if(e){const t=this.timelineSet.getTimelineForEvent(e);return t?(n(t),Promise.resolve(t)):this.client.getEventTimeline(this.timelineSet,e).then(n)}return n(this.timelineSet.getLiveTimeline()),Promise.resolve()}getTimelineIndex(e){if(e==s.EventTimeline.BACKWARDS)return this.start;if(e==s.EventTimeline.FORWARDS)return this.end;throw new Error("Invalid direction '"+e+"'")}extend(e,t){const n=this.getTimelineIndex(e);if(!n)return!1;const r=e==s.EventTimeline.BACKWARDS?n.retreat(t):n.advance(t);if(r){this.eventCount+=r,this.eventCount;const t=this.eventCount-this.windowLimit;return t>0&&this.unpaginate(t,e!=s.EventTimeline.BACKWARDS),!0}return!1}canPaginate(e){const t=this.getTimelineIndex(e);if(!t)return!1;if(e==s.EventTimeline.BACKWARDS){if(t.index>t.minIndex())return!0}else if(t.index<t.maxIndex())return!0;return Boolean(t.timeline.getNeighbouringTimeline(e)||t.timeline.getPaginationToken(e))}paginate(e,t,n=!0,r=5){const i=this.getTimelineIndex(e);if(!i)return Promise.resolve(!1);if(i.pendingPaginate)return i.pendingPaginate;if(this.extend(e,t))return Promise.resolve(!0);if(!n||0===r)return Promise.resolve(!1);if(!i.timeline.getPaginationToken(e))return Promise.resolve(!1);const o=this.client.paginateEventTimeline(i.timeline,{backwards:e==s.EventTimeline.BACKWARDS,limit:t}).finally((function(){i.pendingPaginate=null})).then((n=>!!n&&this.paginate(e,t,!0,r-1)));return i.pendingPaginate=o,o}unpaginate(e,t){const n=t?this.start:this.end;if(e>this.eventCount||e<0)throw new Error("Attemting to unpaginate "+e+" events, but only have "+this.eventCount+" in the timeline");for(;e>0;){const r=t?n.advance(e):n.retreat(e);if(r<=0)throw new Error("Unable to unpaginate any further, but still have "+this.eventCount+" events");e-=r,this.eventCount-=r,this.eventCount}}getEvents(){if(!this.start)return[];const e=[];let t=this.start.timeline;for(;;){const n=t.getEvents();let r=0,i=n.length;t===this.start.timeline&&(r=this.start.index+t.getBaseIndex()),t===this.end.timeline&&(i=this.end.index+t.getBaseIndex());for(let t=r;t<i;t++)e.push(n[t]);if(t===this.end.timeline)break;t=t.getNeighbouringTimeline(s.EventTimeline.FORWARDS)}return e}};class o{constructor(e,t){this.timeline=e,this.index=t,(0,i.default)(this,"pendingPaginate",void 0)}minIndex(){return-1*this.timeline.getBaseIndex()}maxIndex(){return this.timeline.getEvents().length-this.timeline.getBaseIndex()}advance(e){if(!e)return 0;let t;if(e<0){if(t=Math.max(e,this.minIndex()-this.index),t<0)return this.index+=t,t}else if(t=Math.min(e,this.maxIndex()-this.index),t>0)return this.index+=t,t;const n=this.timeline.getNeighbouringTimeline(e<0?s.EventTimeline.BACKWARDS:s.EventTimeline.FORWARDS);return n?(this.timeline=n,this.index=e<0?this.maxIndex():this.minIndex(),this.advance(e)):0}retreat(e){return-1*this.advance(-1*e)}}t.TimelineIndex=o},3102:(e,t,n)=>{"use strict";var r=n(5318);Object.defineProperty(t,"__esModule",{value:!0}),t.DEFAULT_ALPHABET=void 0,t.alphabetPad=u,t.averageBetweenStrings=function(e,t,n=d){const r=Math.max(e.length,t.length),i=p(u(e,r,n),n),s=p(u(t,r,n),n),o=(i+s)/BigInt(2);return o===i||o==s?h(o,n)+n[0]:h(o,n)},t.baseToString=h,t.checkObjectHasKeys=function(e,t){for(let n=0;n<t.length;n++)if(!e.hasOwnProperty(t[n]))throw new Error("Missing required key: "+t[n])},t.checkObjectHasNoAdditionalKeys=function(e,t){for(const n in e)if(e.hasOwnProperty(n)&&-1===t.indexOf(n))throw new Error("Unknown key: "+n)},t.chunkPromises=async function(e,t){const n=[];for(let r=0;r<e.length;r+=t)n.push(...await Promise.all(e.slice(r,r+t).map((e=>e()))));return n},t.compare=function(e,t){return g.compare(e,t)},t.decodeParams=function(e){const t={},n=new URLSearchParams(e);for(const e of n.keys()){const r=n.getAll(e);t[e]=1===r.length?r[0]:r}return t},t.deepCompare=function e(t,n){if(t===n)return!0;if(typeof t!=typeof n)return!1;if("number"==typeof t&&isNaN(t)&&isNaN(n))return!0;if(null===t||null===n)return t===n;if(!(t instanceof Object))return!1;if(t.constructor!==n.constructor||t.prototype!==n.prototype)return!1;if(t instanceof RegExp||t instanceof Date)return t.toString()===n.toString();if(t instanceof Array){if(t.length!==n.length)return!1;for(let r=0;r<t.length;r++)if(!e(t[r],n[r]))return!1}else{let r;for(r in n)if(n.hasOwnProperty(r)!==t.hasOwnProperty(r))return!1;for(r in n){if(n.hasOwnProperty(r)!==t.hasOwnProperty(r))return!1;if(!e(t[r],n[r]))return!1}}return!0},t.deepCopy=function(e){return JSON.parse(JSON.stringify(e))},t.deepSortedObjectEntries=function e(t){if("object"!=typeof t)return t;if(null==t||Array.isArray(t))return t;const n=[];for(const[r,i]of Object.entries(t))n.push([r,e(i)]);return n.sort(((e,t)=>m(e[0],t[0]))),n},t.defer=function(){let e,t;const n=new Promise(((n,r)=>{e=n,t=r}));return{resolve:e,reject:t,promise:n}},t.encodeParams=function(e){const t=new URLSearchParams;for(const[n,r]of Object.entries(e))null!=r&&t.set(n,String(r));return t.toString()},t.encodeUri=function(e,t){for(const n in t)t.hasOwnProperty(n)&&(e=e.replace(n,encodeURIComponent(t[n])));return e},t.ensureNoTrailingSlash=function(e){return e&&e.endsWith("/")?e.substr(0,e.length-1):e},t.escapeRegExp=l,t.getCrypto=function(){return c},t.globToRegexp=function(e,t){t="boolean"!=typeof t||t;let n=l(e);return n=n.replace(/\\\*/g,".*"),n=n.replace(/\?/g,"."),t&&(n=n.replace(/\\\[(!|)(.*)\\]/g,(function(e,t,n,r,i){return"["+(t?"^":"")+n.replace(/\\-/,"-")+"]"}))),n},t.inherits=function(e,t){e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}})},t.isFunction=function(e){return"[object Function]"===Object.prototype.toString.call(e)},t.isNullOrUndefined=function(e){return null==e},t.isNumber=function(e){return"number"==typeof e&&isFinite(e)},t.lexicographicCompare=m,t.nextString=function(e,t=d){return h(p(e,t)+BigInt(1),t)},t.normalize=function(e){return o(e.toLowerCase()).replace(/[\\'!"#$%&()*+,\-./:;<=>?@[\]^_`{|}~\u2000-\u206f\u2e00-\u2e7f]/g,"").toLowerCase()},t.polyfillSuper=function(e,t,...n){try{t.call(e,...n)}catch(r){const i=new t(...n);Object.assign(e,i)}},t.prevString=function(e,t=d){return h(p(e,t)-BigInt(1),t)},t.promiseMapSeries=async function(e,t){for(const n of e)await t(await n)},t.promiseTry=function(e){return new Promise((t=>t(e())))},t.recursivelyAssign=function e(t,n,r=!1){for(const[i,s]of Object.entries(n))t[i]instanceof Object&&s?e(t[i],s):null==s&&r||(t[i]=s);return t},t.removeDirectionOverrideChars=function(e){return"string"==typeof e?e.replace(/[\u202d-\u202e]/g,""):""},t.removeElement=function(e,t,n){let r;if(n){for(r=e.length-1;r>=0;r--)if(t(e[r],r,e))return e.splice(r,1),!0}else for(r=0;r<e.length;r++)if(t(e[r],r,e))return e.splice(r,1),!0;return!1},t.removeHiddenChars=o,t.setCrypto=function(e){c=e},t.simpleRetryOperation=function(e){return(0,s.default)((t=>e(t)),{forever:!0,factor:2,minTimeout:3e3,maxTimeout:15e3})},t.sleep=function(e,t){return new Promise((n=>{setTimeout(n,e,t)}))},t.stringToBase=p;var i=r(n(5067)),s=r(n(2693));function o(e){return"string"==typeof e?(0,i.default)(e.normalize("NFD").replace(a,"")):""}const a=/[\u2000-\u200F\u202A-\u202F\u0300-\u036F\uFEFF\u061C\s]/g;function l(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}let c;const d=(()=>{let e="";for(let t=32;t<=126;t++)e+=String.fromCharCode(t);return e})();function u(e,t,n=d){return e.padEnd(t,n[0])}function h(e,t=d){const n=BigInt(t.length);var r;if(e<=n)return null!==(r=t[Number(e)-1])&&void 0!==r?r:"";let i=e/n,s=Number(e%n)-1;return s<0&&(i-=BigInt(Math.abs(s)),s=Number(n)-1),h(i,t)+t[s]}function p(e,t=d){const n=BigInt(t.length);let r=BigInt(0);for(let i=e.length-1,s=BigInt(0);i>=0;i--,s++){const o=e.charCodeAt(i)-t.charCodeAt(0);r+=BigInt(1+o)*n**s}return r}function m(e,t){return e<t?-1:e===t?0:1}t.DEFAULT_ALPHABET=d;const g=new Intl.Collator},9679:(e,t,n)=>{"use strict";var r=n(5318);Object.defineProperty(t,"__esModule",{value:!0}),t.MatrixCall=t.CallType=t.CallState=t.CallParty=t.CallEvent=t.CallErrorCode=t.CallError=t.CallDirection=void 0,t.createNewMatrixCall=function(e,t,n){if("undefined"==typeof window||"undefined"==typeof document)return null;try{if(!Boolean(window.RTCPeerConnection||window.RTCSessionDescription||window.RTCIceCandidate||navigator.mediaDevices))return o.logger.error("WebRTC is not supported in this browser / environment"),null}catch(e){return o.logger.error("Exception thrown when trying to access WebRTC",e),null}const r=!!n&&n.forceTURN,i={client:e,roomId:t,turnServers:e.getTurnServers(),forceTURN:e.forceTURN||r},s=new S(i);return e.reEmitter.reEmit(s,Object.values(y)),s};var i=r(n(9713)),s=n(7187),o=n(7434),a=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var n=h(t);if(n&&n.has(e))return n.get(e);var r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var s in e)if("default"!==s&&Object.prototype.hasOwnProperty.call(e,s)){var o=i?Object.getOwnPropertyDescriptor(e,s):null;o&&(o.get||o.set)?Object.defineProperty(r,s,o):r[s]=e[s]}return r.default=e,n&&n.set(e,r),r}(n(3102)),l=n(2481),c=n(8401),d=n(5964),u=n(9704);function h(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(h=function(e){return e?n:t})(e)}let p,m,g,f,y,v;t.CallState=p,function(e){e.Fledgling="fledgling",e.InviteSent="invite_sent",e.WaitLocalMedia="wait_local_media",e.CreateOffer="create_offer",e.CreateAnswer="create_answer",e.Connecting="connecting",e.Connected="connected",e.Ringing="ringing",e.Ended="ended"}(p||(t.CallState=p={})),t.CallType=m,function(e){e.Voice="voice",e.Video="video"}(m||(t.CallType=m={})),t.CallDirection=g,function(e){e.Inbound="inbound",e.Outbound="outbound"}(g||(t.CallDirection=g={})),t.CallParty=f,function(e){e.Local="local",e.Remote="remote"}(f||(t.CallParty=f={})),t.CallEvent=y,function(e){e.Hangup="hangup",e.State="state",e.Error="error",e.Replaced="replaced",e.LocalHoldUnhold="local_hold_unhold",e.RemoteHoldUnhold="remote_hold_unhold",e.HoldUnhold="hold_unhold",e.FeedsChanged="feeds_changed",e.AssertedIdentityChanged="asserted_identity_changed",e.LengthChanged="length_changed",e.DataChannel="datachannel"}(y||(t.CallEvent=y={})),t.CallErrorCode=v,function(e){e.UserHangup="user_hangup",e.LocalOfferFailed="local_offer_failed",e.NoUserMedia="no_user_media",e.UnknownDevices="unknown_devices",e.SendInvite="send_invite",e.CreateAnswer="create_answer",e.SendAnswer="send_answer",e.SetRemoteDescription="set_remote_description",e.SetLocalDescription="set_local_description",e.AnsweredElsewhere="answered_elsewhere",e.IceFailed="ice_failed",e.InviteTimeout="invite_timeout",e.Replaced="replaced",e.SignallingFailed="signalling_timeout",e.UserBusy="user_busy",e.Transfered="transferred"}(v||(t.CallErrorCode=v={}));class b extends Error{constructor(e,t,n){super(t+": "+n),(0,i.default)(this,"code",void 0),this.code=e}}function w(){return Date.now().toString()+(0,c.randomString)(16)}t.CallError=b;class S extends s.EventEmitter{constructor(e){super(),(0,i.default)(this,"roomId",void 0),(0,i.default)(this,"callId",void 0),(0,i.default)(this,"state",p.Fledgling),(0,i.default)(this,"hangupParty",void 0),(0,i.default)(this,"hangupReason",void 0),(0,i.default)(this,"direction",void 0),(0,i.default)(this,"ourPartyId",void 0),(0,i.default)(this,"client",void 0),(0,i.default)(this,"forceTURN",void 0),(0,i.default)(this,"turnServers",void 0),(0,i.default)(this,"candidateSendQueue",[]),(0,i.default)(this,"candidateSendTries",0),(0,i.default)(this,"sentEndOfCandidates",!1),(0,i.default)(this,"peerConn",void 0),(0,i.default)(this,"feeds",[]),(0,i.default)(this,"usermediaSenders",[]),(0,i.default)(this,"screensharingSenders",[]),(0,i.default)(this,"inviteOrAnswerSent",!1),(0,i.default)(this,"waitForLocalAVStream",void 0),(0,i.default)(this,"successor",void 0),(0,i.default)(this,"opponentMember",void 0),(0,i.default)(this,"opponentVersion",void 0),(0,i.default)(this,"opponentPartyId",void 0),(0,i.default)(this,"opponentCaps",void 0),(0,i.default)(this,"inviteTimeout",void 0),(0,i.default)(this,"remoteOnHold",!1),(0,i.default)(this,"callStatsAtEnd",void 0),(0,i.default)(this,"makingOffer",!1),(0,i.default)(this,"ignoreOffer",void 0),(0,i.default)(this,"remoteCandidateBuffer",new Map),(0,i.default)(this,"remoteAssertedIdentity",void 0),(0,i.default)(this,"remoteSDPStreamMetadata",void 0),(0,i.default)(this,"callLengthInterval",void 0),(0,i.default)(this,"callLength",0),(0,i.default)(this,"gotLocalIceCandidate",(e=>{if(e.candidate){if(o.logger.debug("Call "+this.callId+" got local ICE "+e.candidate.sdpMid+" candidate: "+e.candidate.candidate),this.callHasEnded())return;""===e.candidate.candidate&&this.sentEndOfCandidates||(this.queueCandidate(e.candidate),""===e.candidate.candidate&&(this.sentEndOfCandidates=!0))}})),(0,i.default)(this,"onIceGatheringStateChange",(e=>{if(o.logger.debug("ice gathering state changed to "+this.peerConn.iceGatheringState),"complete"===this.peerConn.iceGatheringState&&!this.sentEndOfCandidates){const e={candidate:""};this.queueCandidate(e),this.sentEndOfCandidates=!0}})),(0,i.default)(this,"gotLocalOffer",(async e=>{if(o.logger.debug("Created offer: ",e),this.callHasEnded())return void o.logger.debug("Ignoring newly created offer on call ID "+this.callId+" because the call has ended");try{await this.peerConn.setLocalDescription(e)}catch(e){return o.logger.debug("Error setting local description!",e),void this.terminate(f.Local,v.SetLocalDescription,!0)}if("gathering"===this.peerConn.iceGatheringState&&await new Promise((e=>{setTimeout(e,200)})),this.callHasEnded())return;const t=this.state===p.CreateOffer?l.EventType.CallInvite:l.EventType.CallNegotiate,n={lifetime:6e4};this.state===p.CreateOffer?n.offer=this.peerConn.localDescription:n.description=this.peerConn.localDescription,n.capabilities={"m.call.transferee":this.client.supportsCallTransfer,"m.call.dtmf":!1},n[d.SDPStreamMetadataKey]=this.getLocalSDPStreamMetadata(),o.logger.info(`Discarding ${this.candidateSendQueue.length} candidates that will be sent in offer`),this.candidateSendQueue=[];try{await this.sendVoipEvent(t,n)}catch(e){o.logger.error("Failed to send invite",e),e.event&&this.client.cancelPendingEvent(e.event);let t=v.SignallingFailed,n="Signalling failed";return this.state===p.CreateOffer&&(t=v.SendInvite,n="Failed to send invite"),"UnknownDeviceError"==e.name&&(t=v.UnknownDevices,n="Unknown devices present in the room"),this.emit(y.Error,new b(t,n,e)),void this.terminate(f.Local,t,!1)}this.sendCandidateQueue(),this.state===p.CreateOffer&&(this.inviteOrAnswerSent=!0,this.setState(p.InviteSent),this.inviteTimeout=setTimeout((()=>{this.inviteTimeout=null,this.state===p.InviteSent&&this.hangup(v.InviteTimeout,!1)}),6e4))})),(0,i.default)(this,"getLocalOfferFailed",(e=>{o.logger.error("Failed to get local offer",e),this.emit(y.Error,new b(v.LocalOfferFailed,"Failed to get local offer!",e)),this.terminate(f.Local,v.LocalOfferFailed,!1)})),(0,i.default)(this,"getUserMediaFailed",(e=>{this.successor?this.successor.getUserMediaFailed(e):(o.logger.warn("Failed to get user media - ending call",e),this.emit(y.Error,new b(v.NoUserMedia,"Couldn't start capturing media! Is your microphone set up and does this app have permission?",e)),this.terminate(f.Local,v.NoUserMedia,!1))})),(0,i.default)(this,"onIceConnectionStateChanged",(()=>{this.callHasEnded()||(o.logger.debug("Call ID "+this.callId+": ICE connection state changed to: "+this.peerConn.iceConnectionState),"connected"==this.peerConn.iceConnectionState?(this.setState(p.Connected),this.callLengthInterval||(this.callLengthInterval=setInterval((()=>{this.callLength++,this.emit(y.LengthChanged,this.callLength)}),1e3))):"failed"==this.peerConn.iceConnectionState&&this.hangup(v.IceFailed,!1))})),(0,i.default)(this,"onSignallingStateChanged",(()=>{o.logger.debug("call "+this.callId+": Signalling state changed to: "+this.peerConn.signalingState)})),(0,i.default)(this,"onTrack",(e=>{if(0===e.streams.length)return void o.logger.warn(`Streamless ${e.track.kind} found: ignoring.`);const t=e.streams[0];this.pushRemoteFeed(t),t.addEventListener("removetrack",(()=>{0===t.getTracks().length&&(o.logger.info(`Stream ID ${t.id} has no tracks remaining - removing`),this.deleteFeedByStream(t))}))})),(0,i.default)(this,"onDataChannel",(e=>{this.emit(y.DataChannel,e.channel)})),(0,i.default)(this,"onNegotiationNeeded",(async()=>{if(o.logger.info("Negotiation is needed!"),this.state===p.CreateOffer||0!==this.opponentVersion){this.makingOffer=!0;try{this.getRidOfRTXCodecs();const e=await this.peerConn.createOffer();await this.gotLocalOffer(e)}catch(e){return void this.getLocalOfferFailed(e)}finally{this.makingOffer=!1}}else o.logger.info("Opponent does not support renegotiation: ignoring negotiationneeded event")})),(0,i.default)(this,"onHangupReceived",(e=>{o.logger.debug("Hangup received for call ID "+this.callId),this.partyIdMatches(e)||this.state===p.Ringing?this.terminate(f.Remote,e.reason||v.UserHangup,!0):o.logger.info(`Ignoring message from party ID ${e.party_id}: our partner is ${this.opponentPartyId}`)})),(0,i.default)(this,"onRejectReceived",(e=>{o.logger.debug("Reject received for call ID "+this.callId),[p.InviteSent,p.Ringing].includes(this.state)||this.state===p.Fledgling&&this.direction===g.Inbound?this.terminate(f.Remote,e.reason||v.UserHangup,!0):o.logger.debug(`Call is in state: ${this.state}: ignoring reject`)})),(0,i.default)(this,"onAnsweredElsewhere",(e=>{o.logger.debug("Call ID "+this.callId+" answered elsewhere"),this.terminate(f.Remote,v.AnsweredElsewhere,!0)})),this.roomId=e.roomId,this.client=e.client,this.forceTURN=e.forceTURN,this.ourPartyId=this.client.deviceId,this.turnServers=e.turnServers||[],0===this.turnServers.length&&this.client.isFallbackICEServerAllowed()&&this.turnServers.push({urls:["stun:turn.matrix.org"]});for(const e of this.turnServers)a.checkObjectHasKeys(e,["urls"]);this.callId=w()}async placeVoiceCall(){await this.placeCall(!0,!1)}async placeVideoCall(){await this.placeCall(!0,!0)}createDataChannel(e,t){const n=this.peerConn.createDataChannel(e,t);return this.emit(y.DataChannel,n),o.logger.debug("created data channel"),n}getOpponentMember(){return this.opponentMember}opponentCanBeTransferred(){return Boolean(this.opponentCaps&&this.opponentCaps["m.call.transferee"])}opponentSupportsDTMF(){return Boolean(this.opponentCaps&&this.opponentCaps["m.call.dtmf"])}getRemoteAssertedIdentity(){return this.remoteAssertedIdentity}get type(){return this.hasLocalUserMediaVideoTrack||this.hasRemoteUserMediaVideoTrack?m.Video:m.Voice}get hasLocalUserMediaVideoTrack(){var e;return(null===(e=this.localUsermediaStream)||void 0===e?void 0:e.getVideoTracks().length)>0}get hasRemoteUserMediaVideoTrack(){return this.getRemoteFeeds().some((e=>e.purpose===d.SDPStreamMetadataPurpose.Usermedia&&e.stream.getVideoTracks().length>0))}get hasLocalUserMediaAudioTrack(){var e;return(null===(e=this.localUsermediaStream)||void 0===e?void 0:e.getAudioTracks().length)>0}get hasRemoteUserMediaAudioTrack(){return this.getRemoteFeeds().some((e=>e.purpose===d.SDPStreamMetadataPurpose.Usermedia&&e.stream.getAudioTracks().length>0))}get localUsermediaFeed(){return this.getLocalFeeds().find((e=>e.purpose===d.SDPStreamMetadataPurpose.Usermedia))}get localScreensharingFeed(){return this.getLocalFeeds().find((e=>e.purpose===d.SDPStreamMetadataPurpose.Screenshare))}get localUsermediaStream(){var e;return null===(e=this.localUsermediaFeed)||void 0===e?void 0:e.stream}get localScreensharingStream(){var e;return null===(e=this.localScreensharingFeed)||void 0===e?void 0:e.stream}get remoteUsermediaFeed(){return this.getRemoteFeeds().find((e=>e.purpose===d.SDPStreamMetadataPurpose.Usermedia))}get remoteScreensharingFeed(){return this.getRemoteFeeds().find((e=>e.purpose===d.SDPStreamMetadataPurpose.Screenshare))}get remoteUsermediaStream(){var e;return null===(e=this.remoteUsermediaFeed)||void 0===e?void 0:e.stream}get remoteScreensharingStream(){var e;return null===(e=this.remoteScreensharingFeed)||void 0===e?void 0:e.stream}getFeedByStreamId(e){return this.getFeeds().find((t=>t.stream.id===e))}getFeeds(){return this.feeds}getLocalFeeds(){return this.feeds.filter((e=>e.isLocal()))}getRemoteFeeds(){return this.feeds.filter((e=>!e.isLocal()))}getLocalSDPStreamMetadata(){const e={};for(const t of this.getLocalFeeds())e[t.stream.id]={purpose:t.purpose,audio_muted:t.isAudioMuted(),video_muted:t.isVideoMuted()};return o.logger.debug("Got local SDPStreamMetadata",e),e}noIncomingFeeds(){return!this.feeds.some((e=>!e.isLocal()))}pushRemoteFeed(e){if(!this.opponentSupportsSDPStreamMetadata())return void this.pushRemoteFeedWithoutMetadata(e);const t=this.getOpponentMember().userId,n=this.remoteSDPStreamMetadata[e.id].purpose,r=this.remoteSDPStreamMetadata[e.id].audio_muted,i=this.remoteSDPStreamMetadata[e.id].video_muted;if(!n)return void o.logger.warn(`Ignoring stream with id ${e.id} because we didn't get any metadata about it`);const s=this.getRemoteFeeds().find((e=>e.purpose===n));s?s.setNewStream(e):(this.feeds.push(new u.CallFeed({client:this.client,roomId:this.roomId,userId:t,stream:e,purpose:n,audioMuted:r,videoMuted:i})),this.emit(y.FeedsChanged,this.feeds)),o.logger.info(`Pushed remote stream (id="${e.id}", active="${e.active}", purpose=${n})`)}pushRemoteFeedWithoutMetadata(e){var t;const n=this.getOpponentMember().userId,r=d.SDPStreamMetadataPurpose.Usermedia,i=null===(t=this.feeds.find((e=>!e.isLocal())))||void 0===t?void 0:t.stream;if(i&&e.id!==i.id)return void o.logger.warn(`Ignoring new stream ID ${e.id}: we already have stream ID ${i.id}`);const s=this.getFeedByStreamId(e.id);s?s.setNewStream(e):(this.feeds.push(new u.CallFeed({client:this.client,roomId:this.roomId,audioMuted:!1,videoMuted:!1,userId:n,stream:e,purpose:r})),this.emit(y.FeedsChanged,this.feeds)),o.logger.info(`Pushed remote stream (id="${e.id}", active="${e.active}")`)}pushNewLocalFeed(e,t,n=!0){const r=this.client.getUserId();_(e.getAudioTracks(),!0);const i=this.getLocalFeeds().find((e=>e.purpose===t));i?i.setNewStream(e):(this.pushLocalFeed(new u.CallFeed({client:this.client,roomId:this.roomId,audioMuted:!1,videoMuted:!1,userId:r,stream:e,purpose:t}),n),this.emit(y.FeedsChanged,this.feeds))}pushLocalFeed(e,t=!0){if(this.feeds.push(e),t){const t=e.purpose===d.SDPStreamMetadataPurpose.Usermedia?this.usermediaSenders:this.screensharingSenders;t.splice(0,t.length);for(const n of e.stream.getTracks())o.logger.info(`Adding track (id="${n.id}", kind="${n.kind}", streamId="${e.stream.id}", streamPurpose="${e.purpose}") to peer connection`),t.push(this.peerConn.addTrack(n,e.stream))}o.logger.info(`Pushed local stream (id="${e.stream.id}", active="${e.stream.active}", purpose="${e.purpose}")`),this.emit(y.FeedsChanged,this.feeds)}removeLocalFeed(e){const t=e.purpose===d.SDPStreamMetadataPurpose.Usermedia?this.usermediaSenders:this.screensharingSenders;for(const e of t)this.peerConn.removeTrack(e);t.splice(0,t.length),this.deleteFeedByStream(e.stream)}deleteAllFeeds(){for(const e of this.feeds)e.dispose();this.feeds=[],this.emit(y.FeedsChanged,this.feeds)}deleteFeedByStream(e){o.logger.debug(`Removing feed with stream id ${e.id}`);const t=this.getFeedByStreamId(e.id);t?(t.dispose(),this.feeds.splice(this.feeds.indexOf(t),1),this.emit(y.FeedsChanged,this.feeds)):o.logger.warn(`Didn't find the feed with stream id ${e.id} to delete`)}async getCurrentCallStats(){return this.callHasEnded()?this.callStatsAtEnd:this.collectCallStats()}async collectCallStats(){if(!this.peerConn)return;const e=await this.peerConn.getStats(),t=[];for(const n of e)t.push(n[1]);return t}async initWithInvite(e){var t;const n=e.getContent();this.direction=g.Inbound,await this.client.checkTurnServers()||o.logger.warn("Failed to get TURN credentials! Proceeding with call anyway...");const r=n[d.SDPStreamMetadataKey];r?this.updateRemoteSDPStreamMetadata(r):o.logger.debug("Did not get any SDPStreamMetadata! Can not send/receive multiple streams"),this.peerConn=this.createPeerConnection(),this.chooseOpponent(e);try{await this.peerConn.setRemoteDescription(n.offer),await this.addBufferedIceCandidates()}catch(e){return o.logger.debug("Failed to set remote description",e),void this.terminate(f.Local,v.SetRemoteDescription,!1)}const i=null===(t=this.feeds.find((e=>!e.isLocal())))||void 0===t?void 0:t.stream;if(!i||0===i.getTracks().length)return o.logger.error("No remote stream or no tracks after setting remote description!"),void this.terminate(f.Local,v.SetRemoteDescription,!1);this.setState(p.Ringing),e.getLocalAge()&&setTimeout((()=>{this.state==p.Ringing&&(o.logger.debug("Call invite has expired. Hanging up."),this.hangupParty=f.Remote,this.setState(p.Ended),this.stopAllMedia(),"closed"!=this.peerConn.signalingState&&this.peerConn.close(),this.emit(y.Hangup))}),n.lifetime-e.getLocalAge())}initWithHangup(e){this.setState(p.Ended)}shouldAnswerWithMediaType(e,t,n){return e&&!t?(o.logger.warn(`Unable to answer with ${n} because the other side isn't sending it either.`),!1):a.isNullOrUndefined(e)||e===t||this.opponentSupportsSDPStreamMetadata()?null!=e?e:t:(o.logger.warn(`Unable to answer with ${n}=${e} because the other side doesn't support it. Answering with ${n}=${t}.`),t)}async answer(e,t){if(!this.inviteOrAnswerSent){if(!1===e&&!1===t)throw new Error("You CANNOT answer a call without media");if(o.logger.debug(`Answering call ${this.callId}`),this.localUsermediaStream||this.waitForLocalAVStream)this.waitForLocalAVStream&&this.setState(p.WaitLocalMedia);else{const n=this.state,r=this.shouldAnswerWithMediaType(e,this.hasRemoteUserMediaAudioTrack,"audio"),i=this.shouldAnswerWithMediaType(t,this.hasRemoteUserMediaVideoTrack,"video");this.setState(p.WaitLocalMedia),this.waitForLocalAVStream=!0;try{const e=await this.client.getMediaHandler().getUserMediaStream(r,i);this.waitForLocalAVStream=!1;const t=[new u.CallFeed({client:this.client,roomId:this.roomId,userId:this.client.getUserId(),stream:e,purpose:d.SDPStreamMetadataPurpose.Usermedia,audioMuted:!1,videoMuted:!1})];this.localScreensharingFeed&&t.push(this.localScreensharingFeed),this.answerWithCallFeeds(t)}catch(e){if(!i)return void this.getUserMediaFailed(e);o.logger.warn("Failed to getUserMedia(), trying to getUserMedia() without video"),this.setState(n),this.waitForLocalAVStream=!1,await this.answer(r,!1)}}}}answerWithCallFeeds(e){this.inviteOrAnswerSent||(o.logger.debug(`Answering call ${this.callId}`),this.gotCallFeedsForAnswer(e))}replacedBy(e){this.state===p.WaitLocalMedia?(o.logger.debug("Telling new call to wait for local media"),e.waitForLocalAVStream=!0):[p.CreateOffer,p.InviteSent].includes(this.state)&&(o.logger.debug("Handing local stream to new call"),e.gotCallFeedsForAnswer(this.getLocalFeeds())),this.successor=e,this.emit(y.Replaced,e),this.hangup(v.Replaced,!0)}hangup(e,t){if(this.callHasEnded())return;if(o.logger.debug("Ending call "+this.callId),this.terminate(f.Local,e,!t),this.state===p.WaitLocalMedia)return;const n={};(this.opponentVersion&&this.opponentVersion>=1||e!==v.UserHangup)&&(n.reason=e),this.sendVoipEvent(l.EventType.CallHangup,n)}reject(){if(this.state!==p.Ringing)throw Error("Call must be in 'ringing' state to reject!");if(this.opponentVersion<1)return o.logger.info(`Opponent version is less than 1 (${this.opponentVersion}): sending hangup instead of reject`),void this.hangup(v.UserHangup,!0);o.logger.debug("Rejecting call: "+this.callId),this.terminate(f.Local,v.UserHangup,!0),this.sendVoipEvent(l.EventType.CallReject,{})}async upgradeCall(e,t){if((e||t)&&this.opponentSupportsSDPStreamMetadata())try{const n=e&&!this.hasLocalUserMediaAudioTrack,r=t&&!this.hasLocalUserMediaVideoTrack;o.logger.debug(`Upgrading call: audio?=${n} video?=${r}`);const i=await this.client.getMediaHandler().getUserMediaStream(n,r,!1);if(n&&r){if(this.hasLocalUserMediaAudioTrack)return;if(this.hasLocalUserMediaVideoTrack)return;this.pushNewLocalFeed(i,d.SDPStreamMetadataPurpose.Usermedia)}else if(n){if(this.hasLocalUserMediaAudioTrack)return;const e=i.getAudioTracks()[0];this.localUsermediaStream.addTrack(e),this.peerConn.addTrack(e,this.localUsermediaStream)}else if(r){if(this.hasLocalUserMediaVideoTrack)return;const e=i.getVideoTracks()[0];this.localUsermediaStream.addTrack(e),this.peerConn.addTrack(e,this.localUsermediaStream)}}catch(e){o.logger.error("Failed to upgrade the call",e),this.emit(y.Error,new b(v.NoUserMedia,"Failed to get camera access: ",e))}}opponentSupportsSDPStreamMetadata(){return Boolean(this.remoteSDPStreamMetadata)}isScreensharing(){return Boolean(this.localScreensharingStream)}async setScreensharingEnabled(e,t){if(e&&this.isScreensharing())return o.logger.warn("There is already a screensharing stream - there is nothing to do!"),!0;if(!e&&!this.isScreensharing())return o.logger.warn("There already isn't a screensharing stream - there is nothing to do!"),!1;if(!this.opponentSupportsSDPStreamMetadata())return await this.setScreensharingEnabledWithoutMetadataSupport(e,t);if(o.logger.debug(`Set screensharing enabled? ${e}`),!e){for(const e of this.screensharingSenders)this.peerConn.removeTrack(e);return this.client.getMediaHandler().stopScreensharingStream(this.localScreensharingStream),this.deleteFeedByStream(this.localScreensharingStream),!1}try{const e=await this.client.getMediaHandler().getScreensharingStream(t);return!!e&&(this.pushNewLocalFeed(e,d.SDPStreamMetadataPurpose.Screenshare),!0)}catch(e){return o.logger.error("Failed to get screen-sharing stream:",e),!1}}async setScreensharingEnabledWithoutMetadataSupport(e,t){if(o.logger.debug(`Set screensharing enabled? ${e} using replaceTrack()`),!e){const e=this.localUsermediaStream.getTracks().find((e=>"video"===e.kind));return this.usermediaSenders.find((e=>{var t;return"video"===(null===(t=e.track)||void 0===t?void 0:t.kind)})).replaceTrack(e),this.client.getMediaHandler().stopScreensharingStream(this.localScreensharingStream),this.deleteFeedByStream(this.localScreensharingStream),!1}try{const e=await this.client.getMediaHandler().getScreensharingStream(t);if(!e)return!1;const n=e.getTracks().find((e=>"video"===e.kind));return this.usermediaSenders.find((e=>{var t;return"video"===(null===(t=e.track)||void 0===t?void 0:t.kind)})).replaceTrack(n),this.pushNewLocalFeed(e,d.SDPStreamMetadataPurpose.Screenshare,!1),!0}catch(e){return o.logger.error("Failed to get screen-sharing stream:",e),!1}}async setLocalVideoMuted(e){var t;return await this.client.getMediaHandler().hasVideoDevice()?this.hasLocalUserMediaVideoTrack||e?(null===(t=this.localUsermediaFeed)||void 0===t||t.setVideoMuted(e),this.updateMuteStatus(),this.isLocalVideoMuted()):(await this.upgradeCall(!1,!0),this.isLocalVideoMuted()):this.isLocalVideoMuted()}isLocalVideoMuted(){var e;return null===(e=this.localUsermediaFeed)||void 0===e?void 0:e.isVideoMuted()}async setMicrophoneMuted(e){var t;return await this.client.getMediaHandler().hasAudioDevice()?this.hasLocalUserMediaAudioTrack||e?(null===(t=this.localUsermediaFeed)||void 0===t||t.setAudioMuted(e),this.updateMuteStatus(),this.isMicrophoneMuted()):(await this.upgradeCall(!0,!1),this.isMicrophoneMuted()):this.isMicrophoneMuted()}isMicrophoneMuted(){var e;return null===(e=this.localUsermediaFeed)||void 0===e?void 0:e.isAudioMuted()}isRemoteOnHold(){return this.remoteOnHold}setRemoteOnHold(e){if(this.isRemoteOnHold()!==e){this.remoteOnHold=e;for(const t of this.peerConn.getTransceivers())t.direction=e?"sendonly":"sendrecv";this.updateMuteStatus(),this.emit(y.RemoteHoldUnhold,this.remoteOnHold)}}isLocalOnHold(){if(this.state!==p.Connected)return!1;let e=!0;for(const t of this.peerConn.getTransceivers())["inactive","recvonly"].includes(t.currentDirection)||(e=!1);return e}sendDtmfDigit(e){for(const t of this.peerConn.getSenders())if("audio"===t.track.kind&&t.dtmf)return void t.dtmf.insertDTMF(e);throw new Error("Unable to find a track to send DTMF on")}updateMuteStatus(){var e,t;this.sendVoipEvent(l.EventType.CallSDPStreamMetadataChangedPrefix,{[d.SDPStreamMetadataKey]:this.getLocalSDPStreamMetadata()});const n=(null===(e=this.localUsermediaFeed)||void 0===e?void 0:e.isAudioMuted())||this.remoteOnHold,r=(null===(t=this.localUsermediaFeed)||void 0===t?void 0:t.isVideoMuted())||this.remoteOnHold;_(this.localUsermediaStream.getAudioTracks(),!n),_(this.localUsermediaStream.getVideoTracks(),!r)}gotCallFeedsForInvite(e){if(this.successor)this.successor.gotCallFeedsForAnswer(e);else if(this.callHasEnded())this.stopAllMedia();else{for(const t of e)this.pushLocalFeed(t);this.setState(p.CreateOffer),o.logger.debug("gotUserMediaForInvite")}}async sendAnswer(){const e={answer:{sdp:this.peerConn.localDescription.sdp,type:this.peerConn.localDescription.type},[d.SDPStreamMetadataKey]:this.getLocalSDPStreamMetadata()};e.capabilities={"m.call.transferee":this.client.supportsCallTransfer,"m.call.dtmf":!1},o.logger.info(`Discarding ${this.candidateSendQueue.length} candidates that will be sent in answer`),this.candidateSendQueue=[];try{await this.sendVoipEvent(l.EventType.CallAnswer,e),this.inviteOrAnswerSent=!0}catch(e){this.setState(p.Ringing),this.client.cancelPendingEvent(e.event);let t=v.SendAnswer,n="Failed to send answer";throw"UnknownDeviceError"==e.name&&(t=v.UnknownDevices,n="Unknown devices present in the room"),this.emit(y.Error,new b(t,n,e)),e}this.sendCandidateQueue()}async gotCallFeedsForAnswer(e){if(this.callHasEnded())return;this.waitForLocalAVStream=!1;for(const t of e)this.pushLocalFeed(t);let t;this.setState(p.CreateAnswer);try{this.getRidOfRTXCodecs(),t=await this.peerConn.createAnswer()}catch(e){return o.logger.debug("Failed to create answer: ",e),void this.terminate(f.Local,v.CreateAnswer,!0)}try{await this.peerConn.setLocalDescription(t),this.setState(p.Connecting),await new Promise((e=>{setTimeout(e,200)})),this.sendAnswer()}catch(e){return o.logger.debug("Error setting local description!",e),void this.terminate(f.Local,v.SetLocalDescription,!0)}}async onRemoteIceCandidatesReceived(e){if(this.callHasEnded())return;const t=e.getContent(),n=t.candidates;if(!n)return void o.logger.info("Ignoring candidates event with no candidates!");const r=0===t.version?null:t.party_id||null;if(void 0===this.opponentPartyId){o.logger.info(`Buffering ${n.length} candidates until we pick an opponent`);const e=this.remoteCandidateBuffer.get(r)||[];return e.push(...n),void this.remoteCandidateBuffer.set(r,e)}this.partyIdMatches(t)?await this.addIceCandidates(n):o.logger.info(`Ignoring candidates from party ID ${t.party_id}: we have chosen party ID ${this.opponentPartyId}`)}async onAnswerReceived(e){const t=e.getContent();if(o.logger.debug(`Got answer for call ID ${this.callId} from party ID ${t.party_id}`),this.callHasEnded())return void o.logger.debug(`Ignoring answer because call ID ${this.callId} has ended`);if(void 0!==this.opponentPartyId)return void o.logger.info(`Ignoring answer from party ID ${t.party_id}: we already have an answer/reject from ${this.opponentPartyId}`);this.chooseOpponent(e),await this.addBufferedIceCandidates(),this.setState(p.Connecting);const n=t[d.SDPStreamMetadataKey];n?this.updateRemoteSDPStreamMetadata(n):o.logger.warn("Did not get any SDPStreamMetadata! Can not send/receive multiple streams");try{await this.peerConn.setRemoteDescription(t.answer)}catch(e){return o.logger.debug("Failed to set remote description",e),void this.terminate(f.Local,v.SetRemoteDescription,!1)}if(null!==this.opponentPartyId)try{await this.sendVoipEvent(l.EventType.CallSelectAnswer,{selected_party_id:this.opponentPartyId})}catch(e){o.logger.warn("Failed to send select_answer event",e)}}async onSelectAnswerReceived(e){if(this.direction!==g.Inbound)return void o.logger.warn("Got select_answer for an outbound call: ignoring");const t=e.getContent().selected_party_id;null!=t?t!==this.ourPartyId&&(o.logger.info(`Got select_answer for party ID ${t}: we are party ID ${this.ourPartyId}.`),this.terminate(f.Remote,v.AnsweredElsewhere,!0)):o.logger.warn("Got nonsensical select_answer with null/undefined selected_party_id: ignoring")}async onNegotiateReceived(e){const t=e.getContent(),n=t.description;if(!n||!n.sdp||!n.type)return void o.logger.info("Ignoring invalid m.call.negotiate event");const r=this.direction===g.Inbound,i="offer"===n.type&&(this.makingOffer||"stable"!==this.peerConn.signalingState);if(this.ignoreOffer=!r&&i,this.ignoreOffer)return void o.logger.info("Ignoring colliding negotiate event because we're impolite");const s=this.isLocalOnHold(),a=t[d.SDPStreamMetadataKey];a?this.updateRemoteSDPStreamMetadata(a):o.logger.warn("Received negotiation event without SDPStreamMetadata!");try{if(await this.peerConn.setRemoteDescription(n),"offer"===n.type){this.getRidOfRTXCodecs();const e=await this.peerConn.createAnswer();await this.peerConn.setLocalDescription(e),this.sendVoipEvent(l.EventType.CallNegotiate,{description:this.peerConn.localDescription,[d.SDPStreamMetadataKey]:this.getLocalSDPStreamMetadata()})}}catch(e){o.logger.warn("Failed to complete negotiation",e)}const c=this.isLocalOnHold();s!==c&&(this.emit(y.LocalHoldUnhold,c),this.emit(y.HoldUnhold,c))}updateRemoteSDPStreamMetadata(e){this.remoteSDPStreamMetadata=a.recursivelyAssign(this.remoteSDPStreamMetadata||{},e,!0);for(const e of this.getRemoteFeeds()){var t,n,r;const i=e.stream.id;e.setAudioMuted(null===(t=this.remoteSDPStreamMetadata[i])||void 0===t?void 0:t.audio_muted),e.setVideoMuted(null===(n=this.remoteSDPStreamMetadata[i])||void 0===n?void 0:n.video_muted),e.purpose=null===(r=this.remoteSDPStreamMetadata[i])||void 0===r?void 0:r.purpose}}onSDPStreamMetadataChangedReceived(e){const t=e.getContent()[d.SDPStreamMetadataKey];this.updateRemoteSDPStreamMetadata(t)}async onAssertedIdentityReceived(e){const t=e.getContent();t.asserted_identity&&(this.remoteAssertedIdentity={id:t.asserted_identity.id,displayName:t.asserted_identity.display_name},this.emit(y.AssertedIdentityChanged))}callHasEnded(){return this.state===p.Ended}getRidOfRTXCodecs(){if(!RTCRtpReceiver.getCapabilities||!RTCRtpSender.getCapabilities)return;const e=RTCRtpReceiver.getCapabilities("video").codecs,t=[...RTCRtpSender.getCapabilities("video").codecs,...e];for(const e of t)if("video/rtx"===e.mimeType){const n=t.indexOf(e);t.splice(n,1)}for(const e of this.peerConn.getTransceivers()){var n,r;!this.screensharingSenders.includes(e.sender)||"video"!==(null===(n=e.sender.track)||void 0===n?void 0:n.kind)&&"video"!==(null===(r=e.receiver.track)||void 0===r?void 0:r.kind)||e.setCodecPreferences(t)}}setState(e){const t=this.state;this.state=e,this.emit(y.State,e,t)}sendVoipEvent(e,t){return this.client.sendEvent(this.roomId,e,Object.assign({},t,{version:1,call_id:this.callId,party_id:this.ourPartyId}))}queueCandidate(e){if(this.candidateSendQueue.push(e),this.state===p.Ringing||!this.inviteOrAnswerSent)return;const t=this.direction===g.Inbound?500:2e3;0===this.candidateSendTries&&setTimeout((()=>{this.sendCandidateQueue()}),t)}async transfer(e){const t=await this.client.getProfileInfo(e),n=w(),r={replacement_id:w(),target_user:{id:e,display_name:t.displayname,avatar_url:t.avatar_url},create_call:n};await this.sendVoipEvent(l.EventType.CallReplaces,r),await this.terminate(f.Local,v.Transfered,!0)}async transferToCall(e){const t=await this.client.getProfileInfo(e.getOpponentMember().userId),n=await this.client.getProfileInfo(this.getOpponentMember().userId),r=w(),i={replacement_id:w(),target_user:{id:this.getOpponentMember().userId,display_name:n.displayname,avatar_url:n.avatar_url},await_call:r};await e.sendVoipEvent(l.EventType.CallReplaces,i);const s={replacement_id:w(),target_user:{id:e.getOpponentMember().userId,display_name:t.displayname,avatar_url:t.avatar_url},create_call:r};await this.sendVoipEvent(l.EventType.CallReplaces,s),await this.terminate(f.Local,v.Replaced,!0),await e.terminate(f.Local,v.Transfered,!0)}async terminate(e,t,n){this.callHasEnded()||(this.callStatsAtEnd=await this.collectCallStats(),this.inviteTimeout&&(clearTimeout(this.inviteTimeout),this.inviteTimeout=null),this.callLengthInterval&&(clearInterval(this.callLengthInterval),this.callLengthInterval=null),t!==v.Replaced&&this.stopAllMedia(),this.deleteAllFeeds(),this.hangupParty=e,this.hangupReason=t,this.setState(p.Ended),this.peerConn&&"closed"!==this.peerConn.signalingState&&this.peerConn.close(),n&&this.emit(y.Hangup,this))}stopAllMedia(){o.logger.debug("Stopping all media for call",this.callId);for(const e of this.feeds)if(e.isLocal()&&e.purpose===d.SDPStreamMetadataPurpose.Usermedia)this.client.getMediaHandler().stopUserMediaStream(e.stream);else if(e.isLocal()&&e.purpose===d.SDPStreamMetadataPurpose.Screenshare)this.client.getMediaHandler().stopScreensharingStream(e.stream);else{o.logger.debug("Stopping remote stream",e.stream.id);for(const t of e.stream.getTracks())t.stop()}}checkForErrorListener(){if(0===this.listeners("error").length)throw new Error("You MUST attach an error listener using call.on('error', function() {})")}async sendCandidateQueue(){if(0===this.candidateSendQueue.length)return;const e=this.candidateSendQueue;this.candidateSendQueue=[],++this.candidateSendTries;const t={candidates:e};o.logger.debug("Attempting to send "+e.length+" candidates");try{await this.sendVoipEvent(l.EventType.CallCandidates,t),this.candidateSendTries=0}catch(t){if(t.event&&this.client.cancelPendingEvent(t.event),this.candidateSendQueue.push(...e),this.candidateSendTries>5){o.logger.debug("Failed to send candidates on attempt "+this.candidateSendTries+". Giving up on this call.",t);const e=v.SignallingFailed,n="Signalling failed";return this.emit(y.Error,new b(e,n,t)),void this.hangup(e,!1)}const n=500*Math.pow(2,this.candidateSendTries);++this.candidateSendTries,o.logger.debug("Failed to send candidates. Retrying in "+n+"ms",t),setTimeout((()=>{this.sendCandidateQueue()}),n)}}async placeCall(e,t){if(!e)throw new Error("You CANNOT start a call without audio");this.setState(p.WaitLocalMedia);try{const n=await this.client.getMediaHandler().getUserMediaStream(e,t),r=new u.CallFeed({client:this.client,roomId:this.roomId,userId:this.client.getUserId(),stream:n,purpose:d.SDPStreamMetadataPurpose.Usermedia,audioMuted:!1,videoMuted:!1});await this.placeCallWithCallFeeds([r])}catch(e){return void this.getUserMediaFailed(e)}}async placeCallWithCallFeeds(e){this.checkForErrorListener(),this.direction=g.Outbound,this.client.callEventHandler.calls.set(this.callId,this),await this.client.checkTurnServers()||o.logger.warn("Failed to get TURN credentials! Proceeding with call anyway..."),this.peerConn=this.createPeerConnection(),this.gotCallFeedsForInvite(e)}createPeerConnection(){const e=new window.RTCPeerConnection({iceTransportPolicy:this.forceTURN?"relay":void 0,iceServers:this.turnServers,iceCandidatePoolSize:this.client.iceCandidatePoolSize});return e.addEventListener("iceconnectionstatechange",this.onIceConnectionStateChanged),e.addEventListener("signalingstatechange",this.onSignallingStateChanged),e.addEventListener("icecandidate",this.gotLocalIceCandidate),e.addEventListener("icegatheringstatechange",this.onIceGatheringStateChange),e.addEventListener("track",this.onTrack),e.addEventListener("negotiationneeded",this.onNegotiationNeeded),e.addEventListener("datachannel",this.onDataChannel),e}partyIdMatches(e){return(0===e.version?null:e.party_id||null)===this.opponentPartyId}chooseOpponent(e){const t=e.getContent();o.logger.debug(`Choosing party ID ${t.party_id} for call ID ${this.callId}`),this.opponentVersion=t.version,0===this.opponentVersion?this.opponentPartyId=null:this.opponentPartyId=t.party_id||null,this.opponentCaps=t.capabilities||{},this.opponentMember=e.sender}async addBufferedIceCandidates(){const e=this.remoteCandidateBuffer.get(this.opponentPartyId);e&&(o.logger.info(`Adding ${e.length} buffered candidates for opponent ${this.opponentPartyId}`),await this.addIceCandidates(e)),this.remoteCandidateBuffer=null}async addIceCandidates(e){for(const t of e)if(null!==t.sdpMid&&void 0!==t.sdpMid||null!==t.sdpMLineIndex&&void 0!==t.sdpMLineIndex){o.logger.debug("Call "+this.callId+" got remote ICE "+t.sdpMid+" candidate: "+t.candidate);try{await this.peerConn.addIceCandidate(t)}catch(e){this.ignoreOffer||o.logger.info("Failed to add remote ICE candidate",e)}}else o.logger.debug("Ignoring remote ICE candidate with no sdpMid or sdpMLineIndex")}get hasPeerConnection(){return Boolean(this.peerConn)}}function _(e,t){for(let n=0;n<e.length;n++)e[n].enabled=t}t.MatrixCall=S},2931:(e,t,n)=>{"use strict";var r=n(5318);Object.defineProperty(t,"__esModule",{value:!0}),t.CallEventHandler=void 0;var i=r(n(9713)),s=n(7434),o=n(9679),a=n(2481);t.CallEventHandler=class{constructor(e){(0,i.default)(this,"client",void 0),(0,i.default)(this,"calls",void 0),(0,i.default)(this,"callEventBuffer",void 0),(0,i.default)(this,"candidateEventsByCall",void 0),(0,i.default)(this,"evaluateEventBuffer",(async()=>{if("SYNCING"===this.client.getSyncState()){await Promise.all(this.callEventBuffer.map((e=>{this.client.decryptEventIfNeeded(e)})));const e=new Set;for(const t of this.callEventBuffer)t.getType()!==a.EventType.CallAnswer&&t.getType()!==a.EventType.CallHangup||e.add(t.getContent().call_id);for(const t of this.callEventBuffer)if(t.getType()!==a.EventType.CallInvite||!e.has(t.getContent().call_id))try{await this.handleCallEvent(t)}catch(e){s.logger.error("Caught exception handling call event",e)}this.callEventBuffer=[]}})),(0,i.default)(this,"onRoomTimeline",(e=>{this.client.decryptEventIfNeeded(e),(this.eventIsACall(e)||e.isBeingDecrypted())&&this.callEventBuffer.push(e),(e.isBeingDecrypted()||e.isDecryptionFailure())&&e.once("Event.decrypted",(async()=>{if(this.eventIsACall(e))if(this.callEventBuffer.includes(e))this.evaluateEventBuffer();else try{await this.handleCallEvent(e)}catch(e){s.logger.error("Caught exception handling call event",e)}}))})),this.client=e,this.calls=new Map,this.callEventBuffer=[],this.candidateEventsByCall=new Map}start(){this.client.on("sync",this.evaluateEventBuffer),this.client.on("Room.timeline",this.onRoomTimeline)}stop(){this.client.removeListener("sync",this.evaluateEventBuffer),this.client.removeListener("Room.timeline",this.onRoomTimeline)}eventIsACall(e){const t=e.getType();return t.startsWith("m.call.")||t.startsWith("org.matrix.call.")}async handleCallEvent(e){const t=e.getContent(),n=e.getType(),r=e.getSender()===this.client.credentials.userId;let i=t.call_id?this.calls.get(t.call_id):void 0;if(n!==a.EventType.CallInvite)if(n!==a.EventType.CallCandidates)if([a.EventType.CallHangup,a.EventType.CallReject].includes(n))i?i.state!==o.CallState.Ended&&(n===a.EventType.CallHangup?i.onHangupReceived(t):i.onRejectReceived(t),this.calls.delete(t.call_id)):(i=(0,o.createNewMatrixCall)(this.client,e.getRoomId()),i&&(i.callId=t.call_id,i.initWithHangup(e),this.calls.set(t.call_id,i)));else if(i&&i.hasPeerConnection){if(e.getContent().party_id!==i.ourPartyId)switch(n){case a.EventType.CallAnswer:r?i.state===o.CallState.Ringing&&i.onAnsweredElsewhere(t):i.onAnswerReceived(e);break;case a.EventType.CallSelectAnswer:i.onSelectAnswerReceived(e);break;case a.EventType.CallNegotiate:i.onNegotiateReceived(e);break;case a.EventType.CallAssertedIdentity:case a.EventType.CallAssertedIdentityPrefix:i.onAssertedIdentityReceived(e);break;case a.EventType.CallSDPStreamMetadataChanged:case a.EventType.CallSDPStreamMetadataChangedPrefix:i.onSDPStreamMetadataChangedReceived(e)}}else s.logger.warn("Discarding an event, we don't have a call/peerConn",n);else{if(r)return;i?i.onRemoteIceCandidatesReceived(e):(this.candidateEventsByCall.has(t.call_id)||this.candidateEventsByCall.set(t.call_id,[]),this.candidateEventsByCall.get(t.call_id).push(e))}else{if(r)return;if(e.getLocalAge()>t.lifetime-3e3)return;if(i&&i.state===o.CallState.Ended)return;i&&s.logger.log(`WARN: Already have a MatrixCall with id ${t.call_id} but got an invite. Clobbering.`);const n=this.client.getTurnServersExpiry()-Date.now();if(s.logger.info("Current turn creds expire in "+n+" ms"),i=(0,o.createNewMatrixCall)(this.client,e.getRoomId(),{forceTURN:this.client.forceTURN}),!i)return void s.logger.log("Incoming call ID "+t.call_id+" but this client doesn't support WebRTC");if(i.callId=t.call_id,await i.initWithInvite(e),this.calls.set(i.callId,i),this.candidateEventsByCall.get(i.callId))for(const e of this.candidateEventsByCall.get(i.callId))i.onRemoteIceCandidatesReceived(e);let a;for(const e of this.calls.values()){const t=[o.CallState.WaitLocalMedia,o.CallState.CreateOffer,o.CallState.InviteSent].includes(e.state);if(i.roomId===e.roomId&&e.direction===o.CallDirection.Outbound&&t){a=e;break}}a?a.state===o.CallState.WaitLocalMedia||a.state===o.CallState.CreateOffer||a.callId>i.callId?(s.logger.log("Glare detected: answering incoming call "+i.callId+" and canceling outgoing call "+a.callId),a.replacedBy(i),i.answer()):(s.logger.log("Glare detected: rejecting incoming call "+i.callId+" and keeping outgoing call "+a.callId),i.hangup(o.CallErrorCode.Replaced,!0)):this.client.emit("Call.incoming",i)}}}},5964:(e,t)=>{"use strict";let n;Object.defineProperty(t,"__esModule",{value:!0}),t.SDPStreamMetadataPurpose=t.SDPStreamMetadataKey=void 0,t.SDPStreamMetadataKey="org.matrix.msc3077.sdp_stream_metadata",t.SDPStreamMetadataPurpose=n,function(e){e.Usermedia="m.usermedia",e.Screenshare="m.screenshare"}(n||(t.SDPStreamMetadataPurpose=n={}))},9704:(e,t,n)=>{"use strict";var r=n(5318);Object.defineProperty(t,"__esModule",{value:!0}),t.SPEAKING_THRESHOLD=t.CallFeedEvent=t.CallFeed=void 0;var i=r(n(9713)),s=r(n(7187));let o;t.SPEAKING_THRESHOLD=-60,t.CallFeedEvent=o,function(e){e.NewStream="new_stream",e.MuteStateChanged="mute_state_changed",e.VolumeChanged="volume_changed",e.Speaking="speaking"}(o||(t.CallFeedEvent=o={}));class a extends s.default{constructor(e){super(),(0,i.default)(this,"stream",void 0),(0,i.default)(this,"userId",void 0),(0,i.default)(this,"purpose",void 0),(0,i.default)(this,"speakingVolumeSamples",void 0),(0,i.default)(this,"client",void 0),(0,i.default)(this,"roomId",void 0),(0,i.default)(this,"audioMuted",void 0),(0,i.default)(this,"videoMuted",void 0),(0,i.default)(this,"measuringVolumeActivity",!1),(0,i.default)(this,"audioContext",void 0),(0,i.default)(this,"analyser",void 0),(0,i.default)(this,"frequencyBinCount",void 0),(0,i.default)(this,"speakingThreshold",-60),(0,i.default)(this,"speaking",!1),(0,i.default)(this,"volumeLooperTimeout",void 0),(0,i.default)(this,"onAddTrack",(()=>{this.emit(o.NewStream,this.stream)})),(0,i.default)(this,"volumeLooper",(()=>{if(!this.analyser)return;if(!this.measuringVolumeActivity)return;this.analyser.getFloatFrequencyData(this.frequencyBinCount);let e=-1/0;for(let t=0;t<this.frequencyBinCount.length;t++)this.frequencyBinCount[t]>e&&(e=this.frequencyBinCount[t]);this.speakingVolumeSamples.shift(),this.speakingVolumeSamples.push(e),this.emit(o.VolumeChanged,e);let t=!1;for(let e=0;e<this.speakingVolumeSamples.length;e++)if(this.speakingVolumeSamples[e]>this.speakingThreshold){t=!0;break}this.speaking!==t&&(this.speaking=t,this.emit(o.Speaking,this.speaking)),this.volumeLooperTimeout=setTimeout(this.volumeLooper,200)})),this.client=e.client,this.roomId=e.roomId,this.userId=e.userId,this.purpose=e.purpose,this.audioMuted=e.audioMuted,this.videoMuted=e.videoMuted,this.speakingVolumeSamples=new Array(8).fill(-1/0),this.updateStream(null,e.stream),this.hasAudioTrack&&this.initVolumeMeasuring()}get hasAudioTrack(){return this.stream.getAudioTracks().length>0}updateStream(e,t){t!==e&&(e&&(e.removeEventListener("addtrack",this.onAddTrack),this.measureVolumeActivity(!1)),t&&(this.stream=t,t.addEventListener("addtrack",this.onAddTrack),this.hasAudioTrack?this.initVolumeMeasuring():this.measureVolumeActivity(!1)),this.emit(o.NewStream,this.stream))}initVolumeMeasuring(){const e=window.AudioContext||window.webkitAudioContext;this.hasAudioTrack&&e&&(this.audioContext=new e,this.analyser=this.audioContext.createAnalyser(),this.analyser.fftSize=512,this.analyser.smoothingTimeConstant=.1,this.audioContext.createMediaStreamSource(this.stream).connect(this.analyser),this.frequencyBinCount=new Float32Array(this.analyser.frequencyBinCount))}getMember(){return this.client.getRoom(this.roomId).getMember(this.userId)}isLocal(){return this.userId===this.client.getUserId()}isAudioMuted(){return 0===this.stream.getAudioTracks().length||this.audioMuted}isVideoMuted(){return 0===this.stream.getVideoTracks().length||this.videoMuted}isSpeaking(){return this.speaking}setNewStream(e){this.updateStream(this.stream,e)}setAudioMuted(e){this.audioMuted=e,this.speakingVolumeSamples.fill(-1/0),this.emit(o.MuteStateChanged,this.audioMuted,this.videoMuted)}setVideoMuted(e){this.videoMuted=e,this.emit(o.MuteStateChanged,this.audioMuted,this.videoMuted)}measureVolumeActivity(e){if(e){if(!(this.audioContext&&this.analyser&&this.frequencyBinCount&&this.hasAudioTrack))return;this.measuringVolumeActivity=!0,this.volumeLooper()}else this.measuringVolumeActivity=!1,this.speakingVolumeSamples.fill(-1/0),this.emit(o.VolumeChanged,-1/0)}setSpeakingThreshold(e){this.speakingThreshold=e}dispose(){clearTimeout(this.volumeLooperTimeout)}}t.CallFeed=a},7626:(e,t,n)=>{"use strict";var r=n(5318);Object.defineProperty(t,"__esModule",{value:!0}),t.MediaHandler=void 0;var i=r(n(9713)),s=n(7434);t.MediaHandler=class{constructor(){(0,i.default)(this,"audioInput",void 0),(0,i.default)(this,"videoInput",void 0),(0,i.default)(this,"userMediaStreams",[]),(0,i.default)(this,"screensharingStreams",[])}setAudioInput(e){this.audioInput=e}setVideoInput(e){this.videoInput=e}async hasAudioDevice(){return(await navigator.mediaDevices.enumerateDevices()).filter((e=>"audioinput"===e.kind)).length>0}async hasVideoDevice(){return(await navigator.mediaDevices.enumerateDevices()).filter((e=>"videoinput"===e.kind)).length>0}async getUserMediaStream(e,t,n=!0){const r=e&&await this.hasAudioDevice(),i=t&&await this.hasVideoDevice();let o;const a=this.userMediaStreams.find((e=>r===e.getAudioTracks().length>0&&i===e.getVideoTracks().length>0));if(a)s.logger.log("Cloning user media stream",a.id),o=a.clone();else{const e=this.getUserMediaContraints(r,i);s.logger.log("Getting user media with constraints",e),o=await navigator.mediaDevices.getUserMedia(e)}return n&&this.userMediaStreams.push(o),o}stopUserMediaStream(e){s.logger.debug("Stopping usermedia stream",e.id);for(const t of e.getTracks())t.stop();const t=this.userMediaStreams.indexOf(e);-1!==t&&(s.logger.debug("Splicing usermedia stream out stream array",e.id),this.userMediaStreams.splice(t,1))}async getScreensharingStream(e,t=!0){let n;if(0===this.screensharingStreams.length){const t=this.getScreenshareContraints(e);if(!t)return null;e?(s.logger.debug("Getting screensharing stream using getUserMedia()",e),n=await navigator.mediaDevices.getUserMedia(t)):(s.logger.debug("Getting screensharing stream using getDisplayMedia()"),n=await navigator.mediaDevices.getDisplayMedia(t))}else{const e=this.screensharingStreams[this.screensharingStreams.length-1];s.logger.log("Cloning screensharing stream",e.id),n=e.clone()}return t&&this.screensharingStreams.push(n),n}stopScreensharingStream(e){s.logger.debug("Stopping screensharing stream",e.id);for(const t of e.getTracks())t.stop();const t=this.screensharingStreams.indexOf(e);-1!==t&&(s.logger.debug("Splicing screensharing stream out stream array",e.id),this.screensharingStreams.splice(t,1))}stopAllStreams(){for(const e of this.userMediaStreams)for(const t of e.getTracks())t.stop();for(const e of this.screensharingStreams)for(const t of e.getTracks())t.stop();this.userMediaStreams=[],this.screensharingStreams=[]}getUserMediaContraints(e,t){const n=!!navigator.webkitGetUserMedia;return{audio:!!e&&{deviceId:this.audioInput?{ideal:this.audioInput}:void 0},video:!!t&&{deviceId:this.videoInput?{ideal:this.videoInput}:void 0,width:n?{exact:640}:{ideal:640},height:n?{exact:360}:{ideal:360}}}}getScreenshareContraints(e){return e?(s.logger.debug("Using desktop capturer source",e),{audio:!1,video:{mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:e}}}):(s.logger.debug("Not using desktop capturer source"),{audio:!1,video:!0})}}},729:e=>{"use strict";var t={};function n(e,r,i){var s,o,a,l,c,d="";for("string"!=typeof r&&(i=r,r=n.defaultChars),void 0===i&&(i=!0),c=function(e){var n,r,i=t[e];if(i)return i;for(i=t[e]=[],n=0;n<128;n++)r=String.fromCharCode(n),/^[0-9a-z]$/i.test(r)?i.push(r):i.push("%"+("0"+n.toString(16).toUpperCase()).slice(-2));for(n=0;n<e.length;n++)i[e.charCodeAt(n)]=e[n];return i}(r),s=0,o=e.length;s<o;s++)if(a=e.charCodeAt(s),i&&37===a&&s+2<o&&/^[0-9a-f]{2}$/i.test(e.slice(s+1,s+3)))d+=e.slice(s,s+3),s+=2;else if(a<128)d+=c[a];else if(a>=55296&&a<=57343){if(a>=55296&&a<=56319&&s+1<o&&(l=e.charCodeAt(s+1))>=56320&&l<=57343){d+=encodeURIComponent(e[s]+e[s+1]),s++;continue}d+="%EF%BF%BD"}else d+=encodeURIComponent(e[s]);return d}n.defaultChars=";/?:@&=+$,-_.!~*'()#",n.componentChars="-_.!~*'()",e.exports=n},631:(e,t,n)=>{var r="function"==typeof Map&&Map.prototype,i=Object.getOwnPropertyDescriptor&&r?Object.getOwnPropertyDescriptor(Map.prototype,"size"):null,s=r&&i&&"function"==typeof i.get?i.get:null,o=r&&Map.prototype.forEach,a="function"==typeof Set&&Set.prototype,l=Object.getOwnPropertyDescriptor&&a?Object.getOwnPropertyDescriptor(Set.prototype,"size"):null,c=a&&l&&"function"==typeof l.get?l.get:null,d=a&&Set.prototype.forEach,u="function"==typeof WeakMap&&WeakMap.prototype?WeakMap.prototype.has:null,h="function"==typeof WeakSet&&WeakSet.prototype?WeakSet.prototype.has:null,p="function"==typeof WeakRef&&WeakRef.prototype?WeakRef.prototype.deref:null,m=Boolean.prototype.valueOf,g=Object.prototype.toString,f=Function.prototype.toString,y=String.prototype.match,v="function"==typeof BigInt?BigInt.prototype.valueOf:null,b=Object.getOwnPropertySymbols,w="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?Symbol.prototype.toString:null,S="function"==typeof Symbol&&"object"==typeof Symbol.iterator,_=Object.prototype.propertyIsEnumerable,k=("function"==typeof Reflect?Reflect.getPrototypeOf:Object.getPrototypeOf)||([].__proto__===Array.prototype?function(e){return e.__proto__}:null),x=n(4654).custom,E=x&&R(x)?x:null,T="function"==typeof Symbol&&void 0!==Symbol.toStringTag?Symbol.toStringTag:null;function C(e,t,n){var r="double"===(n.quoteStyle||t)?'"':"'";return r+e+r}function A(e){return String(e).replace(/"/g,"&quot;")}function I(e){return!("[object Array]"!==M(e)||T&&"object"==typeof e&&T in e)}function R(e){if(S)return e&&"object"==typeof e&&e instanceof Symbol;if("symbol"==typeof e)return!0;if(!e||"object"!=typeof e||!w)return!1;try{return w.call(e),!0}catch(e){}return!1}e.exports=function e(t,n,r,i){var a=n||{};if(P(a,"quoteStyle")&&"single"!==a.quoteStyle&&"double"!==a.quoteStyle)throw new TypeError('option "quoteStyle" must be "single" or "double"');if(P(a,"maxStringLength")&&("number"==typeof a.maxStringLength?a.maxStringLength<0&&a.maxStringLength!==1/0:null!==a.maxStringLength))throw new TypeError('option "maxStringLength", if provided, must be a positive integer, Infinity, or `null`');var l=!P(a,"customInspect")||a.customInspect;if("boolean"!=typeof l&&"symbol"!==l)throw new TypeError("option \"customInspect\", if provided, must be `true`, `false`, or `'symbol'`");if(P(a,"indent")&&null!==a.indent&&"\t"!==a.indent&&!(parseInt(a.indent,10)===a.indent&&a.indent>0))throw new TypeError('options "indent" must be "\\t", an integer > 0, or `null`');if(void 0===t)return"undefined";if(null===t)return"null";if("boolean"==typeof t)return t?"true":"false";if("string"==typeof t)return L(t,a);if("number"==typeof t)return 0===t?1/0/t>0?"0":"-0":String(t);if("bigint"==typeof t)return String(t)+"n";var g=void 0===a.depth?5:a.depth;if(void 0===r&&(r=0),r>=g&&g>0&&"object"==typeof t)return I(t)?"[Array]":"[Object]";var b,_=function(e,t){var n;if("\t"===e.indent)n="\t";else{if(!("number"==typeof e.indent&&e.indent>0))return null;n=Array(e.indent+1).join(" ")}return{base:n,prev:Array(t+1).join(n)}}(a,r);if(void 0===i)i=[];else if(D(i,t)>=0)return"[Circular]";function x(t,n,s){if(n&&(i=i.slice()).push(n),s){var o={depth:a.depth};return P(a,"quoteStyle")&&(o.quoteStyle=a.quoteStyle),e(t,o,r+1,i)}return e(t,a,r+1,i)}if("function"==typeof t){var O=function(e){if(e.name)return e.name;var t=y.call(f.call(e),/^function\s*([\w$]+)/);return t?t[1]:null}(t),F=q(t,x);return"[Function"+(O?": "+O:" (anonymous)")+"]"+(F.length>0?" { "+F.join(", ")+" }":"")}if(R(t)){var K=S?String(t).replace(/^(Symbol\(.*\))_[^)]*$/,"$1"):w.call(t);return"object"!=typeof t||S?K:N(K)}if((b=t)&&"object"==typeof b&&("undefined"!=typeof HTMLElement&&b instanceof HTMLElement||"string"==typeof b.nodeName&&"function"==typeof b.getAttribute)){for(var z="<"+String(t.nodeName).toLowerCase(),$=t.attributes||[],V=0;V<$.length;V++)z+=" "+$[V].name+"="+C(A($[V].value),"double",a);return z+=">",t.childNodes&&t.childNodes.length&&(z+="..."),z+"</"+String(t.nodeName).toLowerCase()+">"}if(I(t)){if(0===t.length)return"[]";var H=q(t,x);return _&&!function(e){for(var t=0;t<e.length;t++)if(D(e[t],"\n")>=0)return!1;return!0}(H)?"["+B(H,_)+"]":"[ "+H.join(", ")+" ]"}if(function(e){return!("[object Error]"!==M(e)||T&&"object"==typeof e&&T in e)}(t)){var W=q(t,x);return 0===W.length?"["+String(t)+"]":"{ ["+String(t)+"] "+W.join(", ")+" }"}if("object"==typeof t&&l){if(E&&"function"==typeof t[E])return t[E]();if("symbol"!==l&&"function"==typeof t.inspect)return t.inspect()}if(function(e){if(!s||!e||"object"!=typeof e)return!1;try{s.call(e);try{c.call(e)}catch(e){return!0}return e instanceof Map}catch(e){}return!1}(t)){var G=[];return o.call(t,(function(e,n){G.push(x(n,t,!0)+" => "+x(e,t))})),U("Map",s.call(t),G,_)}if(function(e){if(!c||!e||"object"!=typeof e)return!1;try{c.call(e);try{s.call(e)}catch(e){return!0}return e instanceof Set}catch(e){}return!1}(t)){var Y=[];return d.call(t,(function(e){Y.push(x(e,t))})),U("Set",c.call(t),Y,_)}if(function(e){if(!u||!e||"object"!=typeof e)return!1;try{u.call(e,u);try{h.call(e,h)}catch(e){return!0}return e instanceof WeakMap}catch(e){}return!1}(t))return j("WeakMap");if(function(e){if(!h||!e||"object"!=typeof e)return!1;try{h.call(e,h);try{u.call(e,u)}catch(e){return!0}return e instanceof WeakSet}catch(e){}return!1}(t))return j("WeakSet");if(function(e){if(!p||!e||"object"!=typeof e)return!1;try{return p.call(e),!0}catch(e){}return!1}(t))return j("WeakRef");if(function(e){return!("[object Number]"!==M(e)||T&&"object"==typeof e&&T in e)}(t))return N(x(Number(t)));if(function(e){if(!e||"object"!=typeof e||!v)return!1;try{return v.call(e),!0}catch(e){}return!1}(t))return N(x(v.call(t)));if(function(e){return!("[object Boolean]"!==M(e)||T&&"object"==typeof e&&T in e)}(t))return N(m.call(t));if(function(e){return!("[object String]"!==M(e)||T&&"object"==typeof e&&T in e)}(t))return N(x(String(t)));if(!function(e){return!("[object Date]"!==M(e)||T&&"object"==typeof e&&T in e)}(t)&&!function(e){return!("[object RegExp]"!==M(e)||T&&"object"==typeof e&&T in e)}(t)){var X=q(t,x),Z=k?k(t)===Object.prototype:t instanceof Object||t.constructor===Object,J=t instanceof Object?"":"null prototype",Q=!Z&&T&&Object(t)===t&&T in t?M(t).slice(8,-1):J?"Object":"",ee=(Z||"function"!=typeof t.constructor?"":t.constructor.name?t.constructor.name+" ":"")+(Q||J?"["+[].concat(Q||[],J||[]).join(": ")+"] ":"");return 0===X.length?ee+"{}":_?ee+"{"+B(X,_)+"}":ee+"{ "+X.join(", ")+" }"}return String(t)};var O=Object.prototype.hasOwnProperty||function(e){return e in this};function P(e,t){return O.call(e,t)}function M(e){return g.call(e)}function D(e,t){if(e.indexOf)return e.indexOf(t);for(var n=0,r=e.length;n<r;n++)if(e[n]===t)return n;return-1}function L(e,t){if(e.length>t.maxStringLength){var n=e.length-t.maxStringLength,r="... "+n+" more character"+(n>1?"s":"");return L(e.slice(0,t.maxStringLength),t)+r}return C(e.replace(/(['\\])/g,"\\$1").replace(/[\x00-\x1f]/g,F),"single",t)}function F(e){var t=e.charCodeAt(0),n={8:"b",9:"t",10:"n",12:"f",13:"r"}[t];return n?"\\"+n:"\\x"+(t<16?"0":"")+t.toString(16).toUpperCase()}function N(e){return"Object("+e+")"}function j(e){return e+" { ? }"}function U(e,t,n,r){return e+" ("+t+") {"+(r?B(n,r):n.join(", "))+"}"}function B(e,t){if(0===e.length)return"";var n="\n"+t.prev+t.base;return n+e.join(","+n)+"\n"+t.prev}function q(e,t){var n=I(e),r=[];if(n){r.length=e.length;for(var i=0;i<e.length;i++)r[i]=P(e,i)?t(e[i],e):""}var s,o="function"==typeof b?b(e):[];if(S){s={};for(var a=0;a<o.length;a++)s["$"+o[a]]=o[a]}for(var l in e)P(e,l)&&(n&&String(Number(l))===l&&l<e.length||S&&s["$"+l]instanceof Symbol||(/[^\w$]/.test(l)?r.push(t(l,e)+": "+t(e[l],e)):r.push(l+": "+t(e[l],e))));if("function"==typeof b)for(var c=0;c<o.length;c++)_.call(e,o[c])&&r.push("["+t(o[c])+"]: "+t(e[o[c]],e));return r}},2693:(e,t,n)=>{"use strict";const r=n(9353),i=["Failed to fetch","NetworkError when attempting to fetch resource.","The Internet connection appears to be offline.","Network request failed"];class s extends Error{constructor(e){super(),e instanceof Error?(this.originalError=e,({message:e}=e)):(this.originalError=new Error(e),this.originalError.stack=this.stack),this.name="AbortError",this.message=e}}const o=(e,t)=>new Promise(((n,o)=>{t={onFailedAttempt:()=>{},retries:10,...t};const a=r.operation(t);a.attempt((async r=>{try{n(await e(r))}catch(e){if(!(e instanceof Error))return void o(new TypeError(`Non-error was thrown: "${e}". You should only throw errors.`));if(e instanceof s)a.stop(),o(e.originalError);else if(e instanceof TypeError&&(l=e.message,!i.includes(l)))a.stop(),o(e);else{((e,t,n)=>{const r=n.retries-(t-1);e.attemptNumber=t,e.retriesLeft=r})(e,r,t);try{await t.onFailedAttempt(e)}catch(e){return void o(e)}a.retry(e)||o(a.mainError())}}var l}))}));e.exports=o,e.exports.default=o,e.exports.AbortError=s},9430:function(e,t){var n,r;void 0===(r="function"==typeof(n=function(){return function(e){function t(e){return" "===e||"\t"===e||"\n"===e||"\f"===e||"\r"===e}function n(t){var n,r=t.exec(e.substring(g));if(r)return n=r[0],g+=n.length,n}for(var r,i,s,o,a,l=e.length,c=/^[ \t\n\r\u000c]+/,d=/^[, \t\n\r\u000c]+/,u=/^[^ \t\n\r\u000c]+/,h=/[,]+$/,p=/^\d+$/,m=/^-?(?:[0-9]+|[0-9]*\.[0-9]+)(?:[eE][+-]?[0-9]+)?$/,g=0,f=[];;){if(n(d),g>=l)return f;r=n(u),i=[],","===r.slice(-1)?(r=r.replace(h,""),v()):y()}function y(){for(n(c),s="",o="in descriptor";;){if(a=e.charAt(g),"in descriptor"===o)if(t(a))s&&(i.push(s),s="",o="after descriptor");else{if(","===a)return g+=1,s&&i.push(s),void v();if("("===a)s+=a,o="in parens";else{if(""===a)return s&&i.push(s),void v();s+=a}}else if("in parens"===o)if(")"===a)s+=a,o="in descriptor";else{if(""===a)return i.push(s),void v();s+=a}else if("after descriptor"===o)if(t(a));else{if(""===a)return void v();o="in descriptor",g-=1}g+=1}}function v(){var t,n,s,o,a,l,c,d,u,h=!1,g={};for(o=0;o<i.length;o++)l=(a=i[o])[a.length-1],c=a.substring(0,a.length-1),d=parseInt(c,10),u=parseFloat(c),p.test(c)&&"w"===l?((t||n)&&(h=!0),0===d?h=!0:t=d):m.test(c)&&"x"===l?((t||n||s)&&(h=!0),u<0?h=!0:n=u):p.test(c)&&"h"===l?((s||n)&&(h=!0),0===d?h=!0:s=d):h=!0;h?console&&console.log&&console.log("Invalid srcset descriptor found in '"+e+"' at '"+a+"'."):(g.url=r,t&&(g.w=t),n&&(g.d=n),s&&(g.h=s),f.push(g))}}})?n.apply(t,[]):n)||(e.exports=r)},9299:function(module,__unused_webpack_exports,__webpack_require__){var factory;factory=function(){return(()=>{"use strict";var __webpack_modules__=[,(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.VerbosityLevel=t.Util=t.UnknownErrorException=t.UnexpectedResponseException=t.UNSUPPORTED_FEATURES=t.TextRenderingMode=t.StreamType=t.RenderingIntentFlag=t.PermissionFlag=t.PasswordResponses=t.PasswordException=t.PageActionEventType=t.OPS=t.MissingPDFException=t.IsLittleEndianCached=t.IsEvalSupportedCached=t.InvalidPDFException=t.ImageKind=t.IDENTITY_MATRIX=t.FormatError=t.FontType=t.FONT_IDENTITY_MATRIX=t.DocumentActionEventType=t.CMapCompressionType=t.BaseException=t.AnnotationType=t.AnnotationStateModelType=t.AnnotationReviewState=t.AnnotationReplyType=t.AnnotationMode=t.AnnotationMarkedState=t.AnnotationFlag=t.AnnotationFieldFlag=t.AnnotationBorderStyleType=t.AnnotationActionEventType=t.AbortException=void 0,t.arrayByteLength=d,t.arraysToBytes=function(e){const t=e.length;if(1===t&&e[0]instanceof Uint8Array)return e[0];let n=0;for(let r=0;r<t;r++)n+=d(e[r]);let r=0;const i=new Uint8Array(n);for(let n=0;n<t;n++){let t=e[n];t instanceof Uint8Array||(t="string"==typeof t?c(t):new Uint8Array(t));const s=t.byteLength;i.set(t,r),r+=s}return i},t.assert=function(e,t){e||o(t)},t.bytesToString=function(e){"object"==typeof e&&null!==e&&void 0!==e.length||o("Invalid argument for bytesToString");const t=e.length,n=8192;if(t<n)return String.fromCharCode.apply(null,e);const r=[];for(let i=0;i<t;i+=n){const s=Math.min(i+n,t),o=e.subarray(i,s);r.push(String.fromCharCode.apply(null,o))}return r.join("")},t.createPromiseCapability=function(){const e=Object.create(null);let t=!1;return Object.defineProperty(e,"settled",{get:()=>t}),e.promise=new Promise((function(n,r){e.resolve=function(e){t=!0,n(e)},e.reject=function(e){t=!0,r(e)}})),e},t.createValidAbsoluteUrl=function(e,t=null,n=null){if(!e)return null;try{if(n&&"string"==typeof e){if(n.addDefaultProtocol&&e.startsWith("www.")){const t=e.match(/\./g);t&&t.length>=2&&(e=`http://${e}`)}if(n.tryConvertEncoding)try{e=f(e)}catch(e){}}const r=t?new URL(e,t):new URL(e);if(function(e){if(!e)return!1;switch(e.protocol){case"http:":case"https:":case"ftp:":case"mailto:":case"tel:":return!0;default:return!1}}(r))return r}catch(e){}return null},t.escapeString=function(e){return e.replace(/([()\\\n\r])/g,(e=>"\n"===e?"\\n":"\r"===e?"\\r":`\\${e}`))},t.getModificationDate=function(e=new Date){return[e.getUTCFullYear().toString(),(e.getUTCMonth()+1).toString().padStart(2,"0"),e.getUTCDate().toString().padStart(2,"0"),e.getUTCHours().toString().padStart(2,"0"),e.getUTCMinutes().toString().padStart(2,"0"),e.getUTCSeconds().toString().padStart(2,"0")].join("")},t.getVerbosityLevel=function(){return i},t.info=function(e){i>=r.INFOS&&console.log(`Info: ${e}`)},t.isArrayBuffer=function(e){return"object"==typeof e&&null!==e&&void 0!==e.byteLength},t.isArrayEqual=function(e,t){if(e.length!==t.length)return!1;for(let n=0,r=e.length;n<r;n++)if(e[n]!==t[n])return!1;return!0},t.isAscii=function(e){return/^[\x00-\x7F]*$/.test(e)},t.isSameOrigin=function(e,t){let n;try{if(n=new URL(e),!n.origin||"null"===n.origin)return!1}catch(e){return!1}const r=new URL(t,n);return n.origin===r.origin},t.objectFromMap=function(e){const t=Object.create(null);for(const[n,r]of e)t[n]=r;return t},t.objectSize=function(e){return Object.keys(e).length},t.setVerbosityLevel=function(e){Number.isInteger(e)&&(i=e)},t.shadow=a,t.string32=function(e){return String.fromCharCode(e>>24&255,e>>16&255,e>>8&255,255&e)},t.stringToBytes=c,t.stringToPDFString=function(e){if(e[0]>=""){let t;if(""===e[0]&&""===e[1]?t="utf-16be":""===e[0]&&""===e[1]?t="utf-16le":""===e[0]&&""===e[1]&&""===e[2]&&(t="utf-8"),t)try{const n=new TextDecoder(t,{fatal:!0}),r=c(e);return n.decode(r)}catch(e){s(`stringToPDFString: "${e}".`)}}const t=[];for(let n=0,r=e.length;n<r;n++){const r=g[e.charCodeAt(n)];t.push(r?String.fromCharCode(r):e.charAt(n))}return t.join("")},t.stringToUTF16BEString=function(e){const t=[""];for(let n=0,r=e.length;n<r;n++){const r=e.charCodeAt(n);t.push(String.fromCharCode(r>>8&255),String.fromCharCode(255&r))}return t.join("")},t.stringToUTF8String=f,t.unreachable=o,t.utf8StringToString=function(e){return unescape(encodeURIComponent(e))},t.warn=s,n(2),t.IDENTITY_MATRIX=[1,0,0,1,0,0],t.FONT_IDENTITY_MATRIX=[.001,0,0,.001,0,0],t.RenderingIntentFlag={ANY:1,DISPLAY:2,PRINT:4,ANNOTATIONS_FORMS:16,ANNOTATIONS_STORAGE:32,ANNOTATIONS_DISABLE:64,OPLIST:256},t.AnnotationMode={DISABLE:0,ENABLE:1,ENABLE_FORMS:2,ENABLE_STORAGE:3},t.PermissionFlag={PRINT:4,MODIFY_CONTENTS:8,COPY:16,MODIFY_ANNOTATIONS:32,FILL_INTERACTIVE_FORMS:256,COPY_FOR_ACCESSIBILITY:512,ASSEMBLE:1024,PRINT_HIGH_QUALITY:2048},t.TextRenderingMode={FILL:0,STROKE:1,FILL_STROKE:2,INVISIBLE:3,FILL_ADD_TO_PATH:4,STROKE_ADD_TO_PATH:5,FILL_STROKE_ADD_TO_PATH:6,ADD_TO_PATH:7,FILL_STROKE_MASK:3,ADD_TO_PATH_FLAG:4},t.ImageKind={GRAYSCALE_1BPP:1,RGB_24BPP:2,RGBA_32BPP:3},t.AnnotationType={TEXT:1,LINK:2,FREETEXT:3,LINE:4,SQUARE:5,CIRCLE:6,POLYGON:7,POLYLINE:8,HIGHLIGHT:9,UNDERLINE:10,SQUIGGLY:11,STRIKEOUT:12,STAMP:13,CARET:14,INK:15,POPUP:16,FILEATTACHMENT:17,SOUND:18,MOVIE:19,WIDGET:20,SCREEN:21,PRINTERMARK:22,TRAPNET:23,WATERMARK:24,THREED:25,REDACT:26},t.AnnotationStateModelType={MARKED:"Marked",REVIEW:"Review"},t.AnnotationMarkedState={MARKED:"Marked",UNMARKED:"Unmarked"},t.AnnotationReviewState={ACCEPTED:"Accepted",REJECTED:"Rejected",CANCELLED:"Cancelled",COMPLETED:"Completed",NONE:"None"},t.AnnotationReplyType={GROUP:"Group",REPLY:"R"},t.AnnotationFlag={INVISIBLE:1,HIDDEN:2,PRINT:4,NOZOOM:8,NOROTATE:16,NOVIEW:32,READONLY:64,LOCKED:128,TOGGLENOVIEW:256,LOCKEDCONTENTS:512},t.AnnotationFieldFlag={READONLY:1,REQUIRED:2,NOEXPORT:4,MULTILINE:4096,PASSWORD:8192,NOTOGGLETOOFF:16384,RADIO:32768,PUSHBUTTON:65536,COMBO:131072,EDIT:262144,SORT:524288,FILESELECT:1048576,MULTISELECT:2097152,DONOTSPELLCHECK:4194304,DONOTSCROLL:8388608,COMB:16777216,RICHTEXT:33554432,RADIOSINUNISON:33554432,COMMITONSELCHANGE:67108864},t.AnnotationBorderStyleType={SOLID:1,DASHED:2,BEVELED:3,INSET:4,UNDERLINE:5},t.AnnotationActionEventType={E:"Mouse Enter",X:"Mouse Exit",D:"Mouse Down",U:"Mouse Up",Fo:"Focus",Bl:"Blur",PO:"PageOpen",PC:"PageClose",PV:"PageVisible",PI:"PageInvisible",K:"Keystroke",F:"Format",V:"Validate",C:"Calculate"},t.DocumentActionEventType={WC:"WillClose",WS:"WillSave",DS:"DidSave",WP:"WillPrint",DP:"DidPrint"},t.PageActionEventType={O:"PageOpen",C:"PageClose"},t.StreamType={UNKNOWN:"UNKNOWN",FLATE:"FLATE",LZW:"LZW",DCT:"DCT",JPX:"JPX",JBIG:"JBIG",A85:"A85",AHX:"AHX",CCF:"CCF",RLX:"RLX"},t.FontType={UNKNOWN:"UNKNOWN",TYPE1:"TYPE1",TYPE1STANDARD:"TYPE1STANDARD",TYPE1C:"TYPE1C",CIDFONTTYPE0:"CIDFONTTYPE0",CIDFONTTYPE0C:"CIDFONTTYPE0C",TRUETYPE:"TRUETYPE",CIDFONTTYPE2:"CIDFONTTYPE2",TYPE3:"TYPE3",OPENTYPE:"OPENTYPE",TYPE0:"TYPE0",MMTYPE1:"MMTYPE1"};const r={ERRORS:0,WARNINGS:1,INFOS:5};t.VerbosityLevel=r,t.CMapCompressionType={NONE:0,BINARY:1,STREAM:2},t.OPS={dependency:1,setLineWidth:2,setLineCap:3,setLineJoin:4,setMiterLimit:5,setDash:6,setRenderingIntent:7,setFlatness:8,setGState:9,save:10,restore:11,transform:12,moveTo:13,lineTo:14,curveTo:15,curveTo2:16,curveTo3:17,closePath:18,rectangle:19,stroke:20,closeStroke:21,fill:22,eoFill:23,fillStroke:24,eoFillStroke:25,closeFillStroke:26,closeEOFillStroke:27,endPath:28,clip:29,eoClip:30,beginText:31,endText:32,setCharSpacing:33,setWordSpacing:34,setHScale:35,setLeading:36,setFont:37,setTextRenderingMode:38,setTextRise:39,moveText:40,setLeadingMoveText:41,setTextMatrix:42,nextLine:43,showText:44,showSpacedText:45,nextLineShowText:46,nextLineSetSpacingShowText:47,setCharWidth:48,setCharWidthAndBounds:49,setStrokeColorSpace:50,setFillColorSpace:51,setStrokeColor:52,setStrokeColorN:53,setFillColor:54,setFillColorN:55,setStrokeGray:56,setFillGray:57,setStrokeRGBColor:58,setFillRGBColor:59,setStrokeCMYKColor:60,setFillCMYKColor:61,shadingFill:62,beginInlineImage:63,beginImageData:64,endInlineImage:65,paintXObject:66,markPoint:67,markPointProps:68,beginMarkedContent:69,beginMarkedContentProps:70,endMarkedContent:71,beginCompat:72,endCompat:73,paintFormXObjectBegin:74,paintFormXObjectEnd:75,beginGroup:76,endGroup:77,beginAnnotations:78,endAnnotations:79,beginAnnotation:80,endAnnotation:81,paintJpegXObject:82,paintImageMaskXObject:83,paintImageMaskXObjectGroup:84,paintImageXObject:85,paintInlineImageXObject:86,paintInlineImageXObjectGroup:87,paintImageXObjectRepeat:88,paintImageMaskXObjectRepeat:89,paintSolidColorImageMask:90,constructPath:91},t.UNSUPPORTED_FEATURES={unknown:"unknown",forms:"forms",javaScript:"javaScript",signatures:"signatures",smask:"smask",shadingPattern:"shadingPattern",font:"font",errorTilingPattern:"errorTilingPattern",errorExtGState:"errorExtGState",errorXObject:"errorXObject",errorFontLoadType3:"errorFontLoadType3",errorFontState:"errorFontState",errorFontMissing:"errorFontMissing",errorFontTranslate:"errorFontTranslate",errorColorSpace:"errorColorSpace",errorOperatorList:"errorOperatorList",errorFontToUnicode:"errorFontToUnicode",errorFontLoadNative:"errorFontLoadNative",errorFontBuildPath:"errorFontBuildPath",errorFontGetPath:"errorFontGetPath",errorMarkedContent:"errorMarkedContent",errorContentSubStream:"errorContentSubStream"},t.PasswordResponses={NEED_PASSWORD:1,INCORRECT_PASSWORD:2};let i=r.WARNINGS;function s(e){i>=r.WARNINGS&&console.log(`Warning: ${e}`)}function o(e){throw new Error(e)}function a(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!1}),n}const l=function(){function e(t,n){this.constructor===e&&o("Cannot initialize BaseException."),this.message=t,this.name=n}return e.prototype=new Error,e.constructor=e,e}();function c(e){"string"!=typeof e&&o("Invalid argument for stringToBytes");const t=e.length,n=new Uint8Array(t);for(let r=0;r<t;++r)n[r]=255&e.charCodeAt(r);return n}function d(e){return void 0!==e.length?e.length:void 0!==e.byteLength?e.byteLength:void o("Invalid argument for arrayByteLength")}t.BaseException=l,t.PasswordException=class extends l{constructor(e,t){super(e,"PasswordException"),this.code=t}},t.UnknownErrorException=class extends l{constructor(e,t){super(e,"UnknownErrorException"),this.details=t}},t.InvalidPDFException=class extends l{constructor(e){super(e,"InvalidPDFException")}},t.MissingPDFException=class extends l{constructor(e){super(e,"MissingPDFException")}},t.UnexpectedResponseException=class extends l{constructor(e,t){super(e,"UnexpectedResponseException"),this.status=t}},t.FormatError=class extends l{constructor(e){super(e,"FormatError")}},t.AbortException=class extends l{constructor(e){super(e,"AbortException")}};const u={get value(){return a(this,"value",function(){const e=new Uint8Array(4);return e[0]=1,1===new Uint32Array(e.buffer,0,1)[0]}())}};t.IsLittleEndianCached=u;const h={get value(){return a(this,"value",function(){try{return new Function(""),!0}catch(e){return!1}}())}};t.IsEvalSupportedCached=h;const p=[...Array(256).keys()].map((e=>e.toString(16).padStart(2,"0")));class m{static makeHexColor(e,t,n){return`#${p[e]}${p[t]}${p[n]}`}static transform(e,t){return[e[0]*t[0]+e[2]*t[1],e[1]*t[0]+e[3]*t[1],e[0]*t[2]+e[2]*t[3],e[1]*t[2]+e[3]*t[3],e[0]*t[4]+e[2]*t[5]+e[4],e[1]*t[4]+e[3]*t[5]+e[5]]}static applyTransform(e,t){return[e[0]*t[0]+e[1]*t[2]+t[4],e[0]*t[1]+e[1]*t[3]+t[5]]}static applyInverseTransform(e,t){const n=t[0]*t[3]-t[1]*t[2];return[(e[0]*t[3]-e[1]*t[2]+t[2]*t[5]-t[4]*t[3])/n,(-e[0]*t[1]+e[1]*t[0]+t[4]*t[1]-t[5]*t[0])/n]}static getAxialAlignedBoundingBox(e,t){const n=m.applyTransform(e,t),r=m.applyTransform(e.slice(2,4),t),i=m.applyTransform([e[0],e[3]],t),s=m.applyTransform([e[2],e[1]],t);return[Math.min(n[0],r[0],i[0],s[0]),Math.min(n[1],r[1],i[1],s[1]),Math.max(n[0],r[0],i[0],s[0]),Math.max(n[1],r[1],i[1],s[1])]}static inverseTransform(e){const t=e[0]*e[3]-e[1]*e[2];return[e[3]/t,-e[1]/t,-e[2]/t,e[0]/t,(e[2]*e[5]-e[4]*e[3])/t,(e[4]*e[1]-e[5]*e[0])/t]}static apply3dTransform(e,t){return[e[0]*t[0]+e[1]*t[1]+e[2]*t[2],e[3]*t[0]+e[4]*t[1]+e[5]*t[2],e[6]*t[0]+e[7]*t[1]+e[8]*t[2]]}static singularValueDecompose2dScale(e){const t=[e[0],e[2],e[1],e[3]],n=e[0]*t[0]+e[1]*t[2],r=e[0]*t[1]+e[1]*t[3],i=e[2]*t[0]+e[3]*t[2],s=e[2]*t[1]+e[3]*t[3],o=(n+s)/2,a=Math.sqrt((n+s)**2-4*(n*s-i*r))/2,l=o+a||1,c=o-a||1;return[Math.sqrt(l),Math.sqrt(c)]}static normalizeRect(e){const t=e.slice(0);return e[0]>e[2]&&(t[0]=e[2],t[2]=e[0]),e[1]>e[3]&&(t[1]=e[3],t[3]=e[1]),t}static intersect(e,t){function n(e,t){return e-t}const r=[e[0],e[2],t[0],t[2]].sort(n),i=[e[1],e[3],t[1],t[3]].sort(n),s=[];return e=m.normalizeRect(e),t=m.normalizeRect(t),r[0]===e[0]&&r[1]===t[0]||r[0]===t[0]&&r[1]===e[0]?(s[0]=r[1],s[2]=r[2],i[0]===e[1]&&i[1]===t[1]||i[0]===t[1]&&i[1]===e[1]?(s[1]=i[1],s[3]=i[2],s):null):null}static bezierBoundingBox(e,t,n,r,i,s,o,a){const l=[],c=[[],[]];let d,u,h,p,m,g,f,y;for(let c=0;c<2;++c)if(0===c?(u=6*e-12*n+6*i,d=-3*e+9*n-9*i+3*o,h=3*n-3*e):(u=6*t-12*r+6*s,d=-3*t+9*r-9*s+3*a,h=3*r-3*t),Math.abs(d)<1e-12){if(Math.abs(u)<1e-12)continue;p=-h/u,0<p&&p<1&&l.push(p)}else f=u*u-4*h*d,y=Math.sqrt(f),f<0||(m=(-u+y)/(2*d),0<m&&m<1&&l.push(m),g=(-u-y)/(2*d),0<g&&g<1&&l.push(g));let v,b=l.length;const w=b;for(;b--;)p=l[b],v=1-p,c[0][b]=v*v*v*e+3*v*v*p*n+3*v*p*p*i+p*p*p*o,c[1][b]=v*v*v*t+3*v*v*p*r+3*v*p*p*s+p*p*p*a;return c[0][w]=e,c[1][w]=t,c[0][w+1]=o,c[1][w+1]=a,c[0].length=c[1].length=w+2,[Math.min(...c[0]),Math.min(...c[1]),Math.max(...c[0]),Math.max(...c[1])]}}t.Util=m;const g=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,728,711,710,729,733,731,730,732,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,8226,8224,8225,8230,8212,8211,402,8260,8249,8250,8722,8240,8222,8220,8221,8216,8217,8218,8482,64257,64258,321,338,352,376,381,305,322,339,353,382,0,8364];function f(e){return decodeURIComponent(escape(e))}},(e,t,n)=>{n(3)},(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.isNodeJS=void 0;const n=!("object"!=typeof process||process+""!="[object process]"||process.versions.nw||process.versions.electron&&process.type&&"browser"!==process.type);t.isNodeJS=n},(__unused_webpack_module,exports,__w_pdfjs_require__)=>{Object.defineProperty(exports,"__esModule",{value:!0}),exports.build=exports.RenderTask=exports.PDFWorker=exports.PDFPageProxy=exports.PDFDocumentProxy=exports.PDFDocumentLoadingTask=exports.PDFDataRangeTransport=exports.LoopbackPort=exports.DefaultStandardFontDataFactory=exports.DefaultCanvasFactory=exports.DefaultCMapReaderFactory=void 0,exports.getDocument=getDocument,exports.setPDFNetworkStreamFactory=setPDFNetworkStreamFactory,exports.version=void 0;var _util=__w_pdfjs_require__(1),_display_utils=__w_pdfjs_require__(5),_font_loader=__w_pdfjs_require__(7),_node_utils=__w_pdfjs_require__(8),_annotation_storage=__w_pdfjs_require__(9),_canvas=__w_pdfjs_require__(10),_worker_options=__w_pdfjs_require__(12),_is_node=__w_pdfjs_require__(3),_message_handler=__w_pdfjs_require__(13),_metadata=__w_pdfjs_require__(14),_optional_content_config=__w_pdfjs_require__(15),_transport_stream=__w_pdfjs_require__(16),_xfa_text=__w_pdfjs_require__(17);const DEFAULT_RANGE_CHUNK_SIZE=65536,RENDERING_CANCELLED_TIMEOUT=100,DefaultCanvasFactory=_is_node.isNodeJS?_node_utils.NodeCanvasFactory:_display_utils.DOMCanvasFactory;exports.DefaultCanvasFactory=DefaultCanvasFactory;const DefaultCMapReaderFactory=_is_node.isNodeJS?_node_utils.NodeCMapReaderFactory:_display_utils.DOMCMapReaderFactory;exports.DefaultCMapReaderFactory=DefaultCMapReaderFactory;const DefaultStandardFontDataFactory=_is_node.isNodeJS?_node_utils.NodeStandardFontDataFactory:_display_utils.DOMStandardFontDataFactory;let createPDFNetworkStream;function setPDFNetworkStreamFactory(e){createPDFNetworkStream=e}function getDocument(e){const t=new PDFDocumentLoadingTask;let n;if("string"==typeof e||e instanceof URL)n={url:e};else if((0,_util.isArrayBuffer)(e))n={data:e};else if(e instanceof PDFDataRangeTransport)n={range:e};else{if("object"!=typeof e)throw new Error("Invalid parameter in getDocument, need either string, URL, Uint8Array, or parameter object.");if(!e.url&&!e.data&&!e.range)throw new Error("Invalid parameter object: need either .data, .range or .url");n=e}const r=Object.create(null);let i=null,s=null;for(const e in n){const t=n[e];switch(e){case"url":if("undefined"!=typeof window)try{r[e]=new URL(t,window.location).href;continue}catch(e){(0,_util.warn)(`Cannot create valid URL: "${e}".`)}else if("string"==typeof t||t instanceof URL){r[e]=t.toString();continue}throw new Error("Invalid PDF url data: either string or URL-object is expected in the url property.");case"range":i=t;continue;case"worker":s=t;continue;case"data":if(_is_node.isNodeJS&&"undefined"!=typeof Buffer&&t instanceof Buffer)r[e]=new Uint8Array(t);else{if(t instanceof Uint8Array)break;if("string"==typeof t)r[e]=(0,_util.stringToBytes)(t);else if("object"!=typeof t||null===t||isNaN(t.length)){if(!(0,_util.isArrayBuffer)(t))throw new Error("Invalid PDF binary data: either typed array, string, or array-like object is expected in the data property.");r[e]=new Uint8Array(t)}else r[e]=new Uint8Array(t)}continue}r[e]=t}if(r.rangeChunkSize=r.rangeChunkSize||DEFAULT_RANGE_CHUNK_SIZE,r.CMapReaderFactory=r.CMapReaderFactory||DefaultCMapReaderFactory,r.StandardFontDataFactory=r.StandardFontDataFactory||DefaultStandardFontDataFactory,r.ignoreErrors=!0!==r.stopAtErrors,r.fontExtraProperties=!0===r.fontExtraProperties,r.pdfBug=!0===r.pdfBug,r.enableXfa=!0===r.enableXfa,("string"!=typeof r.docBaseUrl||(0,_display_utils.isDataScheme)(r.docBaseUrl))&&(r.docBaseUrl=null),Number.isInteger(r.maxImageSize)||(r.maxImageSize=-1),"boolean"!=typeof r.useWorkerFetch&&(r.useWorkerFetch=r.CMapReaderFactory===_display_utils.DOMCMapReaderFactory&&r.StandardFontDataFactory===_display_utils.DOMStandardFontDataFactory),"boolean"!=typeof r.isEvalSupported&&(r.isEvalSupported=!0),"boolean"!=typeof r.disableFontFace&&(r.disableFontFace=_is_node.isNodeJS),"boolean"!=typeof r.useSystemFonts&&(r.useSystemFonts=!_is_node.isNodeJS&&!r.disableFontFace),void 0===r.ownerDocument&&(r.ownerDocument=globalThis.document),"boolean"!=typeof r.disableRange&&(r.disableRange=!1),"boolean"!=typeof r.disableStream&&(r.disableStream=!1),"boolean"!=typeof r.disableAutoFetch&&(r.disableAutoFetch=!1),(0,_util.setVerbosityLevel)(r.verbosity),!s){const e={verbosity:r.verbosity,port:_worker_options.GlobalWorkerOptions.workerPort};s=e.port?PDFWorker.fromPort(e):new PDFWorker(e),t._worker=s}const o=t.docId;return s.promise.then((function(){if(t.destroyed)throw new Error("Loading aborted");const e=_fetchDocument(s,r,i,o),n=new Promise((function(e){let t;i?t=new _transport_stream.PDFDataTransportStream({length:r.length,initialData:r.initialData,progressiveDone:r.progressiveDone,contentDispositionFilename:r.contentDispositionFilename,disableRange:r.disableRange,disableStream:r.disableStream},i):r.data||(t=createPDFNetworkStream({url:r.url,length:r.length,httpHeaders:r.httpHeaders,withCredentials:r.withCredentials,rangeChunkSize:r.rangeChunkSize,disableRange:r.disableRange,disableStream:r.disableStream})),e(t)}));return Promise.all([e,n]).then((function([e,n]){if(t.destroyed)throw new Error("Loading aborted");const i=new _message_handler.MessageHandler(o,e,s.port),a=new WorkerTransport(i,t,n,r);t._transport=a,i.send("Ready",null)}))})).catch(t._capability.reject),t}async function _fetchDocument(e,t,n,r){if(e.destroyed)throw new Error("Worker was destroyed");n&&(t.length=n.length,t.initialData=n.initialData,t.progressiveDone=n.progressiveDone,t.contentDispositionFilename=n.contentDispositionFilename);const i=await e.messageHandler.sendWithPromise("GetDocRequest",{docId:r,apiVersion:"2.13.216",source:{data:t.data,url:t.url,password:t.password,disableAutoFetch:t.disableAutoFetch,rangeChunkSize:t.rangeChunkSize,length:t.length},maxImageSize:t.maxImageSize,disableFontFace:t.disableFontFace,docBaseUrl:t.docBaseUrl,ignoreErrors:t.ignoreErrors,isEvalSupported:t.isEvalSupported,fontExtraProperties:t.fontExtraProperties,enableXfa:t.enableXfa,useSystemFonts:t.useSystemFonts,cMapUrl:t.useWorkerFetch?t.cMapUrl:null,standardFontDataUrl:t.useWorkerFetch?t.standardFontDataUrl:null});if(e.destroyed)throw new Error("Worker was destroyed");return i}exports.DefaultStandardFontDataFactory=DefaultStandardFontDataFactory;class PDFDocumentLoadingTask{static get idCounters(){return(0,_util.shadow)(this,"idCounters",{doc:0})}constructor(){this._capability=(0,_util.createPromiseCapability)(),this._transport=null,this._worker=null,this.docId="d"+PDFDocumentLoadingTask.idCounters.doc++,this.destroyed=!1,this.onPassword=null,this.onProgress=null,this.onUnsupportedFeature=null}get promise(){return this._capability.promise}async destroy(){this.destroyed=!0,await(this._transport?.destroy()),this._transport=null,this._worker&&(this._worker.destroy(),this._worker=null)}}exports.PDFDocumentLoadingTask=PDFDocumentLoadingTask;class PDFDataRangeTransport{constructor(e,t,n=!1,r=null){this.length=e,this.initialData=t,this.progressiveDone=n,this.contentDispositionFilename=r,this._rangeListeners=[],this._progressListeners=[],this._progressiveReadListeners=[],this._progressiveDoneListeners=[],this._readyCapability=(0,_util.createPromiseCapability)()}addRangeListener(e){this._rangeListeners.push(e)}addProgressListener(e){this._progressListeners.push(e)}addProgressiveReadListener(e){this._progressiveReadListeners.push(e)}addProgressiveDoneListener(e){this._progressiveDoneListeners.push(e)}onDataRange(e,t){for(const n of this._rangeListeners)n(e,t)}onDataProgress(e,t){this._readyCapability.promise.then((()=>{for(const n of this._progressListeners)n(e,t)}))}onDataProgressiveRead(e){this._readyCapability.promise.then((()=>{for(const t of this._progressiveReadListeners)t(e)}))}onDataProgressiveDone(){this._readyCapability.promise.then((()=>{for(const e of this._progressiveDoneListeners)e()}))}transportReady(){this._readyCapability.resolve()}requestDataRange(e,t){(0,_util.unreachable)("Abstract method PDFDataRangeTransport.requestDataRange")}abort(){}}exports.PDFDataRangeTransport=PDFDataRangeTransport;class PDFDocumentProxy{constructor(e,t){this._pdfInfo=e,this._transport=t,Object.defineProperty(this,"fingerprint",{get(){return(0,_display_utils.deprecated)("`PDFDocumentProxy.fingerprint`, please use `PDFDocumentProxy.fingerprints` instead."),this.fingerprints[0]}}),Object.defineProperty(this,"getStats",{value:async()=>((0,_display_utils.deprecated)("`PDFDocumentProxy.getStats`, please use the `PDFDocumentProxy.stats`-getter instead."),this.stats||{streamTypes:{},fontTypes:{}})})}get annotationStorage(){return this._transport.annotationStorage}get numPages(){return this._pdfInfo.numPages}get fingerprints(){return this._pdfInfo.fingerprints}get stats(){return this._transport.stats}get isPureXfa(){return!!this._transport._htmlForXfa}get allXfaHtml(){return this._transport._htmlForXfa}getPage(e){return this._transport.getPage(e)}getPageIndex(e){return this._transport.getPageIndex(e)}getDestinations(){return this._transport.getDestinations()}getDestination(e){return this._transport.getDestination(e)}getPageLabels(){return this._transport.getPageLabels()}getPageLayout(){return this._transport.getPageLayout()}getPageMode(){return this._transport.getPageMode()}getViewerPreferences(){return this._transport.getViewerPreferences()}getOpenAction(){return this._transport.getOpenAction()}getAttachments(){return this._transport.getAttachments()}getJavaScript(){return this._transport.getJavaScript()}getJSActions(){return this._transport.getDocJSActions()}getOutline(){return this._transport.getOutline()}getOptionalContentConfig(){return this._transport.getOptionalContentConfig()}getPermissions(){return this._transport.getPermissions()}getMetadata(){return this._transport.getMetadata()}getMarkInfo(){return this._transport.getMarkInfo()}getData(){return this._transport.getData()}getDownloadInfo(){return this._transport.downloadInfoCapability.promise}cleanup(e=!1){return this._transport.startCleanup(e||this.isPureXfa)}destroy(){return this.loadingTask.destroy()}get loadingParams(){return this._transport.loadingParams}get loadingTask(){return this._transport.loadingTask}saveDocument(){return this._transport.annotationStorage.size<=0&&(0,_display_utils.deprecated)("saveDocument called while `annotationStorage` is empty, please use the getData-method instead."),this._transport.saveDocument()}getFieldObjects(){return this._transport.getFieldObjects()}hasJSActions(){return this._transport.hasJSActions()}getCalculationOrderIds(){return this._transport.getCalculationOrderIds()}}exports.PDFDocumentProxy=PDFDocumentProxy;class PDFPageProxy{constructor(e,t,n,r,i=!1){this._pageIndex=e,this._pageInfo=t,this._ownerDocument=r,this._transport=n,this._stats=i?new _display_utils.StatTimer:null,this._pdfBug=i,this.commonObjs=n.commonObjs,this.objs=new PDFObjects,this.cleanupAfterRender=!1,this.pendingCleanup=!1,this._intentStates=new Map,this._annotationPromises=new Map,this.destroyed=!1}get pageNumber(){return this._pageIndex+1}get rotate(){return this._pageInfo.rotate}get ref(){return this._pageInfo.ref}get userUnit(){return this._pageInfo.userUnit}get view(){return this._pageInfo.view}getViewport({scale:e,rotation:t=this.rotate,offsetX:n=0,offsetY:r=0,dontFlip:i=!1}={}){return new _display_utils.PageViewport({viewBox:this.view,scale:e,rotation:t,offsetX:n,offsetY:r,dontFlip:i})}getAnnotations({intent:e="display"}={}){const t=this._transport.getRenderingIntent(e);let n=this._annotationPromises.get(t.cacheKey);return n||(n=this._transport.getAnnotations(this._pageIndex,t.renderingIntent),this._annotationPromises.set(t.cacheKey,n),n=n.then((e=>{for(const t of e)void 0!==t.titleObj&&Object.defineProperty(t,"title",{get:()=>((0,_display_utils.deprecated)("`title`-property on annotation, please use `titleObj` instead."),t.titleObj.str)}),void 0!==t.contentsObj&&Object.defineProperty(t,"contents",{get:()=>((0,_display_utils.deprecated)("`contents`-property on annotation, please use `contentsObj` instead."),t.contentsObj.str)});return e}))),n}getJSActions(){return this._jsActionsPromise||=this._transport.getPageJSActions(this._pageIndex)}async getXfa(){return this._transport._htmlForXfa?.children[this._pageIndex]||null}render({canvasContext:e,viewport:t,intent:n="display",annotationMode:r=_util.AnnotationMode.ENABLE,transform:i=null,imageLayer:s=null,canvasFactory:o=null,background:a=null,optionalContentConfigPromise:l=null,annotationCanvasMap:c=null}){void 0!==arguments[0]?.renderInteractiveForms&&((0,_display_utils.deprecated)("render no longer accepts the `renderInteractiveForms`-option, please use the `annotationMode`-option instead."),!0===arguments[0].renderInteractiveForms&&r===_util.AnnotationMode.ENABLE&&(r=_util.AnnotationMode.ENABLE_FORMS)),void 0!==arguments[0]?.includeAnnotationStorage&&((0,_display_utils.deprecated)("render no longer accepts the `includeAnnotationStorage`-option, please use the `annotationMode`-option instead."),!0===arguments[0].includeAnnotationStorage&&r===_util.AnnotationMode.ENABLE&&(r=_util.AnnotationMode.ENABLE_STORAGE)),this._stats&&this._stats.time("Overall");const d=this._transport.getRenderingIntent(n,r);this.pendingCleanup=!1,l||(l=this._transport.getOptionalContentConfig());let u=this._intentStates.get(d.cacheKey);u||(u=Object.create(null),this._intentStates.set(d.cacheKey,u)),u.streamReaderCancelTimeout&&(clearTimeout(u.streamReaderCancelTimeout),u.streamReaderCancelTimeout=null);const h=o||new DefaultCanvasFactory({ownerDocument:this._ownerDocument}),p=!!(d.renderingIntent&_util.RenderingIntentFlag.PRINT);u.displayReadyCapability||(u.displayReadyCapability=(0,_util.createPromiseCapability)(),u.operatorList={fnArray:[],argsArray:[],lastChunk:!1},this._stats&&this._stats.time("Page Request"),this._pumpOperatorList(d));const m=e=>{u.renderTasks.delete(g),(this.cleanupAfterRender||p)&&(this.pendingCleanup=!0),this._tryCleanup(),e?(g.capability.reject(e),this._abortOperatorList({intentState:u,reason:e instanceof Error?e:new Error(e)})):g.capability.resolve(),this._stats&&(this._stats.timeEnd("Rendering"),this._stats.timeEnd("Overall"))},g=new InternalRenderTask({callback:m,params:{canvasContext:e,viewport:t,transform:i,imageLayer:s,background:a},objs:this.objs,commonObjs:this.commonObjs,annotationCanvasMap:c,operatorList:u.operatorList,pageIndex:this._pageIndex,canvasFactory:h,useRequestAnimationFrame:!p,pdfBug:this._pdfBug});(u.renderTasks||=new Set).add(g);const f=g.task;return Promise.all([u.displayReadyCapability.promise,l]).then((([e,t])=>{this.pendingCleanup?m():(this._stats&&this._stats.time("Rendering"),g.initializeGraphics({transparency:e,optionalContentConfig:t}),g.operatorListChanged())})).catch(m),f}getOperatorList({intent:e="display",annotationMode:t=_util.AnnotationMode.ENABLE}={}){const n=this._transport.getRenderingIntent(e,t,!0);let r,i=this._intentStates.get(n.cacheKey);return i||(i=Object.create(null),this._intentStates.set(n.cacheKey,i)),i.opListReadCapability||(r=Object.create(null),r.operatorListChanged=function(){i.operatorList.lastChunk&&(i.opListReadCapability.resolve(i.operatorList),i.renderTasks.delete(r))},i.opListReadCapability=(0,_util.createPromiseCapability)(),(i.renderTasks||=new Set).add(r),i.operatorList={fnArray:[],argsArray:[],lastChunk:!1},this._stats&&this._stats.time("Page Request"),this._pumpOperatorList(n)),i.opListReadCapability.promise}streamTextContent({disableCombineTextItems:e=!1,includeMarkedContent:t=!1}={}){return this._transport.messageHandler.sendWithStream("GetTextContent",{pageIndex:this._pageIndex,combineTextItems:!0!==e,includeMarkedContent:!0===t},{highWaterMark:100,size:e=>e.items.length})}getTextContent(e={}){if(this._transport._htmlForXfa)return this.getXfa().then((e=>_xfa_text.XfaText.textContent(e)));const t=this.streamTextContent(e);return new Promise((function(e,n){const r=t.getReader(),i={items:[],styles:Object.create(null)};!function t(){r.read().then((function({value:n,done:r}){r?e(i):(Object.assign(i.styles,n.styles),i.items.push(...n.items),t())}),n)}()}))}getStructTree(){return this._structTreePromise||=this._transport.getStructTree(this._pageIndex)}_destroy(){this.destroyed=!0;const e=[];for(const t of this._intentStates.values())if(this._abortOperatorList({intentState:t,reason:new Error("Page was destroyed."),force:!0}),!t.opListReadCapability)for(const n of t.renderTasks)e.push(n.completed),n.cancel();return this.objs.clear(),this._annotationPromises.clear(),this._jsActionsPromise=null,this._structTreePromise=null,this.pendingCleanup=!1,Promise.all(e)}cleanup(e=!1){return this.pendingCleanup=!0,this._tryCleanup(e)}_tryCleanup(e=!1){if(!this.pendingCleanup)return!1;for(const{renderTasks:e,operatorList:t}of this._intentStates.values())if(e.size>0||!t.lastChunk)return!1;return this._intentStates.clear(),this.objs.clear(),this._annotationPromises.clear(),this._jsActionsPromise=null,this._structTreePromise=null,e&&this._stats&&(this._stats=new _display_utils.StatTimer),this.pendingCleanup=!1,!0}_startRenderPage(e,t){const n=this._intentStates.get(t);n&&(this._stats&&this._stats.timeEnd("Page Request"),n.displayReadyCapability&&n.displayReadyCapability.resolve(e))}_renderPageChunk(e,t){for(let n=0,r=e.length;n<r;n++)t.operatorList.fnArray.push(e.fnArray[n]),t.operatorList.argsArray.push(e.argsArray[n]);t.operatorList.lastChunk=e.lastChunk;for(const e of t.renderTasks)e.operatorListChanged();e.lastChunk&&this._tryCleanup()}_pumpOperatorList({renderingIntent:e,cacheKey:t}){const n=this._transport.messageHandler.sendWithStream("GetOperatorList",{pageIndex:this._pageIndex,intent:e,cacheKey:t,annotationStorage:e&_util.RenderingIntentFlag.ANNOTATIONS_STORAGE?this._transport.annotationStorage.serializable:null}).getReader(),r=this._intentStates.get(t);r.streamReader=n;const i=()=>{n.read().then((({value:e,done:t})=>{t?r.streamReader=null:this._transport.destroyed||(this._renderPageChunk(e,r),i())}),(e=>{if(r.streamReader=null,!this._transport.destroyed){if(r.operatorList){r.operatorList.lastChunk=!0;for(const e of r.renderTasks)e.operatorListChanged();this._tryCleanup()}if(r.displayReadyCapability)r.displayReadyCapability.reject(e);else{if(!r.opListReadCapability)throw e;r.opListReadCapability.reject(e)}}}))};i()}_abortOperatorList({intentState:e,reason:t,force:n=!1}){if(e.streamReader){if(!n){if(e.renderTasks.size>0)return;if(t instanceof _display_utils.RenderingCancelledException)return void(e.streamReaderCancelTimeout=setTimeout((()=>{this._abortOperatorList({intentState:e,reason:t,force:!0}),e.streamReaderCancelTimeout=null}),RENDERING_CANCELLED_TIMEOUT))}if(e.streamReader.cancel(new _util.AbortException(t.message)).catch((()=>{})),e.streamReader=null,!this._transport.destroyed){for(const[t,n]of this._intentStates)if(n===e){this._intentStates.delete(t);break}this.cleanup()}}}get stats(){return this._stats}}exports.PDFPageProxy=PDFPageProxy;class LoopbackPort{constructor(){this._listeners=[],this._deferred=Promise.resolve()}postMessage(e,t){const n={data:structuredClone(e,t)};this._deferred.then((()=>{for(const e of this._listeners)e.call(this,n)}))}addEventListener(e,t){this._listeners.push(t)}removeEventListener(e,t){const n=this._listeners.indexOf(t);this._listeners.splice(n,1)}terminate(){this._listeners.length=0}}exports.LoopbackPort=LoopbackPort;const PDFWorkerUtil={isWorkerDisabled:!1,fallbackWorkerSrc:null,fakeWorkerId:0};if(_is_node.isNodeJS)PDFWorkerUtil.isWorkerDisabled=!0,PDFWorkerUtil.fallbackWorkerSrc="./pdf.worker.js";else if("object"==typeof document){const e=document?.currentScript?.src;e&&(PDFWorkerUtil.fallbackWorkerSrc=e.replace(/(\.(?:min\.)?js)(\?.*)?$/i,".worker$1$2"))}PDFWorkerUtil.createCDNWrapper=function(e){const t=`importScripts("${e}");`;return URL.createObjectURL(new Blob([t]))};class PDFWorker{static get _workerPorts(){return(0,_util.shadow)(this,"_workerPorts",new WeakMap)}constructor({name:e=null,port:t=null,verbosity:n=(0,_util.getVerbosityLevel)()}={}){if(t&&PDFWorker._workerPorts.has(t))throw new Error("Cannot use more than one PDFWorker per port.");if(this.name=e,this.destroyed=!1,this.verbosity=n,this._readyCapability=(0,_util.createPromiseCapability)(),this._port=null,this._webWorker=null,this._messageHandler=null,t)return PDFWorker._workerPorts.set(t,this),void this._initializeFromPort(t);this._initialize()}get promise(){return this._readyCapability.promise}get port(){return this._port}get messageHandler(){return this._messageHandler}_initializeFromPort(e){this._port=e,this._messageHandler=new _message_handler.MessageHandler("main","worker",e),this._messageHandler.on("ready",(function(){})),this._readyCapability.resolve()}_initialize(){if("undefined"!=typeof Worker&&!PDFWorkerUtil.isWorkerDisabled&&!PDFWorker._mainThreadWorkerMessageHandler){let e=PDFWorker.workerSrc;try{(0,_util.isSameOrigin)(window.location.href,e)||(e=PDFWorkerUtil.createCDNWrapper(new URL(e,window.location).href));const t=new Worker(e),n=new _message_handler.MessageHandler("main","worker",t),r=()=>{t.removeEventListener("error",i),n.destroy(),t.terminate(),this.destroyed?this._readyCapability.reject(new Error("Worker was destroyed")):this._setupFakeWorker()},i=()=>{this._webWorker||r()};t.addEventListener("error",i),n.on("test",(e=>{t.removeEventListener("error",i),this.destroyed?r():e?(this._messageHandler=n,this._port=t,this._webWorker=t,this._readyCapability.resolve(),n.send("configure",{verbosity:this.verbosity})):(this._setupFakeWorker(),n.destroy(),t.terminate())})),n.on("ready",(e=>{if(t.removeEventListener("error",i),this.destroyed)r();else try{s()}catch(e){this._setupFakeWorker()}}));const s=()=>{const e=new Uint8Array([255]);try{n.send("test",e,[e.buffer])}catch(t){(0,_util.warn)("Cannot use postMessage transfers."),e[0]=0,n.send("test",e)}};return void s()}catch(e){(0,_util.info)("The worker has been disabled.")}}this._setupFakeWorker()}_setupFakeWorker(){PDFWorkerUtil.isWorkerDisabled||((0,_util.warn)("Setting up fake worker."),PDFWorkerUtil.isWorkerDisabled=!0),PDFWorker._setupFakeWorkerGlobal.then((e=>{if(this.destroyed)return void this._readyCapability.reject(new Error("Worker was destroyed"));const t=new LoopbackPort;this._port=t;const n="fake"+PDFWorkerUtil.fakeWorkerId++,r=new _message_handler.MessageHandler(n+"_worker",n,t);e.setup(r,t);const i=new _message_handler.MessageHandler(n,n+"_worker",t);this._messageHandler=i,this._readyCapability.resolve(),i.send("configure",{verbosity:this.verbosity})})).catch((e=>{this._readyCapability.reject(new Error(`Setting up fake worker failed: "${e.message}".`))}))}destroy(){this.destroyed=!0,this._webWorker&&(this._webWorker.terminate(),this._webWorker=null),PDFWorker._workerPorts.delete(this._port),this._port=null,this._messageHandler&&(this._messageHandler.destroy(),this._messageHandler=null)}static fromPort(e){if(!e?.port)throw new Error("PDFWorker.fromPort - invalid method signature.");return this._workerPorts.has(e.port)?this._workerPorts.get(e.port):new PDFWorker(e)}static get workerSrc(){if(_worker_options.GlobalWorkerOptions.workerSrc)return _worker_options.GlobalWorkerOptions.workerSrc;if(null!==PDFWorkerUtil.fallbackWorkerSrc)return _is_node.isNodeJS||(0,_display_utils.deprecated)('No "GlobalWorkerOptions.workerSrc" specified.'),PDFWorkerUtil.fallbackWorkerSrc;throw new Error('No "GlobalWorkerOptions.workerSrc" specified.')}static get _mainThreadWorkerMessageHandler(){try{return globalThis.pdfjsWorker?.WorkerMessageHandler||null}catch(e){return null}}static get _setupFakeWorkerGlobal(){const loader=async()=>{const mainWorkerMessageHandler=this._mainThreadWorkerMessageHandler;if(mainWorkerMessageHandler)return mainWorkerMessageHandler;if(_is_node.isNodeJS){const worker=eval("require")(this.workerSrc);return worker.WorkerMessageHandler}return await(0,_display_utils.loadScript)(this.workerSrc),window.pdfjsWorker.WorkerMessageHandler};return(0,_util.shadow)(this,"_setupFakeWorkerGlobal",loader())}}exports.PDFWorker=PDFWorker,PDFWorker.getWorkerSrc=function(){return(0,_display_utils.deprecated)("`PDFWorker.getWorkerSrc()`, please use `PDFWorker.workerSrc` instead."),this.workerSrc};class WorkerTransport{#e=null;#t=new Map;#n=new Map;#r=null;constructor(e,t,n,r){this.messageHandler=e,this.loadingTask=t,this.commonObjs=new PDFObjects,this.fontLoader=new _font_loader.FontLoader({docId:t.docId,onUnsupportedFeature:this._onUnsupportedFeature.bind(this),ownerDocument:r.ownerDocument,styleElement:r.styleElement}),this._params=r,r.useWorkerFetch||(this.CMapReaderFactory=new r.CMapReaderFactory({baseUrl:r.cMapUrl,isCompressed:r.cMapPacked}),this.StandardFontDataFactory=new r.StandardFontDataFactory({baseUrl:r.standardFontDataUrl})),this.destroyed=!1,this.destroyCapability=null,this._passwordCapability=null,this._networkStream=n,this._fullReader=null,this._lastProgress=null,this.downloadInfoCapability=(0,_util.createPromiseCapability)(),this.setupMessageHandler()}get annotationStorage(){return(0,_util.shadow)(this,"annotationStorage",new _annotation_storage.AnnotationStorage)}get stats(){return this.#e}getRenderingIntent(e,t=_util.AnnotationMode.ENABLE,n=!1){let r=_util.RenderingIntentFlag.DISPLAY,i="";switch(e){case"any":r=_util.RenderingIntentFlag.ANY;break;case"display":break;case"print":r=_util.RenderingIntentFlag.PRINT;break;default:(0,_util.warn)(`getRenderingIntent - invalid intent: ${e}`)}switch(t){case _util.AnnotationMode.DISABLE:r+=_util.RenderingIntentFlag.ANNOTATIONS_DISABLE;break;case _util.AnnotationMode.ENABLE:break;case _util.AnnotationMode.ENABLE_FORMS:r+=_util.RenderingIntentFlag.ANNOTATIONS_FORMS;break;case _util.AnnotationMode.ENABLE_STORAGE:r+=_util.RenderingIntentFlag.ANNOTATIONS_STORAGE,i=this.annotationStorage.lastModified;break;default:(0,_util.warn)(`getRenderingIntent - invalid annotationMode: ${t}`)}return n&&(r+=_util.RenderingIntentFlag.OPLIST),{renderingIntent:r,cacheKey:`${r}_${i}`}}destroy(){if(this.destroyCapability)return this.destroyCapability.promise;this.destroyed=!0,this.destroyCapability=(0,_util.createPromiseCapability)(),this._passwordCapability&&this._passwordCapability.reject(new Error("Worker was destroyed during onPassword callback"));const e=[];for(const t of this.#t.values())e.push(t._destroy());this.#t.clear(),this.#n.clear(),this.hasOwnProperty("annotationStorage")&&this.annotationStorage.resetModified();const t=this.messageHandler.sendWithPromise("Terminate",null);return e.push(t),Promise.all(e).then((()=>{this.commonObjs.clear(),this.fontLoader.clear(),this.#r=null,this._getFieldObjectsPromise=null,this._hasJSActionsPromise=null,this._networkStream&&this._networkStream.cancelAllRequests(new _util.AbortException("Worker was terminated.")),this.messageHandler&&(this.messageHandler.destroy(),this.messageHandler=null),this.destroyCapability.resolve()}),this.destroyCapability.reject),this.destroyCapability.promise}setupMessageHandler(){const{messageHandler:e,loadingTask:t}=this;e.on("GetReader",((e,t)=>{(0,_util.assert)(this._networkStream,"GetReader - no `IPDFStream` instance available."),this._fullReader=this._networkStream.getFullReader(),this._fullReader.onProgress=e=>{this._lastProgress={loaded:e.loaded,total:e.total}},t.onPull=()=>{this._fullReader.read().then((function({value:e,done:n}){n?t.close():((0,_util.assert)((0,_util.isArrayBuffer)(e),"GetReader - expected an ArrayBuffer."),t.enqueue(new Uint8Array(e),1,[e]))})).catch((e=>{t.error(e)}))},t.onCancel=e=>{this._fullReader.cancel(e),t.ready.catch((e=>{if(!this.destroyed)throw e}))}})),e.on("ReaderHeadersReady",(e=>{const n=(0,_util.createPromiseCapability)(),r=this._fullReader;return r.headersReady.then((()=>{r.isStreamingSupported&&r.isRangeSupported||(this._lastProgress&&t.onProgress?.(this._lastProgress),r.onProgress=e=>{t.onProgress?.({loaded:e.loaded,total:e.total})}),n.resolve({isStreamingSupported:r.isStreamingSupported,isRangeSupported:r.isRangeSupported,contentLength:r.contentLength})}),n.reject),n.promise})),e.on("GetRangeReader",((e,t)=>{(0,_util.assert)(this._networkStream,"GetRangeReader - no `IPDFStream` instance available.");const n=this._networkStream.getRangeReader(e.begin,e.end);n?(t.onPull=()=>{n.read().then((function({value:e,done:n}){n?t.close():((0,_util.assert)((0,_util.isArrayBuffer)(e),"GetRangeReader - expected an ArrayBuffer."),t.enqueue(new Uint8Array(e),1,[e]))})).catch((e=>{t.error(e)}))},t.onCancel=e=>{n.cancel(e),t.ready.catch((e=>{if(!this.destroyed)throw e}))}):t.close()})),e.on("GetDoc",(({pdfInfo:e})=>{this._numPages=e.numPages,this._htmlForXfa=e.htmlForXfa,delete e.htmlForXfa,t._capability.resolve(new PDFDocumentProxy(e,this))})),e.on("DocException",(function(e){let n;switch(e.name){case"PasswordException":n=new _util.PasswordException(e.message,e.code);break;case"InvalidPDFException":n=new _util.InvalidPDFException(e.message);break;case"MissingPDFException":n=new _util.MissingPDFException(e.message);break;case"UnexpectedResponseException":n=new _util.UnexpectedResponseException(e.message,e.status);break;case"UnknownErrorException":n=new _util.UnknownErrorException(e.message,e.details);break;default:(0,_util.unreachable)("DocException - expected a valid Error.")}t._capability.reject(n)})),e.on("PasswordRequest",(e=>{if(this._passwordCapability=(0,_util.createPromiseCapability)(),t.onPassword){const n=e=>{e instanceof Error?this._passwordCapability.reject(e):this._passwordCapability.resolve({password:e})};try{t.onPassword(n,e.code)}catch(e){this._passwordCapability.reject(e)}}else this._passwordCapability.reject(new _util.PasswordException(e.message,e.code));return this._passwordCapability.promise})),e.on("DataLoaded",(e=>{t.onProgress?.({loaded:e.length,total:e.length}),this.downloadInfoCapability.resolve(e)})),e.on("StartRenderPage",(e=>{this.destroyed||this.#t.get(e.pageIndex)._startRenderPage(e.transparency,e.cacheKey)})),e.on("commonobj",(([t,n,r])=>{if(!this.destroyed&&!this.commonObjs.has(t))switch(n){case"Font":const i=this._params;if("error"in r){const e=r.error;(0,_util.warn)(`Error during font loading: ${e}`),this.commonObjs.resolve(t,e);break}let s=null;i.pdfBug&&globalThis.FontInspector?.enabled&&(s={registerFont(e,t){globalThis.FontInspector.fontAdded(e,t)}});const o=new _font_loader.FontFaceObject(r,{isEvalSupported:i.isEvalSupported,disableFontFace:i.disableFontFace,ignoreErrors:i.ignoreErrors,onUnsupportedFeature:this._onUnsupportedFeature.bind(this),fontRegistry:s});this.fontLoader.bind(o).catch((n=>e.sendWithPromise("FontFallback",{id:t}))).finally((()=>{!i.fontExtraProperties&&o.data&&(o.data=null),this.commonObjs.resolve(t,o)}));break;case"FontPath":case"Image":this.commonObjs.resolve(t,r);break;default:throw new Error(`Got unknown common object type ${n}`)}})),e.on("obj",(([e,t,n,r])=>{if(this.destroyed)return;const i=this.#t.get(t);if(!i.objs.has(e))switch(n){case"Image":i.objs.resolve(e,r);const t=8e6;r?.data?.length>t&&(i.cleanupAfterRender=!0);break;case"Pattern":i.objs.resolve(e,r);break;default:throw new Error(`Got unknown object type ${n}`)}})),e.on("DocProgress",(e=>{this.destroyed||t.onProgress?.({loaded:e.loaded,total:e.total})})),e.on("DocStats",(e=>{this.destroyed||(this.#e=Object.freeze({streamTypes:Object.freeze(e.streamTypes),fontTypes:Object.freeze(e.fontTypes)}))})),e.on("UnsupportedFeature",this._onUnsupportedFeature.bind(this)),e.on("FetchBuiltInCMap",(e=>this.destroyed?Promise.reject(new Error("Worker was destroyed.")):this.CMapReaderFactory?this.CMapReaderFactory.fetch(e):Promise.reject(new Error("CMapReaderFactory not initialized, see the `useWorkerFetch` parameter.")))),e.on("FetchStandardFontData",(e=>this.destroyed?Promise.reject(new Error("Worker was destroyed.")):this.StandardFontDataFactory?this.StandardFontDataFactory.fetch(e):Promise.reject(new Error("StandardFontDataFactory not initialized, see the `useWorkerFetch` parameter."))))}_onUnsupportedFeature({featureId:e}){this.destroyed||this.loadingTask.onUnsupportedFeature?.(e)}getData(){return this.messageHandler.sendWithPromise("GetData",null)}getPage(e){if(!Number.isInteger(e)||e<=0||e>this._numPages)return Promise.reject(new Error("Invalid page request."));const t=e-1,n=this.#n.get(t);if(n)return n;const r=this.messageHandler.sendWithPromise("GetPage",{pageIndex:t}).then((e=>{if(this.destroyed)throw new Error("Transport destroyed");const n=new PDFPageProxy(t,e,this,this._params.ownerDocument,this._params.pdfBug);return this.#t.set(t,n),n}));return this.#n.set(t,r),r}getPageIndex(e){return"object"!=typeof e||null===e||!Number.isInteger(e.num)||e.num<0||!Number.isInteger(e.gen)||e.gen<0?Promise.reject(new Error("Invalid pageIndex request.")):this.messageHandler.sendWithPromise("GetPageIndex",{num:e.num,gen:e.gen})}getAnnotations(e,t){return this.messageHandler.sendWithPromise("GetAnnotations",{pageIndex:e,intent:t})}saveDocument(){return this.messageHandler.sendWithPromise("SaveDocument",{isPureXfa:!!this._htmlForXfa,numPages:this._numPages,annotationStorage:this.annotationStorage.serializable,filename:this._fullReader?.filename??null}).finally((()=>{this.annotationStorage.resetModified()}))}getFieldObjects(){return this._getFieldObjectsPromise||=this.messageHandler.sendWithPromise("GetFieldObjects",null)}hasJSActions(){return this._hasJSActionsPromise||=this.messageHandler.sendWithPromise("HasJSActions",null)}getCalculationOrderIds(){return this.messageHandler.sendWithPromise("GetCalculationOrderIds",null)}getDestinations(){return this.messageHandler.sendWithPromise("GetDestinations",null)}getDestination(e){return"string"!=typeof e?Promise.reject(new Error("Invalid destination request.")):this.messageHandler.sendWithPromise("GetDestination",{id:e})}getPageLabels(){return this.messageHandler.sendWithPromise("GetPageLabels",null)}getPageLayout(){return this.messageHandler.sendWithPromise("GetPageLayout",null)}getPageMode(){return this.messageHandler.sendWithPromise("GetPageMode",null)}getViewerPreferences(){return this.messageHandler.sendWithPromise("GetViewerPreferences",null)}getOpenAction(){return this.messageHandler.sendWithPromise("GetOpenAction",null)}getAttachments(){return this.messageHandler.sendWithPromise("GetAttachments",null)}getJavaScript(){return this.messageHandler.sendWithPromise("GetJavaScript",null)}getDocJSActions(){return this.messageHandler.sendWithPromise("GetDocJSActions",null)}getPageJSActions(e){return this.messageHandler.sendWithPromise("GetPageJSActions",{pageIndex:e})}getStructTree(e){return this.messageHandler.sendWithPromise("GetStructTree",{pageIndex:e})}getOutline(){return this.messageHandler.sendWithPromise("GetOutline",null)}getOptionalContentConfig(){return this.messageHandler.sendWithPromise("GetOptionalContentConfig",null).then((e=>new _optional_content_config.OptionalContentConfig(e)))}getPermissions(){return this.messageHandler.sendWithPromise("GetPermissions",null)}getMetadata(){return this.#r||=this.messageHandler.sendWithPromise("GetMetadata",null).then((e=>({info:e[0],metadata:e[1]?new _metadata.Metadata(e[1]):null,contentDispositionFilename:this._fullReader?.filename??null,contentLength:this._fullReader?.contentLength??null})))}getMarkInfo(){return this.messageHandler.sendWithPromise("GetMarkInfo",null)}async startCleanup(e=!1){if(await this.messageHandler.sendWithPromise("Cleanup",null),!this.destroyed){for(const e of this.#t.values())if(!e.cleanup())throw new Error(`startCleanup: Page ${e.pageNumber} is currently rendering.`);this.commonObjs.clear(),e||this.fontLoader.clear(),this.#r=null,this._getFieldObjectsPromise=null,this._hasJSActionsPromise=null}}get loadingParams(){const e=this._params;return(0,_util.shadow)(this,"loadingParams",{disableAutoFetch:e.disableAutoFetch,enableXfa:e.enableXfa})}}class PDFObjects{#i=Object.create(null);#s(e){return this.#i[e]||(this.#i[e]={capability:(0,_util.createPromiseCapability)(),data:null})}get(e,t=null){if(t){const n=this.#s(e);return n.capability.promise.then((()=>t(n.data))),null}const n=this.#i[e];if(!n?.capability.settled)throw new Error(`Requesting object that isn't resolved yet ${e}.`);return n.data}has(e){return this.#i[e]?.capability.settled||!1}resolve(e,t=null){const n=this.#s(e);n.data=t,n.capability.resolve()}clear(){this.#i=Object.create(null)}}class RenderTask{constructor(e){this._internalRenderTask=e,this.onContinue=null}get promise(){return this._internalRenderTask.capability.promise}cancel(){this._internalRenderTask.cancel()}}exports.RenderTask=RenderTask;class InternalRenderTask{static get canvasInUse(){return(0,_util.shadow)(this,"canvasInUse",new WeakSet)}constructor({callback:e,params:t,objs:n,commonObjs:r,annotationCanvasMap:i,operatorList:s,pageIndex:o,canvasFactory:a,useRequestAnimationFrame:l=!1,pdfBug:c=!1}){this.callback=e,this.params=t,this.objs=n,this.commonObjs=r,this.annotationCanvasMap=i,this.operatorListIdx=null,this.operatorList=s,this._pageIndex=o,this.canvasFactory=a,this._pdfBug=c,this.running=!1,this.graphicsReadyCallback=null,this.graphicsReady=!1,this._useRequestAnimationFrame=!0===l&&"undefined"!=typeof window,this.cancelled=!1,this.capability=(0,_util.createPromiseCapability)(),this.task=new RenderTask(this),this._cancelBound=this.cancel.bind(this),this._continueBound=this._continue.bind(this),this._scheduleNextBound=this._scheduleNext.bind(this),this._nextBound=this._next.bind(this),this._canvas=t.canvasContext.canvas}get completed(){return this.capability.promise.catch((function(){}))}initializeGraphics({transparency:e=!1,optionalContentConfig:t}){if(this.cancelled)return;if(this._canvas){if(InternalRenderTask.canvasInUse.has(this._canvas))throw new Error("Cannot use the same canvas during multiple render() operations. Use different canvas or ensure previous operations were cancelled or completed.");InternalRenderTask.canvasInUse.add(this._canvas)}this._pdfBug&&globalThis.StepperManager?.enabled&&(this.stepper=globalThis.StepperManager.create(this._pageIndex),this.stepper.init(this.operatorList),this.stepper.nextBreakPoint=this.stepper.getNextBreakPoint());const{canvasContext:n,viewport:r,transform:i,imageLayer:s,background:o}=this.params;this.gfx=new _canvas.CanvasGraphics(n,this.commonObjs,this.objs,this.canvasFactory,s,t,this.annotationCanvasMap),this.gfx.beginDrawing({transform:i,viewport:r,transparency:e,background:o}),this.operatorListIdx=0,this.graphicsReady=!0,this.graphicsReadyCallback&&this.graphicsReadyCallback()}cancel(e=null){this.running=!1,this.cancelled=!0,this.gfx&&this.gfx.endDrawing(),this._canvas&&InternalRenderTask.canvasInUse.delete(this._canvas),this.callback(e||new _display_utils.RenderingCancelledException(`Rendering cancelled, page ${this._pageIndex+1}`,"canvas"))}operatorListChanged(){this.graphicsReady?(this.stepper&&this.stepper.updateOperatorList(this.operatorList),this.running||this._continue()):this.graphicsReadyCallback||(this.graphicsReadyCallback=this._continueBound)}_continue(){this.running=!0,this.cancelled||(this.task.onContinue?this.task.onContinue(this._scheduleNextBound):this._scheduleNext())}_scheduleNext(){this._useRequestAnimationFrame?window.requestAnimationFrame((()=>{this._nextBound().catch(this._cancelBound)})):Promise.resolve().then(this._nextBound).catch(this._cancelBound)}async _next(){this.cancelled||(this.operatorListIdx=this.gfx.executeOperatorList(this.operatorList,this.operatorListIdx,this._continueBound,this.stepper),this.operatorListIdx===this.operatorList.argsArray.length&&(this.running=!1,this.operatorList.lastChunk&&(this.gfx.endDrawing(),this._canvas&&InternalRenderTask.canvasInUse.delete(this._canvas),this.callback())))}}const version="2.13.216";exports.version=version;const build="399a0ec60";exports.build=build},(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.StatTimer=t.RenderingCancelledException=t.PixelsPerInch=t.PageViewport=t.PDFDateString=t.DOMStandardFontDataFactory=t.DOMSVGFactory=t.DOMCanvasFactory=t.DOMCMapReaderFactory=void 0,t.deprecated=function(e){console.log("Deprecated API usage: "+e)},t.getFilenameFromUrl=function(e){const t=e.indexOf("#"),n=e.indexOf("?"),r=Math.min(t>0?t:e.length,n>0?n:e.length);return e.substring(e.lastIndexOf("/",r)+1,r)},t.getPdfFilenameFromUrl=function(e,t="document.pdf"){if("string"!=typeof e)return t;if(p(e))return(0,i.warn)('getPdfFilenameFromUrl: ignore "data:"-URL for performance reasons.'),t;const n=/[^/?#=]+\.pdf\b(?!.*\.pdf\b)/i,r=/^(?:(?:[^:]+:)?\/\/[^/]+)?([^?#]*)(\?[^#]*)?(#.*)?$/.exec(e);let s=n.exec(r[1])||n.exec(r[2])||n.exec(r[3]);if(s&&(s=s[0],s.includes("%")))try{s=n.exec(decodeURIComponent(s))[0]}catch(e){}return s||t},t.getXfaPageViewport=function(e,{scale:t=1,rotation:n=0}){const{width:r,height:i}=e.attributes.style,s=[0,0,parseInt(r),parseInt(i)];return new u({viewBox:s,scale:t,rotation:n})},t.isDataScheme=p,t.isPdfFile=function(e){return"string"==typeof e&&/\.pdf$/i.test(e)},t.isValidFetchUrl=m,t.loadScript=function(e,t=!1){return new Promise(((n,r)=>{const i=document.createElement("script");i.src=e,i.onload=function(e){t&&i.remove(),n(e)},i.onerror=function(){r(new Error(`Cannot load script at: ${i.src}`))},(document.head||document.documentElement).appendChild(i)}))};var r=n(6),i=n(1);class s{static CSS=96;static PDF=72;static PDF_TO_CSS_UNITS=this.CSS/this.PDF}t.PixelsPerInch=s;class o extends r.BaseCanvasFactory{constructor({ownerDocument:e=globalThis.document}={}){super(),this._document=e}_createCanvas(e,t){const n=this._document.createElement("canvas");return n.width=e,n.height=t,n}}async function a(e,t=!1){if(m(e,document.baseURI)){const n=await fetch(e);if(!n.ok)throw new Error(n.statusText);return t?new Uint8Array(await n.arrayBuffer()):(0,i.stringToBytes)(await n.text())}return new Promise(((n,r)=>{const s=new XMLHttpRequest;s.open("GET",e,!0),t&&(s.responseType="arraybuffer"),s.onreadystatechange=()=>{if(s.readyState===XMLHttpRequest.DONE){if(200===s.status||0===s.status){let e;if(t&&s.response?e=new Uint8Array(s.response):!t&&s.responseText&&(e=(0,i.stringToBytes)(s.responseText)),e)return void n(e)}r(new Error(s.statusText))}},s.send(null)}))}t.DOMCanvasFactory=o;class l extends r.BaseCMapReaderFactory{_fetchData(e,t){return a(e,this.isCompressed).then((e=>({cMapData:e,compressionType:t})))}}t.DOMCMapReaderFactory=l;class c extends r.BaseStandardFontDataFactory{_fetchData(e){return a(e,!0)}}t.DOMStandardFontDataFactory=c;class d extends r.BaseSVGFactory{_createSVG(e){return document.createElementNS("http://www.w3.org/2000/svg",e)}}t.DOMSVGFactory=d;class u{constructor({viewBox:e,scale:t,rotation:n,offsetX:r=0,offsetY:i=0,dontFlip:s=!1}){this.viewBox=e,this.scale=t,this.rotation=n,this.offsetX=r,this.offsetY=i;const o=(e[2]+e[0])/2,a=(e[3]+e[1])/2;let l,c,d,u,h,p,m,g;switch((n%=360)<0&&(n+=360),n){case 180:l=-1,c=0,d=0,u=1;break;case 90:l=0,c=1,d=1,u=0;break;case 270:l=0,c=-1,d=-1,u=0;break;case 0:l=1,c=0,d=0,u=-1;break;default:throw new Error("PageViewport: Invalid rotation, must be a multiple of 90 degrees.")}s&&(d=-d,u=-u),0===l?(h=Math.abs(a-e[1])*t+r,p=Math.abs(o-e[0])*t+i,m=Math.abs(e[3]-e[1])*t,g=Math.abs(e[2]-e[0])*t):(h=Math.abs(o-e[0])*t+r,p=Math.abs(a-e[1])*t+i,m=Math.abs(e[2]-e[0])*t,g=Math.abs(e[3]-e[1])*t),this.transform=[l*t,c*t,d*t,u*t,h-l*t*o-d*t*a,p-c*t*o-u*t*a],this.width=m,this.height=g}clone({scale:e=this.scale,rotation:t=this.rotation,offsetX:n=this.offsetX,offsetY:r=this.offsetY,dontFlip:i=!1}={}){return new u({viewBox:this.viewBox.slice(),scale:e,rotation:t,offsetX:n,offsetY:r,dontFlip:i})}convertToViewportPoint(e,t){return i.Util.applyTransform([e,t],this.transform)}convertToViewportRectangle(e){const t=i.Util.applyTransform([e[0],e[1]],this.transform),n=i.Util.applyTransform([e[2],e[3]],this.transform);return[t[0],t[1],n[0],n[1]]}convertToPdfPoint(e,t){return i.Util.applyInverseTransform([e,t],this.transform)}}t.PageViewport=u;class h extends i.BaseException{constructor(e,t){super(e,"RenderingCancelledException"),this.type=t}}function p(e){const t=e.length;let n=0;for(;n<t&&""===e[n].trim();)n++;return"data:"===e.substring(n,n+5).toLowerCase()}function m(e,t){try{const{protocol:n}=t?new URL(e,t):new URL(e);return"http:"===n||"https:"===n}catch(e){return!1}}let g;t.RenderingCancelledException=h,t.StatTimer=class{constructor(){this.started=Object.create(null),this.times=[]}time(e){e in this.started&&(0,i.warn)(`Timer is already running for ${e}`),this.started[e]=Date.now()}timeEnd(e){e in this.started||(0,i.warn)(`Timer has not been started for ${e}`),this.times.push({name:e,start:this.started[e],end:Date.now()}),delete this.started[e]}toString(){const e=[];let t=0;for(const e of this.times){const n=e.name;n.length>t&&(t=n.length)}for(const n of this.times){const r=n.end-n.start;e.push(`${n.name.padEnd(t)} ${r}ms\n`)}return e.join("")}},t.PDFDateString=class{static toDateObject(e){if(!e||"string"!=typeof e)return null;g||(g=new RegExp("^D:(\\d{4})(\\d{2})?(\\d{2})?(\\d{2})?(\\d{2})?(\\d{2})?([Z|+|-])?(\\d{2})?'?(\\d{2})?'?"));const t=g.exec(e);if(!t)return null;const n=parseInt(t[1],10);let r=parseInt(t[2],10);r=r>=1&&r<=12?r-1:0;let i=parseInt(t[3],10);i=i>=1&&i<=31?i:1;let s=parseInt(t[4],10);s=s>=0&&s<=23?s:0;let o=parseInt(t[5],10);o=o>=0&&o<=59?o:0;let a=parseInt(t[6],10);a=a>=0&&a<=59?a:0;const l=t[7]||"Z";let c=parseInt(t[8],10);c=c>=0&&c<=23?c:0;let d=parseInt(t[9],10)||0;return d=d>=0&&d<=59?d:0,"-"===l?(s+=c,o+=d):"+"===l&&(s-=c,o-=d),new Date(Date.UTC(n,r,i,s,o,a))}}},(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.BaseStandardFontDataFactory=t.BaseSVGFactory=t.BaseCanvasFactory=t.BaseCMapReaderFactory=void 0;var r=n(1);class i{constructor(){this.constructor===i&&(0,r.unreachable)("Cannot initialize BaseCanvasFactory.")}create(e,t){if(e<=0||t<=0)throw new Error("Invalid canvas size");const n=this._createCanvas(e,t);return{canvas:n,context:n.getContext("2d")}}reset(e,t,n){if(!e.canvas)throw new Error("Canvas is not specified");if(t<=0||n<=0)throw new Error("Invalid canvas size");e.canvas.width=t,e.canvas.height=n}destroy(e){if(!e.canvas)throw new Error("Canvas is not specified");e.canvas.width=0,e.canvas.height=0,e.canvas=null,e.context=null}_createCanvas(e,t){(0,r.unreachable)("Abstract method `_createCanvas` called.")}}t.BaseCanvasFactory=i;class s{constructor({baseUrl:e=null,isCompressed:t=!1}){this.constructor===s&&(0,r.unreachable)("Cannot initialize BaseCMapReaderFactory."),this.baseUrl=e,this.isCompressed=t}async fetch({name:e}){if(!this.baseUrl)throw new Error('The CMap "baseUrl" parameter must be specified, ensure that the "cMapUrl" and "cMapPacked" API parameters are provided.');if(!e)throw new Error("CMap name must be specified.");const t=this.baseUrl+e+(this.isCompressed?".bcmap":""),n=this.isCompressed?r.CMapCompressionType.BINARY:r.CMapCompressionType.NONE;return this._fetchData(t,n).catch((e=>{throw new Error(`Unable to load ${this.isCompressed?"binary ":""}CMap at: ${t}`)}))}_fetchData(e,t){(0,r.unreachable)("Abstract method `_fetchData` called.")}}t.BaseCMapReaderFactory=s;class o{constructor({baseUrl:e=null}){this.constructor===o&&(0,r.unreachable)("Cannot initialize BaseStandardFontDataFactory."),this.baseUrl=e}async fetch({filename:e}){if(!this.baseUrl)throw new Error('The standard font "baseUrl" parameter must be specified, ensure that the "standardFontDataUrl" API parameter is provided.');if(!e)throw new Error("Font filename must be specified.");const t=`${this.baseUrl}${e}`;return this._fetchData(t).catch((e=>{throw new Error(`Unable to load font data at: ${t}`)}))}_fetchData(e){(0,r.unreachable)("Abstract method `_fetchData` called.")}}t.BaseStandardFontDataFactory=o;class a{constructor(){this.constructor===a&&(0,r.unreachable)("Cannot initialize BaseSVGFactory.")}create(e,t){if(e<=0||t<=0)throw new Error("Invalid SVG dimensions");const n=this._createSVG("svg:svg");return n.setAttribute("version","1.1"),n.setAttribute("width",`${e}px`),n.setAttribute("height",`${t}px`),n.setAttribute("preserveAspectRatio","none"),n.setAttribute("viewBox",`0 0 ${e} ${t}`),n}createElement(e){if("string"!=typeof e)throw new Error("Invalid SVG element type");return this._createSVG(e)}_createSVG(e){(0,r.unreachable)("Abstract method `_createSVG` called.")}}t.BaseSVGFactory=a},(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.FontLoader=t.FontFaceObject=void 0;var r=n(1);class i{constructor({docId:e,onUnsupportedFeature:t,ownerDocument:n=globalThis.document,styleElement:s=null}){this.constructor===i&&(0,r.unreachable)("Cannot initialize BaseFontLoader."),this.docId=e,this._onUnsupportedFeature=t,this._document=n,this.nativeFontFaces=[],this.styleElement=null}addNativeFontFace(e){this.nativeFontFaces.push(e),this._document.fonts.add(e)}insertRule(e){let t=this.styleElement;t||(t=this.styleElement=this._document.createElement("style"),t.id=`PDFJS_FONT_STYLE_TAG_${this.docId}`,this._document.documentElement.getElementsByTagName("head")[0].appendChild(t));const n=t.sheet;n.insertRule(e,n.cssRules.length)}clear(){for(const e of this.nativeFontFaces)this._document.fonts.delete(e);this.nativeFontFaces.length=0,this.styleElement&&(this.styleElement.remove(),this.styleElement=null)}async bind(e){if(e.attached||e.missingFile)return;if(e.attached=!0,this.isFontLoadingAPISupported){const t=e.createNativeFontFace();if(t){this.addNativeFontFace(t);try{await t.loaded}catch(n){throw this._onUnsupportedFeature({featureId:r.UNSUPPORTED_FEATURES.errorFontLoadNative}),(0,r.warn)(`Failed to load font '${t.family}': '${n}'.`),e.disableFontFace=!0,n}}return}const t=e.createFontFaceRule();if(t){if(this.insertRule(t),this.isSyncFontLoadingSupported)return;await new Promise((n=>{const r=this._queueLoadingCallback(n);this._prepareFontLoadEvent([t],[e],r)}))}}_queueLoadingCallback(e){(0,r.unreachable)("Abstract method `_queueLoadingCallback`.")}get isFontLoadingAPISupported(){const e=!!this._document?.fonts;return(0,r.shadow)(this,"isFontLoadingAPISupported",e)}get isSyncFontLoadingSupported(){(0,r.unreachable)("Abstract method `isSyncFontLoadingSupported`.")}get _loadTestFont(){(0,r.unreachable)("Abstract method `_loadTestFont`.")}_prepareFontLoadEvent(e,t,n){(0,r.unreachable)("Abstract method `_prepareFontLoadEvent`.")}}let s;t.FontLoader=s,t.FontLoader=s=class extends i{constructor(e){super(e),this.loadingContext={requests:[],nextRequestId:0},this.loadTestFontId=0}get isSyncFontLoadingSupported(){let e=!1;return("undefined"==typeof navigator||/Mozilla\/5.0.*?rv:(\d+).*? Gecko/.exec(navigator.userAgent)?.[1]>=14)&&(e=!0),(0,r.shadow)(this,"isSyncFontLoadingSupported",e)}_queueLoadingCallback(e){const t=this.loadingContext,n={id:"pdfjs-font-loading-"+t.nextRequestId++,done:!1,complete:function(){for((0,r.assert)(!n.done,"completeRequest() cannot be called twice."),n.done=!0;t.requests.length>0&&t.requests[0].done;){const e=t.requests.shift();setTimeout(e.callback,0)}},callback:e};return t.requests.push(n),n}get _loadTestFont(){return(0,r.shadow)(this,"_loadTestFont",atob("T1RUTwALAIAAAwAwQ0ZGIDHtZg4AAAOYAAAAgUZGVE1lkzZwAAAEHAAAABxHREVGABQAFQAABDgAAAAeT1MvMlYNYwkAAAEgAAAAYGNtYXABDQLUAAACNAAAAUJoZWFk/xVFDQAAALwAAAA2aGhlYQdkA+oAAAD0AAAAJGhtdHgD6AAAAAAEWAAAAAZtYXhwAAJQAAAAARgAAAAGbmFtZVjmdH4AAAGAAAAAsXBvc3T/hgAzAAADeAAAACAAAQAAAAEAALZRFsRfDzz1AAsD6AAAAADOBOTLAAAAAM4KHDwAAAAAA+gDIQAAAAgAAgAAAAAAAAABAAADIQAAAFoD6AAAAAAD6AABAAAAAAAAAAAAAAAAAAAAAQAAUAAAAgAAAAQD6AH0AAUAAAKKArwAAACMAooCvAAAAeAAMQECAAACAAYJAAAAAAAAAAAAAQAAAAAAAAAAAAAAAFBmRWQAwAAuAC4DIP84AFoDIQAAAAAAAQAAAAAAAAAAACAAIAABAAAADgCuAAEAAAAAAAAAAQAAAAEAAAAAAAEAAQAAAAEAAAAAAAIAAQAAAAEAAAAAAAMAAQAAAAEAAAAAAAQAAQAAAAEAAAAAAAUAAQAAAAEAAAAAAAYAAQAAAAMAAQQJAAAAAgABAAMAAQQJAAEAAgABAAMAAQQJAAIAAgABAAMAAQQJAAMAAgABAAMAAQQJAAQAAgABAAMAAQQJAAUAAgABAAMAAQQJAAYAAgABWABYAAAAAAAAAwAAAAMAAAAcAAEAAAAAADwAAwABAAAAHAAEACAAAAAEAAQAAQAAAC7//wAAAC7////TAAEAAAAAAAABBgAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAAAD/gwAyAAAAAQAAAAAAAAAAAAAAAAAAAAABAAQEAAEBAQJYAAEBASH4DwD4GwHEAvgcA/gXBIwMAYuL+nz5tQXkD5j3CBLnEQACAQEBIVhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYAAABAQAADwACAQEEE/t3Dov6fAH6fAT+fPp8+nwHDosMCvm1Cvm1DAz6fBQAAAAAAAABAAAAAMmJbzEAAAAAzgTjFQAAAADOBOQpAAEAAAAAAAAADAAUAAQAAAABAAAAAgABAAAAAAAAAAAD6AAAAAAAAA=="))}_prepareFontLoadEvent(e,t,n){function i(e,t){return e.charCodeAt(t)<<24|e.charCodeAt(t+1)<<16|e.charCodeAt(t+2)<<8|255&e.charCodeAt(t+3)}function s(e,t,n,r){return e.substring(0,t)+r+e.substring(t+n)}let o,a;const l=this._document.createElement("canvas");l.width=1,l.height=1;const c=l.getContext("2d");let d=0;const u=`lt${Date.now()}${this.loadTestFontId++}`;let h=this._loadTestFont;h=s(h,976,u.length,u);const p=1482184792;let m=i(h,16);for(o=0,a=u.length-3;o<a;o+=4)m=m-p+i(u,o)|0;o<u.length&&(m=m-p+i(u+"XXX",o)|0),h=s(h,16,4,(0,r.string32)(m));const g=`@font-face {font-family:"${u}";src:url(data:font/opentype;base64,${btoa(h)});}`;this.insertRule(g);const f=[];for(const e of t)f.push(e.loadedName);f.push(u);const y=this._document.createElement("div");y.style.visibility="hidden",y.style.width=y.style.height="10px",y.style.position="absolute",y.style.top=y.style.left="0px";for(const e of f){const t=this._document.createElement("span");t.textContent="Hi",t.style.fontFamily=e,y.appendChild(t)}this._document.body.appendChild(y),function e(t,n){if(d++,d>30)return(0,r.warn)("Load test font never loaded."),void n();c.font="30px "+t,c.fillText(".",0,20),c.getImageData(0,0,1,1).data[3]>0?n():setTimeout(e.bind(null,t,n))}(u,(()=>{y.remove(),n.complete()}))}},t.FontFaceObject=class{constructor(e,{isEvalSupported:t=!0,disableFontFace:n=!1,ignoreErrors:r=!1,onUnsupportedFeature:i,fontRegistry:s=null}){this.compiledGlyphs=Object.create(null);for(const t in e)this[t]=e[t];this.isEvalSupported=!1!==t,this.disableFontFace=!0===n,this.ignoreErrors=!0===r,this._onUnsupportedFeature=i,this.fontRegistry=s}createNativeFontFace(){if(!this.data||this.disableFontFace)return null;let e;if(this.cssFontInfo){const t={weight:this.cssFontInfo.fontWeight};this.cssFontInfo.italicAngle&&(t.style=`oblique ${this.cssFontInfo.italicAngle}deg`),e=new FontFace(this.cssFontInfo.fontFamily,this.data,t)}else e=new FontFace(this.loadedName,this.data,{});return this.fontRegistry&&this.fontRegistry.registerFont(this),e}createFontFaceRule(){if(!this.data||this.disableFontFace)return null;const e=(0,r.bytesToString)(this.data),t=`url(data:${this.mimetype};base64,${btoa(e)});`;let n;if(this.cssFontInfo){let e=`font-weight: ${this.cssFontInfo.fontWeight};`;this.cssFontInfo.italicAngle&&(e+=`font-style: oblique ${this.cssFontInfo.italicAngle}deg;`),n=`@font-face {font-family:"${this.cssFontInfo.fontFamily}";${e}src:${t}}`}else n=`@font-face {font-family:"${this.loadedName}";src:${t}}`;return this.fontRegistry&&this.fontRegistry.registerFont(this,t),n}getPathGenerator(e,t){if(void 0!==this.compiledGlyphs[t])return this.compiledGlyphs[t];let n;try{n=e.get(this.loadedName+"_path_"+t)}catch(e){if(!this.ignoreErrors)throw e;return this._onUnsupportedFeature({featureId:r.UNSUPPORTED_FEATURES.errorFontGetPath}),(0,r.warn)(`getPathGenerator - ignoring character: "${e}".`),this.compiledGlyphs[t]=function(e,t){}}if(this.isEvalSupported&&r.IsEvalSupportedCached.value){const e=[];for(const t of n){const n=void 0!==t.args?t.args.join(","):"";e.push("c.",t.cmd,"(",n,");\n")}return this.compiledGlyphs[t]=new Function("c","size",e.join(""))}return this.compiledGlyphs[t]=function(e,t){for(const r of n)"scale"===r.cmd&&(r.args=[t,-t]),e[r.cmd].apply(e,r.args)}}}},(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.NodeStandardFontDataFactory=t.NodeCanvasFactory=t.NodeCMapReaderFactory=void 0;var r=n(6),i=n(3),s=n(1);let o=class{constructor(){(0,s.unreachable)("Not implemented: NodeCanvasFactory")}};t.NodeCanvasFactory=o;let a=class{constructor(){(0,s.unreachable)("Not implemented: NodeCMapReaderFactory")}};t.NodeCMapReaderFactory=a;let l=class{constructor(){(0,s.unreachable)("Not implemented: NodeStandardFontDataFactory")}};if(t.NodeStandardFontDataFactory=l,i.isNodeJS){const e=function(e){return new Promise(((t,n)=>{__webpack_require__(172).readFile(e,((e,r)=>{!e&&r?t(new Uint8Array(r)):n(new Error(e))}))}))};t.NodeCanvasFactory=o=class extends r.BaseCanvasFactory{_createCanvas(e,t){return __webpack_require__(3414).createCanvas(e,t)}},t.NodeCMapReaderFactory=a=class extends r.BaseCMapReaderFactory{_fetchData(t,n){return e(t).then((e=>({cMapData:e,compressionType:n})))}},t.NodeStandardFontDataFactory=l=class extends r.BaseStandardFontDataFactory{_fetchData(t){return e(t)}}}},(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.AnnotationStorage=void 0;var r=n(1);t.AnnotationStorage=class{constructor(){this._storage=new Map,this._timeStamp=Date.now(),this._modified=!1,this.onSetModified=null,this.onResetModified=null}getValue(e,t){const n=this._storage.get(e);return void 0===n?t:Object.assign(t,n)}setValue(e,t){const n=this._storage.get(e);let r=!1;if(void 0!==n)for(const[e,i]of Object.entries(t))n[e]!==i&&(r=!0,n[e]=i);else r=!0,this._storage.set(e,t);r&&(this._timeStamp=Date.now(),this._setModified())}getAll(){return this._storage.size>0?(0,r.objectFromMap)(this._storage):null}get size(){return this._storage.size}_setModified(){this._modified||(this._modified=!0,"function"==typeof this.onSetModified&&this.onSetModified())}resetModified(){this._modified&&(this._modified=!1,"function"==typeof this.onResetModified&&this.onResetModified())}get serializable(){return this._storage.size>0?this._storage:null}get lastModified(){return this._timeStamp.toString()}}},(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CanvasGraphics=void 0;var r=n(1),i=n(11),s=n(5);const o=4096,a=16;function l(e){if(e._transformStack&&(e._transformStack=[]),!e.mozCurrentTransform){e._originalSave=e.save,e._originalRestore=e.restore,e._originalRotate=e.rotate,e._originalScale=e.scale,e._originalTranslate=e.translate,e._originalTransform=e.transform,e._originalSetTransform=e.setTransform,e._originalResetTransform=e.resetTransform,e._transformMatrix=e._transformMatrix||[1,0,0,1,0,0],e._transformStack=[];try{const t=Object.getOwnPropertyDescriptor(Object.getPrototypeOf(e),"lineWidth");e._setLineWidth=t.set,e._getLineWidth=t.get,Object.defineProperty(e,"lineWidth",{set:function(e){this._setLineWidth(1.000001*e)},get:function(){return this._getLineWidth()}})}catch(e){}Object.defineProperty(e,"mozCurrentTransform",{get:function(){return this._transformMatrix}}),Object.defineProperty(e,"mozCurrentTransformInverse",{get:function(){const[e,t,n,r,i,s]=this._transformMatrix,o=e*r-t*n,a=t*n-e*r;return[r/o,t/a,n/a,e/o,(r*i-n*s)/a,(t*i-e*s)/o]}}),e.save=function(){const e=this._transformMatrix;this._transformStack.push(e),this._transformMatrix=e.slice(0,6),this._originalSave()},e.restore=function(){0===this._transformStack.length&&(0,r.warn)("Tried to restore a ctx when the stack was already empty.");const e=this._transformStack.pop();e&&(this._transformMatrix=e,this._originalRestore())},e.translate=function(e,t){const n=this._transformMatrix;n[4]=n[0]*e+n[2]*t+n[4],n[5]=n[1]*e+n[3]*t+n[5],this._originalTranslate(e,t)},e.scale=function(e,t){const n=this._transformMatrix;n[0]*=e,n[1]*=e,n[2]*=t,n[3]*=t,this._originalScale(e,t)},e.transform=function(t,n,r,i,s,o){const a=this._transformMatrix;this._transformMatrix=[a[0]*t+a[2]*n,a[1]*t+a[3]*n,a[0]*r+a[2]*i,a[1]*r+a[3]*i,a[0]*s+a[2]*o+a[4],a[1]*s+a[3]*o+a[5]],e._originalTransform(t,n,r,i,s,o)},e.setTransform=function(t,n,r,i,s,o){this._transformMatrix=[t,n,r,i,s,o],e._originalSetTransform(t,n,r,i,s,o)},e.resetTransform=function(){this._transformMatrix=[1,0,0,1,0,0],e._originalResetTransform()},e.rotate=function(e){const t=Math.cos(e),n=Math.sin(e),r=this._transformMatrix;this._transformMatrix=[r[0]*t+r[2]*n,r[1]*t+r[3]*n,r[0]*-n+r[2]*t,r[1]*-n+r[3]*t,r[4],r[5]],this._originalRotate(e)}}}class c{constructor(e){this.canvasFactory=e,this.cache=Object.create(null)}getCanvas(e,t,n,r){let i;return void 0!==this.cache[e]?(i=this.cache[e],this.canvasFactory.reset(i,t,n),i.context.setTransform(1,0,0,1,0,0)):(i=this.canvasFactory.create(t,n),this.cache[e]=i),r&&l(i.context),i}clear(){for(const e in this.cache){const t=this.cache[e];this.canvasFactory.destroy(t),delete this.cache[e]}}}class d{constructor(e,t){this.alphaIsShape=!1,this.fontSize=0,this.fontSizeScale=1,this.textMatrix=r.IDENTITY_MATRIX,this.textMatrixScale=1,this.fontMatrix=r.FONT_IDENTITY_MATRIX,this.leading=0,this.x=0,this.y=0,this.lineX=0,this.lineY=0,this.charSpacing=0,this.wordSpacing=0,this.textHScale=1,this.textRenderingMode=r.TextRenderingMode.FILL,this.textRise=0,this.fillColor="#000000",this.strokeColor="#000000",this.patternFill=!1,this.fillAlpha=1,this.strokeAlpha=1,this.lineWidth=1,this.activeSMask=null,this.transferMaps=null,this.startNewPathAndClipBox([0,0,e,t])}clone(){const e=Object.create(this);return e.clipBox=this.clipBox.slice(),e}setCurrentPoint(e,t){this.x=e,this.y=t}updatePathMinMax(e,t,n){[t,n]=r.Util.applyTransform([t,n],e),this.minX=Math.min(this.minX,t),this.minY=Math.min(this.minY,n),this.maxX=Math.max(this.maxX,t),this.maxY=Math.max(this.maxY,n)}updateCurvePathMinMax(e,t,n,i,s,o,a,l,c){const d=r.Util.bezierBoundingBox(t,n,i,s,o,a,l,c);this.updatePathMinMax(e,d[0],d[1]),this.updatePathMinMax(e,d[2],d[3])}getPathBoundingBox(e=i.PathType.FILL,t=null){const n=[this.minX,this.minY,this.maxX,this.maxY];if(e===i.PathType.STROKE){t||(0,r.unreachable)("Stroke bounding box must include transform.");const e=r.Util.singularValueDecompose2dScale(t),i=e[0]*this.lineWidth/2,s=e[1]*this.lineWidth/2;n[0]-=i,n[1]-=s,n[2]+=i,n[3]+=s}return n}updateClipFromPath(){const e=r.Util.intersect(this.clipBox,this.getPathBoundingBox());this.startNewPathAndClipBox(e||[0,0,0,0])}startNewPathAndClipBox(e){this.clipBox=e,this.minX=1/0,this.minY=1/0,this.maxX=0,this.maxY=0}getClippedPathBoundingBox(e=i.PathType.FILL,t=null){return r.Util.intersect(this.clipBox,this.getPathBoundingBox(e,t))}}function u(e,t,n=null){if("undefined"!=typeof ImageData&&t instanceof ImageData)return void e.putImageData(t,0,0);const i=t.height,s=t.width,o=i%a,l=(i-o)/a,c=0===o?l:l+1,d=e.createImageData(s,a);let u,h=0;const p=t.data,m=d.data;let g,f,y,v,b,w,S,_;if(n)switch(n.length){case 1:b=n[0],w=n[0],S=n[0],_=n[0];break;case 4:b=n[0],w=n[1],S=n[2],_=n[3]}if(t.kind===r.ImageKind.GRAYSCALE_1BPP){const t=p.byteLength,n=new Uint32Array(m.buffer,0,m.byteLength>>2),i=n.length,v=s+7>>3;let b=4294967295,w=r.IsLittleEndianCached.value?4278190080:255;for(_&&255===_[0]&&0===_[255]&&([b,w]=[w,b]),g=0;g<c;g++){for(y=g<l?a:o,u=0,f=0;f<y;f++){const e=t-h;let r=0;const i=e>v?s:8*e-7,o=-8&i;let a=0,l=0;for(;r<o;r+=8)l=p[h++],n[u++]=128&l?b:w,n[u++]=64&l?b:w,n[u++]=32&l?b:w,n[u++]=16&l?b:w,n[u++]=8&l?b:w,n[u++]=4&l?b:w,n[u++]=2&l?b:w,n[u++]=1&l?b:w;for(;r<i;r++)0===a&&(l=p[h++],a=128),n[u++]=l&a?b:w,a>>=1}for(;u<i;)n[u++]=0;e.putImageData(d,0,g*a)}}else if(t.kind===r.ImageKind.RGBA_32BPP){const t=!!(b||w||S);for(f=0,v=s*a*4,g=0;g<l;g++){if(m.set(p.subarray(h,h+v)),h+=v,t)for(let e=0;e<v;e+=4)b&&(m[e+0]=b[m[e+0]]),w&&(m[e+1]=w[m[e+1]]),S&&(m[e+2]=S[m[e+2]]);e.putImageData(d,0,f),f+=a}if(g<c){if(v=s*o*4,m.set(p.subarray(h,h+v)),t)for(let e=0;e<v;e+=4)b&&(m[e+0]=b[m[e+0]]),w&&(m[e+1]=w[m[e+1]]),S&&(m[e+2]=S[m[e+2]]);e.putImageData(d,0,f)}}else{if(t.kind!==r.ImageKind.RGB_24BPP)throw new Error(`bad image kind: ${t.kind}`);{const t=!!(b||w||S);for(y=a,v=s*y,g=0;g<c;g++){for(g>=l&&(y=o,v=s*y),u=0,f=v;f--;)m[u++]=p[h++],m[u++]=p[h++],m[u++]=p[h++],m[u++]=255;if(t)for(let e=0;e<u;e+=4)b&&(m[e+0]=b[m[e+0]]),w&&(m[e+1]=w[m[e+1]]),S&&(m[e+2]=S[m[e+2]]);e.putImageData(d,0,g*a)}}}}function h(e,t){const n=t.height,r=t.width,i=n%a,s=(n-i)/a,o=0===i?s:s+1,l=e.createImageData(r,a);let c=0;const d=t.data,u=l.data;for(let t=0;t<o;t++){const n=t<s?a:i;let o=3;for(let e=0;e<n;e++){let e,t=0;for(let n=0;n<r;n++)t||(e=d[c++],t=128),u[o]=e&t?0:255,o+=4,t>>=1}e.putImageData(l,0,t*a)}}function p(e,t){const n=["strokeStyle","fillStyle","fillRule","globalAlpha","lineWidth","lineCap","lineJoin","miterLimit","globalCompositeOperation","font"];for(let r=0,i=n.length;r<i;r++){const i=n[r];void 0!==e[i]&&(t[i]=e[i])}void 0!==e.setLineDash&&(t.setLineDash(e.getLineDash()),t.lineDashOffset=e.lineDashOffset)}function m(e){e.strokeStyle="#000000",e.fillStyle="#000000",e.fillRule="nonzero",e.globalAlpha=1,e.lineWidth=1,e.lineCap="butt",e.lineJoin="miter",e.miterLimit=10,e.globalCompositeOperation="source-over",e.font="10px sans-serif",void 0!==e.setLineDash&&(e.setLineDash([]),e.lineDashOffset=0)}function g(e,t,n,r){const i=e.length;for(let s=3;s<i;s+=4){const i=e[s];if(0===i)e[s-3]=t,e[s-2]=n,e[s-1]=r;else if(i<255){const o=255-i;e[s-3]=e[s-3]*i+t*o>>8,e[s-2]=e[s-2]*i+n*o>>8,e[s-1]=e[s-1]*i+r*o>>8}}}function f(e,t,n){const r=e.length;for(let i=3;i<r;i+=4){const r=n?n[e[i]]:e[i];t[i]=t[i]*r*.00392156862745098|0}}function y(e,t,n){const r=e.length;for(let i=3;i<r;i+=4){const r=77*e[i-3]+152*e[i-2]+28*e[i-1];t[i]=n?t[i]*n[r>>8]>>8:t[i]*r>>16}}function v(e,t){const n=r.Util.singularValueDecompose2dScale(e);n[0]=Math.fround(n[0]),n[1]=Math.fround(n[1]);const i=Math.fround((globalThis.devicePixelRatio||1)*s.PixelsPerInch.PDF_TO_CSS_UNITS);return void 0!==t?t:n[0]<=i||n[1]<=i}const b=["butt","round","square"],w=["miter","round","bevel"],S={},_={};class k{constructor(e,t,n,r,i,s,o){this.ctx=e,this.current=new d(this.ctx.canvas.width,this.ctx.canvas.height),this.stateStack=[],this.pendingClip=null,this.pendingEOFill=!1,this.res=null,this.xobjs=null,this.commonObjs=t,this.objs=n,this.canvasFactory=r,this.imageLayer=i,this.groupStack=[],this.processingType3=null,this.baseTransform=null,this.baseTransformStack=[],this.groupLevel=0,this.smaskStack=[],this.smaskCounter=0,this.tempSMask=null,this.suspendedCtx=null,this.contentVisible=!0,this.markedContentStack=[],this.optionalContentConfig=s,this.cachedCanvases=new c(this.canvasFactory),this.cachedPatterns=new Map,this.annotationCanvasMap=o,this.viewportScale=1,this.outputScaleX=1,this.outputScaleY=1,e&&l(e),this._cachedGetSinglePixelWidth=null}beginDrawing({transform:e,viewport:t,transparency:n=!1,background:r=null}){const i=this.ctx.canvas.width,s=this.ctx.canvas.height;if(this.ctx.save(),this.ctx.fillStyle=r||"rgb(255, 255, 255)",this.ctx.fillRect(0,0,i,s),this.ctx.restore(),n){const e=this.cachedCanvases.getCanvas("transparent",i,s,!0);this.compositeCtx=this.ctx,this.transparentCanvas=e.canvas,this.ctx=e.context,this.ctx.save(),this.ctx.transform.apply(this.ctx,this.compositeCtx.mozCurrentTransform)}this.ctx.save(),m(this.ctx),e&&(this.ctx.transform.apply(this.ctx,e),this.outputScaleX=e[0],this.outputScaleY=e[0]),this.ctx.transform.apply(this.ctx,t.transform),this.viewportScale=t.scale,this.baseTransform=this.ctx.mozCurrentTransform.slice(),this._combinedScaleFactor=Math.hypot(this.baseTransform[0],this.baseTransform[2]),this.imageLayer&&this.imageLayer.beginLayout()}executeOperatorList(e,t,n,i){const s=e.argsArray,o=e.fnArray;let a=t||0;const l=s.length;if(l===a)return a;const c=l-a>10&&"function"==typeof n,d=c?Date.now()+15:0;let u=0;const h=this.commonObjs,p=this.objs;let m;for(;;){if(void 0!==i&&a===i.nextBreakPoint)return i.breakIt(a,n),a;if(m=o[a],m!==r.OPS.dependency)this[m].apply(this,s[a]);else for(const e of s[a]){const t=e.startsWith("g_")?h:p;if(!t.has(e))return t.get(e,n),a}if(a++,a===l)return a;if(c&&++u>10){if(Date.now()>d)return n(),a;u=0}}}endDrawing(){for(;this.stateStack.length||this.inSMaskMode;)this.restore();this.ctx.restore(),this.transparentCanvas&&(this.ctx=this.compositeCtx,this.ctx.save(),this.ctx.setTransform(1,0,0,1,0,0),this.ctx.drawImage(this.transparentCanvas,0,0),this.ctx.restore(),this.transparentCanvas=null),this.cachedCanvases.clear(),this.cachedPatterns.clear(),this.imageLayer&&this.imageLayer.endLayout()}_scaleImage(e,t){const n=e.width,r=e.height;let i,s,o=Math.max(Math.hypot(t[0],t[1]),1),a=Math.max(Math.hypot(t[2],t[3]),1),l=n,c=r,d="prescale1";for(;o>2&&l>1||a>2&&c>1;){let t=l,n=c;o>2&&l>1&&(t=Math.ceil(l/2),o/=l/t),a>2&&c>1&&(n=Math.ceil(c/2),a/=c/n),i=this.cachedCanvases.getCanvas(d,t,n),s=i.context,s.clearRect(0,0,t,n),s.drawImage(e,0,0,l,c,0,0,t,n),e=i.canvas,l=t,c=n,d="prescale1"===d?"prescale2":"prescale1"}return{img:e,paintWidth:l,paintHeight:c}}_createMaskCanvas(e){const t=this.ctx,n=e.width,s=e.height,o=this.current.fillColor,a=this.current.patternFill,l=this.cachedCanvases.getCanvas("maskCanvas",n,s);h(l.context,e);const c=t.mozCurrentTransform;let d=r.Util.transform(c,[1/n,0,0,-1/s,0,0]);d=r.Util.transform(d,[1,0,0,1,0,-s]);const u=r.Util.applyTransform([0,0],d),p=r.Util.applyTransform([n,s],d),m=r.Util.normalizeRect([u[0],u[1],p[0],p[1]]),g=Math.ceil(m[2]-m[0]),f=Math.ceil(m[3]-m[1]),y=this.cachedCanvases.getCanvas("fillCanvas",g,f,!0),b=y.context,w=Math.min(u[0],p[0]),S=Math.min(u[1],p[1]);b.translate(-w,-S),b.transform.apply(b,d);const _=this._scaleImage(l.canvas,b.mozCurrentTransformInverse);b.imageSmoothingEnabled=v(b.mozCurrentTransform,e.interpolate),b.drawImage(_.img,0,0,_.img.width,_.img.height,0,0,n,s),b.globalCompositeOperation="source-in";const k=r.Util.transform(b.mozCurrentTransformInverse,[1,0,0,1,-w,-S]);return b.fillStyle=a?o.getPattern(t,this,k,i.PathType.FILL):o,b.fillRect(0,0,n,s),{canvas:y.canvas,offsetX:Math.round(w),offsetY:Math.round(S)}}setLineWidth(e){this.current.lineWidth=e,this.ctx.lineWidth=e}setLineCap(e){this.ctx.lineCap=b[e]}setLineJoin(e){this.ctx.lineJoin=w[e]}setMiterLimit(e){this.ctx.miterLimit=e}setDash(e,t){const n=this.ctx;void 0!==n.setLineDash&&(n.setLineDash(e),n.lineDashOffset=t)}setRenderingIntent(e){}setFlatness(e){}setGState(e){for(let t=0,n=e.length;t<n;t++){const n=e[t],r=n[0],i=n[1];switch(r){case"LW":this.setLineWidth(i);break;case"LC":this.setLineCap(i);break;case"LJ":this.setLineJoin(i);break;case"ML":this.setMiterLimit(i);break;case"D":this.setDash(i[0],i[1]);break;case"RI":this.setRenderingIntent(i);break;case"FL":this.setFlatness(i);break;case"Font":this.setFont(i[0],i[1]);break;case"CA":this.current.strokeAlpha=n[1];break;case"ca":this.current.fillAlpha=n[1],this.ctx.globalAlpha=n[1];break;case"BM":this.ctx.globalCompositeOperation=i;break;case"SMask":this.current.activeSMask=i?this.tempSMask:null,this.tempSMask=null,this.checkSMaskState();break;case"TR":this.current.transferMaps=i}}}get inSMaskMode(){return!!this.suspendedCtx}checkSMaskState(){const e=this.inSMaskMode;this.current.activeSMask&&!e?this.beginSMaskMode():!this.current.activeSMask&&e&&this.endSMaskMode()}beginSMaskMode(){if(this.inSMaskMode)throw new Error("beginSMaskMode called while already in smask mode");const e=this.ctx.canvas.width,t=this.ctx.canvas.height,n="smaskGroupAt"+this.groupLevel,r=this.cachedCanvases.getCanvas(n,e,t,!0);this.suspendedCtx=this.ctx,this.ctx=r.context;const i=this.ctx;i.setTransform.apply(i,this.suspendedCtx.mozCurrentTransform),p(this.suspendedCtx,i),function(e,t){if(e._removeMirroring)throw new Error("Context is already forwarding operations.");e.__originalSave=e.save,e.__originalRestore=e.restore,e.__originalRotate=e.rotate,e.__originalScale=e.scale,e.__originalTranslate=e.translate,e.__originalTransform=e.transform,e.__originalSetTransform=e.setTransform,e.__originalResetTransform=e.resetTransform,e.__originalClip=e.clip,e.__originalMoveTo=e.moveTo,e.__originalLineTo=e.lineTo,e.__originalBezierCurveTo=e.bezierCurveTo,e.__originalRect=e.rect,e.__originalClosePath=e.closePath,e.__originalBeginPath=e.beginPath,e._removeMirroring=()=>{e.save=e.__originalSave,e.restore=e.__originalRestore,e.rotate=e.__originalRotate,e.scale=e.__originalScale,e.translate=e.__originalTranslate,e.transform=e.__originalTransform,e.setTransform=e.__originalSetTransform,e.resetTransform=e.__originalResetTransform,e.clip=e.__originalClip,e.moveTo=e.__originalMoveTo,e.lineTo=e.__originalLineTo,e.bezierCurveTo=e.__originalBezierCurveTo,e.rect=e.__originalRect,e.closePath=e.__originalClosePath,e.beginPath=e.__originalBeginPath,delete e._removeMirroring},e.save=function(){t.save(),this.__originalSave()},e.restore=function(){t.restore(),this.__originalRestore()},e.translate=function(e,n){t.translate(e,n),this.__originalTranslate(e,n)},e.scale=function(e,n){t.scale(e,n),this.__originalScale(e,n)},e.transform=function(e,n,r,i,s,o){t.transform(e,n,r,i,s,o),this.__originalTransform(e,n,r,i,s,o)},e.setTransform=function(e,n,r,i,s,o){t.setTransform(e,n,r,i,s,o),this.__originalSetTransform(e,n,r,i,s,o)},e.resetTransform=function(){t.resetTransform(),this.__originalResetTransform()},e.rotate=function(e){t.rotate(e),this.__originalRotate(e)},e.clip=function(e){t.clip(e),this.__originalClip(e)},e.moveTo=function(e,n){t.moveTo(e,n),this.__originalMoveTo(e,n)},e.lineTo=function(e,n){t.lineTo(e,n),this.__originalLineTo(e,n)},e.bezierCurveTo=function(e,n,r,i,s,o){t.bezierCurveTo(e,n,r,i,s,o),this.__originalBezierCurveTo(e,n,r,i,s,o)},e.rect=function(e,n,r,i){t.rect(e,n,r,i),this.__originalRect(e,n,r,i)},e.closePath=function(){t.closePath(),this.__originalClosePath()},e.beginPath=function(){t.beginPath(),this.__originalBeginPath()}}(i,this.suspendedCtx),this.setGState([["BM","source-over"],["ca",1],["CA",1]])}endSMaskMode(){if(!this.inSMaskMode)throw new Error("endSMaskMode called while not in smask mode");this.ctx._removeMirroring(),p(this.ctx,this.suspendedCtx),this.ctx=this.suspendedCtx,this.suspendedCtx=null}compose(e){if(!this.current.activeSMask)return;e?(e[0]=Math.floor(e[0]),e[1]=Math.floor(e[1]),e[2]=Math.ceil(e[2]),e[3]=Math.ceil(e[3])):e=[0,0,this.ctx.canvas.width,this.ctx.canvas.height];const t=this.current.activeSMask;(function(e,t,n,r){const i=r[0],s=r[1],o=r[2]-i,a=r[3]-s;0!==o&&0!==a&&(function(e,t,n,r,i,s,o,a,l,c,d){const u=!!s,h=u?s[0]:0,p=u?s[1]:0,m=u?s[2]:0;let v;v="Luminosity"===i?y:f;const b=Math.min(r,Math.ceil(1048576/n));for(let i=0;i<r;i+=b){const s=Math.min(b,r-i),f=e.getImageData(a-c,i+(l-d),n,s),y=t.getImageData(a,i+l,n,s);u&&g(f.data,h,p,m),v(f.data,y.data,o),t.putImageData(y,a,i+l)}}(t.context,n,o,a,t.subtype,t.backdrop,t.transferMap,i,s,t.offsetX,t.offsetY),e.save(),e.globalAlpha=1,e.globalCompositeOperation="source-over",e.setTransform(1,0,0,1,0,0),e.drawImage(n.canvas,0,0),e.restore())})(this.suspendedCtx,t,this.ctx,e),this.ctx.save(),this.ctx.setTransform(1,0,0,1,0,0),this.ctx.clearRect(0,0,this.ctx.canvas.width,this.ctx.canvas.height),this.ctx.restore()}save(){this.inSMaskMode?(p(this.ctx,this.suspendedCtx),this.suspendedCtx.save()):this.ctx.save();const e=this.current;this.stateStack.push(e),this.current=e.clone()}restore(){0===this.stateStack.length&&this.inSMaskMode&&this.endSMaskMode(),0!==this.stateStack.length&&(this.current=this.stateStack.pop(),this.inSMaskMode?(this.suspendedCtx.restore(),p(this.suspendedCtx,this.ctx)):this.ctx.restore(),this.checkSMaskState(),this.pendingClip=null,this._cachedGetSinglePixelWidth=null)}transform(e,t,n,r,i,s){this.ctx.transform(e,t,n,r,i,s),this._cachedGetSinglePixelWidth=null}constructPath(e,t){const n=this.ctx,i=this.current;let s,o,a=i.x,l=i.y;for(let c=0,d=0,u=e.length;c<u;c++)switch(0|e[c]){case r.OPS.rectangle:a=t[d++],l=t[d++];const e=t[d++],c=t[d++],u=a+e,h=l+c;n.moveTo(a,l),0===e||0===c?n.lineTo(u,h):(n.lineTo(u,l),n.lineTo(u,h),n.lineTo(a,h)),i.updatePathMinMax(n.mozCurrentTransform,a,l),i.updatePathMinMax(n.mozCurrentTransform,u,h),n.closePath();break;case r.OPS.moveTo:a=t[d++],l=t[d++],n.moveTo(a,l),i.updatePathMinMax(n.mozCurrentTransform,a,l);break;case r.OPS.lineTo:a=t[d++],l=t[d++],n.lineTo(a,l),i.updatePathMinMax(n.mozCurrentTransform,a,l);break;case r.OPS.curveTo:s=a,o=l,a=t[d+4],l=t[d+5],n.bezierCurveTo(t[d],t[d+1],t[d+2],t[d+3],a,l),i.updateCurvePathMinMax(n.mozCurrentTransform,s,o,t[d],t[d+1],t[d+2],t[d+3],a,l),d+=6;break;case r.OPS.curveTo2:s=a,o=l,n.bezierCurveTo(a,l,t[d],t[d+1],t[d+2],t[d+3]),i.updateCurvePathMinMax(n.mozCurrentTransform,s,o,a,l,t[d],t[d+1],t[d+2],t[d+3]),a=t[d+2],l=t[d+3],d+=4;break;case r.OPS.curveTo3:s=a,o=l,a=t[d+2],l=t[d+3],n.bezierCurveTo(t[d],t[d+1],a,l,a,l),i.updateCurvePathMinMax(n.mozCurrentTransform,s,o,t[d],t[d+1],a,l,a,l),d+=4;break;case r.OPS.closePath:n.closePath()}i.setCurrentPoint(a,l)}closePath(){this.ctx.closePath()}stroke(e){e=void 0===e||e;const t=this.ctx,n=this.current.strokeColor;if(t.globalAlpha=this.current.strokeAlpha,this.contentVisible)if("object"==typeof n&&n?.getPattern){const e=this.getSinglePixelWidth();t.save(),t.strokeStyle=n.getPattern(t,this,t.mozCurrentTransformInverse,i.PathType.STROKE),t.lineWidth=Math.max(e,this.current.lineWidth),t.stroke(),t.restore()}else{const e=this.getSinglePixelWidth();e<0&&-e>=this.current.lineWidth?(t.save(),t.resetTransform(),t.lineWidth=Math.floor(this._combinedScaleFactor),t.stroke(),t.restore()):(t.lineWidth=Math.max(e,this.current.lineWidth),t.stroke())}e&&this.consumePath(this.current.getClippedPathBoundingBox()),t.globalAlpha=this.current.fillAlpha}closeStroke(){this.closePath(),this.stroke()}fill(e){e=void 0===e||e;const t=this.ctx,n=this.current.fillColor;let r=!1;this.current.patternFill&&(t.save(),t.fillStyle=n.getPattern(t,this,t.mozCurrentTransformInverse,i.PathType.FILL),r=!0);const s=this.current.getClippedPathBoundingBox();this.contentVisible&&null!==s&&(this.pendingEOFill?(t.fill("evenodd"),this.pendingEOFill=!1):t.fill()),r&&t.restore(),e&&this.consumePath(s)}eoFill(){this.pendingEOFill=!0,this.fill()}fillStroke(){this.fill(!1),this.stroke(!1),this.consumePath()}eoFillStroke(){this.pendingEOFill=!0,this.fillStroke()}closeFillStroke(){this.closePath(),this.fillStroke()}closeEOFillStroke(){this.pendingEOFill=!0,this.closePath(),this.fillStroke()}endPath(){this.consumePath()}clip(){this.pendingClip=S}eoClip(){this.pendingClip=_}beginText(){this.current.textMatrix=r.IDENTITY_MATRIX,this.current.textMatrixScale=1,this.current.x=this.current.lineX=0,this.current.y=this.current.lineY=0}endText(){const e=this.pendingTextPaths,t=this.ctx;if(void 0!==e){t.save(),t.beginPath();for(let n=0;n<e.length;n++){const r=e[n];t.setTransform.apply(t,r.transform),t.translate(r.x,r.y),r.addToPath(t,r.fontSize)}t.restore(),t.clip(),t.beginPath(),delete this.pendingTextPaths}else t.beginPath()}setCharSpacing(e){this.current.charSpacing=e}setWordSpacing(e){this.current.wordSpacing=e}setHScale(e){this.current.textHScale=e/100}setLeading(e){this.current.leading=-e}setFont(e,t){const n=this.commonObjs.get(e),i=this.current;if(!n)throw new Error(`Can't find font for ${e}`);if(i.fontMatrix=n.fontMatrix||r.FONT_IDENTITY_MATRIX,0!==i.fontMatrix[0]&&0!==i.fontMatrix[3]||(0,r.warn)("Invalid font matrix for font "+e),t<0?(t=-t,i.fontDirection=-1):i.fontDirection=1,this.current.font=n,this.current.fontSize=t,n.isType3Font)return;const s=n.loadedName||"sans-serif";let o="normal";n.black?o="900":n.bold&&(o="bold");const a=n.italic?"italic":"normal",l=`"${s}", ${n.fallbackName}`;let c=t;t<16?c=16:t>100&&(c=100),this.current.fontSizeScale=t/c,this.ctx.font=`${a} ${o} ${c}px ${l}`}setTextRenderingMode(e){this.current.textRenderingMode=e}setTextRise(e){this.current.textRise=e}moveText(e,t){this.current.x=this.current.lineX+=e,this.current.y=this.current.lineY+=t}setLeadingMoveText(e,t){this.setLeading(-t),this.moveText(e,t)}setTextMatrix(e,t,n,r,i,s){this.current.textMatrix=[e,t,n,r,i,s],this.current.textMatrixScale=Math.hypot(e,t),this.current.x=this.current.lineX=0,this.current.y=this.current.lineY=0}nextLine(){this.moveText(0,this.current.leading)}paintChar(e,t,n,i,s){const o=this.ctx,a=this.current,l=a.font,c=a.textRenderingMode,d=a.fontSize/a.fontSizeScale,u=c&r.TextRenderingMode.FILL_STROKE_MASK,h=!!(c&r.TextRenderingMode.ADD_TO_PATH_FLAG),p=a.patternFill&&!l.missingFile;let m;(l.disableFontFace||h||p)&&(m=l.getPathGenerator(this.commonObjs,e)),l.disableFontFace||p?(o.save(),o.translate(t,n),o.beginPath(),m(o,d),i&&o.setTransform.apply(o,i),u!==r.TextRenderingMode.FILL&&u!==r.TextRenderingMode.FILL_STROKE||o.fill(),u!==r.TextRenderingMode.STROKE&&u!==r.TextRenderingMode.FILL_STROKE||(s&&(o.resetTransform(),o.lineWidth=Math.floor(this._combinedScaleFactor)),o.stroke()),o.restore()):(u!==r.TextRenderingMode.FILL&&u!==r.TextRenderingMode.FILL_STROKE||o.fillText(e,t,n),u!==r.TextRenderingMode.STROKE&&u!==r.TextRenderingMode.FILL_STROKE||(s?(o.save(),o.moveTo(t,n),o.resetTransform(),o.lineWidth=Math.floor(this._combinedScaleFactor),o.strokeText(e,0,0),o.restore()):o.strokeText(e,t,n))),h&&(this.pendingTextPaths||(this.pendingTextPaths=[])).push({transform:o.mozCurrentTransform,x:t,y:n,fontSize:d,addToPath:m})}get isFontSubpixelAAEnabled(){const{context:e}=this.cachedCanvases.getCanvas("isFontSubpixelAAEnabled",10,10);e.scale(1.5,1),e.fillText("I",0,10);const t=e.getImageData(0,0,10,10).data;let n=!1;for(let e=3;e<t.length;e+=4)if(t[e]>0&&t[e]<255){n=!0;break}return(0,r.shadow)(this,"isFontSubpixelAAEnabled",n)}showText(e){const t=this.current,n=t.font;if(n.isType3Font)return this.showType3Text(e);const s=t.fontSize;if(0===s)return;const o=this.ctx,a=t.fontSizeScale,l=t.charSpacing,c=t.wordSpacing,d=t.fontDirection,u=t.textHScale*d,h=e.length,p=n.vertical,m=p?1:-1,g=n.defaultVMetrics,f=s*t.fontMatrix[0],y=t.textRenderingMode===r.TextRenderingMode.FILL&&!n.disableFontFace&&!t.patternFill;let v;if(o.save(),o.transform.apply(o,t.textMatrix),o.translate(t.x,t.y+t.textRise),d>0?o.scale(u,-1):o.scale(u,1),t.patternFill){o.save();const e=t.fillColor.getPattern(o,this,o.mozCurrentTransformInverse,i.PathType.FILL);v=o.mozCurrentTransform,o.restore(),o.fillStyle=e}let b=t.lineWidth,w=!1;const S=t.textMatrixScale;if(0===S||0===b){const e=t.textRenderingMode&r.TextRenderingMode.FILL_STROKE_MASK;e!==r.TextRenderingMode.STROKE&&e!==r.TextRenderingMode.FILL_STROKE||(this._cachedGetSinglePixelWidth=null,b=this.getSinglePixelWidth(),w=b<0)}else b/=S;1!==a&&(o.scale(a,a),b/=a),o.lineWidth=b;let _,k=0;for(_=0;_<h;++_){const t=e[_];if("number"==typeof t){k+=m*t*s/1e3;continue}let r=!1;const i=(t.isSpace?c:0)+l,u=t.fontChar,h=t.accent;let b,S,x,E=t.width;if(p){const e=t.vmetric||g,n=-(t.vmetric?e[1]:.5*E)*f,r=e[2]*f;E=e?-e[0]:E,b=n/a,S=(k+r)/a}else b=k/a,S=0;if(n.remeasure&&E>0){const e=1e3*o.measureText(u).width/s*a;if(E<e&&this.isFontSubpixelAAEnabled){const t=E/e;r=!0,o.save(),o.scale(t,1),b/=t}else E!==e&&(b+=(E-e)/2e3*s/a)}if(this.contentVisible&&(t.isInFont||n.missingFile))if(y&&!h)o.fillText(u,b,S);else if(this.paintChar(u,b,S,v,w),h){const e=b+s*h.offset.x/a,t=S-s*h.offset.y/a;this.paintChar(h.fontChar,e,t,v,w)}x=p?E*f-i*d:E*f+i*d,k+=x,r&&o.restore()}p?t.y-=k:t.x+=k*u,o.restore(),this.compose()}showType3Text(e){const t=this.ctx,n=this.current,i=n.font,s=n.fontSize,o=n.fontDirection,a=i.vertical?1:-1,l=n.charSpacing,c=n.wordSpacing,d=n.textHScale*o,u=n.fontMatrix||r.FONT_IDENTITY_MATRIX,h=e.length;let p,m,g,f;if(n.textRenderingMode!==r.TextRenderingMode.INVISIBLE&&0!==s){for(this._cachedGetSinglePixelWidth=null,t.save(),t.transform.apply(t,n.textMatrix),t.translate(n.x,n.y),t.scale(d,o),p=0;p<h;++p){if(m=e[p],"number"==typeof m){f=a*m*s/1e3,this.ctx.translate(f,0),n.x+=f*d;continue}const o=(m.isSpace?c:0)+l,h=i.charProcOperatorList[m.operatorListId];h?(this.contentVisible&&(this.processingType3=m,this.save(),t.scale(s,s),t.transform.apply(t,u),this.executeOperatorList(h),this.restore()),g=r.Util.applyTransform([m.width,0],u)[0]*s+o,t.translate(g,0),n.x+=g*d):(0,r.warn)(`Type3 character "${m.operatorListId}" is not available.`)}t.restore(),this.processingType3=null}}setCharWidth(e,t){}setCharWidthAndBounds(e,t,n,r,i,s){this.ctx.rect(n,r,i-n,s-r),this.clip(),this.endPath()}getColorN_Pattern(e){let t;if("TilingPattern"===e[0]){const n=e[1],r=this.baseTransform||this.ctx.mozCurrentTransform.slice(),s={createCanvasGraphics:e=>new k(e,this.commonObjs,this.objs,this.canvasFactory)};t=new i.TilingPattern(e,n,this.ctx,s,r)}else t=this._getPattern(e[1],e[2]);return t}setStrokeColorN(){this.current.strokeColor=this.getColorN_Pattern(arguments)}setFillColorN(){this.current.fillColor=this.getColorN_Pattern(arguments),this.current.patternFill=!0}setStrokeRGBColor(e,t,n){const i=r.Util.makeHexColor(e,t,n);this.ctx.strokeStyle=i,this.current.strokeColor=i}setFillRGBColor(e,t,n){const i=r.Util.makeHexColor(e,t,n);this.ctx.fillStyle=i,this.current.fillColor=i,this.current.patternFill=!1}_getPattern(e,t=null){let n;return this.cachedPatterns.has(e)?n=this.cachedPatterns.get(e):(n=(0,i.getShadingPattern)(this.objs.get(e)),this.cachedPatterns.set(e,n)),t&&(n.matrix=t),n}shadingFill(e){if(!this.contentVisible)return;const t=this.ctx;this.save();const n=this._getPattern(e);t.fillStyle=n.getPattern(t,this,t.mozCurrentTransformInverse,i.PathType.SHADING);const s=t.mozCurrentTransformInverse;if(s){const e=t.canvas,n=e.width,i=e.height,o=r.Util.applyTransform([0,0],s),a=r.Util.applyTransform([0,i],s),l=r.Util.applyTransform([n,0],s),c=r.Util.applyTransform([n,i],s),d=Math.min(o[0],a[0],l[0],c[0]),u=Math.min(o[1],a[1],l[1],c[1]),h=Math.max(o[0],a[0],l[0],c[0]),p=Math.max(o[1],a[1],l[1],c[1]);this.ctx.fillRect(d,u,h-d,p-u)}else this.ctx.fillRect(-1e10,-1e10,2e10,2e10);this.compose(this.current.getClippedPathBoundingBox()),this.restore()}beginInlineImage(){(0,r.unreachable)("Should not call beginInlineImage")}beginImageData(){(0,r.unreachable)("Should not call beginImageData")}paintFormXObjectBegin(e,t){if(this.contentVisible&&(this.save(),this.baseTransformStack.push(this.baseTransform),Array.isArray(e)&&6===e.length&&this.transform.apply(this,e),this.baseTransform=this.ctx.mozCurrentTransform,t)){const e=t[2]-t[0],n=t[3]-t[1];this.ctx.rect(t[0],t[1],e,n),this.current.updatePathMinMax(this.ctx.mozCurrentTransform,t[0],t[1]),this.current.updatePathMinMax(this.ctx.mozCurrentTransform,t[2],t[3]),this.clip(),this.endPath()}}paintFormXObjectEnd(){this.contentVisible&&(this.restore(),this.baseTransform=this.baseTransformStack.pop())}beginGroup(e){if(!this.contentVisible)return;this.save(),this.inSMaskMode&&(this.endSMaskMode(),this.current.activeSMask=null);const t=this.ctx;e.isolated||(0,r.info)("TODO: Support non-isolated groups."),e.knockout&&(0,r.warn)("Knockout groups not supported.");const n=t.mozCurrentTransform;if(e.matrix&&t.transform.apply(t,e.matrix),!e.bbox)throw new Error("Bounding box is required.");let i=r.Util.getAxialAlignedBoundingBox(e.bbox,t.mozCurrentTransform);const s=[0,0,t.canvas.width,t.canvas.height];i=r.Util.intersect(i,s)||[0,0,0,0];const a=Math.floor(i[0]),l=Math.floor(i[1]);let c=Math.max(Math.ceil(i[2])-a,1),d=Math.max(Math.ceil(i[3])-l,1),u=1,h=1;c>o&&(u=c/o,c=o),d>o&&(h=d/o,d=o),this.current.startNewPathAndClipBox([0,0,c,d]);let m="groupAt"+this.groupLevel;e.smask&&(m+="_smask_"+this.smaskCounter++%2);const g=this.cachedCanvases.getCanvas(m,c,d,!0),f=g.context;f.scale(1/u,1/h),f.translate(-a,-l),f.transform.apply(f,n),e.smask?this.smaskStack.push({canvas:g.canvas,context:f,offsetX:a,offsetY:l,scaleX:u,scaleY:h,subtype:e.smask.subtype,backdrop:e.smask.backdrop,transferMap:e.smask.transferMap||null,startTransformInverse:null}):(t.setTransform(1,0,0,1,0,0),t.translate(a,l),t.scale(u,h),t.save()),p(t,f),this.ctx=f,this.setGState([["BM","source-over"],["ca",1],["CA",1]]),this.groupStack.push(t),this.groupLevel++}endGroup(e){if(!this.contentVisible)return;this.groupLevel--;const t=this.ctx,n=this.groupStack.pop();if(this.ctx=n,this.ctx.imageSmoothingEnabled=!1,e.smask)this.tempSMask=this.smaskStack.pop(),this.restore();else{this.ctx.restore();const e=this.ctx.mozCurrentTransform;this.restore(),this.ctx.save(),this.ctx.setTransform.apply(this.ctx,e);const n=r.Util.getAxialAlignedBoundingBox([0,0,t.canvas.width,t.canvas.height],e);this.ctx.drawImage(t.canvas,0,0),this.ctx.restore(),this.compose(n)}}beginAnnotations(){this.save(),this.baseTransform&&this.ctx.setTransform.apply(this.ctx,this.baseTransform)}endAnnotations(){this.restore()}beginAnnotation(e,t,n,i,s){if(this.save(),Array.isArray(t)&&4===t.length){const i=t[2]-t[0],o=t[3]-t[1];if(s&&this.annotationCanvasMap){(n=n.slice())[4]-=t[0],n[5]-=t[1],(t=t.slice())[0]=t[1]=0,t[2]=i,t[3]=o;const[s,a]=r.Util.singularValueDecompose2dScale(this.ctx.mozCurrentTransform),{viewportScale:c}=this,d=Math.ceil(i*this.outputScaleX*c),u=Math.ceil(o*this.outputScaleY*c);this.annotationCanvas=this.canvasFactory.create(d,u);const{canvas:h,context:p}=this.annotationCanvas;h.style.width=`calc(${i}px * var(--viewport-scale-factor))`,h.style.height=`calc(${o}px * var(--viewport-scale-factor))`,this.annotationCanvasMap.set(e,h),this.annotationCanvas.savedCtx=this.ctx,this.ctx=p,this.ctx.setTransform(s,0,0,-a,0,o*a),l(this.ctx),m(this.ctx)}else m(this.ctx),this.ctx.rect(t[0],t[1],i,o),this.clip(),this.endPath()}this.current=new d(this.ctx.canvas.width,this.ctx.canvas.height),this.transform.apply(this,n),this.transform.apply(this,i)}endAnnotation(){this.annotationCanvas&&(this.ctx=this.annotationCanvas.savedCtx,delete this.annotationCanvas.savedCtx,delete this.annotationCanvas),this.restore()}paintImageMaskXObject(e){if(!this.contentVisible)return;const t=this.ctx,n=e.width,r=e.height,i=this.processingType3;if(i&&void 0===i.compiled&&(i.compiled=n<=1e3&&r<=1e3?function(e){const t=new Uint8Array([0,2,4,0,1,0,5,4,8,10,0,8,0,2,1,0]),n=e.width,r=e.height,i=n+1;let s,o,a,l;const c=new Uint8Array(i*(r+1)),d=n+7&-8,u=e.data,h=new Uint8Array(d*r);let p=0;for(s=0,o=u.length;s<o;s++){const e=u[s];let t=128;for(;t>0;)h[p++]=e&t?0:255,t>>=1}let m=0;for(p=0,0!==h[p]&&(c[0]=1,++m),a=1;a<n;a++)h[p]!==h[p+1]&&(c[a]=h[p]?2:1,++m),p++;for(0!==h[p]&&(c[a]=2,++m),s=1;s<r;s++){p=s*d,l=s*i,h[p-d]!==h[p]&&(c[l]=h[p]?1:8,++m);let e=(h[p]?4:0)+(h[p-d]?8:0);for(a=1;a<n;a++)e=(e>>2)+(h[p+1]?4:0)+(h[p-d+1]?8:0),t[e]&&(c[l+a]=t[e],++m),p++;if(h[p-d]!==h[p]&&(c[l+a]=h[p]?2:4,++m),m>1e3)return null}for(p=d*(r-1),l=s*i,0!==h[p]&&(c[l]=8,++m),a=1;a<n;a++)h[p]!==h[p+1]&&(c[l+a]=h[p]?4:8,++m),p++;if(0!==h[p]&&(c[l+a]=4,++m),m>1e3)return null;const g=new Int32Array([0,i,-1,0,-i,0,0,0,1]),f=[];for(s=0;m&&s<=r;s++){let e=s*i;const t=e+n;for(;e<t&&!c[e];)e++;if(e===t)continue;const r=[e%i,s],o=e;let a=c[e];do{const t=g[a];do{e+=t}while(!c[e]);const n=c[e];5!==n&&10!==n?(a=n,c[e]=0):(a=n&51*a>>4,c[e]&=a>>2|a<<2),r.push(e%i,e/i|0),c[e]||--m}while(o!==e);f.push(r),--s}return function(e){e.save(),e.scale(1/n,-1/r),e.translate(0,-r),e.beginPath();for(let t=0,n=f.length;t<n;t++){const n=f[t];e.moveTo(n[0],n[1]);for(let t=2,r=n.length;t<r;t+=2)e.lineTo(n[t],n[t+1])}e.fill(),e.beginPath(),e.restore()}}({data:e.data,width:n,height:r}):null),i?.compiled)return void i.compiled(t);const s=this._createMaskCanvas(e),o=s.canvas;t.save(),t.setTransform(1,0,0,1,0,0),t.drawImage(o,s.offsetX,s.offsetY),t.restore(),this.compose()}paintImageMaskXObjectRepeat(e,t,n=0,i=0,s,o){if(!this.contentVisible)return;const a=this.ctx;a.save();const l=a.mozCurrentTransform;a.transform(t,n,i,s,0,0);const c=this._createMaskCanvas(e);a.setTransform(1,0,0,1,0,0);for(let e=0,d=o.length;e<d;e+=2){const d=r.Util.transform(l,[t,n,i,s,o[e],o[e+1]]),[u,h]=r.Util.applyTransform([0,0],d);a.drawImage(c.canvas,u,h)}a.restore(),this.compose()}paintImageMaskXObjectGroup(e){if(!this.contentVisible)return;const t=this.ctx,n=this.current.fillColor,r=this.current.patternFill;for(let s=0,o=e.length;s<o;s++){const o=e[s],a=o.width,l=o.height,c=this.cachedCanvases.getCanvas("maskCanvas",a,l),d=c.context;d.save(),h(d,o),d.globalCompositeOperation="source-in",d.fillStyle=r?n.getPattern(d,this,t.mozCurrentTransformInverse,i.PathType.FILL):n,d.fillRect(0,0,a,l),d.restore(),t.save(),t.transform.apply(t,o.transform),t.scale(1,-1),t.drawImage(c.canvas,0,0,a,l,0,-1,1,1),t.restore()}this.compose()}paintImageXObject(e){if(!this.contentVisible)return;const t=e.startsWith("g_")?this.commonObjs.get(e):this.objs.get(e);t?this.paintInlineImageXObject(t):(0,r.warn)("Dependent image isn't ready yet")}paintImageXObjectRepeat(e,t,n,i){if(!this.contentVisible)return;const s=e.startsWith("g_")?this.commonObjs.get(e):this.objs.get(e);if(!s)return void(0,r.warn)("Dependent image isn't ready yet");const o=s.width,a=s.height,l=[];for(let e=0,r=i.length;e<r;e+=2)l.push({transform:[t,0,0,n,i[e],i[e+1]],x:0,y:0,w:o,h:a});this.paintInlineImageXObjectGroup(s,l)}paintInlineImageXObject(e){if(!this.contentVisible)return;const t=e.width,n=e.height,r=this.ctx;let i;if(this.save(),r.scale(1/t,-1/n),"function"==typeof HTMLElement&&e instanceof HTMLElement||!e.data)i=e;else{const r=this.cachedCanvases.getCanvas("inlineImage",t,n);u(r.context,e,this.current.transferMaps),i=r.canvas}const s=this._scaleImage(i,r.mozCurrentTransformInverse);if(r.imageSmoothingEnabled=v(r.mozCurrentTransform,e.interpolate),r.drawImage(s.img,0,0,s.paintWidth,s.paintHeight,0,-n,t,n),this.imageLayer){const i=this.getCanvasPosition(0,-n);this.imageLayer.appendImage({imgData:e,left:i[0],top:i[1],width:t/r.mozCurrentTransformInverse[0],height:n/r.mozCurrentTransformInverse[3]})}this.compose(),this.restore()}paintInlineImageXObjectGroup(e,t){if(!this.contentVisible)return;const n=this.ctx,r=e.width,i=e.height,s=this.cachedCanvases.getCanvas("inlineImage",r,i);u(s.context,e,this.current.transferMaps);for(let o=0,a=t.length;o<a;o++){const a=t[o];if(n.save(),n.transform.apply(n,a.transform),n.scale(1,-1),n.drawImage(s.canvas,a.x,a.y,a.w,a.h,0,-1,1,1),this.imageLayer){const t=this.getCanvasPosition(a.x,a.y);this.imageLayer.appendImage({imgData:e,left:t[0],top:t[1],width:r,height:i})}n.restore()}this.compose()}paintSolidColorImageMask(){this.contentVisible&&(this.ctx.fillRect(0,0,1,1),this.compose())}markPoint(e){}markPointProps(e,t){}beginMarkedContent(e){this.markedContentStack.push({visible:!0})}beginMarkedContentProps(e,t){"OC"===e?this.markedContentStack.push({visible:this.optionalContentConfig.isVisible(t)}):this.markedContentStack.push({visible:!0}),this.contentVisible=this.isContentVisible()}endMarkedContent(){this.markedContentStack.pop(),this.contentVisible=this.isContentVisible()}beginCompat(){}endCompat(){}consumePath(e){this.pendingClip&&this.current.updateClipFromPath(),this.pendingClip||this.compose(e);const t=this.ctx;this.pendingClip&&(this.pendingClip===_?t.clip("evenodd"):t.clip(),this.pendingClip=null),this.current.startNewPathAndClipBox(this.current.clipBox),t.beginPath()}getSinglePixelWidth(){if(null===this._cachedGetSinglePixelWidth){const e=this.ctx.mozCurrentTransform,t=Math.abs(e[0]*e[3]-e[2]*e[1]),n=e[0]**2+e[2]**2,r=e[1]**2+e[3]**2,i=Math.sqrt(Math.max(n,r))/t;n!==r&&this._combinedScaleFactor*i>1?this._cachedGetSinglePixelWidth=-this._combinedScaleFactor*i:t>Number.EPSILON?this._cachedGetSinglePixelWidth=i:this._cachedGetSinglePixelWidth=1}return this._cachedGetSinglePixelWidth}getCanvasPosition(e,t){const n=this.ctx.mozCurrentTransform;return[n[0]*e+n[2]*t+n[4],n[1]*e+n[3]*t+n[5]]}isContentVisible(){for(let e=this.markedContentStack.length-1;e>=0;e--)if(!this.markedContentStack[e].visible)return!1;return!0}}t.CanvasGraphics=k;for(const e in r.OPS)void 0!==k.prototype[e]&&(k.prototype[r.OPS[e]]=k.prototype[e])},(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.TilingPattern=t.PathType=void 0,t.getShadingPattern=function(e){switch(e[0]){case"RadialAxial":return new a(e);case"Mesh":return new d(e);case"Dummy":return new u}throw new Error(`Unknown IR type: ${e[0]}`)};var r=n(1);const i={FILL:"Fill",STROKE:"Stroke",SHADING:"Shading"};function s(e,t){if(!t||"undefined"==typeof Path2D)return;const n=t[2]-t[0],r=t[3]-t[1],i=new Path2D;i.rect(t[0],t[1],n,r),e.clip(i)}t.PathType=i;class o{constructor(){this.constructor===o&&(0,r.unreachable)("Cannot initialize BaseShadingPattern.")}getPattern(){(0,r.unreachable)("Abstract method `getPattern` called.")}}class a extends o{constructor(e){super(),this._type=e[1],this._bbox=e[2],this._colorStops=e[3],this._p0=e[4],this._p1=e[5],this._r0=e[6],this._r1=e[7],this.matrix=null}_createGradient(e){let t;"axial"===this._type?t=e.createLinearGradient(this._p0[0],this._p0[1],this._p1[0],this._p1[1]):"radial"===this._type&&(t=e.createRadialGradient(this._p0[0],this._p0[1],this._r0,this._p1[0],this._p1[1],this._r1));for(const e of this._colorStops)t.addColorStop(e[0],e[1]);return t}getPattern(e,t,n,o){let a;if(o===i.STROKE||o===i.FILL){const i=t.current.getClippedPathBoundingBox(o,e.mozCurrentTransform)||[0,0,0,0],l=Math.ceil(i[2]-i[0])||1,c=Math.ceil(i[3]-i[1])||1,d=t.cachedCanvases.getCanvas("pattern",l,c,!0),u=d.context;u.clearRect(0,0,u.canvas.width,u.canvas.height),u.beginPath(),u.rect(0,0,u.canvas.width,u.canvas.height),u.translate(-i[0],-i[1]),n=r.Util.transform(n,[1,0,0,1,i[0],i[1]]),u.transform.apply(u,t.baseTransform),this.matrix&&u.transform.apply(u,this.matrix),s(u,this._bbox),u.fillStyle=this._createGradient(u),u.fill(),a=e.createPattern(d.canvas,"no-repeat");const h=new DOMMatrix(n);try{a.setTransform(h)}catch(e){(0,r.warn)(`RadialAxialShadingPattern.getPattern: "${e?.message}".`)}}else s(e,this._bbox),a=this._createGradient(e);return a}}function l(e,t,n,r,i,s,o,a){const l=t.coords,c=t.colors,d=e.data,u=4*e.width;let h;l[n+1]>l[r+1]&&(h=n,n=r,r=h,h=s,s=o,o=h),l[r+1]>l[i+1]&&(h=r,r=i,i=h,h=o,o=a,a=h),l[n+1]>l[r+1]&&(h=n,n=r,r=h,h=s,s=o,o=h);const p=(l[n]+t.offsetX)*t.scaleX,m=(l[n+1]+t.offsetY)*t.scaleY,g=(l[r]+t.offsetX)*t.scaleX,f=(l[r+1]+t.offsetY)*t.scaleY,y=(l[i]+t.offsetX)*t.scaleX,v=(l[i+1]+t.offsetY)*t.scaleY;if(m>=v)return;const b=c[s],w=c[s+1],S=c[s+2],_=c[o],k=c[o+1],x=c[o+2],E=c[a],T=c[a+1],C=c[a+2],A=Math.round(m),I=Math.round(v);let R,O,P,M,D,L,F,N;for(let e=A;e<=I;e++){if(e<f){let t;t=e<m?0:(m-e)/(m-f),R=p-(p-g)*t,O=b-(b-_)*t,P=w-(w-k)*t,M=S-(S-x)*t}else{let t;t=e>v?1:f===v?0:(f-e)/(f-v),R=g-(g-y)*t,O=_-(_-E)*t,P=k-(k-T)*t,M=x-(x-C)*t}let t;t=e<m?0:e>v?1:(m-e)/(m-v),D=p-(p-y)*t,L=b-(b-E)*t,F=w-(w-T)*t,N=S-(S-C)*t;const n=Math.round(Math.min(R,D)),r=Math.round(Math.max(R,D));let i=u*e+4*n;for(let e=n;e<=r;e++)t=(R-e)/(R-D),t<0?t=0:t>1&&(t=1),d[i++]=O-(O-L)*t|0,d[i++]=P-(P-F)*t|0,d[i++]=M-(M-N)*t|0,d[i++]=255}}function c(e,t,n){const r=t.coords,i=t.colors;let s,o;switch(t.type){case"lattice":const a=t.verticesPerRow,c=Math.floor(r.length/a)-1,d=a-1;for(s=0;s<c;s++){let t=s*a;for(let s=0;s<d;s++,t++)l(e,n,r[t],r[t+1],r[t+a],i[t],i[t+1],i[t+a]),l(e,n,r[t+a+1],r[t+1],r[t+a],i[t+a+1],i[t+1],i[t+a])}break;case"triangles":for(s=0,o=r.length;s<o;s+=3)l(e,n,r[s],r[s+1],r[s+2],i[s],i[s+1],i[s+2]);break;default:throw new Error("illegal figure")}}class d extends o{constructor(e){super(),this._coords=e[2],this._colors=e[3],this._figures=e[4],this._bounds=e[5],this._bbox=e[7],this._background=e[8],this.matrix=null}_createMeshCanvas(e,t,n){const r=Math.floor(this._bounds[0]),i=Math.floor(this._bounds[1]),s=Math.ceil(this._bounds[2])-r,o=Math.ceil(this._bounds[3])-i,a=Math.min(Math.ceil(Math.abs(s*e[0]*1.1)),3e3),l=Math.min(Math.ceil(Math.abs(o*e[1]*1.1)),3e3),d=s/a,u=o/l,h={coords:this._coords,colors:this._colors,offsetX:-r,offsetY:-i,scaleX:1/d,scaleY:1/u},p=a+4,m=l+4,g=n.getCanvas("mesh",p,m,!1),f=g.context,y=f.createImageData(a,l);if(t){const e=y.data;for(let n=0,r=e.length;n<r;n+=4)e[n]=t[0],e[n+1]=t[1],e[n+2]=t[2],e[n+3]=255}for(const e of this._figures)c(y,e,h);return f.putImageData(y,2,2),{canvas:g.canvas,offsetX:r-2*d,offsetY:i-2*u,scaleX:d,scaleY:u}}getPattern(e,t,n,o){let a;if(s(e,this._bbox),o===i.SHADING)a=r.Util.singularValueDecompose2dScale(e.mozCurrentTransform);else if(a=r.Util.singularValueDecompose2dScale(t.baseTransform),this.matrix){const e=r.Util.singularValueDecompose2dScale(this.matrix);a=[a[0]*e[0],a[1]*e[1]]}const l=this._createMeshCanvas(a,o===i.SHADING?null:this._background,t.cachedCanvases);return o!==i.SHADING&&(e.setTransform.apply(e,t.baseTransform),this.matrix&&e.transform.apply(e,this.matrix)),e.translate(l.offsetX,l.offsetY),e.scale(l.scaleX,l.scaleY),e.createPattern(l.canvas,"no-repeat")}}class u extends o{getPattern(){return"hotpink"}}class h{static get MAX_PATTERN_SIZE(){return(0,r.shadow)(this,"MAX_PATTERN_SIZE",3e3)}constructor(e,t,n,r,i){this.operatorList=e[2],this.matrix=e[3]||[1,0,0,1,0,0],this.bbox=e[4],this.xstep=e[5],this.ystep=e[6],this.paintType=e[7],this.tilingType=e[8],this.color=t,this.ctx=n,this.canvasGraphicsFactory=r,this.baseTransform=i}createPatternCanvas(e){const t=this.operatorList,n=this.bbox,i=this.xstep,s=this.ystep,o=this.paintType,a=this.tilingType,l=this.color,c=this.canvasGraphicsFactory;(0,r.info)("TilingType: "+a);const d=n[0],u=n[1],h=n[2],p=n[3],m=r.Util.singularValueDecompose2dScale(this.matrix),g=r.Util.singularValueDecompose2dScale(this.baseTransform),f=[m[0]*g[0],m[1]*g[1]],y=this.getSizeAndScale(i,this.ctx.canvas.width,f[0]),v=this.getSizeAndScale(s,this.ctx.canvas.height,f[1]),b=e.cachedCanvases.getCanvas("pattern",y.size,v.size,!0),w=b.context,S=c.createCanvasGraphics(w);S.groupLevel=e.groupLevel,this.setFillAndStrokeStyleToContext(S,o,l);let _=d,k=u,x=h,E=p;return d<0&&(_=0,x+=Math.abs(d)),u<0&&(k=0,E+=Math.abs(u)),w.translate(-y.scale*_,-v.scale*k),S.transform(y.scale,0,0,v.scale,0,0),w.save(),this.clipBbox(S,_,k,x,E),S.baseTransform=S.ctx.mozCurrentTransform.slice(),S.executeOperatorList(t),S.endDrawing(),{canvas:b.canvas,scaleX:y.scale,scaleY:v.scale,offsetX:_,offsetY:k}}getSizeAndScale(e,t,n){e=Math.abs(e);const r=Math.max(h.MAX_PATTERN_SIZE,t);let i=Math.ceil(e*n);return i>=r?i=r:n=i/e,{scale:n,size:i}}clipBbox(e,t,n,r,i){const s=r-t,o=i-n;e.ctx.rect(t,n,s,o),e.clip(),e.endPath()}setFillAndStrokeStyleToContext(e,t,n){const i=e.ctx,s=e.current;switch(t){case 1:const e=this.ctx;i.fillStyle=e.fillStyle,i.strokeStyle=e.strokeStyle,s.fillColor=e.fillStyle,s.strokeColor=e.strokeStyle;break;case 2:const o=r.Util.makeHexColor(n[0],n[1],n[2]);i.fillStyle=o,i.strokeStyle=o,s.fillColor=o,s.strokeColor=o;break;default:throw new r.FormatError(`Unsupported paint type: ${t}`)}}getPattern(e,t,n,s){let o=n;s!==i.SHADING&&(o=r.Util.transform(o,t.baseTransform),this.matrix&&(o=r.Util.transform(o,this.matrix)));const a=this.createPatternCanvas(t);let l=new DOMMatrix(o);l=l.translate(a.offsetX,a.offsetY),l=l.scale(1/a.scaleX,1/a.scaleY);const c=e.createPattern(a.canvas,"repeat");try{c.setTransform(l)}catch(e){(0,r.warn)(`TilingPattern.getPattern: "${e?.message}".`)}return c}}t.TilingPattern=h},(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.GlobalWorkerOptions=void 0;const n=Object.create(null);t.GlobalWorkerOptions=n,n.workerPort=void 0===n.workerPort?null:n.workerPort,n.workerSrc=void 0===n.workerSrc?"":n.workerSrc},(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.MessageHandler=void 0;var r=n(1);function i(e){switch(e instanceof Error||"object"==typeof e&&null!==e||(0,r.unreachable)('wrapReason: Expected "reason" to be a (possibly cloned) Error.'),e.name){case"AbortException":return new r.AbortException(e.message);case"MissingPDFException":return new r.MissingPDFException(e.message);case"PasswordException":return new r.PasswordException(e.message,e.code);case"UnexpectedResponseException":return new r.UnexpectedResponseException(e.message,e.status);case"UnknownErrorException":return new r.UnknownErrorException(e.message,e.details);default:return new r.UnknownErrorException(e.message,e.toString())}}t.MessageHandler=class{constructor(e,t,n){this.sourceName=e,this.targetName=t,this.comObj=n,this.callbackId=1,this.streamId=1,this.streamSinks=Object.create(null),this.streamControllers=Object.create(null),this.callbackCapabilities=Object.create(null),this.actionHandler=Object.create(null),this._onComObjOnMessage=e=>{const t=e.data;if(t.targetName!==this.sourceName)return;if(t.stream)return void this._processStreamMessage(t);if(t.callback){const e=t.callbackId,n=this.callbackCapabilities[e];if(!n)throw new Error(`Cannot resolve callback ${e}`);if(delete this.callbackCapabilities[e],1===t.callback)n.resolve(t.data);else{if(2!==t.callback)throw new Error("Unexpected callback case");n.reject(i(t.reason))}return}const r=this.actionHandler[t.action];if(!r)throw new Error(`Unknown action from worker: ${t.action}`);if(t.callbackId){const e=this.sourceName,s=t.sourceName;new Promise((function(e){e(r(t.data))})).then((function(r){n.postMessage({sourceName:e,targetName:s,callback:1,callbackId:t.callbackId,data:r})}),(function(r){n.postMessage({sourceName:e,targetName:s,callback:2,callbackId:t.callbackId,reason:i(r)})}))}else t.streamId?this._createStreamSink(t):r(t.data)},n.addEventListener("message",this._onComObjOnMessage)}on(e,t){const n=this.actionHandler;if(n[e])throw new Error(`There is already an actionName called "${e}"`);n[e]=t}send(e,t,n){this.comObj.postMessage({sourceName:this.sourceName,targetName:this.targetName,action:e,data:t},n)}sendWithPromise(e,t,n){const i=this.callbackId++,s=(0,r.createPromiseCapability)();this.callbackCapabilities[i]=s;try{this.comObj.postMessage({sourceName:this.sourceName,targetName:this.targetName,action:e,callbackId:i,data:t},n)}catch(e){s.reject(e)}return s.promise}sendWithStream(e,t,n,s){const o=this.streamId++,a=this.sourceName,l=this.targetName,c=this.comObj;return new ReadableStream({start:n=>{const i=(0,r.createPromiseCapability)();return this.streamControllers[o]={controller:n,startCall:i,pullCall:null,cancelCall:null,isClosed:!1},c.postMessage({sourceName:a,targetName:l,action:e,streamId:o,data:t,desiredSize:n.desiredSize},s),i.promise},pull:e=>{const t=(0,r.createPromiseCapability)();return this.streamControllers[o].pullCall=t,c.postMessage({sourceName:a,targetName:l,stream:6,streamId:o,desiredSize:e.desiredSize}),t.promise},cancel:e=>{(0,r.assert)(e instanceof Error,"cancel must have a valid reason");const t=(0,r.createPromiseCapability)();return this.streamControllers[o].cancelCall=t,this.streamControllers[o].isClosed=!0,c.postMessage({sourceName:a,targetName:l,stream:1,streamId:o,reason:i(e)}),t.promise}},n)}_createStreamSink(e){const t=e.streamId,n=this.sourceName,s=e.sourceName,o=this.comObj,a=this,l=this.actionHandler[e.action],c={enqueue(e,i=1,a){if(this.isCancelled)return;const l=this.desiredSize;this.desiredSize-=i,l>0&&this.desiredSize<=0&&(this.sinkCapability=(0,r.createPromiseCapability)(),this.ready=this.sinkCapability.promise),o.postMessage({sourceName:n,targetName:s,stream:4,streamId:t,chunk:e},a)},close(){this.isCancelled||(this.isCancelled=!0,o.postMessage({sourceName:n,targetName:s,stream:3,streamId:t}),delete a.streamSinks[t])},error(e){(0,r.assert)(e instanceof Error,"error must have a valid reason"),this.isCancelled||(this.isCancelled=!0,o.postMessage({sourceName:n,targetName:s,stream:5,streamId:t,reason:i(e)}))},sinkCapability:(0,r.createPromiseCapability)(),onPull:null,onCancel:null,isCancelled:!1,desiredSize:e.desiredSize,ready:null};c.sinkCapability.resolve(),c.ready=c.sinkCapability.promise,this.streamSinks[t]=c,new Promise((function(t){t(l(e.data,c))})).then((function(){o.postMessage({sourceName:n,targetName:s,stream:8,streamId:t,success:!0})}),(function(e){o.postMessage({sourceName:n,targetName:s,stream:8,streamId:t,reason:i(e)})}))}_processStreamMessage(e){const t=e.streamId,n=this.sourceName,s=e.sourceName,o=this.comObj,a=this.streamControllers[t],l=this.streamSinks[t];switch(e.stream){case 8:e.success?a.startCall.resolve():a.startCall.reject(i(e.reason));break;case 7:e.success?a.pullCall.resolve():a.pullCall.reject(i(e.reason));break;case 6:if(!l){o.postMessage({sourceName:n,targetName:s,stream:7,streamId:t,success:!0});break}l.desiredSize<=0&&e.desiredSize>0&&l.sinkCapability.resolve(),l.desiredSize=e.desiredSize,new Promise((function(e){e(l.onPull&&l.onPull())})).then((function(){o.postMessage({sourceName:n,targetName:s,stream:7,streamId:t,success:!0})}),(function(e){o.postMessage({sourceName:n,targetName:s,stream:7,streamId:t,reason:i(e)})}));break;case 4:if((0,r.assert)(a,"enqueue should have stream controller"),a.isClosed)break;a.controller.enqueue(e.chunk);break;case 3:if((0,r.assert)(a,"close should have stream controller"),a.isClosed)break;a.isClosed=!0,a.controller.close(),this._deleteStreamController(a,t);break;case 5:(0,r.assert)(a,"error should have stream controller"),a.controller.error(i(e.reason)),this._deleteStreamController(a,t);break;case 2:e.success?a.cancelCall.resolve():a.cancelCall.reject(i(e.reason)),this._deleteStreamController(a,t);break;case 1:if(!l)break;new Promise((function(t){t(l.onCancel&&l.onCancel(i(e.reason)))})).then((function(){o.postMessage({sourceName:n,targetName:s,stream:2,streamId:t,success:!0})}),(function(e){o.postMessage({sourceName:n,targetName:s,stream:2,streamId:t,reason:i(e)})})),l.sinkCapability.reject(i(e.reason)),l.isCancelled=!0,delete this.streamSinks[t];break;default:throw new Error("Unexpected stream case")}}async _deleteStreamController(e,t){await Promise.allSettled([e.startCall&&e.startCall.promise,e.pullCall&&e.pullCall.promise,e.cancelCall&&e.cancelCall.promise]),delete this.streamControllers[t]}destroy(){this.comObj.removeEventListener("message",this._onComObjOnMessage)}}},(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Metadata=void 0;var r=n(1);t.Metadata=class{#o;#a;constructor({parsedData:e,rawData:t}){this.#o=e,this.#a=t}getRaw(){return this.#a}get(e){return this.#o.get(e)??null}getAll(){return(0,r.objectFromMap)(this.#o)}has(e){return this.#o.has(e)}}},(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.OptionalContentConfig=void 0;var r=n(1);class i{constructor(e,t){this.visible=!0,this.name=e,this.intent=t}}t.OptionalContentConfig=class{constructor(e){if(this.name=null,this.creator=null,this._order=null,this._groups=new Map,null!==e){this.name=e.name,this.creator=e.creator,this._order=e.order;for(const t of e.groups)this._groups.set(t.id,new i(t.name,t.intent));if("OFF"===e.baseState)for(const e of this._groups)e.visible=!1;for(const t of e.on)this._groups.get(t).visible=!0;for(const t of e.off)this._groups.get(t).visible=!1}}_evaluateVisibilityExpression(e){const t=e.length;if(t<2)return!0;const n=e[0];for(let i=1;i<t;i++){const t=e[i];let s;if(Array.isArray(t))s=this._evaluateVisibilityExpression(t);else{if(!this._groups.has(t))return(0,r.warn)(`Optional content group not found: ${t}`),!0;s=this._groups.get(t).visible}switch(n){case"And":if(!s)return!1;break;case"Or":if(s)return!0;break;case"Not":return!s;default:return!0}}return"And"===n}isVisible(e){if(0===this._groups.size)return!0;if(!e)return(0,r.warn)("Optional content group not defined."),!0;if("OCG"===e.type)return this._groups.has(e.id)?this._groups.get(e.id).visible:((0,r.warn)(`Optional content group not found: ${e.id}`),!0);if("OCMD"===e.type){if(e.expression)return this._evaluateVisibilityExpression(e.expression);if(!e.policy||"AnyOn"===e.policy){for(const t of e.ids){if(!this._groups.has(t))return(0,r.warn)(`Optional content group not found: ${t}`),!0;if(this._groups.get(t).visible)return!0}return!1}if("AllOn"===e.policy){for(const t of e.ids){if(!this._groups.has(t))return(0,r.warn)(`Optional content group not found: ${t}`),!0;if(!this._groups.get(t).visible)return!1}return!0}if("AnyOff"===e.policy){for(const t of e.ids){if(!this._groups.has(t))return(0,r.warn)(`Optional content group not found: ${t}`),!0;if(!this._groups.get(t).visible)return!0}return!1}if("AllOff"===e.policy){for(const t of e.ids){if(!this._groups.has(t))return(0,r.warn)(`Optional content group not found: ${t}`),!0;if(this._groups.get(t).visible)return!1}return!0}return(0,r.warn)(`Unknown optional content policy ${e.policy}.`),!0}return(0,r.warn)(`Unknown group type ${e.type}.`),!0}setVisibility(e,t=!0){this._groups.has(e)?this._groups.get(e).visible=!!t:(0,r.warn)(`Optional content group not found: ${e}`)}getOrder(){return this._groups.size?this._order?this._order.slice():Array.from(this._groups.keys()):null}getGroups(){return this._groups.size>0?(0,r.objectFromMap)(this._groups):null}getGroup(e){return this._groups.get(e)||null}}},(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.PDFDataTransportStream=void 0;var r=n(1),i=n(5);t.PDFDataTransportStream=class{constructor(e,t){(0,r.assert)(t,'PDFDataTransportStream - missing required "pdfDataRangeTransport" argument.'),this._queuedChunks=[],this._progressiveDone=e.progressiveDone||!1,this._contentDispositionFilename=e.contentDispositionFilename||null;const n=e.initialData;if(n?.length>0){const e=new Uint8Array(n).buffer;this._queuedChunks.push(e)}this._pdfDataRangeTransport=t,this._isStreamingSupported=!e.disableStream,this._isRangeSupported=!e.disableRange,this._contentLength=e.length,this._fullRequestReader=null,this._rangeReaders=[],this._pdfDataRangeTransport.addRangeListener(((e,t)=>{this._onReceiveData({begin:e,chunk:t})})),this._pdfDataRangeTransport.addProgressListener(((e,t)=>{this._onProgress({loaded:e,total:t})})),this._pdfDataRangeTransport.addProgressiveReadListener((e=>{this._onReceiveData({chunk:e})})),this._pdfDataRangeTransport.addProgressiveDoneListener((()=>{this._onProgressiveDone()})),this._pdfDataRangeTransport.transportReady()}_onReceiveData(e){const t=new Uint8Array(e.chunk).buffer;if(void 0===e.begin)this._fullRequestReader?this._fullRequestReader._enqueue(t):this._queuedChunks.push(t);else{const n=this._rangeReaders.some((function(n){return n._begin===e.begin&&(n._enqueue(t),!0)}));(0,r.assert)(n,"_onReceiveData - no `PDFDataTransportStreamRangeReader` instance found.")}}get _progressiveDataLength(){return this._fullRequestReader?._loaded??0}_onProgress(e){if(void 0===e.total){const t=this._rangeReaders[0];t?.onProgress&&t.onProgress({loaded:e.loaded})}else{const t=this._fullRequestReader;t?.onProgress&&t.onProgress({loaded:e.loaded,total:e.total})}}_onProgressiveDone(){this._fullRequestReader&&this._fullRequestReader.progressiveDone(),this._progressiveDone=!0}_removeRangeReader(e){const t=this._rangeReaders.indexOf(e);t>=0&&this._rangeReaders.splice(t,1)}getFullReader(){(0,r.assert)(!this._fullRequestReader,"PDFDataTransportStream.getFullReader can only be called once.");const e=this._queuedChunks;return this._queuedChunks=null,new s(this,e,this._progressiveDone,this._contentDispositionFilename)}getRangeReader(e,t){if(t<=this._progressiveDataLength)return null;const n=new o(this,e,t);return this._pdfDataRangeTransport.requestDataRange(e,t),this._rangeReaders.push(n),n}cancelAllRequests(e){this._fullRequestReader&&this._fullRequestReader.cancel(e);for(const t of this._rangeReaders.slice(0))t.cancel(e);this._pdfDataRangeTransport.abort()}};class s{constructor(e,t,n=!1,r=null){this._stream=e,this._done=n||!1,this._filename=(0,i.isPdfFile)(r)?r:null,this._queuedChunks=t||[],this._loaded=0;for(const e of this._queuedChunks)this._loaded+=e.byteLength;this._requests=[],this._headersReady=Promise.resolve(),e._fullRequestReader=this,this.onProgress=null}_enqueue(e){this._done||(this._requests.length>0?this._requests.shift().resolve({value:e,done:!1}):this._queuedChunks.push(e),this._loaded+=e.byteLength)}get headersReady(){return this._headersReady}get filename(){return this._filename}get isRangeSupported(){return this._stream._isRangeSupported}get isStreamingSupported(){return this._stream._isStreamingSupported}get contentLength(){return this._stream._contentLength}async read(){if(this._queuedChunks.length>0)return{value:this._queuedChunks.shift(),done:!1};if(this._done)return{value:void 0,done:!0};const e=(0,r.createPromiseCapability)();return this._requests.push(e),e.promise}cancel(e){this._done=!0;for(const e of this._requests)e.resolve({value:void 0,done:!0});this._requests.length=0}progressiveDone(){this._done||(this._done=!0)}}class o{constructor(e,t,n){this._stream=e,this._begin=t,this._end=n,this._queuedChunk=null,this._requests=[],this._done=!1,this.onProgress=null}_enqueue(e){if(!this._done){if(0===this._requests.length)this._queuedChunk=e;else{this._requests.shift().resolve({value:e,done:!1});for(const e of this._requests)e.resolve({value:void 0,done:!0});this._requests.length=0}this._done=!0,this._stream._removeRangeReader(this)}}get isStreamingSupported(){return!1}async read(){if(this._queuedChunk){const e=this._queuedChunk;return this._queuedChunk=null,{value:e,done:!1}}if(this._done)return{value:void 0,done:!0};const e=(0,r.createPromiseCapability)();return this._requests.push(e),e.promise}cancel(e){this._done=!0;for(const e of this._requests)e.resolve({value:void 0,done:!0});this._requests.length=0,this._stream._removeRangeReader(this)}}},(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.XfaText=void 0;class n{static textContent(e){const t=[],r={items:t,styles:Object.create(null)};return function e(r){if(!r)return;let i=null;const s=r.name;if("#text"===s)i=r.value;else{if(!n.shouldBuildText(s))return;r?.attributes?.textContent?i=r.attributes.textContent:r.value&&(i=r.value)}if(null!==i&&t.push({str:i}),r.children)for(const t of r.children)e(t)}(e),r}static shouldBuildText(e){return!("textarea"===e||"input"===e||"option"===e||"select"===e)}}t.XfaText=n},(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.AnnotationLayer=void 0;var r=n(1),i=n(5),s=n(9),o=n(19),a=n(20);const l=1e3,c=new WeakSet;function d(e){return{width:e[2]-e[0],height:e[3]-e[1]}}class u{static create(e){switch(e.data.annotationType){case r.AnnotationType.LINK:return new p(e);case r.AnnotationType.TEXT:return new m(e);case r.AnnotationType.WIDGET:switch(e.data.fieldType){case"Tx":return new f(e);case"Btn":return e.data.radioButton?new v(e):e.data.checkBox?new y(e):new b(e);case"Ch":return new w(e)}return new g(e);case r.AnnotationType.POPUP:return new S(e);case r.AnnotationType.FREETEXT:return new k(e);case r.AnnotationType.LINE:return new x(e);case r.AnnotationType.SQUARE:return new E(e);case r.AnnotationType.CIRCLE:return new T(e);case r.AnnotationType.POLYLINE:return new C(e);case r.AnnotationType.CARET:return new I(e);case r.AnnotationType.INK:return new R(e);case r.AnnotationType.POLYGON:return new A(e);case r.AnnotationType.HIGHLIGHT:return new O(e);case r.AnnotationType.UNDERLINE:return new P(e);case r.AnnotationType.SQUIGGLY:return new M(e);case r.AnnotationType.STRIKEOUT:return new D(e);case r.AnnotationType.STAMP:return new L(e);case r.AnnotationType.FILEATTACHMENT:return new F(e);default:return new h(e)}}}class h{constructor(e,{isRenderable:t=!1,ignoreBorder:n=!1,createQuadrilaterals:r=!1}={}){this.isRenderable=t,this.data=e.data,this.layer=e.layer,this.page=e.page,this.viewport=e.viewport,this.linkService=e.linkService,this.downloadManager=e.downloadManager,this.imageResourcesPath=e.imageResourcesPath,this.renderForms=e.renderForms,this.svgFactory=e.svgFactory,this.annotationStorage=e.annotationStorage,this.enableScripting=e.enableScripting,this.hasJSActions=e.hasJSActions,this._fieldObjects=e.fieldObjects,this._mouseState=e.mouseState,t&&(this.container=this._createContainer(n)),r&&(this.quadrilaterals=this._createQuadrilaterals(n))}_createContainer(e=!1){const t=this.data,n=this.page,i=this.viewport,s=document.createElement("section");let{width:o,height:a}=d(t.rect);s.setAttribute("data-annotation-id",t.id);const l=r.Util.normalizeRect([t.rect[0],n.view[3]-t.rect[1]+n.view[1],t.rect[2],n.view[3]-t.rect[3]+n.view[1]]);if(t.hasOwnCanvas){const e=i.transform.slice(),[t,n]=r.Util.singularValueDecompose2dScale(e);o=Math.ceil(o*t),a=Math.ceil(a*n),l[0]*=t,l[1]*=n;for(let t=0;t<4;t++)e[t]=Math.sign(e[t]);s.style.transform=`matrix(${e.join(",")})`}else s.style.transform=`matrix(${i.transform.join(",")})`;if(s.style.transformOrigin=`${-l[0]}px ${-l[1]}px`,!e&&t.borderStyle.width>0){s.style.borderWidth=`${t.borderStyle.width}px`,t.borderStyle.style!==r.AnnotationBorderStyleType.UNDERLINE&&(o-=2*t.borderStyle.width,a-=2*t.borderStyle.width);const e=t.borderStyle.horizontalCornerRadius,n=t.borderStyle.verticalCornerRadius;if(e>0||n>0){const t=`${e}px / ${n}px`;s.style.borderRadius=t}switch(t.borderStyle.style){case r.AnnotationBorderStyleType.SOLID:s.style.borderStyle="solid";break;case r.AnnotationBorderStyleType.DASHED:s.style.borderStyle="dashed";break;case r.AnnotationBorderStyleType.BEVELED:(0,r.warn)("Unimplemented border style: beveled");break;case r.AnnotationBorderStyleType.INSET:(0,r.warn)("Unimplemented border style: inset");break;case r.AnnotationBorderStyleType.UNDERLINE:s.style.borderBottomStyle="solid"}t.borderColor||t.color?s.style.borderColor=r.Util.makeHexColor(0|t.color[0],0|t.color[1],0|t.color[2]):s.style.borderWidth=0}return s.style.left=`${l[0]}px`,s.style.top=`${l[1]}px`,t.hasOwnCanvas?s.style.width=s.style.height="auto":(s.style.width=`${o}px`,s.style.height=`${a}px`),s}_createQuadrilaterals(e=!1){if(!this.data.quadPoints)return null;const t=[],n=this.data.rect;for(const n of this.data.quadPoints)this.data.rect=[n[2].x,n[2].y,n[1].x,n[1].y],t.push(this._createContainer(e));return this.data.rect=n,t}_createPopup(e,t){let n=this.container;this.quadrilaterals&&(e=e||this.quadrilaterals,n=this.quadrilaterals[0]),e||((e=document.createElement("div")).style.height=n.style.height,e.style.width=n.style.width,n.appendChild(e));const r=new _({container:n,trigger:e,color:t.color,titleObj:t.titleObj,modificationDate:t.modificationDate,contentsObj:t.contentsObj,richText:t.richText,hideWrapper:!0}).render();r.style.left=n.style.width,n.appendChild(r)}_renderQuadrilaterals(e){for(const t of this.quadrilaterals)t.className=e;return this.quadrilaterals}render(){(0,r.unreachable)("Abstract method `AnnotationElement.render` called")}_getElementsByName(e,t=null){const n=[];if(this._fieldObjects){const i=this._fieldObjects[e];if(i)for(const{page:e,id:s,exportValues:o}of i){if(-1===e)continue;if(s===t)continue;const i="string"==typeof o?o:null,a=document.getElementById(s);!a||c.has(a)?n.push({id:s,exportValue:i,domElement:a}):(0,r.warn)(`_getElementsByName - element not allowed: ${s}`)}return n}for(const r of document.getElementsByName(e)){const{id:e,exportValue:i}=r;e!==t&&c.has(r)&&n.push({id:e,exportValue:i,domElement:r})}return n}static get platform(){const e="undefined"!=typeof navigator?navigator.platform:"";return(0,r.shadow)(this,"platform",{isWin:e.includes("Win"),isMac:e.includes("Mac")})}}class p extends h{constructor(e,t=null){super(e,{isRenderable:!!(e.data.url||e.data.dest||e.data.action||e.data.isTooltipOnly||e.data.resetForm||e.data.actions&&(e.data.actions.Action||e.data.actions["Mouse Up"]||e.data.actions["Mouse Down"])),ignoreBorder:!!t?.ignoreBorder,createQuadrilaterals:!0})}render(){const{data:e,linkService:t}=this,n=document.createElement("a");if(e.url)t.addLinkAttributes||(0,r.warn)("LinkAnnotationElement.render - missing `addLinkAttributes`-method on the `linkService`-instance."),t.addLinkAttributes?.(n,e.url,e.newWindow);else if(e.action)this._bindNamedAction(n,e.action);else if(e.dest)this._bindLink(n,e.dest);else{let t=!1;e.actions&&(e.actions.Action||e.actions["Mouse Up"]||e.actions["Mouse Down"])&&this.enableScripting&&this.hasJSActions&&(t=!0,this._bindJSAction(n,e)),e.resetForm?this._bindResetFormAction(n,e.resetForm):t||this._bindLink(n,"")}return this.quadrilaterals?this._renderQuadrilaterals("linkAnnotation").map(((e,t)=>{const r=0===t?n:n.cloneNode();return e.appendChild(r),e})):(this.container.className="linkAnnotation",this.container.appendChild(n),this.container)}_bindLink(e,t){e.href=this.linkService.getDestinationHash(t),e.onclick=()=>(t&&this.linkService.goToDestination(t),!1),(t||""===t)&&(e.className="internalLink")}_bindNamedAction(e,t){e.href=this.linkService.getAnchorUrl(""),e.onclick=()=>(this.linkService.executeNamedAction(t),!1),e.className="internalLink"}_bindJSAction(e,t){e.href=this.linkService.getAnchorUrl("");const n=new Map([["Action","onclick"],["Mouse Up","onmouseup"],["Mouse Down","onmousedown"]]);for(const r of Object.keys(t.actions)){const i=n.get(r);i&&(e[i]=()=>(this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:t.id,name:r}}),!1))}e.onclick||(e.onclick=()=>!1),e.className="internalLink"}_bindResetFormAction(e,t){const n=e.onclick;if(n||(e.href=this.linkService.getAnchorUrl("")),e.className="internalLink",!this._fieldObjects)return(0,r.warn)('_bindResetFormAction - "resetForm" action not supported, ensure that the `fieldObjects` parameter is provided.'),void(n||(e.onclick=()=>!1));e.onclick=()=>{n&&n();const{fields:e,refs:r,include:i}=t,s=[];if(0!==e.length||0!==r.length){const t=new Set(r);for(const n of e){const e=this._fieldObjects[n]||[];for(const{id:n}of e)t.add(n)}for(const e of Object.values(this._fieldObjects))for(const n of e)t.has(n.id)===i&&s.push(n)}else for(const e of Object.values(this._fieldObjects))s.push(...e);const o=this.annotationStorage,a=[];for(const e of s){const{id:t}=e;switch(a.push(t),e.type){case"text":{const n=e.defaultValue||"";o.setValue(t,{value:n,valueAsString:n});break}case"checkbox":case"radiobutton":{const n=e.defaultValue===e.exportValues;o.setValue(t,{value:n});break}case"combobox":case"listbox":{const n=e.defaultValue||"";o.setValue(t,{value:n});break}default:continue}const n=document.getElementById(t);n&&c.has(n)&&n.dispatchEvent(new Event("resetform"))}return this.enableScripting&&this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:"app",ids:a,name:"ResetForm"}}),!1}}}class m extends h{constructor(e){super(e,{isRenderable:!!(e.data.hasPopup||e.data.titleObj?.str||e.data.contentsObj?.str||e.data.richText?.str)})}render(){this.container.className="textAnnotation";const e=document.createElement("img");return e.style.height=this.container.style.height,e.style.width=this.container.style.width,e.src=this.imageResourcesPath+"annotation-"+this.data.name.toLowerCase()+".svg",e.alt="[{{type}} Annotation]",e.dataset.l10nId="text_annotation_type",e.dataset.l10nArgs=JSON.stringify({type:this.data.name}),this.data.hasPopup||this._createPopup(e,this.data),this.container.appendChild(e),this.container}}class g extends h{render(){return this.data.alternativeText&&(this.container.title=this.data.alternativeText),this.container}_getKeyModifier(e){const{isWin:t,isMac:n}=h.platform;return t&&e.ctrlKey||n&&e.metaKey}_setEventListener(e,t,n,r){t.includes("mouse")?e.addEventListener(t,(e=>{this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:this.data.id,name:n,value:r(e),shift:e.shiftKey,modifier:this._getKeyModifier(e)}})})):e.addEventListener(t,(e=>{this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:this.data.id,name:n,value:r(e)}})}))}_setEventListeners(e,t,n){for(const[r,i]of t)("Action"===i||this.data.actions?.[i])&&this._setEventListener(e,r,i,n)}_setBackgroundColor(e){const t=this.data.backgroundColor||null;e.style.backgroundColor=null===t?"transparent":r.Util.makeHexColor(t[0],t[1],t[2])}_dispatchEventFromSandbox(e,t){const n=(e,t,n)=>{const r=n.detail[e];n.target.style[t]=o.ColorConverters[`${r[0]}_HTML`](r.slice(1))},r={display:e=>{const t=e.detail.display%2==1;e.target.style.visibility=t?"hidden":"visible",this.annotationStorage.setValue(this.data.id,{hidden:t,print:0===e.detail.display||3===e.detail.display})},print:e=>{this.annotationStorage.setValue(this.data.id,{print:e.detail.print})},hidden:e=>{e.target.style.visibility=e.detail.hidden?"hidden":"visible",this.annotationStorage.setValue(this.data.id,{hidden:e.detail.hidden})},focus:e=>{setTimeout((()=>e.target.focus({preventScroll:!1})),0)},userName:e=>{e.target.title=e.detail.userName},readonly:e=>{e.detail.readonly?e.target.setAttribute("readonly",""):e.target.removeAttribute("readonly")},required:e=>{e.detail.required?e.target.setAttribute("required",""):e.target.removeAttribute("required")},bgColor:e=>{n("bgColor","backgroundColor",e)},fillColor:e=>{n("fillColor","backgroundColor",e)},fgColor:e=>{n("fgColor","color",e)},textColor:e=>{n("textColor","color",e)},borderColor:e=>{n("borderColor","borderColor",e)},strokeColor:e=>{n("strokeColor","borderColor",e)}};for(const n of Object.keys(t.detail)){const i=e[n]||r[n];i&&i(t)}}}class f extends g{constructor(e){super(e,{isRenderable:e.renderForms||!e.data.hasAppearance&&!!e.data.fieldValue})}setPropertyOnSiblings(e,t,n,r){const i=this.annotationStorage;for(const s of this._getElementsByName(e.name,e.id))s.domElement&&(s.domElement[t]=n),i.setValue(s.id,{[r]:n})}render(){const e=this.annotationStorage,t=this.data.id;this.container.className="textWidgetAnnotation";let n=null;if(this.renderForms){const r=e.getValue(t,{value:this.data.fieldValue,valueAsString:this.data.fieldValue}),i=r.valueAsString||r.value||"",s={userValue:null,formattedValue:null};this.data.multiLine?(n=document.createElement("textarea"),n.textContent=i):(n=document.createElement("input"),n.type="text",n.setAttribute("value",i)),c.add(n),n.disabled=this.data.readOnly,n.name=this.data.fieldName,n.tabIndex=l,s.userValue=i,n.setAttribute("id",t),n.addEventListener("input",(r=>{e.setValue(t,{value:r.target.value}),this.setPropertyOnSiblings(n,"value",r.target.value,"value")})),n.addEventListener("resetform",(e=>{const t=this.data.defaultFieldValue||"";n.value=s.userValue=t,delete s.formattedValue}));let o=e=>{s.formattedValue&&(e.target.value=s.formattedValue),e.target.scrollLeft=0};if(this.enableScripting&&this.hasJSActions){n.addEventListener("focus",(e=>{s.userValue&&(e.target.value=s.userValue)})),n.addEventListener("updatefromsandbox",(n=>{const r={value(n){s.userValue=n.detail.value||"",e.setValue(t,{value:s.userValue.toString()}),s.formattedValue||(n.target.value=s.userValue)},valueAsString(n){s.formattedValue=n.detail.valueAsString||"",n.target!==document.activeElement&&(n.target.value=s.formattedValue),e.setValue(t,{formattedValue:s.formattedValue})},selRange(e){const[t,n]=e.detail.selRange;t>=0&&n<e.target.value.length&&e.target.setSelectionRange(t,n)}};this._dispatchEventFromSandbox(r,n)})),n.addEventListener("keydown",(e=>{let n=-1;"Escape"===e.key?n=0:"Enter"===e.key?n=2:"Tab"===e.key&&(n=3),-1!==n&&(s.userValue=e.target.value,this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:t,name:"Keystroke",value:e.target.value,willCommit:!0,commitKey:n,selStart:e.target.selectionStart,selEnd:e.target.selectionEnd}}))}));const r=o;o=null,n.addEventListener("blur",(e=>{s.userValue=e.target.value,this._mouseState.isDown&&this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:t,name:"Keystroke",value:e.target.value,willCommit:!0,commitKey:1,selStart:e.target.selectionStart,selEnd:e.target.selectionEnd}}),r(e)})),this.data.actions?.Keystroke&&n.addEventListener("beforeinput",(e=>{s.formattedValue="";const{data:n,target:r}=e,{value:i,selectionStart:o,selectionEnd:a}=r;this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:t,name:"Keystroke",value:i,change:n,willCommit:!1,selStart:o,selEnd:a}})})),this._setEventListeners(n,[["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],(e=>e.target.value))}if(o&&n.addEventListener("blur",o),null!==this.data.maxLen&&(n.maxLength=this.data.maxLen),this.data.comb){const e=(this.data.rect[2]-this.data.rect[0])/this.data.maxLen;n.classList.add("comb"),n.style.letterSpacing=`calc(${e}px - 1ch)`}}else n=document.createElement("div"),n.textContent=this.data.fieldValue,n.style.verticalAlign="middle",n.style.display="table-cell";return this._setTextStyle(n),this._setBackgroundColor(n),this.container.appendChild(n),this.container}_setTextStyle(e){const{fontSize:t,fontColor:n}=this.data.defaultAppearanceData,i=e.style;t&&(i.fontSize=`${t}px`),i.color=r.Util.makeHexColor(n[0],n[1],n[2]),null!==this.data.textAlignment&&(i.textAlign=["left","center","right"][this.data.textAlignment])}}class y extends g{constructor(e){super(e,{isRenderable:e.renderForms})}render(){const e=this.annotationStorage,t=this.data,n=t.id;let r=e.getValue(n,{value:t.exportValue===t.fieldValue}).value;"string"==typeof r&&(r="Off"!==r,e.setValue(n,{value:r})),this.container.className="buttonWidgetAnnotation checkBox";const i=document.createElement("input");return c.add(i),i.disabled=t.readOnly,i.type="checkbox",i.name=t.fieldName,r&&i.setAttribute("checked",!0),i.setAttribute("id",n),i.setAttribute("exportValue",t.exportValue),i.tabIndex=l,i.addEventListener("change",(r=>{const{name:i,checked:s}=r.target;for(const r of this._getElementsByName(i,n)){const n=s&&r.exportValue===t.exportValue;r.domElement&&(r.domElement.checked=n),e.setValue(r.id,{value:n})}e.setValue(n,{value:s})})),i.addEventListener("resetform",(e=>{const n=t.defaultFieldValue||"Off";e.target.checked=n===t.exportValue})),this.enableScripting&&this.hasJSActions&&(i.addEventListener("updatefromsandbox",(t=>{const r={value(t){t.target.checked="Off"!==t.detail.value,e.setValue(n,{value:t.target.checked})}};this._dispatchEventFromSandbox(r,t)})),this._setEventListeners(i,[["change","Validate"],["change","Action"],["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],(e=>e.target.checked))),this._setBackgroundColor(i),this.container.appendChild(i),this.container}}class v extends g{constructor(e){super(e,{isRenderable:e.renderForms})}render(){this.container.className="buttonWidgetAnnotation radioButton";const e=this.annotationStorage,t=this.data,n=t.id;let r=e.getValue(n,{value:t.fieldValue===t.buttonValue}).value;"string"==typeof r&&(r=r!==t.buttonValue,e.setValue(n,{value:r}));const i=document.createElement("input");if(c.add(i),i.disabled=t.readOnly,i.type="radio",i.name=t.fieldName,r&&i.setAttribute("checked",!0),i.setAttribute("id",n),i.tabIndex=l,i.addEventListener("change",(t=>{const{name:r,checked:i}=t.target;for(const t of this._getElementsByName(r,n))e.setValue(t.id,{value:!1});e.setValue(n,{value:i})})),i.addEventListener("resetform",(e=>{const n=t.defaultFieldValue;e.target.checked=null!=n&&n===t.buttonValue})),this.enableScripting&&this.hasJSActions){const r=t.buttonValue;i.addEventListener("updatefromsandbox",(t=>{const i={value:t=>{const i=r===t.detail.value;for(const r of this._getElementsByName(t.target.name)){const t=i&&r.id===n;r.domElement&&(r.domElement.checked=t),e.setValue(r.id,{value:t})}}};this._dispatchEventFromSandbox(i,t)})),this._setEventListeners(i,[["change","Validate"],["change","Action"],["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],(e=>e.target.checked))}return this._setBackgroundColor(i),this.container.appendChild(i),this.container}}class b extends p{constructor(e){super(e,{ignoreBorder:e.data.hasAppearance})}render(){const e=super.render();return e.className="buttonWidgetAnnotation pushButton",this.data.alternativeText&&(e.title=this.data.alternativeText),e}}class w extends g{constructor(e){super(e,{isRenderable:e.renderForms})}render(){this.container.className="choiceWidgetAnnotation";const e=this.annotationStorage,t=this.data.id;e.getValue(t,{value:this.data.fieldValue.length>0?this.data.fieldValue[0]:void 0});let{fontSize:n}=this.data.defaultAppearanceData;n||(n=9);const r=`calc(${n}px * var(--zoom-factor))`,i=document.createElement("select");c.add(i),i.disabled=this.data.readOnly,i.name=this.data.fieldName,i.setAttribute("id",t),i.tabIndex=l,i.style.fontSize=`${n}px`,this.data.combo||(i.size=this.data.options.length,this.data.multiSelect&&(i.multiple=!0)),i.addEventListener("resetform",(e=>{const t=this.data.defaultFieldValue;for(const e of i.options)e.selected=e.value===t}));for(const e of this.data.options){const t=document.createElement("option");t.textContent=e.displayValue,t.value=e.exportValue,this.data.combo&&(t.style.fontSize=r),this.data.fieldValue.includes(e.exportValue)&&t.setAttribute("selected",!0),i.appendChild(t)}const s=(e,t)=>{const n=t?"value":"textContent",r=e.target.options;return e.target.multiple?Array.prototype.filter.call(r,(e=>e.selected)).map((e=>e[n])):-1===r.selectedIndex?null:r[r.selectedIndex][n]},o=e=>{const t=e.target.options;return Array.prototype.map.call(t,(e=>({displayValue:e.textContent,exportValue:e.value})))};return this.enableScripting&&this.hasJSActions?(i.addEventListener("updatefromsandbox",(n=>{const r={value(n){const r=n.detail.value,o=new Set(Array.isArray(r)?r:[r]);for(const e of i.options)e.selected=o.has(e.value);e.setValue(t,{value:s(n,!0)})},multipleSelection(e){i.multiple=!0},remove(n){const r=i.options,a=n.detail.remove;r[a].selected=!1,i.remove(a),r.length>0&&-1===Array.prototype.findIndex.call(r,(e=>e.selected))&&(r[0].selected=!0),e.setValue(t,{value:s(n,!0),items:o(n)})},clear(n){for(;0!==i.length;)i.remove(0);e.setValue(t,{value:null,items:[]})},insert(n){const{index:r,displayValue:a,exportValue:l}=n.detail.insert,c=document.createElement("option");c.textContent=a,c.value=l,i.insertBefore(c,i.children[r]),e.setValue(t,{value:s(n,!0),items:o(n)})},items(n){const{items:r}=n.detail;for(;0!==i.length;)i.remove(0);for(const e of r){const{displayValue:t,exportValue:n}=e,r=document.createElement("option");r.textContent=t,r.value=n,i.appendChild(r)}i.options.length>0&&(i.options[0].selected=!0),e.setValue(t,{value:s(n,!0),items:o(n)})},indices(n){const r=new Set(n.detail.indices);for(const e of n.target.options)e.selected=r.has(e.index);e.setValue(t,{value:s(n,!0)})},editable(e){e.target.disabled=!e.detail.editable}};this._dispatchEventFromSandbox(r,n)})),i.addEventListener("input",(n=>{const r=s(n,!0),i=s(n,!1);e.setValue(t,{value:r}),this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:t,name:"Keystroke",value:i,changeEx:r,willCommit:!0,commitKey:1,keyDown:!1}})})),this._setEventListeners(i,[["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"],["input","Action"]],(e=>e.target.checked))):i.addEventListener("input",(function(n){e.setValue(t,{value:s(n)})})),this._setBackgroundColor(i),this.container.appendChild(i),this.container}}class S extends h{constructor(e){super(e,{isRenderable:!!(e.data.titleObj?.str||e.data.contentsObj?.str||e.data.richText?.str)})}render(){if(this.container.className="popupAnnotation",["Line","Square","Circle","PolyLine","Polygon","Ink"].includes(this.data.parentType))return this.container;const e=`[data-annotation-id="${this.data.parentId}"]`,t=this.layer.querySelectorAll(e);if(0===t.length)return this.container;const n=new _({container:this.container,trigger:Array.from(t),color:this.data.color,titleObj:this.data.titleObj,modificationDate:this.data.modificationDate,contentsObj:this.data.contentsObj,richText:this.data.richText}),i=this.page,s=r.Util.normalizeRect([this.data.parentRect[0],i.view[3]-this.data.parentRect[1]+i.view[1],this.data.parentRect[2],i.view[3]-this.data.parentRect[3]+i.view[1]]),o=s[0]+this.data.parentRect[2]-this.data.parentRect[0],a=s[1];return this.container.style.transformOrigin=`${-o}px ${-a}px`,this.container.style.left=`${o}px`,this.container.style.top=`${a}px`,this.container.appendChild(n.render()),this.container}}class _{constructor(e){this.container=e.container,this.trigger=e.trigger,this.color=e.color,this.titleObj=e.titleObj,this.modificationDate=e.modificationDate,this.contentsObj=e.contentsObj,this.richText=e.richText,this.hideWrapper=e.hideWrapper||!1,this.pinned=!1}render(){const e=document.createElement("div");e.className="popupWrapper",this.hideElement=this.hideWrapper?e:this.container,this.hideElement.hidden=!0;const t=document.createElement("div");t.className="popup";const n=this.color;if(n){const e=.7*(255-n[0])+n[0],i=.7*(255-n[1])+n[1],s=.7*(255-n[2])+n[2];t.style.backgroundColor=r.Util.makeHexColor(0|e,0|i,0|s)}const s=document.createElement("h1");s.dir=this.titleObj.dir,s.textContent=this.titleObj.str,t.appendChild(s);const o=i.PDFDateString.toDateObject(this.modificationDate);if(o){const e=document.createElement("span");e.className="popupDate",e.textContent="{{date}}, {{time}}",e.dataset.l10nId="annotation_date_string",e.dataset.l10nArgs=JSON.stringify({date:o.toLocaleDateString(),time:o.toLocaleTimeString()}),t.appendChild(e)}if(!this.richText?.str||this.contentsObj?.str&&this.contentsObj.str!==this.richText.str){const e=this._formatContents(this.contentsObj);t.appendChild(e)}else a.XfaLayer.render({xfaHtml:this.richText.html,intent:"richText",div:t}),t.lastChild.className="richText popupContent";Array.isArray(this.trigger)||(this.trigger=[this.trigger]);for(const e of this.trigger)e.addEventListener("click",this._toggle.bind(this)),e.addEventListener("mouseover",this._show.bind(this,!1)),e.addEventListener("mouseout",this._hide.bind(this,!1));return t.addEventListener("click",this._hide.bind(this,!0)),e.appendChild(t),e}_formatContents({str:e,dir:t}){const n=document.createElement("p");n.className="popupContent",n.dir=t;const r=e.split(/(?:\r\n?|\n)/);for(let e=0,t=r.length;e<t;++e){const i=r[e];n.appendChild(document.createTextNode(i)),e<t-1&&n.appendChild(document.createElement("br"))}return n}_toggle(){this.pinned?this._hide(!0):this._show(!0)}_show(e=!1){e&&(this.pinned=!0),this.hideElement.hidden&&(this.hideElement.hidden=!1,this.container.style.zIndex+=1)}_hide(e=!0){e&&(this.pinned=!1),this.hideElement.hidden||this.pinned||(this.hideElement.hidden=!0,this.container.style.zIndex-=1)}}class k extends h{constructor(e){super(e,{isRenderable:!!(e.data.hasPopup||e.data.titleObj?.str||e.data.contentsObj?.str||e.data.richText?.str),ignoreBorder:!0})}render(){return this.container.className="freeTextAnnotation",this.data.hasPopup||this._createPopup(null,this.data),this.container}}class x extends h{constructor(e){super(e,{isRenderable:!!(e.data.hasPopup||e.data.titleObj?.str||e.data.contentsObj?.str||e.data.richText?.str),ignoreBorder:!0})}render(){this.container.className="lineAnnotation";const e=this.data,{width:t,height:n}=d(e.rect),r=this.svgFactory.create(t,n),i=this.svgFactory.createElement("svg:line");return i.setAttribute("x1",e.rect[2]-e.lineCoordinates[0]),i.setAttribute("y1",e.rect[3]-e.lineCoordinates[1]),i.setAttribute("x2",e.rect[2]-e.lineCoordinates[2]),i.setAttribute("y2",e.rect[3]-e.lineCoordinates[3]),i.setAttribute("stroke-width",e.borderStyle.width||1),i.setAttribute("stroke","transparent"),i.setAttribute("fill","transparent"),r.appendChild(i),this.container.append(r),this._createPopup(i,e),this.container}}class E extends h{constructor(e){super(e,{isRenderable:!!(e.data.hasPopup||e.data.titleObj?.str||e.data.contentsObj?.str||e.data.richText?.str),ignoreBorder:!0})}render(){this.container.className="squareAnnotation";const e=this.data,{width:t,height:n}=d(e.rect),r=this.svgFactory.create(t,n),i=e.borderStyle.width,s=this.svgFactory.createElement("svg:rect");return s.setAttribute("x",i/2),s.setAttribute("y",i/2),s.setAttribute("width",t-i),s.setAttribute("height",n-i),s.setAttribute("stroke-width",i||1),s.setAttribute("stroke","transparent"),s.setAttribute("fill","transparent"),r.appendChild(s),this.container.append(r),this._createPopup(s,e),this.container}}class T extends h{constructor(e){super(e,{isRenderable:!!(e.data.hasPopup||e.data.titleObj?.str||e.data.contentsObj?.str||e.data.richText?.str),ignoreBorder:!0})}render(){this.container.className="circleAnnotation";const e=this.data,{width:t,height:n}=d(e.rect),r=this.svgFactory.create(t,n),i=e.borderStyle.width,s=this.svgFactory.createElement("svg:ellipse");return s.setAttribute("cx",t/2),s.setAttribute("cy",n/2),s.setAttribute("rx",t/2-i/2),s.setAttribute("ry",n/2-i/2),s.setAttribute("stroke-width",i||1),s.setAttribute("stroke","transparent"),s.setAttribute("fill","transparent"),r.appendChild(s),this.container.append(r),this._createPopup(s,e),this.container}}class C extends h{constructor(e){super(e,{isRenderable:!!(e.data.hasPopup||e.data.titleObj?.str||e.data.contentsObj?.str||e.data.richText?.str),ignoreBorder:!0}),this.containerClassName="polylineAnnotation",this.svgElementName="svg:polyline"}render(){this.container.className=this.containerClassName;const e=this.data,{width:t,height:n}=d(e.rect),r=this.svgFactory.create(t,n);let i=[];for(const t of e.vertices){const n=t.x-e.rect[0],r=e.rect[3]-t.y;i.push(n+","+r)}i=i.join(" ");const s=this.svgFactory.createElement(this.svgElementName);return s.setAttribute("points",i),s.setAttribute("stroke-width",e.borderStyle.width||1),s.setAttribute("stroke","transparent"),s.setAttribute("fill","transparent"),r.appendChild(s),this.container.append(r),this._createPopup(s,e),this.container}}class A extends C{constructor(e){super(e),this.containerClassName="polygonAnnotation",this.svgElementName="svg:polygon"}}class I extends h{constructor(e){super(e,{isRenderable:!!(e.data.hasPopup||e.data.titleObj?.str||e.data.contentsObj?.str||e.data.richText?.str),ignoreBorder:!0})}render(){return this.container.className="caretAnnotation",this.data.hasPopup||this._createPopup(null,this.data),this.container}}class R extends h{constructor(e){super(e,{isRenderable:!!(e.data.hasPopup||e.data.titleObj?.str||e.data.contentsObj?.str||e.data.richText?.str),ignoreBorder:!0}),this.containerClassName="inkAnnotation",this.svgElementName="svg:polyline"}render(){this.container.className=this.containerClassName;const e=this.data,{width:t,height:n}=d(e.rect),r=this.svgFactory.create(t,n);for(const t of e.inkLists){let n=[];for(const r of t){const t=r.x-e.rect[0],i=e.rect[3]-r.y;n.push(`${t},${i}`)}n=n.join(" ");const i=this.svgFactory.createElement(this.svgElementName);i.setAttribute("points",n),i.setAttribute("stroke-width",e.borderStyle.width||1),i.setAttribute("stroke","transparent"),i.setAttribute("fill","transparent"),this._createPopup(i,e),r.appendChild(i)}return this.container.append(r),this.container}}class O extends h{constructor(e){super(e,{isRenderable:!!(e.data.hasPopup||e.data.titleObj?.str||e.data.contentsObj?.str||e.data.richText?.str),ignoreBorder:!0,createQuadrilaterals:!0})}render(){return this.data.hasPopup||this._createPopup(null,this.data),this.quadrilaterals?this._renderQuadrilaterals("highlightAnnotation"):(this.container.className="highlightAnnotation",this.container)}}class P extends h{constructor(e){super(e,{isRenderable:!!(e.data.hasPopup||e.data.titleObj?.str||e.data.contentsObj?.str||e.data.richText?.str),ignoreBorder:!0,createQuadrilaterals:!0})}render(){return this.data.hasPopup||this._createPopup(null,this.data),this.quadrilaterals?this._renderQuadrilaterals("underlineAnnotation"):(this.container.className="underlineAnnotation",this.container)}}class M extends h{constructor(e){super(e,{isRenderable:!!(e.data.hasPopup||e.data.titleObj?.str||e.data.contentsObj?.str||e.data.richText?.str),ignoreBorder:!0,createQuadrilaterals:!0})}render(){return this.data.hasPopup||this._createPopup(null,this.data),this.quadrilaterals?this._renderQuadrilaterals("squigglyAnnotation"):(this.container.className="squigglyAnnotation",this.container)}}class D extends h{constructor(e){super(e,{isRenderable:!!(e.data.hasPopup||e.data.titleObj?.str||e.data.contentsObj?.str||e.data.richText?.str),ignoreBorder:!0,createQuadrilaterals:!0})}render(){return this.data.hasPopup||this._createPopup(null,this.data),this.quadrilaterals?this._renderQuadrilaterals("strikeoutAnnotation"):(this.container.className="strikeoutAnnotation",this.container)}}class L extends h{constructor(e){super(e,{isRenderable:!!(e.data.hasPopup||e.data.titleObj?.str||e.data.contentsObj?.str||e.data.richText?.str),ignoreBorder:!0})}render(){return this.container.className="stampAnnotation",this.data.hasPopup||this._createPopup(null,this.data),this.container}}class F extends h{constructor(e){super(e,{isRenderable:!0});const{filename:t,content:n}=this.data.file;this.filename=(0,i.getFilenameFromUrl)(t),this.content=n,this.linkService.eventBus?.dispatch("fileattachmentannotation",{source:this,id:(0,r.stringToPDFString)(t),filename:t,content:n})}render(){this.container.className="fileAttachmentAnnotation";const e=document.createElement("div");return e.style.height=this.container.style.height,e.style.width=this.container.style.width,e.addEventListener("dblclick",this._download.bind(this)),!this.data.hasPopup&&(this.data.titleObj?.str||this.data.contentsObj?.str||this.data.richText)&&this._createPopup(e,this.data),this.container.appendChild(e),this.container}_download(){this.downloadManager?.openOrDownloadData(this.container,this.content,this.filename)}}t.AnnotationLayer=class{static render(e){const t=[],n=[];for(const i of e.annotations){if(!i)continue;const{width:e,height:s}=d(i.rect);e<=0||s<=0||(i.annotationType!==r.AnnotationType.POPUP?t.push(i):n.push(i))}n.length&&t.push(...n);const o=e.div;for(const n of t){const t=u.create({data:n,layer:o,page:e.page,viewport:e.viewport,linkService:e.linkService,downloadManager:e.downloadManager,imageResourcesPath:e.imageResourcesPath||"",renderForms:!1!==e.renderForms,svgFactory:new i.DOMSVGFactory,annotationStorage:e.annotationStorage||new s.AnnotationStorage,enableScripting:e.enableScripting,hasJSActions:e.hasJSActions,fieldObjects:e.fieldObjects,mouseState:e.mouseState||{isDown:!1}});if(t.isRenderable){const e=t.render();if(n.hidden&&(e.style.visibility="hidden"),Array.isArray(e))for(const t of e)o.appendChild(t);else t instanceof S?o.prepend(e):o.appendChild(e)}}this.#l(o,e.annotationCanvasMap)}static update(e){const{page:t,viewport:n,annotations:i,annotationCanvasMap:s,div:o}=e,a=n.transform,l=`matrix(${a.join(",")})`;let c,d;for(const e of i){const n=o.querySelectorAll(`[data-annotation-id="${e.id}"]`);if(n)for(const i of n)if(e.hasOwnCanvas){const n=r.Util.normalizeRect([e.rect[0],t.view[3]-e.rect[1]+t.view[1],e.rect[2],t.view[3]-e.rect[3]+t.view[1]]);if(!d){c=Math.abs(a[0]||a[1]);const e=a.slice();for(let t=0;t<4;t++)e[t]=Math.sign(e[t]);d=`matrix(${e.join(",")})`}const s=n[0]*c,o=n[1]*c;i.style.left=`${s}px`,i.style.top=`${o}px`,i.style.transformOrigin=`${-s}px ${-o}px`,i.style.transform=d}else i.style.transform=l}this.#l(o,s),o.hidden=!1}static#l(e,t){if(t){for(const[n,r]of t){const t=e.querySelector(`[data-annotation-id="${n}"]`);if(!t)continue;const{firstChild:i}=t;"CANVAS"===i.nodeName?t.replaceChild(r,i):t.insertBefore(r,i)}t.clear()}}}},(e,t)=>{function n(e){return Math.floor(255*Math.max(0,Math.min(1,e))).toString(16).padStart(2,"0")}Object.defineProperty(t,"__esModule",{value:!0}),t.ColorConverters=void 0,t.ColorConverters=class{static CMYK_G([e,t,n,r]){return["G",1-Math.min(1,.3*e+.59*n+.11*t+r)]}static G_CMYK([e]){return["CMYK",0,0,0,1-e]}static G_RGB([e]){return["RGB",e,e,e]}static G_HTML([e]){const t=n(e);return`#${t}${t}${t}`}static RGB_G([e,t,n]){return["G",.3*e+.59*t+.11*n]}static RGB_HTML([e,t,r]){return`#${n(e)}${n(t)}${n(r)}`}static T_HTML(){return"#00000000"}static CMYK_RGB([e,t,n,r]){return["RGB",1-Math.min(1,e+r),1-Math.min(1,n+r),1-Math.min(1,t+r)]}static CMYK_HTML(e){return this.RGB_HTML(this.CMYK_RGB(e))}static RGB_CMYK([e,t,n]){const r=1-e,i=1-t,s=1-n;return["CMYK",r,i,s,Math.min(r,i,s)]}}},(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.XfaLayer=void 0;var r=n(1),i=n(17);t.XfaLayer=class{static setupStorage(e,t,n,r,i){const s=r.getValue(t,{value:null});switch(n.name){case"textarea":if(null!==s.value&&(e.textContent=s.value),"print"===i)break;e.addEventListener("input",(e=>{r.setValue(t,{value:e.target.value})}));break;case"input":if("radio"===n.attributes.type||"checkbox"===n.attributes.type){if(s.value===n.attributes.xfaOn?e.setAttribute("checked",!0):s.value===n.attributes.xfaOff&&e.removeAttribute("checked"),"print"===i)break;e.addEventListener("change",(e=>{r.setValue(t,{value:e.target.checked?e.target.getAttribute("xfaOn"):e.target.getAttribute("xfaOff")})}))}else{if(null!==s.value&&e.setAttribute("value",s.value),"print"===i)break;e.addEventListener("input",(e=>{r.setValue(t,{value:e.target.value})}))}break;case"select":if(null!==s.value)for(const e of n.children)e.attributes.value===s.value&&(e.attributes.selected=!0);e.addEventListener("input",(e=>{const n=e.target.options,i=-1===n.selectedIndex?"":n[n.selectedIndex].value;r.setValue(t,{value:i})}))}}static setAttributes({html:e,element:t,storage:n=null,intent:i,linkService:s}){const{attributes:o}=t,a=e instanceof HTMLAnchorElement;"radio"===o.type&&(o.name=`${o.name}-${i}`);for(const[t,n]of Object.entries(o))if(null!=n&&"dataId"!==t)if("style"!==t)if("textContent"===t)e.textContent=n;else if("class"===t)n.length&&e.setAttribute(t,n.join(" "));else{if(a&&("href"===t||"newWindow"===t))continue;e.setAttribute(t,n)}else Object.assign(e.style,n);a&&(s.addLinkAttributes||(0,r.warn)("XfaLayer.setAttribute - missing `addLinkAttributes`-method on the `linkService`-instance."),s.addLinkAttributes?.(e,o.href,o.newWindow)),n&&o.dataId&&this.setupStorage(e,o.dataId,t,n)}static render(e){const t=e.annotationStorage,n=e.linkService,r=e.xfaHtml,s=e.intent||"display",o=document.createElement(r.name);r.attributes&&this.setAttributes({html:o,element:r,intent:s,linkService:n});const a=[[r,-1,o]],l=e.div;if(l.appendChild(o),e.viewport){const t=`matrix(${e.viewport.transform.join(",")})`;l.style.transform=t}"richText"!==s&&l.setAttribute("class","xfaLayer xfaFont");const c=[];for(;a.length>0;){const[e,r,o]=a[a.length-1];if(r+1===e.children.length){a.pop();continue}const l=e.children[++a[a.length-1][1]];if(null===l)continue;const{name:d}=l;if("#text"===d){const e=document.createTextNode(l.value);c.push(e),o.appendChild(e);continue}let u;if(u=l?.attributes?.xmlns?document.createElementNS(l.attributes.xmlns,d):document.createElement(d),o.appendChild(u),l.attributes&&this.setAttributes({html:u,element:l,storage:t,intent:s,linkService:n}),l.children&&l.children.length>0)a.push([l,-1,u]);else if(l.value){const e=document.createTextNode(l.value);i.XfaText.shouldBuildText(d)&&c.push(e),u.appendChild(e)}}for(const e of l.querySelectorAll(".xfaNonInteractive input, .xfaNonInteractive textarea"))e.setAttribute("readOnly",!0);return{textDivs:c}}static update(e){const t=`matrix(${e.viewport.transform.join(",")})`;e.div.style.transform=t,e.div.hidden=!1}}},(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.renderTextLayer=function(e){const t=new u({textContent:e.textContent,textContentStream:e.textContentStream,container:e.container,viewport:e.viewport,textDivs:e.textDivs,textContentItemsStr:e.textContentItemsStr,enhanceTextSelection:e.enhanceTextSelection});return t._render(e.timeout),t};var r=n(1);const i=30,s=new Map,o=/^\s+$/g;function a(e,t,n,a){const l=document.createElement("span"),c=e._enhanceTextSelection?{angle:0,canvasWidth:0,hasText:""!==t.str,hasEOL:t.hasEOL,originalTransform:null,paddingBottom:0,paddingLeft:0,paddingRight:0,paddingTop:0,scale:1}:{angle:0,canvasWidth:0,hasText:""!==t.str,hasEOL:t.hasEOL};e._textDivs.push(l);const d=r.Util.transform(e._viewport.transform,t.transform);let u=Math.atan2(d[1],d[0]);const h=n[t.fontName];h.vertical&&(u+=Math.PI/2);const p=Math.hypot(d[2],d[3]),m=p*function(e,t){const n=s.get(e);if(n)return n;t.save(),t.font=`30px ${e}`;const r=t.measureText("");let o=r.fontBoundingBoxAscent,a=Math.abs(r.fontBoundingBoxDescent);if(o){t.restore();const n=o/(o+a);return s.set(e,n),n}t.strokeStyle="red",t.clearRect(0,0,i,i),t.strokeText("g",0,0);let l=t.getImageData(0,0,i,i).data;a=0;for(let e=l.length-1-3;e>=0;e-=4)if(l[e]>0){a=Math.ceil(e/4/i);break}t.clearRect(0,0,i,i),t.strokeText("A",0,i),l=t.getImageData(0,0,i,i).data,o=0;for(let e=0,t=l.length;e<t;e+=4)if(l[e]>0){o=i-Math.floor(e/4/i);break}if(t.restore(),o){const t=o/(o+a);return s.set(e,t),t}return s.set(e,.8),.8}(h.fontFamily,a);let g,f;0===u?(g=d[4],f=d[5]-m):(g=d[4]+m*Math.sin(u),f=d[5]-m*Math.cos(u)),l.style.left=`${g}px`,l.style.top=`${f}px`,l.style.fontSize=`${p}px`,l.style.fontFamily=h.fontFamily,l.setAttribute("role","presentation"),l.textContent=t.str,l.dir=t.dir,e._fontInspectorEnabled&&(l.dataset.fontName=t.fontName),0!==u&&(c.angle=u*(180/Math.PI));let y=!1;if(t.str.length>1||e._enhanceTextSelection&&o.test(t.str))y=!0;else if(" "!==t.str&&t.transform[0]!==t.transform[3]){const e=Math.abs(t.transform[0]),n=Math.abs(t.transform[3]);e!==n&&Math.max(e,n)/Math.min(e,n)>1.5&&(y=!0)}if(y&&(h.vertical?c.canvasWidth=t.height*e._viewport.scale:c.canvasWidth=t.width*e._viewport.scale),e._textDivProperties.set(l,c),e._textContentStream&&e._layoutText(l),e._enhanceTextSelection&&c.hasText){let n=1,i=0;0!==u&&(n=Math.cos(u),i=Math.sin(u));const s=(h.vertical?t.height:t.width)*e._viewport.scale,o=p;let a,c;0!==u?(a=[n,i,-i,n,g,f],c=r.Util.getAxialAlignedBoundingBox([0,0,s,o],a)):c=[g,f,g+s,f+o],e._bounds.push({left:c[0],top:c[1],right:c[2],bottom:c[3],div:l,size:[s,o],m:a})}}function l(e){if(e._canceled)return;const t=e._textDivs,n=e._capability,r=t.length;if(r>1e5)return e._renderingDone=!0,void n.resolve();if(!e._textContentStream)for(let n=0;n<r;n++)e._layoutText(t[n]);e._renderingDone=!0,n.resolve()}function c(e,t,n){let r=0;for(let i=0;i<n;i++){const n=e[t++];n>0&&(r=r?Math.min(n,r):n)}return r}function d(e,t){t.sort((function(e,t){return e.x1-t.x1||e.index-t.index}));const n=[{start:-1/0,end:1/0,boundary:{x1:-1/0,y1:-1/0,x2:0,y2:1/0,index:-1,x1New:0,x2New:0}}];for(const e of t){let t=0;for(;t<n.length&&n[t].end<=e.y1;)t++;let r,i,s=n.length-1;for(;s>=0&&n[s].start>=e.y2;)s--;let o,a,l=-1/0;for(o=t;o<=s;o++){let t;r=n[o],i=r.boundary,t=i.x2>e.x1?i.index>e.index?i.x1New:e.x1:void 0===i.x2New?(i.x2+e.x1)/2:i.x2New,t>l&&(l=t)}for(e.x1New=l,o=t;o<=s;o++)r=n[o],i=r.boundary,void 0===i.x2New?i.x2>e.x1?i.index>e.index&&(i.x2New=i.x2):i.x2New=l:i.x2New>l&&(i.x2New=Math.max(l,i.x2));const c=[];let d=null;for(o=t;o<=s;o++){r=n[o],i=r.boundary;const t=i.x2>e.x2?i:e;d===t?c[c.length-1].end=r.end:(c.push({start:r.start,end:r.end,boundary:t}),d=t)}for(n[t].start<e.y1&&(c[0].start=e.y1,c.unshift({start:n[t].start,end:e.y1,boundary:n[t].boundary})),e.y2<n[s].end&&(c[c.length-1].end=e.y2,c.push({start:e.y2,end:n[s].end,boundary:n[s].boundary})),o=t;o<=s;o++){if(r=n[o],i=r.boundary,void 0!==i.x2New)continue;let e=!1;for(a=t-1;!e&&a>=0&&n[a].start>=i.y1;a--)e=n[a].boundary===i;for(a=s+1;!e&&a<n.length&&n[a].end<=i.y2;a++)e=n[a].boundary===i;for(a=0;!e&&a<c.length;a++)e=c[a].boundary===i;e||(i.x2New=l)}Array.prototype.splice.apply(n,[t,s-t+1].concat(c))}for(const t of n){const n=t.boundary;void 0===n.x2New&&(n.x2New=Math.max(e,n.x2))}}class u{constructor({textContent:e,textContentStream:t,container:n,viewport:i,textDivs:s,textContentItemsStr:o,enhanceTextSelection:a}){this._textContent=e,this._textContentStream=t,this._container=n,this._document=n.ownerDocument,this._viewport=i,this._textDivs=s||[],this._textContentItemsStr=o||[],this._enhanceTextSelection=!!a,this._fontInspectorEnabled=!!globalThis.FontInspector?.enabled,this._reader=null,this._layoutTextLastFontSize=null,this._layoutTextLastFontFamily=null,this._layoutTextCtx=null,this._textDivProperties=new WeakMap,this._renderingDone=!1,this._canceled=!1,this._capability=(0,r.createPromiseCapability)(),this._renderTimer=null,this._bounds=[],this._capability.promise.finally((()=>{this._enhanceTextSelection||(this._textDivProperties=null),this._layoutTextCtx&&(this._layoutTextCtx.canvas.width=0,this._layoutTextCtx.canvas.height=0,this._layoutTextCtx=null)})).catch((()=>{}))}get promise(){return this._capability.promise}cancel(){this._canceled=!0,this._reader&&(this._reader.cancel(new r.AbortException("TextLayer task cancelled.")).catch((()=>{})),this._reader=null),null!==this._renderTimer&&(clearTimeout(this._renderTimer),this._renderTimer=null),this._capability.reject(new Error("TextLayer task cancelled."))}_processItems(e,t){for(let n=0,r=e.length;n<r;n++)if(void 0!==e[n].str)this._textContentItemsStr.push(e[n].str),a(this,e[n],t,this._layoutTextCtx);else if("beginMarkedContentProps"===e[n].type||"beginMarkedContent"===e[n].type){const t=this._container;this._container=document.createElement("span"),this._container.classList.add("markedContent"),null!==e[n].id&&this._container.setAttribute("id",`${e[n].id}`),t.appendChild(this._container)}else"endMarkedContent"===e[n].type&&(this._container=this._container.parentNode)}_layoutText(e){const t=this._textDivProperties.get(e);let n="";if(0!==t.canvasWidth&&t.hasText){const{fontSize:r,fontFamily:i}=e.style;r===this._layoutTextLastFontSize&&i===this._layoutTextLastFontFamily||(this._layoutTextCtx.font=`${r} ${i}`,this._layoutTextLastFontSize=r,this._layoutTextLastFontFamily=i);const{width:s}=this._layoutTextCtx.measureText(e.textContent);if(s>0){const e=t.canvasWidth/s;this._enhanceTextSelection&&(t.scale=e),n=`scaleX(${e})`}}if(0!==t.angle&&(n=`rotate(${t.angle}deg) ${n}`),n.length>0&&(this._enhanceTextSelection&&(t.originalTransform=n),e.style.transform=n),t.hasText&&this._container.appendChild(e),t.hasEOL){const e=document.createElement("br");e.setAttribute("role","presentation"),this._container.appendChild(e)}}_render(e=0){const t=(0,r.createPromiseCapability)();let n=Object.create(null);const s=this._document.createElement("canvas");if(s.height=s.width=i,s.mozOpaque=!0,this._layoutTextCtx=s.getContext("2d",{alpha:!1}),this._textContent){const e=this._textContent.items,n=this._textContent.styles;this._processItems(e,n),t.resolve()}else{if(!this._textContentStream)throw new Error('Neither "textContent" nor "textContentStream" parameters specified.');{const e=()=>{this._reader.read().then((({value:r,done:i})=>{i?t.resolve():(Object.assign(n,r.styles),this._processItems(r.items,n),e())}),t.reject)};this._reader=this._textContentStream.getReader(),e()}}t.promise.then((()=>{n=null,e?this._renderTimer=setTimeout((()=>{l(this),this._renderTimer=null}),e):l(this)}),this._capability.reject)}expandTextDivs(e=!1){if(!this._enhanceTextSelection||!this._renderingDone)return;null!==this._bounds&&(function(e){const t=e._bounds,n=e._viewport,i=function(e,t,n){const r=n.map((function(e,t){return{x1:e.left,y1:e.top,x2:e.right,y2:e.bottom,index:t,x1New:void 0,x2New:void 0}}));d(e,r);const i=new Array(n.length);for(const e of r){const t=e.index;i[t]={left:e.x1New,top:0,right:e.x2New,bottom:0}}n.map((function(t,n){const s=i[n],o=r[n];o.x1=t.top,o.y1=e-s.right,o.x2=t.bottom,o.y2=e-s.left,o.index=n,o.x1New=void 0,o.x2New=void 0})),d(t,r);for(const e of r){const t=e.index;i[t].top=e.x1New,i[t].bottom=e.x2New}return i}(n.width,n.height,t);for(let n=0;n<i.length;n++){const s=t[n].div,o=e._textDivProperties.get(s);if(0===o.angle){o.paddingLeft=t[n].left-i[n].left,o.paddingTop=t[n].top-i[n].top,o.paddingRight=i[n].right-t[n].right,o.paddingBottom=i[n].bottom-t[n].bottom,e._textDivProperties.set(s,o);continue}const a=i[n],l=t[n],d=l.m,u=d[0],h=d[1],p=[[0,0],[0,l.size[1]],[l.size[0],0],l.size],m=new Float64Array(64);for(let e=0,t=p.length;e<t;e++){const t=r.Util.applyTransform(p[e],d);m[e+0]=u&&(a.left-t[0])/u,m[e+4]=h&&(a.top-t[1])/h,m[e+8]=u&&(a.right-t[0])/u,m[e+12]=h&&(a.bottom-t[1])/h,m[e+16]=h&&(a.left-t[0])/-h,m[e+20]=u&&(a.top-t[1])/u,m[e+24]=h&&(a.right-t[0])/-h,m[e+28]=u&&(a.bottom-t[1])/u,m[e+32]=u&&(a.left-t[0])/-u,m[e+36]=h&&(a.top-t[1])/-h,m[e+40]=u&&(a.right-t[0])/-u,m[e+44]=h&&(a.bottom-t[1])/-h,m[e+48]=h&&(a.left-t[0])/h,m[e+52]=u&&(a.top-t[1])/-u,m[e+56]=h&&(a.right-t[0])/h,m[e+60]=u&&(a.bottom-t[1])/-u}const g=1+Math.min(Math.abs(u),Math.abs(h));o.paddingLeft=c(m,32,16)/g,o.paddingTop=c(m,48,16)/g,o.paddingRight=c(m,0,16)/g,o.paddingBottom=c(m,16,16)/g,e._textDivProperties.set(s,o)}}(this),this._bounds=null);const t=[],n=[];for(let r=0,i=this._textDivs.length;r<i;r++){const i=this._textDivs[r],s=this._textDivProperties.get(i);s.hasText&&(e?(t.length=0,n.length=0,s.originalTransform&&t.push(s.originalTransform),s.paddingTop>0?(n.push(`${s.paddingTop}px`),t.push(`translateY(${-s.paddingTop}px)`)):n.push(0),s.paddingRight>0?n.push(s.paddingRight/s.scale+"px"):n.push(0),s.paddingBottom>0?n.push(`${s.paddingBottom}px`):n.push(0),s.paddingLeft>0?(n.push(s.paddingLeft/s.scale+"px"),t.push(`translateX(${-s.paddingLeft/s.scale}px)`)):n.push(0),i.style.padding=n.join(" "),t.length&&(i.style.transform=t.join(" "))):(i.style.padding=null,i.style.transform=s.originalTransform))}}}},(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.SVGGraphics=void 0;var r=n(1),i=n(5),s=n(3);let o=class{constructor(){(0,r.unreachable)("Not implemented: SVGGraphics")}};t.SVGGraphics=o;{const e={fontStyle:"normal",fontWeight:"normal",fillColor:"#000000"},n="http://www.w3.org/XML/1998/namespace",a="http://www.w3.org/1999/xlink",l=["butt","round","square"],c=["miter","round","bevel"],d=function(e,t="",n=!1){if(URL.createObjectURL&&"undefined"!=typeof Blob&&!n)return URL.createObjectURL(new Blob([e],{type:t}));const r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";let i=`data:${t};base64,`;for(let t=0,n=e.length;t<n;t+=3){const s=255&e[t],o=255&e[t+1],a=255&e[t+2];i+=r[s>>2]+r[(3&s)<<4|o>>4]+r[t+1<n?(15&o)<<2|a>>6:64]+r[t+2<n?63&a:64]}return i},u=function(){const e=new Uint8Array([137,80,78,71,13,10,26,10]),t=new Int32Array(256);for(let e=0;e<256;e++){let n=e;for(let e=0;e<8;e++)n=1&n?3988292384^n>>1&2147483647:n>>1&2147483647;t[e]=n}function n(e,n,r,i){let s=i;const o=n.length;r[s]=o>>24&255,r[s+1]=o>>16&255,r[s+2]=o>>8&255,r[s+3]=255&o,s+=4,r[s]=255&e.charCodeAt(0),r[s+1]=255&e.charCodeAt(1),r[s+2]=255&e.charCodeAt(2),r[s+3]=255&e.charCodeAt(3),s+=4,r.set(n,s),s+=n.length;const a=function(e,n,r){let i=-1;for(let s=n;s<r;s++){const n=255&(i^e[s]);i=i>>>8^t[n]}return-1^i}(r,i+4,s);r[s]=a>>24&255,r[s+1]=a>>16&255,r[s+2]=a>>8&255,r[s+3]=255&a}function i(e){let t=e.length;const n=65535,r=Math.ceil(t/n),i=new Uint8Array(2+t+5*r+4);let s=0;i[s++]=120,i[s++]=156;let o=0;for(;t>n;)i[s++]=0,i[s++]=255,i[s++]=255,i[s++]=0,i[s++]=0,i.set(e.subarray(o,o+n),s),s+=n,o+=n,t-=n;i[s++]=1,i[s++]=255&t,i[s++]=t>>8&255,i[s++]=255&~t,i[s++]=(65535&~t)>>8&255,i.set(e.subarray(o),s),s+=e.length-o;const a=function(e,t,n){let r=1,i=0;for(let t=0;t<n;++t)r=(r+(255&e[t]))%65521,i=(i+r)%65521;return i<<16|r}(e,0,e.length);return i[s++]=a>>24&255,i[s++]=a>>16&255,i[s++]=a>>8&255,i[s++]=255&a,i}return function(t,o,a){return function(t,o,a,l){const c=t.width,u=t.height;let h,p,m;const g=t.data;switch(o){case r.ImageKind.GRAYSCALE_1BPP:p=0,h=1,m=c+7>>3;break;case r.ImageKind.RGB_24BPP:p=2,h=8,m=3*c;break;case r.ImageKind.RGBA_32BPP:p=6,h=8,m=4*c;break;default:throw new Error("invalid format")}const f=new Uint8Array((1+m)*u);let y=0,v=0;for(let e=0;e<u;++e)f[y++]=0,f.set(g.subarray(v,v+m),y),v+=m,y+=m;if(o===r.ImageKind.GRAYSCALE_1BPP&&l){y=0;for(let e=0;e<u;e++){y++;for(let e=0;e<m;e++)f[y++]^=255}}const b=new Uint8Array([c>>24&255,c>>16&255,c>>8&255,255&c,u>>24&255,u>>16&255,u>>8&255,255&u,h,p,0,0,0]),w=function(e){if(!s.isNodeJS)return i(e);try{let t;t=parseInt(process.versions.node)>=8?e:Buffer.from(e);const n=__webpack_require__(2258).deflateSync(t,{level:9});return n instanceof Uint8Array?n:new Uint8Array(n)}catch(e){(0,r.warn)("Not compressing PNG because zlib.deflateSync is unavailable: "+e)}return i(e)}(f),S=e.length+36+b.length+w.length,_=new Uint8Array(S);let k=0;return _.set(e,k),k+=e.length,n("IHDR",b,_,k),k+=12+b.length,n("IDATA",w,_,k),k+=12+w.length,n("IEND",new Uint8Array(0),_,k),d(_,"image/png",a)}(t,void 0===t.kind?r.ImageKind.GRAYSCALE_1BPP:t.kind,o,a)}}();class h{constructor(){this.fontSizeScale=1,this.fontWeight=e.fontWeight,this.fontSize=0,this.textMatrix=r.IDENTITY_MATRIX,this.fontMatrix=r.FONT_IDENTITY_MATRIX,this.leading=0,this.textRenderingMode=r.TextRenderingMode.FILL,this.textMatrixScale=1,this.x=0,this.y=0,this.lineX=0,this.lineY=0,this.charSpacing=0,this.wordSpacing=0,this.textHScale=1,this.textRise=0,this.fillColor=e.fillColor,this.strokeColor="#000000",this.fillAlpha=1,this.strokeAlpha=1,this.lineWidth=1,this.lineJoin="",this.lineCap="",this.miterLimit=0,this.dashArray=[],this.dashPhase=0,this.dependencies=[],this.activeClipUrl=null,this.clipGroup=null,this.maskId=""}clone(){return Object.create(this)}setCurrentPoint(e,t){this.x=e,this.y=t}}function p(e){let t=[];const n=[];for(const r of e)"save"!==r.fn?"restore"===r.fn?t=n.pop():t.push(r):(t.push({fnId:92,fn:"group",items:[]}),n.push(t),t=t[t.length-1].items);return t}function m(e){if(Number.isInteger(e))return e.toString();const t=e.toFixed(10);let n=t.length-1;if("0"!==t[n])return t;do{n--}while("0"===t[n]);return t.substring(0,"."===t[n]?n:n+1)}function g(e){if(0===e[4]&&0===e[5]){if(0===e[1]&&0===e[2])return 1===e[0]&&1===e[3]?"":`scale(${m(e[0])} ${m(e[3])})`;if(e[0]===e[3]&&e[1]===-e[2])return`rotate(${m(180*Math.acos(e[0])/Math.PI)})`}else if(1===e[0]&&0===e[1]&&0===e[2]&&1===e[3])return`translate(${m(e[4])} ${m(e[5])})`;return`matrix(${m(e[0])} ${m(e[1])} ${m(e[2])} ${m(e[3])} ${m(e[4])} ${m(e[5])})`}let f=0,y=0,v=0;t.SVGGraphics=o=class{constructor(e,t,n=!1){this.svgFactory=new i.DOMSVGFactory,this.current=new h,this.transformMatrix=r.IDENTITY_MATRIX,this.transformStack=[],this.extraStack=[],this.commonObjs=e,this.objs=t,this.pendingClip=null,this.pendingEOFill=!1,this.embedFonts=!1,this.embeddedFonts=Object.create(null),this.cssStyle=null,this.forceDataSchema=!!n,this._operatorIdMapping=[];for(const e in r.OPS)this._operatorIdMapping[r.OPS[e]]=e}save(){this.transformStack.push(this.transformMatrix);const e=this.current;this.extraStack.push(e),this.current=e.clone()}restore(){this.transformMatrix=this.transformStack.pop(),this.current=this.extraStack.pop(),this.pendingClip=null,this.tgrp=null}group(e){this.save(),this.executeOpTree(e),this.restore()}loadDependencies(e){const t=e.fnArray,n=e.argsArray;for(let e=0,i=t.length;e<i;e++)if(t[e]===r.OPS.dependency)for(const t of n[e]){const e=t.startsWith("g_")?this.commonObjs:this.objs,n=new Promise((n=>{e.get(t,n)}));this.current.dependencies.push(n)}return Promise.all(this.current.dependencies)}transform(e,t,n,i,s,o){const a=[e,t,n,i,s,o];this.transformMatrix=r.Util.transform(this.transformMatrix,a),this.tgrp=null}getSVG(e,t){this.viewport=t;const n=this._initialize(t);return this.loadDependencies(e).then((()=>(this.transformMatrix=r.IDENTITY_MATRIX,this.executeOpTree(this.convertOpList(e)),n)))}convertOpList(e){const t=this._operatorIdMapping,n=e.argsArray,r=e.fnArray,i=[];for(let e=0,s=r.length;e<s;e++){const s=r[e];i.push({fnId:s,fn:t[s],args:n[e]})}return p(i)}executeOpTree(e){for(const t of e){const e=t.fn,n=t.fnId,i=t.args;switch(0|n){case r.OPS.beginText:this.beginText();break;case r.OPS.dependency:break;case r.OPS.setLeading:this.setLeading(i);break;case r.OPS.setLeadingMoveText:this.setLeadingMoveText(i[0],i[1]);break;case r.OPS.setFont:this.setFont(i);break;case r.OPS.showText:case r.OPS.showSpacedText:this.showText(i[0]);break;case r.OPS.endText:this.endText();break;case r.OPS.moveText:this.moveText(i[0],i[1]);break;case r.OPS.setCharSpacing:this.setCharSpacing(i[0]);break;case r.OPS.setWordSpacing:this.setWordSpacing(i[0]);break;case r.OPS.setHScale:this.setHScale(i[0]);break;case r.OPS.setTextMatrix:this.setTextMatrix(i[0],i[1],i[2],i[3],i[4],i[5]);break;case r.OPS.setTextRise:this.setTextRise(i[0]);break;case r.OPS.setTextRenderingMode:this.setTextRenderingMode(i[0]);break;case r.OPS.setLineWidth:this.setLineWidth(i[0]);break;case r.OPS.setLineJoin:this.setLineJoin(i[0]);break;case r.OPS.setLineCap:this.setLineCap(i[0]);break;case r.OPS.setMiterLimit:this.setMiterLimit(i[0]);break;case r.OPS.setFillRGBColor:this.setFillRGBColor(i[0],i[1],i[2]);break;case r.OPS.setStrokeRGBColor:this.setStrokeRGBColor(i[0],i[1],i[2]);break;case r.OPS.setStrokeColorN:this.setStrokeColorN(i);break;case r.OPS.setFillColorN:this.setFillColorN(i);break;case r.OPS.shadingFill:this.shadingFill(i[0]);break;case r.OPS.setDash:this.setDash(i[0],i[1]);break;case r.OPS.setRenderingIntent:this.setRenderingIntent(i[0]);break;case r.OPS.setFlatness:this.setFlatness(i[0]);break;case r.OPS.setGState:this.setGState(i[0]);break;case r.OPS.fill:this.fill();break;case r.OPS.eoFill:this.eoFill();break;case r.OPS.stroke:this.stroke();break;case r.OPS.fillStroke:this.fillStroke();break;case r.OPS.eoFillStroke:this.eoFillStroke();break;case r.OPS.clip:this.clip("nonzero");break;case r.OPS.eoClip:this.clip("evenodd");break;case r.OPS.paintSolidColorImageMask:this.paintSolidColorImageMask();break;case r.OPS.paintImageXObject:this.paintImageXObject(i[0]);break;case r.OPS.paintInlineImageXObject:this.paintInlineImageXObject(i[0]);break;case r.OPS.paintImageMaskXObject:this.paintImageMaskXObject(i[0]);break;case r.OPS.paintFormXObjectBegin:this.paintFormXObjectBegin(i[0],i[1]);break;case r.OPS.paintFormXObjectEnd:this.paintFormXObjectEnd();break;case r.OPS.closePath:this.closePath();break;case r.OPS.closeStroke:this.closeStroke();break;case r.OPS.closeFillStroke:this.closeFillStroke();break;case r.OPS.closeEOFillStroke:this.closeEOFillStroke();break;case r.OPS.nextLine:this.nextLine();break;case r.OPS.transform:this.transform(i[0],i[1],i[2],i[3],i[4],i[5]);break;case r.OPS.constructPath:this.constructPath(i[0],i[1]);break;case r.OPS.endPath:this.endPath();break;case 92:this.group(t.items);break;default:(0,r.warn)(`Unimplemented operator ${e}`)}}}setWordSpacing(e){this.current.wordSpacing=e}setCharSpacing(e){this.current.charSpacing=e}nextLine(){this.moveText(0,this.current.leading)}setTextMatrix(e,t,n,r,i,s){const o=this.current;o.textMatrix=o.lineMatrix=[e,t,n,r,i,s],o.textMatrixScale=Math.hypot(e,t),o.x=o.lineX=0,o.y=o.lineY=0,o.xcoords=[],o.ycoords=[],o.tspan=this.svgFactory.createElement("svg:tspan"),o.tspan.setAttributeNS(null,"font-family",o.fontFamily),o.tspan.setAttributeNS(null,"font-size",`${m(o.fontSize)}px`),o.tspan.setAttributeNS(null,"y",m(-o.y)),o.txtElement=this.svgFactory.createElement("svg:text"),o.txtElement.appendChild(o.tspan)}beginText(){const e=this.current;e.x=e.lineX=0,e.y=e.lineY=0,e.textMatrix=r.IDENTITY_MATRIX,e.lineMatrix=r.IDENTITY_MATRIX,e.textMatrixScale=1,e.tspan=this.svgFactory.createElement("svg:tspan"),e.txtElement=this.svgFactory.createElement("svg:text"),e.txtgrp=this.svgFactory.createElement("svg:g"),e.xcoords=[],e.ycoords=[]}moveText(e,t){const n=this.current;n.x=n.lineX+=e,n.y=n.lineY+=t,n.xcoords=[],n.ycoords=[],n.tspan=this.svgFactory.createElement("svg:tspan"),n.tspan.setAttributeNS(null,"font-family",n.fontFamily),n.tspan.setAttributeNS(null,"font-size",`${m(n.fontSize)}px`),n.tspan.setAttributeNS(null,"y",m(-n.y))}showText(t){const i=this.current,s=i.font,o=i.fontSize;if(0===o)return;const a=i.fontSizeScale,l=i.charSpacing,c=i.wordSpacing,d=i.fontDirection,u=i.textHScale*d,h=s.vertical,p=h?1:-1,f=s.defaultVMetrics,y=o*i.fontMatrix[0];let v=0;for(const e of t){if(null===e){v+=d*c;continue}if("number"==typeof e){v+=p*e*o/1e3;continue}const t=(e.isSpace?c:0)+l,n=e.fontChar;let r,u,m,g=e.width;if(h){let t;const n=e.vmetric||f;t=e.vmetric?n[1]:.5*g,t=-t*y;const i=n[2]*y;g=n?-n[0]:g,r=t/a,u=(v+i)/a}else r=v/a,u=0;(e.isInFont||s.missingFile)&&(i.xcoords.push(i.x+r),h&&i.ycoords.push(-i.y+u),i.tspan.textContent+=n),m=h?g*y-t*d:g*y+t*d,v+=m}i.tspan.setAttributeNS(null,"x",i.xcoords.map(m).join(" ")),h?i.tspan.setAttributeNS(null,"y",i.ycoords.map(m).join(" ")):i.tspan.setAttributeNS(null,"y",m(-i.y)),h?i.y-=v:i.x+=v*u,i.tspan.setAttributeNS(null,"font-family",i.fontFamily),i.tspan.setAttributeNS(null,"font-size",`${m(i.fontSize)}px`),i.fontStyle!==e.fontStyle&&i.tspan.setAttributeNS(null,"font-style",i.fontStyle),i.fontWeight!==e.fontWeight&&i.tspan.setAttributeNS(null,"font-weight",i.fontWeight);const b=i.textRenderingMode&r.TextRenderingMode.FILL_STROKE_MASK;if(b===r.TextRenderingMode.FILL||b===r.TextRenderingMode.FILL_STROKE?(i.fillColor!==e.fillColor&&i.tspan.setAttributeNS(null,"fill",i.fillColor),i.fillAlpha<1&&i.tspan.setAttributeNS(null,"fill-opacity",i.fillAlpha)):i.textRenderingMode===r.TextRenderingMode.ADD_TO_PATH?i.tspan.setAttributeNS(null,"fill","transparent"):i.tspan.setAttributeNS(null,"fill","none"),b===r.TextRenderingMode.STROKE||b===r.TextRenderingMode.FILL_STROKE){const e=1/(i.textMatrixScale||1);this._setStrokeAttributes(i.tspan,e)}let w=i.textMatrix;0!==i.textRise&&(w=w.slice(),w[5]+=i.textRise),i.txtElement.setAttributeNS(null,"transform",`${g(w)} scale(${m(u)}, -1)`),i.txtElement.setAttributeNS(n,"xml:space","preserve"),i.txtElement.appendChild(i.tspan),i.txtgrp.appendChild(i.txtElement),this._ensureTransformGroup().appendChild(i.txtElement)}setLeadingMoveText(e,t){this.setLeading(-t),this.moveText(e,t)}addFontStyle(e){if(!e.data)throw new Error('addFontStyle: No font data available, ensure that the "fontExtraProperties" API parameter is set.');this.cssStyle||(this.cssStyle=this.svgFactory.createElement("svg:style"),this.cssStyle.setAttributeNS(null,"type","text/css"),this.defs.appendChild(this.cssStyle));const t=d(e.data,e.mimetype,this.forceDataSchema);this.cssStyle.textContent+=`@font-face { font-family: "${e.loadedName}"; src: url(${t}); }\n`}setFont(e){const t=this.current,n=this.commonObjs.get(e[0]);let i=e[1];t.font=n,!this.embedFonts||n.missingFile||this.embeddedFonts[n.loadedName]||(this.addFontStyle(n),this.embeddedFonts[n.loadedName]=n),t.fontMatrix=n.fontMatrix||r.FONT_IDENTITY_MATRIX;let s="normal";n.black?s="900":n.bold&&(s="bold");const o=n.italic?"italic":"normal";i<0?(i=-i,t.fontDirection=-1):t.fontDirection=1,t.fontSize=i,t.fontFamily=n.loadedName,t.fontWeight=s,t.fontStyle=o,t.tspan=this.svgFactory.createElement("svg:tspan"),t.tspan.setAttributeNS(null,"y",m(-t.y)),t.xcoords=[],t.ycoords=[]}endText(){const e=this.current;e.textRenderingMode&r.TextRenderingMode.ADD_TO_PATH_FLAG&&e.txtElement?.hasChildNodes()&&(e.element=e.txtElement,this.clip("nonzero"),this.endPath())}setLineWidth(e){e>0&&(this.current.lineWidth=e)}setLineCap(e){this.current.lineCap=l[e]}setLineJoin(e){this.current.lineJoin=c[e]}setMiterLimit(e){this.current.miterLimit=e}setStrokeAlpha(e){this.current.strokeAlpha=e}setStrokeRGBColor(e,t,n){this.current.strokeColor=r.Util.makeHexColor(e,t,n)}setFillAlpha(e){this.current.fillAlpha=e}setFillRGBColor(e,t,n){this.current.fillColor=r.Util.makeHexColor(e,t,n),this.current.tspan=this.svgFactory.createElement("svg:tspan"),this.current.xcoords=[],this.current.ycoords=[]}setStrokeColorN(e){this.current.strokeColor=this._makeColorN_Pattern(e)}setFillColorN(e){this.current.fillColor=this._makeColorN_Pattern(e)}shadingFill(e){const t=this.viewport.width,n=this.viewport.height,i=r.Util.inverseTransform(this.transformMatrix),s=r.Util.applyTransform([0,0],i),o=r.Util.applyTransform([0,n],i),a=r.Util.applyTransform([t,0],i),l=r.Util.applyTransform([t,n],i),c=Math.min(s[0],o[0],a[0],l[0]),d=Math.min(s[1],o[1],a[1],l[1]),u=Math.max(s[0],o[0],a[0],l[0]),h=Math.max(s[1],o[1],a[1],l[1]),p=this.svgFactory.createElement("svg:rect");p.setAttributeNS(null,"x",c),p.setAttributeNS(null,"y",d),p.setAttributeNS(null,"width",u-c),p.setAttributeNS(null,"height",h-d),p.setAttributeNS(null,"fill",this._makeShadingPattern(e)),this.current.fillAlpha<1&&p.setAttributeNS(null,"fill-opacity",this.current.fillAlpha),this._ensureTransformGroup().appendChild(p)}_makeColorN_Pattern(e){return"TilingPattern"===e[0]?this._makeTilingPattern(e):this._makeShadingPattern(e)}_makeTilingPattern(e){const t=e[1],n=e[2],i=e[3]||r.IDENTITY_MATRIX,[s,o,a,l]=e[4],c=e[5],d=e[6],u=e[7],h="shading"+v++,[p,m,g,f]=r.Util.normalizeRect([...r.Util.applyTransform([s,o],i),...r.Util.applyTransform([a,l],i)]),[y,b]=r.Util.singularValueDecompose2dScale(i),w=c*y,S=d*b,_=this.svgFactory.createElement("svg:pattern");_.setAttributeNS(null,"id",h),_.setAttributeNS(null,"patternUnits","userSpaceOnUse"),_.setAttributeNS(null,"width",w),_.setAttributeNS(null,"height",S),_.setAttributeNS(null,"x",`${p}`),_.setAttributeNS(null,"y",`${m}`);const k=this.svg,x=this.transformMatrix,E=this.current.fillColor,T=this.current.strokeColor,C=this.svgFactory.create(g-p,f-m);if(this.svg=C,this.transformMatrix=i,2===u){const e=r.Util.makeHexColor(...t);this.current.fillColor=e,this.current.strokeColor=e}return this.executeOpTree(this.convertOpList(n)),this.svg=k,this.transformMatrix=x,this.current.fillColor=E,this.current.strokeColor=T,_.appendChild(C.childNodes[0]),this.defs.appendChild(_),`url(#${h})`}_makeShadingPattern(e){switch("string"==typeof e&&(e=this.objs.get(e)),e[0]){case"RadialAxial":const t="shading"+v++,n=e[3];let i;switch(e[1]){case"axial":const n=e[4],r=e[5];i=this.svgFactory.createElement("svg:linearGradient"),i.setAttributeNS(null,"id",t),i.setAttributeNS(null,"gradientUnits","userSpaceOnUse"),i.setAttributeNS(null,"x1",n[0]),i.setAttributeNS(null,"y1",n[1]),i.setAttributeNS(null,"x2",r[0]),i.setAttributeNS(null,"y2",r[1]);break;case"radial":const s=e[4],o=e[5],a=e[6],l=e[7];i=this.svgFactory.createElement("svg:radialGradient"),i.setAttributeNS(null,"id",t),i.setAttributeNS(null,"gradientUnits","userSpaceOnUse"),i.setAttributeNS(null,"cx",o[0]),i.setAttributeNS(null,"cy",o[1]),i.setAttributeNS(null,"r",l),i.setAttributeNS(null,"fx",s[0]),i.setAttributeNS(null,"fy",s[1]),i.setAttributeNS(null,"fr",a);break;default:throw new Error(`Unknown RadialAxial type: ${e[1]}`)}for(const e of n){const t=this.svgFactory.createElement("svg:stop");t.setAttributeNS(null,"offset",e[0]),t.setAttributeNS(null,"stop-color",e[1]),i.appendChild(t)}return this.defs.appendChild(i),`url(#${t})`;case"Mesh":return(0,r.warn)("Unimplemented pattern Mesh"),null;case"Dummy":return"hotpink";default:throw new Error(`Unknown IR type: ${e[0]}`)}}setDash(e,t){this.current.dashArray=e,this.current.dashPhase=t}constructPath(e,t){const n=this.current;let i=n.x,s=n.y,o=[],a=0;for(const n of e)switch(0|n){case r.OPS.rectangle:i=t[a++],s=t[a++];const e=i+t[a++],n=s+t[a++];o.push("M",m(i),m(s),"L",m(e),m(s),"L",m(e),m(n),"L",m(i),m(n),"Z");break;case r.OPS.moveTo:i=t[a++],s=t[a++],o.push("M",m(i),m(s));break;case r.OPS.lineTo:i=t[a++],s=t[a++],o.push("L",m(i),m(s));break;case r.OPS.curveTo:i=t[a+4],s=t[a+5],o.push("C",m(t[a]),m(t[a+1]),m(t[a+2]),m(t[a+3]),m(i),m(s)),a+=6;break;case r.OPS.curveTo2:o.push("C",m(i),m(s),m(t[a]),m(t[a+1]),m(t[a+2]),m(t[a+3])),i=t[a+2],s=t[a+3],a+=4;break;case r.OPS.curveTo3:i=t[a+2],s=t[a+3],o.push("C",m(t[a]),m(t[a+1]),m(i),m(s),m(i),m(s)),a+=4;break;case r.OPS.closePath:o.push("Z")}o=o.join(" "),n.path&&e.length>0&&e[0]!==r.OPS.rectangle&&e[0]!==r.OPS.moveTo?o=n.path.getAttributeNS(null,"d")+o:(n.path=this.svgFactory.createElement("svg:path"),this._ensureTransformGroup().appendChild(n.path)),n.path.setAttributeNS(null,"d",o),n.path.setAttributeNS(null,"fill","none"),n.element=n.path,n.setCurrentPoint(i,s)}endPath(){const e=this.current;if(e.path=null,!this.pendingClip)return;if(!e.element)return void(this.pendingClip=null);const t="clippath"+f++,n=this.svgFactory.createElement("svg:clipPath");n.setAttributeNS(null,"id",t),n.setAttributeNS(null,"transform",g(this.transformMatrix));const r=e.element.cloneNode(!0);if("evenodd"===this.pendingClip?r.setAttributeNS(null,"clip-rule","evenodd"):r.setAttributeNS(null,"clip-rule","nonzero"),this.pendingClip=null,n.appendChild(r),this.defs.appendChild(n),e.activeClipUrl){e.clipGroup=null;for(const e of this.extraStack)e.clipGroup=null;n.setAttributeNS(null,"clip-path",e.activeClipUrl)}e.activeClipUrl=`url(#${t})`,this.tgrp=null}clip(e){this.pendingClip=e}closePath(){const e=this.current;if(e.path){const t=`${e.path.getAttributeNS(null,"d")}Z`;e.path.setAttributeNS(null,"d",t)}}setLeading(e){this.current.leading=-e}setTextRise(e){this.current.textRise=e}setTextRenderingMode(e){this.current.textRenderingMode=e}setHScale(e){this.current.textHScale=e/100}setRenderingIntent(e){}setFlatness(e){}setGState(e){for(const[t,n]of e)switch(t){case"LW":this.setLineWidth(n);break;case"LC":this.setLineCap(n);break;case"LJ":this.setLineJoin(n);break;case"ML":this.setMiterLimit(n);break;case"D":this.setDash(n[0],n[1]);break;case"RI":this.setRenderingIntent(n);break;case"FL":this.setFlatness(n);break;case"Font":this.setFont(n);break;case"CA":this.setStrokeAlpha(n);break;case"ca":this.setFillAlpha(n);break;default:(0,r.warn)(`Unimplemented graphic state operator ${t}`)}}fill(){const e=this.current;e.element&&(e.element.setAttributeNS(null,"fill",e.fillColor),e.element.setAttributeNS(null,"fill-opacity",e.fillAlpha),this.endPath())}stroke(){const e=this.current;e.element&&(this._setStrokeAttributes(e.element),e.element.setAttributeNS(null,"fill","none"),this.endPath())}_setStrokeAttributes(e,t=1){const n=this.current;let r=n.dashArray;1!==t&&r.length>0&&(r=r.map((function(e){return t*e}))),e.setAttributeNS(null,"stroke",n.strokeColor),e.setAttributeNS(null,"stroke-opacity",n.strokeAlpha),e.setAttributeNS(null,"stroke-miterlimit",m(n.miterLimit)),e.setAttributeNS(null,"stroke-linecap",n.lineCap),e.setAttributeNS(null,"stroke-linejoin",n.lineJoin),e.setAttributeNS(null,"stroke-width",m(t*n.lineWidth)+"px"),e.setAttributeNS(null,"stroke-dasharray",r.map(m).join(" ")),e.setAttributeNS(null,"stroke-dashoffset",m(t*n.dashPhase)+"px")}eoFill(){this.current.element&&this.current.element.setAttributeNS(null,"fill-rule","evenodd"),this.fill()}fillStroke(){this.stroke(),this.fill()}eoFillStroke(){this.current.element&&this.current.element.setAttributeNS(null,"fill-rule","evenodd"),this.fillStroke()}closeStroke(){this.closePath(),this.stroke()}closeFillStroke(){this.closePath(),this.fillStroke()}closeEOFillStroke(){this.closePath(),this.eoFillStroke()}paintSolidColorImageMask(){const e=this.svgFactory.createElement("svg:rect");e.setAttributeNS(null,"x","0"),e.setAttributeNS(null,"y","0"),e.setAttributeNS(null,"width","1px"),e.setAttributeNS(null,"height","1px"),e.setAttributeNS(null,"fill",this.current.fillColor),this._ensureTransformGroup().appendChild(e)}paintImageXObject(e){const t=e.startsWith("g_")?this.commonObjs.get(e):this.objs.get(e);t?this.paintInlineImageXObject(t):(0,r.warn)(`Dependent image with object ID ${e} is not ready yet`)}paintInlineImageXObject(e,t){const n=e.width,r=e.height,i=u(e,this.forceDataSchema,!!t),s=this.svgFactory.createElement("svg:rect");s.setAttributeNS(null,"x","0"),s.setAttributeNS(null,"y","0"),s.setAttributeNS(null,"width",m(n)),s.setAttributeNS(null,"height",m(r)),this.current.element=s,this.clip("nonzero");const o=this.svgFactory.createElement("svg:image");o.setAttributeNS(a,"xlink:href",i),o.setAttributeNS(null,"x","0"),o.setAttributeNS(null,"y",m(-r)),o.setAttributeNS(null,"width",m(n)+"px"),o.setAttributeNS(null,"height",m(r)+"px"),o.setAttributeNS(null,"transform",`scale(${m(1/n)} ${m(-1/r)})`),t?t.appendChild(o):this._ensureTransformGroup().appendChild(o)}paintImageMaskXObject(e){const t=this.current,n=e.width,r=e.height,i=t.fillColor;t.maskId="mask"+y++;const s=this.svgFactory.createElement("svg:mask");s.setAttributeNS(null,"id",t.maskId);const o=this.svgFactory.createElement("svg:rect");o.setAttributeNS(null,"x","0"),o.setAttributeNS(null,"y","0"),o.setAttributeNS(null,"width",m(n)),o.setAttributeNS(null,"height",m(r)),o.setAttributeNS(null,"fill",i),o.setAttributeNS(null,"mask",`url(#${t.maskId})`),this.defs.appendChild(s),this._ensureTransformGroup().appendChild(o),this.paintInlineImageXObject(e,s)}paintFormXObjectBegin(e,t){if(Array.isArray(e)&&6===e.length&&this.transform(e[0],e[1],e[2],e[3],e[4],e[5]),t){const e=t[2]-t[0],n=t[3]-t[1],r=this.svgFactory.createElement("svg:rect");r.setAttributeNS(null,"x",t[0]),r.setAttributeNS(null,"y",t[1]),r.setAttributeNS(null,"width",m(e)),r.setAttributeNS(null,"height",m(n)),this.current.element=r,this.clip("nonzero"),this.endPath()}}paintFormXObjectEnd(){}_initialize(e){const t=this.svgFactory.create(e.width,e.height),n=this.svgFactory.createElement("svg:defs");t.appendChild(n),this.defs=n;const r=this.svgFactory.createElement("svg:g");return r.setAttributeNS(null,"transform",g(e.transform)),t.appendChild(r),this.svg=r,t}_ensureClipGroup(){if(!this.current.clipGroup){const e=this.svgFactory.createElement("svg:g");e.setAttributeNS(null,"clip-path",this.current.activeClipUrl),this.svg.appendChild(e),this.current.clipGroup=e}return this.current.clipGroup}_ensureTransformGroup(){return this.tgrp||(this.tgrp=this.svgFactory.createElement("svg:g"),this.tgrp.setAttributeNS(null,"transform",g(this.transformMatrix)),this.current.activeClipUrl?this._ensureClipGroup().appendChild(this.tgrp):this.svg.appendChild(this.tgrp)),this.tgrp}}}},(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.PDFNodeStream=void 0;var r=n(1),i=n(24);const s=__webpack_require__(172),o=__webpack_require__(2001),a=__webpack_require__(3779),l=__webpack_require__(6558),c=/^file:\/\/\/[a-zA-Z]:\//;t.PDFNodeStream=class{constructor(e){this.source=e,this.url=function(e){const t=l.parse(e);return"file:"===t.protocol||t.host?t:/^[a-z]:[/\\]/i.test(e)?l.parse(`file:///${e}`):(t.host||(t.protocol="file:"),t)}(e.url),this.isHttp="http:"===this.url.protocol||"https:"===this.url.protocol,this.isFsUrl="file:"===this.url.protocol,this.httpHeaders=this.isHttp&&e.httpHeaders||{},this._fullRequestReader=null,this._rangeRequestReaders=[]}get _progressiveDataLength(){return this._fullRequestReader?._loaded??0}getFullReader(){return(0,r.assert)(!this._fullRequestReader,"PDFNodeStream.getFullReader can only be called once."),this._fullRequestReader=this.isFsUrl?new g(this):new p(this),this._fullRequestReader}getRangeReader(e,t){if(t<=this._progressiveDataLength)return null;const n=this.isFsUrl?new f(this,e,t):new m(this,e,t);return this._rangeRequestReaders.push(n),n}cancelAllRequests(e){this._fullRequestReader&&this._fullRequestReader.cancel(e);for(const t of this._rangeRequestReaders.slice(0))t.cancel(e)}};class d{constructor(e){this._url=e.url,this._done=!1,this._storedError=null,this.onProgress=null;const t=e.source;this._contentLength=t.length,this._loaded=0,this._filename=null,this._disableRange=t.disableRange||!1,this._rangeChunkSize=t.rangeChunkSize,this._rangeChunkSize||this._disableRange||(this._disableRange=!0),this._isStreamingSupported=!t.disableStream,this._isRangeSupported=!t.disableRange,this._readableStream=null,this._readCapability=(0,r.createPromiseCapability)(),this._headersCapability=(0,r.createPromiseCapability)()}get headersReady(){return this._headersCapability.promise}get filename(){return this._filename}get contentLength(){return this._contentLength}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}async read(){if(await this._readCapability.promise,this._done)return{value:void 0,done:!0};if(this._storedError)throw this._storedError;const e=this._readableStream.read();return null===e?(this._readCapability=(0,r.createPromiseCapability)(),this.read()):(this._loaded+=e.length,this.onProgress&&this.onProgress({loaded:this._loaded,total:this._contentLength}),{value:new Uint8Array(e).buffer,done:!1})}cancel(e){this._readableStream?this._readableStream.destroy(e):this._error(e)}_error(e){this._storedError=e,this._readCapability.resolve()}_setReadableStream(e){this._readableStream=e,e.on("readable",(()=>{this._readCapability.resolve()})),e.on("end",(()=>{e.destroy(),this._done=!0,this._readCapability.resolve()})),e.on("error",(e=>{this._error(e)})),!this._isStreamingSupported&&this._isRangeSupported&&this._error(new r.AbortException("streaming is disabled")),this._storedError&&this._readableStream.destroy(this._storedError)}}class u{constructor(e){this._url=e.url,this._done=!1,this._storedError=null,this.onProgress=null,this._loaded=0,this._readableStream=null,this._readCapability=(0,r.createPromiseCapability)();const t=e.source;this._isStreamingSupported=!t.disableStream}get isStreamingSupported(){return this._isStreamingSupported}async read(){if(await this._readCapability.promise,this._done)return{value:void 0,done:!0};if(this._storedError)throw this._storedError;const e=this._readableStream.read();return null===e?(this._readCapability=(0,r.createPromiseCapability)(),this.read()):(this._loaded+=e.length,this.onProgress&&this.onProgress({loaded:this._loaded}),{value:new Uint8Array(e).buffer,done:!1})}cancel(e){this._readableStream?this._readableStream.destroy(e):this._error(e)}_error(e){this._storedError=e,this._readCapability.resolve()}_setReadableStream(e){this._readableStream=e,e.on("readable",(()=>{this._readCapability.resolve()})),e.on("end",(()=>{e.destroy(),this._done=!0,this._readCapability.resolve()})),e.on("error",(e=>{this._error(e)})),this._storedError&&this._readableStream.destroy(this._storedError)}}function h(e,t){return{protocol:e.protocol,auth:e.auth,host:e.hostname,port:e.port,path:e.path,method:"GET",headers:t}}class p extends d{constructor(e){super(e);const t=t=>{if(404===t.statusCode){const e=new r.MissingPDFException(`Missing PDF "${this._url}".`);return this._storedError=e,void this._headersCapability.reject(e)}this._headersCapability.resolve(),this._setReadableStream(t);const n=e=>this._readableStream.headers[e.toLowerCase()],{allowRangeRequests:s,suggestedLength:o}=(0,i.validateRangeRequestCapabilities)({getResponseHeader:n,isHttp:e.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange});this._isRangeSupported=s,this._contentLength=o||this._contentLength,this._filename=(0,i.extractFilenameFromHeader)(n)};this._request=null,"http:"===this._url.protocol?this._request=o.request(h(this._url,e.httpHeaders),t):this._request=a.request(h(this._url,e.httpHeaders),t),this._request.on("error",(e=>{this._storedError=e,this._headersCapability.reject(e)})),this._request.end()}}class m extends u{constructor(e,t,n){super(e),this._httpHeaders={};for(const t in e.httpHeaders){const n=e.httpHeaders[t];void 0!==n&&(this._httpHeaders[t]=n)}this._httpHeaders.Range=`bytes=${t}-${n-1}`;const i=e=>{if(404!==e.statusCode)this._setReadableStream(e);else{const e=new r.MissingPDFException(`Missing PDF "${this._url}".`);this._storedError=e}};this._request=null,"http:"===this._url.protocol?this._request=o.request(h(this._url,this._httpHeaders),i):this._request=a.request(h(this._url,this._httpHeaders),i),this._request.on("error",(e=>{this._storedError=e})),this._request.end()}}class g extends d{constructor(e){super(e);let t=decodeURIComponent(this._url.path);c.test(this._url.href)&&(t=t.replace(/^\//,"")),s.lstat(t,((e,n)=>{if(e)return"ENOENT"===e.code&&(e=new r.MissingPDFException(`Missing PDF "${t}".`)),this._storedError=e,void this._headersCapability.reject(e);this._contentLength=n.size,this._setReadableStream(s.createReadStream(t)),this._headersCapability.resolve()}))}}class f extends u{constructor(e,t,n){super(e);let r=decodeURIComponent(this._url.path);c.test(this._url.href)&&(r=r.replace(/^\//,"")),this._setReadableStream(s.createReadStream(r,{start:t,end:n-1}))}}},(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.createResponseStatusError=function(e,t){return 404===e||0===e&&t.startsWith("file:")?new r.MissingPDFException('Missing PDF "'+t+'".'):new r.UnexpectedResponseException(`Unexpected server response (${e}) while retrieving PDF "${t}".`,e)},t.extractFilenameFromHeader=function(e){const t=e("Content-Disposition");if(t){let e=(0,i.getFilenameFromContentDispositionHeader)(t);if(e.includes("%"))try{e=decodeURIComponent(e)}catch(e){}if((0,s.isPdfFile)(e))return e}return null},t.validateRangeRequestCapabilities=function({getResponseHeader:e,isHttp:t,rangeChunkSize:n,disableRange:i}){(0,r.assert)(n>0,"Range chunk size must be larger than zero");const s={allowRangeRequests:!1,suggestedLength:void 0},o=parseInt(e("Content-Length"),10);return Number.isInteger(o)?(s.suggestedLength=o,o<=2*n||i||!t||"bytes"!==e("Accept-Ranges")||"identity"!==(e("Content-Encoding")||"identity")||(s.allowRangeRequests=!0),s):s},t.validateResponseStatus=function(e){return 200===e||206===e};var r=n(1),i=n(25),s=n(5)},(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.getFilenameFromContentDispositionHeader=function(e){let t=!0,n=i("filename\\*","i").exec(e);if(n){n=n[1];let e=a(n);return e=unescape(e),e=l(e),e=c(e),o(e)}if(n=function(e){const t=[];let n;const r=i("filename\\*((?!0\\d)\\d+)(\\*?)","ig");for(;null!==(n=r.exec(e));){let[,e,r,i]=n;if(e=parseInt(e,10),e in t){if(0===e)break}else t[e]=[r,i]}const s=[];for(let e=0;e<t.length&&e in t;++e){let[n,r]=t[e];r=a(r),n&&(r=unescape(r),0===e&&(r=l(r))),s.push(r)}return s.join("")}(e),n)return o(c(n));if(n=i("filename","i").exec(e),n){n=n[1];let e=a(n);return e=c(e),o(e)}function i(e,t){return new RegExp("(?:^|;)\\s*"+e+'\\s*=\\s*([^";\\s][^;\\s]*|"(?:[^"\\\\]|\\\\"?)+"?)',t)}function s(e,n){if(e){if(!/^[\x00-\xFF]+$/.test(n))return n;try{const i=new TextDecoder(e,{fatal:!0}),s=(0,r.stringToBytes)(n);n=i.decode(s),t=!1}catch(e){}}return n}function o(e){return t&&/[\x80-\xff]/.test(e)&&(e=s("utf-8",e),t&&(e=s("iso-8859-1",e))),e}function a(e){if(e.startsWith('"')){const t=e.slice(1).split('\\"');for(let e=0;e<t.length;++e){const n=t[e].indexOf('"');-1!==n&&(t[e]=t[e].slice(0,n),t.length=e+1),t[e]=t[e].replace(/\\(.)/g,"$1")}e=t.join('"')}return e}function l(e){const t=e.indexOf("'");return-1===t?e:s(e.slice(0,t),e.slice(t+1).replace(/^[^']*'/,""))}function c(e){return!e.startsWith("=?")||/[\x00-\x19\x80-\xff]/.test(e)?e:e.replace(/=\?([\w-]*)\?([QqBb])\?((?:[^?]|\?(?!=))*)\?=/g,(function(e,t,n,r){if("q"===n||"Q"===n)return s(t,r=(r=r.replace(/_/g," ")).replace(/=([0-9a-fA-F]{2})/g,(function(e,t){return String.fromCharCode(parseInt(t,16))})));try{r=atob(r)}catch(e){}return s(t,r)}))}return""};var r=n(1)},(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.PDFNetworkStream=void 0;var r=n(1),i=n(24);class s{constructor(e,t={}){this.url=e,this.isHttp=/^https?:/i.test(e),this.httpHeaders=this.isHttp&&t.httpHeaders||Object.create(null),this.withCredentials=t.withCredentials||!1,this.getXhr=t.getXhr||function(){return new XMLHttpRequest},this.currXhrId=0,this.pendingRequests=Object.create(null)}requestRange(e,t,n){const r={begin:e,end:t};for(const e in n)r[e]=n[e];return this.request(r)}requestFull(e){return this.request(e)}request(e){const t=this.getXhr(),n=this.currXhrId++,r=this.pendingRequests[n]={xhr:t};t.open("GET",this.url),t.withCredentials=this.withCredentials;for(const e in this.httpHeaders){const n=this.httpHeaders[e];void 0!==n&&t.setRequestHeader(e,n)}return this.isHttp&&"begin"in e&&"end"in e?(t.setRequestHeader("Range",`bytes=${e.begin}-${e.end-1}`),r.expectedStatus=206):r.expectedStatus=200,t.responseType="arraybuffer",e.onError&&(t.onerror=function(n){e.onError(t.status)}),t.onreadystatechange=this.onStateChange.bind(this,n),t.onprogress=this.onProgress.bind(this,n),r.onHeadersReceived=e.onHeadersReceived,r.onDone=e.onDone,r.onError=e.onError,r.onProgress=e.onProgress,t.send(null),n}onProgress(e,t){const n=this.pendingRequests[e];n&&n.onProgress?.(t)}onStateChange(e,t){const n=this.pendingRequests[e];if(!n)return;const i=n.xhr;if(i.readyState>=2&&n.onHeadersReceived&&(n.onHeadersReceived(),delete n.onHeadersReceived),4!==i.readyState)return;if(!(e in this.pendingRequests))return;if(delete this.pendingRequests[e],0===i.status&&this.isHttp)return void n.onError?.(i.status);const s=i.status||200;if((200!==s||206!==n.expectedStatus)&&s!==n.expectedStatus)return void n.onError?.(i.status);const o=function(e){const t=e.response;return"string"!=typeof t?t:(0,r.stringToBytes)(t).buffer}(i);if(206===s){const e=i.getResponseHeader("Content-Range"),t=/bytes (\d+)-(\d+)\/(\d+)/.exec(e);n.onDone({begin:parseInt(t[1],10),chunk:o})}else o?n.onDone({begin:0,chunk:o}):n.onError?.(i.status)}getRequestXhr(e){return this.pendingRequests[e].xhr}isPendingRequest(e){return e in this.pendingRequests}abortRequest(e){const t=this.pendingRequests[e].xhr;delete this.pendingRequests[e],t.abort()}}t.PDFNetworkStream=class{constructor(e){this._source=e,this._manager=new s(e.url,{httpHeaders:e.httpHeaders,withCredentials:e.withCredentials}),this._rangeChunkSize=e.rangeChunkSize,this._fullRequestReader=null,this._rangeRequestReaders=[]}_onRangeRequestReaderClosed(e){const t=this._rangeRequestReaders.indexOf(e);t>=0&&this._rangeRequestReaders.splice(t,1)}getFullReader(){return(0,r.assert)(!this._fullRequestReader,"PDFNetworkStream.getFullReader can only be called once."),this._fullRequestReader=new o(this._manager,this._source),this._fullRequestReader}getRangeReader(e,t){const n=new a(this._manager,e,t);return n.onClosed=this._onRangeRequestReaderClosed.bind(this),this._rangeRequestReaders.push(n),n}cancelAllRequests(e){this._fullRequestReader?.cancel(e);for(const t of this._rangeRequestReaders.slice(0))t.cancel(e)}};class o{constructor(e,t){this._manager=e;const n={onHeadersReceived:this._onHeadersReceived.bind(this),onDone:this._onDone.bind(this),onError:this._onError.bind(this),onProgress:this._onProgress.bind(this)};this._url=t.url,this._fullRequestId=e.requestFull(n),this._headersReceivedCapability=(0,r.createPromiseCapability)(),this._disableRange=t.disableRange||!1,this._contentLength=t.length,this._rangeChunkSize=t.rangeChunkSize,this._rangeChunkSize||this._disableRange||(this._disableRange=!0),this._isStreamingSupported=!1,this._isRangeSupported=!1,this._cachedChunks=[],this._requests=[],this._done=!1,this._storedError=void 0,this._filename=null,this.onProgress=null}_onHeadersReceived(){const e=this._fullRequestId,t=this._manager.getRequestXhr(e),n=e=>t.getResponseHeader(e),{allowRangeRequests:r,suggestedLength:s}=(0,i.validateRangeRequestCapabilities)({getResponseHeader:n,isHttp:this._manager.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange});r&&(this._isRangeSupported=!0),this._contentLength=s||this._contentLength,this._filename=(0,i.extractFilenameFromHeader)(n),this._isRangeSupported&&this._manager.abortRequest(e),this._headersReceivedCapability.resolve()}_onDone(e){if(e&&(this._requests.length>0?this._requests.shift().resolve({value:e.chunk,done:!1}):this._cachedChunks.push(e.chunk)),this._done=!0,!(this._cachedChunks.length>0)){for(const e of this._requests)e.resolve({value:void 0,done:!0});this._requests.length=0}}_onError(e){this._storedError=(0,i.createResponseStatusError)(e,this._url),this._headersReceivedCapability.reject(this._storedError);for(const e of this._requests)e.reject(this._storedError);this._requests.length=0,this._cachedChunks.length=0}_onProgress(e){this.onProgress?.({loaded:e.loaded,total:e.lengthComputable?e.total:this._contentLength})}get filename(){return this._filename}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}get contentLength(){return this._contentLength}get headersReady(){return this._headersReceivedCapability.promise}async read(){if(this._storedError)throw this._storedError;if(this._cachedChunks.length>0)return{value:this._cachedChunks.shift(),done:!1};if(this._done)return{value:void 0,done:!0};const e=(0,r.createPromiseCapability)();return this._requests.push(e),e.promise}cancel(e){this._done=!0,this._headersReceivedCapability.reject(e);for(const e of this._requests)e.resolve({value:void 0,done:!0});this._requests.length=0,this._manager.isPendingRequest(this._fullRequestId)&&this._manager.abortRequest(this._fullRequestId),this._fullRequestReader=null}}class a{constructor(e,t,n){this._manager=e;const r={onDone:this._onDone.bind(this),onError:this._onError.bind(this),onProgress:this._onProgress.bind(this)};this._url=e.url,this._requestId=e.requestRange(t,n,r),this._requests=[],this._queuedChunk=null,this._done=!1,this._storedError=void 0,this.onProgress=null,this.onClosed=null}_close(){this.onClosed?.(this)}_onDone(e){const t=e.chunk;this._requests.length>0?this._requests.shift().resolve({value:t,done:!1}):this._queuedChunk=t,this._done=!0;for(const e of this._requests)e.resolve({value:void 0,done:!0});this._requests.length=0,this._close()}_onError(e){this._storedError=(0,i.createResponseStatusError)(e,this._url);for(const e of this._requests)e.reject(this._storedError);this._requests.length=0,this._queuedChunk=null}_onProgress(e){this.isStreamingSupported||this.onProgress?.({loaded:e.loaded})}get isStreamingSupported(){return!1}async read(){if(this._storedError)throw this._storedError;if(null!==this._queuedChunk){const e=this._queuedChunk;return this._queuedChunk=null,{value:e,done:!1}}if(this._done)return{value:void 0,done:!0};const e=(0,r.createPromiseCapability)();return this._requests.push(e),e.promise}cancel(e){this._done=!0;for(const e of this._requests)e.resolve({value:void 0,done:!0});this._requests.length=0,this._manager.isPendingRequest(this._requestId)&&this._manager.abortRequest(this._requestId),this._close()}}},(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.PDFFetchStream=void 0;var r=n(1),i=n(24);function s(e,t,n){return{method:"GET",headers:e,signal:n?.signal,mode:"cors",credentials:t?"include":"same-origin",redirect:"follow"}}function o(e){const t=new Headers;for(const n in e){const r=e[n];void 0!==r&&t.append(n,r)}return t}t.PDFFetchStream=class{constructor(e){this.source=e,this.isHttp=/^https?:/i.test(e.url),this.httpHeaders=this.isHttp&&e.httpHeaders||{},this._fullRequestReader=null,this._rangeRequestReaders=[]}get _progressiveDataLength(){return this._fullRequestReader?._loaded??0}getFullReader(){return(0,r.assert)(!this._fullRequestReader,"PDFFetchStream.getFullReader can only be called once."),this._fullRequestReader=new a(this),this._fullRequestReader}getRangeReader(e,t){if(t<=this._progressiveDataLength)return null;const n=new l(this,e,t);return this._rangeRequestReaders.push(n),n}cancelAllRequests(e){this._fullRequestReader&&this._fullRequestReader.cancel(e);for(const t of this._rangeRequestReaders.slice(0))t.cancel(e)}};class a{constructor(e){this._stream=e,this._reader=null,this._loaded=0,this._filename=null;const t=e.source;this._withCredentials=t.withCredentials||!1,this._contentLength=t.length,this._headersCapability=(0,r.createPromiseCapability)(),this._disableRange=t.disableRange||!1,this._rangeChunkSize=t.rangeChunkSize,this._rangeChunkSize||this._disableRange||(this._disableRange=!0),"undefined"!=typeof AbortController&&(this._abortController=new AbortController),this._isStreamingSupported=!t.disableStream,this._isRangeSupported=!t.disableRange,this._headers=o(this._stream.httpHeaders);const n=t.url;fetch(n,s(this._headers,this._withCredentials,this._abortController)).then((e=>{if(!(0,i.validateResponseStatus)(e.status))throw(0,i.createResponseStatusError)(e.status,n);this._reader=e.body.getReader(),this._headersCapability.resolve();const t=t=>e.headers.get(t),{allowRangeRequests:s,suggestedLength:o}=(0,i.validateRangeRequestCapabilities)({getResponseHeader:t,isHttp:this._stream.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange});this._isRangeSupported=s,this._contentLength=o||this._contentLength,this._filename=(0,i.extractFilenameFromHeader)(t),!this._isStreamingSupported&&this._isRangeSupported&&this.cancel(new r.AbortException("Streaming is disabled."))})).catch(this._headersCapability.reject),this.onProgress=null}get headersReady(){return this._headersCapability.promise}get filename(){return this._filename}get contentLength(){return this._contentLength}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}async read(){await this._headersCapability.promise;const{value:e,done:t}=await this._reader.read();return t?{value:e,done:t}:(this._loaded+=e.byteLength,this.onProgress&&this.onProgress({loaded:this._loaded,total:this._contentLength}),{value:new Uint8Array(e).buffer,done:!1})}cancel(e){this._reader&&this._reader.cancel(e),this._abortController&&this._abortController.abort()}}class l{constructor(e,t,n){this._stream=e,this._reader=null,this._loaded=0;const a=e.source;this._withCredentials=a.withCredentials||!1,this._readCapability=(0,r.createPromiseCapability)(),this._isStreamingSupported=!a.disableStream,"undefined"!=typeof AbortController&&(this._abortController=new AbortController),this._headers=o(this._stream.httpHeaders),this._headers.append("Range",`bytes=${t}-${n-1}`);const l=a.url;fetch(l,s(this._headers,this._withCredentials,this._abortController)).then((e=>{if(!(0,i.validateResponseStatus)(e.status))throw(0,i.createResponseStatusError)(e.status,l);this._readCapability.resolve(),this._reader=e.body.getReader()})).catch(this._readCapability.reject),this.onProgress=null}get isStreamingSupported(){return this._isStreamingSupported}async read(){await this._readCapability.promise;const{value:e,done:t}=await this._reader.read();return t?{value:e,done:t}:(this._loaded+=e.byteLength,this.onProgress&&this.onProgress({loaded:this._loaded}),{value:new Uint8Array(e).buffer,done:!1})}cancel(e){this._reader&&this._reader.cancel(e),this._abortController&&this._abortController.abort()}}}],__webpack_module_cache__={};function __w_pdfjs_require__(e){var t=__webpack_module_cache__[e];if(void 0!==t)return t.exports;var n=__webpack_module_cache__[e]={exports:{}};return __webpack_modules__[e](n,n.exports,__w_pdfjs_require__),n.exports}var __webpack_exports__={};return(()=>{var e=__webpack_exports__;Object.defineProperty(e,"__esModule",{value:!0}),Object.defineProperty(e,"AnnotationLayer",{enumerable:!0,get:function(){return i.AnnotationLayer}}),Object.defineProperty(e,"AnnotationMode",{enumerable:!0,get:function(){return t.AnnotationMode}}),Object.defineProperty(e,"CMapCompressionType",{enumerable:!0,get:function(){return t.CMapCompressionType}}),Object.defineProperty(e,"GlobalWorkerOptions",{enumerable:!0,get:function(){return s.GlobalWorkerOptions}}),Object.defineProperty(e,"InvalidPDFException",{enumerable:!0,get:function(){return t.InvalidPDFException}}),Object.defineProperty(e,"LoopbackPort",{enumerable:!0,get:function(){return n.LoopbackPort}}),Object.defineProperty(e,"MissingPDFException",{enumerable:!0,get:function(){return t.MissingPDFException}}),Object.defineProperty(e,"OPS",{enumerable:!0,get:function(){return t.OPS}}),Object.defineProperty(e,"PDFDataRangeTransport",{enumerable:!0,get:function(){return n.PDFDataRangeTransport}}),Object.defineProperty(e,"PDFDateString",{enumerable:!0,get:function(){return r.PDFDateString}}),Object.defineProperty(e,"PDFWorker",{enumerable:!0,get:function(){return n.PDFWorker}}),Object.defineProperty(e,"PasswordResponses",{enumerable:!0,get:function(){return t.PasswordResponses}}),Object.defineProperty(e,"PermissionFlag",{enumerable:!0,get:function(){return t.PermissionFlag}}),Object.defineProperty(e,"PixelsPerInch",{enumerable:!0,get:function(){return r.PixelsPerInch}}),Object.defineProperty(e,"RenderingCancelledException",{enumerable:!0,get:function(){return r.RenderingCancelledException}}),Object.defineProperty(e,"SVGGraphics",{enumerable:!0,get:function(){return l.SVGGraphics}}),Object.defineProperty(e,"UNSUPPORTED_FEATURES",{enumerable:!0,get:function(){return t.UNSUPPORTED_FEATURES}}),Object.defineProperty(e,"UnexpectedResponseException",{enumerable:!0,get:function(){return t.UnexpectedResponseException}}),Object.defineProperty(e,"Util",{enumerable:!0,get:function(){return t.Util}}),Object.defineProperty(e,"VerbosityLevel",{enumerable:!0,get:function(){return t.VerbosityLevel}}),Object.defineProperty(e,"XfaLayer",{enumerable:!0,get:function(){return c.XfaLayer}}),Object.defineProperty(e,"build",{enumerable:!0,get:function(){return n.build}}),Object.defineProperty(e,"createPromiseCapability",{enumerable:!0,get:function(){return t.createPromiseCapability}}),Object.defineProperty(e,"createValidAbsoluteUrl",{enumerable:!0,get:function(){return t.createValidAbsoluteUrl}}),Object.defineProperty(e,"getDocument",{enumerable:!0,get:function(){return n.getDocument}}),Object.defineProperty(e,"getFilenameFromUrl",{enumerable:!0,get:function(){return r.getFilenameFromUrl}}),Object.defineProperty(e,"getPdfFilenameFromUrl",{enumerable:!0,get:function(){return r.getPdfFilenameFromUrl}}),Object.defineProperty(e,"getXfaPageViewport",{enumerable:!0,get:function(){return r.getXfaPageViewport}}),Object.defineProperty(e,"isPdfFile",{enumerable:!0,get:function(){return r.isPdfFile}}),Object.defineProperty(e,"loadScript",{enumerable:!0,get:function(){return r.loadScript}}),Object.defineProperty(e,"renderTextLayer",{enumerable:!0,get:function(){return a.renderTextLayer}}),Object.defineProperty(e,"shadow",{enumerable:!0,get:function(){return t.shadow}}),Object.defineProperty(e,"version",{enumerable:!0,get:function(){return n.version}});var t=__w_pdfjs_require__(1),n=__w_pdfjs_require__(4),r=__w_pdfjs_require__(5),i=__w_pdfjs_require__(18),s=__w_pdfjs_require__(12),o=__w_pdfjs_require__(3),a=__w_pdfjs_require__(21),l=__w_pdfjs_require__(22),c=__w_pdfjs_require__(20);if(o.isNodeJS){const{PDFNodeStream:e}=__w_pdfjs_require__(23);(0,n.setPDFNetworkStreamFactory)((t=>new e(t)))}else{const{PDFNetworkStream:e}=__w_pdfjs_require__(26),{PDFFetchStream:t}=__w_pdfjs_require__(27);(0,n.setPDFNetworkStreamFactory)((n=>(0,r.isValidFetchUrl)(n.url)?new t(n):new e(n)))}})(),__webpack_exports__})()},module.exports=factory()},2372:(e,t,n)=>{"use strict";const r=n(9299),i=n(3394);"undefined"!=typeof window&&"Worker"in window&&(r.GlobalWorkerOptions.workerPort=new i),e.exports=r},4241:e=>{var t=String,n=function(){return{isColorSupported:!1,reset:t,bold:t,dim:t,italic:t,underline:t,inverse:t,hidden:t,strikethrough:t,black:t,red:t,green:t,yellow:t,blue:t,magenta:t,cyan:t,white:t,gray:t,bgBlack:t,bgRed:t,bgGreen:t,bgYellow:t,bgBlue:t,bgMagenta:t,bgCyan:t,bgWhite:t}};e.exports=n(),e.exports.createColors=n},9041:(e,t,n)=>{var r=n(4606);e.exports=function(e){if(137!==e[0])throw new Error("Invalid .png file header");if(80!==e[1])throw new Error("Invalid .png file header");if(78!==e[2])throw new Error("Invalid .png file header");if(71!==e[3])throw new Error("Invalid .png file header");if(13!==e[4])throw new Error("Invalid .png file header: possibly caused by DOS-Unix line ending conversion?");if(10!==e[5])throw new Error("Invalid .png file header: possibly caused by DOS-Unix line ending conversion?");if(26!==e[6])throw new Error("Invalid .png file header");if(10!==e[7])throw new Error("Invalid .png file header: possibly caused by DOS-Unix line ending conversion?");for(var t=!1,n=[],a=8;a<e.length;){i[3]=e[a++],i[2]=e[a++],i[1]=e[a++],i[0]=e[a++];var l=o[0]+4,c=new Uint8Array(l);c[0]=e[a++],c[1]=e[a++],c[2]=e[a++],c[3]=e[a++];var d=String.fromCharCode(c[0])+String.fromCharCode(c[1])+String.fromCharCode(c[2])+String.fromCharCode(c[3]);if(!n.length&&"IHDR"!==d)throw new Error("IHDR header missing");if("IEND"===d){t=!0,n.push({name:d,data:new Uint8Array(0)});break}for(var u=4;u<l;u++)c[u]=e[a++];i[3]=e[a++],i[2]=e[a++],i[1]=e[a++],i[0]=e[a++];var h=s[0];if(r.buf(c)!==h)throw new Error("CRC values for "+d+" header do not match, PNG file is likely corrupted");var p=new Uint8Array(c.buffer.slice(4));n.push({name:d,data:p})}if(!t)throw new Error(".png file ended prematurely: no IEND header was found");return n};var i=new Uint8Array(4),s=new Int32Array(i.buffer),o=new Uint32Array(i.buffer)},1353:(e,t,n)=>{"use strict";let r=n(1019);class i extends r{constructor(e){super(e),this.type="atrule"}append(...e){return this.proxyOf.nodes||(this.nodes=[]),super.append(...e)}prepend(...e){return this.proxyOf.nodes||(this.nodes=[]),super.prepend(...e)}}e.exports=i,i.default=i,r.registerAtRule(i)},9932:(e,t,n)=>{"use strict";let r=n(5631);class i extends r{constructor(e){super(e),this.type="comment"}}e.exports=i,i.default=i},1019:(e,t,n)=>{"use strict";let r,i,s,{isClean:o,my:a}=n(5513),l=n(4258),c=n(9932),d=n(5631);function u(e){return e.map((e=>(e.nodes&&(e.nodes=u(e.nodes)),delete e.source,e)))}function h(e){if(e[o]=!1,e.proxyOf.nodes)for(let t of e.proxyOf.nodes)h(t)}class p extends d{push(e){return e.parent=this,this.proxyOf.nodes.push(e),this}each(e){if(!this.proxyOf.nodes)return;let t,n,r=this.getIterator();for(;this.indexes[r]<this.proxyOf.nodes.length&&(t=this.indexes[r],n=e(this.proxyOf.nodes[t],t),!1!==n);)this.indexes[r]+=1;return delete this.indexes[r],n}walk(e){return this.each(((t,n)=>{let r;try{r=e(t,n)}catch(e){throw t.addToError(e)}return!1!==r&&t.walk&&(r=t.walk(e)),r}))}walkDecls(e,t){return t?e instanceof RegExp?this.walk(((n,r)=>{if("decl"===n.type&&e.test(n.prop))return t(n,r)})):this.walk(((n,r)=>{if("decl"===n.type&&n.prop===e)return t(n,r)})):(t=e,this.walk(((e,n)=>{if("decl"===e.type)return t(e,n)})))}walkRules(e,t){return t?e instanceof RegExp?this.walk(((n,r)=>{if("rule"===n.type&&e.test(n.selector))return t(n,r)})):this.walk(((n,r)=>{if("rule"===n.type&&n.selector===e)return t(n,r)})):(t=e,this.walk(((e,n)=>{if("rule"===e.type)return t(e,n)})))}walkAtRules(e,t){return t?e instanceof RegExp?this.walk(((n,r)=>{if("atrule"===n.type&&e.test(n.name))return t(n,r)})):this.walk(((n,r)=>{if("atrule"===n.type&&n.name===e)return t(n,r)})):(t=e,this.walk(((e,n)=>{if("atrule"===e.type)return t(e,n)})))}walkComments(e){return this.walk(((t,n)=>{if("comment"===t.type)return e(t,n)}))}append(...e){for(let t of e){let e=this.normalize(t,this.last);for(let t of e)this.proxyOf.nodes.push(t)}return this.markDirty(),this}prepend(...e){e=e.reverse();for(let t of e){let e=this.normalize(t,this.first,"prepend").reverse();for(let t of e)this.proxyOf.nodes.unshift(t);for(let t in this.indexes)this.indexes[t]=this.indexes[t]+e.length}return this.markDirty(),this}cleanRaws(e){if(super.cleanRaws(e),this.nodes)for(let t of this.nodes)t.cleanRaws(e)}insertBefore(e,t){let n,r=0===(e=this.index(e))&&"prepend",i=this.normalize(t,this.proxyOf.nodes[e],r).reverse();for(let t of i)this.proxyOf.nodes.splice(e,0,t);for(let t in this.indexes)n=this.indexes[t],e<=n&&(this.indexes[t]=n+i.length);return this.markDirty(),this}insertAfter(e,t){e=this.index(e);let n,r=this.normalize(t,this.proxyOf.nodes[e]).reverse();for(let t of r)this.proxyOf.nodes.splice(e+1,0,t);for(let t in this.indexes)n=this.indexes[t],e<n&&(this.indexes[t]=n+r.length);return this.markDirty(),this}removeChild(e){let t;e=this.index(e),this.proxyOf.nodes[e].parent=void 0,this.proxyOf.nodes.splice(e,1);for(let n in this.indexes)t=this.indexes[n],t>=e&&(this.indexes[n]=t-1);return this.markDirty(),this}removeAll(){for(let e of this.proxyOf.nodes)e.parent=void 0;return this.proxyOf.nodes=[],this.markDirty(),this}replaceValues(e,t,n){return n||(n=t,t={}),this.walkDecls((r=>{t.props&&!t.props.includes(r.prop)||t.fast&&!r.value.includes(t.fast)||(r.value=r.value.replace(e,n))})),this.markDirty(),this}every(e){return this.nodes.every(e)}some(e){return this.nodes.some(e)}index(e){return"number"==typeof e?e:(e.proxyOf&&(e=e.proxyOf),this.proxyOf.nodes.indexOf(e))}get first(){if(this.proxyOf.nodes)return this.proxyOf.nodes[0]}get last(){if(this.proxyOf.nodes)return this.proxyOf.nodes[this.proxyOf.nodes.length-1]}normalize(e,t){if("string"==typeof e)e=u(r(e).nodes);else if(Array.isArray(e)){e=e.slice(0);for(let t of e)t.parent&&t.parent.removeChild(t,"ignore")}else if("root"===e.type&&"document"!==this.type){e=e.nodes.slice(0);for(let t of e)t.parent&&t.parent.removeChild(t,"ignore")}else if(e.type)e=[e];else if(e.prop){if(void 0===e.value)throw new Error("Value field is missed in node creation");"string"!=typeof e.value&&(e.value=String(e.value)),e=[new l(e)]}else if(e.selector)e=[new i(e)];else if(e.name)e=[new s(e)];else{if(!e.text)throw new Error("Unknown node type in node creation");e=[new c(e)]}return e.map((e=>(e[a]||p.rebuild(e),(e=e.proxyOf).parent&&e.parent.removeChild(e),e[o]&&h(e),void 0===e.raws.before&&t&&void 0!==t.raws.before&&(e.raws.before=t.raws.before.replace(/\S/g,"")),e.parent=this,e)))}getProxyProcessor(){return{set:(e,t,n)=>(e[t]===n||(e[t]=n,"name"!==t&&"params"!==t&&"selector"!==t||e.markDirty()),!0),get:(e,t)=>"proxyOf"===t?e:e[t]?"each"===t||"string"==typeof t&&t.startsWith("walk")?(...n)=>e[t](...n.map((e=>"function"==typeof e?(t,n)=>e(t.toProxy(),n):e))):"every"===t||"some"===t?n=>e[t](((e,...t)=>n(e.toProxy(),...t))):"root"===t?()=>e.root().toProxy():"nodes"===t?e.nodes.map((e=>e.toProxy())):"first"===t||"last"===t?e[t].toProxy():e[t]:e[t]}}getIterator(){this.lastEach||(this.lastEach=0),this.indexes||(this.indexes={}),this.lastEach+=1;let e=this.lastEach;return this.indexes[e]=0,e}}p.registerParse=e=>{r=e},p.registerRule=e=>{i=e},p.registerAtRule=e=>{s=e},e.exports=p,p.default=p,p.rebuild=e=>{"atrule"===e.type?Object.setPrototypeOf(e,s.prototype):"rule"===e.type?Object.setPrototypeOf(e,i.prototype):"decl"===e.type?Object.setPrototypeOf(e,l.prototype):"comment"===e.type&&Object.setPrototypeOf(e,c.prototype),e[a]=!0,e.nodes&&e.nodes.forEach((e=>{p.rebuild(e)}))}},2671:(e,t,n)=>{"use strict";let r=n(4241),i=n(2868);class s extends Error{constructor(e,t,n,r,i,o){super(e),this.name="CssSyntaxError",this.reason=e,i&&(this.file=i),r&&(this.source=r),o&&(this.plugin=o),void 0!==t&&void 0!==n&&("number"==typeof t?(this.line=t,this.column=n):(this.line=t.line,this.column=t.column,this.endLine=n.line,this.endColumn=n.column)),this.setMessage(),Error.captureStackTrace&&Error.captureStackTrace(this,s)}setMessage(){this.message=this.plugin?this.plugin+": ":"",this.message+=this.file?this.file:"<css input>",void 0!==this.line&&(this.message+=":"+this.line+":"+this.column),this.message+=": "+this.reason}showSourceCode(e){if(!this.source)return"";let t=this.source;null==e&&(e=r.isColorSupported),i&&e&&(t=i(t));let n,s,o=t.split(/\r?\n/),a=Math.max(this.line-3,0),l=Math.min(this.line+2,o.length),c=String(l).length;if(e){let{bold:e,red:t,gray:i}=r.createColors(!0);n=n=>e(t(n)),s=e=>i(e)}else n=s=e=>e;return o.slice(a,l).map(((e,t)=>{let r=a+1+t,i=" "+(" "+r).slice(-c)+" | ";if(r===this.line){let t=s(i.replace(/\d/g," "))+e.slice(0,this.column-1).replace(/[^\t]/g," ");return n(">")+s(i)+e+"\n "+t+n("^")}return" "+s(i)+e})).join("\n")}toString(){let e=this.showSourceCode();return e&&(e="\n\n"+e+"\n"),this.name+": "+this.message+e}}e.exports=s,s.default=s},4258:(e,t,n)=>{"use strict";let r=n(5631);class i extends r{constructor(e){e&&void 0!==e.value&&"string"!=typeof e.value&&(e={...e,value:String(e.value)}),super(e),this.type="decl"}get variable(){return this.prop.startsWith("--")||"$"===this.prop[0]}}e.exports=i,i.default=i},6461:(e,t,n)=>{"use strict";let r,i,s=n(1019);class o extends s{constructor(e){super({type:"document",...e}),this.nodes||(this.nodes=[])}toResult(e={}){return new r(new i,this,e).stringify()}}o.registerLazyResult=e=>{r=e},o.registerProcessor=e=>{i=e},e.exports=o,o.default=o},250:(e,t,n)=>{"use strict";let r=n(4258),i=n(7981),s=n(9932),o=n(1353),a=n(5995),l=n(1025),c=n(1675);function d(e,t){if(Array.isArray(e))return e.map((e=>d(e)));let{inputs:n,...u}=e;if(n){t=[];for(let e of n){let n={...e,__proto__:a.prototype};n.map&&(n.map={...n.map,__proto__:i.prototype}),t.push(n)}}if(u.nodes&&(u.nodes=e.nodes.map((e=>d(e,t)))),u.source){let{inputId:e,...n}=u.source;u.source=n,null!=e&&(u.source.input=t[e])}if("root"===u.type)return new l(u);if("decl"===u.type)return new r(u);if("rule"===u.type)return new c(u);if("comment"===u.type)return new s(u);if("atrule"===u.type)return new o(u);throw new Error("Unknown node type: "+e.type)}e.exports=d,d.default=d},5995:(e,t,n)=>{"use strict";let{SourceMapConsumer:r,SourceMapGenerator:i}=n(209),{fileURLToPath:s,pathToFileURL:o}=n(7414),{resolve:a,isAbsolute:l}=n(9830),{nanoid:c}=n(2961),d=n(2868),u=n(2671),h=n(7981),p=Symbol("fromOffsetCache"),m=Boolean(r&&i),g=Boolean(a&&l);class f{constructor(e,t={}){if(null==e||"object"==typeof e&&!e.toString)throw new Error(`PostCSS received ${e} instead of CSS string`);if(this.css=e.toString(),"\ufeff"===this.css[0]||""===this.css[0]?(this.hasBOM=!0,this.css=this.css.slice(1)):this.hasBOM=!1,t.from&&(!g||/^\w+:\/\//.test(t.from)||l(t.from)?this.file=t.from:this.file=a(t.from)),g&&m){let e=new h(this.css,t);if(e.text){this.map=e;let t=e.consumer().file;!this.file&&t&&(this.file=this.mapResolve(t))}}this.file||(this.id="<input css "+c(6)+">"),this.map&&(this.map.file=this.from)}fromOffset(e){let t,n;if(this[p])n=this[p];else{let e=this.css.split("\n");n=new Array(e.length);let t=0;for(let r=0,i=e.length;r<i;r++)n[r]=t,t+=e[r].length+1;this[p]=n}t=n[n.length-1];let r=0;if(e>=t)r=n.length-1;else{let t,i=n.length-2;for(;r<i;)if(t=r+(i-r>>1),e<n[t])i=t-1;else{if(!(e>=n[t+1])){r=t;break}r=t+1}}return{line:r+1,col:e-n[r]+1}}error(e,t,n,r={}){let i,s,a;if(t&&"object"==typeof t){let e=t,r=n;if("number"==typeof t.offset){let r=this.fromOffset(e.offset);t=r.line,n=r.col}else t=e.line,n=e.column;if("number"==typeof r.offset){let e=this.fromOffset(r.offset);s=e.line,a=e.col}else s=r.line,a=r.column}else if(!n){let e=this.fromOffset(t);t=e.line,n=e.col}let l=this.origin(t,n,s,a);return i=l?new u(e,void 0===l.endLine?l.line:{line:l.line,column:l.column},void 0===l.endLine?l.column:{line:l.endLine,column:l.endColumn},l.source,l.file,r.plugin):new u(e,void 0===s?t:{line:t,column:n},void 0===s?n:{line:s,column:a},this.css,this.file,r.plugin),i.input={line:t,column:n,endLine:s,endColumn:a,source:this.css},this.file&&(o&&(i.input.url=o(this.file).toString()),i.input.file=this.file),i}origin(e,t,n,r){if(!this.map)return!1;let i,a,c=this.map.consumer(),d=c.originalPositionFor({line:e,column:t});if(!d.source)return!1;"number"==typeof n&&(i=c.originalPositionFor({line:n,column:r})),a=l(d.source)?o(d.source):new URL(d.source,this.map.consumer().sourceRoot||o(this.map.mapFile));let u={url:a.toString(),line:d.line,column:d.column,endLine:i&&i.line,endColumn:i&&i.column};if("file:"===a.protocol){if(!s)throw new Error("file: protocol is not available in this PostCSS build");u.file=s(a)}let h=c.sourceContentFor(d.source);return h&&(u.source=h),u}mapResolve(e){return/^\w+:\/\//.test(e)?e:a(this.map.consumer().sourceRoot||this.map.root||".",e)}get from(){return this.file||this.id}toJSON(){let e={};for(let t of["hasBOM","css","file","id"])null!=this[t]&&(e[t]=this[t]);return this.map&&(e.map={...this.map},e.map.consumerCache&&(e.map.consumerCache=void 0)),e}}e.exports=f,f.default=f,d&&d.registerInput&&d.registerInput(f)},1939:(e,t,n)=>{"use strict";let{isClean:r,my:i}=n(5513),s=n(8505),o=n(7088),a=n(1019),l=n(6461),c=(n(2448),n(3632)),d=n(6939),u=n(1025);const h={document:"Document",root:"Root",atrule:"AtRule",rule:"Rule",decl:"Declaration",comment:"Comment"},p={postcssPlugin:!0,prepare:!0,Once:!0,Document:!0,Root:!0,Declaration:!0,Rule:!0,AtRule:!0,Comment:!0,DeclarationExit:!0,RuleExit:!0,AtRuleExit:!0,CommentExit:!0,RootExit:!0,DocumentExit:!0,OnceExit:!0},m={postcssPlugin:!0,prepare:!0,Once:!0};function g(e){return"object"==typeof e&&"function"==typeof e.then}function f(e){let t=!1,n=h[e.type];return"decl"===e.type?t=e.prop.toLowerCase():"atrule"===e.type&&(t=e.name.toLowerCase()),t&&e.append?[n,n+"-"+t,0,n+"Exit",n+"Exit-"+t]:t?[n,n+"-"+t,n+"Exit",n+"Exit-"+t]:e.append?[n,0,n+"Exit"]:[n,n+"Exit"]}function y(e){let t;return t="document"===e.type?["Document",0,"DocumentExit"]:"root"===e.type?["Root",0,"RootExit"]:f(e),{node:e,events:t,eventIndex:0,visitors:[],visitorIndex:0,iterator:0}}function v(e){return e[r]=!1,e.nodes&&e.nodes.forEach((e=>v(e))),e}let b={};class w{constructor(e,t,n){let r;if(this.stringified=!1,this.processed=!1,"object"!=typeof t||null===t||"root"!==t.type&&"document"!==t.type)if(t instanceof w||t instanceof c)r=v(t.root),t.map&&(void 0===n.map&&(n.map={}),n.map.inline||(n.map.inline=!1),n.map.prev=t.map);else{let e=d;n.syntax&&(e=n.syntax.parse),n.parser&&(e=n.parser),e.parse&&(e=e.parse);try{r=e(t,n)}catch(e){this.processed=!0,this.error=e}r&&!r[i]&&a.rebuild(r)}else r=v(t);this.result=new c(e,r,n),this.helpers={...b,result:this.result,postcss:b},this.plugins=this.processor.plugins.map((e=>"object"==typeof e&&e.prepare?{...e,...e.prepare(this.result)}:e))}get[Symbol.toStringTag](){return"LazyResult"}get processor(){return this.result.processor}get opts(){return this.result.opts}get css(){return this.stringify().css}get content(){return this.stringify().content}get map(){return this.stringify().map}get root(){return this.sync().root}get messages(){return this.sync().messages}warnings(){return this.sync().warnings()}toString(){return this.css}then(e,t){return this.async().then(e,t)}catch(e){return this.async().catch(e)}finally(e){return this.async().then(e,e)}async(){return this.error?Promise.reject(this.error):this.processed?Promise.resolve(this.result):(this.processing||(this.processing=this.runAsync()),this.processing)}sync(){if(this.error)throw this.error;if(this.processed)return this.result;if(this.processed=!0,this.processing)throw this.getAsyncError();for(let e of this.plugins)if(g(this.runOnRoot(e)))throw this.getAsyncError();if(this.prepareVisitors(),this.hasListener){let e=this.result.root;for(;!e[r];)e[r]=!0,this.walkSync(e);if(this.listeners.OnceExit)if("document"===e.type)for(let t of e.nodes)this.visitSync(this.listeners.OnceExit,t);else this.visitSync(this.listeners.OnceExit,e)}return this.result}stringify(){if(this.error)throw this.error;if(this.stringified)return this.result;this.stringified=!0,this.sync();let e=this.result.opts,t=o;e.syntax&&(t=e.syntax.stringify),e.stringifier&&(t=e.stringifier),t.stringify&&(t=t.stringify);let n=new s(t,this.result.root,this.result.opts).generate();return this.result.css=n[0],this.result.map=n[1],this.result}walkSync(e){e[r]=!0;let t=f(e);for(let n of t)if(0===n)e.nodes&&e.each((e=>{e[r]||this.walkSync(e)}));else{let t=this.listeners[n];if(t&&this.visitSync(t,e.toProxy()))return}}visitSync(e,t){for(let[n,r]of e){let e;this.result.lastPlugin=n;try{e=r(t,this.helpers)}catch(e){throw this.handleError(e,t.proxyOf)}if("root"!==t.type&&"document"!==t.type&&!t.parent)return!0;if(g(e))throw this.getAsyncError()}}runOnRoot(e){this.result.lastPlugin=e;try{if("object"==typeof e&&e.Once){if("document"===this.result.root.type){let t=this.result.root.nodes.map((t=>e.Once(t,this.helpers)));return g(t[0])?Promise.all(t):t}return e.Once(this.result.root,this.helpers)}if("function"==typeof e)return e(this.result.root,this.result)}catch(e){throw this.handleError(e)}}getAsyncError(){throw new Error("Use process(css).then(cb) to work with async plugins")}handleError(e,t){let n=this.result.lastPlugin;try{t&&t.addToError(e),this.error=e,"CssSyntaxError"!==e.name||e.plugin?n.postcssVersion:(e.plugin=n.postcssPlugin,e.setMessage())}catch(e){console&&console.error&&console.error(e)}return e}async runAsync(){this.plugin=0;for(let e=0;e<this.plugins.length;e++){let t=this.plugins[e],n=this.runOnRoot(t);if(g(n))try{await n}catch(e){throw this.handleError(e)}}if(this.prepareVisitors(),this.hasListener){let e=this.result.root;for(;!e[r];){e[r]=!0;let t=[y(e)];for(;t.length>0;){let e=this.visitTick(t);if(g(e))try{await e}catch(e){let n=t[t.length-1].node;throw this.handleError(e,n)}}}if(this.listeners.OnceExit)for(let[t,n]of this.listeners.OnceExit){this.result.lastPlugin=t;try{if("document"===e.type){let t=e.nodes.map((e=>n(e,this.helpers)));await Promise.all(t)}else await n(e,this.helpers)}catch(e){throw this.handleError(e)}}}return this.processed=!0,this.stringify()}prepareVisitors(){this.listeners={};let e=(e,t,n)=>{this.listeners[t]||(this.listeners[t]=[]),this.listeners[t].push([e,n])};for(let t of this.plugins)if("object"==typeof t)for(let n in t){if(!p[n]&&/^[A-Z]/.test(n))throw new Error(`Unknown event ${n} in ${t.postcssPlugin}. Try to update PostCSS (${this.processor.version} now).`);if(!m[n])if("object"==typeof t[n])for(let r in t[n])e(t,"*"===r?n:n+"-"+r.toLowerCase(),t[n][r]);else"function"==typeof t[n]&&e(t,n,t[n])}this.hasListener=Object.keys(this.listeners).length>0}visitTick(e){let t=e[e.length-1],{node:n,visitors:i}=t;if("root"!==n.type&&"document"!==n.type&&!n.parent)return void e.pop();if(i.length>0&&t.visitorIndex<i.length){let[e,r]=i[t.visitorIndex];t.visitorIndex+=1,t.visitorIndex===i.length&&(t.visitors=[],t.visitorIndex=0),this.result.lastPlugin=e;try{return r(n.toProxy(),this.helpers)}catch(e){throw this.handleError(e,n)}}if(0!==t.iterator){let i,s=t.iterator;for(;i=n.nodes[n.indexes[s]];)if(n.indexes[s]+=1,!i[r])return i[r]=!0,void e.push(y(i));t.iterator=0,delete n.indexes[s]}let s=t.events;for(;t.eventIndex<s.length;){let e=s[t.eventIndex];if(t.eventIndex+=1,0===e)return void(n.nodes&&n.nodes.length&&(n[r]=!0,t.iterator=n.getIterator()));if(this.listeners[e])return void(t.visitors=this.listeners[e])}e.pop()}}w.registerPostcss=e=>{b=e},e.exports=w,w.default=w,u.registerLazyResult(w),l.registerLazyResult(w)},4715:e=>{"use strict";let t={split(e,t,n){let r=[],i="",s=!1,o=0,a=!1,l=!1;for(let n of e)l?l=!1:"\\"===n?l=!0:a?n===a&&(a=!1):'"'===n||"'"===n?a=n:"("===n?o+=1:")"===n?o>0&&(o-=1):0===o&&t.includes(n)&&(s=!0),s?(""!==i&&r.push(i.trim()),i="",s=!1):i+=n;return(n||""!==i)&&r.push(i.trim()),r},space:e=>t.split(e,[" ","\n","\t"]),comma:e=>t.split(e,[","],!0)};e.exports=t,t.default=t},8505:(e,t,n)=>{"use strict";let{SourceMapConsumer:r,SourceMapGenerator:i}=n(209),{dirname:s,resolve:o,relative:a,sep:l}=n(9830),{pathToFileURL:c}=n(7414),d=n(5995),u=Boolean(r&&i),h=Boolean(s&&o&&a&&l);e.exports=class{constructor(e,t,n,r){this.stringify=e,this.mapOpts=n.map||{},this.root=t,this.opts=n,this.css=r}isMap(){return void 0!==this.opts.map?!!this.opts.map:this.previous().length>0}previous(){if(!this.previousMaps)if(this.previousMaps=[],this.root)this.root.walk((e=>{if(e.source&&e.source.input.map){let t=e.source.input.map;this.previousMaps.includes(t)||this.previousMaps.push(t)}}));else{let e=new d(this.css,this.opts);e.map&&this.previousMaps.push(e.map)}return this.previousMaps}isInline(){if(void 0!==this.mapOpts.inline)return this.mapOpts.inline;let e=this.mapOpts.annotation;return(void 0===e||!0===e)&&(!this.previous().length||this.previous().some((e=>e.inline)))}isSourcesContent(){return void 0!==this.mapOpts.sourcesContent?this.mapOpts.sourcesContent:!this.previous().length||this.previous().some((e=>e.withContent()))}clearAnnotation(){if(!1!==this.mapOpts.annotation)if(this.root){let e;for(let t=this.root.nodes.length-1;t>=0;t--)e=this.root.nodes[t],"comment"===e.type&&0===e.text.indexOf("# sourceMappingURL=")&&this.root.removeChild(t)}else this.css&&(this.css=this.css.replace(/(\n)?\/\*#[\S\s]*?\*\/$/gm,""))}setSourcesContent(){let e={};if(this.root)this.root.walk((t=>{if(t.source){let n=t.source.input.from;n&&!e[n]&&(e[n]=!0,this.map.setSourceContent(this.toUrl(this.path(n)),t.source.input.css))}}));else if(this.css){let e=this.opts.from?this.toUrl(this.path(this.opts.from)):"<no source>";this.map.setSourceContent(e,this.css)}}applyPrevMaps(){for(let e of this.previous()){let t,n=this.toUrl(this.path(e.file)),i=e.root||s(e.file);!1===this.mapOpts.sourcesContent?(t=new r(e.text),t.sourcesContent&&(t.sourcesContent=t.sourcesContent.map((()=>null)))):t=e.consumer(),this.map.applySourceMap(t,n,this.toUrl(this.path(i)))}}isAnnotation(){return!!this.isInline()||(void 0!==this.mapOpts.annotation?this.mapOpts.annotation:!this.previous().length||this.previous().some((e=>e.annotation)))}toBase64(e){return Buffer?Buffer.from(e).toString("base64"):window.btoa(unescape(encodeURIComponent(e)))}addAnnotation(){let e;e=this.isInline()?"data:application/json;base64,"+this.toBase64(this.map.toString()):"string"==typeof this.mapOpts.annotation?this.mapOpts.annotation:"function"==typeof this.mapOpts.annotation?this.mapOpts.annotation(this.opts.to,this.root):this.outputFile()+".map";let t="\n";this.css.includes("\r\n")&&(t="\r\n"),this.css+=t+"/*# sourceMappingURL="+e+" */"}outputFile(){return this.opts.to?this.path(this.opts.to):this.opts.from?this.path(this.opts.from):"to.css"}generateMap(){if(this.root)this.generateString();else if(1===this.previous().length){let e=this.previous()[0].consumer();e.file=this.outputFile(),this.map=i.fromSourceMap(e)}else this.map=new i({file:this.outputFile()}),this.map.addMapping({source:this.opts.from?this.toUrl(this.path(this.opts.from)):"<no source>",generated:{line:1,column:0},original:{line:1,column:0}});return this.isSourcesContent()&&this.setSourcesContent(),this.root&&this.previous().length>0&&this.applyPrevMaps(),this.isAnnotation()&&this.addAnnotation(),this.isInline()?[this.css]:[this.css,this.map]}path(e){if(0===e.indexOf("<"))return e;if(/^\w+:\/\//.test(e))return e;if(this.mapOpts.absolute)return e;let t=this.opts.to?s(this.opts.to):".";return"string"==typeof this.mapOpts.annotation&&(t=s(o(t,this.mapOpts.annotation))),a(t,e)}toUrl(e){return"\\"===l&&(e=e.replace(/\\/g,"/")),encodeURI(e).replace(/[#?]/g,encodeURIComponent)}sourcePath(e){if(this.mapOpts.from)return this.toUrl(this.mapOpts.from);if(this.mapOpts.absolute){if(c)return c(e.source.input.from).toString();throw new Error("`map.absolute` option is not available in this PostCSS build")}return this.toUrl(this.path(e.source.input.from))}generateString(){this.css="",this.map=new i({file:this.outputFile()});let e,t,n=1,r=1,s="<no source>",o={source:"",generated:{line:0,column:0},original:{line:0,column:0}};this.stringify(this.root,((i,a,l)=>{if(this.css+=i,a&&"end"!==l&&(o.generated.line=n,o.generated.column=r-1,a.source&&a.source.start?(o.source=this.sourcePath(a),o.original.line=a.source.start.line,o.original.column=a.source.start.column-1,this.map.addMapping(o)):(o.source=s,o.original.line=1,o.original.column=0,this.map.addMapping(o))),e=i.match(/\n/g),e?(n+=e.length,t=i.lastIndexOf("\n"),r=i.length-t):r+=i.length,a&&"start"!==l){let e=a.parent||{raws:{}};("decl"!==a.type||a!==e.last||e.raws.semicolon)&&(a.source&&a.source.end?(o.source=this.sourcePath(a),o.original.line=a.source.end.line,o.original.column=a.source.end.column-1,o.generated.line=n,o.generated.column=r-2,this.map.addMapping(o)):(o.source=s,o.original.line=1,o.original.column=0,o.generated.line=n,o.generated.column=r-1,this.map.addMapping(o)))}}))}generate(){if(this.clearAnnotation(),h&&u&&this.isMap())return this.generateMap();{let e="";return this.stringify(this.root,(t=>{e+=t})),[e]}}}},7647:(e,t,n)=>{"use strict";let r=n(8505),i=n(7088),s=(n(2448),n(6939));const o=n(3632);class a{constructor(e,t,n){let s;t=t.toString(),this.stringified=!1,this._processor=e,this._css=t,this._opts=n,this._map=void 0;let a=i;this.result=new o(this._processor,s,this._opts),this.result.css=t;let l=this;Object.defineProperty(this.result,"root",{get:()=>l.root});let c=new r(a,s,this._opts,t);if(c.isMap()){let[e,t]=c.generate();e&&(this.result.css=e),t&&(this.result.map=t)}}get[Symbol.toStringTag](){return"NoWorkResult"}get processor(){return this.result.processor}get opts(){return this.result.opts}get css(){return this.result.css}get content(){return this.result.css}get map(){return this.result.map}get root(){if(this._root)return this._root;let e,t=s;try{e=t(this._css,this._opts)}catch(e){this.error=e}if(this.error)throw this.error;return this._root=e,e}get messages(){return[]}warnings(){return[]}toString(){return this._css}then(e,t){return this.async().then(e,t)}catch(e){return this.async().catch(e)}finally(e){return this.async().then(e,e)}async(){return this.error?Promise.reject(this.error):Promise.resolve(this.result)}sync(){if(this.error)throw this.error;return this.result}}e.exports=a,a.default=a},5631:(e,t,n)=>{"use strict";let{isClean:r,my:i}=n(5513),s=n(2671),o=n(1062),a=n(7088);function l(e,t){let n=new e.constructor;for(let r in e){if(!Object.prototype.hasOwnProperty.call(e,r))continue;if("proxyCache"===r)continue;let i=e[r],s=typeof i;"parent"===r&&"object"===s?t&&(n[r]=t):"source"===r?n[r]=i:Array.isArray(i)?n[r]=i.map((e=>l(e,n))):("object"===s&&null!==i&&(i=l(i)),n[r]=i)}return n}class c{constructor(e={}){this.raws={},this[r]=!1,this[i]=!0;for(let t in e)if("nodes"===t){this.nodes=[];for(let n of e[t])"function"==typeof n.clone?this.append(n.clone()):this.append(n)}else this[t]=e[t]}error(e,t={}){if(this.source){let{start:n,end:r}=this.rangeBy(t);return this.source.input.error(e,{line:n.line,column:n.column},{line:r.line,column:r.column},t)}return new s(e)}warn(e,t,n){let r={node:this};for(let e in n)r[e]=n[e];return e.warn(t,r)}remove(){return this.parent&&this.parent.removeChild(this),this.parent=void 0,this}toString(e=a){e.stringify&&(e=e.stringify);let t="";return e(this,(e=>{t+=e})),t}assign(e={}){for(let t in e)this[t]=e[t];return this}clone(e={}){let t=l(this);for(let n in e)t[n]=e[n];return t}cloneBefore(e={}){let t=this.clone(e);return this.parent.insertBefore(this,t),t}cloneAfter(e={}){let t=this.clone(e);return this.parent.insertAfter(this,t),t}replaceWith(...e){if(this.parent){let t=this,n=!1;for(let r of e)r===this?n=!0:n?(this.parent.insertAfter(t,r),t=r):this.parent.insertBefore(t,r);n||this.remove()}return this}next(){if(!this.parent)return;let e=this.parent.index(this);return this.parent.nodes[e+1]}prev(){if(!this.parent)return;let e=this.parent.index(this);return this.parent.nodes[e-1]}before(e){return this.parent.insertBefore(this,e),this}after(e){return this.parent.insertAfter(this,e),this}root(){let e=this;for(;e.parent&&"document"!==e.parent.type;)e=e.parent;return e}raw(e,t){return(new o).raw(this,e,t)}cleanRaws(e){delete this.raws.before,delete this.raws.after,e||delete this.raws.between}toJSON(e,t){let n={},r=null==t;t=t||new Map;let i=0;for(let e in this){if(!Object.prototype.hasOwnProperty.call(this,e))continue;if("parent"===e||"proxyCache"===e)continue;let r=this[e];if(Array.isArray(r))n[e]=r.map((e=>"object"==typeof e&&e.toJSON?e.toJSON(null,t):e));else if("object"==typeof r&&r.toJSON)n[e]=r.toJSON(null,t);else if("source"===e){let s=t.get(r.input);null==s&&(s=i,t.set(r.input,i),i++),n[e]={inputId:s,start:r.start,end:r.end}}else n[e]=r}return r&&(n.inputs=[...t.keys()].map((e=>e.toJSON()))),n}positionInside(e){let t=this.toString(),n=this.source.start.column,r=this.source.start.line;for(let i=0;i<e;i++)"\n"===t[i]?(n=1,r+=1):n+=1;return{line:r,column:n}}positionBy(e){let t=this.source.start;if(e.index)t=this.positionInside(e.index);else if(e.word){let n=this.toString().indexOf(e.word);-1!==n&&(t=this.positionInside(n))}return t}rangeBy(e){let t={line:this.source.start.line,column:this.source.start.column},n=this.source.end?{line:this.source.end.line,column:this.source.end.column+1}:{line:t.line,column:t.column+1};if(e.word){let r=this.toString().indexOf(e.word);-1!==r&&(t=this.positionInside(r),n=this.positionInside(r+e.word.length))}else e.start?t={line:e.start.line,column:e.start.column}:e.index&&(t=this.positionInside(e.index)),e.end?n={line:e.end.line,column:e.end.column}:e.endIndex?n=this.positionInside(e.endIndex):e.index&&(n=this.positionInside(e.index+1));return(n.line<t.line||n.line===t.line&&n.column<=t.column)&&(n={line:t.line,column:t.column+1}),{start:t,end:n}}getProxyProcessor(){return{set:(e,t,n)=>(e[t]===n||(e[t]=n,"prop"!==t&&"value"!==t&&"name"!==t&&"params"!==t&&"important"!==t&&"text"!==t||e.markDirty()),!0),get:(e,t)=>"proxyOf"===t?e:"root"===t?()=>e.root().toProxy():e[t]}}toProxy(){return this.proxyCache||(this.proxyCache=new Proxy(this,this.getProxyProcessor())),this.proxyCache}addToError(e){if(e.postcssNode=this,e.stack&&this.source&&/\n\s{4}at /.test(e.stack)){let t=this.source;e.stack=e.stack.replace(/\n\s{4}at /,`$&${t.input.from}:${t.start.line}:${t.start.column}$&`)}return e}markDirty(){if(this[r]){this[r]=!1;let e=this;for(;e=e.parent;)e[r]=!1}}get proxyOf(){return this}}e.exports=c,c.default=c},6939:(e,t,n)=>{"use strict";let r=n(1019),i=n(8867),s=n(5995);function o(e,t){let n=new s(e,t),r=new i(n);try{r.parse()}catch(e){throw e}return r.root}e.exports=o,o.default=o,r.registerParse(o)},8867:(e,t,n)=>{"use strict";let r=n(4258),i=n(3852),s=n(9932),o=n(1353),a=n(1025),l=n(1675);e.exports=class{constructor(e){this.input=e,this.root=new a,this.current=this.root,this.spaces="",this.semicolon=!1,this.customProperty=!1,this.createTokenizer(),this.root.source={input:e,start:{offset:0,line:1,column:1}}}createTokenizer(){this.tokenizer=i(this.input)}parse(){let e;for(;!this.tokenizer.endOfFile();)switch(e=this.tokenizer.nextToken(),e[0]){case"space":this.spaces+=e[1];break;case";":this.freeSemicolon(e);break;case"}":this.end(e);break;case"comment":this.comment(e);break;case"at-word":this.atrule(e);break;case"{":this.emptyRule(e);break;default:this.other(e)}this.endFile()}comment(e){let t=new s;this.init(t,e[2]),t.source.end=this.getPosition(e[3]||e[2]);let n=e[1].slice(2,-2);if(/^\s*$/.test(n))t.text="",t.raws.left=n,t.raws.right="";else{let e=n.match(/^(\s*)([^]*\S)(\s*)$/);t.text=e[2],t.raws.left=e[1],t.raws.right=e[3]}}emptyRule(e){let t=new l;this.init(t,e[2]),t.selector="",t.raws.between="",this.current=t}other(e){let t=!1,n=null,r=!1,i=null,s=[],o=e[1].startsWith("--"),a=[],l=e;for(;l;){if(n=l[0],a.push(l),"("===n||"["===n)i||(i=l),s.push("("===n?")":"]");else if(o&&r&&"{"===n)i||(i=l),s.push("}");else if(0===s.length){if(";"===n){if(r)return void this.decl(a,o);break}if("{"===n)return void this.rule(a);if("}"===n){this.tokenizer.back(a.pop()),t=!0;break}":"===n&&(r=!0)}else n===s[s.length-1]&&(s.pop(),0===s.length&&(i=null));l=this.tokenizer.nextToken()}if(this.tokenizer.endOfFile()&&(t=!0),s.length>0&&this.unclosedBracket(i),t&&r){if(!o)for(;a.length&&(l=a[a.length-1][0],"space"===l||"comment"===l);)this.tokenizer.back(a.pop());this.decl(a,o)}else this.unknownWord(a)}rule(e){e.pop();let t=new l;this.init(t,e[0][2]),t.raws.between=this.spacesAndCommentsFromEnd(e),this.raw(t,"selector",e),this.current=t}decl(e,t){let n=new r;this.init(n,e[0][2]);let i,s=e[e.length-1];for(";"===s[0]&&(this.semicolon=!0,e.pop()),n.source.end=this.getPosition(s[3]||s[2]);"word"!==e[0][0];)1===e.length&&this.unknownWord(e),n.raws.before+=e.shift()[1];for(n.source.start=this.getPosition(e[0][2]),n.prop="";e.length;){let t=e[0][0];if(":"===t||"space"===t||"comment"===t)break;n.prop+=e.shift()[1]}for(n.raws.between="";e.length;){if(i=e.shift(),":"===i[0]){n.raws.between+=i[1];break}"word"===i[0]&&/\w/.test(i[1])&&this.unknownWord([i]),n.raws.between+=i[1]}"_"!==n.prop[0]&&"*"!==n.prop[0]||(n.raws.before+=n.prop[0],n.prop=n.prop.slice(1));let o,a=[];for(;e.length&&(o=e[0][0],"space"===o||"comment"===o);)a.push(e.shift());this.precheckMissedSemicolon(e);for(let t=e.length-1;t>=0;t--){if(i=e[t],"!important"===i[1].toLowerCase()){n.important=!0;let r=this.stringFrom(e,t);r=this.spacesFromEnd(e)+r," !important"!==r&&(n.raws.important=r);break}if("important"===i[1].toLowerCase()){let r=e.slice(0),i="";for(let e=t;e>0;e--){let t=r[e][0];if(0===i.trim().indexOf("!")&&"space"!==t)break;i=r.pop()[1]+i}0===i.trim().indexOf("!")&&(n.important=!0,n.raws.important=i,e=r)}if("space"!==i[0]&&"comment"!==i[0])break}e.some((e=>"space"!==e[0]&&"comment"!==e[0]))&&(n.raws.between+=a.map((e=>e[1])).join(""),a=[]),this.raw(n,"value",a.concat(e),t),n.value.includes(":")&&!t&&this.checkMissedSemicolon(e)}atrule(e){let t,n,r,i=new o;i.name=e[1].slice(1),""===i.name&&this.unnamedAtrule(i,e),this.init(i,e[2]);let s=!1,a=!1,l=[],c=[];for(;!this.tokenizer.endOfFile();){if(t=(e=this.tokenizer.nextToken())[0],"("===t||"["===t?c.push("("===t?")":"]"):"{"===t&&c.length>0?c.push("}"):t===c[c.length-1]&&c.pop(),0===c.length){if(";"===t){i.source.end=this.getPosition(e[2]),this.semicolon=!0;break}if("{"===t){a=!0;break}if("}"===t){if(l.length>0){for(r=l.length-1,n=l[r];n&&"space"===n[0];)n=l[--r];n&&(i.source.end=this.getPosition(n[3]||n[2]))}this.end(e);break}l.push(e)}else l.push(e);if(this.tokenizer.endOfFile()){s=!0;break}}i.raws.between=this.spacesAndCommentsFromEnd(l),l.length?(i.raws.afterName=this.spacesAndCommentsFromStart(l),this.raw(i,"params",l),s&&(e=l[l.length-1],i.source.end=this.getPosition(e[3]||e[2]),this.spaces=i.raws.between,i.raws.between="")):(i.raws.afterName="",i.params=""),a&&(i.nodes=[],this.current=i)}end(e){this.current.nodes&&this.current.nodes.length&&(this.current.raws.semicolon=this.semicolon),this.semicolon=!1,this.current.raws.after=(this.current.raws.after||"")+this.spaces,this.spaces="",this.current.parent?(this.current.source.end=this.getPosition(e[2]),this.current=this.current.parent):this.unexpectedClose(e)}endFile(){this.current.parent&&this.unclosedBlock(),this.current.nodes&&this.current.nodes.length&&(this.current.raws.semicolon=this.semicolon),this.current.raws.after=(this.current.raws.after||"")+this.spaces}freeSemicolon(e){if(this.spaces+=e[1],this.current.nodes){let e=this.current.nodes[this.current.nodes.length-1];e&&"rule"===e.type&&!e.raws.ownSemicolon&&(e.raws.ownSemicolon=this.spaces,this.spaces="")}}getPosition(e){let t=this.input.fromOffset(e);return{offset:e,line:t.line,column:t.col}}init(e,t){this.current.push(e),e.source={start:this.getPosition(t),input:this.input},e.raws.before=this.spaces,this.spaces="","comment"!==e.type&&(this.semicolon=!1)}raw(e,t,n,r){let i,s,o,a,l=n.length,c="",d=!0;for(let e=0;e<l;e+=1)i=n[e],s=i[0],"space"!==s||e!==l-1||r?"comment"===s?(a=n[e-1],o=n[e+1],a&&o&&"space"!==a[0]&&"space"!==o[0]?c+=i[1]:d=!1):c+=i[1]:d=!1;if(!d){let r=n.reduce(((e,t)=>e+t[1]),"");e.raws[t]={value:c,raw:r}}e[t]=c}spacesAndCommentsFromEnd(e){let t,n="";for(;e.length&&(t=e[e.length-1][0],"space"===t||"comment"===t);)n=e.pop()[1]+n;return n}spacesAndCommentsFromStart(e){let t,n="";for(;e.length&&(t=e[0][0],"space"===t||"comment"===t);)n+=e.shift()[1];return n}spacesFromEnd(e){let t,n="";for(;e.length&&(t=e[e.length-1][0],"space"===t);)n=e.pop()[1]+n;return n}stringFrom(e,t){let n="";for(let r=t;r<e.length;r++)n+=e[r][1];return e.splice(t,e.length-t),n}colon(e){let t,n,r,i=0;for(let[s,o]of e.entries()){if(t=o,n=t[0],"("===n&&(i+=1),")"===n&&(i-=1),0===i&&":"===n){if(r){if("word"===r[0]&&"progid"===r[1])continue;return s}this.doubleColon(t)}r=t}return!1}unclosedBracket(e){throw this.input.error("Unclosed bracket",{offset:e[2]},{offset:e[2]+1})}unknownWord(e){throw this.input.error("Unknown word",{offset:e[0][2]},{offset:e[0][2]+e[0][1].length})}unexpectedClose(e){throw this.input.error("Unexpected }",{offset:e[2]},{offset:e[2]+1})}unclosedBlock(){let e=this.current.source.start;throw this.input.error("Unclosed block",e.line,e.column)}doubleColon(e){throw this.input.error("Double colon",{offset:e[2]},{offset:e[2]+e[1].length})}unnamedAtrule(e,t){throw this.input.error("At-rule without name",{offset:t[2]},{offset:t[2]+t[1].length})}precheckMissedSemicolon(){}checkMissedSemicolon(e){let t=this.colon(e);if(!1===t)return;let n,r=0;for(let i=t-1;i>=0&&(n=e[i],"space"===n[0]||(r+=1,2!==r));i--);throw this.input.error("Missed semicolon","word"===n[0]?n[3]+1:n[2])}}},20:(e,t,n)=>{"use strict";let r=n(2671),i=n(4258),s=n(1939),o=n(1019),a=n(1723),l=n(7088),c=n(250),d=n(6461),u=n(1728),h=n(9932),p=n(1353),m=n(3632),g=n(5995),f=n(6939),y=n(4715),v=n(1675),b=n(1025),w=n(5631);function S(...e){return 1===e.length&&Array.isArray(e[0])&&(e=e[0]),new a(e)}S.plugin=function(e,t){function n(...n){let r=t(...n);return r.postcssPlugin=e,r.postcssVersion=(new a).version,r}let r;return console&&console.warn&&(console.warn(e+": postcss.plugin was deprecated. Migration guide:\nhttps://evilmartians.com/chronicles/postcss-8-plugin-migration"),process.env.LANG&&process.env.LANG.startsWith("cn")&&console.warn(e+":  postcss.plugin . :\nhttps://www.w3ctech.com/topic/2226")),Object.defineProperty(n,"postcss",{get:()=>(r||(r=n()),r)}),n.process=function(e,t,r){return S([n(r)]).process(e,t)},n},S.stringify=l,S.parse=f,S.fromJSON=c,S.list=y,S.comment=e=>new h(e),S.atRule=e=>new p(e),S.decl=e=>new i(e),S.rule=e=>new v(e),S.root=e=>new b(e),S.document=e=>new d(e),S.CssSyntaxError=r,S.Declaration=i,S.Container=o,S.Processor=a,S.Document=d,S.Comment=h,S.Warning=u,S.AtRule=p,S.Result=m,S.Input=g,S.Rule=v,S.Root=b,S.Node=w,s.registerPostcss(S),e.exports=S,S.default=S},7981:(e,t,n)=>{"use strict";let{SourceMapConsumer:r,SourceMapGenerator:i}=n(209),{existsSync:s,readFileSync:o}=n(4777),{dirname:a,join:l}=n(9830);class c{constructor(e,t){if(!1===t.map)return;this.loadAnnotation(e),this.inline=this.startWith(this.annotation,"data:");let n=t.map?t.map.prev:void 0,r=this.loadMap(t.from,n);!this.mapFile&&t.from&&(this.mapFile=t.from),this.mapFile&&(this.root=a(this.mapFile)),r&&(this.text=r)}consumer(){return this.consumerCache||(this.consumerCache=new r(this.text)),this.consumerCache}withContent(){return!!(this.consumer().sourcesContent&&this.consumer().sourcesContent.length>0)}startWith(e,t){return!!e&&e.substr(0,t.length)===t}getAnnotationURL(e){return e.replace(/^\/\*\s*# sourceMappingURL=/,"").trim()}loadAnnotation(e){let t=e.match(/\/\*\s*# sourceMappingURL=/gm);if(!t)return;let n=e.lastIndexOf(t.pop()),r=e.indexOf("*/",n);n>-1&&r>-1&&(this.annotation=this.getAnnotationURL(e.substring(n,r)))}decodeInline(e){if(/^data:application\/json;charset=utf-?8,/.test(e)||/^data:application\/json,/.test(e))return decodeURIComponent(e.substr(RegExp.lastMatch.length));if(/^data:application\/json;charset=utf-?8;base64,/.test(e)||/^data:application\/json;base64,/.test(e))return t=e.substr(RegExp.lastMatch.length),Buffer?Buffer.from(t,"base64").toString():window.atob(t);var t;let n=e.match(/data:application\/json;([^,]+),/)[1];throw new Error("Unsupported source map encoding "+n)}loadFile(e){if(this.root=a(e),s(e))return this.mapFile=e,o(e,"utf-8").toString().trim()}loadMap(e,t){if(!1===t)return!1;if(t){if("string"==typeof t)return t;if("function"!=typeof t){if(t instanceof r)return i.fromSourceMap(t).toString();if(t instanceof i)return t.toString();if(this.isMap(t))return JSON.stringify(t);throw new Error("Unsupported previous source map format: "+t.toString())}{let n=t(e);if(n){let e=this.loadFile(n);if(!e)throw new Error("Unable to load previous source map: "+n.toString());return e}}}else{if(this.inline)return this.decodeInline(this.annotation);if(this.annotation){let t=this.annotation;return e&&(t=l(a(e),t)),this.loadFile(t)}}}isMap(e){return"object"==typeof e&&("string"==typeof e.mappings||"string"==typeof e._mappings||Array.isArray(e.sections))}}e.exports=c,c.default=c},1723:(e,t,n)=>{"use strict";let r=n(7647),i=n(1939),s=n(6461),o=n(1025);class a{constructor(e=[]){this.version="8.4.6",this.plugins=this.normalize(e)}use(e){return this.plugins=this.plugins.concat(this.normalize([e])),this}process(e,t={}){return 0===this.plugins.length&&void 0===t.parser&&void 0===t.stringifier&&void 0===t.syntax?new r(this,e,t):new i(this,e,t)}normalize(e){let t=[];for(let n of e)if(!0===n.postcss?n=n():n.postcss&&(n=n.postcss),"object"==typeof n&&Array.isArray(n.plugins))t=t.concat(n.plugins);else if("object"==typeof n&&n.postcssPlugin)t.push(n);else if("function"==typeof n)t.push(n);else if("object"!=typeof n||!n.parse&&!n.stringify)throw new Error(n+" is not a PostCSS plugin");return t}}e.exports=a,a.default=a,o.registerProcessor(a),s.registerProcessor(a)},3632:(e,t,n)=>{"use strict";let r=n(1728);class i{constructor(e,t,n){this.processor=e,this.messages=[],this.root=t,this.opts=n,this.css=void 0,this.map=void 0}toString(){return this.css}warn(e,t={}){t.plugin||this.lastPlugin&&this.lastPlugin.postcssPlugin&&(t.plugin=this.lastPlugin.postcssPlugin);let n=new r(e,t);return this.messages.push(n),n}warnings(){return this.messages.filter((e=>"warning"===e.type))}get content(){return this.css}}e.exports=i,i.default=i},1025:(e,t,n)=>{"use strict";let r,i,s=n(1019);class o extends s{constructor(e){super(e),this.type="root",this.nodes||(this.nodes=[])}removeChild(e,t){let n=this.index(e);return!t&&0===n&&this.nodes.length>1&&(this.nodes[1].raws.before=this.nodes[n].raws.before),super.removeChild(e)}normalize(e,t,n){let r=super.normalize(e);if(t)if("prepend"===n)this.nodes.length>1?t.raws.before=this.nodes[1].raws.before:delete t.raws.before;else if(this.first!==t)for(let e of r)e.raws.before=t.raws.before;return r}toResult(e={}){return new r(new i,this,e).stringify()}}o.registerLazyResult=e=>{r=e},o.registerProcessor=e=>{i=e},e.exports=o,o.default=o},1675:(e,t,n)=>{"use strict";let r=n(1019),i=n(4715);class s extends r{constructor(e){super(e),this.type="rule",this.nodes||(this.nodes=[])}get selectors(){return i.comma(this.selector)}set selectors(e){let t=this.selector?this.selector.match(/,\s*/):null,n=t?t[0]:","+this.raw("between","beforeOpen");this.selector=e.join(n)}}e.exports=s,s.default=s,r.registerRule(s)},1062:e=>{"use strict";const t={colon:": ",indent:"    ",beforeDecl:"\n",beforeRule:"\n",beforeOpen:" ",beforeClose:"\n",beforeComment:"\n",after:"\n",emptyBody:"",commentLeft:" ",commentRight:" ",semicolon:!1};class n{constructor(e){this.builder=e}stringify(e,t){if(!this[e.type])throw new Error("Unknown AST node type "+e.type+". Maybe you need to change PostCSS stringifier.");this[e.type](e,t)}document(e){this.body(e)}root(e){this.body(e),e.raws.after&&this.builder(e.raws.after)}comment(e){let t=this.raw(e,"left","commentLeft"),n=this.raw(e,"right","commentRight");this.builder("/*"+t+e.text+n+"*/",e)}decl(e,t){let n=this.raw(e,"between","colon"),r=e.prop+n+this.rawValue(e,"value");e.important&&(r+=e.raws.important||" !important"),t&&(r+=";"),this.builder(r,e)}rule(e){this.block(e,this.rawValue(e,"selector")),e.raws.ownSemicolon&&this.builder(e.raws.ownSemicolon,e,"end")}atrule(e,t){let n="@"+e.name,r=e.params?this.rawValue(e,"params"):"";if(void 0!==e.raws.afterName?n+=e.raws.afterName:r&&(n+=" "),e.nodes)this.block(e,n+r);else{let i=(e.raws.between||"")+(t?";":"");this.builder(n+r+i,e)}}body(e){let t=e.nodes.length-1;for(;t>0&&"comment"===e.nodes[t].type;)t-=1;let n=this.raw(e,"semicolon");for(let r=0;r<e.nodes.length;r++){let i=e.nodes[r],s=this.raw(i,"before");s&&this.builder(s),this.stringify(i,t!==r||n)}}block(e,t){let n,r=this.raw(e,"between","beforeOpen");this.builder(t+r+"{",e,"start"),e.nodes&&e.nodes.length?(this.body(e),n=this.raw(e,"after")):n=this.raw(e,"after","emptyBody"),n&&this.builder(n),this.builder("}",e,"end")}raw(e,n,r){let i;if(r||(r=n),n&&(i=e.raws[n],void 0!==i))return i;let s=e.parent;if("before"===r){if(!s||"root"===s.type&&s.first===e)return"";if(s&&"document"===s.type)return""}if(!s)return t[r];let o=e.root();if(o.rawCache||(o.rawCache={}),void 0!==o.rawCache[r])return o.rawCache[r];if("before"===r||"after"===r)return this.beforeAfter(e,r);{let t="raw"+((a=r)[0].toUpperCase()+a.slice(1));this[t]?i=this[t](o,e):o.walk((e=>{if(i=e.raws[n],void 0!==i)return!1}))}var a;return void 0===i&&(i=t[r]),o.rawCache[r]=i,i}rawSemicolon(e){let t;return e.walk((e=>{if(e.nodes&&e.nodes.length&&"decl"===e.last.type&&(t=e.raws.semicolon,void 0!==t))return!1})),t}rawEmptyBody(e){let t;return e.walk((e=>{if(e.nodes&&0===e.nodes.length&&(t=e.raws.after,void 0!==t))return!1})),t}rawIndent(e){if(e.raws.indent)return e.raws.indent;let t;return e.walk((n=>{let r=n.parent;if(r&&r!==e&&r.parent&&r.parent===e&&void 0!==n.raws.before){let e=n.raws.before.split("\n");return t=e[e.length-1],t=t.replace(/\S/g,""),!1}})),t}rawBeforeComment(e,t){let n;return e.walkComments((e=>{if(void 0!==e.raws.before)return n=e.raws.before,n.includes("\n")&&(n=n.replace(/[^\n]+$/,"")),!1})),void 0===n?n=this.raw(t,null,"beforeDecl"):n&&(n=n.replace(/\S/g,"")),n}rawBeforeDecl(e,t){let n;return e.walkDecls((e=>{if(void 0!==e.raws.before)return n=e.raws.before,n.includes("\n")&&(n=n.replace(/[^\n]+$/,"")),!1})),void 0===n?n=this.raw(t,null,"beforeRule"):n&&(n=n.replace(/\S/g,"")),n}rawBeforeRule(e){let t;return e.walk((n=>{if(n.nodes&&(n.parent!==e||e.first!==n)&&void 0!==n.raws.before)return t=n.raws.before,t.includes("\n")&&(t=t.replace(/[^\n]+$/,"")),!1})),t&&(t=t.replace(/\S/g,"")),t}rawBeforeClose(e){let t;return e.walk((e=>{if(e.nodes&&e.nodes.length>0&&void 0!==e.raws.after)return t=e.raws.after,t.includes("\n")&&(t=t.replace(/[^\n]+$/,"")),!1})),t&&(t=t.replace(/\S/g,"")),t}rawBeforeOpen(e){let t;return e.walk((e=>{if("decl"!==e.type&&(t=e.raws.between,void 0!==t))return!1})),t}rawColon(e){let t;return e.walkDecls((e=>{if(void 0!==e.raws.between)return t=e.raws.between.replace(/[^\s:]/g,""),!1})),t}beforeAfter(e,t){let n;n="decl"===e.type?this.raw(e,null,"beforeDecl"):"comment"===e.type?this.raw(e,null,"beforeComment"):"before"===t?this.raw(e,null,"beforeRule"):this.raw(e,null,"beforeClose");let r=e.parent,i=0;for(;r&&"root"!==r.type;)i+=1,r=r.parent;if(n.includes("\n")){let t=this.raw(e,null,"indent");if(t.length)for(let e=0;e<i;e++)n+=t}return n}rawValue(e,t){let n=e[t],r=e.raws[t];return r&&r.value===n?r.raw:n}}e.exports=n,n.default=n},7088:(e,t,n)=>{"use strict";let r=n(1062);function i(e,t){new r(t).stringify(e)}e.exports=i,i.default=i},5513:e=>{"use strict";e.exports.isClean=Symbol("isClean"),e.exports.my=Symbol("my")},3852:e=>{"use strict";const t="'".charCodeAt(0),n='"'.charCodeAt(0),r="\\".charCodeAt(0),i="/".charCodeAt(0),s="\n".charCodeAt(0),o=" ".charCodeAt(0),a="\f".charCodeAt(0),l="\t".charCodeAt(0),c="\r".charCodeAt(0),d="[".charCodeAt(0),u="]".charCodeAt(0),h="(".charCodeAt(0),p=")".charCodeAt(0),m="{".charCodeAt(0),g="}".charCodeAt(0),f=";".charCodeAt(0),y="*".charCodeAt(0),v=":".charCodeAt(0),b="@".charCodeAt(0),w=/[\t\n\f\r "#'()/;[\\\]{}]/g,S=/[\t\n\f\r !"#'():;@[\\\]{}]|\/(?=\*)/g,_=/.[\n"'(/\\]/,k=/[\da-f]/i;e.exports=function(e,x={}){let E,T,C,A,I,R,O,P,M,D,L=e.css.valueOf(),F=x.ignoreErrors,N=L.length,j=0,U=[],B=[];function q(t){throw e.error("Unclosed "+t,j)}return{back:function(e){B.push(e)},nextToken:function(e){if(B.length)return B.pop();if(j>=N)return;let x=!!e&&e.ignoreUnclosed;switch(E=L.charCodeAt(j),E){case s:case o:case l:case c:case a:T=j;do{T+=1,E=L.charCodeAt(T)}while(E===o||E===s||E===l||E===c||E===a);D=["space",L.slice(j,T)],j=T-1;break;case d:case u:case m:case g:case v:case f:case p:{let e=String.fromCharCode(E);D=[e,e,j];break}case h:if(P=U.length?U.pop()[1]:"",M=L.charCodeAt(j+1),"url"===P&&M!==t&&M!==n&&M!==o&&M!==s&&M!==l&&M!==a&&M!==c){T=j;do{if(R=!1,T=L.indexOf(")",T+1),-1===T){if(F||x){T=j;break}q("bracket")}for(O=T;L.charCodeAt(O-1)===r;)O-=1,R=!R}while(R);D=["brackets",L.slice(j,T+1),j,T],j=T}else T=L.indexOf(")",j+1),A=L.slice(j,T+1),-1===T||_.test(A)?D=["(","(",j]:(D=["brackets",A,j,T],j=T);break;case t:case n:C=E===t?"'":'"',T=j;do{if(R=!1,T=L.indexOf(C,T+1),-1===T){if(F||x){T=j+1;break}q("string")}for(O=T;L.charCodeAt(O-1)===r;)O-=1,R=!R}while(R);D=["string",L.slice(j,T+1),j,T],j=T;break;case b:w.lastIndex=j+1,w.test(L),T=0===w.lastIndex?L.length-1:w.lastIndex-2,D=["at-word",L.slice(j,T+1),j,T],j=T;break;case r:for(T=j,I=!0;L.charCodeAt(T+1)===r;)T+=1,I=!I;if(E=L.charCodeAt(T+1),I&&E!==i&&E!==o&&E!==s&&E!==l&&E!==c&&E!==a&&(T+=1,k.test(L.charAt(T)))){for(;k.test(L.charAt(T+1));)T+=1;L.charCodeAt(T+1)===o&&(T+=1)}D=["word",L.slice(j,T+1),j,T],j=T;break;default:E===i&&L.charCodeAt(j+1)===y?(T=L.indexOf("*/",j+2)+1,0===T&&(F||x?T=L.length:q("comment")),D=["comment",L.slice(j,T+1),j,T],j=T):(S.lastIndex=j+1,S.test(L),T=0===S.lastIndex?L.length-1:S.lastIndex-2,D=["word",L.slice(j,T+1),j,T],U.push(D),j=T)}return j++,D},endOfFile:function(){return 0===B.length&&j>=N},position:function(){return j}}}},2448:e=>{"use strict";let t={};e.exports=function(e){t[e]||(t[e]=!0,"undefined"!=typeof console&&console.warn&&console.warn(e))}},1728:e=>{"use strict";class t{constructor(e,t={}){if(this.type="warning",this.text=e,t.node&&t.node.source){let e=t.node.rangeBy(t);this.line=e.start.line,this.column=e.start.column,this.endLine=e.end.line,this.endColumn=e.end.column}for(let e in t)this[e]=t[e]}toString(){return this.node?this.node.error(this.text,{plugin:this.plugin,index:this.index,word:this.word}).message:this.plugin?this.plugin+": "+this.text:this.text}}e.exports=t,t.default=t},5798:e=>{"use strict";var t=String.prototype.replace,n=/%20/g,r="RFC3986";e.exports={default:r,formatters:{RFC1738:function(e){return t.call(e,n,"+")},RFC3986:function(e){return String(e)}},RFC1738:"RFC1738",RFC3986:r}},129:(e,t,n)=>{"use strict";var r=n(8261),i=n(5235),s=n(5798);e.exports={formats:s,parse:i,stringify:r}},5235:(e,t,n)=>{"use strict";var r=n(2769),i=Object.prototype.hasOwnProperty,s=Array.isArray,o={allowDots:!1,allowPrototypes:!1,allowSparse:!1,arrayLimit:20,charset:"utf-8",charsetSentinel:!1,comma:!1,decoder:r.decode,delimiter:"&",depth:5,ignoreQueryPrefix:!1,interpretNumericEntities:!1,parameterLimit:1e3,parseArrays:!0,plainObjects:!1,strictNullHandling:!1},a=function(e){return e.replace(/&#(\d+);/g,(function(e,t){return String.fromCharCode(parseInt(t,10))}))},l=function(e,t){return e&&"string"==typeof e&&t.comma&&e.indexOf(",")>-1?e.split(","):e},c=function(e,t,n,r){if(e){var s=n.allowDots?e.replace(/\.([^.[]+)/g,"[$1]"):e,o=/(\[[^[\]]*])/g,a=n.depth>0&&/(\[[^[\]]*])/.exec(s),c=a?s.slice(0,a.index):s,d=[];if(c){if(!n.plainObjects&&i.call(Object.prototype,c)&&!n.allowPrototypes)return;d.push(c)}for(var u=0;n.depth>0&&null!==(a=o.exec(s))&&u<n.depth;){if(u+=1,!n.plainObjects&&i.call(Object.prototype,a[1].slice(1,-1))&&!n.allowPrototypes)return;d.push(a[1])}return a&&d.push("["+s.slice(a.index)+"]"),function(e,t,n,r){for(var i=r?t:l(t,n),s=e.length-1;s>=0;--s){var o,a=e[s];if("[]"===a&&n.parseArrays)o=[].concat(i);else{o=n.plainObjects?Object.create(null):{};var c="["===a.charAt(0)&&"]"===a.charAt(a.length-1)?a.slice(1,-1):a,d=parseInt(c,10);n.parseArrays||""!==c?!isNaN(d)&&a!==c&&String(d)===c&&d>=0&&n.parseArrays&&d<=n.arrayLimit?(o=[])[d]=i:o[c]=i:o={0:i}}i=o}return i}(d,t,n,r)}};e.exports=function(e,t){var n=function(e){if(!e)return o;if(null!==e.decoder&&void 0!==e.decoder&&"function"!=typeof e.decoder)throw new TypeError("Decoder has to be a function.");if(void 0!==e.charset&&"utf-8"!==e.charset&&"iso-8859-1"!==e.charset)throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");var t=void 0===e.charset?o.charset:e.charset;return{allowDots:void 0===e.allowDots?o.allowDots:!!e.allowDots,allowPrototypes:"boolean"==typeof e.allowPrototypes?e.allowPrototypes:o.allowPrototypes,allowSparse:"boolean"==typeof e.allowSparse?e.allowSparse:o.allowSparse,arrayLimit:"number"==typeof e.arrayLimit?e.arrayLimit:o.arrayLimit,charset:t,charsetSentinel:"boolean"==typeof e.charsetSentinel?e.charsetSentinel:o.charsetSentinel,comma:"boolean"==typeof e.comma?e.comma:o.comma,decoder:"function"==typeof e.decoder?e.decoder:o.decoder,delimiter:"string"==typeof e.delimiter||r.isRegExp(e.delimiter)?e.delimiter:o.delimiter,depth:"number"==typeof e.depth||!1===e.depth?+e.depth:o.depth,ignoreQueryPrefix:!0===e.ignoreQueryPrefix,interpretNumericEntities:"boolean"==typeof e.interpretNumericEntities?e.interpretNumericEntities:o.interpretNumericEntities,parameterLimit:"number"==typeof e.parameterLimit?e.parameterLimit:o.parameterLimit,parseArrays:!1!==e.parseArrays,plainObjects:"boolean"==typeof e.plainObjects?e.plainObjects:o.plainObjects,strictNullHandling:"boolean"==typeof e.strictNullHandling?e.strictNullHandling:o.strictNullHandling}}(t);if(""===e||null==e)return n.plainObjects?Object.create(null):{};for(var d="string"==typeof e?function(e,t){var n,c={},d=t.ignoreQueryPrefix?e.replace(/^\?/,""):e,u=t.parameterLimit===1/0?void 0:t.parameterLimit,h=d.split(t.delimiter,u),p=-1,m=t.charset;if(t.charsetSentinel)for(n=0;n<h.length;++n)0===h[n].indexOf("utf8=")&&("utf8=%E2%9C%93"===h[n]?m="utf-8":"utf8=%26%2310003%3B"===h[n]&&(m="iso-8859-1"),p=n,n=h.length);for(n=0;n<h.length;++n)if(n!==p){var g,f,y=h[n],v=y.indexOf("]="),b=-1===v?y.indexOf("="):v+1;-1===b?(g=t.decoder(y,o.decoder,m,"key"),f=t.strictNullHandling?null:""):(g=t.decoder(y.slice(0,b),o.decoder,m,"key"),f=r.maybeMap(l(y.slice(b+1),t),(function(e){return t.decoder(e,o.decoder,m,"value")}))),f&&t.interpretNumericEntities&&"iso-8859-1"===m&&(f=a(f)),y.indexOf("[]=")>-1&&(f=s(f)?[f]:f),i.call(c,g)?c[g]=r.combine(c[g],f):c[g]=f}return c}(e,n):e,u=n.plainObjects?Object.create(null):{},h=Object.keys(d),p=0;p<h.length;++p){var m=h[p],g=c(m,d[m],n,"string"==typeof e);u=r.merge(u,g,n)}return!0===n.allowSparse?u:r.compact(u)}},8261:(e,t,n)=>{"use strict";var r=n(7478),i=n(2769),s=n(5798),o=Object.prototype.hasOwnProperty,a={brackets:function(e){return e+"[]"},comma:"comma",indices:function(e,t){return e+"["+t+"]"},repeat:function(e){return e}},l=Array.isArray,c=Array.prototype.push,d=function(e,t){c.apply(e,l(t)?t:[t])},u=Date.prototype.toISOString,h=s.default,p={addQueryPrefix:!1,allowDots:!1,charset:"utf-8",charsetSentinel:!1,delimiter:"&",encode:!0,encoder:i.encode,encodeValuesOnly:!1,format:h,formatter:s.formatters[h],indices:!1,serializeDate:function(e){return u.call(e)},skipNulls:!1,strictNullHandling:!1},m=function e(t,n,s,o,a,c,u,h,m,g,f,y,v,b,w){var S,_=t;if(w.has(t))throw new RangeError("Cyclic object value");if("function"==typeof u?_=u(n,_):_ instanceof Date?_=g(_):"comma"===s&&l(_)&&(_=i.maybeMap(_,(function(e){return e instanceof Date?g(e):e}))),null===_){if(o)return c&&!v?c(n,p.encoder,b,"key",f):n;_=""}if("string"==typeof(S=_)||"number"==typeof S||"boolean"==typeof S||"symbol"==typeof S||"bigint"==typeof S||i.isBuffer(_))return c?[y(v?n:c(n,p.encoder,b,"key",f))+"="+y(c(_,p.encoder,b,"value",f))]:[y(n)+"="+y(String(_))];var k,x=[];if(void 0===_)return x;if("comma"===s&&l(_))k=[{value:_.length>0?_.join(",")||null:void 0}];else if(l(u))k=u;else{var E=Object.keys(_);k=h?E.sort(h):E}for(var T=0;T<k.length;++T){var C=k[T],A="object"==typeof C&&void 0!==C.value?C.value:_[C];if(!a||null!==A){var I=l(_)?"function"==typeof s?s(n,C):n:n+(m?"."+C:"["+C+"]");w.set(t,!0);var R=r();d(x,e(A,I,s,o,a,c,u,h,m,g,f,y,v,b,R))}}return x};e.exports=function(e,t){var n,i=e,c=function(e){if(!e)return p;if(null!==e.encoder&&void 0!==e.encoder&&"function"!=typeof e.encoder)throw new TypeError("Encoder has to be a function.");var t=e.charset||p.charset;if(void 0!==e.charset&&"utf-8"!==e.charset&&"iso-8859-1"!==e.charset)throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");var n=s.default;if(void 0!==e.format){if(!o.call(s.formatters,e.format))throw new TypeError("Unknown format option provided.");n=e.format}var r=s.formatters[n],i=p.filter;return("function"==typeof e.filter||l(e.filter))&&(i=e.filter),{addQueryPrefix:"boolean"==typeof e.addQueryPrefix?e.addQueryPrefix:p.addQueryPrefix,allowDots:void 0===e.allowDots?p.allowDots:!!e.allowDots,charset:t,charsetSentinel:"boolean"==typeof e.charsetSentinel?e.charsetSentinel:p.charsetSentinel,delimiter:void 0===e.delimiter?p.delimiter:e.delimiter,encode:"boolean"==typeof e.encode?e.encode:p.encode,encoder:"function"==typeof e.encoder?e.encoder:p.encoder,encodeValuesOnly:"boolean"==typeof e.encodeValuesOnly?e.encodeValuesOnly:p.encodeValuesOnly,filter:i,format:n,formatter:r,serializeDate:"function"==typeof e.serializeDate?e.serializeDate:p.serializeDate,skipNulls:"boolean"==typeof e.skipNulls?e.skipNulls:p.skipNulls,sort:"function"==typeof e.sort?e.sort:null,strictNullHandling:"boolean"==typeof e.strictNullHandling?e.strictNullHandling:p.strictNullHandling}}(t);"function"==typeof c.filter?i=(0,c.filter)("",i):l(c.filter)&&(n=c.filter);var u,h=[];if("object"!=typeof i||null===i)return"";u=t&&t.arrayFormat in a?t.arrayFormat:t&&"indices"in t?t.indices?"indices":"repeat":"indices";var g=a[u];n||(n=Object.keys(i)),c.sort&&n.sort(c.sort);for(var f=r(),y=0;y<n.length;++y){var v=n[y];c.skipNulls&&null===i[v]||d(h,m(i[v],v,g,c.strictNullHandling,c.skipNulls,c.encode?c.encoder:null,c.filter,c.sort,c.allowDots,c.serializeDate,c.format,c.formatter,c.encodeValuesOnly,c.charset,f))}var b=h.join(c.delimiter),w=!0===c.addQueryPrefix?"?":"";return c.charsetSentinel&&("iso-8859-1"===c.charset?w+="utf8=%26%2310003%3B&":w+="utf8=%E2%9C%93&"),b.length>0?w+b:""}},2769:(e,t,n)=>{"use strict";var r=n(5798),i=Object.prototype.hasOwnProperty,s=Array.isArray,o=function(){for(var e=[],t=0;t<256;++t)e.push("%"+((t<16?"0":"")+t.toString(16)).toUpperCase());return e}(),a=function(e,t){for(var n=t&&t.plainObjects?Object.create(null):{},r=0;r<e.length;++r)void 0!==e[r]&&(n[r]=e[r]);return n};e.exports={arrayToObject:a,assign:function(e,t){return Object.keys(t).reduce((function(e,n){return e[n]=t[n],e}),e)},combine:function(e,t){return[].concat(e,t)},compact:function(e){for(var t=[{obj:{o:e},prop:"o"}],n=[],r=0;r<t.length;++r)for(var i=t[r],o=i.obj[i.prop],a=Object.keys(o),l=0;l<a.length;++l){var c=a[l],d=o[c];"object"==typeof d&&null!==d&&-1===n.indexOf(d)&&(t.push({obj:o,prop:c}),n.push(d))}return function(e){for(;e.length>1;){var t=e.pop(),n=t.obj[t.prop];if(s(n)){for(var r=[],i=0;i<n.length;++i)void 0!==n[i]&&r.push(n[i]);t.obj[t.prop]=r}}}(t),e},decode:function(e,t,n){var r=e.replace(/\+/g," ");if("iso-8859-1"===n)return r.replace(/%[0-9a-f]{2}/gi,unescape);try{return decodeURIComponent(r)}catch(e){return r}},encode:function(e,t,n,i,s){if(0===e.length)return e;var a=e;if("symbol"==typeof e?a=Symbol.prototype.toString.call(e):"string"!=typeof e&&(a=String(e)),"iso-8859-1"===n)return escape(a).replace(/%u[0-9a-f]{4}/gi,(function(e){return"%26%23"+parseInt(e.slice(2),16)+"%3B"}));for(var l="",c=0;c<a.length;++c){var d=a.charCodeAt(c);45===d||46===d||95===d||126===d||d>=48&&d<=57||d>=65&&d<=90||d>=97&&d<=122||s===r.RFC1738&&(40===d||41===d)?l+=a.charAt(c):d<128?l+=o[d]:d<2048?l+=o[192|d>>6]+o[128|63&d]:d<55296||d>=57344?l+=o[224|d>>12]+o[128|d>>6&63]+o[128|63&d]:(c+=1,d=65536+((1023&d)<<10|1023&a.charCodeAt(c)),l+=o[240|d>>18]+o[128|d>>12&63]+o[128|d>>6&63]+o[128|63&d])}return l},isBuffer:function(e){return!(!e||"object"!=typeof e||!(e.constructor&&e.constructor.isBuffer&&e.constructor.isBuffer(e)))},isRegExp:function(e){return"[object RegExp]"===Object.prototype.toString.call(e)},maybeMap:function(e,t){if(s(e)){for(var n=[],r=0;r<e.length;r+=1)n.push(t(e[r]));return n}return t(e)},merge:function e(t,n,r){if(!n)return t;if("object"!=typeof n){if(s(t))t.push(n);else{if(!t||"object"!=typeof t)return[t,n];(r&&(r.plainObjects||r.allowPrototypes)||!i.call(Object.prototype,n))&&(t[n]=!0)}return t}if(!t||"object"!=typeof t)return[t].concat(n);var o=t;return s(t)&&!s(n)&&(o=a(t,r)),s(t)&&s(n)?(n.forEach((function(n,s){if(i.call(t,s)){var o=t[s];o&&"object"==typeof o&&n&&"object"==typeof n?t[s]=e(o,n,r):t.push(n)}else t[s]=n})),t):Object.keys(n).reduce((function(t,s){var o=n[s];return i.call(t,s)?t[s]=e(t[s],o,r):t[s]=o,t}),o)}}},2587:e=>{"use strict";function t(e,t){return Object.prototype.hasOwnProperty.call(e,t)}e.exports=function(e,n,r,i){n=n||"&",r=r||"=";var s={};if("string"!=typeof e||0===e.length)return s;var o=/\+/g;e=e.split(n);var a=1e3;i&&"number"==typeof i.maxKeys&&(a=i.maxKeys);var l=e.length;a>0&&l>a&&(l=a);for(var c=0;c<l;++c){var d,u,h,p,m=e[c].replace(o,"%20"),g=m.indexOf(r);g>=0?(d=m.substr(0,g),u=m.substr(g+1)):(d=m,u=""),h=decodeURIComponent(d),p=decodeURIComponent(u),t(s,h)?Array.isArray(s[h])?s[h].push(p):s[h]=[s[h],p]:s[h]=p}return s}},2361:e=>{"use strict";var t=function(e){switch(typeof e){case"string":return e;case"boolean":return e?"true":"false";case"number":return isFinite(e)?e:"";default:return""}};e.exports=function(e,n,r,i){return n=n||"&",r=r||"=",null===e&&(e=void 0),"object"==typeof e?Object.keys(e).map((function(i){var s=encodeURIComponent(t(i))+r;return Array.isArray(e[i])?e[i].map((function(e){return s+encodeURIComponent(t(e))})).join(n):s+encodeURIComponent(t(e[i]))})).join(n):i?encodeURIComponent(t(i))+r+encodeURIComponent(t(e)):""}},7673:(e,t,n)=>{"use strict";t.decode=t.parse=n(2587),t.encode=t.stringify=n(2361)},9353:(e,t,n)=>{e.exports=n(1846)},1846:(e,t,n)=>{var r=n(1960);t.operation=function(e){var n=t.timeouts(e);return new r(n,{forever:e&&(e.forever||e.retries===1/0),unref:e&&e.unref,maxRetryTime:e&&e.maxRetryTime})},t.timeouts=function(e){if(e instanceof Array)return[].concat(e);var t={retries:10,factor:2,minTimeout:1e3,maxTimeout:1/0,randomize:!1};for(var n in e)t[n]=e[n];if(t.minTimeout>t.maxTimeout)throw new Error("minTimeout is greater than maxTimeout");for(var r=[],i=0;i<t.retries;i++)r.push(this.createTimeout(i,t));return e&&e.forever&&!r.length&&r.push(this.createTimeout(i,t)),r.sort((function(e,t){return e-t})),r},t.createTimeout=function(e,t){var n=t.randomize?Math.random()+1:1,r=Math.round(n*Math.max(t.minTimeout,1)*Math.pow(t.factor,e));return Math.min(r,t.maxTimeout)},t.wrap=function(e,n,r){if(n instanceof Array&&(r=n,n=null),!r)for(var i in r=[],e)"function"==typeof e[i]&&r.push(i);for(var s=0;s<r.length;s++){var o=r[s],a=e[o];e[o]=function(r){var i=t.operation(n),s=Array.prototype.slice.call(arguments,1),o=s.pop();s.push((function(e){i.retry(e)||(e&&(arguments[0]=i.mainError()),o.apply(this,arguments))})),i.attempt((function(){r.apply(e,s)}))}.bind(e,a),e[o].options=n}}},1960:e=>{function t(e,t){"boolean"==typeof t&&(t={forever:t}),this._originalTimeouts=JSON.parse(JSON.stringify(e)),this._timeouts=e,this._options=t||{},this._maxRetryTime=t&&t.maxRetryTime||1/0,this._fn=null,this._errors=[],this._attempts=1,this._operationTimeout=null,this._operationTimeoutCb=null,this._timeout=null,this._operationStart=null,this._timer=null,this._options.forever&&(this._cachedTimeouts=this._timeouts.slice(0))}e.exports=t,t.prototype.reset=function(){this._attempts=1,this._timeouts=this._originalTimeouts.slice(0)},t.prototype.stop=function(){this._timeout&&clearTimeout(this._timeout),this._timer&&clearTimeout(this._timer),this._timeouts=[],this._cachedTimeouts=null},t.prototype.retry=function(e){if(this._timeout&&clearTimeout(this._timeout),!e)return!1;var t=(new Date).getTime();if(e&&t-this._operationStart>=this._maxRetryTime)return this._errors.push(e),this._errors.unshift(new Error("RetryOperation timeout occurred")),!1;this._errors.push(e);var n=this._timeouts.shift();if(void 0===n){if(!this._cachedTimeouts)return!1;this._errors.splice(0,this._errors.length-1),n=this._cachedTimeouts.slice(-1)}var r=this;return this._timer=setTimeout((function(){r._attempts++,r._operationTimeoutCb&&(r._timeout=setTimeout((function(){r._operationTimeoutCb(r._attempts)}),r._operationTimeout),r._options.unref&&r._timeout.unref()),r._fn(r._attempts)}),n),this._options.unref&&this._timer.unref(),!0},t.prototype.attempt=function(e,t){this._fn=e,t&&(t.timeout&&(this._operationTimeout=t.timeout),t.cb&&(this._operationTimeoutCb=t.cb));var n=this;this._operationTimeoutCb&&(this._timeout=setTimeout((function(){n._operationTimeoutCb()}),n._operationTimeout)),this._operationStart=(new Date).getTime(),this._fn(this._attempts)},t.prototype.try=function(e){console.log("Using RetryOperation.try() is deprecated"),this.attempt(e)},t.prototype.start=function(e){console.log("Using RetryOperation.start() is deprecated"),this.attempt(e)},t.prototype.start=t.prototype.try,t.prototype.errors=function(){return this._errors},t.prototype.attempts=function(){return this._attempts},t.prototype.mainError=function(){if(0===this._errors.length)return null;for(var e={},t=null,n=0,r=0;r<this._errors.length;r++){var i=this._errors[r],s=i.message,o=(e[s]||0)+1;e[s]=o,o>=n&&(t=i,n=o)}return t}},9509:(e,t,n)=>{var r=n(8764),i=r.Buffer;function s(e,t){for(var n in e)t[n]=e[n]}function o(e,t,n){return i(e,t,n)}i.from&&i.alloc&&i.allocUnsafe&&i.allocUnsafeSlow?e.exports=r:(s(r,t),t.Buffer=o),s(i,o),o.from=function(e,t,n){if("number"==typeof e)throw new TypeError("Argument must not be a number");return i(e,t,n)},o.alloc=function(e,t,n){if("number"!=typeof e)throw new TypeError("Argument must be a number");var r=i(e);return void 0!==t?"string"==typeof n?r.fill(t,n):r.fill(t):r.fill(0),r},o.allocUnsafe=function(e){if("number"!=typeof e)throw new TypeError("Argument must be a number");return i(e)},o.allocUnsafeSlow=function(e){if("number"!=typeof e)throw new TypeError("Argument must be a number");return r.SlowBuffer(e)}},1036:(e,t,n)=>{const r=n(3719),i=n(2997),{isPlainObject:s}=n(6057),o=n(9996),a=n(9430),{parse:l}=n(20),c=["img","audio","video","picture","svg","object","map","iframe","embed"],d=["script","style"];function u(e,t){e&&Object.keys(e).forEach((function(n){t(e[n],n)}))}function h(e,t){return{}.hasOwnProperty.call(e,t)}function p(e,t){const n=[];return u(e,(function(e){t(e)&&n.push(e)})),n}e.exports=g;const m=/^[^\0\t\n\f\r /<=>]+$/;function g(e,t,n){if(null==e)return"";let y="",v="";function b(e,t){const n=this;this.tag=e,this.attribs=t||{},this.tagPosition=y.length,this.text="",this.mediaChildren=[],this.updateParentNodeText=function(){I.length&&(I[I.length-1].text+=n.text)},this.updateParentNodeMediaChildren=function(){I.length&&c.includes(this.tag)&&I[I.length-1].mediaChildren.push(this.tag)}}(t=Object.assign({},g.defaults,t)).parser=Object.assign({},f,t.parser),d.forEach((function(e){t.allowedTags&&t.allowedTags.indexOf(e)>-1&&!t.allowVulnerableTags&&console.warn(`\n\n Your \`allowedTags\` option includes, \`${e}\`, which is inherently\nvulnerable to XSS attacks. Please remove it from \`allowedTags\`.\nOr, to disable this warning, add the \`allowVulnerableTags\` option\nand ensure you are accounting for this risk.\n\n`)}));const w=t.nonTextTags||["script","style","textarea","option"];let S,_;t.allowedAttributes&&(S={},_={},u(t.allowedAttributes,(function(e,t){S[t]=[];const n=[];e.forEach((function(e){"string"==typeof e&&e.indexOf("*")>=0?n.push(i(e).replace(/\\\*/g,".*")):S[t].push(e)})),n.length&&(_[t]=new RegExp("^("+n.join("|")+")$"))})));const k={},x={},E={};u(t.allowedClasses,(function(e,t){S&&(h(S,t)||(S[t]=[]),S[t].push("class")),k[t]=[],E[t]=[];const n=[];e.forEach((function(e){"string"==typeof e&&e.indexOf("*")>=0?n.push(i(e).replace(/\\\*/g,".*")):e instanceof RegExp?E[t].push(e):k[t].push(e)})),n.length&&(x[t]=new RegExp("^("+n.join("|")+")$"))}));const T={};let C,A,I,R,O,P,M;u(t.transformTags,(function(e,t){let n;"function"==typeof e?n=e:"string"==typeof e&&(n=g.simpleTransform(e)),"*"===t?C=n:T[t]=n}));let D=!1;F();const L=new r.Parser({onopentag:function(e,n){if(t.enforceHtmlBoundary&&"html"===e&&F(),P)return void M++;const r=new b(e,n);I.push(r);let i=!1;const c=!!r.text;let d;if(h(T,e)&&(d=T[e](e,n),r.attribs=n=d.attribs,void 0!==d.text&&(r.innerText=d.text),e!==d.tagName&&(r.name=e=d.tagName,O[A]=d.tagName)),C&&(d=C(e,n),r.attribs=n=d.attribs,e!==d.tagName&&(r.name=e=d.tagName,O[A]=d.tagName)),(t.allowedTags&&-1===t.allowedTags.indexOf(e)||"recursiveEscape"===t.disallowedTagsMode&&!function(e){for(const t in e)if(h(e,t))return!1;return!0}(R)||null!=t.nestingLimit&&A>=t.nestingLimit)&&(i=!0,R[A]=!0,"discard"===t.disallowedTagsMode&&-1!==w.indexOf(e)&&(P=!0,M=1),R[A]=!0),A++,i){if("discard"===t.disallowedTagsMode)return;v=y,y=""}y+="<"+e,"script"===e&&(t.allowedScriptHostnames||t.allowedScriptDomains)&&(r.innerText=""),(!S||h(S,e)||S["*"])&&u(n,(function(n,i){if(!m.test(i))return void delete r.attribs[i];let c,d=!1;if(!S||h(S,e)&&-1!==S[e].indexOf(i)||S["*"]&&-1!==S["*"].indexOf(i)||h(_,e)&&_[e].test(i)||_["*"]&&_["*"].test(i))d=!0;else if(S&&S[e])for(const t of S[e])if(s(t)&&t.name&&t.name===i){d=!0;let e="";if(!0===t.multiple){const r=n.split(" ");for(const n of r)-1!==t.values.indexOf(n)&&(""===e?e=n:e+=" "+n)}else t.values.indexOf(n)>=0&&(e=n);n=e}if(d){if(-1!==t.allowedSchemesAppliedToAttributes.indexOf(i)&&j(e,n))return void delete r.attribs[i];if("script"===e&&"src"===i){let e=!0;try{const r=new URL(n);if(t.allowedScriptHostnames||t.allowedScriptDomains){const n=(t.allowedScriptHostnames||[]).find((function(e){return e===r.hostname})),i=(t.allowedScriptDomains||[]).find((function(e){return r.hostname===e||r.hostname.endsWith(`.${e}`)}));e=n||i}}catch(t){e=!1}if(!e)return void delete r.attribs[i]}if("iframe"===e&&"src"===i){let e=!0;try{if((n=n.replace(/^(\w+:)?\s*[\\/]\s*[\\/]/,"$1//")).startsWith("relative:"))throw new Error("relative: exploit attempt");let r="relative://relative-site";for(let e=0;e<100;e++)r+=`/${e}`;const i=new URL(n,r);if(i&&"relative-site"===i.hostname&&"relative:"===i.protocol)e=h(t,"allowIframeRelativeUrls")?t.allowIframeRelativeUrls:!t.allowedIframeHostnames&&!t.allowedIframeDomains;else if(t.allowedIframeHostnames||t.allowedIframeDomains){const n=(t.allowedIframeHostnames||[]).find((function(e){return e===i.hostname})),r=(t.allowedIframeDomains||[]).find((function(e){return i.hostname===e||i.hostname.endsWith(`.${e}`)}));e=n||r}}catch(t){e=!1}if(!e)return void delete r.attribs[i]}if("srcset"===i)try{if(c=a(n),c.forEach((function(e){j("srcset",e.url)&&(e.evil=!0)})),c=p(c,(function(e){return!e.evil})),!c.length)return void delete r.attribs[i];n=p(c,(function(e){return!e.evil})).map((function(e){if(!e.url)throw new Error("URL missing");return e.url+(e.w?` ${e.w}w`:"")+(e.h?` ${e.h}h`:"")+(e.d?` ${e.d}x`:"")})).join(", "),r.attribs[i]=n}catch(e){return void delete r.attribs[i]}if("class"===i){const t=k[e],s=k["*"],a=x[e],l=E[e],c=[a,x["*"]].concat(l).filter((function(e){return e}));if(!(u=n,g=t&&s?o(t,s):t||s,f=c,n=g?(u=u.split(/\s+/)).filter((function(e){return-1!==g.indexOf(e)||f.some((function(t){return t.test(e)}))})).join(" "):u).length)return void delete r.attribs[i]}if("style"===i)try{if(0===(n=function(e){return e.nodes[0].nodes.reduce((function(e,t){return e.push(t.prop+":"+t.value),e}),[]).join(";")}(function(e,t){if(!t)return e;const n=e.nodes[0];let r;return r=t[n.selector]&&t["*"]?o(t[n.selector],t["*"]):t[n.selector]||t["*"],r&&(e.nodes[0].nodes=n.nodes.reduce(function(e){return function(t,n){return h(e,n.prop)&&e[n.prop].some((function(e){return e.test(n.value)}))&&t.push(n),t}}(r),[])),e}(l(e+" {"+n+"}"),t.allowedStyles))).length)return void delete r.attribs[i]}catch(e){return void delete r.attribs[i]}y+=" "+i,n&&n.length&&(y+='="'+N(n,!0)+'"')}else delete r.attribs[i];var u,g,f})),-1!==t.selfClosing.indexOf(e)?y+=" />":(y+=">",!r.innerText||c||t.textFilter||(y+=N(r.innerText),D=!0)),i&&(y=v+N(y),v="")},ontext:function(e){if(P)return;const n=I[I.length-1];let r;if(n&&(r=n.tag,e=void 0!==n.innerText?n.innerText:e),"discard"!==t.disallowedTagsMode||"script"!==r&&"style"!==r){const n=N(e,!1);t.textFilter&&!D?y+=t.textFilter(n,r):D||(y+=n)}else y+=e;I.length&&(I[I.length-1].text+=e)},onclosetag:function(e){if(P){if(M--,M)return;P=!1}const n=I.pop();if(!n)return;P=!!t.enforceHtmlBoundary&&"html"===e,A--;const r=R[A];if(r){if(delete R[A],"discard"===t.disallowedTagsMode)return void n.updateParentNodeText();v=y,y=""}O[A]&&(e=O[A],delete O[A]),t.exclusiveFilter&&t.exclusiveFilter(n)?y=y.substr(0,n.tagPosition):(n.updateParentNodeMediaChildren(),n.updateParentNodeText(),-1===t.selfClosing.indexOf(e)?(y+="</"+e+">",r&&(y=v+N(y),v="")):r&&(y=v,v=""))}},t.parser);return L.write(e),L.end(),y;function F(){y="",A=0,I=[],R={},O={},P=!1,M=0}function N(e,n){return"string"!=typeof e&&(e+=""),t.parser.decodeEntities&&(e=e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;"),n&&(e=e.replace(/"/g,"&quot;"))),e=e.replace(/&(?![a-zA-Z0-9#]{1,20};)/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;"),n&&(e=e.replace(/"/g,"&quot;")),e}function j(e,n){const r=(n=(n=n.replace(/[\x00-\x20]+/g,"")).replace(/<!--.*?-->/g,"")).match(/^([a-zA-Z][a-zA-Z0-9.\-+]*):/);if(!r)return!!n.match(/^[/\\]{2}/)&&!t.allowProtocolRelative;const i=r[1].toLowerCase();return h(t.allowedSchemesByTag,e)?-1===t.allowedSchemesByTag[e].indexOf(i):!t.allowedSchemes||-1===t.allowedSchemes.indexOf(i)}}const f={decodeEntities:!0};g.defaults={allowedTags:["address","article","aside","footer","header","h1","h2","h3","h4","h5","h6","hgroup","main","nav","section","blockquote","dd","div","dl","dt","figcaption","figure","hr","li","main","ol","p","pre","ul","a","abbr","b","bdi","bdo","br","cite","code","data","dfn","em","i","kbd","mark","q","rb","rp","rt","rtc","ruby","s","samp","small","span","strong","sub","sup","time","u","var","wbr","caption","col","colgroup","table","tbody","td","tfoot","th","thead","tr"],disallowedTagsMode:"discard",allowedAttributes:{a:["href","name","target"],img:["src"]},selfClosing:["img","br","hr","area","base","basefont","input","link","meta"],allowedSchemes:["http","https","ftp","mailto","tel"],allowedSchemesByTag:{},allowedSchemesAppliedToAttributes:["href","src","cite"],allowProtocolRelative:!0,enforceHtmlBoundary:!1},g.simpleTransform=function(e,t,n){return n=void 0===n||n,t=t||{},function(r,i){let s;if(n)for(s in t)i[s]=t[s];else i=t;return{tagName:e,attribs:i}}}},2997:e=>{"use strict";e.exports=e=>{if("string"!=typeof e)throw new TypeError("Expected a string");return e.replace(/[|\\{}()[\]^$+*?.]/g,"\\$&").replace(/-/g,"\\x2d")}},7478:(e,t,n)=>{"use strict";var r=n(210),i=n(1924),s=n(631),o=r("%TypeError%"),a=r("%WeakMap%",!0),l=r("%Map%",!0),c=i("WeakMap.prototype.get",!0),d=i("WeakMap.prototype.set",!0),u=i("WeakMap.prototype.has",!0),h=i("Map.prototype.get",!0),p=i("Map.prototype.set",!0),m=i("Map.prototype.has",!0),g=function(e,t){for(var n,r=e;null!==(n=r.next);r=n)if(n.key===t)return r.next=n.next,n.next=e.next,e.next=n,n};e.exports=function(){var e,t,n,r={assert:function(e){if(!r.has(e))throw new o("Side channel does not contain "+s(e))},get:function(r){if(a&&r&&("object"==typeof r||"function"==typeof r)){if(e)return c(e,r)}else if(l){if(t)return h(t,r)}else if(n)return function(e,t){var n=g(e,t);return n&&n.value}(n,r)},has:function(r){if(a&&r&&("object"==typeof r||"function"==typeof r)){if(e)return u(e,r)}else if(l){if(t)return m(t,r)}else if(n)return function(e,t){return!!g(e,t)}(n,r);return!1},set:function(r,i){a&&r&&("object"==typeof r||"function"==typeof r)?(e||(e=new a),d(e,r,i)):l?(t||(t=new l),p(t,r,i)):(n||(n={key:{},next:null}),function(e,t,n){var r=g(e,t);r?r.value=n:e.next={key:t,next:e.next,value:n}}(n,r,i))}};return r}},8822:()=>{String.prototype.repeat||function(){"use strict";var e=function(){try{var e={},t=Object.defineProperty,n=t(e,e,e)&&t}catch(e){}return n}(),t=function(e){if(null==this)throw TypeError();var t=String(this),n=e?Number(e):0;if(n!=n&&(n=0),n<0||n==1/0)throw RangeError();for(var r="";n;)n%2==1&&(r+=t),n>1&&(t+=t),n>>=1;return r};e?e(String.prototype,"repeat",{value:t,configurable:!0,writable:!0}):String.prototype.repeat=t}()},3379:e=>{"use strict";var t=[];function n(e){for(var n=-1,r=0;r<t.length;r++)if(t[r].identifier===e){n=r;break}return n}function r(e,r){for(var s={},o=[],a=0;a<e.length;a++){var l=e[a],c=r.base?l[0]+r.base:l[0],d=s[c]||0,u="".concat(c," ").concat(d);s[c]=d+1;var h=n(u),p={css:l[1],media:l[2],sourceMap:l[3],supports:l[4],layer:l[5]};if(-1!==h)t[h].references++,t[h].updater(p);else{var m=i(p,r);r.byIndex=a,t.splice(a,0,{identifier:u,updater:m,references:1})}o.push(u)}return o}function i(e,t){var n=t.domAPI(t);return n.update(e),function(t){if(t){if(t.css===e.css&&t.media===e.media&&t.sourceMap===e.sourceMap&&t.supports===e.supports&&t.layer===e.layer)return;n.update(e=t)}else n.remove()}}e.exports=function(e,i){var s=r(e=e||[],i=i||{});return function(e){e=e||[];for(var o=0;o<s.length;o++){var a=n(s[o]);t[a].references--}for(var l=r(e,i),c=0;c<s.length;c++){var d=n(s[c]);0===t[d].references&&(t[d].updater(),t.splice(d,1))}s=l}}},569:e=>{"use strict";var t={};e.exports=function(e,n){var r=function(e){if(void 0===t[e]){var n=document.querySelector(e);if(window.HTMLIFrameElement&&n instanceof window.HTMLIFrameElement)try{n=n.contentDocument.head}catch(e){n=null}t[e]=n}return t[e]}(e);if(!r)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");r.appendChild(n)}},9216:e=>{"use strict";e.exports=function(e){var t=document.createElement("style");return e.setAttributes(t,e.attributes),e.insert(t,e.options),t}},3565:(e,t,n)=>{"use strict";e.exports=function(e){var t=n.nc;t&&e.setAttribute("nonce",t)}},7795:e=>{"use strict";e.exports=function(e){var t=e.insertStyleElement(e);return{update:function(n){!function(e,t,n){var r="";n.supports&&(r+="@supports (".concat(n.supports,") {")),n.media&&(r+="@media ".concat(n.media," {"));var i=void 0!==n.layer;i&&(r+="@layer".concat(n.layer.length>0?" ".concat(n.layer):""," {")),r+=n.css,i&&(r+="}"),n.media&&(r+="}"),n.supports&&(r+="}");var s=n.sourceMap;s&&"undefined"!=typeof btoa&&(r+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(s))))," */")),t.styleTagTransform(r,e,t.options)}(t,e,n)},remove:function(){!function(e){if(null===e.parentNode)return!1;e.parentNode.removeChild(e)}(t)}}}},4589:e=>{"use strict";e.exports=function(e,t){if(t.styleSheet)t.styleSheet.cssText=e;else{for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(document.createTextNode(e))}}},5067:(e,t,n)=>{"use strict";var r=n(7873),i=RegExp(Object.keys(r).map((function(e){return e.replace(/([.?*+^$[\]\\(){}|-])/g,"\\$1")})).join("|"),"g");function s(e){return r[e]}e.exports=function(e){return e.replace(i,s)}},2511:function(e,t,n){var r;e=n.nmd(e),function(i){t&&t.nodeType,e&&e.nodeType;var s="object"==typeof n.g&&n.g;s.global!==s&&s.window!==s&&s.self;var o,a=2147483647,l=36,c=/^xn--/,d=/[^\x20-\x7E]/,u=/[\x2E\u3002\uFF0E\uFF61]/g,h={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},p=Math.floor,m=String.fromCharCode;function g(e){throw RangeError(h[e])}function f(e,t){for(var n=e.length,r=[];n--;)r[n]=t(e[n]);return r}function y(e,t){var n=e.split("@"),r="";return n.length>1&&(r=n[0]+"@",e=n[1]),r+f((e=e.replace(u,".")).split("."),t).join(".")}function v(e){for(var t,n,r=[],i=0,s=e.length;i<s;)(t=e.charCodeAt(i++))>=55296&&t<=56319&&i<s?56320==(64512&(n=e.charCodeAt(i++)))?r.push(((1023&t)<<10)+(1023&n)+65536):(r.push(t),i--):r.push(t);return r}function b(e){return f(e,(function(e){var t="";return e>65535&&(t+=m((e-=65536)>>>10&1023|55296),e=56320|1023&e),t+m(e)})).join("")}function w(e,t){return e+22+75*(e<26)-((0!=t)<<5)}function S(e,t,n){var r=0;for(e=n?p(e/700):e>>1,e+=p(e/t);e>455;r+=l)e=p(e/35);return p(r+36*e/(e+38))}function _(e){var t,n,r,i,s,o,c,d,u,h,m,f=[],y=e.length,v=0,w=128,_=72;for((n=e.lastIndexOf("-"))<0&&(n=0),r=0;r<n;++r)e.charCodeAt(r)>=128&&g("not-basic"),f.push(e.charCodeAt(r));for(i=n>0?n+1:0;i<y;){for(s=v,o=1,c=l;i>=y&&g("invalid-input"),((d=(m=e.charCodeAt(i++))-48<10?m-22:m-65<26?m-65:m-97<26?m-97:l)>=l||d>p((a-v)/o))&&g("overflow"),v+=d*o,!(d<(u=c<=_?1:c>=_+26?26:c-_));c+=l)o>p(a/(h=l-u))&&g("overflow"),o*=h;_=S(v-s,t=f.length+1,0==s),p(v/t)>a-w&&g("overflow"),w+=p(v/t),v%=t,f.splice(v++,0,w)}return b(f)}function k(e){var t,n,r,i,s,o,c,d,u,h,f,y,b,_,k,x=[];for(y=(e=v(e)).length,t=128,n=0,s=72,o=0;o<y;++o)(f=e[o])<128&&x.push(m(f));for(r=i=x.length,i&&x.push("-");r<y;){for(c=a,o=0;o<y;++o)(f=e[o])>=t&&f<c&&(c=f);for(c-t>p((a-n)/(b=r+1))&&g("overflow"),n+=(c-t)*b,t=c,o=0;o<y;++o)if((f=e[o])<t&&++n>a&&g("overflow"),f==t){for(d=n,u=l;!(d<(h=u<=s?1:u>=s+26?26:u-s));u+=l)k=d-h,_=l-h,x.push(m(w(h+k%_,0))),d=p(k/_);x.push(m(w(d,0))),s=S(n,b,r==i),n=0,++r}++n,++t}return x.join("")}o={version:"1.3.2",ucs2:{decode:v,encode:b},decode:_,encode:k,toASCII:function(e){return y(e,(function(e){return d.test(e)?"xn--"+k(e):e}))},toUnicode:function(e){return y(e,(function(e){return c.test(e)?_(e.slice(4).toLowerCase()):e}))}},void 0===(r=function(){return o}.call(t,n,t,e))||(e.exports=r)}()},8575:(e,t,n)=>{"use strict";var r=n(2511),i=n(2502);function s(){this.protocol=null,this.slashes=null,this.auth=null,this.host=null,this.port=null,this.hostname=null,this.hash=null,this.search=null,this.query=null,this.pathname=null,this.path=null,this.href=null}t.parse=b,t.resolve=function(e,t){return b(e,!1,!0).resolve(t)},t.resolveObject=function(e,t){return e?b(e,!1,!0).resolveObject(t):t},t.format=function(e){return i.isString(e)&&(e=b(e)),e instanceof s?e.format():s.prototype.format.call(e)},t.Url=s;var o=/^([a-z0-9.+-]+:)/i,a=/:[0-9]*$/,l=/^(\/\/?(?!\/)[^\?\s]*)(\?[^\s]*)?$/,c=["{","}","|","\\","^","`"].concat(["<",">",'"',"`"," ","\r","\n","\t"]),d=["'"].concat(c),u=["%","/","?",";","#"].concat(d),h=["/","?","#"],p=/^[+a-z0-9A-Z_-]{0,63}$/,m=/^([+a-z0-9A-Z_-]{0,63})(.*)$/,g={javascript:!0,"javascript:":!0},f={javascript:!0,"javascript:":!0},y={http:!0,https:!0,ftp:!0,gopher:!0,file:!0,"http:":!0,"https:":!0,"ftp:":!0,"gopher:":!0,"file:":!0},v=n(7673);function b(e,t,n){if(e&&i.isObject(e)&&e instanceof s)return e;var r=new s;return r.parse(e,t,n),r}s.prototype.parse=function(e,t,n){if(!i.isString(e))throw new TypeError("Parameter 'url' must be a string, not "+typeof e);var s=e.indexOf("?"),a=-1!==s&&s<e.indexOf("#")?"?":"#",c=e.split(a);c[0]=c[0].replace(/\\/g,"/");var b=e=c.join(a);if(b=b.trim(),!n&&1===e.split("#").length){var w=l.exec(b);if(w)return this.path=b,this.href=b,this.pathname=w[1],w[2]?(this.search=w[2],this.query=t?v.parse(this.search.substr(1)):this.search.substr(1)):t&&(this.search="",this.query={}),this}var S=o.exec(b);if(S){var _=(S=S[0]).toLowerCase();this.protocol=_,b=b.substr(S.length)}if(n||S||b.match(/^\/\/[^@\/]+@[^@\/]+/)){var k="//"===b.substr(0,2);!k||S&&f[S]||(b=b.substr(2),this.slashes=!0)}if(!f[S]&&(k||S&&!y[S])){for(var x,E,T=-1,C=0;C<h.length;C++)-1!==(A=b.indexOf(h[C]))&&(-1===T||A<T)&&(T=A);for(-1!==(E=-1===T?b.lastIndexOf("@"):b.lastIndexOf("@",T))&&(x=b.slice(0,E),b=b.slice(E+1),this.auth=decodeURIComponent(x)),T=-1,C=0;C<u.length;C++){var A;-1!==(A=b.indexOf(u[C]))&&(-1===T||A<T)&&(T=A)}-1===T&&(T=b.length),this.host=b.slice(0,T),b=b.slice(T),this.parseHost(),this.hostname=this.hostname||"";var I="["===this.hostname[0]&&"]"===this.hostname[this.hostname.length-1];if(!I)for(var R=this.hostname.split(/\./),O=(C=0,R.length);C<O;C++){var P=R[C];if(P&&!P.match(p)){for(var M="",D=0,L=P.length;D<L;D++)P.charCodeAt(D)>127?M+="x":M+=P[D];if(!M.match(p)){var F=R.slice(0,C),N=R.slice(C+1),j=P.match(m);j&&(F.push(j[1]),N.unshift(j[2])),N.length&&(b="/"+N.join(".")+b),this.hostname=F.join(".");break}}}this.hostname.length>255?this.hostname="":this.hostname=this.hostname.toLowerCase(),I||(this.hostname=r.toASCII(this.hostname));var U=this.port?":"+this.port:"",B=this.hostname||"";this.host=B+U,this.href+=this.host,I&&(this.hostname=this.hostname.substr(1,this.hostname.length-2),"/"!==b[0]&&(b="/"+b))}if(!g[_])for(C=0,O=d.length;C<O;C++){var q=d[C];if(-1!==b.indexOf(q)){var K=encodeURIComponent(q);K===q&&(K=escape(q)),b=b.split(q).join(K)}}var z=b.indexOf("#");-1!==z&&(this.hash=b.substr(z),b=b.slice(0,z));var $=b.indexOf("?");if(-1!==$?(this.search=b.substr($),this.query=b.substr($+1),t&&(this.query=v.parse(this.query)),b=b.slice(0,$)):t&&(this.search="",this.query={}),b&&(this.pathname=b),y[_]&&this.hostname&&!this.pathname&&(this.pathname="/"),this.pathname||this.search){U=this.pathname||"";var V=this.search||"";this.path=U+V}return this.href=this.format(),this},s.prototype.format=function(){var e=this.auth||"";e&&(e=(e=encodeURIComponent(e)).replace(/%3A/i,":"),e+="@");var t=this.protocol||"",n=this.pathname||"",r=this.hash||"",s=!1,o="";this.host?s=e+this.host:this.hostname&&(s=e+(-1===this.hostname.indexOf(":")?this.hostname:"["+this.hostname+"]"),this.port&&(s+=":"+this.port)),this.query&&i.isObject(this.query)&&Object.keys(this.query).length&&(o=v.stringify(this.query));var a=this.search||o&&"?"+o||"";return t&&":"!==t.substr(-1)&&(t+=":"),this.slashes||(!t||y[t])&&!1!==s?(s="//"+(s||""),n&&"/"!==n.charAt(0)&&(n="/"+n)):s||(s=""),r&&"#"!==r.charAt(0)&&(r="#"+r),a&&"?"!==a.charAt(0)&&(a="?"+a),t+s+(n=n.replace(/[?#]/g,(function(e){return encodeURIComponent(e)})))+(a=a.replace("#","%23"))+r},s.prototype.resolve=function(e){return this.resolveObject(b(e,!1,!0)).format()},s.prototype.resolveObject=function(e){if(i.isString(e)){var t=new s;t.parse(e,!1,!0),e=t}for(var n=new s,r=Object.keys(this),o=0;o<r.length;o++){var a=r[o];n[a]=this[a]}if(n.hash=e.hash,""===e.href)return n.href=n.format(),n;if(e.slashes&&!e.protocol){for(var l=Object.keys(e),c=0;c<l.length;c++){var d=l[c];"protocol"!==d&&(n[d]=e[d])}return y[n.protocol]&&n.hostname&&!n.pathname&&(n.path=n.pathname="/"),n.href=n.format(),n}if(e.protocol&&e.protocol!==n.protocol){if(!y[e.protocol]){for(var u=Object.keys(e),h=0;h<u.length;h++){var p=u[h];n[p]=e[p]}return n.href=n.format(),n}if(n.protocol=e.protocol,e.host||f[e.protocol])n.pathname=e.pathname;else{for(var m=(e.pathname||"").split("/");m.length&&!(e.host=m.shift()););e.host||(e.host=""),e.hostname||(e.hostname=""),""!==m[0]&&m.unshift(""),m.length<2&&m.unshift(""),n.pathname=m.join("/")}if(n.search=e.search,n.query=e.query,n.host=e.host||"",n.auth=e.auth,n.hostname=e.hostname||e.host,n.port=e.port,n.pathname||n.search){var g=n.pathname||"",v=n.search||"";n.path=g+v}return n.slashes=n.slashes||e.slashes,n.href=n.format(),n}var b=n.pathname&&"/"===n.pathname.charAt(0),w=e.host||e.pathname&&"/"===e.pathname.charAt(0),S=w||b||n.host&&e.pathname,_=S,k=n.pathname&&n.pathname.split("/")||[],x=(m=e.pathname&&e.pathname.split("/")||[],n.protocol&&!y[n.protocol]);if(x&&(n.hostname="",n.port=null,n.host&&(""===k[0]?k[0]=n.host:k.unshift(n.host)),n.host="",e.protocol&&(e.hostname=null,e.port=null,e.host&&(""===m[0]?m[0]=e.host:m.unshift(e.host)),e.host=null),S=S&&(""===m[0]||""===k[0])),w)n.host=e.host||""===e.host?e.host:n.host,n.hostname=e.hostname||""===e.hostname?e.hostname:n.hostname,n.search=e.search,n.query=e.query,k=m;else if(m.length)k||(k=[]),k.pop(),k=k.concat(m),n.search=e.search,n.query=e.query;else if(!i.isNullOrUndefined(e.search))return x&&(n.hostname=n.host=k.shift(),(I=!!(n.host&&n.host.indexOf("@")>0)&&n.host.split("@"))&&(n.auth=I.shift(),n.host=n.hostname=I.shift())),n.search=e.search,n.query=e.query,i.isNull(n.pathname)&&i.isNull(n.search)||(n.path=(n.pathname?n.pathname:"")+(n.search?n.search:"")),n.href=n.format(),n;if(!k.length)return n.pathname=null,n.search?n.path="/"+n.search:n.path=null,n.href=n.format(),n;for(var E=k.slice(-1)[0],T=(n.host||e.host||k.length>1)&&("."===E||".."===E)||""===E,C=0,A=k.length;A>=0;A--)"."===(E=k[A])?k.splice(A,1):".."===E?(k.splice(A,1),C++):C&&(k.splice(A,1),C--);if(!S&&!_)for(;C--;C)k.unshift("..");!S||""===k[0]||k[0]&&"/"===k[0].charAt(0)||k.unshift(""),T&&"/"!==k.join("/").substr(-1)&&k.push("");var I,R=""===k[0]||k[0]&&"/"===k[0].charAt(0);return x&&(n.hostname=n.host=R?"":k.length?k.shift():"",(I=!!(n.host&&n.host.indexOf("@")>0)&&n.host.split("@"))&&(n.auth=I.shift(),n.host=n.hostname=I.shift())),(S=S||n.host&&k.length)&&!R&&k.unshift(""),k.length?n.pathname=k.join("/"):(n.pathname=null,n.path=null),i.isNull(n.pathname)&&i.isNull(n.search)||(n.path=(n.pathname?n.pathname:"")+(n.search?n.search:"")),n.auth=e.auth||n.auth,n.slashes=n.slashes||e.slashes,n.href=n.format(),n},s.prototype.parseHost=function(){var e=this.host,t=a.exec(e);t&&(":"!==(t=t[0])&&(this.port=t.substr(1)),e=e.substr(0,e.length-t.length)),e&&(this.hostname=e)}},2502:e=>{"use strict";e.exports={isString:function(e){return"string"==typeof e},isObject:function(e){return"object"==typeof e&&null!==e},isNull:function(e){return null===e},isNullOrUndefined:function(e){return null==e}}},3394:(e,t,n)=>{e.exports=function(){return new Worker(n.p+"pdf.worker.4995934ea64f7e531c27.js")}},7129:e=>{"use strict";e.exports="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0idXRmLTgiPz48IURPQ1RZUEUgc3ZnIFBVQkxJQyAiLS8vVzNDLy9EVEQgU1ZHIDEuMS8vRU4iICJodHRwOi8vd3d3LnczLm9yZy9HcmFwaGljcy9TVkcvMS4xL0RURC9zdmcxMS5kdGQiPjxzdmcgdmVyc2lvbj0iMS4xIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiB3aWR0aD0iMTYiIGhlaWdodD0iMjgiIHZpZXdCb3g9IjAgMCAxNiAyOCI+PGcgaWQ9Imljb21vb24taWdub3JlIj48L2c+PHBhdGggZD0iTTE2IDE3cTAgMC40MDYtMC4yOTcgMC43MDNsLTcgN3EtMC4yOTcgMC4yOTctMC43MDMgMC4yOTd0LTAuNzAzLTAuMjk3bC03LTdxLTAuMjk3LTAuMjk3LTAuMjk3LTAuNzAzdDAuMjk3LTAuNzAzIDAuNzAzLTAuMjk3aDE0cTAuNDA2IDAgMC43MDMgMC4yOTd0MC4yOTcgMC43MDN6TTE2IDExcTAgMC40MDYtMC4yOTcgMC43MDN0LTAuNzAzIDAuMjk3aC0xNHEtMC40MDYgMC0wLjcwMy0wLjI5N3QtMC4yOTctMC43MDMgMC4yOTctMC43MDNsNy03cTAuMjk3LTAuMjk3IDAuNzAzLTAuMjk3dDAuNzAzIDAuMjk3bDcgN3EwLjI5NyAwLjI5NyAwLjI5NyAwLjcwM3oiIGZpbGw9IiMwMDAwMDAiPjwvcGF0aD48L3N2Zz4="},8211:e=>{"use strict";e.exports="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyNCIgaGVpZ2h0PSIyNCIgdmlld0JveD0iMCAwIDI0IDI0IiBmaWxsPSJub25lIiBzdHJva2U9ImN1cnJlbnRDb2xvciIgc3Ryb2tlLXdpZHRoPSIyIiBzdHJva2UtbGluZWNhcD0icm91bmQiIHN0cm9rZS1saW5lam9pbj0icm91bmQiIGNsYXNzPSJmZWF0aGVyIGZlYXRoZXItbWFwLXBpbiI+PHBhdGggZD0iTTIxIDEwYzAgNy05IDEzLTkgMTNzLTktNi05LTEzYTkgOSAwIDAgMSAxOCAweiI+PC9wYXRoPjxjaXJjbGUgY3g9IjEyIiBjeT0iMTAiIHI9IjMiPjwvY2lyY2xlPjwvc3ZnPg=="},5685:e=>{"use strict";e.exports="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyNCIgaGVpZ2h0PSIyNCIgdmlld0JveD0iMCAwIDI0IDI0IiBmaWxsPSJub25lIiBzdHJva2U9IndoaXRlIiBzdHJva2Utd2lkdGg9IjIiIHN0cm9rZS1saW5lY2FwPSJyb3VuZCIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCIgY2xhc3M9ImZlYXRoZXIgZmVhdGhlci1tYXAtcGluIj48cGF0aCBkPSJNMjEgMTBjMCA3LTkgMTMtOSAxM3MtOS02LTktMTNhOSA5IDAgMCAxIDE4IDB6Ij48L3BhdGg+PGNpcmNsZSBjeD0iMTIiIGN5PSIxMCIgcj0iMyI+PC9jaXJjbGU+PC9zdmc+"},7675:(e,t,n)=>{"use strict";e.exports=n.p+"android-chrome-192x192.png"},9738:(e,t,n)=>{"use strict";e.exports=n.p+"android-chrome-512x512.png"},3969:(e,t,n)=>{"use strict";e.exports=n.p+"apple-touch-icon.png"},998:(e,t,n)=>{"use strict";e.exports=n.p+"favicon-16x16.png"},6361:(e,t,n)=>{"use strict";e.exports=n.p+"favicon-32x32.png"},6418:(e,t,n)=>{"use strict";e.exports=n.p+"favicon.ico"},7147:(e,t,n)=>{"use strict";e.exports=n.p+"index.html"},5921:(e,t,n)=>{"use strict";e.exports=n.p+"site.webmanifest"},4654:()=>{},3414:()=>{},172:()=>{},2001:()=>{},3779:()=>{},6558:()=>{},2258:()=>{},2868:()=>{},4777:()=>{},9830:()=>{},209:()=>{},7414:()=>{},2961:e=>{e.exports={nanoid:(e=21)=>{let t="",n=e;for(;n--;)t+="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict"[64*Math.random()|0];return t},customAlphabet:(e,t)=>()=>{let n="",r=t;for(;r--;)n+=e[Math.random()*e.length|0];return n}}},3600:e=>{"use strict";e.exports=JSON.parse('{"0":65533,"128":8364,"130":8218,"131":402,"132":8222,"133":8230,"134":8224,"135":8225,"136":710,"137":8240,"138":352,"139":8249,"140":338,"142":381,"145":8216,"146":8217,"147":8220,"148":8221,"149":8226,"150":8211,"151":8212,"152":732,"153":8482,"154":353,"155":8250,"156":339,"158":382,"159":376}')},9323:e=>{"use strict";e.exports=JSON.parse('{"Aacute":"","aacute":"","Abreve":"","abreve":"","ac":"","acd":"","acE":"","Acirc":"","acirc":"","acute":"","Acy":"","acy":"","AElig":"","aelig":"","af":"","Afr":"","afr":"","Agrave":"","agrave":"","alefsym":"","aleph":"","Alpha":"","alpha":"","Amacr":"","amacr":"","amalg":"","amp":"&","AMP":"&","andand":"","And":"","and":"","andd":"","andslope":"","andv":"","ang":"","ange":"","angle":"","angmsdaa":"","angmsdab":"","angmsdac":"","angmsdad":"","angmsdae":"","angmsdaf":"","angmsdag":"","angmsdah":"","angmsd":"","angrt":"","angrtvb":"","angrtvbd":"","angsph":"","angst":"","angzarr":"","Aogon":"","aogon":"","Aopf":"","aopf":"","apacir":"","ap":"","apE":"","ape":"","apid":"","apos":"\'","ApplyFunction":"","approx":"","approxeq":"","Aring":"","aring":"","Ascr":"","ascr":"","Assign":"","ast":"*","asymp":"","asympeq":"","Atilde":"","atilde":"","Auml":"","auml":"","awconint":"","awint":"","backcong":"","backepsilon":"","backprime":"","backsim":"","backsimeq":"","Backslash":"","Barv":"","barvee":"","barwed":"","Barwed":"","barwedge":"","bbrk":"","bbrktbrk":"","bcong":"","Bcy":"","bcy":"","bdquo":"","becaus":"","because":"","Because":"","bemptyv":"","bepsi":"","bernou":"","Bernoullis":"","Beta":"","beta":"","beth":"","between":"","Bfr":"","bfr":"","bigcap":"","bigcirc":"","bigcup":"","bigodot":"","bigoplus":"","bigotimes":"","bigsqcup":"","bigstar":"","bigtriangledown":"","bigtriangleup":"","biguplus":"","bigvee":"","bigwedge":"","bkarow":"","blacklozenge":"","blacksquare":"","blacktriangle":"","blacktriangledown":"","blacktriangleleft":"","blacktriangleright":"","blank":"","blk12":"","blk14":"","blk34":"","block":"","bne":"=","bnequiv":"","bNot":"","bnot":"","Bopf":"","bopf":"","bot":"","bottom":"","bowtie":"","boxbox":"","boxdl":"","boxdL":"","boxDl":"","boxDL":"","boxdr":"","boxdR":"","boxDr":"","boxDR":"","boxh":"","boxH":"","boxhd":"","boxHd":"","boxhD":"","boxHD":"","boxhu":"","boxHu":"","boxhU":"","boxHU":"","boxminus":"","boxplus":"","boxtimes":"","boxul":"","boxuL":"","boxUl":"","boxUL":"","boxur":"","boxuR":"","boxUr":"","boxUR":"","boxv":"","boxV":"","boxvh":"","boxvH":"","boxVh":"","boxVH":"","boxvl":"","boxvL":"","boxVl":"","boxVL":"","boxvr":"","boxvR":"","boxVr":"","boxVR":"","bprime":"","breve":"","Breve":"","brvbar":"","bscr":"","Bscr":"","bsemi":"","bsim":"","bsime":"","bsolb":"","bsol":"\\\\","bsolhsub":"","bull":"","bullet":"","bump":"","bumpE":"","bumpe":"","Bumpeq":"","bumpeq":"","Cacute":"","cacute":"","capand":"","capbrcup":"","capcap":"","cap":"","Cap":"","capcup":"","capdot":"","CapitalDifferentialD":"","caps":"","caret":"","caron":"","Cayleys":"","ccaps":"","Ccaron":"","ccaron":"","Ccedil":"","ccedil":"","Ccirc":"","ccirc":"","Cconint":"","ccups":"","ccupssm":"","Cdot":"","cdot":"","cedil":"","Cedilla":"","cemptyv":"","cent":"","centerdot":"","CenterDot":"","cfr":"","Cfr":"","CHcy":"","chcy":"","check":"","checkmark":"","Chi":"","chi":"","circ":"","circeq":"","circlearrowleft":"","circlearrowright":"","circledast":"","circledcirc":"","circleddash":"","CircleDot":"","circledR":"","circledS":"","CircleMinus":"","CirclePlus":"","CircleTimes":"","cir":"","cirE":"","cire":"","cirfnint":"","cirmid":"","cirscir":"","ClockwiseContourIntegral":"","CloseCurlyDoubleQuote":"","CloseCurlyQuote":"","clubs":"","clubsuit":"","colon":":","Colon":"","Colone":"","colone":"","coloneq":"","comma":",","commat":"@","comp":"","compfn":"","complement":"","complexes":"","cong":"","congdot":"","Congruent":"","conint":"","Conint":"","ContourIntegral":"","copf":"","Copf":"","coprod":"","Coproduct":"","copy":"","COPY":"","copysr":"","CounterClockwiseContourIntegral":"","crarr":"","cross":"","Cross":"","Cscr":"","cscr":"","csub":"","csube":"","csup":"","csupe":"","ctdot":"","cudarrl":"","cudarrr":"","cuepr":"","cuesc":"","cularr":"","cularrp":"","cupbrcap":"","cupcap":"","CupCap":"","cup":"","Cup":"","cupcup":"","cupdot":"","cupor":"","cups":"","curarr":"","curarrm":"","curlyeqprec":"","curlyeqsucc":"","curlyvee":"","curlywedge":"","curren":"","curvearrowleft":"","curvearrowright":"","cuvee":"","cuwed":"","cwconint":"","cwint":"","cylcty":"","dagger":"","Dagger":"","daleth":"","darr":"","Darr":"","dArr":"","dash":"","Dashv":"","dashv":"","dbkarow":"","dblac":"","Dcaron":"","dcaron":"","Dcy":"","dcy":"","ddagger":"","ddarr":"","DD":"","dd":"","DDotrahd":"","ddotseq":"","deg":"","Del":"","Delta":"","delta":"","demptyv":"","dfisht":"","Dfr":"","dfr":"","dHar":"","dharl":"","dharr":"","DiacriticalAcute":"","DiacriticalDot":"","DiacriticalDoubleAcute":"","DiacriticalGrave":"`","DiacriticalTilde":"","diam":"","diamond":"","Diamond":"","diamondsuit":"","diams":"","die":"","DifferentialD":"","digamma":"","disin":"","div":"","divide":"","divideontimes":"","divonx":"","DJcy":"","djcy":"","dlcorn":"","dlcrop":"","dollar":"$","Dopf":"","dopf":"","Dot":"","dot":"","DotDot":"","doteq":"","doteqdot":"","DotEqual":"","dotminus":"","dotplus":"","dotsquare":"","doublebarwedge":"","DoubleContourIntegral":"","DoubleDot":"","DoubleDownArrow":"","DoubleLeftArrow":"","DoubleLeftRightArrow":"","DoubleLeftTee":"","DoubleLongLeftArrow":"","DoubleLongLeftRightArrow":"","DoubleLongRightArrow":"","DoubleRightArrow":"","DoubleRightTee":"","DoubleUpArrow":"","DoubleUpDownArrow":"","DoubleVerticalBar":"","DownArrowBar":"","downarrow":"","DownArrow":"","Downarrow":"","DownArrowUpArrow":"","DownBreve":"","downdownarrows":"","downharpoonleft":"","downharpoonright":"","DownLeftRightVector":"","DownLeftTeeVector":"","DownLeftVectorBar":"","DownLeftVector":"","DownRightTeeVector":"","DownRightVectorBar":"","DownRightVector":"","DownTeeArrow":"","DownTee":"","drbkarow":"","drcorn":"","drcrop":"","Dscr":"","dscr":"","DScy":"","dscy":"","dsol":"","Dstrok":"","dstrok":"","dtdot":"","dtri":"","dtrif":"","duarr":"","duhar":"","dwangle":"","DZcy":"","dzcy":"","dzigrarr":"","Eacute":"","eacute":"","easter":"","Ecaron":"","ecaron":"","Ecirc":"","ecirc":"","ecir":"","ecolon":"","Ecy":"","ecy":"","eDDot":"","Edot":"","edot":"","eDot":"","ee":"","efDot":"","Efr":"","efr":"","eg":"","Egrave":"","egrave":"","egs":"","egsdot":"","el":"","Element":"","elinters":"","ell":"","els":"","elsdot":"","Emacr":"","emacr":"","empty":"","emptyset":"","EmptySmallSquare":"","emptyv":"","EmptyVerySmallSquare":"","emsp13":"","emsp14":"","emsp":"","ENG":"","eng":"","ensp":"","Eogon":"","eogon":"","Eopf":"","eopf":"","epar":"","eparsl":"","eplus":"","epsi":"","Epsilon":"","epsilon":"","epsiv":"","eqcirc":"","eqcolon":"","eqsim":"","eqslantgtr":"","eqslantless":"","Equal":"","equals":"=","EqualTilde":"","equest":"","Equilibrium":"","equiv":"","equivDD":"","eqvparsl":"","erarr":"","erDot":"","escr":"","Escr":"","esdot":"","Esim":"","esim":"","Eta":"","eta":"","ETH":"","eth":"","Euml":"","euml":"","euro":"","excl":"!","exist":"","Exists":"","expectation":"","exponentiale":"","ExponentialE":"","fallingdotseq":"","Fcy":"","fcy":"","female":"","ffilig":"","fflig":"","ffllig":"","Ffr":"","ffr":"","filig":"","FilledSmallSquare":"","FilledVerySmallSquare":"","fjlig":"fj","flat":"","fllig":"","fltns":"","fnof":"","Fopf":"","fopf":"","forall":"","ForAll":"","fork":"","forkv":"","Fouriertrf":"","fpartint":"","frac12":"","frac13":"","frac14":"","frac15":"","frac16":"","frac18":"","frac23":"","frac25":"","frac34":"","frac35":"","frac38":"","frac45":"","frac56":"","frac58":"","frac78":"","frasl":"","frown":"","fscr":"","Fscr":"","gacute":"","Gamma":"","gamma":"","Gammad":"","gammad":"","gap":"","Gbreve":"","gbreve":"","Gcedil":"","Gcirc":"","gcirc":"","Gcy":"","gcy":"","Gdot":"","gdot":"","ge":"","gE":"","gEl":"","gel":"","geq":"","geqq":"","geqslant":"","gescc":"","ges":"","gesdot":"","gesdoto":"","gesdotol":"","gesl":"","gesles":"","Gfr":"","gfr":"","gg":"","Gg":"","ggg":"","gimel":"","GJcy":"","gjcy":"","gla":"","gl":"","glE":"","glj":"","gnap":"","gnapprox":"","gne":"","gnE":"","gneq":"","gneqq":"","gnsim":"","Gopf":"","gopf":"","grave":"`","GreaterEqual":"","GreaterEqualLess":"","GreaterFullEqual":"","GreaterGreater":"","GreaterLess":"","GreaterSlantEqual":"","GreaterTilde":"","Gscr":"","gscr":"","gsim":"","gsime":"","gsiml":"","gtcc":"","gtcir":"","gt":">","GT":">","Gt":"","gtdot":"","gtlPar":"","gtquest":"","gtrapprox":"","gtrarr":"","gtrdot":"","gtreqless":"","gtreqqless":"","gtrless":"","gtrsim":"","gvertneqq":"","gvnE":"","Hacek":"","hairsp":"","half":"","hamilt":"","HARDcy":"","hardcy":"","harrcir":"","harr":"","hArr":"","harrw":"","Hat":"^","hbar":"","Hcirc":"","hcirc":"","hearts":"","heartsuit":"","hellip":"","hercon":"","hfr":"","Hfr":"","HilbertSpace":"","hksearow":"","hkswarow":"","hoarr":"","homtht":"","hookleftarrow":"","hookrightarrow":"","hopf":"","Hopf":"","horbar":"","HorizontalLine":"","hscr":"","Hscr":"","hslash":"","Hstrok":"","hstrok":"","HumpDownHump":"","HumpEqual":"","hybull":"","hyphen":"","Iacute":"","iacute":"","ic":"","Icirc":"","icirc":"","Icy":"","icy":"","Idot":"","IEcy":"","iecy":"","iexcl":"","iff":"","ifr":"","Ifr":"","Igrave":"","igrave":"","ii":"","iiiint":"","iiint":"","iinfin":"","iiota":"","IJlig":"","ijlig":"","Imacr":"","imacr":"","image":"","ImaginaryI":"","imagline":"","imagpart":"","imath":"","Im":"","imof":"","imped":"","Implies":"","incare":"","in":"","infin":"","infintie":"","inodot":"","intcal":"","int":"","Int":"","integers":"","Integral":"","intercal":"","Intersection":"","intlarhk":"","intprod":"","InvisibleComma":"","InvisibleTimes":"","IOcy":"","iocy":"","Iogon":"","iogon":"","Iopf":"","iopf":"","Iota":"","iota":"","iprod":"","iquest":"","iscr":"","Iscr":"","isin":"","isindot":"","isinE":"","isins":"","isinsv":"","isinv":"","it":"","Itilde":"","itilde":"","Iukcy":"","iukcy":"","Iuml":"","iuml":"","Jcirc":"","jcirc":"","Jcy":"","jcy":"","Jfr":"","jfr":"","jmath":"","Jopf":"","jopf":"","Jscr":"","jscr":"","Jsercy":"","jsercy":"","Jukcy":"","jukcy":"","Kappa":"","kappa":"","kappav":"","Kcedil":"","kcedil":"","Kcy":"","kcy":"","Kfr":"","kfr":"","kgreen":"","KHcy":"","khcy":"","KJcy":"","kjcy":"","Kopf":"","kopf":"","Kscr":"","kscr":"","lAarr":"","Lacute":"","lacute":"","laemptyv":"","lagran":"","Lambda":"","lambda":"","lang":"","Lang":"","langd":"","langle":"","lap":"","Laplacetrf":"","laquo":"","larrb":"","larrbfs":"","larr":"","Larr":"","lArr":"","larrfs":"","larrhk":"","larrlp":"","larrpl":"","larrsim":"","larrtl":"","latail":"","lAtail":"","lat":"","late":"","lates":"","lbarr":"","lBarr":"","lbbrk":"","lbrace":"{","lbrack":"[","lbrke":"","lbrksld":"","lbrkslu":"","Lcaron":"","lcaron":"","Lcedil":"","lcedil":"","lceil":"","lcub":"{","Lcy":"","lcy":"","ldca":"","ldquo":"","ldquor":"","ldrdhar":"","ldrushar":"","ldsh":"","le":"","lE":"","LeftAngleBracket":"","LeftArrowBar":"","leftarrow":"","LeftArrow":"","Leftarrow":"","LeftArrowRightArrow":"","leftarrowtail":"","LeftCeiling":"","LeftDoubleBracket":"","LeftDownTeeVector":"","LeftDownVectorBar":"","LeftDownVector":"","LeftFloor":"","leftharpoondown":"","leftharpoonup":"","leftleftarrows":"","leftrightarrow":"","LeftRightArrow":"","Leftrightarrow":"","leftrightarrows":"","leftrightharpoons":"","leftrightsquigarrow":"","LeftRightVector":"","LeftTeeArrow":"","LeftTee":"","LeftTeeVector":"","leftthreetimes":"","LeftTriangleBar":"","LeftTriangle":"","LeftTriangleEqual":"","LeftUpDownVector":"","LeftUpTeeVector":"","LeftUpVectorBar":"","LeftUpVector":"","LeftVectorBar":"","LeftVector":"","lEg":"","leg":"","leq":"","leqq":"","leqslant":"","lescc":"","les":"","lesdot":"","lesdoto":"","lesdotor":"","lesg":"","lesges":"","lessapprox":"","lessdot":"","lesseqgtr":"","lesseqqgtr":"","LessEqualGreater":"","LessFullEqual":"","LessGreater":"","lessgtr":"","LessLess":"","lesssim":"","LessSlantEqual":"","LessTilde":"","lfisht":"","lfloor":"","Lfr":"","lfr":"","lg":"","lgE":"","lHar":"","lhard":"","lharu":"","lharul":"","lhblk":"","LJcy":"","ljcy":"","llarr":"","ll":"","Ll":"","llcorner":"","Lleftarrow":"","llhard":"","lltri":"","Lmidot":"","lmidot":"","lmoustache":"","lmoust":"","lnap":"","lnapprox":"","lne":"","lnE":"","lneq":"","lneqq":"","lnsim":"","loang":"","loarr":"","lobrk":"","longleftarrow":"","LongLeftArrow":"","Longleftarrow":"","longleftrightarrow":"","LongLeftRightArrow":"","Longleftrightarrow":"","longmapsto":"","longrightarrow":"","LongRightArrow":"","Longrightarrow":"","looparrowleft":"","looparrowright":"","lopar":"","Lopf":"","lopf":"","loplus":"","lotimes":"","lowast":"","lowbar":"_","LowerLeftArrow":"","LowerRightArrow":"","loz":"","lozenge":"","lozf":"","lpar":"(","lparlt":"","lrarr":"","lrcorner":"","lrhar":"","lrhard":"","lrm":"","lrtri":"","lsaquo":"","lscr":"","Lscr":"","lsh":"","Lsh":"","lsim":"","lsime":"","lsimg":"","lsqb":"[","lsquo":"","lsquor":"","Lstrok":"","lstrok":"","ltcc":"","ltcir":"","lt":"<","LT":"<","Lt":"","ltdot":"","lthree":"","ltimes":"","ltlarr":"","ltquest":"","ltri":"","ltrie":"","ltrif":"","ltrPar":"","lurdshar":"","luruhar":"","lvertneqq":"","lvnE":"","macr":"","male":"","malt":"","maltese":"","Map":"","map":"","mapsto":"","mapstodown":"","mapstoleft":"","mapstoup":"","marker":"","mcomma":"","Mcy":"","mcy":"","mdash":"","mDDot":"","measuredangle":"","MediumSpace":"","Mellintrf":"","Mfr":"","mfr":"","mho":"","micro":"","midast":"*","midcir":"","mid":"","middot":"","minusb":"","minus":"","minusd":"","minusdu":"","MinusPlus":"","mlcp":"","mldr":"","mnplus":"","models":"","Mopf":"","mopf":"","mp":"","mscr":"","Mscr":"","mstpos":"","Mu":"","mu":"","multimap":"","mumap":"","nabla":"","Nacute":"","nacute":"","nang":"","nap":"","napE":"","napid":"","napos":"","napprox":"","natural":"","naturals":"","natur":"","nbsp":"","nbump":"","nbumpe":"","ncap":"","Ncaron":"","ncaron":"","Ncedil":"","ncedil":"","ncong":"","ncongdot":"","ncup":"","Ncy":"","ncy":"","ndash":"","nearhk":"","nearr":"","neArr":"","nearrow":"","ne":"","nedot":"","NegativeMediumSpace":"","NegativeThickSpace":"","NegativeThinSpace":"","NegativeVeryThinSpace":"","nequiv":"","nesear":"","nesim":"","NestedGreaterGreater":"","NestedLessLess":"","NewLine":"\\n","nexist":"","nexists":"","Nfr":"","nfr":"","ngE":"","nge":"","ngeq":"","ngeqq":"","ngeqslant":"","nges":"","nGg":"","ngsim":"","nGt":"","ngt":"","ngtr":"","nGtv":"","nharr":"","nhArr":"","nhpar":"","ni":"","nis":"","nisd":"","niv":"","NJcy":"","njcy":"","nlarr":"","nlArr":"","nldr":"","nlE":"","nle":"","nleftarrow":"","nLeftarrow":"","nleftrightarrow":"","nLeftrightarrow":"","nleq":"","nleqq":"","nleqslant":"","nles":"","nless":"","nLl":"","nlsim":"","nLt":"","nlt":"","nltri":"","nltrie":"","nLtv":"","nmid":"","NoBreak":"","NonBreakingSpace":"","nopf":"","Nopf":"","Not":"","not":"","NotCongruent":"","NotCupCap":"","NotDoubleVerticalBar":"","NotElement":"","NotEqual":"","NotEqualTilde":"","NotExists":"","NotGreater":"","NotGreaterEqual":"","NotGreaterFullEqual":"","NotGreaterGreater":"","NotGreaterLess":"","NotGreaterSlantEqual":"","NotGreaterTilde":"","NotHumpDownHump":"","NotHumpEqual":"","notin":"","notindot":"","notinE":"","notinva":"","notinvb":"","notinvc":"","NotLeftTriangleBar":"","NotLeftTriangle":"","NotLeftTriangleEqual":"","NotLess":"","NotLessEqual":"","NotLessGreater":"","NotLessLess":"","NotLessSlantEqual":"","NotLessTilde":"","NotNestedGreaterGreater":"","NotNestedLessLess":"","notni":"","notniva":"","notnivb":"","notnivc":"","NotPrecedes":"","NotPrecedesEqual":"","NotPrecedesSlantEqual":"","NotReverseElement":"","NotRightTriangleBar":"","NotRightTriangle":"","NotRightTriangleEqual":"","NotSquareSubset":"","NotSquareSubsetEqual":"","NotSquareSuperset":"","NotSquareSupersetEqual":"","NotSubset":"","NotSubsetEqual":"","NotSucceeds":"","NotSucceedsEqual":"","NotSucceedsSlantEqual":"","NotSucceedsTilde":"","NotSuperset":"","NotSupersetEqual":"","NotTilde":"","NotTildeEqual":"","NotTildeFullEqual":"","NotTildeTilde":"","NotVerticalBar":"","nparallel":"","npar":"","nparsl":"","npart":"","npolint":"","npr":"","nprcue":"","nprec":"","npreceq":"","npre":"","nrarrc":"","nrarr":"","nrArr":"","nrarrw":"","nrightarrow":"","nRightarrow":"","nrtri":"","nrtrie":"","nsc":"","nsccue":"","nsce":"","Nscr":"","nscr":"","nshortmid":"","nshortparallel":"","nsim":"","nsime":"","nsimeq":"","nsmid":"","nspar":"","nsqsube":"","nsqsupe":"","nsub":"","nsubE":"","nsube":"","nsubset":"","nsubseteq":"","nsubseteqq":"","nsucc":"","nsucceq":"","nsup":"","nsupE":"","nsupe":"","nsupset":"","nsupseteq":"","nsupseteqq":"","ntgl":"","Ntilde":"","ntilde":"","ntlg":"","ntriangleleft":"","ntrianglelefteq":"","ntriangleright":"","ntrianglerighteq":"","Nu":"","nu":"","num":"#","numero":"","numsp":"","nvap":"","nvdash":"","nvDash":"","nVdash":"","nVDash":"","nvge":"","nvgt":">","nvHarr":"","nvinfin":"","nvlArr":"","nvle":"","nvlt":"<","nvltrie":"","nvrArr":"","nvrtrie":"","nvsim":"","nwarhk":"","nwarr":"","nwArr":"","nwarrow":"","nwnear":"","Oacute":"","oacute":"","oast":"","Ocirc":"","ocirc":"","ocir":"","Ocy":"","ocy":"","odash":"","Odblac":"","odblac":"","odiv":"","odot":"","odsold":"","OElig":"","oelig":"","ofcir":"","Ofr":"","ofr":"","ogon":"","Ograve":"","ograve":"","ogt":"","ohbar":"","ohm":"","oint":"","olarr":"","olcir":"","olcross":"","oline":"","olt":"","Omacr":"","omacr":"","Omega":"","omega":"","Omicron":"","omicron":"","omid":"","ominus":"","Oopf":"","oopf":"","opar":"","OpenCurlyDoubleQuote":"","OpenCurlyQuote":"","operp":"","oplus":"","orarr":"","Or":"","or":"","ord":"","order":"","orderof":"","ordf":"","ordm":"","origof":"","oror":"","orslope":"","orv":"","oS":"","Oscr":"","oscr":"","Oslash":"","oslash":"","osol":"","Otilde":"","otilde":"","otimesas":"","Otimes":"","otimes":"","Ouml":"","ouml":"","ovbar":"","OverBar":"","OverBrace":"","OverBracket":"","OverParenthesis":"","para":"","parallel":"","par":"","parsim":"","parsl":"","part":"","PartialD":"","Pcy":"","pcy":"","percnt":"%","period":".","permil":"","perp":"","pertenk":"","Pfr":"","pfr":"","Phi":"","phi":"","phiv":"","phmmat":"","phone":"","Pi":"","pi":"","pitchfork":"","piv":"","planck":"","planckh":"","plankv":"","plusacir":"","plusb":"","pluscir":"","plus":"+","plusdo":"","plusdu":"","pluse":"","PlusMinus":"","plusmn":"","plussim":"","plustwo":"","pm":"","Poincareplane":"","pointint":"","popf":"","Popf":"","pound":"","prap":"","Pr":"","pr":"","prcue":"","precapprox":"","prec":"","preccurlyeq":"","Precedes":"","PrecedesEqual":"","PrecedesSlantEqual":"","PrecedesTilde":"","preceq":"","precnapprox":"","precneqq":"","precnsim":"","pre":"","prE":"","precsim":"","prime":"","Prime":"","primes":"","prnap":"","prnE":"","prnsim":"","prod":"","Product":"","profalar":"","profline":"","profsurf":"","prop":"","Proportional":"","Proportion":"","propto":"","prsim":"","prurel":"","Pscr":"","pscr":"","Psi":"","psi":"","puncsp":"","Qfr":"","qfr":"","qint":"","qopf":"","Qopf":"","qprime":"","Qscr":"","qscr":"","quaternions":"","quatint":"","quest":"?","questeq":"","quot":"\\"","QUOT":"\\"","rAarr":"","race":"","Racute":"","racute":"","radic":"","raemptyv":"","rang":"","Rang":"","rangd":"","range":"","rangle":"","raquo":"","rarrap":"","rarrb":"","rarrbfs":"","rarrc":"","rarr":"","Rarr":"","rArr":"","rarrfs":"","rarrhk":"","rarrlp":"","rarrpl":"","rarrsim":"","Rarrtl":"","rarrtl":"","rarrw":"","ratail":"","rAtail":"","ratio":"","rationals":"","rbarr":"","rBarr":"","RBarr":"","rbbrk":"","rbrace":"}","rbrack":"]","rbrke":"","rbrksld":"","rbrkslu":"","Rcaron":"","rcaron":"","Rcedil":"","rcedil":"","rceil":"","rcub":"}","Rcy":"","rcy":"","rdca":"","rdldhar":"","rdquo":"","rdquor":"","rdsh":"","real":"","realine":"","realpart":"","reals":"","Re":"","rect":"","reg":"","REG":"","ReverseElement":"","ReverseEquilibrium":"","ReverseUpEquilibrium":"","rfisht":"","rfloor":"","rfr":"","Rfr":"","rHar":"","rhard":"","rharu":"","rharul":"","Rho":"","rho":"","rhov":"","RightAngleBracket":"","RightArrowBar":"","rightarrow":"","RightArrow":"","Rightarrow":"","RightArrowLeftArrow":"","rightarrowtail":"","RightCeiling":"","RightDoubleBracket":"","RightDownTeeVector":"","RightDownVectorBar":"","RightDownVector":"","RightFloor":"","rightharpoondown":"","rightharpoonup":"","rightleftarrows":"","rightleftharpoons":"","rightrightarrows":"","rightsquigarrow":"","RightTeeArrow":"","RightTee":"","RightTeeVector":"","rightthreetimes":"","RightTriangleBar":"","RightTriangle":"","RightTriangleEqual":"","RightUpDownVector":"","RightUpTeeVector":"","RightUpVectorBar":"","RightUpVector":"","RightVectorBar":"","RightVector":"","ring":"","risingdotseq":"","rlarr":"","rlhar":"","rlm":"","rmoustache":"","rmoust":"","rnmid":"","roang":"","roarr":"","robrk":"","ropar":"","ropf":"","Ropf":"","roplus":"","rotimes":"","RoundImplies":"","rpar":")","rpargt":"","rppolint":"","rrarr":"","Rrightarrow":"","rsaquo":"","rscr":"","Rscr":"","rsh":"","Rsh":"","rsqb":"]","rsquo":"","rsquor":"","rthree":"","rtimes":"","rtri":"","rtrie":"","rtrif":"","rtriltri":"","RuleDelayed":"","ruluhar":"","rx":"","Sacute":"","sacute":"","sbquo":"","scap":"","Scaron":"","scaron":"","Sc":"","sc":"","sccue":"","sce":"","scE":"","Scedil":"","scedil":"","Scirc":"","scirc":"","scnap":"","scnE":"","scnsim":"","scpolint":"","scsim":"","Scy":"","scy":"","sdotb":"","sdot":"","sdote":"","searhk":"","searr":"","seArr":"","searrow":"","sect":"","semi":";","seswar":"","setminus":"","setmn":"","sext":"","Sfr":"","sfr":"","sfrown":"","sharp":"","SHCHcy":"","shchcy":"","SHcy":"","shcy":"","ShortDownArrow":"","ShortLeftArrow":"","shortmid":"","shortparallel":"","ShortRightArrow":"","ShortUpArrow":"","shy":"","Sigma":"","sigma":"","sigmaf":"","sigmav":"","sim":"","simdot":"","sime":"","simeq":"","simg":"","simgE":"","siml":"","simlE":"","simne":"","simplus":"","simrarr":"","slarr":"","SmallCircle":"","smallsetminus":"","smashp":"","smeparsl":"","smid":"","smile":"","smt":"","smte":"","smtes":"","SOFTcy":"","softcy":"","solbar":"","solb":"","sol":"/","Sopf":"","sopf":"","spades":"","spadesuit":"","spar":"","sqcap":"","sqcaps":"","sqcup":"","sqcups":"","Sqrt":"","sqsub":"","sqsube":"","sqsubset":"","sqsubseteq":"","sqsup":"","sqsupe":"","sqsupset":"","sqsupseteq":"","square":"","Square":"","SquareIntersection":"","SquareSubset":"","SquareSubsetEqual":"","SquareSuperset":"","SquareSupersetEqual":"","SquareUnion":"","squarf":"","squ":"","squf":"","srarr":"","Sscr":"","sscr":"","ssetmn":"","ssmile":"","sstarf":"","Star":"","star":"","starf":"","straightepsilon":"","straightphi":"","strns":"","sub":"","Sub":"","subdot":"","subE":"","sube":"","subedot":"","submult":"","subnE":"","subne":"","subplus":"","subrarr":"","subset":"","Subset":"","subseteq":"","subseteqq":"","SubsetEqual":"","subsetneq":"","subsetneqq":"","subsim":"","subsub":"","subsup":"","succapprox":"","succ":"","succcurlyeq":"","Succeeds":"","SucceedsEqual":"","SucceedsSlantEqual":"","SucceedsTilde":"","succeq":"","succnapprox":"","succneqq":"","succnsim":"","succsim":"","SuchThat":"","sum":"","Sum":"","sung":"","sup1":"","sup2":"","sup3":"","sup":"","Sup":"","supdot":"","supdsub":"","supE":"","supe":"","supedot":"","Superset":"","SupersetEqual":"","suphsol":"","suphsub":"","suplarr":"","supmult":"","supnE":"","supne":"","supplus":"","supset":"","Supset":"","supseteq":"","supseteqq":"","supsetneq":"","supsetneqq":"","supsim":"","supsub":"","supsup":"","swarhk":"","swarr":"","swArr":"","swarrow":"","swnwar":"","szlig":"","Tab":"\\t","target":"","Tau":"","tau":"","tbrk":"","Tcaron":"","tcaron":"","Tcedil":"","tcedil":"","Tcy":"","tcy":"","tdot":"","telrec":"","Tfr":"","tfr":"","there4":"","therefore":"","Therefore":"","Theta":"","theta":"","thetasym":"","thetav":"","thickapprox":"","thicksim":"","ThickSpace":"","ThinSpace":"","thinsp":"","thkap":"","thksim":"","THORN":"","thorn":"","tilde":"","Tilde":"","TildeEqual":"","TildeFullEqual":"","TildeTilde":"","timesbar":"","timesb":"","times":"","timesd":"","tint":"","toea":"","topbot":"","topcir":"","top":"","Topf":"","topf":"","topfork":"","tosa":"","tprime":"","trade":"","TRADE":"","triangle":"","triangledown":"","triangleleft":"","trianglelefteq":"","triangleq":"","triangleright":"","trianglerighteq":"","tridot":"","trie":"","triminus":"","TripleDot":"","triplus":"","trisb":"","tritime":"","trpezium":"","Tscr":"","tscr":"","TScy":"","tscy":"","TSHcy":"","tshcy":"","Tstrok":"","tstrok":"","twixt":"","twoheadleftarrow":"","twoheadrightarrow":"","Uacute":"","uacute":"","uarr":"","Uarr":"","uArr":"","Uarrocir":"","Ubrcy":"","ubrcy":"","Ubreve":"","ubreve":"","Ucirc":"","ucirc":"","Ucy":"","ucy":"","udarr":"","Udblac":"","udblac":"","udhar":"","ufisht":"","Ufr":"","ufr":"","Ugrave":"","ugrave":"","uHar":"","uharl":"","uharr":"","uhblk":"","ulcorn":"","ulcorner":"","ulcrop":"","ultri":"","Umacr":"","umacr":"","uml":"","UnderBar":"_","UnderBrace":"","UnderBracket":"","UnderParenthesis":"","Union":"","UnionPlus":"","Uogon":"","uogon":"","Uopf":"","uopf":"","UpArrowBar":"","uparrow":"","UpArrow":"","Uparrow":"","UpArrowDownArrow":"","updownarrow":"","UpDownArrow":"","Updownarrow":"","UpEquilibrium":"","upharpoonleft":"","upharpoonright":"","uplus":"","UpperLeftArrow":"","UpperRightArrow":"","upsi":"","Upsi":"","upsih":"","Upsilon":"","upsilon":"","UpTeeArrow":"","UpTee":"","upuparrows":"","urcorn":"","urcorner":"","urcrop":"","Uring":"","uring":"","urtri":"","Uscr":"","uscr":"","utdot":"","Utilde":"","utilde":"","utri":"","utrif":"","uuarr":"","Uuml":"","uuml":"","uwangle":"","vangrt":"","varepsilon":"","varkappa":"","varnothing":"","varphi":"","varpi":"","varpropto":"","varr":"","vArr":"","varrho":"","varsigma":"","varsubsetneq":"","varsubsetneqq":"","varsupsetneq":"","varsupsetneqq":"","vartheta":"","vartriangleleft":"","vartriangleright":"","vBar":"","Vbar":"","vBarv":"","Vcy":"","vcy":"","vdash":"","vDash":"","Vdash":"","VDash":"","Vdashl":"","veebar":"","vee":"","Vee":"","veeeq":"","vellip":"","verbar":"|","Verbar":"","vert":"|","Vert":"","VerticalBar":"","VerticalLine":"|","VerticalSeparator":"","VerticalTilde":"","VeryThinSpace":"","Vfr":"","vfr":"","vltri":"","vnsub":"","vnsup":"","Vopf":"","vopf":"","vprop":"","vrtri":"","Vscr":"","vscr":"","vsubnE":"","vsubne":"","vsupnE":"","vsupne":"","Vvdash":"","vzigzag":"","Wcirc":"","wcirc":"","wedbar":"","wedge":"","Wedge":"","wedgeq":"","weierp":"","Wfr":"","wfr":"","Wopf":"","wopf":"","wp":"","wr":"","wreath":"","Wscr":"","wscr":"","xcap":"","xcirc":"","xcup":"","xdtri":"","Xfr":"","xfr":"","xharr":"","xhArr":"","Xi":"","xi":"","xlarr":"","xlArr":"","xmap":"","xnis":"","xodot":"","Xopf":"","xopf":"","xoplus":"","xotime":"","xrarr":"","xrArr":"","Xscr":"","xscr":"","xsqcup":"","xuplus":"","xutri":"","xvee":"","xwedge":"","Yacute":"","yacute":"","YAcy":"","yacy":"","Ycirc":"","ycirc":"","Ycy":"","ycy":"","yen":"","Yfr":"","yfr":"","YIcy":"","yicy":"","Yopf":"","yopf":"","Yscr":"","yscr":"","YUcy":"","yucy":"","yuml":"","Yuml":"","Zacute":"","zacute":"","Zcaron":"","zcaron":"","Zcy":"","zcy":"","Zdot":"","zdot":"","zeetrf":"","ZeroWidthSpace":"","Zeta":"","zeta":"","zfr":"","Zfr":"","ZHcy":"","zhcy":"","zigrarr":"","zopf":"","Zopf":"","Zscr":"","zscr":"","zwj":"","zwnj":""}')},9591:e=>{"use strict";e.exports=JSON.parse('{"Aacute":"","aacute":"","Acirc":"","acirc":"","acute":"","AElig":"","aelig":"","Agrave":"","agrave":"","amp":"&","AMP":"&","Aring":"","aring":"","Atilde":"","atilde":"","Auml":"","auml":"","brvbar":"","Ccedil":"","ccedil":"","cedil":"","cent":"","copy":"","COPY":"","curren":"","deg":"","divide":"","Eacute":"","eacute":"","Ecirc":"","ecirc":"","Egrave":"","egrave":"","ETH":"","eth":"","Euml":"","euml":"","frac12":"","frac14":"","frac34":"","gt":">","GT":">","Iacute":"","iacute":"","Icirc":"","icirc":"","iexcl":"","Igrave":"","igrave":"","iquest":"","Iuml":"","iuml":"","laquo":"","lt":"<","LT":"<","macr":"","micro":"","middot":"","nbsp":"","not":"","Ntilde":"","ntilde":"","Oacute":"","oacute":"","Ocirc":"","ocirc":"","Ograve":"","ograve":"","ordf":"","ordm":"","Oslash":"","oslash":"","Otilde":"","otilde":"","Ouml":"","ouml":"","para":"","plusmn":"","pound":"","quot":"\\"","QUOT":"\\"","raquo":"","reg":"","REG":"","sect":"","shy":"","sup1":"","sup2":"","sup3":"","szlig":"","THORN":"","thorn":"","times":"","Uacute":"","uacute":"","Ucirc":"","ucirc":"","Ugrave":"","ugrave":"","uml":"","Uuml":"","uuml":"","Yacute":"","yacute":"","yen":"","yuml":""}')},2586:e=>{"use strict";e.exports=JSON.parse('{"amp":"&","apos":"\'","gt":">","lt":"<","quot":"\\""}')},7873:e=>{"use strict";e.exports=JSON.parse('{"0":"O","1":"l","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","\\u2028":" ","\\u2029":" ","":" ","":" ","":" ","":" ","":" ","":" ","":" ","":" ","":" ","":" ","":" ","":" ","":" ","":" ","":" ","":"_","":"_","":"_","":"_","":"-","":"-","":"-","":"-","":"-","":"-","":"-","":"-","":"-","":"-","":"-","":"-","":"-","":"-","":"-","":"-","":"-.","":"","":",","":",","":",","":",","":",","":"","":"","":";","":"","":":","":":","":":","":":","":":","":":","":":","":":","":":","":":","":":","":":","":":","":":","":":","":":","":":","":"::=","":":","":"!","":"!","":"!","":"!!","":"!?","":"?","":"?","":"?","":"?","":"?","":"?!","":"??","":"","":".","":".","":".","":".","":".","":".","":".","":".","":".","":".,","":"..","":"..","":"...","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"<","":">","":">","":">","":"4","":"b","":"b","":"d","":"J","":"L","":"P","":"U","":"V","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"\'","":"\'","":"\'","":"\'","":"\'","":"\'","":"\'","":"\'","":"\'","`":"\'","":"\'","":"\'","":"\'","":"\'","":"\'","":"\'","":"\'","":"\'","":"\'","":"\'","":"\'","":"\'","":"\'","":"\'","":"\'","":"\'","":"\'","":"\'","":"\'","":"\'","":"\'","":"\'","":"\'","":"\'","":"\'","":"\'","":"\'\'","\\"":"\'\'","":"\'\'","":"\'\'","":"\'\'","":"\'\'","":"\'\'","":"\'\'","":"\'\'","":"\'\'","":"\'\'","":"\'\'","":"\'\'","":"\'\'","":"\'\'","":"\'\'\'","":"\'\'\'","":"\'\'\'\'","":"\'B","":"\'D","":"\'n","":"\'P","":"\'T","":"\'Y","":"(","":"(","":"(","":"(","":"(","":"((","":"()","":"(2)","":"(2O)","":"(3)","":"(4)","":"(5)","":"(6)","":"(7)","":"(8)","":"(9)","":"(a)","":"(A)","":"(b)","":"(B)","":"(c)","":"(C)","":"(d)","":"(D)","":"(e)","":"(E)","":"(f)","":"(F)","":"(g)","":"(G)","":"(h)","":"(H)","":"(i)","":"(j)","":"(J)","":"(k)","":"(K)","":"(l)","":"(l)","":"(l)","":"(L)","":"(l2)","":"(l3)","":"(l4)","":"(l5)","":"(l6)","":"(l7)","":"(l8)","":"(l9)","":"(ll)","":"(lO)","":"(M)","":"(n)","":"(N)","":"(o)","":"(O)","":"(p)","":"(P)","":"(q)","":"(Q)","":"(r)","":"(R)","":"(rn)","":"(s)","":"(S)","":"(S)","":"(t)","":"(T)","":"(u)","":"(U)","":"(v)","":"(V)","":"(w)","":"(W)","":"(x)","":"(X)","":"(y)","":"(Y)","":"(z)","":"(Z)","":"()","":"()","":"()","":"()","":"()","":"()","":"()","":"()","":"()","":"()","":"()","":"()","":"()","":"()","":"()","":"()","":"()","":"()","":"()","":"()","":"()","":"()","":"()","":"()","":"()","":"()","":"()","":"()","":"()","":"()","":"()","":"()","":"()","":"()","":"()","":"()","":"()","":"()","":"()","":"()","":"()","":"()","":"()","":"()","":"()","":"()","":"()","":"()","":"()","":"()","":"()","":"()","":"()","":"()","":"()","":"()","":"()","":"()","":"()","":"()","":"()","":"()","":"()","":"()","":"()","":"()","":"()","":"()","":"()","":"()","":"()","":"()","":"()","":"()","":"()","":")","":")","":")","":")","":")","":"))","":"{","":"{","":"}","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"*","":"*","":"*","":"*","":"/","":"/","":"/","":"/","":"/","":"/","":"/","":"/","":"/","":"/","":"/","":"/","":"/","":"/","":"/","":"//","":"///","":"\\\\","":"\\\\","":"\\\\","":"\\\\","":"\\\\","":"\\\\","":"\\\\","":"\\\\","":"\\\\","":"\\\\","":"\\\\","":"\\\\\\\\","":"\\\\\\\\","":"\\\\","":"&","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"^","":"^","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"b","":"bi","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"C","":"F","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"+","":"+","":"+","":"+","":"+","":"+","":"+","":"+","":"+","":"+","":"","":"<","":"<","":"<","":"<","":"<","":"<","":"<","":"<","":"<","":"<<","":"<<<","":"=","":"=","":"=","":"=","":"=","":"=","":"=","":"=","":"=","":"=","":"==","":"===","":"=","":">","":">","":">","":">","":">","":">","":">","":"><","":">>","":">>","":">>>","":"~","":"~","":"~","":"~","":"~","":"~","":"~","":"~","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"$","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"2","":"2","":"2","":"2","":"2","":"2","":"2","":"2","":"2","":"2","":"2","":"2","":"","":"","":"","":"","":"","":"","":"2","":"2,","":"2.","":"22","":"22","":"23","":"23","":"24","":"24","":"25","":"26","":"27","":"28","":"29","":"2l","":"2l","":"2O.","":"2O","":"2O","":"","":"","":"2","":"2","":"2","":"3","":"3","":"3","":"3","":"3","":"3","":"3","":"3","":"3","":"3","":"3","":"3","":"3","":"3","":"3","":"3","":"","":"","":"","":"","":"3","":"3,","":"3.","":"3l","":"3O","":"3","":"3","":"3","":"4","":"4","":"4","":"4","":"4","":"4","":"4","":"4","":"","":"","":"","":"4,","":"4.","":"4","":"4","":"4","":"4","":"5","":"5","":"5","":"5","":"5","":"5","":"5","":"5","":"","":"5,","":"5.","":"5","":"5","":"5","":"6","":"6","":"6","":"6","":"6","":"6","":"6","":"6","":"6","":"6","":"","":"","":"","":"6,","":"6.","":"6","":"6","":"6","":"7","":"7","":"7","":"7","":"7","":"7","":"7","":"7","":"7","":"","":"7,","":"7.","":"7","":"7","":"7","":"8","":"8","":"8","":"8","":"8","":"8","":"8","":"8","":"8","":"8","":"8","":"8","":"8","":"","":"","":"8,","":"8.","":"8","":"8","":"8","":"9","":"9","":"9","":"9","":"9","":"9","":"9","":"9","":"9","":"9","":"9","":"9","":"9","":"9","":"9","":"","":"","":"","":"","":"","":"9,","":"9.","":"9","":"9","":"9","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"a","":"","":"","":"","":"","":"","":"a/c","":"a/s","":"aa","":"AA","":"ae","":"ae","":"AE","":"AE","":"ao","":"AO","":"AR","":"au","":"AU","":"av","":"av","":"AV","":"AV","":"ay","":"AY","":"","":"","":"","":"","":"","":"","":"b","":"b","":"b","":"b","":"b","":"b","":"b","":"b","":"b","":"b","":"b","":"b","":"b","":"b","":"b","":"b","":"b","":"b","":"B","":"B","":"B","":"B","":"B","":"B","":"B","":"B","":"B","":"B","":"B","":"B","":"B","":"B","":"B","":"B","":"B","":"B","":"B","":"B","":"B","":"B","":"B","":"B","":"B","":"B","":"B","":"B","":"b","":"b","":"b","":"b","":"b","":"b","":"b","":"b","":"b","":"b","":"b","":"b","":"b\'","":"bl","":"","":"","":"c","":"c","":"c","":"c","":"c","":"c","":"c","":"c","":"c","":"c","":"c","":"c","":"c","":"c","":"c","":"c","":"c","":"c","":"c","":"c","":"c","":"","":"C","":"C","":"C","":"C","":"C","":"C","":"C","":"C","":"C","":"C","":"C","":"C","":"C","":"C","":"C","":"C","":"C","":"C","":"C","":"C","":"C","":"C","":"C","":"C","":"C","":"C","":"C","":"c","":"c","":"C","":"C","":"c","":"c","":"C","":"C","":"C\'","":"c/o","":"c/u","":"\\t","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"d","":"d","":"d","":"d","":"d","":"d","":"d","":"d","":"d","":"d","":"d","":"d","":"d","":"d","":"d","":"d","":"d","":"d","":"d","":"D","":"D","":"D","":"D","":"D","":"D","":"D","":"D","":"D","":"D","":"D","":"D","":"D","":"D","":"D","":"D","":"D","":"D","":"D","":"d","":"d","":"d","":"d","":"D","":"D","":"D","":"d","":"","":"d","":"d\'","":"d","":"dz","":"dz","":"Dz","":"DZ","":"d","":"D","":"D","":"d","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"","":"E","":"E","":"E","":"E","":"E","":"E","":"E","":"E","":"E","":"E","":"E","":"E","":"E","":"E","":"E","":"E","":"E","":"E","":"E","":"E","":"E","":"E","":"E","":"E","":"E","":"E","":"E","":"E","":"","":"","":"e","":"E","":"e","":"","":"","":"","":"","":"","":"","":"","":"o","":"o","":"o","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"f","":"f","":"f","":"f","":"f","":"f","":"f","":"f","":"f","":"f","":"f","":"f","":"f","":"f","":"f","":"f","":"f","":"f","":"F","":"F","":"F","":"F","":"F","":"F","":"F","":"F","":"F","":"F","":"F","":"F","":"F","":"F","":"F","":"F","":"F","":"F","":"F","":"F","":"F","":"F","":"F","":"F","":"f","":"F","":"f","":"FAX","":"ff","":"ffi","":"ffl","":"fi","":"fl","":"f","":"","":"","":"","":"","":"g","":"g","":"g","":"g","":"g","":"g","":"g","":"g","":"g","":"g","":"g","":"g","":"g","":"g","":"g","":"g","":"g","":"g","":"G","":"G","":"G","":"G","":"G","":"G","":"G","":"G","":"G","":"G","":"G","":"G","":"G","":"G","":"G","":"G","":"G","":"","":"g","":"","":"","":"","":"g","":"G","":"G\'","":"","":"","":"","":"h","":"h","":"h","":"h","":"h","":"h","":"h","":"h","":"h","":"h","":"h","":"h","":"h","":"h","":"h","":"h","":"h","":"H","":"H","":"H","":"H","":"H","":"H","":"H","":"H","":"H","":"H","":"H","":"H","":"H","":"H","":"H","":"H","":"H","":"H","":"H","":"H","":"H","":"H","":"H","":"H","":"H","":"H","":"","":"h","":"h","":"h","":"H","":"H","":"h","":"h","":"h","":"H","":"H","":"H","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"i","":"i","":"i","":"i","":"i","":"i","":"i","":"i","":"i","":"i","":"i","":"i","":"i","":"i","":"i","":"i","":"i","":"i","":"i","":"i","":"i","":"i","":"i","":"i","":"i","":"i","":"i","":"i","":"i","":"i","":"i","":"i","":"i","":"i","":"i","":"i","":"i","":"","":"i","":"","":"","":"i","":"i","":"i","":"ii","":"iii","":"ij","":"iv","":"ix","":"j","":"j","":"j","":"j","":"j","":"j","":"j","":"j","":"j","":"j","":"j","":"j","":"j","":"j","":"j","":"j","":"j","":"J","":"J","":"J","":"J","":"J","":"J","":"J","":"J","":"J","":"J","":"J","":"J","":"J","":"J","":"J","":"J","":"J","":"J","":"J","":"J","":"j","":"J","":"J","":"","":"","":"","":"k","":"k","":"k","":"k","":"k","":"k","":"k","":"k","":"k","":"k","":"k","":"k","":"k","":"K","":"K","":"K","":"K","":"K","":"K","":"K","":"K","":"K","":"K","":"K","":"K","":"K","":"K","":"K","":"K","":"K","":"K","":"K","":"K","":"K","":"K","":"K","":"K","":"K","":"K","":"K","":"k","":"K","":"K","":"K","":"K","":"K","":"K\'","":"l","|":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","I":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"L","":"L","":"L","":"L","":"L","":"L","":"L","":"L","":"L","":"L","":"L","":"L","":"L","":"L","":"L","":"L","":"L","":"L","":"L","":"L","":"L","":"L","":"L","":"L","":"l","":"l","":"l","":"L","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l,","":"l.","":"l\'","":"l2.","":"l2","":"l2","":"l2","":"l3.","":"l3","":"l3","":"l4.","":"l4","":"l4","":"l5.","":"l5","":"l5","":"l6.","":"l6","":"l6","":"l7.","":"l7","":"l7","":"l8.","":"l8","":"l8","":"l9.","":"l9","":"l9","":"lj","":"lJ","":"Lj","":"LJ","":"ll","":"ll","":"ll","":"ll","":"ll","":"ll","":"ll.","":"lll","":"llS","":"ll","":"ll","":"ll","":"lO","":"lO.","":"lO","":"lO","":"lO","":"ls","":"lt","":"lV","":"lX","":"l","":"lz","":"l","":"l","":"l","":"l","":"l","":"l","":"lo","":"l","":"l","":"l","":"","":"","":"","":"M","":"M","":"M","":"M","":"M","":"M","":"M","":"M","":"M","":"M","":"M","":"M","":"M","":"M","":"M","":"M","":"M","":"M","":"M","":"M","":"M","":"M","":"M","":"M","":"M","":"M","":"M","":"M","":"M","":"M","":"M","":"MB","":"","":"n","":"n","":"n","":"n","":"n","":"n","":"n","":"n","":"n","":"n","":"n","":"n","":"n","":"n","":"n","":"N","":"N","":"N","":"N","":"N","":"N","":"N","":"N","":"N","":"N","":"N","":"N","":"N","":"N","":"N","":"N","":"N","":"N","":"N","":"N","":"N","":"N","":"N","":"N","":"n","":"n","":"n","":"n","":"n","":"n","":"n","":"n","":"N","":"n","":"nj","":"Nj","":"NJ","":"No","":"","":"","":"","":"","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"","":"","":"","":"","":"o","":"","":"o","":"o","":"O","":"O","":"O","":"o","":"o","":"o","":"o","":"o","":"o","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"o","":"o","":"O,","":"O.","":"o\'","":"O\'","":"O\'","%":"/","":"/","":"/","":"/","":"/","":"/","":"/","":"oe","":"OE","":"o","":"oo","":"oo","":"oo","":"OO","":"OO","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"oo","":"o","":"O","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"e","":"","":"p","":"p","":"p","":"p","":"p","":"p","":"p","":"p","":"p","":"p","":"p","":"p","":"p","":"p","":"p","":"p","":"p","":"p","":"p","":"p","":"p","":"p","":"p","":"p","":"p","":"p","":"p","":"p","":"p","":"P","":"P","":"P","":"P","":"P","":"P","":"P","":"P","":"P","":"P","":"P","":"P","":"P","":"P","":"P","":"P","":"P","":"P","":"P","":"P","":"P","":"P","":"P","":"P","":"P","":"P","":"p","":"p","":"p","":"P\'","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"q","":"q","":"q","":"q","":"q","":"q","":"q","":"q","":"q","":"q","":"q","":"q","":"q","":"q","":"q","":"q","":"Q","":"Q","":"Q","":"Q","":"Q","":"Q","":"Q","":"Q","":"Q","":"Q","":"Q","":"Q","":"Q","":"Q","":"q","":"QE","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"r","":"r","":"r","":"r","":"r","":"r","":"r","":"r","":"r","":"r","":"r","":"r","":"r","":"r","":"r","":"r","":"r","":"r","":"r","":"R","":"R","":"R","":"R","":"R","":"R","":"R","":"R","":"R","":"R","":"R","":"R","":"R","":"R","":"R","":"R","":"R","":"R","":"R","":"R","":"R","":"r","":"r","":"r","":"r","":"r","":"r\'","":"rn","m":"rn","":"rn","":"rn","":"rn","":"rn","":"rn","":"rn","":"rn","":"rn","":"rn","":"rn","":"rn","":"rn","":"rn","":"rn","":"rn","":"rn","":"rn","":"rn","":"Rs","":"","":"","":"","":"","":"","":"s","":"s","":"s","":"s","":"s","":"s","":"s","":"s","":"s","":"s","":"s","":"s","":"s","":"s","":"s","":"s","":"s","":"s","":"s","":"s","":"S","":"S","":"S","":"S","":"S","":"S","":"S","":"S","":"S","":"S","":"S","":"S","":"S","":"S","":"S","":"S","":"S","":"S","":"S","":"S","":"S","":"S","":"s","":"s","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"sss","":"st","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"t","":"t","":"t","":"t","":"t","":"t","":"t","":"t","":"t","":"t","":"t","":"t","":"t","":"T","":"T","":"T","":"T","":"T","":"T","":"T","":"T","":"T","":"T","":"T","":"T","":"T","":"T","":"T","":"T","":"T","":"T","":"T","":"T","":"T","":"T","":"T","":"T","":"T","":"T","":"T","":"T","":"T","":"T","":"T","":"T","":"t","":"T","":"T","":"","":"T","":"T","":"T","":"t","":"T","":"t","":"","":"T3","":"t","":"TEL","":"tf","":"ts","":"t","":"t","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"","":"","":"u","":"u","":"U","":"U","":"U","":"U\'","":"ue","":"uo","":"","":"","":"","":"","":"","":"","":"","":"v","":"v","":"v","":"v","":"v","":"v","":"v","":"v","":"v","":"v","":"v","":"v","":"v","":"v","":"v","":"v","":"v","":"v","":"v","":"v","":"v","":"v","":"v","":"v","":"v","":"v","":"v","":"v","":"v","":"V","":"V","":"V","":"V","":"V","":"V","":"V","":"V","":"V","":"V","":"V","":"V","":"V","":"V","":"V","":"V","":"V","":"V","":"V","":"V","":"V","":"V","":"V","":"V","":"V","":"V","":"V","":"V","":"VB","":"vi","":"vii","":"viii","":"Vl","":"Vll","":"Vlll","":"V","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"w","":"w","":"w","":"w","":"w","":"w","":"w","":"w","":"w","":"w","":"w","":"w","":"w","":"w","":"w","":"w","":"w","":"w","":"w","":"w","":"w","":"w","":"W","":"W","":"W","":"W","":"W","":"W","":"W","":"W","":"W","":"W","":"W","":"W","":"W","":"W","":"W","":"W","":"W","":"W","":"W","":"w","":"w","":"W","":"w","":"","":"","":"","":"","":"x","":"x","":"x","":"x","":"x","":"x","":"x","":"x","":"x","":"x","":"x","":"x","":"x","":"x","":"x","":"x","":"x","":"x","":"x","":"x","":"x","":"x","":"x","":"","":"X","":"X","":"X","":"X","":"X","":"X","":"X","":"X","":"X","":"X","":"X","":"X","":"X","":"X","":"X","":"X","":"X","":"X","":"X","":"X","":"X","":"X","":"X","":"X","":"X","":"X","":"X","":"X","":"X","":"X","":"X","":"X","":"X","":"X","":"X","":"x","":"X","":"X","":"xi","":"xii","":"Xl","":"Xll","":"y","":"y","":"y","":"y","":"y","":"y","":"y","":"y","":"y","":"y","":"y","":"y","":"y","":"y","":"y","":"y","":"y","":"y","":"y","":"y","":"y","":"y","":"y","":"y","":"y","":"y","":"y","":"y","":"y","":"y","":"Y","":"Y","":"Y","":"Y","":"Y","":"Y","":"Y","":"Y","":"Y","":"Y","":"Y","":"Y","":"Y","":"Y","":"Y","":"Y","":"Y","":"Y","":"Y","":"Y","":"Y","":"Y","":"Y","":"Y","":"Y","":"Y","":"Y","":"Y","":"Y","":"Y","":"y","":"y","":"y","":"Y","":"Y","":"Y","":"","":"","":"","":"","":"","":"z","":"z","":"z","":"z","":"z","":"z","":"z","":"z","":"z","":"z","":"z","":"z","":"z","":"z","":"z","":"z","":"Z","":"Z","":"Z","":"Z","":"Z","":"Z","":"Z","":"Z","":"Z","":"Z","":"Z","":"Z","":"Z","":"Z","":"Z","":"Z","":"Z","":"Z","":"Z","":"Z","":"Z","":"Z","":"Z","":"Z","":"Z","":"z","":"z","":"Z","":"z","":"Z","":"z","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"i","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"\'","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"l","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"\'","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"o","":"o","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"o","":"o","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":" lo","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"l","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"o","":"o","":"o","":"o","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":" lo o ","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"o","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"l","":"l","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"l","":"l","":"l","":"l","":"l","":"l","":"o","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"l","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"o","":"o","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"o","":"o","":"o","":"","":"","":"","":"","":"","":"","":"l","":"l","":"o","":"o","":"o","":"o","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"\'","":"/","":"","":"","":"","":"","":"","":"\'","":"","":"","":"\'","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"<","":"b","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"b","":"b","":"d","":"P","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"J","":"","":"","":"","":"","":"","":"","":"","":"J","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""}')}},__webpack_module_cache__={};function __webpack_require__(e){var t=__webpack_module_cache__[e];if(void 0!==t)return t.exports;var n=__webpack_module_cache__[e]={id:e,loaded:!1,exports:{}};return __webpack_modules__[e].call(n.exports,n,n.exports,__webpack_require__),n.loaded=!0,n.exports}__webpack_require__.m=__webpack_modules__,__webpack_require__.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return __webpack_require__.d(t,{a:t}),t},__webpack_require__.d=(e,t)=>{for(var n in t)__webpack_require__.o(t,n)&&!__webpack_require__.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},__webpack_require__.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),__webpack_require__.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),__webpack_require__.nmd=e=>(e.paths=[],e.children||(e.children=[]),e),(()=>{var e;__webpack_require__.g.importScripts&&(e=__webpack_require__.g.location+"");var t=__webpack_require__.g.document;if(!e&&t&&(t.currentScript&&(e=t.currentScript.src),!e)){var n=t.getElementsByTagName("script");n.length&&(e=n[n.length-1].src)}if(!e)throw new Error("Automatic publicPath is not supported in this browser");e=e.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),__webpack_require__.p=e})(),__webpack_require__.b=document.baseURI||self.location.href;var __webpack_exports__={};(()=>{"use strict";var e,t,n,r,i,s,o,a={},l=[],c=/acit|ex(?:s|g|n|p|$)|rph|grid|ows|mnc|ntw|ine[ch]|zoo|^ord|itera/i;function d(e,t){for(var n in t)e[n]=t[n];return e}function u(e){var t=e.parentNode;t&&t.removeChild(e)}function h(t,n,r){var i,s,o,a={};for(o in n)"key"==o?i=n[o]:"ref"==o?s=n[o]:a[o]=n[o];if(arguments.length>2&&(a.children=arguments.length>3?e.call(arguments,2):r),"function"==typeof t&&null!=t.defaultProps)for(o in t.defaultProps)void 0===a[o]&&(a[o]=t.defaultProps[o]);return p(t,a,i,s,null)}function p(e,r,i,s,o){var a={type:e,props:r,key:i,ref:s,__k:null,__:null,__b:0,__e:null,__d:void 0,__c:null,__h:null,constructor:void 0,__v:null==o?++n:o};return null==o&&null!=t.vnode&&t.vnode(a),a}function m(e){return e.children}function g(e,t){this.props=e,this.context=t}function f(e,t){if(null==t)return e.__?f(e.__,e.__.__k.indexOf(e)+1):null;for(var n;t<e.__k.length;t++)if(null!=(n=e.__k[t])&&null!=n.__e)return n.__e;return"function"==typeof e.type?f(e):null}function y(e){var t,n;if(null!=(e=e.__)&&null!=e.__c){for(e.__e=e.__c.base=null,t=0;t<e.__k.length;t++)if(null!=(n=e.__k[t])&&null!=n.__e){e.__e=e.__c.base=n.__e;break}return y(e)}}function v(e){(!e.__d&&(e.__d=!0)&&r.push(e)&&!b.__r++||s!==t.debounceRendering)&&((s=t.debounceRendering)||i)(b)}function b(){for(var e;b.__r=r.length;)e=r.sort((function(e,t){return e.__v.__b-t.__v.__b})),r=[],e.some((function(e){var t,n,r,i,s,o;e.__d&&(s=(i=(t=e).__v).__e,(o=t.__P)&&(n=[],(r=d({},i)).__v=i.__v+1,A(o,i,r,t.__n,void 0!==o.ownerSVGElement,null!=i.__h?[s]:null,n,null==s?f(i):s,i.__h),I(n,i),i.__e!=s&&y(i)))}))}function w(e,t,n,r,i,s,o,c,d,u){var h,g,y,v,b,w,_,x=r&&r.__k||l,E=x.length;for(n.__k=[],h=0;h<t.length;h++)if(null!=(v=n.__k[h]=null==(v=t[h])||"boolean"==typeof v?null:"string"==typeof v||"number"==typeof v||"bigint"==typeof v?p(null,v,null,null,v):Array.isArray(v)?p(m,{children:v},null,null,null):v.__b>0?p(v.type,v.props,v.key,null,v.__v):v)){if(v.__=n,v.__b=n.__b+1,null===(y=x[h])||y&&v.key==y.key&&v.type===y.type)x[h]=void 0;else for(g=0;g<E;g++){if((y=x[g])&&v.key==y.key&&v.type===y.type){x[g]=void 0;break}y=null}A(e,v,y=y||a,i,s,o,c,d,u),b=v.__e,(g=v.ref)&&y.ref!=g&&(_||(_=[]),y.ref&&_.push(y.ref,null,v),_.push(g,v.__c||b,v)),null!=b?(null==w&&(w=b),"function"==typeof v.type&&v.__k===y.__k?v.__d=d=S(v,d,e):d=k(e,v,y,x,b,d),"function"==typeof n.type&&(n.__d=d)):d&&y.__e==d&&d.parentNode!=e&&(d=f(y))}for(n.__e=w,h=E;h--;)null!=x[h]&&("function"==typeof n.type&&null!=x[h].__e&&x[h].__e==n.__d&&(n.__d=f(r,h+1)),P(x[h],x[h]));if(_)for(h=0;h<_.length;h++)O(_[h],_[++h],_[++h])}function S(e,t,n){for(var r,i=e.__k,s=0;i&&s<i.length;s++)(r=i[s])&&(r.__=e,t="function"==typeof r.type?S(r,t,n):k(n,r,r,i,r.__e,t));return t}function _(e,t){return t=t||[],null==e||"boolean"==typeof e||(Array.isArray(e)?e.some((function(e){_(e,t)})):t.push(e)),t}function k(e,t,n,r,i,s){var o,a,l;if(void 0!==t.__d)o=t.__d,t.__d=void 0;else if(null==n||i!=s||null==i.parentNode)e:if(null==s||s.parentNode!==e)e.appendChild(i),o=null;else{for(a=s,l=0;(a=a.nextSibling)&&l<r.length;l+=2)if(a==i)break e;e.insertBefore(i,s),o=s}return void 0!==o?o:i.nextSibling}function x(e,t,n){"-"===t[0]?e.setProperty(t,n):e[t]=null==n?"":"number"!=typeof n||c.test(t)?n:n+"px"}function E(e,t,n,r,i){var s;e:if("style"===t)if("string"==typeof n)e.style.cssText=n;else{if("string"==typeof r&&(e.style.cssText=r=""),r)for(t in r)n&&t in n||x(e.style,t,"");if(n)for(t in n)r&&n[t]===r[t]||x(e.style,t,n[t])}else if("o"===t[0]&&"n"===t[1])s=t!==(t=t.replace(/Capture$/,"")),t=t.toLowerCase()in e?t.toLowerCase().slice(2):t.slice(2),e.l||(e.l={}),e.l[t+s]=n,n?r||e.addEventListener(t,s?C:T,s):e.removeEventListener(t,s?C:T,s);else if("dangerouslySetInnerHTML"!==t){if(i)t=t.replace(/xlink[H:h]/,"h").replace(/sName$/,"s");else if("href"!==t&&"list"!==t&&"form"!==t&&"tabIndex"!==t&&"download"!==t&&t in e)try{e[t]=null==n?"":n;break e}catch(e){}"function"==typeof n||(null!=n&&(!1!==n||"a"===t[0]&&"r"===t[1])?e.setAttribute(t,n):e.removeAttribute(t))}}function T(e){this.l[e.type+!1](t.event?t.event(e):e)}function C(e){this.l[e.type+!0](t.event?t.event(e):e)}function A(e,n,r,i,s,o,a,l,c){var u,h,p,f,y,v,b,S,_,k,x,E=n.type;if(void 0!==n.constructor)return null;null!=r.__h&&(c=r.__h,l=n.__e=r.__e,n.__h=null,o=[l]),(u=t.__b)&&u(n);try{e:if("function"==typeof E){if(S=n.props,_=(u=E.contextType)&&i[u.__c],k=u?_?_.props.value:u.__:i,r.__c?b=(h=n.__c=r.__c).__=h.__E:("prototype"in E&&E.prototype.render?n.__c=h=new E(S,k):(n.__c=h=new g(S,k),h.constructor=E,h.render=M),_&&_.sub(h),h.props=S,h.state||(h.state={}),h.context=k,h.__n=i,p=h.__d=!0,h.__h=[]),null==h.__s&&(h.__s=h.state),null!=E.getDerivedStateFromProps&&(h.__s==h.state&&(h.__s=d({},h.__s)),d(h.__s,E.getDerivedStateFromProps(S,h.__s))),f=h.props,y=h.state,p)null==E.getDerivedStateFromProps&&null!=h.componentWillMount&&h.componentWillMount(),null!=h.componentDidMount&&h.__h.push(h.componentDidMount);else{if(null==E.getDerivedStateFromProps&&S!==f&&null!=h.componentWillReceiveProps&&h.componentWillReceiveProps(S,k),!h.__e&&null!=h.shouldComponentUpdate&&!1===h.shouldComponentUpdate(S,h.__s,k)||n.__v===r.__v){h.props=S,h.state=h.__s,n.__v!==r.__v&&(h.__d=!1),h.__v=n,n.__e=r.__e,n.__k=r.__k,n.__k.forEach((function(e){e&&(e.__=n)})),h.__h.length&&a.push(h);break e}null!=h.componentWillUpdate&&h.componentWillUpdate(S,h.__s,k),null!=h.componentDidUpdate&&h.__h.push((function(){h.componentDidUpdate(f,y,v)}))}h.context=k,h.props=S,h.state=h.__s,(u=t.__r)&&u(n),h.__d=!1,h.__v=n,h.__P=e,u=h.render(h.props,h.state,h.context),h.state=h.__s,null!=h.getChildContext&&(i=d(d({},i),h.getChildContext())),p||null==h.getSnapshotBeforeUpdate||(v=h.getSnapshotBeforeUpdate(f,y)),x=null!=u&&u.type===m&&null==u.key?u.props.children:u,w(e,Array.isArray(x)?x:[x],n,r,i,s,o,a,l,c),h.base=n.__e,n.__h=null,h.__h.length&&a.push(h),b&&(h.__E=h.__=null),h.__e=!1}else null==o&&n.__v===r.__v?(n.__k=r.__k,n.__e=r.__e):n.__e=R(r.__e,n,r,i,s,o,a,c);(u=t.diffed)&&u(n)}catch(e){n.__v=null,(c||null!=o)&&(n.__e=l,n.__h=!!c,o[o.indexOf(l)]=null),t.__e(e,n,r)}}function I(e,n){t.__c&&t.__c(n,e),e.some((function(n){try{e=n.__h,n.__h=[],e.some((function(e){e.call(n)}))}catch(e){t.__e(e,n.__v)}}))}function R(t,n,r,i,s,o,l,c){var d,h,p,m=r.props,g=n.props,y=n.type,v=0;if("svg"===y&&(s=!0),null!=o)for(;v<o.length;v++)if((d=o[v])&&"localName"in d==!!y&&(y?d.localName===y:3===d.nodeType)){t=d,o[v]=null;break}if(null==t){if(null===y)return document.createTextNode(g);t=s?document.createElementNS("http://www.w3.org/2000/svg",y):document.createElement(y,g.is&&g),o=null,c=!1}if(null===y)m===g||c&&t.data===g||(t.data=g);else{if(o=o&&e.call(t.childNodes),h=(m=r.props||a).dangerouslySetInnerHTML,p=g.dangerouslySetInnerHTML,!c){if(null!=o)for(m={},v=0;v<t.attributes.length;v++)m[t.attributes[v].name]=t.attributes[v].value;(p||h)&&(p&&(h&&p.__html==h.__html||p.__html===t.innerHTML)||(t.innerHTML=p&&p.__html||""))}if(function(e,t,n,r,i){var s;for(s in n)"children"===s||"key"===s||s in t||E(e,s,null,n[s],r);for(s in t)i&&"function"!=typeof t[s]||"children"===s||"key"===s||"value"===s||"checked"===s||n[s]===t[s]||E(e,s,t[s],n[s],r)}(t,g,m,s,c),p)n.__k=[];else if(v=n.props.children,w(t,Array.isArray(v)?v:[v],n,r,i,s&&"foreignObject"!==y,o,l,o?o[0]:r.__k&&f(r,0),c),null!=o)for(v=o.length;v--;)null!=o[v]&&u(o[v]);c||("value"in g&&void 0!==(v=g.value)&&(v!==m.value||v!==t.value||"progress"===y&&!v)&&E(t,"value",v,m.value,!1),"checked"in g&&void 0!==(v=g.checked)&&v!==t.checked&&E(t,"checked",v,m.checked,!1))}return t}function O(e,n,r){try{"function"==typeof e?e(n):e.current=n}catch(e){t.__e(e,r)}}function P(e,n,r){var i,s;if(t.unmount&&t.unmount(e),(i=e.ref)&&(i.current&&i.current!==e.__e||O(i,null,n)),null!=(i=e.__c)){if(i.componentWillUnmount)try{i.componentWillUnmount()}catch(e){t.__e(e,n)}i.base=i.__P=null}if(i=e.__k)for(s=0;s<i.length;s++)i[s]&&P(i[s],n,"function"!=typeof e.type);r||null==e.__e||u(e.__e),e.__e=e.__d=void 0}function M(e,t,n){return this.constructor(e,n)}function D(t,n,r){var i,s,o,a=d({},t.props);for(o in n)"key"==o?i=n[o]:"ref"==o?s=n[o]:a[o]=n[o];return arguments.length>2&&(a.children=arguments.length>3?e.call(arguments,2):r),p(t.type,a,i||t.key,s||t.ref,null)}e=l.slice,t={__e:function(e,t){for(var n,r,i;t=t.__;)if((n=t.__c)&&!n.__)try{if((r=n.constructor)&&null!=r.getDerivedStateFromError&&(n.setState(r.getDerivedStateFromError(e)),i=n.__d),null!=n.componentDidCatch&&(n.componentDidCatch(e),i=n.__d),i)return n.__E=n}catch(t){e=t}throw e}},n=0,g.prototype.setState=function(e,t){var n;n=null!=this.__s&&this.__s!==this.state?this.__s:this.__s=d({},this.state),"function"==typeof e&&(e=e(d({},n),this.props)),e&&d(n,e),null!=e&&this.__v&&(t&&this.__h.push(t),v(this))},g.prototype.forceUpdate=function(e){this.__v&&(this.__e=!0,e&&this.__h.push(e),v(this))},g.prototype.render=m,r=[],i="function"==typeof Promise?Promise.prototype.then.bind(Promise.resolve()):setTimeout,b.__r=0,o=0;var L,F,N=[],j=t.__b,U=t.__r,B=t.diffed,q=t.__c,K=t.unmount;function z(){N.forEach((function(e){if(e.__P)try{e.__H.__h.forEach(V),e.__H.__h.forEach(H),e.__H.__h=[]}catch(n){e.__H.__h=[],t.__e(n,e.__v)}})),N=[]}t.__b=function(e){L=null,j&&j(e)},t.__r=function(e){U&&U(e);var t=(L=e.__c).__H;t&&(t.__h.forEach(V),t.__h.forEach(H),t.__h=[])},t.diffed=function(e){B&&B(e);var n=e.__c;n&&n.__H&&n.__H.__h.length&&(1!==N.push(n)&&F===t.requestAnimationFrame||((F=t.requestAnimationFrame)||function(e){var t,n=function(){clearTimeout(r),$&&cancelAnimationFrame(t),setTimeout(e)},r=setTimeout(n,100);$&&(t=requestAnimationFrame(n))})(z)),L=null},t.__c=function(e,n){n.some((function(e){try{e.__h.forEach(V),e.__h=e.__h.filter((function(e){return!e.__||H(e)}))}catch(r){n.some((function(e){e.__h&&(e.__h=[])})),n=[],t.__e(r,e.__v)}})),q&&q(e,n)},t.unmount=function(e){K&&K(e);var n=e.__c;if(n&&n.__H)try{n.__H.__.forEach(V)}catch(e){t.__e(e,n.__v)}};var $="function"==typeof requestAnimationFrame;function V(e){var t=L;"function"==typeof e.__c&&e.__c(),L=t}function H(e){var t=L;e.__c=e.__(),L=t}var W={};function G(e,t){for(var n in t)e[n]=t[n];return e}function Y(e,t,n){var r,i=/(?:\?([^#]*))?(#.*)?$/,s=e.match(i),o={};if(s&&s[1])for(var a=s[1].split("&"),l=0;l<a.length;l++){var c=a[l].split("=");o[decodeURIComponent(c[0])]=decodeURIComponent(c.slice(1).join("="))}e=J(e.replace(i,"")),t=J(t||"");for(var d=Math.max(e.length,t.length),u=0;u<d;u++)if(t[u]&&":"===t[u].charAt(0)){var h=t[u].replace(/(^:|[+*?]+$)/g,""),p=(t[u].match(/[+*?]+$/)||W)[0]||"",m=~p.indexOf("+"),g=~p.indexOf("*"),f=e[u]||"";if(!f&&!g&&(p.indexOf("?")<0||m)){r=!1;break}if(o[h]=decodeURIComponent(f),m||g){o[h]=e.slice(u).map(decodeURIComponent).join("/");break}}else if(t[u]!==e[u]){r=!1;break}return(!0===n.default||!1!==r)&&o}function X(e,t){return e.rank<t.rank?1:e.rank>t.rank?-1:e.index-t.index}function Z(e,t){return e.index=t,e.rank=function(e){return e.props.default?0:J(e.props.path).map(Q).join("")}(e),e.props}function J(e){return e.replace(/(^\/+|\/+$)/g,"").split("/")}function Q(e){return":"==e.charAt(0)?1+"*+?".indexOf(e.charAt(e.length-1))||4:5}var ee={},te=[],ne=[],re=null,ie={url:oe()},se=function(e,t){var n={__c:t="__cC"+o++,__:e,Consumer:function(e,t){return e.children(t)},Provider:function(e){var n,r;return this.getChildContext||(n=[],(r={})[t]=this,this.getChildContext=function(){return r},this.shouldComponentUpdate=function(e){this.props.value!==e.value&&n.some(v)},this.sub=function(e){n.push(e);var t=e.componentWillUnmount;e.componentWillUnmount=function(){n.splice(n.indexOf(e),1),t&&t.call(e)}}),e.children}};return n.Provider.__=n.Consumer.contextType=n}(ie);function oe(){var e;return""+((e=re&&re.location?re.location:re&&re.getCurrentLocation?re.getCurrentLocation():"undefined"!=typeof location?location:ee).pathname||"")+(e.search||"")}function ae(e,t){return void 0===t&&(t=!1),"string"!=typeof e&&e.url&&(t=e.replace,e=e.url),function(e){for(var t=te.length;t--;)if(te[t].canRoute(e))return!0;return!1}(e)&&function(e,t){void 0===t&&(t="push"),re&&re[t]?re[t](e):"undefined"!=typeof history&&history[t+"State"]&&history[t+"State"](null,null,e)}(e,t?"replace":"push"),le(e)}function le(e){for(var t=!1,n=0;n<te.length;n++)te[n].routeTo(e)&&(t=!0);return t}function ce(e){if(e&&e.getAttribute){var t=e.getAttribute("href"),n=e.getAttribute("target");if(t&&t.match(/^\//g)&&(!n||n.match(/^_?self$/i)))return ae(t)}}function de(e){return e.stopImmediatePropagation&&e.stopImmediatePropagation(),e.stopPropagation&&e.stopPropagation(),e.preventDefault(),!1}function ue(e){if(!(e.ctrlKey||e.metaKey||e.altKey||e.shiftKey||e.button)){var t=e.target;do{if("a"===t.localName&&t.getAttribute("href")){if(t.hasAttribute("data-native")||t.hasAttribute("native"))return;if(ce(t))return de(e)}}while(t=t.parentNode)}}var he=!1;function pe(e){e.history&&(re=e.history),this.state={url:e.url||oe()}}G(pe.prototype=new g,{shouldComponentUpdate:function(e){return!0!==e.static||e.url!==this.props.url||e.onChange!==this.props.onChange},canRoute:function(e){var t=_(this.props.children);return void 0!==this.g(t,e)},routeTo:function(e){this.setState({url:e});var t=this.canRoute(e);return this.p||this.forceUpdate(),t},componentWillMount:function(){this.p=!0},componentDidMount:function(){var e=this;he||(he=!0,re||addEventListener("popstate",(function(){le(oe())})),addEventListener("click",ue)),te.push(this),re&&(this.u=re.listen((function(t){var n=t.location||t;e.routeTo(""+(n.pathname||"")+(n.search||""))}))),this.p=!1},componentWillUnmount:function(){"function"==typeof this.u&&this.u(),te.splice(te.indexOf(this),1)},componentWillUpdate:function(){this.p=!0},componentDidUpdate:function(){this.p=!1},g:function(e,t){e=e.filter(Z).sort(X);for(var n=0;n<e.length;n++){var r=e[n],i=Y(t,r.props.path,r.props);if(i)return[r,i]}},render:function(e,t){var n,r,i=e.onChange,s=t.url,o=this.c,a=this.g(_(e.children),s);if(a&&(r=D(a[0],G(G({url:s,matches:n=a[1]},n),{key:void 0,ref:void 0}))),s!==(o&&o.url)){G(ie,o=this.c={url:s,previous:o&&o.url,current:r,path:r?r.props.path:null,matches:n}),o.router=this,o.active=r?[r]:[];for(var l=ne.length;l--;)ne[l]({});"function"==typeof i&&i(o)}return h(se.Provider,{value:o},r)}});var me=__webpack_require__(8743);function ge(e){if(fe[e])return fe[e];let t=0;if(0===e.length)return t;for(let n=0;n<e.length;n++)t=(t<<5)-t+e.charCodeAt(n),t|=0;return fe[e]=t%360,fe[e]}class fe{constructor(e){this.hue=ge(e),this.light=`hsl(${this.hue},100%, 80%)`,this.solid=`hsl(${this.hue},100%, 50%)`,this.dark=`hsl(${this.hue},100%, 20%)`,this.ultralight=`hsl(${this.hue},100%, 95%)`,this.styleVariables={"--user_ultralight":this.ultralight,"--user_light":this.light,"--user_solid":this.solid,"--user_dark":this.dark}}}class ye{constructor(e){this.hue=ge(e),this.ultralight=`hsl(${this.hue},100%, 95%)`,this.light=`hsl(${this.hue},100%, 80%)`,this.solid=`hsl(${this.hue},100%, 50%)`,this.dark=`hsl(${this.hue},100%, 20%)`,this.ultradark=`hsl(${this.hue},100%, 10%)`,this.styleVariables={"--room_ultralight":this.ultralight,"--room_light":this.light,"--room_solid":this.solid,"--room_dark":this.dark,"--room_ultradark":this.ultradark}}}var ve=__webpack_require__(3379),be=__webpack_require__.n(ve),we=__webpack_require__(7795),Se=__webpack_require__.n(we),_e=__webpack_require__(569),ke=__webpack_require__.n(_e),xe=__webpack_require__(3565),Ee=__webpack_require__.n(xe),Te=__webpack_require__(9216),Ce=__webpack_require__.n(Te),Ae=__webpack_require__(4589),Ie=__webpack_require__.n(Ae),Re=__webpack_require__(9302),Oe={};Oe.styleTagTransform=Ie(),Oe.setAttributes=Ee(),Oe.insert=ke().bind(null,"head"),Oe.domAPI=Se(),Oe.insertStyleElement=Ce(),be()(Re.Z,Oe),Re.Z&&Re.Z.locals&&Re.Z.locals;const Pe="com.open-tower.populus.pdf",Me="com.open-tower.populus.lastPageViewed",De="https://populus.open-tower.com",Le="m.space.child",Fe="m.space.parent",Ne="com.open-tower.msc3574.markup.parent",je="com.open-tower.msc3574.markup.resource",Ue="com.open-tower.msc3592.markup.pdf.highlight",Be="com.open-tower.msc3592.markup.pdf.text",qe="com.open-tower.msc3574.markup.location",Ke="com.open-tower.msc3574.markup",ze="com.open-tower.populus.markup.pdf.highlight",$e=/^#[0-9a-fA-F]{6}$/,Ve={allowedTags:["font","del","h1","h2","h3","h4","h5","h6","blockquote","p","a","ul","ol","sup","sub","nl","li","b","i","u","strong","em","strike","code","hr","br","div","table","thead","caption","tbody","tr","th","td","pre","span","img","details","summary"],allowedAttributes:{font:["color","data-mx-bg-color","data-mx-color","style"],span:["data-mx-maths","data-mx-bg-color","data-mx-color","data-mx-spoiler","style"],div:["data-mx-maths"],a:["href","name","target","rel"],img:["src","width","height","alt","title"],ol:["start"],code:["class"]},selfClosing:["img","br","hr","area","base","basefont","input","link","meta"],allowedSchemes:["http","https","ftp","mailto","magnet"],allowProtocolRelative:!1,transformTags:{a:(e,t)=>(t.href&&(t.target="_blank"),t.rel="noreferrer noopener",{tagName:e,attribs:t}),img:e=>({tagName:e,attribs:{}}),code(e,t){if(void 0!==t.class){const e=t.class.split(/\s/).filter((e=>e.startsWith("language-")&&!e.startsWith("language-_")));t.class=e.join(" ")}return{tagName:e,attribs:t}},"*"(e,t){delete t.style;const n={"data-mx-color":"color","data-mx-bg-color":"background-color"};let r="";return Object.keys(n).forEach((e=>{const i=n[e],s=t[e];s&&"string"==typeof s&&$e.test(s)&&(r+=`${i}:${s};`,delete t[e])})),r&&(t.style=r),{tagName:e,attribs:t}}},nestingLimit:50};function He(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function We(e){const t=n=>r=>{const i=this.getRoom(e);i?n(i):setTimeout(t(n),500)};return new Promise((e=>t(e)()))}function Ge(...e){return me.getHttpUriForMxc(this.getHomeserverUrl(),...e)}class Ye{static isResumable(){return!!localStorage.getItem("accessToken")&&!!localStorage.getItem("userId")&&!!localStorage.getItem("baseUrl")}static async initClient(){let e;try{e=window.indexedDB}catch(e){}const t={baseUrl:localStorage.getItem("baseUrl"),userId:localStorage.getItem("userId"),accessToken:localStorage.getItem("accessToken"),timelineSupport:!0,unstableClientRelationAggregation:!0};e?(console.log("using indexedDB"),t.store=new me.IndexedDBStore({indexedDB:e,localStorage,dbName:"populus-web-sync",workerScript:"./indexeddb-worker.js"}),await t.store.startup(),Ye.client=me.createClient(t)):Ye.client=me.createClient(t),Ye.client.getRoomWithState=We.bind(Ye.client),Ye.client.getHttpUriForMxcFromHS=Ge.bind(Ye.client);const n=new me.EventTimelineSet(null,{timelineSupport:!0});return n.getLiveTimeline().setPaginationToken("",me.EventTimeline.BACKWARDS),Ye.client.setNotifTimelineSet(n),Ye.client}static restart(){Ye.client.stopClient(),Ye.client.store.deleteAllData(),Ye.initClient()}}He(Ye,"client",void 0),He(Ye,"deviceId",Math.random().toString(16).substr(2,14));var Xe=__webpack_require__(9631),Ze={};Ze.styleTagTransform=Ie(),Ze.setAttributes=Ee(),Ze.insert=ke().bind(null,"head"),Ze.domAPI=Se(),Ze.insertStyleElement=Ce(),be()(Xe.Z,Ze),Xe.Z&&Xe.Z.locals&&Xe.Z.locals;const Je=h("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round",class:"feather feather-home"},h("path",{d:"M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"}),h("polyline",{points:"9 22 9 12 15 12 15 22"})),Qe=h("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round",class:"feather feather-menu"},h("line",{x1:"3",y1:"12",x2:"21",y2:"12"}),h("line",{x1:"3",y1:"6",x2:"21",y2:"6"}),h("line",{x1:"3",y1:"18",x2:"21",y2:"18"})),et=h("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round",class:"feather feather-x"},h("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),h("line",{x1:"6",y1:"6",x2:"18",y2:"18"})),tt=h("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round",class:"feather feather-user-minus"},h("path",{d:"M16 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"}),h("circle",{cx:"8.5",cy:"7",r:"4"}),h("line",{x1:"23",y1:"11",x2:"17",y2:"11"})),nt=h("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round",class:"feather feather-user-plus"},h("path",{d:"M16 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"}),h("circle",{cx:"8.5",cy:"7",r:"4"}),h("line",{x1:"20",y1:"8",x2:"20",y2:"14"}),h("line",{x1:"23",y1:"11",x2:"17",y2:"11"})),rt=h("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round",class:"feather feather-users"},h("path",{d:"M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"}),h("circle",{cx:"9",cy:"7",r:"4"}),h("path",{d:"M23 21v-2a4 4 0 0 0-3-3.87"}),h("path",{d:"M16 3.13a4 4 0 0 1 0 7.75"})),it=h("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round",class:"feather feather-upload"},h("path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"}),h("polyline",{points:"17 8 12 3 7 8"}),h("line",{x1:"12",y1:"3",x2:"12",y2:"15"})),st=h("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round",class:"feather feather-log-out"},h("path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"}),h("polyline",{points:"16 17 21 12 16 7"}),h("line",{x1:"21",y1:"12",x2:"9",y2:"12"})),ot=h("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round",class:"feather feather-image"},h("rect",{x:"3",y:"3",width:"18",height:"18",rx:"2",ry:"2"}),h("circle",{cx:"8.5",cy:"8.5",r:"1.5"}),h("polyline",{points:"21 15 16 10 5 21"})),at=h("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round",class:"feather feather-search"},h("circle",{cx:"11",cy:"11",r:"8"}),h("line",{x1:"21",y1:"21",x2:"16.65",y2:"16.65"})),lt=h("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round",class:"feather feather-file-plus"},h("path",{d:"M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"}),h("polyline",{points:"14 2 14 8 20 8"}),h("line",{x1:"12",y1:"18",x2:"12",y2:"12"}),h("line",{x1:"9",y1:"15",x2:"15",y2:"15"})),ct=h("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round",class:"feather feather-plus-square"},h("rect",{x:"3",y:"3",width:"18",height:"18",rx:"2",ry:"2"}),h("line",{x1:"12",y1:"8",x2:"12",y2:"16"}),h("line",{x1:"8",y1:"12",x2:"16",y2:"12"})),dt=h("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round",class:"feather feather-settings"},h("circle",{cx:"12",cy:"12",r:"3"}),h("path",{d:"M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"})),ut=h("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round",class:"feather feather-more-horizontal"},h("circle",{cx:"12",cy:"12",r:"1"}),h("circle",{cx:"19",cy:"12",r:"1"}),h("circle",{cx:"5",cy:"12",r:"1"})),ht=h("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round",class:"feather feather-more-vertical"},h("circle",{cx:"12",cy:"12",r:"1"}),h("circle",{cx:"12",cy:"5",r:"1"}),h("circle",{cx:"12",cy:"19",r:"1"})),pt=h("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round",class:"feather feather-chevron-left"},h("polyline",{points:"15 18 9 12 15 6"})),mt=h("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round",class:"feather feather-chevron-right"},h("polyline",{points:"9 18 15 12 9 6"})),gt=h("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round",class:"feather feather-chevrons-right"},h("polyline",{points:"13 17 18 12 13 7"}),h("polyline",{points:"6 17 11 12 6 7"})),ft=h("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round",class:"feather feather-chevrons-left"},h("polyline",{points:"11 17 6 12 11 7"}),h("polyline",{points:"18 17 13 12 18 7"})),yt=h("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round",class:"feather feather-edit"},h("path",{d:"M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"}),h("path",{d:"M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"})),vt=h("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round",class:"feather feather-x-square"},h("rect",{x:"3",y:"3",width:"18",height:"18",rx:"2",ry:"2"}),h("line",{x1:"9",y1:"9",x2:"15",y2:"15"}),h("line",{x1:"15",y1:"9",x2:"9",y2:"15"})),bt=h("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round",class:"feather feather-file-text"},h("path",{d:"M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"}),h("polyline",{points:"14 2 14 8 20 8"}),h("line",{x1:"16",y1:"13",x2:"8",y2:"13"}),h("line",{x1:"16",y1:"17",x2:"8",y2:"17"}),h("polyline",{points:"10 9 9 9 8 9"})),wt=h("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round",class:"feather feather-list"},h("line",{x1:"8",y1:"6",x2:"21",y2:"6"}),h("line",{x1:"8",y1:"12",x2:"21",y2:"12"}),h("line",{x1:"8",y1:"18",x2:"21",y2:"18"}),h("line",{x1:"3",y1:"6",x2:"3.01",y2:"6"}),h("line",{x1:"3",y1:"12",x2:"3.01",y2:"12"}),h("line",{x1:"3",y1:"18",x2:"3.01",y2:"18"})),St=h("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round",class:"feather feather-star"},h("polygon",{points:"12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"})),_t=h("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round",class:"feather feather-video"},h("polygon",{points:"23 7 16 12 23 17 23 7"}),h("rect",{x:"1",y:"5",width:"15",height:"14",rx:"2",ry:"2"})),kt=h("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round",class:"feather feather-mic"},h("path",{d:"M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3z"}),h("path",{d:"M19 10v2a7 7 0 0 1-14 0v-2"}),h("line",{x1:"12",y1:"19",x2:"12",y2:"23"}),h("line",{x1:"8",y1:"23",x2:"16",y2:"23"})),xt=(h("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round",class:"feather feather-circle"},h("circle",{cx:"12",cy:"12",r:"10"})),h("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round",class:"feather feather-pause"},h("rect",{x:"6",y:"4",width:"4",height:"16"}),h("rect",{x:"14",y:"4",width:"4",height:"16"}))),Et=h("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},h("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M3 10h10a8 8 0 018 8v2M3 10l6 6m-6-6l6-6"})),Tt=h("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round",class:"feather feather-thumbs-up"},h("path",{d:"M14 9V5a3 3 0 0 0-3-3l-4 9v11h11.28a2 2 0 0 0 2-1.7l1.38-9a2 2 0 0 0-2-2.3zM7 22H4a2 2 0 0 1-2-2v-7a2 2 0 0 1 2-2h3"})),Ct=h("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round",class:"feather feather-edit-3"},h("path",{d:"M12 20h9"}),h("path",{d:"M16.5 3.5a2.121 2.121 0 0 1 3 3L7 19l-4 1 1-4L16.5 3.5z"})),At=h("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round",class:"feather feather-trash-2"},h("polyline",{points:"3 6 5 6 21 6"}),h("path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"}),h("line",{x1:"10",y1:"11",x2:"10",y2:"17"}),h("line",{x1:"14",y1:"11",x2:"14",y2:"17"})),It=h("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round",class:"feather feather-bell"},h("path",{d:"M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"}),h("path",{d:"M13.73 21a2 2 0 0 1-3.46 0"})),Rt=h("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round",class:"feather feather-eye"},h("path",{d:"M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"}),h("circle",{cx:"12",cy:"12",r:"3"})),Ot=h("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round",class:"feather feather-eye-off"},h("path",{d:"M17.94 17.94A10.07 10.07 0 0 1 12 20c-7 0-11-8-11-8a18.45 18.45 0 0 1 5.06-5.94M9.9 4.24A9.12 9.12 0 0 1 12 4c7 0 11 8 11 8a18.5 18.5 0 0 1-2.16 3.19m-6.72-1.07a3 3 0 1 1-4.24-4.24"}),h("line",{x1:"1",y1:"1",x2:"23",y2:"23"})),Pt=h("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round",class:"feather feather-log-in"},h("path",{d:"M15 3h4a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-4"}),h("polyline",{points:"10 17 15 12 10 7"}),h("line",{x1:"15",y1:"12",x2:"3",y2:"12"})),Mt=h("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round",class:"feather feather-tag"},h("path",{d:"M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z"}),h("line",{x1:"7",y1:"7",x2:"7.01",y2:"7"})),Dt=h("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round",class:"feather feather-zoom-in"},h("circle",{cx:"11",cy:"11",r:"8"}),h("line",{x1:"21",y1:"21",x2:"16.65",y2:"16.65"}),h("line",{x1:"11",y1:"8",x2:"11",y2:"14"}),h("line",{x1:"8",y1:"11",x2:"14",y2:"11"})),Lt=h("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round",class:"feather feather-zoom-out"},h("circle",{cx:"11",cy:"11",r:"8"}),h("line",{x1:"21",y1:"21",x2:"16.65",y2:"16.65"}),h("line",{x1:"8",y1:"11",x2:"14",y2:"11"})),Ft=h("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor"},h("path",{d:"M3 3a1 1 0 000 2h11a1 1 0 100-2H3zM3 7a1 1 0 000 2h5a1 1 0 000-2H3zM3 11a1 1 0 100 2h4a1 1 0 100-2H3zM13 16a1 1 0 102 0v-5.586l1.293 1.293a1 1 0 001.414-1.414l-3-3a1 1 0 00-1.414 0l-3 3a1 1 0 101.414 1.414L13 10.414V16z"})),Nt=h("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor"},h("path",{d:"M3 3a1 1 0 000 2h11a1 1 0 100-2H3zM3 7a1 1 0 000 2h7a1 1 0 100-2H3zM3 11a1 1 0 100 2h4a1 1 0 100-2H3zM15 8a1 1 0 10-2 0v5.586l-1.293-1.293a1 1 0 00-1.414 1.414l3 3a1 1 0 001.414 0l3-3a1 1 0 00-1.414-1.414L15 13.586V8z"})),jt=h("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},h("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M7 8h10M7 12h4m1 8l-4-4H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-3l-4 4z"})),Ut=(h("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round",class:"feather feather-inbox"},h("polyline",{points:"22 12 16 12 14 15 10 15 8 12 2 12"}),h("path",{d:"M5.45 5.11L2 12v6a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-6l-3.45-6.89A2 2 0 0 0 16.76 4H7.24a2 2 0 0 0-1.79 1.11z"})),h("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round",class:"feather feather-map-pin"},h("path",{d:"M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"}),h("circle",{cx:"12",cy:"10",r:"3"}))),Bt=h("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round",class:"feather feather-lock"},h("rect",{x:"3",y:"11",width:"18",height:"11",rx:"2",ry:"2"}),h("path",{d:"M7 11V7a5 5 0 0 1 10 0v4"})),qt=h("svg",{width:"24",height:"24",version:"1.1",viewBox:"0 0 6.35 6.35",stroke:"currentColor",fill:"none",xmlns:"http://www.w3.org/2000/svg"},h("g",{transform:"matrix(.79346 0 0 .79346 -64.91 -71.541)","stroke-width":".66691","aria-label":""},h("path",{d:"m84.897 97.735v-3.0819h-1.4224c-0.02963-1.6891 0.41487-2.5188 1.4224-2.667v-1.1261c-1.7484 0.14817-2.7559 1.5409-2.7559 3.882v2.993zm4.6821 0v-3.0819h-1.4224c-0.02963-1.6891 0.41487-2.5188 1.4224-2.667v-1.1261c-1.7484 0.14817-2.7559 1.5409-2.7559 3.882v2.993z","stroke-width":".66691"}))),Kt=h("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",width:"24",height:"24",viewBox:"0 0 24 24",stroke:"currentColor"},h("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"})),zt=h("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round",class:"feather feather-download"},h("path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"}),h("polyline",{points:"7 10 12 15 17 10"}),h("line",{x1:"12",y1:"15",x2:"12",y2:"3"}));function $t(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class Vt extends g{constructor(e){super(e),$t(this,"hideToast",(e=>this.setState({content:null}))),$t(this,"setContent",(e=>this.setState({content:e}))),Vt.hide=this.hideToast,Vt.set=this.setContent}render(e,t){return t.content?h("div",{id:"toast-popup"},h("div",{id:"toast-content"},h("button",{id:"dismiss-toast",onclick:this.hideToast},et),t.content)):null}}function Ht(e){return t=>{Vt.set(h(m,null,h("h3",{id:"toast-header"},e),h("div",null,"Here's the error message:"),h("pre",null,t.message)))}}function Wt(){return"ERROR"!==Ye.client.getSyncState()||(Vt.set(h(m,null,h("h3",{id:"toast-header"},"It looks like you're offline"),h("div",null,"This operation requires a network connection. Try again once you're back online."))),!1)}function Gt(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class Yt extends g{constructor(e){super(e),Gt(this,"namingTimeout",null),Gt(this,"mainForm",{current:null}),Gt(this,"fileLoader",{current:null}),Gt(this,"roomNameInput",{current:null}),Gt(this,"roomAliasInput",{current:null}),Gt(this,"roomTopicInput",{current:null}),Gt(this,"submitButton",{current:null}),Gt(this,"progressHandler",(e=>this.setState({progress:e}))),Gt(this,"keydownHandler",(e=>e.stopPropagation())),Gt(this,"nameInputHandler",(e=>{e.stopPropagation(),this.setState({name:e.target.value},this.validateAlias)})),Gt(this,"handleToggle",(e=>this.setState((e=>({details:!e.details}))))),Gt(this,"aliasInputHandler",(e=>{e.stopPropagation(),this.setState({alias:this.toAlias(e.target.value)},this.validateAlias)})),Gt(this,"validateAlias",(e=>{clearTimeout(this.namingTimeout),this.setState({querying:!0});const t=this.state.alias.length>0?this.state.alias:this.toAlias(this.state.name);this.namingTimeout=setTimeout((e=>{Ye.client.getRoomIdForAlias(`#${t}:${Ye.client.getDomain()}`).then((e=>this.setState({querying:!1,aliasAvailable:!1}))).catch((e=>{""===t?this.setState({querying:!1,aliasAvailable:!1}):"M_NOT_FOUND"===e.errcode?this.setState({querying:!1,aliasAvailable:!0}):alert(e)}))}),1e3)})),Gt(this,"validatePdf",(e=>{"application/pdf"===this.fileLoader.current.files[0].type?this.setState({pdfvalid:!0}):(this.setState({pdfvalid:!1}),alert("Please make sure that the file you're uploading is a pdf."),this.mainForm.current.reset())})),Gt(this,"uploadFile",(async e=>{if(e.preventDefault(),!Wt())return;const t=this.fileLoader.current.files[0],n=this.state.name,r=this.state.alias.length>0?this.state.alias:this.toAlias(this.state.name),i=this.roomTopicInput.current.value,s=await Ye.client.uploadContent(t,{progressHandler:this.progressHandler});this.submitButton.current.setAttribute("disabled",!0);const{room_id:o}=await Ye.client.createRoom({room_alias_name:r,visibility:"private",name:n,topic:i,creation_content:{type:"m.space",[je]:{"m.file":{url:s,name:t.name,mimetype:"application/pdf",size:t.size}}},initial_state:[{type:"m.room.join_rules",state_key:"",content:{join_rule:"public"}}],power_level_content_override:{events:{[Le]:0}}}).catch((e=>{alert(e)}));await Ye.client.getRoomWithState(o),this.mainForm.current.reset(),this.props.showMainView()})),this.state={querying:!1,aliasAvailable:!1,pdfvalid:!1,name:"",alias:"",details:!1}}toAlias(e){return e.replace(/[\s:]/g,"_")}render(e,t){return h("div",{id:"pdf-upload"},h("h2",null," Upload a new PDF"),h("form",{id:"pdfUploadForm",ref:this.mainForm,onsubmit:this.uploadFile},h("label",{for:"pdf"}," Pdf to discuss"),h("input",{name:"pdf",oninput:this.validatePdf,ref:this.fileLoader,accept:"application/pdf",type:"file"}),h("label",{for:"discussion"},"Name for Discussion"),h("input",{name:"discussion",value:t.name,onkeydown:this.keydownHandler,oninput:this.nameInputHandler,ref:this.roomNameInput,type:"text"}),t.details?null:h("div",{class:"pdfupload-form-detail"},t.querying?"querying...":t.aliasAvailable?"name available":"name unavailable"),h("label",{for:"topic"},"Topic of Discussion"),h("textarea",{name:"topic",onkeydown:this.keydownHandler,ref:this.roomTopicInput,type:"text","data-gramm":"false"}),h("details",{open:t.details,ontoggle:this.handleToggle},h("summary",null,"Advanced Settings"),h("div",{class:"pdfupload-details-wrapper"},h("label",{for:"discussion"},"Canonical Alias"),h("input",{name:"discussion",value:t.alias,placeholder:this.toAlias(t.name),oninput:this.aliasInputHandler,ref:this.roomAliasInput,type:"text"}),t.details?h("div",{class:"pdfupload-form-detail"},t.querying?"querying...":t.aliasAvailable?"alias available":"alias unavailable"):null)),h("div",{id:"pdfUploadFormSubmit"},h("button",{disabled:t.progress||t.querying||!t.aliasAvailable||!t.pdfvalid,class:"styled-button",ref:this.submitButton,type:"submit"},t.progress?"Uploading...":"Create Discussion")),t.progress?h("div",{id:"pdfUploadFormProgress"},h("progress",{class:"styled-progress",max:t.progress.total,value:t.progress.loaded})):null))}}class Xt{static hasResource(e){const t=e.getLiveTimeline().getState(me.EventTimeline.FORWARDS),n=t.getStateEvents("m.room.create","")?.getContent()?.[je],r=t.getStateEvents(Pe,"")?.getContent()?.mxc;return!(!n&&!r)}constructor(e){const t=e.getLiveTimeline().getState(me.EventTimeline.FORWARDS),n=t.getStateEvents(Pe,"")?.getContent()?.mxc,r=t.getStateEvents("m.room.create","")?.getContent()?.[je];this.file=r?.["m.file"],this.mimetype=r?.mimetype||this.file?.mimetype||"application/pdf",this.url=r?.url||this.file?.url||n,this.schema=this.url?.match(/^\w*/)[0]}get httpUrl(){return"mxc"===this.schema?Ye.client.getHttpUriForMxcFromHS(this.url):"http"===this.schema||"https"===this.schema?this.url:null}}class Zt{constructor(e){this.event=e,this.location=this.event.getContent()[qe]||this.event.getContent()[Ke]?.[qe]}isValid(){return!!(this.location&&this.getPageIndex()&&this.getStatus()&&this.getCreator()&&this.getType())}getUnread(){const e=Ye.client.getRoom(this.getChild());return e?e.getUnreadNotificationCount():"All"}getText(){return this.location?.[Ue]?.text_content}getVia(){return this.event.getContent().via}getPageIndex(){return this.location?.[Ue]?.page_index||this.location?.[Be]?.page_index}getStatus(){return this.location?.[ze]?.activityStatus}getRect(){return this.location?.[Ue]?.rect||this.location?.[Be]?.rect}isPrivate(){return!!this.location?.[ze]?.private}getQuadPoints(){return this.location?.[Ue]?.quad_points}getRootContent(){return this.location?.[ze]?.rootContent}getCreator(){return this.location?.[ze]?.creator}getType(){return this.location?.[Ue]?"highlight":this.location?.[Be]?"text":null}getParent(){return this.event.getType()===Fe?this.event.getStateKey():this.event.getType()===Le?this.event.getRoomId():"m.room.message"===this.event.getType()?this.event.getContent()[Ke]?.[Ne]:void 0}getChild(){return this.event.getType()===Fe?this.event.getRoomId():this.event.getType()===Le?this.event.getStateKey():"m.room.message"===this.event.getType()?this.event.getRoomId():void 0}}var Jt=__webpack_require__(3062),Qt={};function en(e){return h("span",{style:new fe(e.member.userId).styleVariables,class:"member-pill"},e.member.name)}Qt.styleTagTransform=Ie(),Qt.setAttributes=Ee(),Qt.insert=ke().bind(null,"head"),Qt.domAPI=Se(),Qt.insertStyleElement=Ce(),be()(Jt.Z,Qt),Jt.Z&&Jt.Z.locals&&Jt.Z.locals;var tn=__webpack_require__(7724),nn={};function rn(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}nn.styleTagTransform=Ie(),nn.setAttributes=Ee(),nn.insert=ke().bind(null,"head"),nn.domAPI=Se(),nn.insertStyleElement=Ce(),be()(tn.Z,nn),tn.Z&&tn.Z.locals&&tn.Z.locals;class sn extends g{constructor(e){super(e),rn(this,"hideModal",(e=>{delete document.body.dataset.modalVisible,this.setState({content:null,title:null})})),rn(this,"setContent",((e,t)=>{document.body.dataset.modalVisible=!0,this.setState({content:e,title:t})})),this.state={content:null},sn.set=this.setContent,sn.hide=this.hideModal,sn.isVisible=e=>null!==this.state.content,sn.getTitle=e=>this.state.title}render(e,t){return t.content?h("div",{id:"modalPopup"},h("div",{id:"modalBackground",onclick:this.hideModal}),h("div",{id:"modalContent"},h("button",{id:"dismissModal",onclick:this.hideModal},et),t.content)):null}}function on(e){return h("span",{style:new fe(e.user.userId||e.user.user_id).styleVariables,class:"member-pill"},e.user.displayName||e.user.display_name)}var an=__webpack_require__(592),ln={};function cn(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}ln.styleTagTransform=Ie(),ln.setAttributes=Ee(),ln.insert=ke().bind(null,"head"),ln.domAPI=Se(),ln.insertStyleElement=Ce(),be()(an.Z,ln),an.Z&&an.Z.locals&&an.Z.locals;class dn extends g{constructor(...e){super(...e),cn(this,"searchInput",this.props.searchInput||{current:null}),cn(this,"keydownHandler",(e=>{const t=this.props.searchPredicate||(e=>"/"===e.key&&!e.altKey&&!e.ctrlKey);t(e)&&(e.preventDefault(),this.searchInput.current.focus())})),cn(this,"handleClear",(e=>{e.preventDefault(),this.props.setSearch(""),this.searchInput.current.focus()})),cn(this,"handleInputBlur",(e=>{this.props.setFocus&&this.props.setFocus(!1),this.props.onBlur&&this.props.onBlur(e)})),cn(this,"handleInputFocus",(e=>{this.props.setFocus&&this.props.setFocus(!0),this.props.onFocus&&this.props.onFocus(e)})),cn(this,"handleInputKeydown",(e=>{e.altKey||e.ctrlKey||e.stopPropagation(),"Esc"!==e.key&&"Escape"!==e.key||this.searchInput.current.blur(),"Enter"===e.key&&this.props.submit&&this.props.submit(this.props.search)})),cn(this,"handleInput",(e=>this.props.setSearch(e.target.value)))}componentDidMount(){document.addEventListener("keydown",this.keydownHandler)}componentWillUnmount(){document.removeEventListener("keydown",this.keydownHandler)}render(e,t){return h("div",{title:e.title,class:"search-bar"},h("input",{ref:this.searchInput,value:e.search,onkeydown:this.handleInputKeydown,onInput:this.handleInput,onBlur:this.handleInputBlur,onFocus:this.handleInputFocus}),h("div",{class:"search-icon"},at),h("div",{onmousedown:this.handleClear,title:e.search?"Clear current search":null,class:"right-decoration"},e.search?et:e.hint?h("span",{class:"search-hint"},e.hint):null))}}var un=__webpack_require__(5440),hn={};function pn(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}hn.styleTagTransform=Ie(),hn.setAttributes=Ee(),hn.insert=ke().bind(null,"head"),hn.domAPI=Se(),hn.insertStyleElement=Ce(),be()(un.Z,hn),un.Z&&un.Z.locals&&un.Z.locals;class mn extends g{constructor(e){super(e),pn(this,"updateMembership",(e=>{const t=this.props.room.getMembersWithMembership("join").sort(((e,t)=>e.name.toUpperCase()>t.name.toUpperCase()?1:-1)),n=this.props.room.getMembersWithMembership("invite").sort(((e,t)=>e.name.toUpperCase()>t.name.toUpperCase()?1:-1)),r=t.map((e=>e.userId)).concat(n.map((e=>e.userId)));e.getRoomId()===this.props.room.roomId&&this.setState({joins:t,invites:n,memberIds:r})})),pn(this,"filterMembers",(e=>this.setState({search:e}))),pn(this,"addMembers",(e=>this.setState({adding:!0}))),pn(this,"removeMembers",(e=>this.setState({adding:!1})));const t=this.props.room.getMembersWithMembership("join").sort(((e,t)=>e.name.toUpperCase()>t.name.toUpperCase()?1:-1)),n=this.props.room.getMembersWithMembership("invite").sort(((e,t)=>e.name.toUpperCase()>t.name.toUpperCase()?1:-1)),r=t.map((e=>e.userId)).concat(n.map((e=>e.userId)));this.state={adding:!0,joins:t,invites:n,memberIds:r,search:""}}componentDidMount(){Ye.client.on("RoomMember.membership",this.updateMembership)}componentWillUnmount(){Ye.client.off("RoomMember.membership",this.updateMembership)}render(e,t){console.log(t);const n=t.adding&&Ye.client.getUsers().filter((e=>!t.memberIds.includes(e.userId))).filter((e=>e.displayName.toUpperCase().includes(t.search.toUpperCase()))).sort(((e,t)=>e.displayName.toUpperCase()>t.displayName.toUpperCase()?1:-1)),r=!t.adding&&t.joins.filter((e=>e.name.toUpperCase().includes(t.search.toUpperCase()))),i=!t.adding&&t.invites.filter((e=>e.name.toUpperCase().includes(t.search.toUpperCase())));return h(m,null,h("h3",{id:"modalHeader"},"Manage Membership ",e.room.name?`for ${e.room.name}`:""),h(dn,{search:t.search,setSearch:this.filterMembers}),h("div",{id:"invite-select-view",class:"select-view"},h("button",{onClick:this.addMembers,"data-current-button":t.adding},"Add Members"),h("button",{onClick:this.removeMembers,"data-current-button":!t.adding},"Remove Members")),t.adding?h("div",{style:{height:40*n.length+50+"px"},id:"invite-add-members"},h("div",null,n.map((t=>h(gn,{user:t,room:e.room,key:t.userId})))),h(vn,{search:t.search,memberIds:t.memberIds,additions:n,room:e.room})):h("div",{style:{height:40*(r.length+i.length)+"px"},id:"invite-remove-members"},r.map((t=>h(yn,{member:t,room:e.room,key:t.userId}))),i.map((t=>h(fn,{member:t,room:e.room,key:t.userId})))))}}class gn extends g{constructor(...e){super(...e),pn(this,"invite",(e=>Ye.client.invite(this.props.room.roomId,this.props.user.userId||this.props.user.user_id).catch(alert)))}render(e){return h("button",{class:"invite-candidate",onclick:this.invite},h("span",{class:"small-icon"},nt),h(on,{user:e.user}))}}class fn extends g{constructor(...e){super(...e),pn(this,"kick",(e=>Ye.client.kick(this.props.room.roomId,this.props.member.userId).catch(alert)))}render(e){return h("button",{class:"disinvite-candidate",onclick:this.kick},h("span",{class:"small-icon"},tt),h(en,{member:e.member}))}}class yn extends g{constructor(...e){super(...e),pn(this,"kick",(e=>Ye.client.kick(this.props.room.roomId,this.props.member.userId).catch(alert)))}render(e){return h("button",{class:"removal-candidate",onclick:this.kick},h("span",{class:"small-icon"},tt),h(en,{member:e.member}))}}class vn extends g{constructor(e){super(e),pn(this,"serverSearch",(async e=>{this.setState({pending:!0});const{results:t}=await Ye.client.searchUserDirectory({term:this.props.search});this.setState({results:t,fired:!0,pending:!1})})),this.state={results:[],pending:!1,fired:!1}}render(e,t){const n={visibility:e.search?"visible":"hidden"},r=t.results.filter((t=>!e.additions.map((e=>e.userId)).includes(t.user_id))).filter((t=>!e.memberIds.includes(t.user_id))).filter((t=>t.display_name?t.display_name.toUpperCase().includes(e.search.toUpperCase()):t.user_id.toUpperCase().includes(e.search.toUpperCase())));return h(m,null,t.fired&&r.length>0?h("hr",{id:"invite-search-divider"}):null,r.map((t=>h(gn,{key:t.user_id,user:t,room:e.room}))),h("div",null,h("button",{style:n,id:"invite-search-directory",class:"styled-button",disabled:t.pending,onclick:this.serverSearch},t.fired?"Search again?":"Search for more people?")))}}function bn(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class wn extends g{constructor(...e){super(...e),bn(this,"leaveRoom",(async e=>{await Ye.client.leave(this.props.room.roomId),sn.hide()})),bn(this,"forgetRoom",(async e=>{await Ye.client.leave(this.props.room.roomId),await Ye.client.forget(this.props.room.roomId),sn.hide()}))}render(e){return h(m,null,h("h3",{id:"modalHeader"},"Leave ",e.room.name,"?"),h("p",null,"To stop receiving updates about this room, and remove it from your room listing:"),h("button",{onClick:this.leaveRoom,class:"styled-button"},"Leave This Room"),h("p",null,"To also removed all stored room history, and no longer see the room as an option to join or add to collections:"),h("button",{onClick:this.forgetRoom,class:"styled-button"},"Forget This Room"))}}var Sn=__webpack_require__(8477),_n={};function kn(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}_n.styleTagTransform=Ie(),_n.setAttributes=Ee(),_n.insert=ke().bind(null,"head"),_n.domAPI=Se(),_n.insertStyleElement=Ce(),be()(Sn.Z,_n),Sn.Z&&Sn.Z.locals&&Sn.Z.locals;class xn extends g{constructor(e){super(e),kn(this,"newTagInput",{current:null}),kn(this,"handleBlur",(e=>this.setState({newTag:""}))),kn(this,"handleKeyup",(e=>{"Enter"===e.key?(Ye.client.setRoomTag(this.props.room.roomId,`u.${this.newTagInput.current.value}`,{order:.5}),this.setState({newTag:""})):this.setState({newTag:this.newTagInput.current.value})})),kn(this,"handleClick",(e=>t=>{Ye.client.deleteRoomTag(this.props.room.roomId,e)})),this.state={newTag:"",tags:Object.keys(e.room.tags)},this.accountListener=this.accountListener.bind(this)}componentDidMount(){Ye.client.on("Room.accountData",this.accountListener)}componentWillUnmount(){Ye.client.off("Room.accountData",this.accountListener)}accountListener(){this.setState({tags:Object.keys(this.props.room.tags)})}render(e,t){const n=t.tags.filter((e=>"u."===e.slice(0,2))).map((t=>h(m,{key:`${e.room.roomId}"-tag-"${t}`},h("span",{onclick:this.handleClick(t),class:"room-tag-delete-icon"},At),h(En,{room:e.room,tag:t}))));return h("div",{class:"tag-editor"},h(m,null,n),h("input",{ref:this.newTagInput,class:"styled-input tag-input",value:t.newTag,onkeyup:this.handleKeyup,onblur:this.handleBlur,placeholder:"new tag"}))}}function En(e){return h("span",{class:"room-tag"},e.tag.slice(2))}function Tn(e){const t=Object.keys(e.room.tags).filter((e=>"u."===e.slice(0,2))).map((t=>h(En,{key:`${e.room.roomId}"-tag-"${e.tag}`,room:e.room,tag:t})));return h(m,null,t)}var Cn=__webpack_require__(9041),An=__webpack_require__.n(Cn);const In=[0,0,22,37,0,0,22,37,1];function Rn(e,t,n,r){return new Promise((i=>{let s=t,o=n;o>600&&(s=Math.floor(s*(600/o)),o=600),s>800&&(o=Math.floor(o*(800/s)),s=800);const a=document.createElement("canvas");a.width=s,a.height=o,a.getContext("2d").drawImage(e,0,0,s,o),a.toBlob((e=>{i({info:{thumbnail_info:{w:s,h:o,mimetype:e.type,size:e.size},w:t,h:n},thumbnail:e})}),r)}))}async function On(e){const t=document.createElement("img"),n=URL.createObjectURL(e),r=new Promise(((e,r)=>{t.onload=r=>{URL.revokeObjectURL(n),e(t)},t.onerror=e=>r(e)}));let i;var s;t.src=n,"image/png"===e.type&&(i=(s=e,new Promise(((e,t)=>{const n=new FileReader;n.onload=t=>e(t.target.result),n.onerror=e=>t(e),n.readAsArrayBuffer(s)}))).then((e=>{const t=new Uint8Array(e),n=An()(t);for(const e of n)if("pHYs"===e.name){if(e.data.byteLength!==In.length)return;return e.data.every(((e,t)=>e===In[t]))}return!1})));const[o]=await Promise.all([i,r]);return{width:o?t.width>>1:t.width,height:o?t.height>>1:t.height,img:t}}var Pn=__webpack_require__(5255),Mn={};function Dn(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}Mn.styleTagTransform=Ie(),Mn.setAttributes=Ee(),Mn.insert=ke().bind(null,"head"),Mn.domAPI=Se(),Mn.insertStyleElement=Ce(),be()(Pn.Z,Mn),Pn.Z&&Pn.Z.locals&&Pn.Z.locals;class Ln extends g{constructor(e){super(e),Dn(this,"avatarImageInput",{current:null}),Dn(this,"handleJoinRuleChange",(e=>{this.setState({joinRule:e.target.value})})),Dn(this,"handleNameInput",(e=>{this.setState({roomName:e.target.value})})),Dn(this,"handleKeydown",(e=>{e.stopPropagation()})),Dn(this,"handleUploadAvatar",(e=>this.avatarImageInput.current.click())),Dn(this,"handleVisibilityChange",(e=>{this.setState({visibility:e.target.value})})),Dn(this,"progressHandler",(e=>this.setState({progress:e}))),Dn(this,"handleSubmit",(async e=>{e.preventDefault();const t=this.avatarImageInput.current.files[0];if(this.state.visibility!==this.initialVisibility&&await Ye.client.setRoomDirectoryVisibility(this.props.room.roomId,this.state.visibility).catch(this.raiseErr),this.state.joinRule!==this.initialJoinRule&&await this.updateJoinRule(),this.state.roomName!==this.initialRoomName&&await Ye.client.setRoomName(this.props.room.roomId,this.state.roomName).catch(this.raiseErr),t&&/^image/.test(t.type)){const{width:e,height:n}=await On(t);await Ye.client.uploadContent(t,{progressHandler:this.progressHandler}).then((r=>Ye.client.sendStateEvent(this.props.room.roomId,"m.room.avatar",{info:{w:e,h:n,mimetype:t.type?t.type:"application/octet-stream",size:t.size},url:r},"")))}else this.state.previewUrl||Ye.client.sendStateEvent(this.props.room.roomId,"m.room.avatar",{},"");sn.hide()})),Dn(this,"raiseErr",(e=>alert("Something went wrong. You may not have permission to adjust some of these settings."))),Dn(this,"updatePreview",(e=>{const t=this.avatarImageInput.current.files[0];t&&/^image/.test(t.type)&&this.setState({previewUrl:URL.createObjectURL(this.avatarImageInput.current.files[0])})})),Dn(this,"uploadAvatar",(e=>this.avatarImageInput.current.click())),Dn(this,"removeAvatar",(e=>this.setState({previewUrl:null}))),Dn(this,"cancel",(e=>{e.preventDefault(),sn.hide()})),this.roomState=e.room.getLiveTimeline().getState(me.EventTimeline.FORWARDS),this.initialJoinRule=this.roomState.getJoinRule(),this.initialName=e.room.name,this.initialVisibility=null,this.joinLink=`${window.location.protocol}//${window.location.hostname}${window.location.pathname}?join=${encodeURIComponent(e.room.roomId)}&via=${Ye.client.getDomain()}`,this.state={previewUrl:e.room.getAvatarUrl(`https://${Ye.client.getDomain()}`,300,300,"crop"),joinRule:this.initialJoinRule,roomName:this.initialName,visibility:null,references:null}}componentDidMount(){this.initialize()}async initialize(){const e=await Ye.client.getRoomDirectoryVisibility(this.props.room.roomId);this.initialVisibility=e;const t=this.roomState.getStateEvents(Fe).map((e=>Ye.client.getRoom(e.getStateKey()).getLiveTimeline().getState(me.EventTimeline.FORWARDS).getStateEvents(Le,this.props.room.roomId)));this.setState({references:t,visibility:e.visibility})}async updateJoinRule(){const e={join_rule:this.state.joinRule};await Ye.client.sendStateEvent(this.props.room.roomId,"m.room.join_rules",e,"").catch(this.raiseErr),"public"===this.state.joinRule&&this.publishReferences(),"invite"===this.state.joinRule&&this.hideReferences()}publishReferences(){const e=Ye.client.getDomain();this.state.references.forEach((t=>{const n=new Zt(t);if(!n.isPrivate())return;delete n.location[ze].private;const r={via:[e],[qe]:n.location};Ye.client.sendStateEvent(t.getRoomId(),Le,r,this.props.room.roomId).catch((e=>alert(e)))}))}hideReferences(){const e=Ye.client.getDomain();this.state.references.forEach((t=>{const n=new Zt(t);if(!n?.location?.[ze])return;if(n.isPrivate())return;n.location[ze].private=!0;const r={via:[e],[qe]:n.location};Ye.client.sendStateEvent(t.getRoomId(),Le,r,this.props.room.roomId).catch((e=>alert(e)))}))}render(e,t){return t.visibility?h(m,null,h("h3",{id:"modalHeader"},"Room Settings"),h("form",{id:"room-settings-form"},h("label",{htmlFor:"room-avatar"},"Room Avatar"),t.previewUrl?h("img",{onclick:this.handleUploadAvatar,id:"room-settings-avatar-selector",src:t.previewUrl}):h("div",{key:"room-settings-avatar-selector",onclick:this.uploadAvatar,id:"room-settings-avatar-selector"}),h("input",{name:"room-avatar",id:"room-avatar-selector-hidden",onchange:this.updatePreview,ref:this.avatarImageInput,accept:"image/*",type:"file"}),h("div",{id:"room-settings-avatar-info"}),h("label",{htmlFor:"room-name"},"Room Name"),h("input",{name:"room-name",type:"text",class:"styled-input",value:t.roomName,onkeydown:this.handleKeydown,onInput:this.handleNameInput}),h("div",{id:"room-settings-name-info"}),h("label",{htmlFor:"visibilty"},"Visibility"),h("select",{class:"styled-input",value:t.visibility,name:"joinRule",onchange:this.handleVisibilityChange},h("option",{value:"private"},"Private"),h("option",{value:"public"},"Publically Listed")),h("div",{id:"room-settings-visibility-info"},"public"===t.visibility?"the room will appear in public listings":"the room will be hidden from other users"),h("label",{htmlFor:"joinRule"},"Join Rule"),h("select",{class:"styled-input",value:t.joinRule,name:"joinRule",onchange:this.handleJoinRuleChange},h("option",{value:"public"},"Public"),h("option",{value:"invite"},"Invite-Only")),h("div",{id:"room-settings-join-info"},"public"===t.joinRule?"anyone who can find the room may join":"an explicit invitation is required before joining"),e.joinLink?h(m,null,h("label",null,"Join Link"),h("pre",{id:"room-settings-join-link"},this.joinLink)):null,h("div",{id:"room-settings-submit-wrapper"},h("button",{className:"styled-button",onClick:this.handleSubmit},"Save Changes"),h("button",{className:"styled-button",onClick:this.cancel},"Cancel"),t.previewUrl?h("button",{class:"styled-button",type:"button",onclick:this.removeAvatar},"Remove Avatar"):null),this.state.progress?h("div",{id:"room-settings-progress"},h("progress",{class:"styled-progress",max:t.progress.total,value:t.progress.loaded})):null)):h("span",{id:"settings-loading"},"loading...")}}function Fn(e){const t=[],n=/[^\s"]+|"([^"]*)"/gi;let r;do{r=n.exec(e),null!=r&&t.push(r[1]?r[1]:r[0])}while(null!=r);return t}function Nn(){return Nn=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},Nn.apply(this,arguments)}var jn,Un=jn||(jn={});Un.Pop="POP",Un.Push="PUSH",Un.Replace="REPLACE";function Bn(e){e.preventDefault(),e.returnValue=""}function qn(){var e=[];return{get length(){return e.length},push:function(t){return e.push(t),function(){e=e.filter((function(e){return e!==t}))}},call:function(t){e.forEach((function(e){return e&&e(t)}))}}}function Kn(e){var t=e.pathname;t=void 0===t?"/":t;var n=e.search;return n=void 0===n?"":n,e=void 0===(e=e.hash)?"":e,n&&"?"!==n&&(t+="?"===n.charAt(0)?n:"?"+n),e&&"#"!==e&&(t+="#"===e.charAt(0)?e:"#"+e),t}function zn(e){var t={};if(e){var n=e.indexOf("#");0<=n&&(t.hash=e.substr(n),e=e.substr(0,n)),0<=(n=e.indexOf("?"))&&(t.search=e.substr(n),e=e.substr(0,n)),e&&(t.pathname=e)}return t}function $n(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class Vn{static push(e,t){ae(e),this.history.replace(e,t)}static replace(e,t){ae(e,!0),this.history.replace(e,t)}}$n(Vn,"history",function(e){function t(){var e=zn(a.location.hash.substr(1)),t=e.pathname,n=e.search;e=e.hash;var r=l.state||{};return[r.idx,{pathname:void 0===t?"/":t,search:void 0===n?"":n,hash:void 0===e?"":e,state:r.usr||null,key:r.key||"default"}]}function n(){if(c)m.call(c),c=null;else{var e=jn.Pop,n=t(),r=n[0];if(n=n[1],m.length){if(null!=r){var i=u-r;i&&(c={action:e,location:n,retry:function(){o(-1*i)}},o(i))}}else s(e)}}function r(e){var t=document.querySelector("base"),n="";return t&&t.getAttribute("href")&&(n=-1===(n=(t=a.location.href).indexOf("#"))?t:t.slice(0,n)),n+"#"+("string"==typeof e?e:Kn(e))}function i(e,t){return void 0===t&&(t=null),Nn({pathname:h.pathname,hash:"",search:""},"string"==typeof e?zn(e):e,{state:t,key:Math.random().toString(36).substr(2,8)})}function s(e){d=e,e=t(),u=e[0],h=e[1],p.call({action:d,location:h})}function o(e){l.go(e)}void 0===e&&(e={});var a=void 0===(e=e.window)?document.defaultView:e,l=a.history,c=null;a.addEventListener("popstate",n),a.addEventListener("hashchange",(function(){Kn(t()[1])!==Kn(h)&&n()}));var d=jn.Pop,u=(e=t())[0],h=e[1],p=qn(),m=qn();return null==u&&(u=0,l.replaceState(Nn({},l.state,{idx:u}),"")),{get action(){return d},get location(){return h},createHref:r,push:function e(t,n){var o=jn.Push,c=i(t,n);if(!m.length||(m.call({action:o,location:c,retry:function(){e(t,n)}}),0)){var d=[{usr:c.state,key:c.key,idx:u+1},r(c)];c=d[0],d=d[1];try{l.pushState(c,"",d)}catch(e){a.location.assign(d)}s(o)}},replace:function e(t,n){var o=jn.Replace,a=i(t,n);m.length&&(m.call({action:o,location:a,retry:function(){e(t,n)}}),1)||(a=[{usr:a.state,key:a.key,idx:u},r(a)],l.replaceState(a[0],"",a[1]),s(o))},go:o,back:function(){o(-1)},forward:function(){o(1)},listen:function(e){return p.push(e)},block:function(e){var t=m.push(e);return 1===m.length&&a.addEventListener("beforeunload",Bn),function(){t(),m.length||a.removeEventListener("beforeunload",Bn)}}}}()),$n(Vn,"message",{});var Hn=__webpack_require__(8316),Wn={};function Gn(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}Wn.styleTagTransform=Ie(),Wn.setAttributes=Ee(),Wn.insert=ke().bind(null,"head"),Wn.domAPI=Se(),Wn.insertStyleElement=Ce(),be()(Hn.Z,Wn),Hn.Z&&Hn.Z.locals&&Hn.Z.locals;class Yn extends g{constructor(e){super(e),Gn(this,"roomListener",(e=>{clearTimeout(this.roomDebounceTimeout),this.roomDebounceTimeout=setTimeout((e=>{this.setState({rooms:Ye.client.getVisibleRooms().filter(Xt.hasResource).filter((e=>"join"===e.getMyMembership()))})}))})),Gn(this,"byActivity",((e,t)=>{const n=e.getLastActiveTimestamp(),r=t.getLastActiveTimestamp();return n<r?1*this.state.sortOrder:r<n?-1*this.state.sortOrder:0})),Gn(this,"byName",((e,t)=>{const n=e.name,r=t.name;return n>r?1*this.state.sortOrder:n<r?-1*this.state.sortOrder:0})),Gn(this,"sortByActivity",(e=>{this.setState((e=>"Activity"===e.sort?{sortOrder:-1*e.sortOrder}:{sort:"Activity"}))})),Gn(this,"sortByName",(e=>{this.setState((e=>"Name"===e.sort?{sortOrder:-1*e.sortOrder}:{sort:"Name"}))})),Gn(this,"flipSort",(e=>{this.setState((e=>({sortOrder:-1*e.sortOrder})))})),Gn(this,"searchRooms",(e=>{const t=[],n=[],r=[],i=[],s=[],o=[];for(const a of e)"#"===a.slice(0,1)?n.push(a.slice(1)):"@"===a.slice(0,1)?r.push(a.slice(1)):"*"===a.slice(0,1)?s.push(a.slice(1)):"~"===a.slice(0,1)?i.push(a.slice(1)):"!"===a.slice(0,1)?o.push(a):t.push(a);return this.state.rooms.filter((e=>{let a=!0;i.includes("fav")&&(a=a&&!!e.tags["m.favourite"]);const l=Object.keys(e.tags).filter((e=>"u."===e.slice(0,2))),c=e.getLiveTimeline().getState(me.EventTimeline.FORWARDS),d=c.getMembers().map((e=>e.userId)),u=c.getStateEvents("m.space.parent").map((e=>Ye.client.getRoom(e.getStateKey())?.name)).filter((e=>e));return t.every((t=>e.name.toLowerCase().includes(t.toLowerCase())))&&(!(o.length>0)||o.some((t=>e.roomId===t)))&&r.every((e=>d.some((t=>t.toLowerCase().includes(e.toLowerCase())))))&&n.every((e=>l.some((t=>t.toLowerCase().includes(e.toLowerCase())))))&&s.every((e=>u.some((t=>t.toLowerCase().includes(e.toLowerCase())))))&&a}))})),Gn(this,"sortRooms",(e=>e.sort(this.getSortFunc()).map((e=>{const t=new Xt(e);let n=null;return"join"===e.getMyMembership()&&t.url&&(n=h(Jn,{memberLimit:this.props.narrow?5:15,room:e,key:e.roomId})),n})).filter((e=>null!==e)))),this.state={rooms:Ye.client.getVisibleRooms().filter(Xt.hasResource),sort:"Activity",memberLimit:document.body.offsetWidth>400?15:5,sortOrder:1}}componentDidMount(){Ye.client.on("Room",this.roomListener),Ye.client.on("Room.name",this.roomListener),Ye.client.on("RoomState.events",this.roomListener),Ye.client.on("Room.accountData",this.roomListener)}componentWillUnmount(){Ye.client.off("Room",this.roomListener),Ye.client.off("Room.name",this.roomListener),Ye.client.off("RoomState.events",this.roomListener),Ye.client.off("Room.accountData",this.roomListener)}getSortFunc(){switch(this.state.sort){case"Activity":return this.byActivity;case"Name":return this.byName}}render(e,t){return h("div",{id:"room-list"},h("div",{id:"select-sort"},h("button",{class:"small-icon",style:"cursor: pointer",onClick:this.flipSort},1===t.sortOrder?Nt:Ft),h("button",{"data-current-button":"Activity"===t.sort,onClick:this.sortByActivity,class:"styled-button"},"Activity"),h("button",{"data-current-button":"Name"===t.sort,onClick:this.sortByName,class:"styled-button"},"Name")),h(Xn,{setFilterItems:e.setFilterItems,filterItems:e.filterItems}),h("div",null,this.sortRooms(this.searchRooms(Fn(e.searchFilter).concat(e.filterItems.map((e=>e.value)))))))}}class Xn extends g{constructor(...e){super(...e),Gn(this,"removeFilter",(e=>this.props.setFilterItems(this.props.filterItems.filter((t=>t.value!==e.value)))))}render(e){if(e.filterItems.length>0)return h("div",{id:"room-filters"},"Filters: ",e.filterItems.map((e=>h(Zn,{removeFilter:this.removeFilter,key:e.value,filter:e}))))}}class Zn extends g{constructor(...e){super(...e),Gn(this,"removeMe",(e=>{this.props.removeFilter(this.props.filter)}))}render(e){return h("span",{class:"room-filter-listing"},h("span",{class:"room-filter-content"},e.filter.display),h("button",{onclick:this.removeMe,class:"small-icon-badge"},et))}}class Jn extends g{constructor(e){super(e),Gn(this,"getLastViewedPage",(e=>this.props.room.getAccountData(Me)?this.props.room.getAccountData(Me).getContent().page:1)),Gn(this,"roomColor",new ye(this.props.room.roomId)),Gn(this,"toggleButtons",(e=>this.setState((e=>({buttonsVisible:!e.buttonsVisible}))))),Gn(this,"openInvite",(e=>sn.set(h(mn,{room:this.props.room})))),Gn(this,"openSettings",(e=>sn.set(h(Ln,{joinLink:!0,room:this.props.room})))),Gn(this,"handleEditTags",(e=>sn.set(h(xn,{room:this.props.room})))),Gn(this,"toggleFavorite",(e=>{this.props.room.tags["m.favourite"]?Ye.client.deleteRoomTag(this.props.room.roomId,"m.favourite"):Ye.client.setRoomTag(this.props.room.roomId,"m.favourite",{order:.5})})),Gn(this,"handleClose",(e=>sn.set(h(wn,{room:this.props.room})))),this.state={buttonsVisible:!1}}render(e,t){const n=e.room.getMember(Ye.client.getUserId()),r=n.powerLevel>=100,i=e.room.getLiveTimeline().getState(me.EventTimeline.FORWARDS).hasSufficientPowerLevelFor("invite",n.powerLevel);return h("div",{style:this.roomColor.styleVariables,class:"room-listing-entry",id:e.room.roomId},h(Qn,{getLastViewedPage:this.getLastViewedPage,room:e.room}),h("div",{"data-room-entry-buttons-visible":t.buttonsVisible,class:"room-listing-body"},h("div",{class:"room-listing-heading"},e.room.tags["m.favourite"]?h("span",{class:"fav-star"}," ",St," "):null,h("a",{href:`${window.location.origin}${window.location.pathname}#/${encodeURIComponent(e.room.getCanonicalAlias().slice(1))}/${this.getLastViewedPage()}`},e.room.name)),h("div",{class:"room-listing-data"},h(er,{room:e.room}),h(tr,{room:e.room,memberLimit:e.memberLimit})),h("div",{class:"room-listing-entry-buttons"},t.buttonsVisible?null:h("button",{title:"Toggle buttons",onClick:this.toggleButtons},ht),t.buttonsVisible?h("button",{title:"Toggle buttons",onClick:this.toggleButtons},et):null,t.buttonsVisible?h("button",{title:"Toggle favorite",onClick:this.toggleFavorite},St):null,t.buttonsVisible?h("button",{title:"Leave conversation",onClick:this.handleClose},st):null,t.buttonsVisible?h("button",{title:"Edit room tags",onClick:this.handleEditTags},Mt):null,t.buttonsVisible&&i?h("button",{title:"Invite a friend",onClick:this.openInvite},nt):null,t.buttonsVisible&&r?h("button",{title:"Configure room settings",onClick:this.openSettings},dt):null)))}}class Qn extends g{constructor(e){super(e),Gn(this,"handleStateUpdate",(e=>{e.getRoomId()===this.props.room.roomId&&"m.room.avatar"===e.getType()&&this.setState({avatarEvent:e,avatarUrl:e.getContent().url?Ye.client.getHttpUriForMxcFromHS(e.getContent().url,800,600,"scale"):null})})),Gn(this,"handleLoad",(e=>this.setState({loaded:!0})));const t=e.room.getLiveTimeline().getState(me.EventTimeline.FORWARDS).getStateEvents("m.room.avatar","");this.state={avatarEvent:t,loaded:!1,avatarUrl:t?.getContent()?.url?Ye.client.getHttpUriForMxcFromHS(t.getContent().url,800,600,"scale"):null}}componentDidMount(){Ye.client.on("RoomState.events",this.handleStateUpdate)}componentWillUnmount(){Ye.client.off("RoomState.events",this.handleStateUpdate)}render(e,t){const n=t.avatarEvent?.getContent()?.info;return h("div",{style:n?{"min-height":Math.min(300,n.h),"max-height":Math.min(300,n.h)}:null,"data-has-avatar":!!t.avatarUrl,class:"room-listing-avatar"},t.avatarUrl?h("img",{src:t.avatarUrl,onLoad:this.handleLoad,"data-avatar-loaded":t.loaded,loading:"lazy",alt:"room avatar"}):null,h(nr,{getLastViewedPage:e.getLastViewedPage,room:e.room}))}}function er(e){const t=Object.keys(e.room.tags).filter((e=>"u."===e.slice(0,2))).length;return t>0?h("div",{class:"room-listing-data-row"},h("span",{class:"room-data-icon"},Mt),h(Tn,{room:e.room})):null}class tr extends g{constructor(e){super(e),Gn(this,"toggleMemberList",(e=>this.setState((e=>({open:!e.open}))))),this.state={open:!1}}render(e,t){const n=e.room.getMembersWithMembership("join"),r=e.room.getMembersWithMembership("invite"),i=t.open?n.map((e=>h(en,{key:e.userId,member:e}))):n.slice(0,e.memberLimit).map((e=>h(en,{key:e.userId,member:e}))),s=r.map((e=>h("span",{key:e.userId,class:"invite-pill"},h(en,{member:e}))));return h("div",{class:"room-listing-data-row"},h("span",{class:"room-data-icon"},rt),h(m,null,i),h(m,null,s),n.length<=e.memberLimit?null:t.open?h("button",{onclick:this.toggleMemberList,class:"room-toggle-members"},et):h("button",{onclick:this.toggleMemberList,class:"room-toggle-members"},"and ",n.length-e.memberLimit," more."))}}class nr extends g{constructor(e){super(e),Gn(this,"updateAnnotations",(e=>{const t=this.props.room.getLiveTimeline().getState(me.EventTimeline.FORWARDS).getStateEvents(Le).map((e=>new Zt(e))).filter((e=>e.isValid()&&"open"===e.getStatus()));this.setState({annotations:t})})),Gn(this,"handleStateUpdate",(e=>{e.getRoomId()===this.props.room.roomId&&e.getType()===Le&&this.updateAnnotations()})),Gn(this,"handleLoadNew",(e=>{Vn.push(`/${encodeURIComponent(this.props.room.getCanonicalAlias().slice(1))}/${this.props.getLastViewedPage()||1}/`,{searchString:"~unread"})})),Gn(this,"getUnreadCount",(e=>this.state.annotations.filter((e=>e.getUnread())).length)),this.state={annotations:[]},this.handleTimeline=this.handleTimeline.bind(this),this.handleStateUpdate=this.handleStateUpdate.bind(this),this.handleInitialSync=this.handleInitialSync.bind(this)}componentDidMount(){Ye.client.on("RoomState.events",this.handleStateUpdate),Ye.client.on("Room.accountData",this.handleTimeline),Ye.client.on("Room.timeline",this.handleTimeline),Ye.client.on("sync.initial",this.handleInitialSync),"PREPARED"!==Ye.client.getSyncState()&&this.updateAnnotations()}componentWillUnmount(){Ye.client.off("RoomState.events",this.handleStateUpdate),Ye.client.off("Room.accountData",this.handleTimeline),Ye.client.off("sync.initial",this.handleInitialSync),Ye.client.off("Room.timeline",this.handleTimeline)}handleInitialSync(){this.updateAnnotations()}handleTimeline(e,t){const n=this.state.annotations.map((e=>e.getChild()));t?.roomId in n&&this.updateAnnotations()}render(){const e=this.getUnreadCount();return h("div",{class:"room-annotation-data"},e<1?null:h("span",{title:"Unread conversations",onClick:this.handleLoadNew},h("button",{class:"small-icon"},jt),h("span",{class:"small-icon-badge"},e)))}}var rr=__webpack_require__(5620),ir={};ir.styleTagTransform=Ie(),ir.setAttributes=Ee(),ir.insert=ke().bind(null,"head"),ir.domAPI=Se(),ir.insertStyleElement=Ce(),be()(rr.Z,ir),rr.Z&&rr.Z.locals&&rr.Z.locals;var sr=__webpack_require__(1737),or={};function ar(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}or.styleTagTransform=Ie(),or.setAttributes=Ee(),or.insert=ke().bind(null,"head"),or.domAPI=Se(),or.insertStyleElement=Ce(),be()(sr.Z,or),sr.Z&&sr.Z.locals&&sr.Z.locals;class lr extends g{constructor(e){super(e),ar(this,"amJoined",(e=>!("join"!==Ye.client.getRoom(this.props.roomId)?.getMyMembership()))),ar(this,"handleRoom",((e,t)=>{e.roomId!==this.props.roomId&&t?.roomId!==this.props.roomId||("m.room.avatar"===e.getType()?this.setState({joined:this.amJoined(),avatarUrl:e.getContent().url?Ye.client.mxcUrlToHttp(e.getContent().url,35,35,"crop"):null}):(clearTimeout(this.roomDebounceTimeout),this.roomDebounceTimeout=setTimeout((e=>{this.setState({joined:this.amJoined()})}))))})),ar(this,"handleClick",(e=>this.state.joined?this.props.activeClick&&this.props.activeClick(this.props.roomId,this.props.name):this.props.inactiveClick&&this.props.inactiveClick(this.props.roomId,this.props.name))),ar(this,"roomColor",new ye(this.props.name)),this.state={joined:this.amJoined(),loaded:!1,avatarUrl:e.avatarUrl?Ye.client.mxcUrlToHttp(e.avatarUrl,35,35,"crop"):null}}componentDidMount(){Ye.client.on("Room",this.handleRoom),Ye.client.on("RoomState.events",this.handleRoom)}componentDidUnmount(){Ye.client.on("Room",this.handleRoom),Ye.client.on("RoomState.events",this.handleRoom)}render(e,t){return h("div",{onclick:this.handleClick,"data-joined":t.joined,"data-has-avatar":!!t.avatarUrl,class:"room-icon",style:{cursor:t.joined?e.activeClick&&"pointer":e.inactiveClick&&"pointer",width:e.size,height:e.size,lineHeight:`${e.size}px`,...this.roomColor.styleVariables}},t.avatarUrl?h("img",{src:t.avatarUrl,style:{width:e.size,height:e.size}}):e.name.slice(0,1))}}function cr(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class dr extends g{constructor(e){super(e),cr(this,"handleRoom",(e=>{clearTimeout(this.roomDebounceTimeout),this.roomDebounceTimeout=setTimeout((e=>{this.setState({spaces:Ye.client.getVisibleRooms().filter((e=>"join"===e.getMyMembership())).filter(this.isCollection)})}))})),cr(this,"filterSet",(e=>{this.props.setFilterItems([e]),this.props.showMainView&&this.props.showMainView()})),cr(this,"filterToggle",(e=>{const t=this.props.filterItems.filter((t=>t.value!==e.value));t.length===this.props.filterItems.length&&t.push(e),this.props.setFilterItems(t),this.props.showMainView&&this.props.showMainView()})),cr(this,"createCollection",(e=>{sn.set(h(ur,null))})),this.state={spaces:Ye.client.getVisibleRooms().filter((e=>"join"===e.getMyMembership())).filter(this.isCollection)}}componentDidMount(){Ye.client.on("Room",this.handleRoom),Ye.client.on("Room.name",this.handleRoom)}componentWillUnmount(){Ye.client.off("Room",this.handleRoom),Ye.client.off("Room.name",this.handleRoom)}isCollection(e){return"m.space"===e.getLiveTimeline().getState(me.EventTimeline.FORWARDS).getStateEvents("m.room.create","").getContent()?.type&&!Xt.hasResource(e)}render(e,t){return h("div",{id:"spaces-manager"},h("h1",null,"Collections"),h("div",{id:"spaces-list"},t.spaces.map((t=>h(hr,{filterToggle:this.filterToggle,filterSet:this.filterSet,narrow:e.narrow,key:t.roomId,room:t})))),h("div",null,h("button",{onclick:this.createCollection,id:"create-space"},"+ Create New Collection")))}}class ur extends g{constructor(e){super(e),cr(this,"mainForm",{current:null}),cr(this,"collectionNameInput",{current:null}),cr(this,"collectionTopicInput",{current:null}),cr(this,"validateName",(e=>{clearTimeout(this.namingTimeout),this.setState({querying:!0}),this.namingTimeout=setTimeout((e=>{Ye.client.getRoomIdForAlias(`#${this.toAlias(this.collectionNameInput.current.value)}:${Ye.client.getDomain()}`).then((e=>this.setState({querying:!1,nameavailable:!1}))).catch((e=>{""===this.collectionNameInput.current.value?this.setState({querying:!1,nameavailable:!1}):"M_NOT_FOUND"===e.errcode?this.setState({querying:!1,nameavailable:!0}):alert(e)}))}),1e3)})),cr(this,"handleSubmit",(async e=>{e.preventDefault();const t=this.collectionNameInput.current.value,n=this.toAlias(t),r=this.collectionTopicInput.current.value;await Ye.client.createRoom({room_alias_name:n,visibility:"private",name:t,topic:r,creation_content:{type:"m.space"},initial_state:[{type:"m.room.join_rules",state_key:"",content:{join_rule:"public"}}]}).catch((e=>{alert(e)})),sn.hide()})),this.state={querying:!1,nameavailable:!1}}toAlias(e){return e.replace(/[\s:]/g,"_")}render(e,t){return h(m,null,h("h3",{id:"modalHeader"},"Create Collection"),h("form",{ref:this.mainForm,onSubmit:this.handleSubmit,id:"create-collection"},h("label",{for:"name"},"Collection Name"),h("input",{name:"name",oninput:this.validateName,ref:this.collectionNameInput}),h("div",{class:"name-validation-detail"},t.querying?"querying...":t.nameavailable?"name available":"name unavailable"),h("label",{for:"topic"},"Collection Topic"),h("textarea",{name:"topic",ref:this.collectionTopicInput}),h("div",{id:"create-collection-submit"},h("button",{disabled:t.querying||!t.nameavailable,class:"styled-button",ref:this.submitButton,type:"submit"},"Create Collection"))))}}class hr extends g{constructor(e){super(e),cr(this,"loadChildren",(async e=>{const t=await Ye.client.getRoomHierarchy(this.props.room.roomId,30,1,!1,this.state.nextBatch),n={};for(const e of t.rooms[0]?.children_state)n[e.state_key]=e.content.via;const r=this.state.children;for(const e of t.rooms)e.room_id!==this.props.room.roomId&&(r[e.room_id]=e);this.setState({via:n,children:r,nextBatch:t.next_batch},this.refreshModal)})),cr(this,"pageChildren",(async e=>{this.state.nextBatch&&this.loadChildren()})),cr(this,"addChildren",(e=>{const t=this.state.limit+15;t>Object.keys(this.state.children).length&&this.pageChildren(),this.setState({limit:t})})),cr(this,"refreshModal",(e=>"addChild"===sn.getTitle()?sn.set(h(pr,{children:Object.values(this.state.children),nextBatch:this.state.nextBatch,pageChildren:this.pageChildren,room:this.props.room}),"addChild"):null)),cr(this,"handleStateUpdate",(e=>{e.getRoomId()===this.props.room.roomId&&e.getType()===Le&&(e.getContent().via?Ye.client.getRoomHierarchy(e.getStateKey(),1,0).then((t=>{const[n]=t.rooms;this.setState((t=>(t.children[n.room_id]=n,t.via[e.getStateKey()]=e.getContent().via,{via:t.via,children:t.children})),this.refreshModal)})):this.setState((t=>(delete t.children[e.getStateKey()],{children:t.children})),this.refreshModal))})),cr(this,"searchMe",(e=>this.props.filterSet({display:h(m,null,h("span",{class:"small-icon"},Kt),this.props.room.name),value:`*${this.props.room.name}`}))),cr(this,"toggleActions",(e=>this.setState((e=>({actionsVisible:!e.actionsVisible}))))),cr(this,"addChild",(e=>{this.setState({actionsVisible:!1}),sn.set(h(pr,{children:Object.values(this.state.children),nextBatch:this.state.nextBatch,pageChildren:this.pageChildren,room:this.props.room}),"addChild")})),cr(this,"joinChild",(e=>Ye.client.joinRoom(e,{viaServers:this.state.via[e]}).catch(Ht("Couldn't join this discussion")))),cr(this,"toggleChild",((e,t)=>this.props.filterToggle({value:e,display:h(m,null,h("span",{class:"small-icon"},bt),t)}))),cr(this,"openSettings",(e=>{this.setState({actionsVisible:!1}),sn.set(h(Ln,{joinLink:!0,room:this.props.room}))})),cr(this,"openInvite",(e=>{this.setState({actionsVisible:!1}),sn.set(h(mn,{room:this.props.room}))})),cr(this,"roomColor",new ye(this.props.room.name)),this.state={actionsVisible:!1,children:{},limit:30,nextBatch:null,via:null}}componentDidMount(){Ye.client.on("RoomState.events",this.handleStateUpdate),this.loadChildren()}componentWillUnmount(){Ye.client.off("RoomState.events",this.handleStateUpdate)}render(e,t){const n=e.room.getMember(Ye.client.getUserId()).powerLevel>=100;return h("div",{style:this.roomColor.styleVariables,class:"space-listing"},h("h3",null,h("span",{onclick:this.searchMe},e.room.name),n?h("button",{"data-narrow-view":e.narrow,onclick:this.toggleActions},ht):null),t.actionsVisible?h("div",{class:"space-listing-actions"},h("button",{class:"small-icon",onclick:this.addChild},ct),h("button",{class:"small-icon",onclick:this.openInvite},nt),h("button",{class:"small-icon",onclick:this.openSettings},dt)):null,h("div",{class:"space-listing-children"},t.children?Object.values(t.children).slice(0,t.limit).map((e=>h(lr,{key:e.room_id,size:50,inactiveClick:this.joinChild,activeClick:this.toggleChild,roomId:e.room_id,avatarUrl:e.avatar_url,name:e.name||e.canonical_alias.slice(1)||"?"}))):null,t.nextBatch||t.limit<Object.values(t.children).length?h("div",{class:"space-listing-more",onclick:this.addChildren},"..."):null))}}class pr extends g{constructor(e){super(e),cr(this,"currentList",{current:null}),cr(this,"handleScroll",(e=>{clearTimeout(this.debounceTimeout),this.debounceTimeout=setTimeout((e=>{const t=this.currentList.current;t.scrollTop+t.clientHeight+10>=t.scrollHeight&&this.props.pageChildren()}),500)})),cr(this,"addDiscussions",(e=>this.setState({adding:!0}))),cr(this,"removeDiscussions",(e=>this.setState({adding:!1}))),cr(this,"filterDiscussions",(e=>{this.setState({search:e,discussions:Ye.client.getVisibleRooms().filter((t=>Xt.hasResource(t)&&t.name.toLowerCase().includes(e.toLowerCase())))})})),e.children.map((e=>e.name)),this.state={search:"",adding:!0,discussions:Ye.client.getVisibleRooms().filter((e=>Xt.hasResource(e)))}}render(e,t){const n=this.props.children.map((e=>e.name)),r=t.adding&&t.discussions.filter((e=>!n.includes(e.name))),i=!t.adding&&e.children.filter((e=>e.name.toLowerCase().includes(t.search.toLowerCase())));return h(m,null,h("h3",{id:"modalHeader"},"Manage Discussions in ",e.room.name),h(dn,{search:t.search,setSearch:this.filterDiscussions}),h("div",{id:"manage-discussion-select-view",class:"select-view"},h("button",{onClick:this.addDiscussions,"data-current-button":t.adding},"Add Discussions"),h("button",{onClick:this.removeDiscussions,"data-current-button":!t.adding},"Remove Discussions")),t.adding?h("div",{style:{height:28*r.length+"px"},id:"available-discussions-list"},r.map((t=>h(gr,{key:t.roomId,room:t,collection:e.room})))):h("div",{style:{height:28*i.length+"px"},onscroll:this.handleScroll,ref:this.currentList,id:"current-discussions-list"},i.map((t=>h(mr,{key:t.room_id,child:t,collection:e.room})))))}}class mr extends g{constructor(...e){super(...e),cr(this,"removeMe",(async e=>{this.setState({pending:!0}),await Ye.client.sendStateEvent(this.props.collection.roomId,Le,{},this.props.child.room_id).catch(Ht("Couldn't remove discussion from collection")),await Ye.client.sendStateEvent(this.props.child.room_id,Fe,{},this.props.collection.roomId).catch(Ht("Couldn't remove collection as parent of discussion"))}))}render(e,t){return h("button",{"data-change-pending":t.pending,class:"discussion-listing",onclick:this.removeMe},h("span",null,At),h("span",null,e.child.name))}}class gr extends g{constructor(...e){super(...e),cr(this,"addMe",(async e=>{this.setState({pending:!0});const t=Ye.client.getDomain(),n={via:[t],"com.open-tower.populus.collection_child":!0},r={via:[t]};await Ye.client.sendStateEvent(this.props.collection.roomId,Le,n,this.props.room.roomId).catch(Ht("Couldn't add discussion to collection")),await Ye.client.sendStateEvent(this.props.room.roomId,Fe,r,this.props.collection.roomId).catch(Ht("Couldn't add collection as parent of discussion"))}))}render(e,t){return h("button",{"data-change-pending":t.pending,class:"discussion-listing",onclick:this.addMe},h("span",null,ct),h("span",null,e.room.name))}}var fr=__webpack_require__(3734),yr={};function vr(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}yr.styleTagTransform=Ie(),yr.setAttributes=Ee(),yr.insert=ke().bind(null,"head"),yr.domAPI=Se(),yr.insertStyleElement=Ce(),be()(fr.Z,yr),fr.Z&&fr.Z.locals&&fr.Z.locals;class br extends g{constructor(e){super(e),vr(this,"displayNameInput",{current:null}),vr(this,"avatarImageInput",{current:null}),vr(this,"scrollbarVisibleSelect",{current:null}),vr(this,"submitButton",{current:null}),vr(this,"mainForm",{current:null}),vr(this,"progressHandler",(e=>this.setState({progress:e}))),vr(this,"uploadAvatar",(e=>this.avatarImageInput.current.click())),vr(this,"removeAvatar",(e=>this.setState({previewUrl:null}))),vr(this,"handleKeydown",(e=>{e.stopPropagation()})),vr(this,"updatePreview",(e=>{const t=this.avatarImageInput.current.files[0];t&&/^image/.test(t.type)&&this.setState({previewUrl:URL.createObjectURL(this.avatarImageInput.current.files[0])})})),vr(this,"updateProfile",(async e=>{if(e.preventDefault(),!Wt())return;const t=this.avatarImageInput.current.files[0],n=this.displayNameInput.current.value;this.submitButton.current.setAttribute("disabled",!0),localStorage.setItem("scrollbars",this.scrollbarVisibleSelect.current.value),document.documentElement.dataset.scrollbars=this.scrollbarVisibleSelect.current.value,n&&await Ye.client.setDisplayName(n),t&&/^image/.test(t.type)?await Ye.client.uploadContent(t,{progressHandler:this.progressHandler}).then((e=>Ye.client.setAvatarUrl(e))):this.state.previewUrl||await Ye.client.setAvatarUrl("null"),this.mainForm.current.reset(),this.props.showMainView()}));const t=Ye.client.getUser(Ye.client.getUserId());this.state={previewUrl:Ye.client.getHttpUriForMxcFromHS(t.avatarUrl,180,180,"crop"),displayName:t.displayName},"visible"===localStorage.getItem("scrollbars")&&(this.scrollbarsVisible=!0)}render(e,t){return h("div",{id:"profile-information"},h("h2",null,"Update Your Profile"),h("form",{id:"profileInformationForm",ref:this.mainForm,onsubmit:this.updateProfile},h("label",null,"My User Id"),h("div",{id:"profile-information-userid"},Ye.client.getUserId()),h("label",null,"My Display Name"),h("input",{onkeydown:this.handleKeydown,placeholder:t.displayName,ref:this.displayNameInput,type:"text"}),h("label",null,"My Avatar"),t.previewUrl?h("img",{onclick:this.uploadAvatar,id:"profileSelector",src:t.previewUrl}):h("div",{key:"profileSelector",onclick:this.uploadAvatar,id:"profileSelector"}),h("input",{id:"profileInformationFormHidden",onchange:this.updatePreview,ref:this.avatarImageInput,accept:"image/*",type:"file"}),h("details",null,h("summary",null,"Display Options"),h("div",{id:"profile-display-options"},h("label",{for:"scrollbar-visibility"},"Scrollbars"),h("select",{class:"styled-input",ref:this.scrollbarVisibleSelect,name:"scrollbar-visibility"},h("option",{value:"hidden"},"Hidden"),h("option",{selected:this.scrollbarsVisible,value:"visible"},"Visible")))),h("details",null,h("summary",null,"Advanced Options"),h("div",{id:"profile-advanced-options"},h("label",null,"My Access Token"),h("pre",null,Ye.client.getAccessToken()))),h("div",{key:"profileInformationFormSubmit",id:"profileInformationFormSubmit"},h("button",{class:"styled-button",ref:this.submitButton,type:"submit"},"Update Profile"),t.previewUrl?h("button",{class:"styled-button",type:"button",onclick:this.removeAvatar},"Remove Avatar"):null,h("button",{class:"styled-button",type:"button",onclick:e.logoutHandler},"Logout")),this.state.progress?h("div",{id:"profileInformationFormProgress"},h("progress",{class:"styled-progress",max:t.progress.total,value:t.progress.loaded})):null))}}var wr=__webpack_require__(1036),Sr=__webpack_require__.n(wr);class _r{constructor(e,t,n){this.lexer=void 0,this.start=void 0,this.end=void 0,this.lexer=e,this.start=t,this.end=n}static range(e,t){return t?e&&e.loc&&t.loc&&e.loc.lexer===t.loc.lexer?new _r(e.loc.lexer,e.loc.start,t.loc.end):null:e&&e.loc}}class kr{constructor(e,t){this.text=void 0,this.loc=void 0,this.noexpand=void 0,this.treatAsRelax=void 0,this.text=e,this.loc=t}range(e,t){return new kr(t,_r.range(this,e))}}class xr{constructor(e,t){this.position=void 0;var n,r="KaTeX parse error: "+e,i=t&&t.loc;if(i&&i.start<=i.end){var s=i.lexer.input;n=i.start;var o=i.end;n===s.length?r+=" at end of input: ":r+=" at position "+(n+1)+": ";var a=s.slice(n,o).replace(/[^]/g,"$&");r+=(n>15?""+s.slice(n-15,n):s.slice(0,n))+a+(o+15<s.length?s.slice(o,o+15)+"":s.slice(o))}var l=new Error(r);return l.name="ParseError",l.__proto__=xr.prototype,l.position=n,l}}xr.prototype.__proto__=Error.prototype;var Er=/([A-Z])/g,Tr={"&":"&amp;",">":"&gt;","<":"&lt;",'"':"&quot;","'":"&#x27;"},Cr=/[&><"']/g,Ar=function e(t){return"ordgroup"===t.type||"color"===t.type?1===t.body.length?e(t.body[0]):t:"font"===t.type?e(t.body):t},Ir=function(e,t){return-1!==e.indexOf(t)},Rr=function(e,t){return void 0===e?t:e},Or=function(e){return String(e).replace(Cr,(e=>Tr[e]))},Pr=function(e){return e.replace(Er,"-$1").toLowerCase()},Mr=Ar,Dr=function(e){var t=Ar(e);return"mathord"===t.type||"textord"===t.type||"atom"===t.type},Lr=function(e){var t=/^\s*([^\\/#]*?)(?::|&#0*58|&#x0*3a)/i.exec(e);return null!=t?t[1]:"_relative"},Fr={displayMode:{type:"boolean",description:"Render math in display mode, which puts the math in display style (so \\int and \\sum are large, for example), and centers the math on the page on its own line.",cli:"-d, --display-mode"},output:{type:{enum:["htmlAndMathml","html","mathml"]},description:"Determines the markup language of the output.",cli:"-F, --format <type>"},leqno:{type:"boolean",description:"Render display math in leqno style (left-justified tags)."},fleqn:{type:"boolean",description:"Render display math flush left."},throwOnError:{type:"boolean",default:!0,cli:"-t, --no-throw-on-error",cliDescription:"Render errors (in the color given by --error-color) instead of throwing a ParseError exception when encountering an error."},errorColor:{type:"string",default:"#cc0000",cli:"-c, --error-color <color>",cliDescription:"A color string given in the format 'rgb' or 'rrggbb' (no #). This option determines the color of errors rendered by the -t option.",cliProcessor:e=>"#"+e},macros:{type:"object",cli:"-m, --macro <def>",cliDescription:"Define custom macro of the form '\\foo:expansion' (use multiple -m arguments for multiple macros).",cliDefault:[],cliProcessor:(e,t)=>(t.push(e),t)},minRuleThickness:{type:"number",description:"Specifies a minimum thickness, in ems, for fraction lines, `\\sqrt` top lines, `{array}` vertical lines, `\\hline`, `\\hdashline`, `\\underline`, `\\overline`, and the borders of `\\fbox`, `\\boxed`, and `\\fcolorbox`.",processor:e=>Math.max(0,e),cli:"--min-rule-thickness <size>",cliProcessor:parseFloat},colorIsTextColor:{type:"boolean",description:"Makes \\color behave like LaTeX's 2-argument \\textcolor, instead of LaTeX's one-argument \\color mode change.",cli:"-b, --color-is-text-color"},strict:{type:[{enum:["warn","ignore","error"]},"boolean","function"],description:"Turn on strict / LaTeX faithfulness mode, which throws an error if the input uses features that are not supported by LaTeX.",cli:"-S, --strict",cliDefault:!1},trust:{type:["boolean","function"],description:"Trust the input, enabling all HTML features such as \\url.",cli:"-T, --trust"},maxSize:{type:"number",default:1/0,description:"If non-zero, all user-specified sizes, e.g. in \\rule{500em}{500em}, will be capped to maxSize ems. Otherwise, elements and spaces can be arbitrarily large",processor:e=>Math.max(0,e),cli:"-s, --max-size <n>",cliProcessor:parseInt},maxExpand:{type:"number",default:1e3,description:"Limit the number of macro expansions to the specified number, to prevent e.g. infinite macro loops. If set to Infinity, the macro expander will try to fully expand as in LaTeX.",processor:e=>Math.max(0,e),cli:"-e, --max-expand <n>",cliProcessor:e=>"Infinity"===e?1/0:parseInt(e)},globalGroup:{type:"boolean",cli:!1}};function Nr(e){if(e.default)return e.default;var t=e.type,n=Array.isArray(t)?t[0]:t;if("string"!=typeof n)return n.enum[0];switch(n){case"boolean":return!1;case"string":return"";case"number":return 0;case"object":return{}}}class jr{constructor(e){for(var t in this.displayMode=void 0,this.output=void 0,this.leqno=void 0,this.fleqn=void 0,this.throwOnError=void 0,this.errorColor=void 0,this.macros=void 0,this.minRuleThickness=void 0,this.colorIsTextColor=void 0,this.strict=void 0,this.trust=void 0,this.maxSize=void 0,this.maxExpand=void 0,this.globalGroup=void 0,e=e||{},Fr)if(Fr.hasOwnProperty(t)){var n=Fr[t];this[t]=void 0!==e[t]?n.processor?n.processor(e[t]):e[t]:Nr(n)}}reportNonstrict(e,t,n){var r=this.strict;if("function"==typeof r&&(r=r(e,t,n)),r&&"ignore"!==r){if(!0===r||"error"===r)throw new xr("LaTeX-incompatible input and strict mode is set to 'error': "+t+" ["+e+"]",n);"warn"===r?"undefined"!=typeof console&&console.warn("LaTeX-incompatible input and strict mode is set to 'warn': "+t+" ["+e+"]"):"undefined"!=typeof console&&console.warn("LaTeX-incompatible input and strict mode is set to unrecognized '"+r+"': "+t+" ["+e+"]")}}useStrictBehavior(e,t,n){var r=this.strict;if("function"==typeof r)try{r=r(e,t,n)}catch(e){r="error"}return!(!r||"ignore"===r||!0!==r&&"error"!==r&&("warn"===r?("undefined"!=typeof console&&console.warn("LaTeX-incompatible input and strict mode is set to 'warn': "+t+" ["+e+"]"),1):("undefined"!=typeof console&&console.warn("LaTeX-incompatible input and strict mode is set to unrecognized '"+r+"': "+t+" ["+e+"]"),1)))}isTrusted(e){e.url&&!e.protocol&&(e.protocol=Lr(e.url));var t="function"==typeof this.trust?this.trust(e):this.trust;return Boolean(t)}}class Ur{constructor(e,t,n){this.id=void 0,this.size=void 0,this.cramped=void 0,this.id=e,this.size=t,this.cramped=n}sup(){return Br[qr[this.id]]}sub(){return Br[Kr[this.id]]}fracNum(){return Br[zr[this.id]]}fracDen(){return Br[$r[this.id]]}cramp(){return Br[Vr[this.id]]}text(){return Br[Hr[this.id]]}isTight(){return this.size>=2}}var Br=[new Ur(0,0,!1),new Ur(1,0,!0),new Ur(2,1,!1),new Ur(3,1,!0),new Ur(4,2,!1),new Ur(5,2,!0),new Ur(6,3,!1),new Ur(7,3,!0)],qr=[4,5,4,5,6,7,6,7],Kr=[5,5,5,5,7,7,7,7],zr=[2,3,4,5,6,7,6,7],$r=[3,3,5,5,7,7,7,7],Vr=[1,1,3,3,5,5,7,7],Hr=[0,1,2,3,2,3,2,3],Wr={DISPLAY:Br[0],TEXT:Br[2],SCRIPT:Br[4],SCRIPTSCRIPT:Br[6]},Gr=[{name:"latin",blocks:[[256,591],[768,879]]},{name:"cyrillic",blocks:[[1024,1279]]},{name:"armenian",blocks:[[1328,1423]]},{name:"brahmic",blocks:[[2304,4255]]},{name:"georgian",blocks:[[4256,4351]]},{name:"cjk",blocks:[[12288,12543],[19968,40879],[65280,65376]]},{name:"hangul",blocks:[[44032,55215]]}],Yr=[];function Xr(e){for(var t=0;t<Yr.length;t+=2)if(e>=Yr[t]&&e<=Yr[t+1])return!0;return!1}Gr.forEach((e=>e.blocks.forEach((e=>Yr.push(...e)))));var Zr={doubleleftarrow:"M262 157\nl10-10c34-36 62.7-77 86-123 3.3-8 5-13.3 5-16 0-5.3-6.7-8-20-8-7.3\n 0-12.2.5-14.5 1.5-2.3 1-4.8 4.5-7.5 10.5-49.3 97.3-121.7 169.3-217 216-28\n 14-57.3 25-88 33-6.7 2-11 3.8-13 5.5-2 1.7-3 4.2-3 7.5s1 5.8 3 7.5\nc2 1.7 6.3 3.5 13 5.5 68 17.3 128.2 47.8 180.5 91.5 52.3 43.7 93.8 96.2 124.5\n 157.5 9.3 8 15.3 12.3 18 13h6c12-.7 18-4 18-10 0-2-1.7-7-5-15-23.3-46-52-87\n-86-123l-10-10h399738v-40H218c328 0 0 0 0 0l-10-8c-26.7-20-65.7-43-117-69 2.7\n-2 6-3.7 10-5 36.7-16 72.3-37.3 107-64l10-8h399782v-40z\nm8 0v40h399730v-40zm0 194v40h399730v-40z",doublerightarrow:"M399738 392l\n-10 10c-34 36-62.7 77-86 123-3.3 8-5 13.3-5 16 0 5.3 6.7 8 20 8 7.3 0 12.2-.5\n 14.5-1.5 2.3-1 4.8-4.5 7.5-10.5 49.3-97.3 121.7-169.3 217-216 28-14 57.3-25 88\n-33 6.7-2 11-3.8 13-5.5 2-1.7 3-4.2 3-7.5s-1-5.8-3-7.5c-2-1.7-6.3-3.5-13-5.5-68\n-17.3-128.2-47.8-180.5-91.5-52.3-43.7-93.8-96.2-124.5-157.5-9.3-8-15.3-12.3-18\n-13h-6c-12 .7-18 4-18 10 0 2 1.7 7 5 15 23.3 46 52 87 86 123l10 10H0v40h399782\nc-328 0 0 0 0 0l10 8c26.7 20 65.7 43 117 69-2.7 2-6 3.7-10 5-36.7 16-72.3 37.3\n-107 64l-10 8H0v40zM0 157v40h399730v-40zm0 194v40h399730v-40z",leftarrow:"M400000 241H110l3-3c68.7-52.7 113.7-120\n 135-202 4-14.7 6-23 6-25 0-7.3-7-11-21-11-8 0-13.2.8-15.5 2.5-2.3 1.7-4.2 5.8\n-5.5 12.5-1.3 4.7-2.7 10.3-4 17-12 48.7-34.8 92-68.5 130S65.3 228.3 18 247\nc-10 4-16 7.7-18 11 0 8.7 6 14.3 18 17 47.3 18.7 87.8 47 121.5 85S196 441.3 208\n 490c.7 2 1.3 5 2 9s1.2 6.7 1.5 8c.3 1.3 1 3.3 2 6s2.2 4.5 3.5 5.5c1.3 1 3.3\n 1.8 6 2.5s6 1 10 1c14 0 21-3.7 21-11 0-2-2-10.3-6-25-20-79.3-65-146.7-135-202\n l-3-3h399890zM100 241v40h399900v-40z",leftbrace:"M6 548l-6-6v-35l6-11c56-104 135.3-181.3 238-232 57.3-28.7 117\n-45 179-50h399577v120H403c-43.3 7-81 15-113 26-100.7 33-179.7 91-237 174-2.7\n 5-6 9-10 13-.7 1-7.3 1-20 1H6z",leftbraceunder:"M0 6l6-6h17c12.688 0 19.313.3 20 1 4 4 7.313 8.3 10 13\n 35.313 51.3 80.813 93.8 136.5 127.5 55.688 33.7 117.188 55.8 184.5 66.5.688\n 0 2 .3 4 1 18.688 2.7 76 4.3 172 5h399450v120H429l-6-1c-124.688-8-235-61.7\n-331-161C60.687 138.7 32.312 99.3 7 54L0 41V6z",leftgroup:"M400000 80\nH435C64 80 168.3 229.4 21 260c-5.9 1.2-18 0-18 0-2 0-3-1-3-3v-38C76 61 257 0\n 435 0h399565z",leftgroupunder:"M400000 262\nH435C64 262 168.3 112.6 21 82c-5.9-1.2-18 0-18 0-2 0-3 1-3 3v38c76 158 257 219\n 435 219h399565z",leftharpoon:"M0 267c.7 5.3 3 10 7 14h399993v-40H93c3.3\n-3.3 10.2-9.5 20.5-18.5s17.8-15.8 22.5-20.5c50.7-52 88-110.3 112-175 4-11.3 5\n-18.3 3-21-1.3-4-7.3-6-18-6-8 0-13 .7-15 2s-4.7 6.7-8 16c-42 98.7-107.3 174.7\n-196 228-6.7 4.7-10.7 8-12 10-1.3 2-2 5.7-2 11zm100-26v40h399900v-40z",leftharpoonplus:"M0 267c.7 5.3 3 10 7 14h399993v-40H93c3.3-3.3 10.2-9.5\n 20.5-18.5s17.8-15.8 22.5-20.5c50.7-52 88-110.3 112-175 4-11.3 5-18.3 3-21-1.3\n-4-7.3-6-18-6-8 0-13 .7-15 2s-4.7 6.7-8 16c-42 98.7-107.3 174.7-196 228-6.7 4.7\n-10.7 8-12 10-1.3 2-2 5.7-2 11zm100-26v40h399900v-40zM0 435v40h400000v-40z\nm0 0v40h400000v-40z",leftharpoondown:"M7 241c-4 4-6.333 8.667-7 14 0 5.333.667 9 2 11s5.333\n 5.333 12 10c90.667 54 156 130 196 228 3.333 10.667 6.333 16.333 9 17 2 .667 5\n 1 9 1h5c10.667 0 16.667-2 18-6 2-2.667 1-9.667-3-21-32-87.333-82.667-157.667\n-152-211l-3-3h399907v-40zM93 281 H400000 v-40L7 241z",leftharpoondownplus:"M7 435c-4 4-6.3 8.7-7 14 0 5.3.7 9 2 11s5.3 5.3 12\n 10c90.7 54 156 130 196 228 3.3 10.7 6.3 16.3 9 17 2 .7 5 1 9 1h5c10.7 0 16.7\n-2 18-6 2-2.7 1-9.7-3-21-32-87.3-82.7-157.7-152-211l-3-3h399907v-40H7zm93 0\nv40h399900v-40zM0 241v40h399900v-40zm0 0v40h399900v-40z",lefthook:"M400000 281 H103s-33-11.2-61-33.5S0 197.3 0 164s14.2-61.2 42.5\n-83.5C70.8 58.2 104 47 142 47 c16.7 0 25 6.7 25 20 0 12-8.7 18.7-26 20-40 3.3\n-68.7 15.7-86 37-10 12-15 25.3-15 40 0 22.7 9.8 40.7 29.5 54 19.7 13.3 43.5 21\n 71.5 23h399859zM103 281v-40h399897v40z",leftlinesegment:"M40 281 V428 H0 V94 H40 V241 H400000 v40z\nM40 281 V428 H0 V94 H40 V241 H400000 v40z",leftmapsto:"M40 281 V448H0V74H40V241H400000v40z\nM40 281 V448H0V74H40V241H400000v40z",leftToFrom:"M0 147h400000v40H0zm0 214c68 40 115.7 95.7 143 167h22c15.3 0 23\n-.3 23-1 0-1.3-5.3-13.7-16-37-18-35.3-41.3-69-70-101l-7-8h399905v-40H95l7-8\nc28.7-32 52-65.7 70-101 10.7-23.3 16-35.7 16-37 0-.7-7.7-1-23-1h-22C115.7 265.3\n 68 321 0 361zm0-174v-40h399900v40zm100 154v40h399900v-40z",longequal:"M0 50 h400000 v40H0z m0 194h40000v40H0z\nM0 50 h400000 v40H0z m0 194h40000v40H0z",midbrace:"M200428 334\nc-100.7-8.3-195.3-44-280-108-55.3-42-101.7-93-139-153l-9-14c-2.7 4-5.7 8.7-9 14\n-53.3 86.7-123.7 153-211 199-66.7 36-137.3 56.3-212 62H0V214h199568c178.3-11.7\n 311.7-78.3 403-201 6-8 9.7-12 11-12 .7-.7 6.7-1 18-1s17.3.3 18 1c1.3 0 5 4 11\n 12 44.7 59.3 101.3 106.3 170 141s145.3 54.3 229 60h199572v120z",midbraceunder:"M199572 214\nc100.7 8.3 195.3 44 280 108 55.3 42 101.7 93 139 153l9 14c2.7-4 5.7-8.7 9-14\n 53.3-86.7 123.7-153 211-199 66.7-36 137.3-56.3 212-62h199568v120H200432c-178.3\n 11.7-311.7 78.3-403 201-6 8-9.7 12-11 12-.7.7-6.7 1-18 1s-17.3-.3-18-1c-1.3 0\n-5-4-11-12-44.7-59.3-101.3-106.3-170-141s-145.3-54.3-229-60H0V214z",oiintSize1:"M512.6 71.6c272.6 0 320.3 106.8 320.3 178.2 0 70.8-47.7 177.6\n-320.3 177.6S193.1 320.6 193.1 249.8c0-71.4 46.9-178.2 319.5-178.2z\nm368.1 178.2c0-86.4-60.9-215.4-368.1-215.4-306.4 0-367.3 129-367.3 215.4 0 85.8\n60.9 214.8 367.3 214.8 307.2 0 368.1-129 368.1-214.8z",oiintSize2:"M757.8 100.1c384.7 0 451.1 137.6 451.1 230 0 91.3-66.4 228.8\n-451.1 228.8-386.3 0-452.7-137.5-452.7-228.8 0-92.4 66.4-230 452.7-230z\nm502.4 230c0-111.2-82.4-277.2-502.4-277.2s-504 166-504 277.2\nc0 110 84 276 504 276s502.4-166 502.4-276z",oiiintSize1:"M681.4 71.6c408.9 0 480.5 106.8 480.5 178.2 0 70.8-71.6 177.6\n-480.5 177.6S202.1 320.6 202.1 249.8c0-71.4 70.5-178.2 479.3-178.2z\nm525.8 178.2c0-86.4-86.8-215.4-525.7-215.4-437.9 0-524.7 129-524.7 215.4 0\n85.8 86.8 214.8 524.7 214.8 438.9 0 525.7-129 525.7-214.8z",oiiintSize2:"M1021.2 53c603.6 0 707.8 165.8 707.8 277.2 0 110-104.2 275.8\n-707.8 275.8-606 0-710.2-165.8-710.2-275.8C311 218.8 415.2 53 1021.2 53z\nm770.4 277.1c0-131.2-126.4-327.6-770.5-327.6S248.4 198.9 248.4 330.1\nc0 130 128.8 326.4 772.7 326.4s770.5-196.4 770.5-326.4z",rightarrow:"M0 241v40h399891c-47.3 35.3-84 78-110 128\n-16.7 32-27.7 63.7-33 95 0 1.3-.2 2.7-.5 4-.3 1.3-.5 2.3-.5 3 0 7.3 6.7 11 20\n 11 8 0 13.2-.8 15.5-2.5 2.3-1.7 4.2-5.5 5.5-11.5 2-13.3 5.7-27 11-41 14.7-44.7\n 39-84.5 73-119.5s73.7-60.2 119-75.5c6-2 9-5.7 9-11s-3-9-9-11c-45.3-15.3-85\n-40.5-119-75.5s-58.3-74.8-73-119.5c-4.7-14-8.3-27.3-11-40-1.3-6.7-3.2-10.8-5.5\n-12.5-2.3-1.7-7.5-2.5-15.5-2.5-14 0-21 3.7-21 11 0 2 2 10.3 6 25 20.7 83.3 67\n 151.7 139 205zm0 0v40h399900v-40z",rightbrace:"M400000 542l\n-6 6h-17c-12.7 0-19.3-.3-20-1-4-4-7.3-8.3-10-13-35.3-51.3-80.8-93.8-136.5-127.5\ns-117.2-55.8-184.5-66.5c-.7 0-2-.3-4-1-18.7-2.7-76-4.3-172-5H0V214h399571l6 1\nc124.7 8 235 61.7 331 161 31.3 33.3 59.7 72.7 85 118l7 13v35z",rightbraceunder:"M399994 0l6 6v35l-6 11c-56 104-135.3 181.3-238 232-57.3\n 28.7-117 45-179 50H-300V214h399897c43.3-7 81-15 113-26 100.7-33 179.7-91 237\n-174 2.7-5 6-9 10-13 .7-1 7.3-1 20-1h17z",rightgroup:"M0 80h399565c371 0 266.7 149.4 414 180 5.9 1.2 18 0 18 0 2 0\n 3-1 3-3v-38c-76-158-257-219-435-219H0z",rightgroupunder:"M0 262h399565c371 0 266.7-149.4 414-180 5.9-1.2 18 0 18\n 0 2 0 3 1 3 3v38c-76 158-257 219-435 219H0z",rightharpoon:"M0 241v40h399993c4.7-4.7 7-9.3 7-14 0-9.3\n-3.7-15.3-11-18-92.7-56.7-159-133.7-199-231-3.3-9.3-6-14.7-8-16-2-1.3-7-2-15-2\n-10.7 0-16.7 2-18 6-2 2.7-1 9.7 3 21 15.3 42 36.7 81.8 64 119.5 27.3 37.7 58\n 69.2 92 94.5zm0 0v40h399900v-40z",rightharpoonplus:"M0 241v40h399993c4.7-4.7 7-9.3 7-14 0-9.3-3.7-15.3-11\n-18-92.7-56.7-159-133.7-199-231-3.3-9.3-6-14.7-8-16-2-1.3-7-2-15-2-10.7 0-16.7\n 2-18 6-2 2.7-1 9.7 3 21 15.3 42 36.7 81.8 64 119.5 27.3 37.7 58 69.2 92 94.5z\nm0 0v40h399900v-40z m100 194v40h399900v-40zm0 0v40h399900v-40z",rightharpoondown:"M399747 511c0 7.3 6.7 11 20 11 8 0 13-.8 15-2.5s4.7-6.8\n 8-15.5c40-94 99.3-166.3 178-217 13.3-8 20.3-12.3 21-13 5.3-3.3 8.5-5.8 9.5\n-7.5 1-1.7 1.5-5.2 1.5-10.5s-2.3-10.3-7-15H0v40h399908c-34 25.3-64.7 57-92 95\n-27.3 38-48.7 77.7-64 119-3.3 8.7-5 14-5 16zM0 241v40h399900v-40z",rightharpoondownplus:"M399747 705c0 7.3 6.7 11 20 11 8 0 13-.8\n 15-2.5s4.7-6.8 8-15.5c40-94 99.3-166.3 178-217 13.3-8 20.3-12.3 21-13 5.3-3.3\n 8.5-5.8 9.5-7.5 1-1.7 1.5-5.2 1.5-10.5s-2.3-10.3-7-15H0v40h399908c-34 25.3\n-64.7 57-92 95-27.3 38-48.7 77.7-64 119-3.3 8.7-5 14-5 16zM0 435v40h399900v-40z\nm0-194v40h400000v-40zm0 0v40h400000v-40z",righthook:"M399859 241c-764 0 0 0 0 0 40-3.3 68.7-15.7 86-37 10-12 15-25.3\n 15-40 0-22.7-9.8-40.7-29.5-54-19.7-13.3-43.5-21-71.5-23-17.3-1.3-26-8-26-20 0\n-13.3 8.7-20 26-20 38 0 71 11.2 99 33.5 0 0 7 5.6 21 16.7 14 11.2 21 33.5 21\n 66.8s-14 61.2-42 83.5c-28 22.3-61 33.5-99 33.5L0 241z M0 281v-40h399859v40z",rightlinesegment:"M399960 241 V94 h40 V428 h-40 V281 H0 v-40z\nM399960 241 V94 h40 V428 h-40 V281 H0 v-40z",rightToFrom:"M400000 167c-70.7-42-118-97.7-142-167h-23c-15.3 0-23 .3-23\n 1 0 1.3 5.3 13.7 16 37 18 35.3 41.3 69 70 101l7 8H0v40h399905l-7 8c-28.7 32\n-52 65.7-70 101-10.7 23.3-16 35.7-16 37 0 .7 7.7 1 23 1h23c24-69.3 71.3-125 142\n-167z M100 147v40h399900v-40zM0 341v40h399900v-40z",twoheadleftarrow:"M0 167c68 40\n 115.7 95.7 143 167h22c15.3 0 23-.3 23-1 0-1.3-5.3-13.7-16-37-18-35.3-41.3-69\n-70-101l-7-8h125l9 7c50.7 39.3 85 86 103 140h46c0-4.7-6.3-18.7-19-42-18-35.3\n-40-67.3-66-96l-9-9h399716v-40H284l9-9c26-28.7 48-60.7 66-96 12.7-23.333 19\n-37.333 19-42h-46c-18 54-52.3 100.7-103 140l-9 7H95l7-8c28.7-32 52-65.7 70-101\n 10.7-23.333 16-35.7 16-37 0-.7-7.7-1-23-1h-22C115.7 71.3 68 127 0 167z",twoheadrightarrow:"M400000 167\nc-68-40-115.7-95.7-143-167h-22c-15.3 0-23 .3-23 1 0 1.3 5.3 13.7 16 37 18 35.3\n 41.3 69 70 101l7 8h-125l-9-7c-50.7-39.3-85-86-103-140h-46c0 4.7 6.3 18.7 19 42\n 18 35.3 40 67.3 66 96l9 9H0v40h399716l-9 9c-26 28.7-48 60.7-66 96-12.7 23.333\n-19 37.333-19 42h46c18-54 52.3-100.7 103-140l9-7h125l-7 8c-28.7 32-52 65.7-70\n 101-10.7 23.333-16 35.7-16 37 0 .7 7.7 1 23 1h22c27.3-71.3 75-127 143-167z",tilde1:"M200 55.538c-77 0-168 73.953-177 73.953-3 0-7\n-2.175-9-5.437L2 97c-1-2-2-4-2-6 0-4 2-7 5-9l20-12C116 12 171 0 207 0c86 0\n 114 68 191 68 78 0 168-68 177-68 4 0 7 2 9 5l12 19c1 2.175 2 4.35 2 6.525 0\n 4.35-2 7.613-5 9.788l-19 13.05c-92 63.077-116.937 75.308-183 76.128\n-68.267.847-113-73.952-191-73.952z",tilde2:"M344 55.266c-142 0-300.638 81.316-311.5 86.418\n-8.01 3.762-22.5 10.91-23.5 5.562L1 120c-1-2-1-3-1-4 0-5 3-9 8-10l18.4-9C160.9\n 31.9 283 0 358 0c148 0 188 122 331 122s314-97 326-97c4 0 8 2 10 7l7 21.114\nc1 2.14 1 3.21 1 4.28 0 5.347-3 9.626-7 10.696l-22.3 12.622C852.6 158.372 751\n 181.476 676 181.476c-149 0-189-126.21-332-126.21z",tilde3:"M786 59C457 59 32 175.242 13 175.242c-6 0-10-3.457\n-11-10.37L.15 138c-1-7 3-12 10-13l19.2-6.4C378.4 40.7 634.3 0 804.3 0c337 0\n 411.8 157 746.8 157 328 0 754-112 773-112 5 0 10 3 11 9l1 14.075c1 8.066-.697\n 16.595-6.697 17.492l-21.052 7.31c-367.9 98.146-609.15 122.696-778.15 122.696\n -338 0-409-156.573-744-156.573z",tilde4:"M786 58C457 58 32 177.487 13 177.487c-6 0-10-3.345\n-11-10.035L.15 143c-1-7 3-12 10-13l22-6.7C381.2 35 637.15 0 807.15 0c337 0 409\n 177 744 177 328 0 754-127 773-127 5 0 10 3 11 9l1 14.794c1 7.805-3 13.38-9\n 14.495l-20.7 5.574c-366.85 99.79-607.3 139.372-776.3 139.372-338 0-409\n -175.236-744-175.236z",vec:"M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5\n3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11\n10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63\n-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1\n-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59\nH213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359\nc-16-25.333-24-45-24-59z",widehat1:"M529 0h5l519 115c5 1 9 5 9 10 0 1-1 2-1 3l-4 22\nc-1 5-5 9-11 9h-2L532 67 19 159h-2c-5 0-9-4-11-9l-5-22c-1-6 2-12 8-13z",widehat2:"M1181 0h2l1171 176c6 0 10 5 10 11l-2 23c-1 6-5 10\n-11 10h-1L1182 67 15 220h-1c-6 0-10-4-11-10l-2-23c-1-6 4-11 10-11z",widehat3:"M1181 0h2l1171 236c6 0 10 5 10 11l-2 23c-1 6-5 10\n-11 10h-1L1182 67 15 280h-1c-6 0-10-4-11-10l-2-23c-1-6 4-11 10-11z",widehat4:"M1181 0h2l1171 296c6 0 10 5 10 11l-2 23c-1 6-5 10\n-11 10h-1L1182 67 15 340h-1c-6 0-10-4-11-10l-2-23c-1-6 4-11 10-11z",widecheck1:"M529,159h5l519,-115c5,-1,9,-5,9,-10c0,-1,-1,-2,-1,-3l-4,-22c-1,\n-5,-5,-9,-11,-9h-2l-512,92l-513,-92h-2c-5,0,-9,4,-11,9l-5,22c-1,6,2,12,8,13z",widecheck2:"M1181,220h2l1171,-176c6,0,10,-5,10,-11l-2,-23c-1,-6,-5,-10,\n-11,-10h-1l-1168,153l-1167,-153h-1c-6,0,-10,4,-11,10l-2,23c-1,6,4,11,10,11z",widecheck3:"M1181,280h2l1171,-236c6,0,10,-5,10,-11l-2,-23c-1,-6,-5,-10,\n-11,-10h-1l-1168,213l-1167,-213h-1c-6,0,-10,4,-11,10l-2,23c-1,6,4,11,10,11z",widecheck4:"M1181,340h2l1171,-296c6,0,10,-5,10,-11l-2,-23c-1,-6,-5,-10,\n-11,-10h-1l-1168,273l-1167,-273h-1c-6,0,-10,4,-11,10l-2,23c-1,6,4,11,10,11z",baraboveleftarrow:"M400000 620h-399890l3 -3c68.7 -52.7 113.7 -120 135 -202\nc4 -14.7 6 -23 6 -25c0 -7.3 -7 -11 -21 -11c-8 0 -13.2 0.8 -15.5 2.5\nc-2.3 1.7 -4.2 5.8 -5.5 12.5c-1.3 4.7 -2.7 10.3 -4 17c-12 48.7 -34.8 92 -68.5 130\ns-74.2 66.3 -121.5 85c-10 4 -16 7.7 -18 11c0 8.7 6 14.3 18 17c47.3 18.7 87.8 47\n121.5 85s56.5 81.3 68.5 130c0.7 2 1.3 5 2 9s1.2 6.7 1.5 8c0.3 1.3 1 3.3 2 6\ns2.2 4.5 3.5 5.5c1.3 1 3.3 1.8 6 2.5s6 1 10 1c14 0 21 -3.7 21 -11\nc0 -2 -2 -10.3 -6 -25c-20 -79.3 -65 -146.7 -135 -202l-3 -3h399890z\nM100 620v40h399900v-40z M0 241v40h399900v-40zM0 241v40h399900v-40z",rightarrowabovebar:"M0 241v40h399891c-47.3 35.3-84 78-110 128-16.7 32\n-27.7 63.7-33 95 0 1.3-.2 2.7-.5 4-.3 1.3-.5 2.3-.5 3 0 7.3 6.7 11 20 11 8 0\n13.2-.8 15.5-2.5 2.3-1.7 4.2-5.5 5.5-11.5 2-13.3 5.7-27 11-41 14.7-44.7 39\n-84.5 73-119.5s73.7-60.2 119-75.5c6-2 9-5.7 9-11s-3-9-9-11c-45.3-15.3-85-40.5\n-119-75.5s-58.3-74.8-73-119.5c-4.7-14-8.3-27.3-11-40-1.3-6.7-3.2-10.8-5.5\n-12.5-2.3-1.7-7.5-2.5-15.5-2.5-14 0-21 3.7-21 11 0 2 2 10.3 6 25 20.7 83.3 67\n151.7 139 205zm96 379h399894v40H0zm0 0h399904v40H0z",baraboveshortleftharpoon:"M507,435c-4,4,-6.3,8.7,-7,14c0,5.3,0.7,9,2,11\nc1.3,2,5.3,5.3,12,10c90.7,54,156,130,196,228c3.3,10.7,6.3,16.3,9,17\nc2,0.7,5,1,9,1c0,0,5,0,5,0c10.7,0,16.7,-2,18,-6c2,-2.7,1,-9.7,-3,-21\nc-32,-87.3,-82.7,-157.7,-152,-211c0,0,-3,-3,-3,-3l399351,0l0,-40\nc-398570,0,-399437,0,-399437,0z M593 435 v40 H399500 v-40z\nM0 281 v-40 H399908 v40z M0 281 v-40 H399908 v40z",rightharpoonaboveshortbar:"M0,241 l0,40c399126,0,399993,0,399993,0\nc4.7,-4.7,7,-9.3,7,-14c0,-9.3,-3.7,-15.3,-11,-18c-92.7,-56.7,-159,-133.7,-199,\n-231c-3.3,-9.3,-6,-14.7,-8,-16c-2,-1.3,-7,-2,-15,-2c-10.7,0,-16.7,2,-18,6\nc-2,2.7,-1,9.7,3,21c15.3,42,36.7,81.8,64,119.5c27.3,37.7,58,69.2,92,94.5z\nM0 241 v40 H399908 v-40z M0 475 v-40 H399500 v40z M0 475 v-40 H399500 v40z",shortbaraboveleftharpoon:"M7,435c-4,4,-6.3,8.7,-7,14c0,5.3,0.7,9,2,11\nc1.3,2,5.3,5.3,12,10c90.7,54,156,130,196,228c3.3,10.7,6.3,16.3,9,17c2,0.7,5,1,9,\n1c0,0,5,0,5,0c10.7,0,16.7,-2,18,-6c2,-2.7,1,-9.7,-3,-21c-32,-87.3,-82.7,-157.7,\n-152,-211c0,0,-3,-3,-3,-3l399907,0l0,-40c-399126,0,-399993,0,-399993,0z\nM93 435 v40 H400000 v-40z M500 241 v40 H400000 v-40z M500 241 v40 H400000 v-40z",shortrightharpoonabovebar:"M53,241l0,40c398570,0,399437,0,399437,0\nc4.7,-4.7,7,-9.3,7,-14c0,-9.3,-3.7,-15.3,-11,-18c-92.7,-56.7,-159,-133.7,-199,\n-231c-3.3,-9.3,-6,-14.7,-8,-16c-2,-1.3,-7,-2,-15,-2c-10.7,0,-16.7,2,-18,6\nc-2,2.7,-1,9.7,3,21c15.3,42,36.7,81.8,64,119.5c27.3,37.7,58,69.2,92,94.5z\nM500 241 v40 H399408 v-40z M500 435 v40 H400000 v-40z"};class Jr{constructor(e){this.children=void 0,this.classes=void 0,this.height=void 0,this.depth=void 0,this.maxFontSize=void 0,this.style=void 0,this.children=e,this.classes=[],this.height=0,this.depth=0,this.maxFontSize=0,this.style={}}hasClass(e){return Ir(this.classes,e)}toNode(){for(var e=document.createDocumentFragment(),t=0;t<this.children.length;t++)e.appendChild(this.children[t].toNode());return e}toMarkup(){for(var e="",t=0;t<this.children.length;t++)e+=this.children[t].toMarkup();return e}toText(){return this.children.map((e=>e.toText())).join("")}}var Qr={"AMS-Regular":{32:[0,0,0,0,.25],65:[0,.68889,0,0,.72222],66:[0,.68889,0,0,.66667],67:[0,.68889,0,0,.72222],68:[0,.68889,0,0,.72222],69:[0,.68889,0,0,.66667],70:[0,.68889,0,0,.61111],71:[0,.68889,0,0,.77778],72:[0,.68889,0,0,.77778],73:[0,.68889,0,0,.38889],74:[.16667,.68889,0,0,.5],75:[0,.68889,0,0,.77778],76:[0,.68889,0,0,.66667],77:[0,.68889,0,0,.94445],78:[0,.68889,0,0,.72222],79:[.16667,.68889,0,0,.77778],80:[0,.68889,0,0,.61111],81:[.16667,.68889,0,0,.77778],82:[0,.68889,0,0,.72222],83:[0,.68889,0,0,.55556],84:[0,.68889,0,0,.66667],85:[0,.68889,0,0,.72222],86:[0,.68889,0,0,.72222],87:[0,.68889,0,0,1],88:[0,.68889,0,0,.72222],89:[0,.68889,0,0,.72222],90:[0,.68889,0,0,.66667],107:[0,.68889,0,0,.55556],160:[0,0,0,0,.25],165:[0,.675,.025,0,.75],174:[.15559,.69224,0,0,.94666],240:[0,.68889,0,0,.55556],295:[0,.68889,0,0,.54028],710:[0,.825,0,0,2.33334],732:[0,.9,0,0,2.33334],770:[0,.825,0,0,2.33334],771:[0,.9,0,0,2.33334],989:[.08167,.58167,0,0,.77778],1008:[0,.43056,.04028,0,.66667],8245:[0,.54986,0,0,.275],8463:[0,.68889,0,0,.54028],8487:[0,.68889,0,0,.72222],8498:[0,.68889,0,0,.55556],8502:[0,.68889,0,0,.66667],8503:[0,.68889,0,0,.44445],8504:[0,.68889,0,0,.66667],8513:[0,.68889,0,0,.63889],8592:[-.03598,.46402,0,0,.5],8594:[-.03598,.46402,0,0,.5],8602:[-.13313,.36687,0,0,1],8603:[-.13313,.36687,0,0,1],8606:[.01354,.52239,0,0,1],8608:[.01354,.52239,0,0,1],8610:[.01354,.52239,0,0,1.11111],8611:[.01354,.52239,0,0,1.11111],8619:[0,.54986,0,0,1],8620:[0,.54986,0,0,1],8621:[-.13313,.37788,0,0,1.38889],8622:[-.13313,.36687,0,0,1],8624:[0,.69224,0,0,.5],8625:[0,.69224,0,0,.5],8630:[0,.43056,0,0,1],8631:[0,.43056,0,0,1],8634:[.08198,.58198,0,0,.77778],8635:[.08198,.58198,0,0,.77778],8638:[.19444,.69224,0,0,.41667],8639:[.19444,.69224,0,0,.41667],8642:[.19444,.69224,0,0,.41667],8643:[.19444,.69224,0,0,.41667],8644:[.1808,.675,0,0,1],8646:[.1808,.675,0,0,1],8647:[.1808,.675,0,0,1],8648:[.19444,.69224,0,0,.83334],8649:[.1808,.675,0,0,1],8650:[.19444,.69224,0,0,.83334],8651:[.01354,.52239,0,0,1],8652:[.01354,.52239,0,0,1],8653:[-.13313,.36687,0,0,1],8654:[-.13313,.36687,0,0,1],8655:[-.13313,.36687,0,0,1],8666:[.13667,.63667,0,0,1],8667:[.13667,.63667,0,0,1],8669:[-.13313,.37788,0,0,1],8672:[-.064,.437,0,0,1.334],8674:[-.064,.437,0,0,1.334],8705:[0,.825,0,0,.5],8708:[0,.68889,0,0,.55556],8709:[.08167,.58167,0,0,.77778],8717:[0,.43056,0,0,.42917],8722:[-.03598,.46402,0,0,.5],8724:[.08198,.69224,0,0,.77778],8726:[.08167,.58167,0,0,.77778],8733:[0,.69224,0,0,.77778],8736:[0,.69224,0,0,.72222],8737:[0,.69224,0,0,.72222],8738:[.03517,.52239,0,0,.72222],8739:[.08167,.58167,0,0,.22222],8740:[.25142,.74111,0,0,.27778],8741:[.08167,.58167,0,0,.38889],8742:[.25142,.74111,0,0,.5],8756:[0,.69224,0,0,.66667],8757:[0,.69224,0,0,.66667],8764:[-.13313,.36687,0,0,.77778],8765:[-.13313,.37788,0,0,.77778],8769:[-.13313,.36687,0,0,.77778],8770:[-.03625,.46375,0,0,.77778],8774:[.30274,.79383,0,0,.77778],8776:[-.01688,.48312,0,0,.77778],8778:[.08167,.58167,0,0,.77778],8782:[.06062,.54986,0,0,.77778],8783:[.06062,.54986,0,0,.77778],8785:[.08198,.58198,0,0,.77778],8786:[.08198,.58198,0,0,.77778],8787:[.08198,.58198,0,0,.77778],8790:[0,.69224,0,0,.77778],8791:[.22958,.72958,0,0,.77778],8796:[.08198,.91667,0,0,.77778],8806:[.25583,.75583,0,0,.77778],8807:[.25583,.75583,0,0,.77778],8808:[.25142,.75726,0,0,.77778],8809:[.25142,.75726,0,0,.77778],8812:[.25583,.75583,0,0,.5],8814:[.20576,.70576,0,0,.77778],8815:[.20576,.70576,0,0,.77778],8816:[.30274,.79383,0,0,.77778],8817:[.30274,.79383,0,0,.77778],8818:[.22958,.72958,0,0,.77778],8819:[.22958,.72958,0,0,.77778],8822:[.1808,.675,0,0,.77778],8823:[.1808,.675,0,0,.77778],8828:[.13667,.63667,0,0,.77778],8829:[.13667,.63667,0,0,.77778],8830:[.22958,.72958,0,0,.77778],8831:[.22958,.72958,0,0,.77778],8832:[.20576,.70576,0,0,.77778],8833:[.20576,.70576,0,0,.77778],8840:[.30274,.79383,0,0,.77778],8841:[.30274,.79383,0,0,.77778],8842:[.13597,.63597,0,0,.77778],8843:[.13597,.63597,0,0,.77778],8847:[.03517,.54986,0,0,.77778],8848:[.03517,.54986,0,0,.77778],8858:[.08198,.58198,0,0,.77778],8859:[.08198,.58198,0,0,.77778],8861:[.08198,.58198,0,0,.77778],8862:[0,.675,0,0,.77778],8863:[0,.675,0,0,.77778],8864:[0,.675,0,0,.77778],8865:[0,.675,0,0,.77778],8872:[0,.69224,0,0,.61111],8873:[0,.69224,0,0,.72222],8874:[0,.69224,0,0,.88889],8876:[0,.68889,0,0,.61111],8877:[0,.68889,0,0,.61111],8878:[0,.68889,0,0,.72222],8879:[0,.68889,0,0,.72222],8882:[.03517,.54986,0,0,.77778],8883:[.03517,.54986,0,0,.77778],8884:[.13667,.63667,0,0,.77778],8885:[.13667,.63667,0,0,.77778],8888:[0,.54986,0,0,1.11111],8890:[.19444,.43056,0,0,.55556],8891:[.19444,.69224,0,0,.61111],8892:[.19444,.69224,0,0,.61111],8901:[0,.54986,0,0,.27778],8903:[.08167,.58167,0,0,.77778],8905:[.08167,.58167,0,0,.77778],8906:[.08167,.58167,0,0,.77778],8907:[0,.69224,0,0,.77778],8908:[0,.69224,0,0,.77778],8909:[-.03598,.46402,0,0,.77778],8910:[0,.54986,0,0,.76042],8911:[0,.54986,0,0,.76042],8912:[.03517,.54986,0,0,.77778],8913:[.03517,.54986,0,0,.77778],8914:[0,.54986,0,0,.66667],8915:[0,.54986,0,0,.66667],8916:[0,.69224,0,0,.66667],8918:[.0391,.5391,0,0,.77778],8919:[.0391,.5391,0,0,.77778],8920:[.03517,.54986,0,0,1.33334],8921:[.03517,.54986,0,0,1.33334],8922:[.38569,.88569,0,0,.77778],8923:[.38569,.88569,0,0,.77778],8926:[.13667,.63667,0,0,.77778],8927:[.13667,.63667,0,0,.77778],8928:[.30274,.79383,0,0,.77778],8929:[.30274,.79383,0,0,.77778],8934:[.23222,.74111,0,0,.77778],8935:[.23222,.74111,0,0,.77778],8936:[.23222,.74111,0,0,.77778],8937:[.23222,.74111,0,0,.77778],8938:[.20576,.70576,0,0,.77778],8939:[.20576,.70576,0,0,.77778],8940:[.30274,.79383,0,0,.77778],8941:[.30274,.79383,0,0,.77778],8994:[.19444,.69224,0,0,.77778],8995:[.19444,.69224,0,0,.77778],9416:[.15559,.69224,0,0,.90222],9484:[0,.69224,0,0,.5],9488:[0,.69224,0,0,.5],9492:[0,.37788,0,0,.5],9496:[0,.37788,0,0,.5],9585:[.19444,.68889,0,0,.88889],9586:[.19444,.74111,0,0,.88889],9632:[0,.675,0,0,.77778],9633:[0,.675,0,0,.77778],9650:[0,.54986,0,0,.72222],9651:[0,.54986,0,0,.72222],9654:[.03517,.54986,0,0,.77778],9660:[0,.54986,0,0,.72222],9661:[0,.54986,0,0,.72222],9664:[.03517,.54986,0,0,.77778],9674:[.11111,.69224,0,0,.66667],9733:[.19444,.69224,0,0,.94445],10003:[0,.69224,0,0,.83334],10016:[0,.69224,0,0,.83334],10731:[.11111,.69224,0,0,.66667],10846:[.19444,.75583,0,0,.61111],10877:[.13667,.63667,0,0,.77778],10878:[.13667,.63667,0,0,.77778],10885:[.25583,.75583,0,0,.77778],10886:[.25583,.75583,0,0,.77778],10887:[.13597,.63597,0,0,.77778],10888:[.13597,.63597,0,0,.77778],10889:[.26167,.75726,0,0,.77778],10890:[.26167,.75726,0,0,.77778],10891:[.48256,.98256,0,0,.77778],10892:[.48256,.98256,0,0,.77778],10901:[.13667,.63667,0,0,.77778],10902:[.13667,.63667,0,0,.77778],10933:[.25142,.75726,0,0,.77778],10934:[.25142,.75726,0,0,.77778],10935:[.26167,.75726,0,0,.77778],10936:[.26167,.75726,0,0,.77778],10937:[.26167,.75726,0,0,.77778],10938:[.26167,.75726,0,0,.77778],10949:[.25583,.75583,0,0,.77778],10950:[.25583,.75583,0,0,.77778],10955:[.28481,.79383,0,0,.77778],10956:[.28481,.79383,0,0,.77778],57350:[.08167,.58167,0,0,.22222],57351:[.08167,.58167,0,0,.38889],57352:[.08167,.58167,0,0,.77778],57353:[0,.43056,.04028,0,.66667],57356:[.25142,.75726,0,0,.77778],57357:[.25142,.75726,0,0,.77778],57358:[.41951,.91951,0,0,.77778],57359:[.30274,.79383,0,0,.77778],57360:[.30274,.79383,0,0,.77778],57361:[.41951,.91951,0,0,.77778],57366:[.25142,.75726,0,0,.77778],57367:[.25142,.75726,0,0,.77778],57368:[.25142,.75726,0,0,.77778],57369:[.25142,.75726,0,0,.77778],57370:[.13597,.63597,0,0,.77778],57371:[.13597,.63597,0,0,.77778]},"Caligraphic-Regular":{32:[0,0,0,0,.25],65:[0,.68333,0,.19445,.79847],66:[0,.68333,.03041,.13889,.65681],67:[0,.68333,.05834,.13889,.52653],68:[0,.68333,.02778,.08334,.77139],69:[0,.68333,.08944,.11111,.52778],70:[0,.68333,.09931,.11111,.71875],71:[.09722,.68333,.0593,.11111,.59487],72:[0,.68333,.00965,.11111,.84452],73:[0,.68333,.07382,0,.54452],74:[.09722,.68333,.18472,.16667,.67778],75:[0,.68333,.01445,.05556,.76195],76:[0,.68333,0,.13889,.68972],77:[0,.68333,0,.13889,1.2009],78:[0,.68333,.14736,.08334,.82049],79:[0,.68333,.02778,.11111,.79611],80:[0,.68333,.08222,.08334,.69556],81:[.09722,.68333,0,.11111,.81667],82:[0,.68333,0,.08334,.8475],83:[0,.68333,.075,.13889,.60556],84:[0,.68333,.25417,0,.54464],85:[0,.68333,.09931,.08334,.62583],86:[0,.68333,.08222,0,.61278],87:[0,.68333,.08222,.08334,.98778],88:[0,.68333,.14643,.13889,.7133],89:[.09722,.68333,.08222,.08334,.66834],90:[0,.68333,.07944,.13889,.72473],160:[0,0,0,0,.25]},"Fraktur-Regular":{32:[0,0,0,0,.25],33:[0,.69141,0,0,.29574],34:[0,.69141,0,0,.21471],38:[0,.69141,0,0,.73786],39:[0,.69141,0,0,.21201],40:[.24982,.74947,0,0,.38865],41:[.24982,.74947,0,0,.38865],42:[0,.62119,0,0,.27764],43:[.08319,.58283,0,0,.75623],44:[0,.10803,0,0,.27764],45:[.08319,.58283,0,0,.75623],46:[0,.10803,0,0,.27764],47:[.24982,.74947,0,0,.50181],48:[0,.47534,0,0,.50181],49:[0,.47534,0,0,.50181],50:[0,.47534,0,0,.50181],51:[.18906,.47534,0,0,.50181],52:[.18906,.47534,0,0,.50181],53:[.18906,.47534,0,0,.50181],54:[0,.69141,0,0,.50181],55:[.18906,.47534,0,0,.50181],56:[0,.69141,0,0,.50181],57:[.18906,.47534,0,0,.50181],58:[0,.47534,0,0,.21606],59:[.12604,.47534,0,0,.21606],61:[-.13099,.36866,0,0,.75623],63:[0,.69141,0,0,.36245],65:[0,.69141,0,0,.7176],66:[0,.69141,0,0,.88397],67:[0,.69141,0,0,.61254],68:[0,.69141,0,0,.83158],69:[0,.69141,0,0,.66278],70:[.12604,.69141,0,0,.61119],71:[0,.69141,0,0,.78539],72:[.06302,.69141,0,0,.7203],73:[0,.69141,0,0,.55448],74:[.12604,.69141,0,0,.55231],75:[0,.69141,0,0,.66845],76:[0,.69141,0,0,.66602],77:[0,.69141,0,0,1.04953],78:[0,.69141,0,0,.83212],79:[0,.69141,0,0,.82699],80:[.18906,.69141,0,0,.82753],81:[.03781,.69141,0,0,.82699],82:[0,.69141,0,0,.82807],83:[0,.69141,0,0,.82861],84:[0,.69141,0,0,.66899],85:[0,.69141,0,0,.64576],86:[0,.69141,0,0,.83131],87:[0,.69141,0,0,1.04602],88:[0,.69141,0,0,.71922],89:[.18906,.69141,0,0,.83293],90:[.12604,.69141,0,0,.60201],91:[.24982,.74947,0,0,.27764],93:[.24982,.74947,0,0,.27764],94:[0,.69141,0,0,.49965],97:[0,.47534,0,0,.50046],98:[0,.69141,0,0,.51315],99:[0,.47534,0,0,.38946],100:[0,.62119,0,0,.49857],101:[0,.47534,0,0,.40053],102:[.18906,.69141,0,0,.32626],103:[.18906,.47534,0,0,.5037],104:[.18906,.69141,0,0,.52126],105:[0,.69141,0,0,.27899],106:[0,.69141,0,0,.28088],107:[0,.69141,0,0,.38946],108:[0,.69141,0,0,.27953],109:[0,.47534,0,0,.76676],110:[0,.47534,0,0,.52666],111:[0,.47534,0,0,.48885],112:[.18906,.52396,0,0,.50046],113:[.18906,.47534,0,0,.48912],114:[0,.47534,0,0,.38919],115:[0,.47534,0,0,.44266],116:[0,.62119,0,0,.33301],117:[0,.47534,0,0,.5172],118:[0,.52396,0,0,.5118],119:[0,.52396,0,0,.77351],120:[.18906,.47534,0,0,.38865],121:[.18906,.47534,0,0,.49884],122:[.18906,.47534,0,0,.39054],160:[0,0,0,0,.25],8216:[0,.69141,0,0,.21471],8217:[0,.69141,0,0,.21471],58112:[0,.62119,0,0,.49749],58113:[0,.62119,0,0,.4983],58114:[.18906,.69141,0,0,.33328],58115:[.18906,.69141,0,0,.32923],58116:[.18906,.47534,0,0,.50343],58117:[0,.69141,0,0,.33301],58118:[0,.62119,0,0,.33409],58119:[0,.47534,0,0,.50073]},"Main-Bold":{32:[0,0,0,0,.25],33:[0,.69444,0,0,.35],34:[0,.69444,0,0,.60278],35:[.19444,.69444,0,0,.95833],36:[.05556,.75,0,0,.575],37:[.05556,.75,0,0,.95833],38:[0,.69444,0,0,.89444],39:[0,.69444,0,0,.31944],40:[.25,.75,0,0,.44722],41:[.25,.75,0,0,.44722],42:[0,.75,0,0,.575],43:[.13333,.63333,0,0,.89444],44:[.19444,.15556,0,0,.31944],45:[0,.44444,0,0,.38333],46:[0,.15556,0,0,.31944],47:[.25,.75,0,0,.575],48:[0,.64444,0,0,.575],49:[0,.64444,0,0,.575],50:[0,.64444,0,0,.575],51:[0,.64444,0,0,.575],52:[0,.64444,0,0,.575],53:[0,.64444,0,0,.575],54:[0,.64444,0,0,.575],55:[0,.64444,0,0,.575],56:[0,.64444,0,0,.575],57:[0,.64444,0,0,.575],58:[0,.44444,0,0,.31944],59:[.19444,.44444,0,0,.31944],60:[.08556,.58556,0,0,.89444],61:[-.10889,.39111,0,0,.89444],62:[.08556,.58556,0,0,.89444],63:[0,.69444,0,0,.54305],64:[0,.69444,0,0,.89444],65:[0,.68611,0,0,.86944],66:[0,.68611,0,0,.81805],67:[0,.68611,0,0,.83055],68:[0,.68611,0,0,.88194],69:[0,.68611,0,0,.75555],70:[0,.68611,0,0,.72361],71:[0,.68611,0,0,.90416],72:[0,.68611,0,0,.9],73:[0,.68611,0,0,.43611],74:[0,.68611,0,0,.59444],75:[0,.68611,0,0,.90138],76:[0,.68611,0,0,.69166],77:[0,.68611,0,0,1.09166],78:[0,.68611,0,0,.9],79:[0,.68611,0,0,.86388],80:[0,.68611,0,0,.78611],81:[.19444,.68611,0,0,.86388],82:[0,.68611,0,0,.8625],83:[0,.68611,0,0,.63889],84:[0,.68611,0,0,.8],85:[0,.68611,0,0,.88472],86:[0,.68611,.01597,0,.86944],87:[0,.68611,.01597,0,1.18888],88:[0,.68611,0,0,.86944],89:[0,.68611,.02875,0,.86944],90:[0,.68611,0,0,.70277],91:[.25,.75,0,0,.31944],92:[.25,.75,0,0,.575],93:[.25,.75,0,0,.31944],94:[0,.69444,0,0,.575],95:[.31,.13444,.03194,0,.575],97:[0,.44444,0,0,.55902],98:[0,.69444,0,0,.63889],99:[0,.44444,0,0,.51111],100:[0,.69444,0,0,.63889],101:[0,.44444,0,0,.52708],102:[0,.69444,.10903,0,.35139],103:[.19444,.44444,.01597,0,.575],104:[0,.69444,0,0,.63889],105:[0,.69444,0,0,.31944],106:[.19444,.69444,0,0,.35139],107:[0,.69444,0,0,.60694],108:[0,.69444,0,0,.31944],109:[0,.44444,0,0,.95833],110:[0,.44444,0,0,.63889],111:[0,.44444,0,0,.575],112:[.19444,.44444,0,0,.63889],113:[.19444,.44444,0,0,.60694],114:[0,.44444,0,0,.47361],115:[0,.44444,0,0,.45361],116:[0,.63492,0,0,.44722],117:[0,.44444,0,0,.63889],118:[0,.44444,.01597,0,.60694],119:[0,.44444,.01597,0,.83055],120:[0,.44444,0,0,.60694],121:[.19444,.44444,.01597,0,.60694],122:[0,.44444,0,0,.51111],123:[.25,.75,0,0,.575],124:[.25,.75,0,0,.31944],125:[.25,.75,0,0,.575],126:[.35,.34444,0,0,.575],160:[0,0,0,0,.25],163:[0,.69444,0,0,.86853],168:[0,.69444,0,0,.575],172:[0,.44444,0,0,.76666],176:[0,.69444,0,0,.86944],177:[.13333,.63333,0,0,.89444],184:[.17014,0,0,0,.51111],198:[0,.68611,0,0,1.04166],215:[.13333,.63333,0,0,.89444],216:[.04861,.73472,0,0,.89444],223:[0,.69444,0,0,.59722],230:[0,.44444,0,0,.83055],247:[.13333,.63333,0,0,.89444],248:[.09722,.54167,0,0,.575],305:[0,.44444,0,0,.31944],338:[0,.68611,0,0,1.16944],339:[0,.44444,0,0,.89444],567:[.19444,.44444,0,0,.35139],710:[0,.69444,0,0,.575],711:[0,.63194,0,0,.575],713:[0,.59611,0,0,.575],714:[0,.69444,0,0,.575],715:[0,.69444,0,0,.575],728:[0,.69444,0,0,.575],729:[0,.69444,0,0,.31944],730:[0,.69444,0,0,.86944],732:[0,.69444,0,0,.575],733:[0,.69444,0,0,.575],915:[0,.68611,0,0,.69166],916:[0,.68611,0,0,.95833],920:[0,.68611,0,0,.89444],923:[0,.68611,0,0,.80555],926:[0,.68611,0,0,.76666],928:[0,.68611,0,0,.9],931:[0,.68611,0,0,.83055],933:[0,.68611,0,0,.89444],934:[0,.68611,0,0,.83055],936:[0,.68611,0,0,.89444],937:[0,.68611,0,0,.83055],8211:[0,.44444,.03194,0,.575],8212:[0,.44444,.03194,0,1.14999],8216:[0,.69444,0,0,.31944],8217:[0,.69444,0,0,.31944],8220:[0,.69444,0,0,.60278],8221:[0,.69444,0,0,.60278],8224:[.19444,.69444,0,0,.51111],8225:[.19444,.69444,0,0,.51111],8242:[0,.55556,0,0,.34444],8407:[0,.72444,.15486,0,.575],8463:[0,.69444,0,0,.66759],8465:[0,.69444,0,0,.83055],8467:[0,.69444,0,0,.47361],8472:[.19444,.44444,0,0,.74027],8476:[0,.69444,0,0,.83055],8501:[0,.69444,0,0,.70277],8592:[-.10889,.39111,0,0,1.14999],8593:[.19444,.69444,0,0,.575],8594:[-.10889,.39111,0,0,1.14999],8595:[.19444,.69444,0,0,.575],8596:[-.10889,.39111,0,0,1.14999],8597:[.25,.75,0,0,.575],8598:[.19444,.69444,0,0,1.14999],8599:[.19444,.69444,0,0,1.14999],8600:[.19444,.69444,0,0,1.14999],8601:[.19444,.69444,0,0,1.14999],8636:[-.10889,.39111,0,0,1.14999],8637:[-.10889,.39111,0,0,1.14999],8640:[-.10889,.39111,0,0,1.14999],8641:[-.10889,.39111,0,0,1.14999],8656:[-.10889,.39111,0,0,1.14999],8657:[.19444,.69444,0,0,.70277],8658:[-.10889,.39111,0,0,1.14999],8659:[.19444,.69444,0,0,.70277],8660:[-.10889,.39111,0,0,1.14999],8661:[.25,.75,0,0,.70277],8704:[0,.69444,0,0,.63889],8706:[0,.69444,.06389,0,.62847],8707:[0,.69444,0,0,.63889],8709:[.05556,.75,0,0,.575],8711:[0,.68611,0,0,.95833],8712:[.08556,.58556,0,0,.76666],8715:[.08556,.58556,0,0,.76666],8722:[.13333,.63333,0,0,.89444],8723:[.13333,.63333,0,0,.89444],8725:[.25,.75,0,0,.575],8726:[.25,.75,0,0,.575],8727:[-.02778,.47222,0,0,.575],8728:[-.02639,.47361,0,0,.575],8729:[-.02639,.47361,0,0,.575],8730:[.18,.82,0,0,.95833],8733:[0,.44444,0,0,.89444],8734:[0,.44444,0,0,1.14999],8736:[0,.69224,0,0,.72222],8739:[.25,.75,0,0,.31944],8741:[.25,.75,0,0,.575],8743:[0,.55556,0,0,.76666],8744:[0,.55556,0,0,.76666],8745:[0,.55556,0,0,.76666],8746:[0,.55556,0,0,.76666],8747:[.19444,.69444,.12778,0,.56875],8764:[-.10889,.39111,0,0,.89444],8768:[.19444,.69444,0,0,.31944],8771:[.00222,.50222,0,0,.89444],8773:[.027,.638,0,0,.894],8776:[.02444,.52444,0,0,.89444],8781:[.00222,.50222,0,0,.89444],8801:[.00222,.50222,0,0,.89444],8804:[.19667,.69667,0,0,.89444],8805:[.19667,.69667,0,0,.89444],8810:[.08556,.58556,0,0,1.14999],8811:[.08556,.58556,0,0,1.14999],8826:[.08556,.58556,0,0,.89444],8827:[.08556,.58556,0,0,.89444],8834:[.08556,.58556,0,0,.89444],8835:[.08556,.58556,0,0,.89444],8838:[.19667,.69667,0,0,.89444],8839:[.19667,.69667,0,0,.89444],8846:[0,.55556,0,0,.76666],8849:[.19667,.69667,0,0,.89444],8850:[.19667,.69667,0,0,.89444],8851:[0,.55556,0,0,.76666],8852:[0,.55556,0,0,.76666],8853:[.13333,.63333,0,0,.89444],8854:[.13333,.63333,0,0,.89444],8855:[.13333,.63333,0,0,.89444],8856:[.13333,.63333,0,0,.89444],8857:[.13333,.63333,0,0,.89444],8866:[0,.69444,0,0,.70277],8867:[0,.69444,0,0,.70277],8868:[0,.69444,0,0,.89444],8869:[0,.69444,0,0,.89444],8900:[-.02639,.47361,0,0,.575],8901:[-.02639,.47361,0,0,.31944],8902:[-.02778,.47222,0,0,.575],8968:[.25,.75,0,0,.51111],8969:[.25,.75,0,0,.51111],8970:[.25,.75,0,0,.51111],8971:[.25,.75,0,0,.51111],8994:[-.13889,.36111,0,0,1.14999],8995:[-.13889,.36111,0,0,1.14999],9651:[.19444,.69444,0,0,1.02222],9657:[-.02778,.47222,0,0,.575],9661:[.19444,.69444,0,0,1.02222],9667:[-.02778,.47222,0,0,.575],9711:[.19444,.69444,0,0,1.14999],9824:[.12963,.69444,0,0,.89444],9825:[.12963,.69444,0,0,.89444],9826:[.12963,.69444,0,0,.89444],9827:[.12963,.69444,0,0,.89444],9837:[0,.75,0,0,.44722],9838:[.19444,.69444,0,0,.44722],9839:[.19444,.69444,0,0,.44722],10216:[.25,.75,0,0,.44722],10217:[.25,.75,0,0,.44722],10815:[0,.68611,0,0,.9],10927:[.19667,.69667,0,0,.89444],10928:[.19667,.69667,0,0,.89444],57376:[.19444,.69444,0,0,0]},"Main-BoldItalic":{32:[0,0,0,0,.25],33:[0,.69444,.11417,0,.38611],34:[0,.69444,.07939,0,.62055],35:[.19444,.69444,.06833,0,.94444],37:[.05556,.75,.12861,0,.94444],38:[0,.69444,.08528,0,.88555],39:[0,.69444,.12945,0,.35555],40:[.25,.75,.15806,0,.47333],41:[.25,.75,.03306,0,.47333],42:[0,.75,.14333,0,.59111],43:[.10333,.60333,.03306,0,.88555],44:[.19444,.14722,0,0,.35555],45:[0,.44444,.02611,0,.41444],46:[0,.14722,0,0,.35555],47:[.25,.75,.15806,0,.59111],48:[0,.64444,.13167,0,.59111],49:[0,.64444,.13167,0,.59111],50:[0,.64444,.13167,0,.59111],51:[0,.64444,.13167,0,.59111],52:[.19444,.64444,.13167,0,.59111],53:[0,.64444,.13167,0,.59111],54:[0,.64444,.13167,0,.59111],55:[.19444,.64444,.13167,0,.59111],56:[0,.64444,.13167,0,.59111],57:[0,.64444,.13167,0,.59111],58:[0,.44444,.06695,0,.35555],59:[.19444,.44444,.06695,0,.35555],61:[-.10889,.39111,.06833,0,.88555],63:[0,.69444,.11472,0,.59111],64:[0,.69444,.09208,0,.88555],65:[0,.68611,0,0,.86555],66:[0,.68611,.0992,0,.81666],67:[0,.68611,.14208,0,.82666],68:[0,.68611,.09062,0,.87555],69:[0,.68611,.11431,0,.75666],70:[0,.68611,.12903,0,.72722],71:[0,.68611,.07347,0,.89527],72:[0,.68611,.17208,0,.8961],73:[0,.68611,.15681,0,.47166],74:[0,.68611,.145,0,.61055],75:[0,.68611,.14208,0,.89499],76:[0,.68611,0,0,.69777],77:[0,.68611,.17208,0,1.07277],78:[0,.68611,.17208,0,.8961],79:[0,.68611,.09062,0,.85499],80:[0,.68611,.0992,0,.78721],81:[.19444,.68611,.09062,0,.85499],82:[0,.68611,.02559,0,.85944],83:[0,.68611,.11264,0,.64999],84:[0,.68611,.12903,0,.7961],85:[0,.68611,.17208,0,.88083],86:[0,.68611,.18625,0,.86555],87:[0,.68611,.18625,0,1.15999],88:[0,.68611,.15681,0,.86555],89:[0,.68611,.19803,0,.86555],90:[0,.68611,.14208,0,.70888],91:[.25,.75,.1875,0,.35611],93:[.25,.75,.09972,0,.35611],94:[0,.69444,.06709,0,.59111],95:[.31,.13444,.09811,0,.59111],97:[0,.44444,.09426,0,.59111],98:[0,.69444,.07861,0,.53222],99:[0,.44444,.05222,0,.53222],100:[0,.69444,.10861,0,.59111],101:[0,.44444,.085,0,.53222],102:[.19444,.69444,.21778,0,.4],103:[.19444,.44444,.105,0,.53222],104:[0,.69444,.09426,0,.59111],105:[0,.69326,.11387,0,.35555],106:[.19444,.69326,.1672,0,.35555],107:[0,.69444,.11111,0,.53222],108:[0,.69444,.10861,0,.29666],109:[0,.44444,.09426,0,.94444],110:[0,.44444,.09426,0,.64999],111:[0,.44444,.07861,0,.59111],112:[.19444,.44444,.07861,0,.59111],113:[.19444,.44444,.105,0,.53222],114:[0,.44444,.11111,0,.50167],115:[0,.44444,.08167,0,.48694],116:[0,.63492,.09639,0,.385],117:[0,.44444,.09426,0,.62055],118:[0,.44444,.11111,0,.53222],119:[0,.44444,.11111,0,.76777],120:[0,.44444,.12583,0,.56055],121:[.19444,.44444,.105,0,.56166],122:[0,.44444,.13889,0,.49055],126:[.35,.34444,.11472,0,.59111],160:[0,0,0,0,.25],168:[0,.69444,.11473,0,.59111],176:[0,.69444,0,0,.94888],184:[.17014,0,0,0,.53222],198:[0,.68611,.11431,0,1.02277],216:[.04861,.73472,.09062,0,.88555],223:[.19444,.69444,.09736,0,.665],230:[0,.44444,.085,0,.82666],248:[.09722,.54167,.09458,0,.59111],305:[0,.44444,.09426,0,.35555],338:[0,.68611,.11431,0,1.14054],339:[0,.44444,.085,0,.82666],567:[.19444,.44444,.04611,0,.385],710:[0,.69444,.06709,0,.59111],711:[0,.63194,.08271,0,.59111],713:[0,.59444,.10444,0,.59111],714:[0,.69444,.08528,0,.59111],715:[0,.69444,0,0,.59111],728:[0,.69444,.10333,0,.59111],729:[0,.69444,.12945,0,.35555],730:[0,.69444,0,0,.94888],732:[0,.69444,.11472,0,.59111],733:[0,.69444,.11472,0,.59111],915:[0,.68611,.12903,0,.69777],916:[0,.68611,0,0,.94444],920:[0,.68611,.09062,0,.88555],923:[0,.68611,0,0,.80666],926:[0,.68611,.15092,0,.76777],928:[0,.68611,.17208,0,.8961],931:[0,.68611,.11431,0,.82666],933:[0,.68611,.10778,0,.88555],934:[0,.68611,.05632,0,.82666],936:[0,.68611,.10778,0,.88555],937:[0,.68611,.0992,0,.82666],8211:[0,.44444,.09811,0,.59111],8212:[0,.44444,.09811,0,1.18221],8216:[0,.69444,.12945,0,.35555],8217:[0,.69444,.12945,0,.35555],8220:[0,.69444,.16772,0,.62055],8221:[0,.69444,.07939,0,.62055]},"Main-Italic":{32:[0,0,0,0,.25],33:[0,.69444,.12417,0,.30667],34:[0,.69444,.06961,0,.51444],35:[.19444,.69444,.06616,0,.81777],37:[.05556,.75,.13639,0,.81777],38:[0,.69444,.09694,0,.76666],39:[0,.69444,.12417,0,.30667],40:[.25,.75,.16194,0,.40889],41:[.25,.75,.03694,0,.40889],42:[0,.75,.14917,0,.51111],43:[.05667,.56167,.03694,0,.76666],44:[.19444,.10556,0,0,.30667],45:[0,.43056,.02826,0,.35778],46:[0,.10556,0,0,.30667],47:[.25,.75,.16194,0,.51111],48:[0,.64444,.13556,0,.51111],49:[0,.64444,.13556,0,.51111],50:[0,.64444,.13556,0,.51111],51:[0,.64444,.13556,0,.51111],52:[.19444,.64444,.13556,0,.51111],53:[0,.64444,.13556,0,.51111],54:[0,.64444,.13556,0,.51111],55:[.19444,.64444,.13556,0,.51111],56:[0,.64444,.13556,0,.51111],57:[0,.64444,.13556,0,.51111],58:[0,.43056,.0582,0,.30667],59:[.19444,.43056,.0582,0,.30667],61:[-.13313,.36687,.06616,0,.76666],63:[0,.69444,.1225,0,.51111],64:[0,.69444,.09597,0,.76666],65:[0,.68333,0,0,.74333],66:[0,.68333,.10257,0,.70389],67:[0,.68333,.14528,0,.71555],68:[0,.68333,.09403,0,.755],69:[0,.68333,.12028,0,.67833],70:[0,.68333,.13305,0,.65277],71:[0,.68333,.08722,0,.77361],72:[0,.68333,.16389,0,.74333],73:[0,.68333,.15806,0,.38555],74:[0,.68333,.14028,0,.525],75:[0,.68333,.14528,0,.76888],76:[0,.68333,0,0,.62722],77:[0,.68333,.16389,0,.89666],78:[0,.68333,.16389,0,.74333],79:[0,.68333,.09403,0,.76666],80:[0,.68333,.10257,0,.67833],81:[.19444,.68333,.09403,0,.76666],82:[0,.68333,.03868,0,.72944],83:[0,.68333,.11972,0,.56222],84:[0,.68333,.13305,0,.71555],85:[0,.68333,.16389,0,.74333],86:[0,.68333,.18361,0,.74333],87:[0,.68333,.18361,0,.99888],88:[0,.68333,.15806,0,.74333],89:[0,.68333,.19383,0,.74333],90:[0,.68333,.14528,0,.61333],91:[.25,.75,.1875,0,.30667],93:[.25,.75,.10528,0,.30667],94:[0,.69444,.06646,0,.51111],95:[.31,.12056,.09208,0,.51111],97:[0,.43056,.07671,0,.51111],98:[0,.69444,.06312,0,.46],99:[0,.43056,.05653,0,.46],100:[0,.69444,.10333,0,.51111],101:[0,.43056,.07514,0,.46],102:[.19444,.69444,.21194,0,.30667],103:[.19444,.43056,.08847,0,.46],104:[0,.69444,.07671,0,.51111],105:[0,.65536,.1019,0,.30667],106:[.19444,.65536,.14467,0,.30667],107:[0,.69444,.10764,0,.46],108:[0,.69444,.10333,0,.25555],109:[0,.43056,.07671,0,.81777],110:[0,.43056,.07671,0,.56222],111:[0,.43056,.06312,0,.51111],112:[.19444,.43056,.06312,0,.51111],113:[.19444,.43056,.08847,0,.46],114:[0,.43056,.10764,0,.42166],115:[0,.43056,.08208,0,.40889],116:[0,.61508,.09486,0,.33222],117:[0,.43056,.07671,0,.53666],118:[0,.43056,.10764,0,.46],119:[0,.43056,.10764,0,.66444],120:[0,.43056,.12042,0,.46389],121:[.19444,.43056,.08847,0,.48555],122:[0,.43056,.12292,0,.40889],126:[.35,.31786,.11585,0,.51111],160:[0,0,0,0,.25],168:[0,.66786,.10474,0,.51111],176:[0,.69444,0,0,.83129],184:[.17014,0,0,0,.46],198:[0,.68333,.12028,0,.88277],216:[.04861,.73194,.09403,0,.76666],223:[.19444,.69444,.10514,0,.53666],230:[0,.43056,.07514,0,.71555],248:[.09722,.52778,.09194,0,.51111],338:[0,.68333,.12028,0,.98499],339:[0,.43056,.07514,0,.71555],710:[0,.69444,.06646,0,.51111],711:[0,.62847,.08295,0,.51111],713:[0,.56167,.10333,0,.51111],714:[0,.69444,.09694,0,.51111],715:[0,.69444,0,0,.51111],728:[0,.69444,.10806,0,.51111],729:[0,.66786,.11752,0,.30667],730:[0,.69444,0,0,.83129],732:[0,.66786,.11585,0,.51111],733:[0,.69444,.1225,0,.51111],915:[0,.68333,.13305,0,.62722],916:[0,.68333,0,0,.81777],920:[0,.68333,.09403,0,.76666],923:[0,.68333,0,0,.69222],926:[0,.68333,.15294,0,.66444],928:[0,.68333,.16389,0,.74333],931:[0,.68333,.12028,0,.71555],933:[0,.68333,.11111,0,.76666],934:[0,.68333,.05986,0,.71555],936:[0,.68333,.11111,0,.76666],937:[0,.68333,.10257,0,.71555],8211:[0,.43056,.09208,0,.51111],8212:[0,.43056,.09208,0,1.02222],8216:[0,.69444,.12417,0,.30667],8217:[0,.69444,.12417,0,.30667],8220:[0,.69444,.1685,0,.51444],8221:[0,.69444,.06961,0,.51444],8463:[0,.68889,0,0,.54028]},"Main-Regular":{32:[0,0,0,0,.25],33:[0,.69444,0,0,.27778],34:[0,.69444,0,0,.5],35:[.19444,.69444,0,0,.83334],36:[.05556,.75,0,0,.5],37:[.05556,.75,0,0,.83334],38:[0,.69444,0,0,.77778],39:[0,.69444,0,0,.27778],40:[.25,.75,0,0,.38889],41:[.25,.75,0,0,.38889],42:[0,.75,0,0,.5],43:[.08333,.58333,0,0,.77778],44:[.19444,.10556,0,0,.27778],45:[0,.43056,0,0,.33333],46:[0,.10556,0,0,.27778],47:[.25,.75,0,0,.5],48:[0,.64444,0,0,.5],49:[0,.64444,0,0,.5],50:[0,.64444,0,0,.5],51:[0,.64444,0,0,.5],52:[0,.64444,0,0,.5],53:[0,.64444,0,0,.5],54:[0,.64444,0,0,.5],55:[0,.64444,0,0,.5],56:[0,.64444,0,0,.5],57:[0,.64444,0,0,.5],58:[0,.43056,0,0,.27778],59:[.19444,.43056,0,0,.27778],60:[.0391,.5391,0,0,.77778],61:[-.13313,.36687,0,0,.77778],62:[.0391,.5391,0,0,.77778],63:[0,.69444,0,0,.47222],64:[0,.69444,0,0,.77778],65:[0,.68333,0,0,.75],66:[0,.68333,0,0,.70834],67:[0,.68333,0,0,.72222],68:[0,.68333,0,0,.76389],69:[0,.68333,0,0,.68056],70:[0,.68333,0,0,.65278],71:[0,.68333,0,0,.78472],72:[0,.68333,0,0,.75],73:[0,.68333,0,0,.36111],74:[0,.68333,0,0,.51389],75:[0,.68333,0,0,.77778],76:[0,.68333,0,0,.625],77:[0,.68333,0,0,.91667],78:[0,.68333,0,0,.75],79:[0,.68333,0,0,.77778],80:[0,.68333,0,0,.68056],81:[.19444,.68333,0,0,.77778],82:[0,.68333,0,0,.73611],83:[0,.68333,0,0,.55556],84:[0,.68333,0,0,.72222],85:[0,.68333,0,0,.75],86:[0,.68333,.01389,0,.75],87:[0,.68333,.01389,0,1.02778],88:[0,.68333,0,0,.75],89:[0,.68333,.025,0,.75],90:[0,.68333,0,0,.61111],91:[.25,.75,0,0,.27778],92:[.25,.75,0,0,.5],93:[.25,.75,0,0,.27778],94:[0,.69444,0,0,.5],95:[.31,.12056,.02778,0,.5],97:[0,.43056,0,0,.5],98:[0,.69444,0,0,.55556],99:[0,.43056,0,0,.44445],100:[0,.69444,0,0,.55556],101:[0,.43056,0,0,.44445],102:[0,.69444,.07778,0,.30556],103:[.19444,.43056,.01389,0,.5],104:[0,.69444,0,0,.55556],105:[0,.66786,0,0,.27778],106:[.19444,.66786,0,0,.30556],107:[0,.69444,0,0,.52778],108:[0,.69444,0,0,.27778],109:[0,.43056,0,0,.83334],110:[0,.43056,0,0,.55556],111:[0,.43056,0,0,.5],112:[.19444,.43056,0,0,.55556],113:[.19444,.43056,0,0,.52778],114:[0,.43056,0,0,.39167],115:[0,.43056,0,0,.39445],116:[0,.61508,0,0,.38889],117:[0,.43056,0,0,.55556],118:[0,.43056,.01389,0,.52778],119:[0,.43056,.01389,0,.72222],120:[0,.43056,0,0,.52778],121:[.19444,.43056,.01389,0,.52778],122:[0,.43056,0,0,.44445],123:[.25,.75,0,0,.5],124:[.25,.75,0,0,.27778],125:[.25,.75,0,0,.5],126:[.35,.31786,0,0,.5],160:[0,0,0,0,.25],163:[0,.69444,0,0,.76909],167:[.19444,.69444,0,0,.44445],168:[0,.66786,0,0,.5],172:[0,.43056,0,0,.66667],176:[0,.69444,0,0,.75],177:[.08333,.58333,0,0,.77778],182:[.19444,.69444,0,0,.61111],184:[.17014,0,0,0,.44445],198:[0,.68333,0,0,.90278],215:[.08333,.58333,0,0,.77778],216:[.04861,.73194,0,0,.77778],223:[0,.69444,0,0,.5],230:[0,.43056,0,0,.72222],247:[.08333,.58333,0,0,.77778],248:[.09722,.52778,0,0,.5],305:[0,.43056,0,0,.27778],338:[0,.68333,0,0,1.01389],339:[0,.43056,0,0,.77778],567:[.19444,.43056,0,0,.30556],710:[0,.69444,0,0,.5],711:[0,.62847,0,0,.5],713:[0,.56778,0,0,.5],714:[0,.69444,0,0,.5],715:[0,.69444,0,0,.5],728:[0,.69444,0,0,.5],729:[0,.66786,0,0,.27778],730:[0,.69444,0,0,.75],732:[0,.66786,0,0,.5],733:[0,.69444,0,0,.5],915:[0,.68333,0,0,.625],916:[0,.68333,0,0,.83334],920:[0,.68333,0,0,.77778],923:[0,.68333,0,0,.69445],926:[0,.68333,0,0,.66667],928:[0,.68333,0,0,.75],931:[0,.68333,0,0,.72222],933:[0,.68333,0,0,.77778],934:[0,.68333,0,0,.72222],936:[0,.68333,0,0,.77778],937:[0,.68333,0,0,.72222],8211:[0,.43056,.02778,0,.5],8212:[0,.43056,.02778,0,1],8216:[0,.69444,0,0,.27778],8217:[0,.69444,0,0,.27778],8220:[0,.69444,0,0,.5],8221:[0,.69444,0,0,.5],8224:[.19444,.69444,0,0,.44445],8225:[.19444,.69444,0,0,.44445],8230:[0,.123,0,0,1.172],8242:[0,.55556,0,0,.275],8407:[0,.71444,.15382,0,.5],8463:[0,.68889,0,0,.54028],8465:[0,.69444,0,0,.72222],8467:[0,.69444,0,.11111,.41667],8472:[.19444,.43056,0,.11111,.63646],8476:[0,.69444,0,0,.72222],8501:[0,.69444,0,0,.61111],8592:[-.13313,.36687,0,0,1],8593:[.19444,.69444,0,0,.5],8594:[-.13313,.36687,0,0,1],8595:[.19444,.69444,0,0,.5],8596:[-.13313,.36687,0,0,1],8597:[.25,.75,0,0,.5],8598:[.19444,.69444,0,0,1],8599:[.19444,.69444,0,0,1],8600:[.19444,.69444,0,0,1],8601:[.19444,.69444,0,0,1],8614:[.011,.511,0,0,1],8617:[.011,.511,0,0,1.126],8618:[.011,.511,0,0,1.126],8636:[-.13313,.36687,0,0,1],8637:[-.13313,.36687,0,0,1],8640:[-.13313,.36687,0,0,1],8641:[-.13313,.36687,0,0,1],8652:[.011,.671,0,0,1],8656:[-.13313,.36687,0,0,1],8657:[.19444,.69444,0,0,.61111],8658:[-.13313,.36687,0,0,1],8659:[.19444,.69444,0,0,.61111],8660:[-.13313,.36687,0,0,1],8661:[.25,.75,0,0,.61111],8704:[0,.69444,0,0,.55556],8706:[0,.69444,.05556,.08334,.5309],8707:[0,.69444,0,0,.55556],8709:[.05556,.75,0,0,.5],8711:[0,.68333,0,0,.83334],8712:[.0391,.5391,0,0,.66667],8715:[.0391,.5391,0,0,.66667],8722:[.08333,.58333,0,0,.77778],8723:[.08333,.58333,0,0,.77778],8725:[.25,.75,0,0,.5],8726:[.25,.75,0,0,.5],8727:[-.03472,.46528,0,0,.5],8728:[-.05555,.44445,0,0,.5],8729:[-.05555,.44445,0,0,.5],8730:[.2,.8,0,0,.83334],8733:[0,.43056,0,0,.77778],8734:[0,.43056,0,0,1],8736:[0,.69224,0,0,.72222],8739:[.25,.75,0,0,.27778],8741:[.25,.75,0,0,.5],8743:[0,.55556,0,0,.66667],8744:[0,.55556,0,0,.66667],8745:[0,.55556,0,0,.66667],8746:[0,.55556,0,0,.66667],8747:[.19444,.69444,.11111,0,.41667],8764:[-.13313,.36687,0,0,.77778],8768:[.19444,.69444,0,0,.27778],8771:[-.03625,.46375,0,0,.77778],8773:[-.022,.589,0,0,.778],8776:[-.01688,.48312,0,0,.77778],8781:[-.03625,.46375,0,0,.77778],8784:[-.133,.673,0,0,.778],8801:[-.03625,.46375,0,0,.77778],8804:[.13597,.63597,0,0,.77778],8805:[.13597,.63597,0,0,.77778],8810:[.0391,.5391,0,0,1],8811:[.0391,.5391,0,0,1],8826:[.0391,.5391,0,0,.77778],8827:[.0391,.5391,0,0,.77778],8834:[.0391,.5391,0,0,.77778],8835:[.0391,.5391,0,0,.77778],8838:[.13597,.63597,0,0,.77778],8839:[.13597,.63597,0,0,.77778],8846:[0,.55556,0,0,.66667],8849:[.13597,.63597,0,0,.77778],8850:[.13597,.63597,0,0,.77778],8851:[0,.55556,0,0,.66667],8852:[0,.55556,0,0,.66667],8853:[.08333,.58333,0,0,.77778],8854:[.08333,.58333,0,0,.77778],8855:[.08333,.58333,0,0,.77778],8856:[.08333,.58333,0,0,.77778],8857:[.08333,.58333,0,0,.77778],8866:[0,.69444,0,0,.61111],8867:[0,.69444,0,0,.61111],8868:[0,.69444,0,0,.77778],8869:[0,.69444,0,0,.77778],8872:[.249,.75,0,0,.867],8900:[-.05555,.44445,0,0,.5],8901:[-.05555,.44445,0,0,.27778],8902:[-.03472,.46528,0,0,.5],8904:[.005,.505,0,0,.9],8942:[.03,.903,0,0,.278],8943:[-.19,.313,0,0,1.172],8945:[-.1,.823,0,0,1.282],8968:[.25,.75,0,0,.44445],8969:[.25,.75,0,0,.44445],8970:[.25,.75,0,0,.44445],8971:[.25,.75,0,0,.44445],8994:[-.14236,.35764,0,0,1],8995:[-.14236,.35764,0,0,1],9136:[.244,.744,0,0,.412],9137:[.244,.745,0,0,.412],9651:[.19444,.69444,0,0,.88889],9657:[-.03472,.46528,0,0,.5],9661:[.19444,.69444,0,0,.88889],9667:[-.03472,.46528,0,0,.5],9711:[.19444,.69444,0,0,1],9824:[.12963,.69444,0,0,.77778],9825:[.12963,.69444,0,0,.77778],9826:[.12963,.69444,0,0,.77778],9827:[.12963,.69444,0,0,.77778],9837:[0,.75,0,0,.38889],9838:[.19444,.69444,0,0,.38889],9839:[.19444,.69444,0,0,.38889],10216:[.25,.75,0,0,.38889],10217:[.25,.75,0,0,.38889],10222:[.244,.744,0,0,.412],10223:[.244,.745,0,0,.412],10229:[.011,.511,0,0,1.609],10230:[.011,.511,0,0,1.638],10231:[.011,.511,0,0,1.859],10232:[.024,.525,0,0,1.609],10233:[.024,.525,0,0,1.638],10234:[.024,.525,0,0,1.858],10236:[.011,.511,0,0,1.638],10815:[0,.68333,0,0,.75],10927:[.13597,.63597,0,0,.77778],10928:[.13597,.63597,0,0,.77778],57376:[.19444,.69444,0,0,0]},"Math-BoldItalic":{32:[0,0,0,0,.25],48:[0,.44444,0,0,.575],49:[0,.44444,0,0,.575],50:[0,.44444,0,0,.575],51:[.19444,.44444,0,0,.575],52:[.19444,.44444,0,0,.575],53:[.19444,.44444,0,0,.575],54:[0,.64444,0,0,.575],55:[.19444,.44444,0,0,.575],56:[0,.64444,0,0,.575],57:[.19444,.44444,0,0,.575],65:[0,.68611,0,0,.86944],66:[0,.68611,.04835,0,.8664],67:[0,.68611,.06979,0,.81694],68:[0,.68611,.03194,0,.93812],69:[0,.68611,.05451,0,.81007],70:[0,.68611,.15972,0,.68889],71:[0,.68611,0,0,.88673],72:[0,.68611,.08229,0,.98229],73:[0,.68611,.07778,0,.51111],74:[0,.68611,.10069,0,.63125],75:[0,.68611,.06979,0,.97118],76:[0,.68611,0,0,.75555],77:[0,.68611,.11424,0,1.14201],78:[0,.68611,.11424,0,.95034],79:[0,.68611,.03194,0,.83666],80:[0,.68611,.15972,0,.72309],81:[.19444,.68611,0,0,.86861],82:[0,.68611,.00421,0,.87235],83:[0,.68611,.05382,0,.69271],84:[0,.68611,.15972,0,.63663],85:[0,.68611,.11424,0,.80027],86:[0,.68611,.25555,0,.67778],87:[0,.68611,.15972,0,1.09305],88:[0,.68611,.07778,0,.94722],89:[0,.68611,.25555,0,.67458],90:[0,.68611,.06979,0,.77257],97:[0,.44444,0,0,.63287],98:[0,.69444,0,0,.52083],99:[0,.44444,0,0,.51342],100:[0,.69444,0,0,.60972],101:[0,.44444,0,0,.55361],102:[.19444,.69444,.11042,0,.56806],103:[.19444,.44444,.03704,0,.5449],104:[0,.69444,0,0,.66759],105:[0,.69326,0,0,.4048],106:[.19444,.69326,.0622,0,.47083],107:[0,.69444,.01852,0,.6037],108:[0,.69444,.0088,0,.34815],109:[0,.44444,0,0,1.0324],110:[0,.44444,0,0,.71296],111:[0,.44444,0,0,.58472],112:[.19444,.44444,0,0,.60092],113:[.19444,.44444,.03704,0,.54213],114:[0,.44444,.03194,0,.5287],115:[0,.44444,0,0,.53125],116:[0,.63492,0,0,.41528],117:[0,.44444,0,0,.68102],118:[0,.44444,.03704,0,.56666],119:[0,.44444,.02778,0,.83148],120:[0,.44444,0,0,.65903],121:[.19444,.44444,.03704,0,.59028],122:[0,.44444,.04213,0,.55509],160:[0,0,0,0,.25],915:[0,.68611,.15972,0,.65694],916:[0,.68611,0,0,.95833],920:[0,.68611,.03194,0,.86722],923:[0,.68611,0,0,.80555],926:[0,.68611,.07458,0,.84125],928:[0,.68611,.08229,0,.98229],931:[0,.68611,.05451,0,.88507],933:[0,.68611,.15972,0,.67083],934:[0,.68611,0,0,.76666],936:[0,.68611,.11653,0,.71402],937:[0,.68611,.04835,0,.8789],945:[0,.44444,0,0,.76064],946:[.19444,.69444,.03403,0,.65972],947:[.19444,.44444,.06389,0,.59003],948:[0,.69444,.03819,0,.52222],949:[0,.44444,0,0,.52882],950:[.19444,.69444,.06215,0,.50833],951:[.19444,.44444,.03704,0,.6],952:[0,.69444,.03194,0,.5618],953:[0,.44444,0,0,.41204],954:[0,.44444,0,0,.66759],955:[0,.69444,0,0,.67083],956:[.19444,.44444,0,0,.70787],957:[0,.44444,.06898,0,.57685],958:[.19444,.69444,.03021,0,.50833],959:[0,.44444,0,0,.58472],960:[0,.44444,.03704,0,.68241],961:[.19444,.44444,0,0,.6118],962:[.09722,.44444,.07917,0,.42361],963:[0,.44444,.03704,0,.68588],964:[0,.44444,.13472,0,.52083],965:[0,.44444,.03704,0,.63055],966:[.19444,.44444,0,0,.74722],967:[.19444,.44444,0,0,.71805],968:[.19444,.69444,.03704,0,.75833],969:[0,.44444,.03704,0,.71782],977:[0,.69444,0,0,.69155],981:[.19444,.69444,0,0,.7125],982:[0,.44444,.03194,0,.975],1009:[.19444,.44444,0,0,.6118],1013:[0,.44444,0,0,.48333],57649:[0,.44444,0,0,.39352],57911:[.19444,.44444,0,0,.43889]},"Math-Italic":{32:[0,0,0,0,.25],48:[0,.43056,0,0,.5],49:[0,.43056,0,0,.5],50:[0,.43056,0,0,.5],51:[.19444,.43056,0,0,.5],52:[.19444,.43056,0,0,.5],53:[.19444,.43056,0,0,.5],54:[0,.64444,0,0,.5],55:[.19444,.43056,0,0,.5],56:[0,.64444,0,0,.5],57:[.19444,.43056,0,0,.5],65:[0,.68333,0,.13889,.75],66:[0,.68333,.05017,.08334,.75851],67:[0,.68333,.07153,.08334,.71472],68:[0,.68333,.02778,.05556,.82792],69:[0,.68333,.05764,.08334,.7382],70:[0,.68333,.13889,.08334,.64306],71:[0,.68333,0,.08334,.78625],72:[0,.68333,.08125,.05556,.83125],73:[0,.68333,.07847,.11111,.43958],74:[0,.68333,.09618,.16667,.55451],75:[0,.68333,.07153,.05556,.84931],76:[0,.68333,0,.02778,.68056],77:[0,.68333,.10903,.08334,.97014],78:[0,.68333,.10903,.08334,.80347],79:[0,.68333,.02778,.08334,.76278],80:[0,.68333,.13889,.08334,.64201],81:[.19444,.68333,0,.08334,.79056],82:[0,.68333,.00773,.08334,.75929],83:[0,.68333,.05764,.08334,.6132],84:[0,.68333,.13889,.08334,.58438],85:[0,.68333,.10903,.02778,.68278],86:[0,.68333,.22222,0,.58333],87:[0,.68333,.13889,0,.94445],88:[0,.68333,.07847,.08334,.82847],89:[0,.68333,.22222,0,.58056],90:[0,.68333,.07153,.08334,.68264],97:[0,.43056,0,0,.52859],98:[0,.69444,0,0,.42917],99:[0,.43056,0,.05556,.43276],100:[0,.69444,0,.16667,.52049],101:[0,.43056,0,.05556,.46563],102:[.19444,.69444,.10764,.16667,.48959],103:[.19444,.43056,.03588,.02778,.47697],104:[0,.69444,0,0,.57616],105:[0,.65952,0,0,.34451],106:[.19444,.65952,.05724,0,.41181],107:[0,.69444,.03148,0,.5206],108:[0,.69444,.01968,.08334,.29838],109:[0,.43056,0,0,.87801],110:[0,.43056,0,0,.60023],111:[0,.43056,0,.05556,.48472],112:[.19444,.43056,0,.08334,.50313],113:[.19444,.43056,.03588,.08334,.44641],114:[0,.43056,.02778,.05556,.45116],115:[0,.43056,0,.05556,.46875],116:[0,.61508,0,.08334,.36111],117:[0,.43056,0,.02778,.57246],118:[0,.43056,.03588,.02778,.48472],119:[0,.43056,.02691,.08334,.71592],120:[0,.43056,0,.02778,.57153],121:[.19444,.43056,.03588,.05556,.49028],122:[0,.43056,.04398,.05556,.46505],160:[0,0,0,0,.25],915:[0,.68333,.13889,.08334,.61528],916:[0,.68333,0,.16667,.83334],920:[0,.68333,.02778,.08334,.76278],923:[0,.68333,0,.16667,.69445],926:[0,.68333,.07569,.08334,.74236],928:[0,.68333,.08125,.05556,.83125],931:[0,.68333,.05764,.08334,.77986],933:[0,.68333,.13889,.05556,.58333],934:[0,.68333,0,.08334,.66667],936:[0,.68333,.11,.05556,.61222],937:[0,.68333,.05017,.08334,.7724],945:[0,.43056,.0037,.02778,.6397],946:[.19444,.69444,.05278,.08334,.56563],947:[.19444,.43056,.05556,0,.51773],948:[0,.69444,.03785,.05556,.44444],949:[0,.43056,0,.08334,.46632],950:[.19444,.69444,.07378,.08334,.4375],951:[.19444,.43056,.03588,.05556,.49653],952:[0,.69444,.02778,.08334,.46944],953:[0,.43056,0,.05556,.35394],954:[0,.43056,0,0,.57616],955:[0,.69444,0,0,.58334],956:[.19444,.43056,0,.02778,.60255],957:[0,.43056,.06366,.02778,.49398],958:[.19444,.69444,.04601,.11111,.4375],959:[0,.43056,0,.05556,.48472],960:[0,.43056,.03588,0,.57003],961:[.19444,.43056,0,.08334,.51702],962:[.09722,.43056,.07986,.08334,.36285],963:[0,.43056,.03588,0,.57141],964:[0,.43056,.1132,.02778,.43715],965:[0,.43056,.03588,.02778,.54028],966:[.19444,.43056,0,.08334,.65417],967:[.19444,.43056,0,.05556,.62569],968:[.19444,.69444,.03588,.11111,.65139],969:[0,.43056,.03588,0,.62245],977:[0,.69444,0,.08334,.59144],981:[.19444,.69444,0,.08334,.59583],982:[0,.43056,.02778,0,.82813],1009:[.19444,.43056,0,.08334,.51702],1013:[0,.43056,0,.05556,.4059],57649:[0,.43056,0,.02778,.32246],57911:[.19444,.43056,0,.08334,.38403]},"SansSerif-Bold":{32:[0,0,0,0,.25],33:[0,.69444,0,0,.36667],34:[0,.69444,0,0,.55834],35:[.19444,.69444,0,0,.91667],36:[.05556,.75,0,0,.55],37:[.05556,.75,0,0,1.02912],38:[0,.69444,0,0,.83056],39:[0,.69444,0,0,.30556],40:[.25,.75,0,0,.42778],41:[.25,.75,0,0,.42778],42:[0,.75,0,0,.55],43:[.11667,.61667,0,0,.85556],44:[.10556,.13056,0,0,.30556],45:[0,.45833,0,0,.36667],46:[0,.13056,0,0,.30556],47:[.25,.75,0,0,.55],48:[0,.69444,0,0,.55],49:[0,.69444,0,0,.55],50:[0,.69444,0,0,.55],51:[0,.69444,0,0,.55],52:[0,.69444,0,0,.55],53:[0,.69444,0,0,.55],54:[0,.69444,0,0,.55],55:[0,.69444,0,0,.55],56:[0,.69444,0,0,.55],57:[0,.69444,0,0,.55],58:[0,.45833,0,0,.30556],59:[.10556,.45833,0,0,.30556],61:[-.09375,.40625,0,0,.85556],63:[0,.69444,0,0,.51945],64:[0,.69444,0,0,.73334],65:[0,.69444,0,0,.73334],66:[0,.69444,0,0,.73334],67:[0,.69444,0,0,.70278],68:[0,.69444,0,0,.79445],69:[0,.69444,0,0,.64167],70:[0,.69444,0,0,.61111],71:[0,.69444,0,0,.73334],72:[0,.69444,0,0,.79445],73:[0,.69444,0,0,.33056],74:[0,.69444,0,0,.51945],75:[0,.69444,0,0,.76389],76:[0,.69444,0,0,.58056],77:[0,.69444,0,0,.97778],78:[0,.69444,0,0,.79445],79:[0,.69444,0,0,.79445],80:[0,.69444,0,0,.70278],81:[.10556,.69444,0,0,.79445],82:[0,.69444,0,0,.70278],83:[0,.69444,0,0,.61111],84:[0,.69444,0,0,.73334],85:[0,.69444,0,0,.76389],86:[0,.69444,.01528,0,.73334],87:[0,.69444,.01528,0,1.03889],88:[0,.69444,0,0,.73334],89:[0,.69444,.0275,0,.73334],90:[0,.69444,0,0,.67223],91:[.25,.75,0,0,.34306],93:[.25,.75,0,0,.34306],94:[0,.69444,0,0,.55],95:[.35,.10833,.03056,0,.55],97:[0,.45833,0,0,.525],98:[0,.69444,0,0,.56111],99:[0,.45833,0,0,.48889],100:[0,.69444,0,0,.56111],101:[0,.45833,0,0,.51111],102:[0,.69444,.07639,0,.33611],103:[.19444,.45833,.01528,0,.55],104:[0,.69444,0,0,.56111],105:[0,.69444,0,0,.25556],106:[.19444,.69444,0,0,.28611],107:[0,.69444,0,0,.53056],108:[0,.69444,0,0,.25556],109:[0,.45833,0,0,.86667],110:[0,.45833,0,0,.56111],111:[0,.45833,0,0,.55],112:[.19444,.45833,0,0,.56111],113:[.19444,.45833,0,0,.56111],114:[0,.45833,.01528,0,.37222],115:[0,.45833,0,0,.42167],116:[0,.58929,0,0,.40417],117:[0,.45833,0,0,.56111],118:[0,.45833,.01528,0,.5],119:[0,.45833,.01528,0,.74445],120:[0,.45833,0,0,.5],121:[.19444,.45833,.01528,0,.5],122:[0,.45833,0,0,.47639],126:[.35,.34444,0,0,.55],160:[0,0,0,0,.25],168:[0,.69444,0,0,.55],176:[0,.69444,0,0,.73334],180:[0,.69444,0,0,.55],184:[.17014,0,0,0,.48889],305:[0,.45833,0,0,.25556],567:[.19444,.45833,0,0,.28611],710:[0,.69444,0,0,.55],711:[0,.63542,0,0,.55],713:[0,.63778,0,0,.55],728:[0,.69444,0,0,.55],729:[0,.69444,0,0,.30556],730:[0,.69444,0,0,.73334],732:[0,.69444,0,0,.55],733:[0,.69444,0,0,.55],915:[0,.69444,0,0,.58056],916:[0,.69444,0,0,.91667],920:[0,.69444,0,0,.85556],923:[0,.69444,0,0,.67223],926:[0,.69444,0,0,.73334],928:[0,.69444,0,0,.79445],931:[0,.69444,0,0,.79445],933:[0,.69444,0,0,.85556],934:[0,.69444,0,0,.79445],936:[0,.69444,0,0,.85556],937:[0,.69444,0,0,.79445],8211:[0,.45833,.03056,0,.55],8212:[0,.45833,.03056,0,1.10001],8216:[0,.69444,0,0,.30556],8217:[0,.69444,0,0,.30556],8220:[0,.69444,0,0,.55834],8221:[0,.69444,0,0,.55834]},"SansSerif-Italic":{32:[0,0,0,0,.25],33:[0,.69444,.05733,0,.31945],34:[0,.69444,.00316,0,.5],35:[.19444,.69444,.05087,0,.83334],36:[.05556,.75,.11156,0,.5],37:[.05556,.75,.03126,0,.83334],38:[0,.69444,.03058,0,.75834],39:[0,.69444,.07816,0,.27778],40:[.25,.75,.13164,0,.38889],41:[.25,.75,.02536,0,.38889],42:[0,.75,.11775,0,.5],43:[.08333,.58333,.02536,0,.77778],44:[.125,.08333,0,0,.27778],45:[0,.44444,.01946,0,.33333],46:[0,.08333,0,0,.27778],47:[.25,.75,.13164,0,.5],48:[0,.65556,.11156,0,.5],49:[0,.65556,.11156,0,.5],50:[0,.65556,.11156,0,.5],51:[0,.65556,.11156,0,.5],52:[0,.65556,.11156,0,.5],53:[0,.65556,.11156,0,.5],54:[0,.65556,.11156,0,.5],55:[0,.65556,.11156,0,.5],56:[0,.65556,.11156,0,.5],57:[0,.65556,.11156,0,.5],58:[0,.44444,.02502,0,.27778],59:[.125,.44444,.02502,0,.27778],61:[-.13,.37,.05087,0,.77778],63:[0,.69444,.11809,0,.47222],64:[0,.69444,.07555,0,.66667],65:[0,.69444,0,0,.66667],66:[0,.69444,.08293,0,.66667],67:[0,.69444,.11983,0,.63889],68:[0,.69444,.07555,0,.72223],69:[0,.69444,.11983,0,.59722],70:[0,.69444,.13372,0,.56945],71:[0,.69444,.11983,0,.66667],72:[0,.69444,.08094,0,.70834],73:[0,.69444,.13372,0,.27778],74:[0,.69444,.08094,0,.47222],75:[0,.69444,.11983,0,.69445],76:[0,.69444,0,0,.54167],77:[0,.69444,.08094,0,.875],78:[0,.69444,.08094,0,.70834],79:[0,.69444,.07555,0,.73611],80:[0,.69444,.08293,0,.63889],81:[.125,.69444,.07555,0,.73611],82:[0,.69444,.08293,0,.64584],83:[0,.69444,.09205,0,.55556],84:[0,.69444,.13372,0,.68056],85:[0,.69444,.08094,0,.6875],86:[0,.69444,.1615,0,.66667],87:[0,.69444,.1615,0,.94445],88:[0,.69444,.13372,0,.66667],89:[0,.69444,.17261,0,.66667],90:[0,.69444,.11983,0,.61111],91:[.25,.75,.15942,0,.28889],93:[.25,.75,.08719,0,.28889],94:[0,.69444,.0799,0,.5],95:[.35,.09444,.08616,0,.5],97:[0,.44444,.00981,0,.48056],98:[0,.69444,.03057,0,.51667],99:[0,.44444,.08336,0,.44445],100:[0,.69444,.09483,0,.51667],101:[0,.44444,.06778,0,.44445],102:[0,.69444,.21705,0,.30556],103:[.19444,.44444,.10836,0,.5],104:[0,.69444,.01778,0,.51667],105:[0,.67937,.09718,0,.23889],106:[.19444,.67937,.09162,0,.26667],107:[0,.69444,.08336,0,.48889],108:[0,.69444,.09483,0,.23889],109:[0,.44444,.01778,0,.79445],110:[0,.44444,.01778,0,.51667],111:[0,.44444,.06613,0,.5],112:[.19444,.44444,.0389,0,.51667],113:[.19444,.44444,.04169,0,.51667],114:[0,.44444,.10836,0,.34167],115:[0,.44444,.0778,0,.38333],116:[0,.57143,.07225,0,.36111],117:[0,.44444,.04169,0,.51667],118:[0,.44444,.10836,0,.46111],119:[0,.44444,.10836,0,.68334],120:[0,.44444,.09169,0,.46111],121:[.19444,.44444,.10836,0,.46111],122:[0,.44444,.08752,0,.43472],126:[.35,.32659,.08826,0,.5],160:[0,0,0,0,.25],168:[0,.67937,.06385,0,.5],176:[0,.69444,0,0,.73752],184:[.17014,0,0,0,.44445],305:[0,.44444,.04169,0,.23889],567:[.19444,.44444,.04169,0,.26667],710:[0,.69444,.0799,0,.5],711:[0,.63194,.08432,0,.5],713:[0,.60889,.08776,0,.5],714:[0,.69444,.09205,0,.5],715:[0,.69444,0,0,.5],728:[0,.69444,.09483,0,.5],729:[0,.67937,.07774,0,.27778],730:[0,.69444,0,0,.73752],732:[0,.67659,.08826,0,.5],733:[0,.69444,.09205,0,.5],915:[0,.69444,.13372,0,.54167],916:[0,.69444,0,0,.83334],920:[0,.69444,.07555,0,.77778],923:[0,.69444,0,0,.61111],926:[0,.69444,.12816,0,.66667],928:[0,.69444,.08094,0,.70834],931:[0,.69444,.11983,0,.72222],933:[0,.69444,.09031,0,.77778],934:[0,.69444,.04603,0,.72222],936:[0,.69444,.09031,0,.77778],937:[0,.69444,.08293,0,.72222],8211:[0,.44444,.08616,0,.5],8212:[0,.44444,.08616,0,1],8216:[0,.69444,.07816,0,.27778],8217:[0,.69444,.07816,0,.27778],8220:[0,.69444,.14205,0,.5],8221:[0,.69444,.00316,0,.5]},"SansSerif-Regular":{32:[0,0,0,0,.25],33:[0,.69444,0,0,.31945],34:[0,.69444,0,0,.5],35:[.19444,.69444,0,0,.83334],36:[.05556,.75,0,0,.5],37:[.05556,.75,0,0,.83334],38:[0,.69444,0,0,.75834],39:[0,.69444,0,0,.27778],40:[.25,.75,0,0,.38889],41:[.25,.75,0,0,.38889],42:[0,.75,0,0,.5],43:[.08333,.58333,0,0,.77778],44:[.125,.08333,0,0,.27778],45:[0,.44444,0,0,.33333],46:[0,.08333,0,0,.27778],47:[.25,.75,0,0,.5],48:[0,.65556,0,0,.5],49:[0,.65556,0,0,.5],50:[0,.65556,0,0,.5],51:[0,.65556,0,0,.5],52:[0,.65556,0,0,.5],53:[0,.65556,0,0,.5],54:[0,.65556,0,0,.5],55:[0,.65556,0,0,.5],56:[0,.65556,0,0,.5],57:[0,.65556,0,0,.5],58:[0,.44444,0,0,.27778],59:[.125,.44444,0,0,.27778],61:[-.13,.37,0,0,.77778],63:[0,.69444,0,0,.47222],64:[0,.69444,0,0,.66667],65:[0,.69444,0,0,.66667],66:[0,.69444,0,0,.66667],67:[0,.69444,0,0,.63889],68:[0,.69444,0,0,.72223],69:[0,.69444,0,0,.59722],70:[0,.69444,0,0,.56945],71:[0,.69444,0,0,.66667],72:[0,.69444,0,0,.70834],73:[0,.69444,0,0,.27778],74:[0,.69444,0,0,.47222],75:[0,.69444,0,0,.69445],76:[0,.69444,0,0,.54167],77:[0,.69444,0,0,.875],78:[0,.69444,0,0,.70834],79:[0,.69444,0,0,.73611],80:[0,.69444,0,0,.63889],81:[.125,.69444,0,0,.73611],82:[0,.69444,0,0,.64584],83:[0,.69444,0,0,.55556],84:[0,.69444,0,0,.68056],85:[0,.69444,0,0,.6875],86:[0,.69444,.01389,0,.66667],87:[0,.69444,.01389,0,.94445],88:[0,.69444,0,0,.66667],89:[0,.69444,.025,0,.66667],90:[0,.69444,0,0,.61111],91:[.25,.75,0,0,.28889],93:[.25,.75,0,0,.28889],94:[0,.69444,0,0,.5],95:[.35,.09444,.02778,0,.5],97:[0,.44444,0,0,.48056],98:[0,.69444,0,0,.51667],99:[0,.44444,0,0,.44445],100:[0,.69444,0,0,.51667],101:[0,.44444,0,0,.44445],102:[0,.69444,.06944,0,.30556],103:[.19444,.44444,.01389,0,.5],104:[0,.69444,0,0,.51667],105:[0,.67937,0,0,.23889],106:[.19444,.67937,0,0,.26667],107:[0,.69444,0,0,.48889],108:[0,.69444,0,0,.23889],109:[0,.44444,0,0,.79445],110:[0,.44444,0,0,.51667],111:[0,.44444,0,0,.5],112:[.19444,.44444,0,0,.51667],113:[.19444,.44444,0,0,.51667],114:[0,.44444,.01389,0,.34167],115:[0,.44444,0,0,.38333],116:[0,.57143,0,0,.36111],117:[0,.44444,0,0,.51667],118:[0,.44444,.01389,0,.46111],119:[0,.44444,.01389,0,.68334],120:[0,.44444,0,0,.46111],121:[.19444,.44444,.01389,0,.46111],122:[0,.44444,0,0,.43472],126:[.35,.32659,0,0,.5],160:[0,0,0,0,.25],168:[0,.67937,0,0,.5],176:[0,.69444,0,0,.66667],184:[.17014,0,0,0,.44445],305:[0,.44444,0,0,.23889],567:[.19444,.44444,0,0,.26667],710:[0,.69444,0,0,.5],711:[0,.63194,0,0,.5],713:[0,.60889,0,0,.5],714:[0,.69444,0,0,.5],715:[0,.69444,0,0,.5],728:[0,.69444,0,0,.5],729:[0,.67937,0,0,.27778],730:[0,.69444,0,0,.66667],732:[0,.67659,0,0,.5],733:[0,.69444,0,0,.5],915:[0,.69444,0,0,.54167],916:[0,.69444,0,0,.83334],920:[0,.69444,0,0,.77778],923:[0,.69444,0,0,.61111],926:[0,.69444,0,0,.66667],928:[0,.69444,0,0,.70834],931:[0,.69444,0,0,.72222],933:[0,.69444,0,0,.77778],934:[0,.69444,0,0,.72222],936:[0,.69444,0,0,.77778],937:[0,.69444,0,0,.72222],8211:[0,.44444,.02778,0,.5],8212:[0,.44444,.02778,0,1],8216:[0,.69444,0,0,.27778],8217:[0,.69444,0,0,.27778],8220:[0,.69444,0,0,.5],8221:[0,.69444,0,0,.5]},"Script-Regular":{32:[0,0,0,0,.25],65:[0,.7,.22925,0,.80253],66:[0,.7,.04087,0,.90757],67:[0,.7,.1689,0,.66619],68:[0,.7,.09371,0,.77443],69:[0,.7,.18583,0,.56162],70:[0,.7,.13634,0,.89544],71:[0,.7,.17322,0,.60961],72:[0,.7,.29694,0,.96919],73:[0,.7,.19189,0,.80907],74:[.27778,.7,.19189,0,1.05159],75:[0,.7,.31259,0,.91364],76:[0,.7,.19189,0,.87373],77:[0,.7,.15981,0,1.08031],78:[0,.7,.3525,0,.9015],79:[0,.7,.08078,0,.73787],80:[0,.7,.08078,0,1.01262],81:[0,.7,.03305,0,.88282],82:[0,.7,.06259,0,.85],83:[0,.7,.19189,0,.86767],84:[0,.7,.29087,0,.74697],85:[0,.7,.25815,0,.79996],86:[0,.7,.27523,0,.62204],87:[0,.7,.27523,0,.80532],88:[0,.7,.26006,0,.94445],89:[0,.7,.2939,0,.70961],90:[0,.7,.24037,0,.8212],160:[0,0,0,0,.25]},"Size1-Regular":{32:[0,0,0,0,.25],40:[.35001,.85,0,0,.45834],41:[.35001,.85,0,0,.45834],47:[.35001,.85,0,0,.57778],91:[.35001,.85,0,0,.41667],92:[.35001,.85,0,0,.57778],93:[.35001,.85,0,0,.41667],123:[.35001,.85,0,0,.58334],125:[.35001,.85,0,0,.58334],160:[0,0,0,0,.25],710:[0,.72222,0,0,.55556],732:[0,.72222,0,0,.55556],770:[0,.72222,0,0,.55556],771:[0,.72222,0,0,.55556],8214:[-99e-5,.601,0,0,.77778],8593:[1e-5,.6,0,0,.66667],8595:[1e-5,.6,0,0,.66667],8657:[1e-5,.6,0,0,.77778],8659:[1e-5,.6,0,0,.77778],8719:[.25001,.75,0,0,.94445],8720:[.25001,.75,0,0,.94445],8721:[.25001,.75,0,0,1.05556],8730:[.35001,.85,0,0,1],8739:[-.00599,.606,0,0,.33333],8741:[-.00599,.606,0,0,.55556],8747:[.30612,.805,.19445,0,.47222],8748:[.306,.805,.19445,0,.47222],8749:[.306,.805,.19445,0,.47222],8750:[.30612,.805,.19445,0,.47222],8896:[.25001,.75,0,0,.83334],8897:[.25001,.75,0,0,.83334],8898:[.25001,.75,0,0,.83334],8899:[.25001,.75,0,0,.83334],8968:[.35001,.85,0,0,.47222],8969:[.35001,.85,0,0,.47222],8970:[.35001,.85,0,0,.47222],8971:[.35001,.85,0,0,.47222],9168:[-99e-5,.601,0,0,.66667],10216:[.35001,.85,0,0,.47222],10217:[.35001,.85,0,0,.47222],10752:[.25001,.75,0,0,1.11111],10753:[.25001,.75,0,0,1.11111],10754:[.25001,.75,0,0,1.11111],10756:[.25001,.75,0,0,.83334],10758:[.25001,.75,0,0,.83334]},"Size2-Regular":{32:[0,0,0,0,.25],40:[.65002,1.15,0,0,.59722],41:[.65002,1.15,0,0,.59722],47:[.65002,1.15,0,0,.81111],91:[.65002,1.15,0,0,.47222],92:[.65002,1.15,0,0,.81111],93:[.65002,1.15,0,0,.47222],123:[.65002,1.15,0,0,.66667],125:[.65002,1.15,0,0,.66667],160:[0,0,0,0,.25],710:[0,.75,0,0,1],732:[0,.75,0,0,1],770:[0,.75,0,0,1],771:[0,.75,0,0,1],8719:[.55001,1.05,0,0,1.27778],8720:[.55001,1.05,0,0,1.27778],8721:[.55001,1.05,0,0,1.44445],8730:[.65002,1.15,0,0,1],8747:[.86225,1.36,.44445,0,.55556],8748:[.862,1.36,.44445,0,.55556],8749:[.862,1.36,.44445,0,.55556],8750:[.86225,1.36,.44445,0,.55556],8896:[.55001,1.05,0,0,1.11111],8897:[.55001,1.05,0,0,1.11111],8898:[.55001,1.05,0,0,1.11111],8899:[.55001,1.05,0,0,1.11111],8968:[.65002,1.15,0,0,.52778],8969:[.65002,1.15,0,0,.52778],8970:[.65002,1.15,0,0,.52778],8971:[.65002,1.15,0,0,.52778],10216:[.65002,1.15,0,0,.61111],10217:[.65002,1.15,0,0,.61111],10752:[.55001,1.05,0,0,1.51112],10753:[.55001,1.05,0,0,1.51112],10754:[.55001,1.05,0,0,1.51112],10756:[.55001,1.05,0,0,1.11111],10758:[.55001,1.05,0,0,1.11111]},"Size3-Regular":{32:[0,0,0,0,.25],40:[.95003,1.45,0,0,.73611],41:[.95003,1.45,0,0,.73611],47:[.95003,1.45,0,0,1.04445],91:[.95003,1.45,0,0,.52778],92:[.95003,1.45,0,0,1.04445],93:[.95003,1.45,0,0,.52778],123:[.95003,1.45,0,0,.75],125:[.95003,1.45,0,0,.75],160:[0,0,0,0,.25],710:[0,.75,0,0,1.44445],732:[0,.75,0,0,1.44445],770:[0,.75,0,0,1.44445],771:[0,.75,0,0,1.44445],8730:[.95003,1.45,0,0,1],8968:[.95003,1.45,0,0,.58334],8969:[.95003,1.45,0,0,.58334],8970:[.95003,1.45,0,0,.58334],8971:[.95003,1.45,0,0,.58334],10216:[.95003,1.45,0,0,.75],10217:[.95003,1.45,0,0,.75]},"Size4-Regular":{32:[0,0,0,0,.25],40:[1.25003,1.75,0,0,.79167],41:[1.25003,1.75,0,0,.79167],47:[1.25003,1.75,0,0,1.27778],91:[1.25003,1.75,0,0,.58334],92:[1.25003,1.75,0,0,1.27778],93:[1.25003,1.75,0,0,.58334],123:[1.25003,1.75,0,0,.80556],125:[1.25003,1.75,0,0,.80556],160:[0,0,0,0,.25],710:[0,.825,0,0,1.8889],732:[0,.825,0,0,1.8889],770:[0,.825,0,0,1.8889],771:[0,.825,0,0,1.8889],8730:[1.25003,1.75,0,0,1],8968:[1.25003,1.75,0,0,.63889],8969:[1.25003,1.75,0,0,.63889],8970:[1.25003,1.75,0,0,.63889],8971:[1.25003,1.75,0,0,.63889],9115:[.64502,1.155,0,0,.875],9116:[1e-5,.6,0,0,.875],9117:[.64502,1.155,0,0,.875],9118:[.64502,1.155,0,0,.875],9119:[1e-5,.6,0,0,.875],9120:[.64502,1.155,0,0,.875],9121:[.64502,1.155,0,0,.66667],9122:[-99e-5,.601,0,0,.66667],9123:[.64502,1.155,0,0,.66667],9124:[.64502,1.155,0,0,.66667],9125:[-99e-5,.601,0,0,.66667],9126:[.64502,1.155,0,0,.66667],9127:[1e-5,.9,0,0,.88889],9128:[.65002,1.15,0,0,.88889],9129:[.90001,0,0,0,.88889],9130:[0,.3,0,0,.88889],9131:[1e-5,.9,0,0,.88889],9132:[.65002,1.15,0,0,.88889],9133:[.90001,0,0,0,.88889],9143:[.88502,.915,0,0,1.05556],10216:[1.25003,1.75,0,0,.80556],10217:[1.25003,1.75,0,0,.80556],57344:[-.00499,.605,0,0,1.05556],57345:[-.00499,.605,0,0,1.05556],57680:[0,.12,0,0,.45],57681:[0,.12,0,0,.45],57682:[0,.12,0,0,.45],57683:[0,.12,0,0,.45]},"Typewriter-Regular":{32:[0,0,0,0,.525],33:[0,.61111,0,0,.525],34:[0,.61111,0,0,.525],35:[0,.61111,0,0,.525],36:[.08333,.69444,0,0,.525],37:[.08333,.69444,0,0,.525],38:[0,.61111,0,0,.525],39:[0,.61111,0,0,.525],40:[.08333,.69444,0,0,.525],41:[.08333,.69444,0,0,.525],42:[0,.52083,0,0,.525],43:[-.08056,.53055,0,0,.525],44:[.13889,.125,0,0,.525],45:[-.08056,.53055,0,0,.525],46:[0,.125,0,0,.525],47:[.08333,.69444,0,0,.525],48:[0,.61111,0,0,.525],49:[0,.61111,0,0,.525],50:[0,.61111,0,0,.525],51:[0,.61111,0,0,.525],52:[0,.61111,0,0,.525],53:[0,.61111,0,0,.525],54:[0,.61111,0,0,.525],55:[0,.61111,0,0,.525],56:[0,.61111,0,0,.525],57:[0,.61111,0,0,.525],58:[0,.43056,0,0,.525],59:[.13889,.43056,0,0,.525],60:[-.05556,.55556,0,0,.525],61:[-.19549,.41562,0,0,.525],62:[-.05556,.55556,0,0,.525],63:[0,.61111,0,0,.525],64:[0,.61111,0,0,.525],65:[0,.61111,0,0,.525],66:[0,.61111,0,0,.525],67:[0,.61111,0,0,.525],68:[0,.61111,0,0,.525],69:[0,.61111,0,0,.525],70:[0,.61111,0,0,.525],71:[0,.61111,0,0,.525],72:[0,.61111,0,0,.525],73:[0,.61111,0,0,.525],74:[0,.61111,0,0,.525],75:[0,.61111,0,0,.525],76:[0,.61111,0,0,.525],77:[0,.61111,0,0,.525],78:[0,.61111,0,0,.525],79:[0,.61111,0,0,.525],80:[0,.61111,0,0,.525],81:[.13889,.61111,0,0,.525],82:[0,.61111,0,0,.525],83:[0,.61111,0,0,.525],84:[0,.61111,0,0,.525],85:[0,.61111,0,0,.525],86:[0,.61111,0,0,.525],87:[0,.61111,0,0,.525],88:[0,.61111,0,0,.525],89:[0,.61111,0,0,.525],90:[0,.61111,0,0,.525],91:[.08333,.69444,0,0,.525],92:[.08333,.69444,0,0,.525],93:[.08333,.69444,0,0,.525],94:[0,.61111,0,0,.525],95:[.09514,0,0,0,.525],96:[0,.61111,0,0,.525],97:[0,.43056,0,0,.525],98:[0,.61111,0,0,.525],99:[0,.43056,0,0,.525],100:[0,.61111,0,0,.525],101:[0,.43056,0,0,.525],102:[0,.61111,0,0,.525],103:[.22222,.43056,0,0,.525],104:[0,.61111,0,0,.525],105:[0,.61111,0,0,.525],106:[.22222,.61111,0,0,.525],107:[0,.61111,0,0,.525],108:[0,.61111,0,0,.525],109:[0,.43056,0,0,.525],110:[0,.43056,0,0,.525],111:[0,.43056,0,0,.525],112:[.22222,.43056,0,0,.525],113:[.22222,.43056,0,0,.525],114:[0,.43056,0,0,.525],115:[0,.43056,0,0,.525],116:[0,.55358,0,0,.525],117:[0,.43056,0,0,.525],118:[0,.43056,0,0,.525],119:[0,.43056,0,0,.525],120:[0,.43056,0,0,.525],121:[.22222,.43056,0,0,.525],122:[0,.43056,0,0,.525],123:[.08333,.69444,0,0,.525],124:[.08333,.69444,0,0,.525],125:[.08333,.69444,0,0,.525],126:[0,.61111,0,0,.525],127:[0,.61111,0,0,.525],160:[0,0,0,0,.525],176:[0,.61111,0,0,.525],184:[.19445,0,0,0,.525],305:[0,.43056,0,0,.525],567:[.22222,.43056,0,0,.525],711:[0,.56597,0,0,.525],713:[0,.56555,0,0,.525],714:[0,.61111,0,0,.525],715:[0,.61111,0,0,.525],728:[0,.61111,0,0,.525],730:[0,.61111,0,0,.525],770:[0,.61111,0,0,.525],771:[0,.61111,0,0,.525],776:[0,.61111,0,0,.525],915:[0,.61111,0,0,.525],916:[0,.61111,0,0,.525],920:[0,.61111,0,0,.525],923:[0,.61111,0,0,.525],926:[0,.61111,0,0,.525],928:[0,.61111,0,0,.525],931:[0,.61111,0,0,.525],933:[0,.61111,0,0,.525],934:[0,.61111,0,0,.525],936:[0,.61111,0,0,.525],937:[0,.61111,0,0,.525],8216:[0,.61111,0,0,.525],8217:[0,.61111,0,0,.525],8242:[0,.61111,0,0,.525],9251:[.11111,.21944,0,0,.525]}},ei={slant:[.25,.25,.25],space:[0,0,0],stretch:[0,0,0],shrink:[0,0,0],xHeight:[.431,.431,.431],quad:[1,1.171,1.472],extraSpace:[0,0,0],num1:[.677,.732,.925],num2:[.394,.384,.387],num3:[.444,.471,.504],denom1:[.686,.752,1.025],denom2:[.345,.344,.532],sup1:[.413,.503,.504],sup2:[.363,.431,.404],sup3:[.289,.286,.294],sub1:[.15,.143,.2],sub2:[.247,.286,.4],supDrop:[.386,.353,.494],subDrop:[.05,.071,.1],delim1:[2.39,1.7,1.98],delim2:[1.01,1.157,1.42],axisHeight:[.25,.25,.25],defaultRuleThickness:[.04,.049,.049],bigOpSpacing1:[.111,.111,.111],bigOpSpacing2:[.166,.166,.166],bigOpSpacing3:[.2,.2,.2],bigOpSpacing4:[.6,.611,.611],bigOpSpacing5:[.1,.143,.143],sqrtRuleThickness:[.04,.04,.04],ptPerEm:[10,10,10],doubleRuleSep:[.2,.2,.2],arrayRuleWidth:[.04,.04,.04],fboxsep:[.3,.3,.3],fboxrule:[.04,.04,.04]},ti={:"A",:"D",:"o",:"a",:"d",:"o",:"A",:"B",:"B",:"F",:"A",:"E",:"K",:"3",:"N",:"N",:"K",:"N",:"M",:"H",:"O",:"N",:"P",:"C",:"T",:"y",:"O",:"X",:"U",:"h",:"W",:"W",:"B",:"X",:"B",:"3",:"X",:"R",:"a",:"b",:"a",:"r",:"y",:"e",:"m",:"e",:"n",:"n",:"n",:"n",:"m",:"n",:"o",:"n",:"p",:"c",:"o",:"y",:"b",:"x",:"n",:"n",:"w",:"w",:"a",:"m",:"a",:"e",:"m",:"r"};function ni(e,t,n){if(!Qr[t])throw new Error("Font metrics not found for font: "+t+".");var r=e.charCodeAt(0),i=Qr[t][r];if(!i&&e[0]in ti&&(r=ti[e[0]].charCodeAt(0),i=Qr[t][r]),i||"text"!==n||Xr(r)&&(i=Qr[t][77]),i)return{depth:i[0],height:i[1],italic:i[2],skew:i[3],width:i[4]}}var ri={},ii=[[1,1,1],[2,1,1],[3,1,1],[4,2,1],[5,2,1],[6,3,1],[7,4,2],[8,6,3],[9,7,6],[10,8,7],[11,10,9]],si=[.5,.6,.7,.8,.9,1,1.2,1.44,1.728,2.074,2.488],oi=function(e,t){return t.size<2?e:ii[e-1][t.size-1]};class ai{constructor(e){this.style=void 0,this.color=void 0,this.size=void 0,this.textSize=void 0,this.phantom=void 0,this.font=void 0,this.fontFamily=void 0,this.fontWeight=void 0,this.fontShape=void 0,this.sizeMultiplier=void 0,this.maxSize=void 0,this.minRuleThickness=void 0,this._fontMetrics=void 0,this.style=e.style,this.color=e.color,this.size=e.size||ai.BASESIZE,this.textSize=e.textSize||this.size,this.phantom=!!e.phantom,this.font=e.font||"",this.fontFamily=e.fontFamily||"",this.fontWeight=e.fontWeight||"",this.fontShape=e.fontShape||"",this.sizeMultiplier=si[this.size-1],this.maxSize=e.maxSize,this.minRuleThickness=e.minRuleThickness,this._fontMetrics=void 0}extend(e){var t={style:this.style,size:this.size,textSize:this.textSize,color:this.color,phantom:this.phantom,font:this.font,fontFamily:this.fontFamily,fontWeight:this.fontWeight,fontShape:this.fontShape,maxSize:this.maxSize,minRuleThickness:this.minRuleThickness};for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);return new ai(t)}havingStyle(e){return this.style===e?this:this.extend({style:e,size:oi(this.textSize,e)})}havingCrampedStyle(){return this.havingStyle(this.style.cramp())}havingSize(e){return this.size===e&&this.textSize===e?this:this.extend({style:this.style.text(),size:e,textSize:e,sizeMultiplier:si[e-1]})}havingBaseStyle(e){e=e||this.style.text();var t=oi(ai.BASESIZE,e);return this.size===t&&this.textSize===ai.BASESIZE&&this.style===e?this:this.extend({style:e,size:t})}havingBaseSizing(){var e;switch(this.style.id){case 4:case 5:e=3;break;case 6:case 7:e=1;break;default:e=6}return this.extend({style:this.style.text(),size:e})}withColor(e){return this.extend({color:e})}withPhantom(){return this.extend({phantom:!0})}withFont(e){return this.extend({font:e})}withTextFontFamily(e){return this.extend({fontFamily:e,font:""})}withTextFontWeight(e){return this.extend({fontWeight:e,font:""})}withTextFontShape(e){return this.extend({fontShape:e,font:""})}sizingClasses(e){return e.size!==this.size?["sizing","reset-size"+e.size,"size"+this.size]:[]}baseSizingClasses(){return this.size!==ai.BASESIZE?["sizing","reset-size"+this.size,"size"+ai.BASESIZE]:[]}fontMetrics(){return this._fontMetrics||(this._fontMetrics=function(e){var t;if(!ri[t=e>=5?0:e>=3?1:2]){var n=ri[t]={cssEmPerMu:ei.quad[t]/18};for(var r in ei)ei.hasOwnProperty(r)&&(n[r]=ei[r][t])}return ri[t]}(this.size)),this._fontMetrics}getColor(){return this.phantom?"transparent":this.color}}ai.BASESIZE=6;var li={pt:1,mm:7227/2540,cm:7227/254,in:72.27,bp:1.00375,pc:12,dd:1238/1157,cc:14856/1157,nd:685/642,nc:1370/107,sp:1/65536,px:1.00375},ci={ex:!0,em:!0,mu:!0},di=function(e){return"string"!=typeof e&&(e=e.unit),e in li||e in ci||"ex"===e},ui=function(e,t){var n;if(e.unit in li)n=li[e.unit]/t.fontMetrics().ptPerEm/t.sizeMultiplier;else if("mu"===e.unit)n=t.fontMetrics().cssEmPerMu;else{var r;if(r=t.style.isTight()?t.havingStyle(t.style.text()):t,"ex"===e.unit)n=r.fontMetrics().xHeight;else{if("em"!==e.unit)throw new xr("Invalid unit: '"+e.unit+"'");n=r.fontMetrics().quad}r!==t&&(n*=r.sizeMultiplier/t.sizeMultiplier)}return Math.min(e.number*n,t.maxSize)},hi=function(e){return+e.toFixed(4)+"em"},pi=function(e){return e.filter((e=>e)).join(" ")},mi=function(e,t,n){if(this.classes=e||[],this.attributes={},this.height=0,this.depth=0,this.maxFontSize=0,this.style=n||{},t){t.style.isTight()&&this.classes.push("mtight");var r=t.getColor();r&&(this.style.color=r)}},gi=function(e){var t=document.createElement(e);for(var n in t.className=pi(this.classes),this.style)this.style.hasOwnProperty(n)&&(t.style[n]=this.style[n]);for(var r in this.attributes)this.attributes.hasOwnProperty(r)&&t.setAttribute(r,this.attributes[r]);for(var i=0;i<this.children.length;i++)t.appendChild(this.children[i].toNode());return t},fi=function(e){var t="<"+e;this.classes.length&&(t+=' class="'+Or(pi(this.classes))+'"');var n="";for(var r in this.style)this.style.hasOwnProperty(r)&&(n+=Pr(r)+":"+this.style[r]+";");for(var i in n&&(t+=' style="'+Or(n)+'"'),this.attributes)this.attributes.hasOwnProperty(i)&&(t+=" "+i+'="'+Or(this.attributes[i])+'"');t+=">";for(var s=0;s<this.children.length;s++)t+=this.children[s].toMarkup();return t+"</"+e+">"};class yi{constructor(e,t,n,r){this.children=void 0,this.attributes=void 0,this.classes=void 0,this.height=void 0,this.depth=void 0,this.width=void 0,this.maxFontSize=void 0,this.style=void 0,mi.call(this,e,n,r),this.children=t||[]}setAttribute(e,t){this.attributes[e]=t}hasClass(e){return Ir(this.classes,e)}toNode(){return gi.call(this,"span")}toMarkup(){return fi.call(this,"span")}}class vi{constructor(e,t,n,r){this.children=void 0,this.attributes=void 0,this.classes=void 0,this.height=void 0,this.depth=void 0,this.maxFontSize=void 0,this.style=void 0,mi.call(this,t,r),this.children=n||[],this.setAttribute("href",e)}setAttribute(e,t){this.attributes[e]=t}hasClass(e){return Ir(this.classes,e)}toNode(){return gi.call(this,"a")}toMarkup(){return fi.call(this,"a")}}class bi{constructor(e,t,n){this.src=void 0,this.alt=void 0,this.classes=void 0,this.height=void 0,this.depth=void 0,this.maxFontSize=void 0,this.style=void 0,this.alt=t,this.src=e,this.classes=["mord"],this.style=n}hasClass(e){return Ir(this.classes,e)}toNode(){var e=document.createElement("img");for(var t in e.src=this.src,e.alt=this.alt,e.className="mord",this.style)this.style.hasOwnProperty(t)&&(e.style[t]=this.style[t]);return e}toMarkup(){var e="<img  src='"+this.src+" 'alt='"+this.alt+"' ",t="";for(var n in this.style)this.style.hasOwnProperty(n)&&(t+=Pr(n)+":"+this.style[n]+";");return t&&(e+=' style="'+Or(t)+'"'),e+"'/>"}}var wi={:"",:"",:"",:""};class Si{constructor(e,t,n,r,i,s,o,a){this.text=void 0,this.height=void 0,this.depth=void 0,this.italic=void 0,this.skew=void 0,this.width=void 0,this.maxFontSize=void 0,this.classes=void 0,this.style=void 0,this.text=e,this.height=t||0,this.depth=n||0,this.italic=r||0,this.skew=i||0,this.width=s||0,this.classes=o||[],this.style=a||{},this.maxFontSize=0;var l=function(e){for(var t=0;t<Gr.length;t++)for(var n=Gr[t],r=0;r<n.blocks.length;r++){var i=n.blocks[r];if(e>=i[0]&&e<=i[1])return n.name}return null}(this.text.charCodeAt(0));l&&this.classes.push(l+"_fallback"),/[]/.test(this.text)&&(this.text=wi[this.text])}hasClass(e){return Ir(this.classes,e)}toNode(){var e=document.createTextNode(this.text),t=null;for(var n in this.italic>0&&((t=document.createElement("span")).style.marginRight=hi(this.italic)),this.classes.length>0&&((t=t||document.createElement("span")).className=pi(this.classes)),this.style)this.style.hasOwnProperty(n)&&((t=t||document.createElement("span")).style[n]=this.style[n]);return t?(t.appendChild(e),t):e}toMarkup(){var e=!1,t="<span";this.classes.length&&(e=!0,t+=' class="',t+=Or(pi(this.classes)),t+='"');var n="";for(var r in this.italic>0&&(n+="margin-right:"+this.italic+"em;"),this.style)this.style.hasOwnProperty(r)&&(n+=Pr(r)+":"+this.style[r]+";");n&&(e=!0,t+=' style="'+Or(n)+'"');var i=Or(this.text);return e?(t+=">",t+=i,t+="</span>"):i}}class _i{constructor(e,t){this.children=void 0,this.attributes=void 0,this.children=e||[],this.attributes=t||{}}toNode(){var e=document.createElementNS("http://www.w3.org/2000/svg","svg");for(var t in this.attributes)Object.prototype.hasOwnProperty.call(this.attributes,t)&&e.setAttribute(t,this.attributes[t]);for(var n=0;n<this.children.length;n++)e.appendChild(this.children[n].toNode());return e}toMarkup(){var e='<svg xmlns="http://www.w3.org/2000/svg"';for(var t in this.attributes)Object.prototype.hasOwnProperty.call(this.attributes,t)&&(e+=" "+t+"='"+this.attributes[t]+"'");e+=">";for(var n=0;n<this.children.length;n++)e+=this.children[n].toMarkup();return e+"</svg>"}}class ki{constructor(e,t){this.pathName=void 0,this.alternate=void 0,this.pathName=e,this.alternate=t}toNode(){var e=document.createElementNS("http://www.w3.org/2000/svg","path");return this.alternate?e.setAttribute("d",this.alternate):e.setAttribute("d",Zr[this.pathName]),e}toMarkup(){return this.alternate?"<path d='"+this.alternate+"'/>":"<path d='"+Zr[this.pathName]+"'/>"}}class xi{constructor(e){this.attributes=void 0,this.attributes=e||{}}toNode(){var e=document.createElementNS("http://www.w3.org/2000/svg","line");for(var t in this.attributes)Object.prototype.hasOwnProperty.call(this.attributes,t)&&e.setAttribute(t,this.attributes[t]);return e}toMarkup(){var e="<line";for(var t in this.attributes)Object.prototype.hasOwnProperty.call(this.attributes,t)&&(e+=" "+t+"='"+this.attributes[t]+"'");return e+"/>"}}function Ei(e){if(e instanceof Si)return e;throw new Error("Expected symbolNode but got "+String(e)+".")}var Ti={bin:1,close:1,inner:1,open:1,punct:1,rel:1},Ci={"accent-token":1,mathord:1,"op-token":1,spacing:1,textord:1},Ai={math:{},text:{}};function Ii(e,t,n,r,i,s){Ai[e][i]={font:t,group:n,replace:r},s&&r&&(Ai[e][r]=Ai[e][i])}var Ri="math",Oi="text",Pi="main",Mi="ams",Di="accent-token",Li="bin",Fi="close",Ni="inner",ji="mathord",Ui="op-token",Bi="open",qi="punct",Ki="rel",zi="spacing",$i="textord";Ii(Ri,Pi,Ki,"","\\equiv",!0),Ii(Ri,Pi,Ki,"","\\prec",!0),Ii(Ri,Pi,Ki,"","\\succ",!0),Ii(Ri,Pi,Ki,"","\\sim",!0),Ii(Ri,Pi,Ki,"","\\perp"),Ii(Ri,Pi,Ki,"","\\preceq",!0),Ii(Ri,Pi,Ki,"","\\succeq",!0),Ii(Ri,Pi,Ki,"","\\simeq",!0),Ii(Ri,Pi,Ki,"","\\mid",!0),Ii(Ri,Pi,Ki,"","\\ll",!0),Ii(Ri,Pi,Ki,"","\\gg",!0),Ii(Ri,Pi,Ki,"","\\asymp",!0),Ii(Ri,Pi,Ki,"","\\parallel"),Ii(Ri,Pi,Ki,"","\\bowtie",!0),Ii(Ri,Pi,Ki,"","\\smile",!0),Ii(Ri,Pi,Ki,"","\\sqsubseteq",!0),Ii(Ri,Pi,Ki,"","\\sqsupseteq",!0),Ii(Ri,Pi,Ki,"","\\doteq",!0),Ii(Ri,Pi,Ki,"","\\frown",!0),Ii(Ri,Pi,Ki,"","\\ni",!0),Ii(Ri,Pi,Ki,"","\\propto",!0),Ii(Ri,Pi,Ki,"","\\vdash",!0),Ii(Ri,Pi,Ki,"","\\dashv",!0),Ii(Ri,Pi,Ki,"","\\owns"),Ii(Ri,Pi,qi,".","\\ldotp"),Ii(Ri,Pi,qi,"","\\cdotp"),Ii(Ri,Pi,$i,"#","\\#"),Ii(Oi,Pi,$i,"#","\\#"),Ii(Ri,Pi,$i,"&","\\&"),Ii(Oi,Pi,$i,"&","\\&"),Ii(Ri,Pi,$i,"","\\aleph",!0),Ii(Ri,Pi,$i,"","\\forall",!0),Ii(Ri,Pi,$i,"","\\hbar",!0),Ii(Ri,Pi,$i,"","\\exists",!0),Ii(Ri,Pi,$i,"","\\nabla",!0),Ii(Ri,Pi,$i,"","\\flat",!0),Ii(Ri,Pi,$i,"","\\ell",!0),Ii(Ri,Pi,$i,"","\\natural",!0),Ii(Ri,Pi,$i,"","\\clubsuit",!0),Ii(Ri,Pi,$i,"","\\wp",!0),Ii(Ri,Pi,$i,"","\\sharp",!0),Ii(Ri,Pi,$i,"","\\diamondsuit",!0),Ii(Ri,Pi,$i,"","\\Re",!0),Ii(Ri,Pi,$i,"","\\heartsuit",!0),Ii(Ri,Pi,$i,"","\\Im",!0),Ii(Ri,Pi,$i,"","\\spadesuit",!0),Ii(Ri,Pi,$i,"","\\S",!0),Ii(Oi,Pi,$i,"","\\S"),Ii(Ri,Pi,$i,"","\\P",!0),Ii(Oi,Pi,$i,"","\\P"),Ii(Ri,Pi,$i,"","\\dag"),Ii(Oi,Pi,$i,"","\\dag"),Ii(Oi,Pi,$i,"","\\textdagger"),Ii(Ri,Pi,$i,"","\\ddag"),Ii(Oi,Pi,$i,"","\\ddag"),Ii(Oi,Pi,$i,"","\\textdaggerdbl"),Ii(Ri,Pi,Fi,"","\\rmoustache",!0),Ii(Ri,Pi,Bi,"","\\lmoustache",!0),Ii(Ri,Pi,Fi,"","\\rgroup",!0),Ii(Ri,Pi,Bi,"","\\lgroup",!0),Ii(Ri,Pi,Li,"","\\mp",!0),Ii(Ri,Pi,Li,"","\\ominus",!0),Ii(Ri,Pi,Li,"","\\uplus",!0),Ii(Ri,Pi,Li,"","\\sqcap",!0),Ii(Ri,Pi,Li,"","\\ast"),Ii(Ri,Pi,Li,"","\\sqcup",!0),Ii(Ri,Pi,Li,"","\\bigcirc",!0),Ii(Ri,Pi,Li,"","\\bullet"),Ii(Ri,Pi,Li,"","\\ddagger"),Ii(Ri,Pi,Li,"","\\wr",!0),Ii(Ri,Pi,Li,"","\\amalg"),Ii(Ri,Pi,Li,"&","\\And"),Ii(Ri,Pi,Ki,"","\\longleftarrow",!0),Ii(Ri,Pi,Ki,"","\\Leftarrow",!0),Ii(Ri,Pi,Ki,"","\\Longleftarrow",!0),Ii(Ri,Pi,Ki,"","\\longrightarrow",!0),Ii(Ri,Pi,Ki,"","\\Rightarrow",!0),Ii(Ri,Pi,Ki,"","\\Longrightarrow",!0),Ii(Ri,Pi,Ki,"","\\leftrightarrow",!0),Ii(Ri,Pi,Ki,"","\\longleftrightarrow",!0),Ii(Ri,Pi,Ki,"","\\Leftrightarrow",!0),Ii(Ri,Pi,Ki,"","\\Longleftrightarrow",!0),Ii(Ri,Pi,Ki,"","\\mapsto",!0),Ii(Ri,Pi,Ki,"","\\longmapsto",!0),Ii(Ri,Pi,Ki,"","\\nearrow",!0),Ii(Ri,Pi,Ki,"","\\hookleftarrow",!0),Ii(Ri,Pi,Ki,"","\\hookrightarrow",!0),Ii(Ri,Pi,Ki,"","\\searrow",!0),Ii(Ri,Pi,Ki,"","\\leftharpoonup",!0),Ii(Ri,Pi,Ki,"","\\rightharpoonup",!0),Ii(Ri,Pi,Ki,"","\\swarrow",!0),Ii(Ri,Pi,Ki,"","\\leftharpoondown",!0),Ii(Ri,Pi,Ki,"","\\rightharpoondown",!0),Ii(Ri,Pi,Ki,"","\\nwarrow",!0),Ii(Ri,Pi,Ki,"","\\rightleftharpoons",!0),Ii(Ri,Mi,Ki,"","\\nless",!0),Ii(Ri,Mi,Ki,"","\\@nleqslant"),Ii(Ri,Mi,Ki,"","\\@nleqq"),Ii(Ri,Mi,Ki,"","\\lneq",!0),Ii(Ri,Mi,Ki,"","\\lneqq",!0),Ii(Ri,Mi,Ki,"","\\@lvertneqq"),Ii(Ri,Mi,Ki,"","\\lnsim",!0),Ii(Ri,Mi,Ki,"","\\lnapprox",!0),Ii(Ri,Mi,Ki,"","\\nprec",!0),Ii(Ri,Mi,Ki,"","\\npreceq",!0),Ii(Ri,Mi,Ki,"","\\precnsim",!0),Ii(Ri,Mi,Ki,"","\\precnapprox",!0),Ii(Ri,Mi,Ki,"","\\nsim",!0),Ii(Ri,Mi,Ki,"","\\@nshortmid"),Ii(Ri,Mi,Ki,"","\\nmid",!0),Ii(Ri,Mi,Ki,"","\\nvdash",!0),Ii(Ri,Mi,Ki,"","\\nvDash",!0),Ii(Ri,Mi,Ki,"","\\ntriangleleft"),Ii(Ri,Mi,Ki,"","\\ntrianglelefteq",!0),Ii(Ri,Mi,Ki,"","\\subsetneq",!0),Ii(Ri,Mi,Ki,"","\\@varsubsetneq"),Ii(Ri,Mi,Ki,"","\\subsetneqq",!0),Ii(Ri,Mi,Ki,"","\\@varsubsetneqq"),Ii(Ri,Mi,Ki,"","\\ngtr",!0),Ii(Ri,Mi,Ki,"","\\@ngeqslant"),Ii(Ri,Mi,Ki,"","\\@ngeqq"),Ii(Ri,Mi,Ki,"","\\gneq",!0),Ii(Ri,Mi,Ki,"","\\gneqq",!0),Ii(Ri,Mi,Ki,"","\\@gvertneqq"),Ii(Ri,Mi,Ki,"","\\gnsim",!0),Ii(Ri,Mi,Ki,"","\\gnapprox",!0),Ii(Ri,Mi,Ki,"","\\nsucc",!0),Ii(Ri,Mi,Ki,"","\\nsucceq",!0),Ii(Ri,Mi,Ki,"","\\succnsim",!0),Ii(Ri,Mi,Ki,"","\\succnapprox",!0),Ii(Ri,Mi,Ki,"","\\ncong",!0),Ii(Ri,Mi,Ki,"","\\@nshortparallel"),Ii(Ri,Mi,Ki,"","\\nparallel",!0),Ii(Ri,Mi,Ki,"","\\nVDash",!0),Ii(Ri,Mi,Ki,"","\\ntriangleright"),Ii(Ri,Mi,Ki,"","\\ntrianglerighteq",!0),Ii(Ri,Mi,Ki,"","\\@nsupseteqq"),Ii(Ri,Mi,Ki,"","\\supsetneq",!0),Ii(Ri,Mi,Ki,"","\\@varsupsetneq"),Ii(Ri,Mi,Ki,"","\\supsetneqq",!0),Ii(Ri,Mi,Ki,"","\\@varsupsetneqq"),Ii(Ri,Mi,Ki,"","\\nVdash",!0),Ii(Ri,Mi,Ki,"","\\precneqq",!0),Ii(Ri,Mi,Ki,"","\\succneqq",!0),Ii(Ri,Mi,Ki,"","\\@nsubseteqq"),Ii(Ri,Mi,Li,"","\\unlhd"),Ii(Ri,Mi,Li,"","\\unrhd"),Ii(Ri,Mi,Ki,"","\\nleftarrow",!0),Ii(Ri,Mi,Ki,"","\\nrightarrow",!0),Ii(Ri,Mi,Ki,"","\\nLeftarrow",!0),Ii(Ri,Mi,Ki,"","\\nRightarrow",!0),Ii(Ri,Mi,Ki,"","\\nleftrightarrow",!0),Ii(Ri,Mi,Ki,"","\\nLeftrightarrow",!0),Ii(Ri,Mi,Ki,"","\\vartriangle"),Ii(Ri,Mi,$i,"","\\hslash"),Ii(Ri,Mi,$i,"","\\triangledown"),Ii(Ri,Mi,$i,"","\\lozenge"),Ii(Ri,Mi,$i,"","\\circledS"),Ii(Ri,Mi,$i,"","\\circledR"),Ii(Oi,Mi,$i,"","\\circledR"),Ii(Ri,Mi,$i,"","\\measuredangle",!0),Ii(Ri,Mi,$i,"","\\nexists"),Ii(Ri,Mi,$i,"","\\mho"),Ii(Ri,Mi,$i,"","\\Finv",!0),Ii(Ri,Mi,$i,"","\\Game",!0),Ii(Ri,Mi,$i,"","\\backprime"),Ii(Ri,Mi,$i,"","\\blacktriangle"),Ii(Ri,Mi,$i,"","\\blacktriangledown"),Ii(Ri,Mi,$i,"","\\blacksquare"),Ii(Ri,Mi,$i,"","\\blacklozenge"),Ii(Ri,Mi,$i,"","\\bigstar"),Ii(Ri,Mi,$i,"","\\sphericalangle",!0),Ii(Ri,Mi,$i,"","\\complement",!0),Ii(Ri,Mi,$i,"","\\eth",!0),Ii(Oi,Pi,$i,"",""),Ii(Ri,Mi,$i,"","\\diagup"),Ii(Ri,Mi,$i,"","\\diagdown"),Ii(Ri,Mi,$i,"","\\square"),Ii(Ri,Mi,$i,"","\\Box"),Ii(Ri,Mi,$i,"","\\Diamond"),Ii(Ri,Mi,$i,"","\\yen",!0),Ii(Oi,Mi,$i,"","\\yen",!0),Ii(Ri,Mi,$i,"","\\checkmark",!0),Ii(Oi,Mi,$i,"","\\checkmark"),Ii(Ri,Mi,$i,"","\\beth",!0),Ii(Ri,Mi,$i,"","\\daleth",!0),Ii(Ri,Mi,$i,"","\\gimel",!0),Ii(Ri,Mi,$i,"","\\digamma",!0),Ii(Ri,Mi,$i,"","\\varkappa"),Ii(Ri,Mi,Bi,"","\\@ulcorner",!0),Ii(Ri,Mi,Fi,"","\\@urcorner",!0),Ii(Ri,Mi,Bi,"","\\@llcorner",!0),Ii(Ri,Mi,Fi,"","\\@lrcorner",!0),Ii(Ri,Mi,Ki,"","\\leqq",!0),Ii(Ri,Mi,Ki,"","\\leqslant",!0),Ii(Ri,Mi,Ki,"","\\eqslantless",!0),Ii(Ri,Mi,Ki,"","\\lesssim",!0),Ii(Ri,Mi,Ki,"","\\lessapprox",!0),Ii(Ri,Mi,Ki,"","\\approxeq",!0),Ii(Ri,Mi,Li,"","\\lessdot"),Ii(Ri,Mi,Ki,"","\\lll",!0),Ii(Ri,Mi,Ki,"","\\lessgtr",!0),Ii(Ri,Mi,Ki,"","\\lesseqgtr",!0),Ii(Ri,Mi,Ki,"","\\lesseqqgtr",!0),Ii(Ri,Mi,Ki,"","\\doteqdot"),Ii(Ri,Mi,Ki,"","\\risingdotseq",!0),Ii(Ri,Mi,Ki,"","\\fallingdotseq",!0),Ii(Ri,Mi,Ki,"","\\backsim",!0),Ii(Ri,Mi,Ki,"","\\backsimeq",!0),Ii(Ri,Mi,Ki,"","\\subseteqq",!0),Ii(Ri,Mi,Ki,"","\\Subset",!0),Ii(Ri,Mi,Ki,"","\\sqsubset",!0),Ii(Ri,Mi,Ki,"","\\preccurlyeq",!0),Ii(Ri,Mi,Ki,"","\\curlyeqprec",!0),Ii(Ri,Mi,Ki,"","\\precsim",!0),Ii(Ri,Mi,Ki,"","\\precapprox",!0),Ii(Ri,Mi,Ki,"","\\vartriangleleft"),Ii(Ri,Mi,Ki,"","\\trianglelefteq"),Ii(Ri,Mi,Ki,"","\\vDash",!0),Ii(Ri,Mi,Ki,"","\\Vvdash",!0),Ii(Ri,Mi,Ki,"","\\smallsmile"),Ii(Ri,Mi,Ki,"","\\smallfrown"),Ii(Ri,Mi,Ki,"","\\bumpeq",!0),Ii(Ri,Mi,Ki,"","\\Bumpeq",!0),Ii(Ri,Mi,Ki,"","\\geqq",!0),Ii(Ri,Mi,Ki,"","\\geqslant",!0),Ii(Ri,Mi,Ki,"","\\eqslantgtr",!0),Ii(Ri,Mi,Ki,"","\\gtrsim",!0),Ii(Ri,Mi,Ki,"","\\gtrapprox",!0),Ii(Ri,Mi,Li,"","\\gtrdot"),Ii(Ri,Mi,Ki,"","\\ggg",!0),Ii(Ri,Mi,Ki,"","\\gtrless",!0),Ii(Ri,Mi,Ki,"","\\gtreqless",!0),Ii(Ri,Mi,Ki,"","\\gtreqqless",!0),Ii(Ri,Mi,Ki,"","\\eqcirc",!0),Ii(Ri,Mi,Ki,"","\\circeq",!0),Ii(Ri,Mi,Ki,"","\\triangleq",!0),Ii(Ri,Mi,Ki,"","\\thicksim"),Ii(Ri,Mi,Ki,"","\\thickapprox"),Ii(Ri,Mi,Ki,"","\\supseteqq",!0),Ii(Ri,Mi,Ki,"","\\Supset",!0),Ii(Ri,Mi,Ki,"","\\sqsupset",!0),Ii(Ri,Mi,Ki,"","\\succcurlyeq",!0),Ii(Ri,Mi,Ki,"","\\curlyeqsucc",!0),Ii(Ri,Mi,Ki,"","\\succsim",!0),Ii(Ri,Mi,Ki,"","\\succapprox",!0),Ii(Ri,Mi,Ki,"","\\vartriangleright"),Ii(Ri,Mi,Ki,"","\\trianglerighteq"),Ii(Ri,Mi,Ki,"","\\Vdash",!0),Ii(Ri,Mi,Ki,"","\\shortmid"),Ii(Ri,Mi,Ki,"","\\shortparallel"),Ii(Ri,Mi,Ki,"","\\between",!0),Ii(Ri,Mi,Ki,"","\\pitchfork",!0),Ii(Ri,Mi,Ki,"","\\varpropto"),Ii(Ri,Mi,Ki,"","\\blacktriangleleft"),Ii(Ri,Mi,Ki,"","\\therefore",!0),Ii(Ri,Mi,Ki,"","\\backepsilon"),Ii(Ri,Mi,Ki,"","\\blacktriangleright"),Ii(Ri,Mi,Ki,"","\\because",!0),Ii(Ri,Mi,Ki,"","\\llless"),Ii(Ri,Mi,Ki,"","\\gggtr"),Ii(Ri,Mi,Li,"","\\lhd"),Ii(Ri,Mi,Li,"","\\rhd"),Ii(Ri,Mi,Ki,"","\\eqsim",!0),Ii(Ri,Pi,Ki,"","\\Join"),Ii(Ri,Mi,Ki,"","\\Doteq",!0),Ii(Ri,Mi,Li,"","\\dotplus",!0),Ii(Ri,Mi,Li,"","\\smallsetminus"),Ii(Ri,Mi,Li,"","\\Cap",!0),Ii(Ri,Mi,Li,"","\\Cup",!0),Ii(Ri,Mi,Li,"","\\doublebarwedge",!0),Ii(Ri,Mi,Li,"","\\boxminus",!0),Ii(Ri,Mi,Li,"","\\boxplus",!0),Ii(Ri,Mi,Li,"","\\divideontimes",!0),Ii(Ri,Mi,Li,"","\\ltimes",!0),Ii(Ri,Mi,Li,"","\\rtimes",!0),Ii(Ri,Mi,Li,"","\\leftthreetimes",!0),Ii(Ri,Mi,Li,"","\\rightthreetimes",!0),Ii(Ri,Mi,Li,"","\\curlywedge",!0),Ii(Ri,Mi,Li,"","\\curlyvee",!0),Ii(Ri,Mi,Li,"","\\circleddash",!0),Ii(Ri,Mi,Li,"","\\circledast",!0),Ii(Ri,Mi,Li,"","\\centerdot"),Ii(Ri,Mi,Li,"","\\intercal",!0),Ii(Ri,Mi,Li,"","\\doublecap"),Ii(Ri,Mi,Li,"","\\doublecup"),Ii(Ri,Mi,Li,"","\\boxtimes",!0),Ii(Ri,Mi,Ki,"","\\dashrightarrow",!0),Ii(Ri,Mi,Ki,"","\\dashleftarrow",!0),Ii(Ri,Mi,Ki,"","\\leftleftarrows",!0),Ii(Ri,Mi,Ki,"","\\leftrightarrows",!0),Ii(Ri,Mi,Ki,"","\\Lleftarrow",!0),Ii(Ri,Mi,Ki,"","\\twoheadleftarrow",!0),Ii(Ri,Mi,Ki,"","\\leftarrowtail",!0),Ii(Ri,Mi,Ki,"","\\looparrowleft",!0),Ii(Ri,Mi,Ki,"","\\leftrightharpoons",!0),Ii(Ri,Mi,Ki,"","\\curvearrowleft",!0),Ii(Ri,Mi,Ki,"","\\circlearrowleft",!0),Ii(Ri,Mi,Ki,"","\\Lsh",!0),Ii(Ri,Mi,Ki,"","\\upuparrows",!0),Ii(Ri,Mi,Ki,"","\\upharpoonleft",!0),Ii(Ri,Mi,Ki,"","\\downharpoonleft",!0),Ii(Ri,Pi,Ki,"","\\origof",!0),Ii(Ri,Pi,Ki,"","\\imageof",!0),Ii(Ri,Mi,Ki,"","\\multimap",!0),Ii(Ri,Mi,Ki,"","\\leftrightsquigarrow",!0),Ii(Ri,Mi,Ki,"","\\rightrightarrows",!0),Ii(Ri,Mi,Ki,"","\\rightleftarrows",!0),Ii(Ri,Mi,Ki,"","\\twoheadrightarrow",!0),Ii(Ri,Mi,Ki,"","\\rightarrowtail",!0),Ii(Ri,Mi,Ki,"","\\looparrowright",!0),Ii(Ri,Mi,Ki,"","\\curvearrowright",!0),Ii(Ri,Mi,Ki,"","\\circlearrowright",!0),Ii(Ri,Mi,Ki,"","\\Rsh",!0),Ii(Ri,Mi,Ki,"","\\downdownarrows",!0),Ii(Ri,Mi,Ki,"","\\upharpoonright",!0),Ii(Ri,Mi,Ki,"","\\downharpoonright",!0),Ii(Ri,Mi,Ki,"","\\rightsquigarrow",!0),Ii(Ri,Mi,Ki,"","\\leadsto"),Ii(Ri,Mi,Ki,"","\\Rrightarrow",!0),Ii(Ri,Mi,Ki,"","\\restriction"),Ii(Ri,Pi,$i,"","`"),Ii(Ri,Pi,$i,"$","\\$"),Ii(Oi,Pi,$i,"$","\\$"),Ii(Oi,Pi,$i,"$","\\textdollar"),Ii(Ri,Pi,$i,"%","\\%"),Ii(Oi,Pi,$i,"%","\\%"),Ii(Ri,Pi,$i,"_","\\_"),Ii(Oi,Pi,$i,"_","\\_"),Ii(Oi,Pi,$i,"_","\\textunderscore"),Ii(Ri,Pi,$i,"","\\angle",!0),Ii(Ri,Pi,$i,"","\\infty",!0),Ii(Ri,Pi,$i,"","\\prime"),Ii(Ri,Pi,$i,"","\\triangle"),Ii(Ri,Pi,$i,"","\\Gamma",!0),Ii(Ri,Pi,$i,"","\\Delta",!0),Ii(Ri,Pi,$i,"","\\Theta",!0),Ii(Ri,Pi,$i,"","\\Lambda",!0),Ii(Ri,Pi,$i,"","\\Xi",!0),Ii(Ri,Pi,$i,"","\\Pi",!0),Ii(Ri,Pi,$i,"","\\Sigma",!0),Ii(Ri,Pi,$i,"","\\Upsilon",!0),Ii(Ri,Pi,$i,"","\\Phi",!0),Ii(Ri,Pi,$i,"","\\Psi",!0),Ii(Ri,Pi,$i,"","\\Omega",!0),Ii(Ri,Pi,$i,"A",""),Ii(Ri,Pi,$i,"B",""),Ii(Ri,Pi,$i,"E",""),Ii(Ri,Pi,$i,"Z",""),Ii(Ri,Pi,$i,"H",""),Ii(Ri,Pi,$i,"I",""),Ii(Ri,Pi,$i,"K",""),Ii(Ri,Pi,$i,"M",""),Ii(Ri,Pi,$i,"N",""),Ii(Ri,Pi,$i,"O",""),Ii(Ri,Pi,$i,"P",""),Ii(Ri,Pi,$i,"T",""),Ii(Ri,Pi,$i,"X",""),Ii(Ri,Pi,$i,"","\\neg",!0),Ii(Ri,Pi,$i,"","\\lnot"),Ii(Ri,Pi,$i,"","\\top"),Ii(Ri,Pi,$i,"","\\bot"),Ii(Ri,Pi,$i,"","\\emptyset"),Ii(Ri,Mi,$i,"","\\varnothing"),Ii(Ri,Pi,ji,"","\\alpha",!0),Ii(Ri,Pi,ji,"","\\beta",!0),Ii(Ri,Pi,ji,"","\\gamma",!0),Ii(Ri,Pi,ji,"","\\delta",!0),Ii(Ri,Pi,ji,"","\\epsilon",!0),Ii(Ri,Pi,ji,"","\\zeta",!0),Ii(Ri,Pi,ji,"","\\eta",!0),Ii(Ri,Pi,ji,"","\\theta",!0),Ii(Ri,Pi,ji,"","\\iota",!0),Ii(Ri,Pi,ji,"","\\kappa",!0),Ii(Ri,Pi,ji,"","\\lambda",!0),Ii(Ri,Pi,ji,"","\\mu",!0),Ii(Ri,Pi,ji,"","\\nu",!0),Ii(Ri,Pi,ji,"","\\xi",!0),Ii(Ri,Pi,ji,"","\\omicron",!0),Ii(Ri,Pi,ji,"","\\pi",!0),Ii(Ri,Pi,ji,"","\\rho",!0),Ii(Ri,Pi,ji,"","\\sigma",!0),Ii(Ri,Pi,ji,"","\\tau",!0),Ii(Ri,Pi,ji,"","\\upsilon",!0),Ii(Ri,Pi,ji,"","\\phi",!0),Ii(Ri,Pi,ji,"","\\chi",!0),Ii(Ri,Pi,ji,"","\\psi",!0),Ii(Ri,Pi,ji,"","\\omega",!0),Ii(Ri,Pi,ji,"","\\varepsilon",!0),Ii(Ri,Pi,ji,"","\\vartheta",!0),Ii(Ri,Pi,ji,"","\\varpi",!0),Ii(Ri,Pi,ji,"","\\varrho",!0),Ii(Ri,Pi,ji,"","\\varsigma",!0),Ii(Ri,Pi,ji,"","\\varphi",!0),Ii(Ri,Pi,Li,"","*",!0),Ii(Ri,Pi,Li,"+","+"),Ii(Ri,Pi,Li,"","-",!0),Ii(Ri,Pi,Li,"","\\cdot",!0),Ii(Ri,Pi,Li,"","\\circ"),Ii(Ri,Pi,Li,"","\\div",!0),Ii(Ri,Pi,Li,"","\\pm",!0),Ii(Ri,Pi,Li,"","\\times",!0),Ii(Ri,Pi,Li,"","\\cap",!0),Ii(Ri,Pi,Li,"","\\cup",!0),Ii(Ri,Pi,Li,"","\\setminus"),Ii(Ri,Pi,Li,"","\\land"),Ii(Ri,Pi,Li,"","\\lor"),Ii(Ri,Pi,Li,"","\\wedge",!0),Ii(Ri,Pi,Li,"","\\vee",!0),Ii(Ri,Pi,$i,"","\\surd"),Ii(Ri,Pi,Bi,"","\\langle",!0),Ii(Ri,Pi,Bi,"","\\lvert"),Ii(Ri,Pi,Bi,"","\\lVert"),Ii(Ri,Pi,Fi,"?","?"),Ii(Ri,Pi,Fi,"!","!"),Ii(Ri,Pi,Fi,"","\\rangle",!0),Ii(Ri,Pi,Fi,"","\\rvert"),Ii(Ri,Pi,Fi,"","\\rVert"),Ii(Ri,Pi,Ki,"=","="),Ii(Ri,Pi,Ki,":",":"),Ii(Ri,Pi,Ki,"","\\approx",!0),Ii(Ri,Pi,Ki,"","\\cong",!0),Ii(Ri,Pi,Ki,"","\\ge"),Ii(Ri,Pi,Ki,"","\\geq",!0),Ii(Ri,Pi,Ki,"","\\gets"),Ii(Ri,Pi,Ki,">","\\gt",!0),Ii(Ri,Pi,Ki,"","\\in",!0),Ii(Ri,Pi,Ki,"","\\@not"),Ii(Ri,Pi,Ki,"","\\subset",!0),Ii(Ri,Pi,Ki,"","\\supset",!0),Ii(Ri,Pi,Ki,"","\\subseteq",!0),Ii(Ri,Pi,Ki,"","\\supseteq",!0),Ii(Ri,Mi,Ki,"","\\nsubseteq",!0),Ii(Ri,Mi,Ki,"","\\nsupseteq",!0),Ii(Ri,Pi,Ki,"","\\models"),Ii(Ri,Pi,Ki,"","\\leftarrow",!0),Ii(Ri,Pi,Ki,"","\\le"),Ii(Ri,Pi,Ki,"","\\leq",!0),Ii(Ri,Pi,Ki,"<","\\lt",!0),Ii(Ri,Pi,Ki,"","\\rightarrow",!0),Ii(Ri,Pi,Ki,"","\\to"),Ii(Ri,Mi,Ki,"","\\ngeq",!0),Ii(Ri,Mi,Ki,"","\\nleq",!0),Ii(Ri,Pi,zi,"","\\ "),Ii(Ri,Pi,zi,"","\\space"),Ii(Ri,Pi,zi,"","\\nobreakspace"),Ii(Oi,Pi,zi,"","\\ "),Ii(Oi,Pi,zi,""," "),Ii(Oi,Pi,zi,"","\\space"),Ii(Oi,Pi,zi,"","\\nobreakspace"),Ii(Ri,Pi,zi,null,"\\nobreak"),Ii(Ri,Pi,zi,null,"\\allowbreak"),Ii(Ri,Pi,qi,",",","),Ii(Ri,Pi,qi,";",";"),Ii(Ri,Mi,Li,"","\\barwedge",!0),Ii(Ri,Mi,Li,"","\\veebar",!0),Ii(Ri,Pi,Li,"","\\odot",!0),Ii(Ri,Pi,Li,"","\\oplus",!0),Ii(Ri,Pi,Li,"","\\otimes",!0),Ii(Ri,Pi,$i,"","\\partial",!0),Ii(Ri,Pi,Li,"","\\oslash",!0),Ii(Ri,Mi,Li,"","\\circledcirc",!0),Ii(Ri,Mi,Li,"","\\boxdot",!0),Ii(Ri,Pi,Li,"","\\bigtriangleup"),Ii(Ri,Pi,Li,"","\\bigtriangledown"),Ii(Ri,Pi,Li,"","\\dagger"),Ii(Ri,Pi,Li,"","\\diamond"),Ii(Ri,Pi,Li,"","\\star"),Ii(Ri,Pi,Li,"","\\triangleleft"),Ii(Ri,Pi,Li,"","\\triangleright"),Ii(Ri,Pi,Bi,"{","\\{"),Ii(Oi,Pi,$i,"{","\\{"),Ii(Oi,Pi,$i,"{","\\textbraceleft"),Ii(Ri,Pi,Fi,"}","\\}"),Ii(Oi,Pi,$i,"}","\\}"),Ii(Oi,Pi,$i,"}","\\textbraceright"),Ii(Ri,Pi,Bi,"{","\\lbrace"),Ii(Ri,Pi,Fi,"}","\\rbrace"),Ii(Ri,Pi,Bi,"[","\\lbrack",!0),Ii(Oi,Pi,$i,"[","\\lbrack",!0),Ii(Ri,Pi,Fi,"]","\\rbrack",!0),Ii(Oi,Pi,$i,"]","\\rbrack",!0),Ii(Ri,Pi,Bi,"(","\\lparen",!0),Ii(Ri,Pi,Fi,")","\\rparen",!0),Ii(Oi,Pi,$i,"<","\\textless",!0),Ii(Oi,Pi,$i,">","\\textgreater",!0),Ii(Ri,Pi,Bi,"","\\lfloor",!0),Ii(Ri,Pi,Fi,"","\\rfloor",!0),Ii(Ri,Pi,Bi,"","\\lceil",!0),Ii(Ri,Pi,Fi,"","\\rceil",!0),Ii(Ri,Pi,$i,"\\","\\backslash"),Ii(Ri,Pi,$i,"","|"),Ii(Ri,Pi,$i,"","\\vert"),Ii(Oi,Pi,$i,"|","\\textbar",!0),Ii(Ri,Pi,$i,"","\\|"),Ii(Ri,Pi,$i,"","\\Vert"),Ii(Oi,Pi,$i,"","\\textbardbl"),Ii(Oi,Pi,$i,"~","\\textasciitilde"),Ii(Oi,Pi,$i,"\\","\\textbackslash"),Ii(Oi,Pi,$i,"^","\\textasciicircum"),Ii(Ri,Pi,Ki,"","\\uparrow",!0),Ii(Ri,Pi,Ki,"","\\Uparrow",!0),Ii(Ri,Pi,Ki,"","\\downarrow",!0),Ii(Ri,Pi,Ki,"","\\Downarrow",!0),Ii(Ri,Pi,Ki,"","\\updownarrow",!0),Ii(Ri,Pi,Ki,"","\\Updownarrow",!0),Ii(Ri,Pi,Ui,"","\\coprod"),Ii(Ri,Pi,Ui,"","\\bigvee"),Ii(Ri,Pi,Ui,"","\\bigwedge"),Ii(Ri,Pi,Ui,"","\\biguplus"),Ii(Ri,Pi,Ui,"","\\bigcap"),Ii(Ri,Pi,Ui,"","\\bigcup"),Ii(Ri,Pi,Ui,"","\\int"),Ii(Ri,Pi,Ui,"","\\intop"),Ii(Ri,Pi,Ui,"","\\iint"),Ii(Ri,Pi,Ui,"","\\iiint"),Ii(Ri,Pi,Ui,"","\\prod"),Ii(Ri,Pi,Ui,"","\\sum"),Ii(Ri,Pi,Ui,"","\\bigotimes"),Ii(Ri,Pi,Ui,"","\\bigoplus"),Ii(Ri,Pi,Ui,"","\\bigodot"),Ii(Ri,Pi,Ui,"","\\oint"),Ii(Ri,Pi,Ui,"","\\oiint"),Ii(Ri,Pi,Ui,"","\\oiiint"),Ii(Ri,Pi,Ui,"","\\bigsqcup"),Ii(Ri,Pi,Ui,"","\\smallint"),Ii(Oi,Pi,Ni,"","\\textellipsis"),Ii(Ri,Pi,Ni,"","\\mathellipsis"),Ii(Oi,Pi,Ni,"","\\ldots",!0),Ii(Ri,Pi,Ni,"","\\ldots",!0),Ii(Ri,Pi,Ni,"","\\@cdots",!0),Ii(Ri,Pi,Ni,"","\\ddots",!0),Ii(Ri,Pi,$i,"","\\varvdots"),Ii(Ri,Pi,Di,"","\\acute"),Ii(Ri,Pi,Di,"","\\grave"),Ii(Ri,Pi,Di,"","\\ddot"),Ii(Ri,Pi,Di,"~","\\tilde"),Ii(Ri,Pi,Di,"","\\bar"),Ii(Ri,Pi,Di,"","\\breve"),Ii(Ri,Pi,Di,"","\\check"),Ii(Ri,Pi,Di,"^","\\hat"),Ii(Ri,Pi,Di,"","\\vec"),Ii(Ri,Pi,Di,"","\\dot"),Ii(Ri,Pi,Di,"","\\mathring"),Ii(Ri,Pi,ji,"","\\@imath"),Ii(Ri,Pi,ji,"","\\@jmath"),Ii(Ri,Pi,$i,"",""),Ii(Ri,Pi,$i,"",""),Ii(Oi,Pi,$i,"","\\i",!0),Ii(Oi,Pi,$i,"","\\j",!0),Ii(Oi,Pi,$i,"","\\ss",!0),Ii(Oi,Pi,$i,"","\\ae",!0),Ii(Oi,Pi,$i,"","\\oe",!0),Ii(Oi,Pi,$i,"","\\o",!0),Ii(Oi,Pi,$i,"","\\AE",!0),Ii(Oi,Pi,$i,"","\\OE",!0),Ii(Oi,Pi,$i,"","\\O",!0),Ii(Oi,Pi,Di,"","\\'"),Ii(Oi,Pi,Di,"","\\`"),Ii(Oi,Pi,Di,"","\\^"),Ii(Oi,Pi,Di,"","\\~"),Ii(Oi,Pi,Di,"","\\="),Ii(Oi,Pi,Di,"","\\u"),Ii(Oi,Pi,Di,"","\\."),Ii(Oi,Pi,Di,"","\\c"),Ii(Oi,Pi,Di,"","\\r"),Ii(Oi,Pi,Di,"","\\v"),Ii(Oi,Pi,Di,"",'\\"'),Ii(Oi,Pi,Di,"","\\H"),Ii(Oi,Pi,Di,"","\\textcircled");var Vi={"--":!0,"---":!0,"``":!0,"''":!0};Ii(Oi,Pi,$i,"","--",!0),Ii(Oi,Pi,$i,"","\\textendash"),Ii(Oi,Pi,$i,"","---",!0),Ii(Oi,Pi,$i,"","\\textemdash"),Ii(Oi,Pi,$i,"","`",!0),Ii(Oi,Pi,$i,"","\\textquoteleft"),Ii(Oi,Pi,$i,"","'",!0),Ii(Oi,Pi,$i,"","\\textquoteright"),Ii(Oi,Pi,$i,"","``",!0),Ii(Oi,Pi,$i,"","\\textquotedblleft"),Ii(Oi,Pi,$i,"","''",!0),Ii(Oi,Pi,$i,"","\\textquotedblright"),Ii(Ri,Pi,$i,"","\\degree",!0),Ii(Oi,Pi,$i,"","\\degree"),Ii(Oi,Pi,$i,"","\\textdegree",!0),Ii(Ri,Pi,$i,"","\\pounds"),Ii(Ri,Pi,$i,"","\\mathsterling",!0),Ii(Oi,Pi,$i,"","\\pounds"),Ii(Oi,Pi,$i,"","\\textsterling",!0),Ii(Ri,Mi,$i,"","\\maltese"),Ii(Oi,Mi,$i,"","\\maltese");for(var Hi='0123456789/@."',Wi=0;Wi<Hi.length;Wi++){var Gi=Hi.charAt(Wi);Ii(Ri,Pi,$i,Gi,Gi)}for(var Yi='0123456789!@*()-=+";:?/.,',Xi=0;Xi<Yi.length;Xi++){var Zi=Yi.charAt(Xi);Ii(Oi,Pi,$i,Zi,Zi)}for(var Ji="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz",Qi=0;Qi<Ji.length;Qi++){var es=Ji.charAt(Qi);Ii(Ri,Pi,ji,es,es),Ii(Oi,Pi,$i,es,es)}Ii(Ri,Mi,$i,"C",""),Ii(Oi,Mi,$i,"C",""),Ii(Ri,Mi,$i,"H",""),Ii(Oi,Mi,$i,"H",""),Ii(Ri,Mi,$i,"N",""),Ii(Oi,Mi,$i,"N",""),Ii(Ri,Mi,$i,"P",""),Ii(Oi,Mi,$i,"P",""),Ii(Ri,Mi,$i,"Q",""),Ii(Oi,Mi,$i,"Q",""),Ii(Ri,Mi,$i,"R",""),Ii(Oi,Mi,$i,"R",""),Ii(Ri,Mi,$i,"Z",""),Ii(Oi,Mi,$i,"Z",""),Ii(Ri,Pi,ji,"h",""),Ii(Oi,Pi,ji,"h","");for(var ts="",ns=0;ns<Ji.length;ns++){var rs=Ji.charAt(ns);Ii(Ri,Pi,ji,rs,ts=String.fromCharCode(55349,56320+ns)),Ii(Oi,Pi,$i,rs,ts),Ii(Ri,Pi,ji,rs,ts=String.fromCharCode(55349,56372+ns)),Ii(Oi,Pi,$i,rs,ts),Ii(Ri,Pi,ji,rs,ts=String.fromCharCode(55349,56424+ns)),Ii(Oi,Pi,$i,rs,ts),Ii(Ri,Pi,ji,rs,ts=String.fromCharCode(55349,56580+ns)),Ii(Oi,Pi,$i,rs,ts),Ii(Ri,Pi,ji,rs,ts=String.fromCharCode(55349,56736+ns)),Ii(Oi,Pi,$i,rs,ts),Ii(Ri,Pi,ji,rs,ts=String.fromCharCode(55349,56788+ns)),Ii(Oi,Pi,$i,rs,ts),Ii(Ri,Pi,ji,rs,ts=String.fromCharCode(55349,56840+ns)),Ii(Oi,Pi,$i,rs,ts),Ii(Ri,Pi,ji,rs,ts=String.fromCharCode(55349,56944+ns)),Ii(Oi,Pi,$i,rs,ts),ns<26&&(Ii(Ri,Pi,ji,rs,ts=String.fromCharCode(55349,56632+ns)),Ii(Oi,Pi,$i,rs,ts),Ii(Ri,Pi,ji,rs,ts=String.fromCharCode(55349,56476+ns)),Ii(Oi,Pi,$i,rs,ts))}Ii(Ri,Pi,ji,"k",ts=String.fromCharCode(55349,56668)),Ii(Oi,Pi,$i,"k",ts);for(var is=0;is<10;is++){var ss=is.toString();Ii(Ri,Pi,ji,ss,ts=String.fromCharCode(55349,57294+is)),Ii(Oi,Pi,$i,ss,ts),Ii(Ri,Pi,ji,ss,ts=String.fromCharCode(55349,57314+is)),Ii(Oi,Pi,$i,ss,ts),Ii(Ri,Pi,ji,ss,ts=String.fromCharCode(55349,57324+is)),Ii(Oi,Pi,$i,ss,ts),Ii(Ri,Pi,ji,ss,ts=String.fromCharCode(55349,57334+is)),Ii(Oi,Pi,$i,ss,ts)}for(var os="",as=0;as<os.length;as++){var ls=os.charAt(as);Ii(Ri,Pi,ji,ls,ls),Ii(Oi,Pi,$i,ls,ls)}var cs=[["mathbf","textbf","Main-Bold"],["mathbf","textbf","Main-Bold"],["mathnormal","textit","Math-Italic"],["mathnormal","textit","Math-Italic"],["boldsymbol","boldsymbol","Main-BoldItalic"],["boldsymbol","boldsymbol","Main-BoldItalic"],["mathscr","textscr","Script-Regular"],["","",""],["","",""],["","",""],["mathfrak","textfrak","Fraktur-Regular"],["mathfrak","textfrak","Fraktur-Regular"],["mathbb","textbb","AMS-Regular"],["mathbb","textbb","AMS-Regular"],["","",""],["","",""],["mathsf","textsf","SansSerif-Regular"],["mathsf","textsf","SansSerif-Regular"],["mathboldsf","textboldsf","SansSerif-Bold"],["mathboldsf","textboldsf","SansSerif-Bold"],["mathitsf","textitsf","SansSerif-Italic"],["mathitsf","textitsf","SansSerif-Italic"],["","",""],["","",""],["mathtt","texttt","Typewriter-Regular"],["mathtt","texttt","Typewriter-Regular"]],ds=[["mathbf","textbf","Main-Bold"],["","",""],["mathsf","textsf","SansSerif-Regular"],["mathboldsf","textboldsf","SansSerif-Bold"],["mathtt","texttt","Typewriter-Regular"]],us=function(e,t,n){return Ai[n][e]&&Ai[n][e].replace&&(e=Ai[n][e].replace),{value:e,metrics:ni(e,t,n)}},hs=function(e,t,n,r,i){var s,o=us(e,t,n),a=o.metrics;if(e=o.value,a){var l=a.italic;("text"===n||r&&"mathit"===r.font)&&(l=0),s=new Si(e,a.height,a.depth,l,a.skew,a.width,i)}else"undefined"!=typeof console&&console.warn("No character metrics for '"+e+"' in style '"+t+"' and mode '"+n+"'"),s=new Si(e,0,0,0,0,0,i);if(r){s.maxFontSize=r.sizeMultiplier,r.style.isTight()&&s.classes.push("mtight");var c=r.getColor();c&&(s.style.color=c)}return s},ps=(e,t)=>{if(pi(e.classes)!==pi(t.classes)||e.skew!==t.skew||e.maxFontSize!==t.maxFontSize)return!1;if(1===e.classes.length){var n=e.classes[0];if("mbin"===n||"mord"===n)return!1}for(var r in e.style)if(e.style.hasOwnProperty(r)&&e.style[r]!==t.style[r])return!1;for(var i in t.style)if(t.style.hasOwnProperty(i)&&e.style[i]!==t.style[i])return!1;return!0},ms=function(e){for(var t=0,n=0,r=0,i=0;i<e.children.length;i++){var s=e.children[i];s.height>t&&(t=s.height),s.depth>n&&(n=s.depth),s.maxFontSize>r&&(r=s.maxFontSize)}e.height=t,e.depth=n,e.maxFontSize=r},gs=function(e,t,n,r){var i=new yi(e,t,n,r);return ms(i),i},fs=(e,t,n,r)=>new yi(e,t,n,r),ys=function(e){var t=new Jr(e);return ms(t),t},vs=function(e,t,n){var r="";switch(e){case"amsrm":r="AMS";break;case"textrm":r="Main";break;case"textsf":r="SansSerif";break;case"texttt":r="Typewriter";break;default:r=e}return r+"-"+("textbf"===t&&"textit"===n?"BoldItalic":"textbf"===t?"Bold":"textit"===t?"Italic":"Regular")},bs={mathbf:{variant:"bold",fontName:"Main-Bold"},mathrm:{variant:"normal",fontName:"Main-Regular"},textit:{variant:"italic",fontName:"Main-Italic"},mathit:{variant:"italic",fontName:"Main-Italic"},mathnormal:{variant:"italic",fontName:"Math-Italic"},mathbb:{variant:"double-struck",fontName:"AMS-Regular"},mathcal:{variant:"script",fontName:"Caligraphic-Regular"},mathfrak:{variant:"fraktur",fontName:"Fraktur-Regular"},mathscr:{variant:"script",fontName:"Script-Regular"},mathsf:{variant:"sans-serif",fontName:"SansSerif-Regular"},mathtt:{variant:"monospace",fontName:"Typewriter-Regular"}},ws={vec:["vec",.471,.714],oiintSize1:["oiintSize1",.957,.499],oiintSize2:["oiintSize2",1.472,.659],oiiintSize1:["oiiintSize1",1.304,.499],oiiintSize2:["oiiintSize2",1.98,.659]},Ss={fontMap:bs,makeSymbol:hs,mathsym:function(e,t,n,r){return void 0===r&&(r=[]),"boldsymbol"===n.font&&us(e,"Main-Bold",t).metrics?hs(e,"Main-Bold",t,n,r.concat(["mathbf"])):"\\"===e||"main"===Ai[t][e].font?hs(e,"Main-Regular",t,n,r):hs(e,"AMS-Regular",t,n,r.concat(["amsrm"]))},makeSpan:gs,makeSvgSpan:fs,makeLineSpan:function(e,t,n){var r=gs([e],[],t);return r.height=Math.max(n||t.fontMetrics().defaultRuleThickness,t.minRuleThickness),r.style.borderBottomWidth=hi(r.height),r.maxFontSize=1,r},makeAnchor:function(e,t,n,r){var i=new vi(e,t,n,r);return ms(i),i},makeFragment:ys,wrapFragment:function(e,t){return e instanceof Jr?gs([],[e],t):e},makeVList:function(e,t){for(var{children:n,depth:r}=function(e){if("individualShift"===e.positionType){for(var t=e.children,n=[t[0]],r=-t[0].shift-t[0].elem.depth,i=r,s=1;s<t.length;s++){var o=-t[s].shift-i-t[s].elem.depth,a=o-(t[s-1].elem.height+t[s-1].elem.depth);i+=o,n.push({type:"kern",size:a}),n.push(t[s])}return{children:n,depth:r}}var l;if("top"===e.positionType){for(var c=e.positionData,d=0;d<e.children.length;d++){var u=e.children[d];c-="kern"===u.type?u.size:u.elem.height+u.elem.depth}l=c}else if("bottom"===e.positionType)l=-e.positionData;else{var h=e.children[0];if("elem"!==h.type)throw new Error('First child must have type "elem".');if("shift"===e.positionType)l=-h.elem.depth-e.positionData;else{if("firstBaseline"!==e.positionType)throw new Error("Invalid positionType "+e.positionType+".");l=-h.elem.depth}}return{children:e.children,depth:l}}(e),i=0,s=0;s<n.length;s++){var o=n[s];if("elem"===o.type){var a=o.elem;i=Math.max(i,a.maxFontSize,a.height)}}i+=2;var l=gs(["pstrut"],[]);l.style.height=hi(i);for(var c=[],d=r,u=r,h=r,p=0;p<n.length;p++){var m=n[p];if("kern"===m.type)h+=m.size;else{var g=m.elem,f=m.wrapperClasses||[],y=m.wrapperStyle||{},v=gs(f,[l,g],void 0,y);v.style.top=hi(-i-h-g.depth),m.marginLeft&&(v.style.marginLeft=m.marginLeft),m.marginRight&&(v.style.marginRight=m.marginRight),c.push(v),h+=g.height+g.depth}d=Math.min(d,h),u=Math.max(u,h)}var b,w=gs(["vlist"],c);if(w.style.height=hi(u),d<0){var S=gs([],[]),_=gs(["vlist"],[S]);_.style.height=hi(-d);var k=gs(["vlist-s"],[new Si("")]);b=[gs(["vlist-r"],[w,k]),gs(["vlist-r"],[_])]}else b=[gs(["vlist-r"],[w])];var x=gs(["vlist-t"],b);return 2===b.length&&x.classes.push("vlist-t2"),x.height=u,x.depth=-d,x},makeOrd:function(e,t,n){var r=e.mode,i=e.text,s=["mord"],o="math"===r||"text"===r&&t.font,a=o?t.font:t.fontFamily;if(55349===i.charCodeAt(0)){var[l,c]=function(e,t){var n=1024*(e.charCodeAt(0)-55296)+(e.charCodeAt(1)-56320)+65536,r="math"===t?0:1;if(119808<=n&&n<120484){var i=Math.floor((n-119808)/26);return[cs[i][2],cs[i][r]]}if(120782<=n&&n<=120831){var s=Math.floor((n-120782)/10);return[ds[s][2],ds[s][r]]}if(120485===n||120486===n)return[cs[0][2],cs[0][r]];if(120486<n&&n<120782)return["",""];throw new xr("Unsupported character: "+e)}(i,r);return hs(i,l,r,t,s.concat(c))}if(a){var d,u;if("boldsymbol"===a){var h=function(e,t,n,r,i){return"textord"!==i&&us(e,"Math-BoldItalic",t).metrics?{fontName:"Math-BoldItalic",fontClass:"boldsymbol"}:{fontName:"Main-Bold",fontClass:"mathbf"}}(i,r,0,0,n);d=h.fontName,u=[h.fontClass]}else o?(d=bs[a].fontName,u=[a]):(d=vs(a,t.fontWeight,t.fontShape),u=[a,t.fontWeight,t.fontShape]);if(us(i,d,r).metrics)return hs(i,d,r,t,s.concat(u));if(Vi.hasOwnProperty(i)&&"Typewriter"===d.substr(0,10)){for(var p=[],m=0;m<i.length;m++)p.push(hs(i[m],d,r,t,s.concat(u)));return ys(p)}}if("mathord"===n)return hs(i,"Math-Italic",r,t,s.concat(["mathnormal"]));if("textord"===n){var g=Ai[r][i]&&Ai[r][i].font;if("ams"===g){var f=vs("amsrm",t.fontWeight,t.fontShape);return hs(i,f,r,t,s.concat("amsrm",t.fontWeight,t.fontShape))}if("main"!==g&&g){var y=vs(g,t.fontWeight,t.fontShape);return hs(i,y,r,t,s.concat(y,t.fontWeight,t.fontShape))}var v=vs("textrm",t.fontWeight,t.fontShape);return hs(i,v,r,t,s.concat(t.fontWeight,t.fontShape))}throw new Error("unexpected type: "+n+" in makeOrd")},makeGlue:(e,t)=>{var n=gs(["mspace"],[],t),r=ui(e,t);return n.style.marginRight=hi(r),n},staticSvg:function(e,t){var[n,r,i]=ws[e],s=new ki(n),o=new _i([s],{width:hi(r),height:hi(i),style:"width:"+hi(r),viewBox:"0 0 "+1e3*r+" "+1e3*i,preserveAspectRatio:"xMinYMin"}),a=fs(["overlay"],[o],t);return a.height=i,a.style.height=hi(i),a.style.width=hi(r),a},svgData:ws,tryCombineChars:e=>{for(var t=0;t<e.length-1;t++){var n=e[t],r=e[t+1];n instanceof Si&&r instanceof Si&&ps(n,r)&&(n.text+=r.text,n.height=Math.max(n.height,r.height),n.depth=Math.max(n.depth,r.depth),n.italic=r.italic,e.splice(t+1,1),t--)}return e}},_s={number:3,unit:"mu"},ks={number:4,unit:"mu"},xs={number:5,unit:"mu"},Es={mord:{mop:_s,mbin:ks,mrel:xs,minner:_s},mop:{mord:_s,mop:_s,mrel:xs,minner:_s},mbin:{mord:ks,mop:ks,mopen:ks,minner:ks},mrel:{mord:xs,mop:xs,mopen:xs,minner:xs},mopen:{},mclose:{mop:_s,mbin:ks,mrel:xs,minner:_s},mpunct:{mord:_s,mop:_s,mrel:xs,mopen:_s,mclose:_s,mpunct:_s,minner:_s},minner:{mord:_s,mop:_s,mbin:ks,mrel:xs,mopen:_s,mpunct:_s,minner:_s}},Ts={mord:{mop:_s},mop:{mord:_s,mop:_s},mbin:{},mrel:{},mopen:{},mclose:{mop:_s},mpunct:{},minner:{mop:_s}},Cs={},As={},Is={};function Rs(e){for(var{type:t,names:n,props:r,handler:i,htmlBuilder:s,mathmlBuilder:o}=e,a={type:t,numArgs:r.numArgs,argTypes:r.argTypes,allowedInArgument:!!r.allowedInArgument,allowedInText:!!r.allowedInText,allowedInMath:void 0===r.allowedInMath||r.allowedInMath,numOptionalArgs:r.numOptionalArgs||0,infix:!!r.infix,primitive:!!r.primitive,handler:i},l=0;l<n.length;++l)Cs[n[l]]=a;t&&(s&&(As[t]=s),o&&(Is[t]=o))}function Os(e){var{type:t,htmlBuilder:n,mathmlBuilder:r}=e;Rs({type:t,names:[],props:{numArgs:0},handler(){throw new Error("Should never be called.")},htmlBuilder:n,mathmlBuilder:r})}var Ps=function(e){return"ordgroup"===e.type&&1===e.body.length?e.body[0]:e},Ms=function(e){return"ordgroup"===e.type?e.body:[e]},Ds=Ss.makeSpan,Ls=["leftmost","mbin","mopen","mrel","mop","mpunct"],Fs=["rightmost","mrel","mclose","mpunct"],Ns={display:Wr.DISPLAY,text:Wr.TEXT,script:Wr.SCRIPT,scriptscript:Wr.SCRIPTSCRIPT},js={mord:"mord",mop:"mop",mbin:"mbin",mrel:"mrel",mopen:"mopen",mclose:"mclose",mpunct:"mpunct",minner:"minner"},Us=function(e,t,n,r){void 0===r&&(r=[null,null]);for(var i=[],s=0;s<e.length;s++){var o=Vs(e[s],t);if(o instanceof Jr){var a=o.children;i.push(...a)}else i.push(o)}if(Ss.tryCombineChars(i),!n)return i;var l=t;if(1===e.length){var c=e[0];"sizing"===c.type?l=t.havingSize(c.size):"styling"===c.type&&(l=t.havingStyle(Ns[c.style]))}var d=Ds([r[0]||"leftmost"],[],t),u=Ds([r[1]||"rightmost"],[],t),h="root"===n;return Bs(i,((e,t)=>{var n=t.classes[0],r=e.classes[0];"mbin"===n&&Ir(Fs,r)?t.classes[0]="mord":"mbin"===r&&Ir(Ls,n)&&(e.classes[0]="mord")}),{node:d},u,h),Bs(i,((e,t)=>{var n=zs(t),r=zs(e),i=n&&r?e.hasClass("mtight")?Ts[n][r]:Es[n][r]:null;if(i)return Ss.makeGlue(i,l)}),{node:d},u,h),i},Bs=function e(t,n,r,i,s){i&&t.push(i);for(var o=0;o<t.length;o++){var a=t[o],l=qs(a);if(l)e(l.children,n,r,null,s);else{var c=!a.hasClass("mspace");if(c){var d=n(a,r.node);d&&(r.insertAfter?r.insertAfter(d):(t.unshift(d),o++))}c?r.node=a:s&&a.hasClass("newline")&&(r.node=Ds(["leftmost"])),r.insertAfter=(e=>n=>{t.splice(e+1,0,n),o++})(o)}}i&&t.pop()},qs=function(e){return e instanceof Jr||e instanceof vi||e instanceof yi&&e.hasClass("enclosing")?e:null},Ks=function e(t,n){var r=qs(t);if(r){var i=r.children;if(i.length){if("right"===n)return e(i[i.length-1],"right");if("left"===n)return e(i[0],"left")}}return t},zs=function(e,t){return e?(t&&(e=Ks(e,t)),js[e.classes[0]]||null):null},$s=function(e,t){var n=["nulldelimiter"].concat(e.baseSizingClasses());return Ds(t.concat(n))},Vs=function(e,t,n){if(!e)return Ds();if(As[e.type]){var r=As[e.type](e,t);if(n&&t.size!==n.size){r=Ds(t.sizingClasses(n),[r],t);var i=t.sizeMultiplier/n.sizeMultiplier;r.height*=i,r.depth*=i}return r}throw new xr("Got group of unknown type: '"+e.type+"'")};function Hs(e,t){var n=Ds(["base"],e,t),r=Ds(["strut"]);return r.style.height=hi(n.height+n.depth),n.depth&&(r.style.verticalAlign=hi(-n.depth)),n.children.unshift(r),n}function Ws(e,t){var n=null;1===e.length&&"tag"===e[0].type&&(n=e[0].tag,e=e[0].body);var r,i=Us(e,t,"root");2===i.length&&i[1].hasClass("tag")&&(r=i.pop());for(var s,o=[],a=[],l=0;l<i.length;l++)if(a.push(i[l]),i[l].hasClass("mbin")||i[l].hasClass("mrel")||i[l].hasClass("allowbreak")){for(var c=!1;l<i.length-1&&i[l+1].hasClass("mspace")&&!i[l+1].hasClass("newline");)l++,a.push(i[l]),i[l].hasClass("nobreak")&&(c=!0);c||(o.push(Hs(a,t)),a=[])}else i[l].hasClass("newline")&&(a.pop(),a.length>0&&(o.push(Hs(a,t)),a=[]),o.push(i[l]));a.length>0&&o.push(Hs(a,t)),n?((s=Hs(Us(n,t,!0))).classes=["tag"],o.push(s)):r&&o.push(r);var d=Ds(["katex-html"],o);if(d.setAttribute("aria-hidden","true"),s){var u=s.children[0];u.style.height=hi(d.height+d.depth),d.depth&&(u.style.verticalAlign=hi(-d.depth))}return d}function Gs(e){return new Jr(e)}class Ys{constructor(e,t,n){this.type=void 0,this.attributes=void 0,this.children=void 0,this.classes=void 0,this.type=e,this.attributes={},this.children=t||[],this.classes=n||[]}setAttribute(e,t){this.attributes[e]=t}getAttribute(e){return this.attributes[e]}toNode(){var e=document.createElementNS("http://www.w3.org/1998/Math/MathML",this.type);for(var t in this.attributes)Object.prototype.hasOwnProperty.call(this.attributes,t)&&e.setAttribute(t,this.attributes[t]);this.classes.length>0&&(e.className=pi(this.classes));for(var n=0;n<this.children.length;n++)e.appendChild(this.children[n].toNode());return e}toMarkup(){var e="<"+this.type;for(var t in this.attributes)Object.prototype.hasOwnProperty.call(this.attributes,t)&&(e+=" "+t+'="',e+=Or(this.attributes[t]),e+='"');this.classes.length>0&&(e+=' class ="'+Or(pi(this.classes))+'"'),e+=">";for(var n=0;n<this.children.length;n++)e+=this.children[n].toMarkup();return e+"</"+this.type+">"}toText(){return this.children.map((e=>e.toText())).join("")}}class Xs{constructor(e){this.text=void 0,this.text=e}toNode(){return document.createTextNode(this.text)}toMarkup(){return Or(this.toText())}toText(){return this.text}}var Zs={MathNode:Ys,TextNode:Xs,SpaceNode:class{constructor(e){this.width=void 0,this.character=void 0,this.width=e,this.character=e>=.05555&&e<=.05556?"":e>=.1666&&e<=.1667?"":e>=.2222&&e<=.2223?"":e>=.2777&&e<=.2778?"":e>=-.05556&&e<=-.05555?"":e>=-.1667&&e<=-.1666?"":e>=-.2223&&e<=-.2222?"":e>=-.2778&&e<=-.2777?"":null}toNode(){if(this.character)return document.createTextNode(this.character);var e=document.createElementNS("http://www.w3.org/1998/Math/MathML","mspace");return e.setAttribute("width",hi(this.width)),e}toMarkup(){return this.character?"<mtext>"+this.character+"</mtext>":'<mspace width="'+hi(this.width)+'"/>'}toText(){return this.character?this.character:" "}},newDocumentFragment:Gs},Js=function(e,t,n){return!Ai[t][e]||!Ai[t][e].replace||55349===e.charCodeAt(0)||Vi.hasOwnProperty(e)&&n&&(n.fontFamily&&"tt"===n.fontFamily.substr(4,2)||n.font&&"tt"===n.font.substr(4,2))||(e=Ai[t][e].replace),new Zs.TextNode(e)},Qs=function(e){return 1===e.length?e[0]:new Zs.MathNode("mrow",e)},eo=function(e,t){if("texttt"===t.fontFamily)return"monospace";if("textsf"===t.fontFamily)return"textit"===t.fontShape&&"textbf"===t.fontWeight?"sans-serif-bold-italic":"textit"===t.fontShape?"sans-serif-italic":"textbf"===t.fontWeight?"bold-sans-serif":"sans-serif";if("textit"===t.fontShape&&"textbf"===t.fontWeight)return"bold-italic";if("textit"===t.fontShape)return"italic";if("textbf"===t.fontWeight)return"bold";var n=t.font;if(!n||"mathnormal"===n)return null;var r=e.mode;if("mathit"===n)return"italic";if("boldsymbol"===n)return"textord"===e.type?"bold":"bold-italic";if("mathbf"===n)return"bold";if("mathbb"===n)return"double-struck";if("mathfrak"===n)return"fraktur";if("mathscr"===n||"mathcal"===n)return"script";if("mathsf"===n)return"sans-serif";if("mathtt"===n)return"monospace";var i=e.text;return Ir(["\\imath","\\jmath"],i)?null:(Ai[r][i]&&Ai[r][i].replace&&(i=Ai[r][i].replace),ni(i,Ss.fontMap[n].fontName,r)?Ss.fontMap[n].variant:null)},to=function(e,t,n){if(1===e.length){var r=ro(e[0],t);return n&&r instanceof Ys&&"mo"===r.type&&(r.setAttribute("lspace","0em"),r.setAttribute("rspace","0em")),[r]}for(var i,s=[],o=0;o<e.length;o++){var a=ro(e[o],t);if(a instanceof Ys&&i instanceof Ys){if("mtext"===a.type&&"mtext"===i.type&&a.getAttribute("mathvariant")===i.getAttribute("mathvariant")){i.children.push(...a.children);continue}if("mn"===a.type&&"mn"===i.type){i.children.push(...a.children);continue}if("mi"===a.type&&1===a.children.length&&"mn"===i.type){var l=a.children[0];if(l instanceof Xs&&"."===l.text){i.children.push(...a.children);continue}}else if("mi"===i.type&&1===i.children.length){var c=i.children[0];if(c instanceof Xs&&""===c.text&&("mo"===a.type||"mi"===a.type||"mn"===a.type)){var d=a.children[0];d instanceof Xs&&d.text.length>0&&(d.text=d.text.slice(0,1)+""+d.text.slice(1),s.pop())}}}s.push(a),i=a}return s},no=function(e,t,n){return Qs(to(e,t,n))},ro=function(e,t){if(!e)return new Zs.MathNode("mrow");if(Is[e.type])return Is[e.type](e,t);throw new xr("Got group of unknown type: '"+e.type+"'")};function io(e,t,n,r,i){var s,o=to(e,n);s=1===o.length&&o[0]instanceof Ys&&Ir(["mrow","mtable"],o[0].type)?o[0]:new Zs.MathNode("mrow",o);var a=new Zs.MathNode("annotation",[new Zs.TextNode(t)]);a.setAttribute("encoding","application/x-tex");var l=new Zs.MathNode("semantics",[s,a]),c=new Zs.MathNode("math",[l]);return c.setAttribute("xmlns","http://www.w3.org/1998/Math/MathML"),r&&c.setAttribute("display","block"),Ss.makeSpan([i?"katex":"katex-mathml"],[c])}var so=function(e){return new ai({style:e.displayMode?Wr.DISPLAY:Wr.TEXT,maxSize:e.maxSize,minRuleThickness:e.minRuleThickness})},oo=function(e,t){if(t.displayMode){var n=["katex-display"];t.leqno&&n.push("leqno"),t.fleqn&&n.push("fleqn"),e=Ss.makeSpan(n,[e])}return e},ao={widehat:"^",widecheck:"",widetilde:"~",utilde:"~",overleftarrow:"",underleftarrow:"",xleftarrow:"",overrightarrow:"",underrightarrow:"",xrightarrow:"",underbrace:"",overbrace:"",overgroup:"",undergroup:"",overleftrightarrow:"",underleftrightarrow:"",xleftrightarrow:"",Overrightarrow:"",xRightarrow:"",overleftharpoon:"",xleftharpoonup:"",overrightharpoon:"",xrightharpoonup:"",xLeftarrow:"",xLeftrightarrow:"",xhookleftarrow:"",xhookrightarrow:"",xmapsto:"",xrightharpoondown:"",xleftharpoondown:"",xrightleftharpoons:"",xleftrightharpoons:"",xtwoheadleftarrow:"",xtwoheadrightarrow:"",xlongequal:"=",xtofrom:"",xrightleftarrows:"",xrightequilibrium:"",xleftequilibrium:"","\\cdrightarrow":"","\\cdleftarrow":"","\\cdlongequal":"="},lo={overrightarrow:[["rightarrow"],.888,522,"xMaxYMin"],overleftarrow:[["leftarrow"],.888,522,"xMinYMin"],underrightarrow:[["rightarrow"],.888,522,"xMaxYMin"],underleftarrow:[["leftarrow"],.888,522,"xMinYMin"],xrightarrow:[["rightarrow"],1.469,522,"xMaxYMin"],"\\cdrightarrow":[["rightarrow"],3,522,"xMaxYMin"],xleftarrow:[["leftarrow"],1.469,522,"xMinYMin"],"\\cdleftarrow":[["leftarrow"],3,522,"xMinYMin"],Overrightarrow:[["doublerightarrow"],.888,560,"xMaxYMin"],xRightarrow:[["doublerightarrow"],1.526,560,"xMaxYMin"],xLeftarrow:[["doubleleftarrow"],1.526,560,"xMinYMin"],overleftharpoon:[["leftharpoon"],.888,522,"xMinYMin"],xleftharpoonup:[["leftharpoon"],.888,522,"xMinYMin"],xleftharpoondown:[["leftharpoondown"],.888,522,"xMinYMin"],overrightharpoon:[["rightharpoon"],.888,522,"xMaxYMin"],xrightharpoonup:[["rightharpoon"],.888,522,"xMaxYMin"],xrightharpoondown:[["rightharpoondown"],.888,522,"xMaxYMin"],xlongequal:[["longequal"],.888,334,"xMinYMin"],"\\cdlongequal":[["longequal"],3,334,"xMinYMin"],xtwoheadleftarrow:[["twoheadleftarrow"],.888,334,"xMinYMin"],xtwoheadrightarrow:[["twoheadrightarrow"],.888,334,"xMaxYMin"],overleftrightarrow:[["leftarrow","rightarrow"],.888,522],overbrace:[["leftbrace","midbrace","rightbrace"],1.6,548],underbrace:[["leftbraceunder","midbraceunder","rightbraceunder"],1.6,548],underleftrightarrow:[["leftarrow","rightarrow"],.888,522],xleftrightarrow:[["leftarrow","rightarrow"],1.75,522],xLeftrightarrow:[["doubleleftarrow","doublerightarrow"],1.75,560],xrightleftharpoons:[["leftharpoondownplus","rightharpoonplus"],1.75,716],xleftrightharpoons:[["leftharpoonplus","rightharpoondownplus"],1.75,716],xhookleftarrow:[["leftarrow","righthook"],1.08,522],xhookrightarrow:[["lefthook","rightarrow"],1.08,522],overlinesegment:[["leftlinesegment","rightlinesegment"],.888,522],underlinesegment:[["leftlinesegment","rightlinesegment"],.888,522],overgroup:[["leftgroup","rightgroup"],.888,342],undergroup:[["leftgroupunder","rightgroupunder"],.888,342],xmapsto:[["leftmapsto","rightarrow"],1.5,522],xtofrom:[["leftToFrom","rightToFrom"],1.75,528],xrightleftarrows:[["baraboveleftarrow","rightarrowabovebar"],1.75,901],xrightequilibrium:[["baraboveshortleftharpoon","rightharpoonaboveshortbar"],1.75,716],xleftequilibrium:[["shortbaraboveleftharpoon","shortrightharpoonabovebar"],1.75,716]},co=function(e){var t=new Zs.MathNode("mo",[new Zs.TextNode(ao[e.replace(/^\\/,"")])]);return t.setAttribute("stretchy","true"),t},uo=function(e,t){var{span:n,minWidth:r,height:i}=function(){var n=4e5,r=e.label.substr(1);if(Ir(["widehat","widecheck","widetilde","utilde"],r)){var i,s,o,a="ordgroup"===(p=e.base).type?p.body.length:1;if(a>5)"widehat"===r||"widecheck"===r?(i=420,n=2364,o=.42,s=r+"4"):(i=312,n=2340,o=.34,s="tilde4");else{var l=[1,1,2,2,3,3][a];"widehat"===r||"widecheck"===r?(n=[0,1062,2364,2364,2364][l],i=[0,239,300,360,420][l],o=[0,.24,.3,.3,.36,.42][l],s=r+l):(n=[0,600,1033,2339,2340][l],i=[0,260,286,306,312][l],o=[0,.26,.286,.3,.306,.34][l],s="tilde"+l)}var c=new ki(s),d=new _i([c],{width:"100%",height:hi(o),viewBox:"0 0 "+n+" "+i,preserveAspectRatio:"none"});return{span:Ss.makeSvgSpan([],[d],t),minWidth:0,height:o}}var u,h,p,m=[],g=lo[r],[f,y,v]=g,b=v/1e3,w=f.length;if(1===w)u=["hide-tail"],h=[g[3]];else if(2===w)u=["halfarrow-left","halfarrow-right"],h=["xMinYMin","xMaxYMin"];else{if(3!==w)throw new Error("Correct katexImagesData or update code here to support\n                    "+w+" children.");u=["brace-left","brace-center","brace-right"],h=["xMinYMin","xMidYMin","xMaxYMin"]}for(var S=0;S<w;S++){var _=new ki(f[S]),k=new _i([_],{width:"400em",height:hi(b),viewBox:"0 0 "+n+" "+v,preserveAspectRatio:h[S]+" slice"}),x=Ss.makeSvgSpan([u[S]],[k],t);if(1===w)return{span:x,minWidth:y,height:b};x.style.height=hi(b),m.push(x)}return{span:Ss.makeSpan(["stretchy"],m,t),minWidth:y,height:b}}();return n.height=i,n.style.height=hi(i),r>0&&(n.style.minWidth=hi(r)),n};function ho(e,t){if(!e||e.type!==t)throw new Error("Expected node of type "+t+", but got "+(e?"node of type "+e.type:String(e)));return e}function po(e){var t=mo(e);if(!t)throw new Error("Expected node of symbol group type, but got "+(e?"node of type "+e.type:String(e)));return t}function mo(e){return e&&("atom"===e.type||Ci.hasOwnProperty(e.type))?e:null}var go=(e,t)=>{var n,r,i;e&&"supsub"===e.type?(n=(r=ho(e.base,"accent")).base,e.base=n,i=function(e){if(e instanceof yi)return e;throw new Error("Expected span<HtmlDomNode> but got "+String(e)+".")}(Vs(e,t)),e.base=r):n=(r=ho(e,"accent")).base;var s=Vs(n,t.havingCrampedStyle()),o=0;if(r.isShifty&&Dr(n)){var a=Mr(n);o=Ei(Vs(a,t.havingCrampedStyle())).skew}var l,c="\\c"===r.label,d=c?s.height+s.depth:Math.min(s.height,t.fontMetrics().xHeight);if(r.isStretchy)l=uo(r,t),l=Ss.makeVList({positionType:"firstBaseline",children:[{type:"elem",elem:s},{type:"elem",elem:l,wrapperClasses:["svg-align"],wrapperStyle:o>0?{width:"calc(100% - "+hi(2*o)+")",marginLeft:hi(2*o)}:void 0}]},t);else{var u,h;"\\vec"===r.label?(u=Ss.staticSvg("vec",t),h=Ss.svgData.vec[1]):((u=Ei(u=Ss.makeOrd({mode:r.mode,text:r.label},t,"textord"))).italic=0,h=u.width,c&&(d+=u.depth)),l=Ss.makeSpan(["accent-body"],[u]);var p="\\textcircled"===r.label;p&&(l.classes.push("accent-full"),d=s.height);var m=o;p||(m-=h/2),l.style.left=hi(m),"\\textcircled"===r.label&&(l.style.top=".2em"),l=Ss.makeVList({positionType:"firstBaseline",children:[{type:"elem",elem:s},{type:"kern",size:-d},{type:"elem",elem:l}]},t)}var g=Ss.makeSpan(["mord","accent"],[l],t);return i?(i.children[0]=g,i.height=Math.max(g.height,i.height),i.classes[0]="mord",i):g},fo=(e,t)=>{var n=e.isStretchy?co(e.label):new Zs.MathNode("mo",[Js(e.label,e.mode)]),r=new Zs.MathNode("mover",[ro(e.base,t),n]);return r.setAttribute("accent","true"),r},yo=new RegExp(["\\acute","\\grave","\\ddot","\\tilde","\\bar","\\breve","\\check","\\hat","\\vec","\\dot","\\mathring"].map((e=>"\\"+e)).join("|"));Rs({type:"accent",names:["\\acute","\\grave","\\ddot","\\tilde","\\bar","\\breve","\\check","\\hat","\\vec","\\dot","\\mathring","\\widecheck","\\widehat","\\widetilde","\\overrightarrow","\\overleftarrow","\\Overrightarrow","\\overleftrightarrow","\\overgroup","\\overlinesegment","\\overleftharpoon","\\overrightharpoon"],props:{numArgs:1},handler:(e,t)=>{var n=Ps(t[0]),r=!yo.test(e.funcName),i=!r||"\\widehat"===e.funcName||"\\widetilde"===e.funcName||"\\widecheck"===e.funcName;return{type:"accent",mode:e.parser.mode,label:e.funcName,isStretchy:r,isShifty:i,base:n}},htmlBuilder:go,mathmlBuilder:fo}),Rs({type:"accent",names:["\\'","\\`","\\^","\\~","\\=","\\u","\\.",'\\"',"\\c","\\r","\\H","\\v","\\textcircled"],props:{numArgs:1,allowedInText:!0,allowedInMath:!0,argTypes:["primitive"]},handler:(e,t)=>{var n=t[0],r=e.parser.mode;return"math"===r&&(e.parser.settings.reportNonstrict("mathVsTextAccents","LaTeX's accent "+e.funcName+" works only in text mode"),r="text"),{type:"accent",mode:r,label:e.funcName,isStretchy:!1,isShifty:!0,base:n}},htmlBuilder:go,mathmlBuilder:fo}),Rs({type:"accentUnder",names:["\\underleftarrow","\\underrightarrow","\\underleftrightarrow","\\undergroup","\\underlinesegment","\\utilde"],props:{numArgs:1},handler:(e,t)=>{var{parser:n,funcName:r}=e,i=t[0];return{type:"accentUnder",mode:n.mode,label:r,base:i}},htmlBuilder:(e,t)=>{var n=Vs(e.base,t),r=uo(e,t),i="\\utilde"===e.label?.12:0,s=Ss.makeVList({positionType:"top",positionData:n.height,children:[{type:"elem",elem:r,wrapperClasses:["svg-align"]},{type:"kern",size:i},{type:"elem",elem:n}]},t);return Ss.makeSpan(["mord","accentunder"],[s],t)},mathmlBuilder:(e,t)=>{var n=co(e.label),r=new Zs.MathNode("munder",[ro(e.base,t),n]);return r.setAttribute("accentunder","true"),r}});var vo=e=>{var t=new Zs.MathNode("mpadded",e?[e]:[]);return t.setAttribute("width","+0.6em"),t.setAttribute("lspace","0.3em"),t};Rs({type:"xArrow",names:["\\xleftarrow","\\xrightarrow","\\xLeftarrow","\\xRightarrow","\\xleftrightarrow","\\xLeftrightarrow","\\xhookleftarrow","\\xhookrightarrow","\\xmapsto","\\xrightharpoondown","\\xrightharpoonup","\\xleftharpoondown","\\xleftharpoonup","\\xrightleftharpoons","\\xleftrightharpoons","\\xlongequal","\\xtwoheadrightarrow","\\xtwoheadleftarrow","\\xtofrom","\\xrightleftarrows","\\xrightequilibrium","\\xleftequilibrium","\\\\cdrightarrow","\\\\cdleftarrow","\\\\cdlongequal"],props:{numArgs:1,numOptionalArgs:1},handler(e,t,n){var{parser:r,funcName:i}=e;return{type:"xArrow",mode:r.mode,label:i,body:t[0],below:n[0]}},htmlBuilder(e,t){var n,r=t.style,i=t.havingStyle(r.sup()),s=Ss.wrapFragment(Vs(e.body,i,t),t),o="\\x"===e.label.slice(0,2)?"x":"cd";s.classes.push(o+"-arrow-pad"),e.below&&(i=t.havingStyle(r.sub()),(n=Ss.wrapFragment(Vs(e.below,i,t),t)).classes.push(o+"-arrow-pad"));var a,l=uo(e,t),c=-t.fontMetrics().axisHeight+.5*l.height,d=-t.fontMetrics().axisHeight-.5*l.height-.111;if((s.depth>.25||"\\xleftequilibrium"===e.label)&&(d-=s.depth),n){var u=-t.fontMetrics().axisHeight+n.height+.5*l.height+.111;a=Ss.makeVList({positionType:"individualShift",children:[{type:"elem",elem:s,shift:d},{type:"elem",elem:l,shift:c},{type:"elem",elem:n,shift:u}]},t)}else a=Ss.makeVList({positionType:"individualShift",children:[{type:"elem",elem:s,shift:d},{type:"elem",elem:l,shift:c}]},t);return a.children[0].children[0].children[1].classes.push("svg-align"),Ss.makeSpan(["mrel","x-arrow"],[a],t)},mathmlBuilder(e,t){var n,r=co(e.label);if(r.setAttribute("minsize","x"===e.label.charAt(0)?"1.75em":"3.0em"),e.body){var i=vo(ro(e.body,t));if(e.below){var s=vo(ro(e.below,t));n=new Zs.MathNode("munderover",[r,s,i])}else n=new Zs.MathNode("mover",[r,i])}else if(e.below){var o=vo(ro(e.below,t));n=new Zs.MathNode("munder",[r,o])}else n=vo(),n=new Zs.MathNode("mover",[r,n]);return n}});var bo={">":"\\\\cdrightarrow","<":"\\\\cdleftarrow","=":"\\\\cdlongequal",A:"\\uparrow",V:"\\downarrow","|":"\\Vert",".":"no arrow"},wo=e=>"textord"===e.type&&"@"===e.text;function So(e,t,n){var r=bo[e];switch(r){case"\\\\cdrightarrow":case"\\\\cdleftarrow":return n.callFunction(r,[t[0]],[t[1]]);case"\\uparrow":case"\\downarrow":var i={type:"atom",text:r,mode:"math",family:"rel"},s={type:"ordgroup",mode:"math",body:[n.callFunction("\\\\cdleft",[t[0]],[]),n.callFunction("\\Big",[i],[]),n.callFunction("\\\\cdright",[t[1]],[])]};return n.callFunction("\\\\cdparent",[s],[]);case"\\\\cdlongequal":return n.callFunction("\\\\cdlongequal",[],[]);case"\\Vert":return n.callFunction("\\Big",[{type:"textord",text:"\\Vert",mode:"math"}],[]);default:return{type:"textord",text:" ",mode:"math"}}}Rs({type:"cdlabel",names:["\\\\cdleft","\\\\cdright"],props:{numArgs:1},handler(e,t){var{parser:n,funcName:r}=e;return{type:"cdlabel",mode:n.mode,side:r.slice(4),label:t[0]}},htmlBuilder(e,t){var n=t.havingStyle(t.style.sup()),r=Ss.wrapFragment(Vs(e.label,n,t),t);return r.classes.push("cd-label-"+e.side),r.style.bottom=hi(.8-r.depth),r.height=0,r.depth=0,r},mathmlBuilder(e,t){var n=new Zs.MathNode("mrow",[ro(e.label,t)]);return(n=new Zs.MathNode("mpadded",[n])).setAttribute("width","0"),"left"===e.side&&n.setAttribute("lspace","-1width"),n.setAttribute("voffset","0.7em"),(n=new Zs.MathNode("mstyle",[n])).setAttribute("displaystyle","false"),n.setAttribute("scriptlevel","1"),n}}),Rs({type:"cdlabelparent",names:["\\\\cdparent"],props:{numArgs:1},handler(e,t){var{parser:n}=e;return{type:"cdlabelparent",mode:n.mode,fragment:t[0]}},htmlBuilder(e,t){var n=Ss.wrapFragment(Vs(e.fragment,t),t);return n.classes.push("cd-vert-arrow"),n},mathmlBuilder:(e,t)=>new Zs.MathNode("mrow",[ro(e.fragment,t)])}),Rs({type:"textord",names:["\\@char"],props:{numArgs:1,allowedInText:!0},handler(e,t){for(var{parser:n}=e,r=ho(t[0],"ordgroup").body,i="",s=0;s<r.length;s++)i+=ho(r[s],"textord").text;var o,a=parseInt(i);if(isNaN(a))throw new xr("\\@char has non-numeric argument "+i);if(a<0||a>=1114111)throw new xr("\\@char with invalid code point "+i);return a<=65535?o=String.fromCharCode(a):(a-=65536,o=String.fromCharCode(55296+(a>>10),56320+(1023&a))),{type:"textord",mode:n.mode,text:o}}});var _o=(e,t)=>{var n=Us(e.body,t.withColor(e.color),!1);return Ss.makeFragment(n)},ko=(e,t)=>{var n=to(e.body,t.withColor(e.color)),r=new Zs.MathNode("mstyle",n);return r.setAttribute("mathcolor",e.color),r};Rs({type:"color",names:["\\textcolor"],props:{numArgs:2,allowedInText:!0,argTypes:["color","original"]},handler(e,t){var{parser:n}=e,r=ho(t[0],"color-token").color,i=t[1];return{type:"color",mode:n.mode,color:r,body:Ms(i)}},htmlBuilder:_o,mathmlBuilder:ko}),Rs({type:"color",names:["\\color"],props:{numArgs:1,allowedInText:!0,argTypes:["color"]},handler(e,t){var{parser:n,breakOnTokenText:r}=e,i=ho(t[0],"color-token").color;n.gullet.macros.set("\\current@color",i);var s=n.parseExpression(!0,r);return{type:"color",mode:n.mode,color:i,body:s}},htmlBuilder:_o,mathmlBuilder:ko}),Rs({type:"cr",names:["\\\\"],props:{numArgs:0,numOptionalArgs:1,argTypes:["size"],allowedInText:!0},handler(e,t,n){var{parser:r}=e,i=n[0],s=!r.settings.displayMode||!r.settings.useStrictBehavior("newLineInDisplayMode","In LaTeX, \\\\ or \\newline does nothing in display mode");return{type:"cr",mode:r.mode,newLine:s,size:i&&ho(i,"size").value}},htmlBuilder(e,t){var n=Ss.makeSpan(["mspace"],[],t);return e.newLine&&(n.classes.push("newline"),e.size&&(n.style.marginTop=hi(ui(e.size,t)))),n},mathmlBuilder(e,t){var n=new Zs.MathNode("mspace");return e.newLine&&(n.setAttribute("linebreak","newline"),e.size&&n.setAttribute("height",hi(ui(e.size,t)))),n}});var xo={"\\global":"\\global","\\long":"\\\\globallong","\\\\globallong":"\\\\globallong","\\def":"\\gdef","\\gdef":"\\gdef","\\edef":"\\xdef","\\xdef":"\\xdef","\\let":"\\\\globallet","\\futurelet":"\\\\globalfuture"},Eo=e=>{var t=e.text;if(/^(?:[\\{}$&#^_]|EOF)$/.test(t))throw new xr("Expected a control sequence",e);return t},To=(e,t,n,r)=>{var i=e.gullet.macros.get(n.text);null==i&&(n.noexpand=!0,i={tokens:[n],numArgs:0,unexpandable:!e.gullet.isExpandable(n.text)}),e.gullet.macros.set(t,i,r)};Rs({type:"internal",names:["\\global","\\long","\\\\globallong"],props:{numArgs:0,allowedInText:!0},handler(e){var{parser:t,funcName:n}=e;t.consumeSpaces();var r=t.fetch();if(xo[r.text])return"\\global"!==n&&"\\\\globallong"!==n||(r.text=xo[r.text]),ho(t.parseFunction(),"internal");throw new xr("Invalid token after macro prefix",r)}}),Rs({type:"internal",names:["\\def","\\gdef","\\edef","\\xdef"],props:{numArgs:0,allowedInText:!0,primitive:!0},handler(e){var{parser:t,funcName:n}=e,r=t.gullet.popToken(),i=r.text;if(/^(?:[\\{}$&#^_]|EOF)$/.test(i))throw new xr("Expected a control sequence",r);for(var s,o=0,a=[[]];"{"!==t.gullet.future().text;)if("#"===(r=t.gullet.popToken()).text){if("{"===t.gullet.future().text){s=t.gullet.future(),a[o].push("{");break}if(r=t.gullet.popToken(),!/^[1-9]$/.test(r.text))throw new xr('Invalid argument number "'+r.text+'"');if(parseInt(r.text)!==o+1)throw new xr('Argument number "'+r.text+'" out of order');o++,a.push([])}else{if("EOF"===r.text)throw new xr("Expected a macro definition");a[o].push(r.text)}var{tokens:l}=t.gullet.consumeArg();return s&&l.unshift(s),"\\edef"!==n&&"\\xdef"!==n||(l=t.gullet.expandTokens(l)).reverse(),t.gullet.macros.set(i,{tokens:l,numArgs:o,delimiters:a},n===xo[n]),{type:"internal",mode:t.mode}}}),Rs({type:"internal",names:["\\let","\\\\globallet"],props:{numArgs:0,allowedInText:!0,primitive:!0},handler(e){var{parser:t,funcName:n}=e,r=Eo(t.gullet.popToken());t.gullet.consumeSpaces();var i=(e=>{var t=e.gullet.popToken();return"="===t.text&&" "===(t=e.gullet.popToken()).text&&(t=e.gullet.popToken()),t})(t);return To(t,r,i,"\\\\globallet"===n),{type:"internal",mode:t.mode}}}),Rs({type:"internal",names:["\\futurelet","\\\\globalfuture"],props:{numArgs:0,allowedInText:!0,primitive:!0},handler(e){var{parser:t,funcName:n}=e,r=Eo(t.gullet.popToken()),i=t.gullet.popToken(),s=t.gullet.popToken();return To(t,r,s,"\\\\globalfuture"===n),t.gullet.pushToken(s),t.gullet.pushToken(i),{type:"internal",mode:t.mode}}});var Co=function(e,t,n){var r=ni(Ai.math[e]&&Ai.math[e].replace||e,t,n);if(!r)throw new Error("Unsupported symbol "+e+" and font size "+t+".");return r},Ao=function(e,t,n,r){var i=n.havingBaseStyle(t),s=Ss.makeSpan(r.concat(i.sizingClasses(n)),[e],n),o=i.sizeMultiplier/n.sizeMultiplier;return s.height*=o,s.depth*=o,s.maxFontSize=i.sizeMultiplier,s},Io=function(e,t,n){var r=t.havingBaseStyle(n),i=(1-t.sizeMultiplier/r.sizeMultiplier)*t.fontMetrics().axisHeight;e.classes.push("delimcenter"),e.style.top=hi(i),e.height-=i,e.depth+=i},Ro=function(e,t,n,r,i,s){var o=function(e,t,n,r){return Ss.makeSymbol(e,"Size"+t+"-Regular",n,r)}(e,t,i,r),a=Ao(Ss.makeSpan(["delimsizing","size"+t],[o],r),Wr.TEXT,r,s);return n&&Io(a,r,Wr.TEXT),a},Oo=function(e,t,n){return{type:"elem",elem:Ss.makeSpan(["delimsizinginner","Size1-Regular"===t?"delim-size1":"delim-size4"],[Ss.makeSpan([],[Ss.makeSymbol(e,t,n)])])}},Po=function(e,t,n){var r=Qr["Size4-Regular"][e.charCodeAt(0)]?Qr["Size4-Regular"][e.charCodeAt(0)][4]:Qr["Size1-Regular"][e.charCodeAt(0)][4],i=new ki("inner",function(e,t){switch(e){case"":return"M291 0 H417 V"+t+" H291z M291 0 H417 V"+t+" H291z";case"":return"M145 0 H188 V"+t+" H145z M145 0 H188 V"+t+" H145z";case"":return"M145 0 H188 V"+t+" H145z M145 0 H188 V"+t+" H145zM367 0 H410 V"+t+" H367z M367 0 H410 V"+t+" H367z";case"":return"M457 0 H583 V"+t+" H457z M457 0 H583 V"+t+" H457z";case"":return"M319 0 H403 V"+t+" H319z M319 0 H403 V"+t+" H319z";case"":return"M263 0 H347 V"+t+" H263z M263 0 H347 V"+t+" H263z";case"":return"M384 0 H504 V"+t+" H384z M384 0 H504 V"+t+" H384z";case"":return"M312 0 H355 V"+t+" H312z M312 0 H355 V"+t+" H312z";case"":return"M257 0 H300 V"+t+" H257z M257 0 H300 V"+t+" H257zM478 0 H521 V"+t+" H478z M478 0 H521 V"+t+" H478z";default:return""}}(e,Math.round(1e3*t))),s=new _i([i],{width:hi(r),height:hi(t),style:"width:"+hi(r),viewBox:"0 0 "+1e3*r+" "+Math.round(1e3*t),preserveAspectRatio:"xMinYMin"}),o=Ss.makeSvgSpan([],[s],n);return o.height=t,o.style.height=hi(t),o.style.width=hi(r),{type:"elem",elem:o}},Mo={type:"kern",size:-.008},Do=["|","\\lvert","\\rvert","\\vert"],Lo=["\\|","\\lVert","\\rVert","\\Vert"],Fo=function(e,t,n,r,i,s){var o,a,l,c;o=l=c=e,a=null;var d="Size1-Regular";"\\uparrow"===e?l=c="":"\\Uparrow"===e?l=c="":"\\downarrow"===e?o=l="":"\\Downarrow"===e?o=l="":"\\updownarrow"===e?(o="\\uparrow",l="",c="\\downarrow"):"\\Updownarrow"===e?(o="\\Uparrow",l="",c="\\Downarrow"):Ir(Do,e)?l="":Ir(Lo,e)?l="":"["===e||"\\lbrack"===e?(o="",l="",c="",d="Size4-Regular"):"]"===e||"\\rbrack"===e?(o="",l="",c="",d="Size4-Regular"):"\\lfloor"===e||""===e?(l=o="",c="",d="Size4-Regular"):"\\lceil"===e||""===e?(o="",l=c="",d="Size4-Regular"):"\\rfloor"===e||""===e?(l=o="",c="",d="Size4-Regular"):"\\rceil"===e||""===e?(o="",l=c="",d="Size4-Regular"):"("===e||"\\lparen"===e?(o="",l="",c="",d="Size4-Regular"):")"===e||"\\rparen"===e?(o="",l="",c="",d="Size4-Regular"):"\\{"===e||"\\lbrace"===e?(o="",a="",c="",l="",d="Size4-Regular"):"\\}"===e||"\\rbrace"===e?(o="",a="",c="",l="",d="Size4-Regular"):"\\lgroup"===e||""===e?(o="",c="",l="",d="Size4-Regular"):"\\rgroup"===e||""===e?(o="",c="",l="",d="Size4-Regular"):"\\lmoustache"===e||""===e?(o="",c="",l="",d="Size4-Regular"):"\\rmoustache"!==e&&""!==e||(o="",c="",l="",d="Size4-Regular");var u=Co(o,d,i),h=u.height+u.depth,p=Co(l,d,i),m=p.height+p.depth,g=Co(c,d,i),f=g.height+g.depth,y=0,v=1;if(null!==a){var b=Co(a,d,i);y=b.height+b.depth,v=2}var w=h+f+y,S=w+Math.max(0,Math.ceil((t-w)/(v*m)))*v*m,_=r.fontMetrics().axisHeight;n&&(_*=r.sizeMultiplier);var k=S/2-_,x=[];if(x.push(Oo(c,d,i)),x.push(Mo),null===a){var E=S-h-f+.016;x.push(Po(l,E,r))}else{var T=(S-h-f-y)/2+.016;x.push(Po(l,T,r)),x.push(Mo),x.push(Oo(a,d,i)),x.push(Mo),x.push(Po(l,T,r))}x.push(Mo),x.push(Oo(o,d,i));var C=r.havingBaseStyle(Wr.TEXT),A=Ss.makeVList({positionType:"bottom",positionData:k,children:x},C);return Ao(Ss.makeSpan(["delimsizing","mult"],[A],C),Wr.TEXT,r,s)},No=.08,jo=function(e,t,n,r,i){var s=function(e,t,n){t*=1e3;var r="";switch(e){case"sqrtMain":r=function(e,t){return"M95,"+(622+e+80)+"\nc-2.7,0,-7.17,-2.7,-13.5,-8c-5.8,-5.3,-9.5,-10,-9.5,-14\nc0,-2,0.3,-3.3,1,-4c1.3,-2.7,23.83,-20.7,67.5,-54\nc44.2,-33.3,65.8,-50.3,66.5,-51c1.3,-1.3,3,-2,5,-2c4.7,0,8.7,3.3,12,10\ns173,378,173,378c0.7,0,35.3,-71,104,-213c68.7,-142,137.5,-285,206.5,-429\nc69,-144,104.5,-217.7,106.5,-221\nl"+e/2.075+" -"+e+"\nc5.3,-9.3,12,-14,20,-14\nH400000v"+(40+e)+"H845.2724\ns-225.272,467,-225.272,467s-235,486,-235,486c-2.7,4.7,-9,7,-19,7\nc-6,0,-10,-1,-12,-3s-194,-422,-194,-422s-65,47,-65,47z\nM"+(834+e)+" 80h400000v"+(40+e)+"h-400000z"}(t);break;case"sqrtSize1":r=function(e,t){return"M263,"+(601+e+80)+"c0.7,0,18,39.7,52,119\nc34,79.3,68.167,158.7,102.5,238c34.3,79.3,51.8,119.3,52.5,120\nc340,-704.7,510.7,-1060.3,512,-1067\nl"+e/2.084+" -"+e+"\nc4.7,-7.3,11,-11,19,-11\nH40000v"+(40+e)+"H1012.3\ns-271.3,567,-271.3,567c-38.7,80.7,-84,175,-136,283c-52,108,-89.167,185.3,-111.5,232\nc-22.3,46.7,-33.8,70.3,-34.5,71c-4.7,4.7,-12.3,7,-23,7s-12,-1,-12,-1\ns-109,-253,-109,-253c-72.7,-168,-109.3,-252,-110,-252c-10.7,8,-22,16.7,-34,26\nc-22,17.3,-33.3,26,-34,26s-26,-26,-26,-26s76,-59,76,-59s76,-60,76,-60z\nM"+(1001+e)+" 80h400000v"+(40+e)+"h-400000z"}(t);break;case"sqrtSize2":r=function(e,t){return"M983 "+(10+e+80)+"\nl"+e/3.13+" -"+e+"\nc4,-6.7,10,-10,18,-10 H400000v"+(40+e)+"\nH1013.1s-83.4,268,-264.1,840c-180.7,572,-277,876.3,-289,913c-4.7,4.7,-12.7,7,-24,7\ns-12,0,-12,0c-1.3,-3.3,-3.7,-11.7,-7,-25c-35.3,-125.3,-106.7,-373.3,-214,-744\nc-10,12,-21,25,-33,39s-32,39,-32,39c-6,-5.3,-15,-14,-27,-26s25,-30,25,-30\nc26.7,-32.7,52,-63,76,-91s52,-60,52,-60s208,722,208,722\nc56,-175.3,126.3,-397.3,211,-666c84.7,-268.7,153.8,-488.2,207.5,-658.5\nc53.7,-170.3,84.5,-266.8,92.5,-289.5z\nM"+(1001+e)+" 80h400000v"+(40+e)+"h-400000z"}(t);break;case"sqrtSize3":r=function(e,t){return"M424,"+(2398+e+80)+"\nc-1.3,-0.7,-38.5,-172,-111.5,-514c-73,-342,-109.8,-513.3,-110.5,-514\nc0,-2,-10.7,14.3,-32,49c-4.7,7.3,-9.8,15.7,-15.5,25c-5.7,9.3,-9.8,16,-12.5,20\ns-5,7,-5,7c-4,-3.3,-8.3,-7.7,-13,-13s-13,-13,-13,-13s76,-122,76,-122s77,-121,77,-121\ns209,968,209,968c0,-2,84.7,-361.7,254,-1079c169.3,-717.3,254.7,-1077.7,256,-1081\nl"+e/4.223+" -"+e+"c4,-6.7,10,-10,18,-10 H400000\nv"+(40+e)+"H1014.6\ns-87.3,378.7,-272.6,1166c-185.3,787.3,-279.3,1182.3,-282,1185\nc-2,6,-10,9,-24,9\nc-8,0,-12,-0.7,-12,-2z M"+(1001+e)+" 80\nh400000v"+(40+e)+"h-400000z"}(t);break;case"sqrtSize4":r=function(e,t){return"M473,"+(2713+e+80)+"\nc339.3,-1799.3,509.3,-2700,510,-2702 l"+e/5.298+" -"+e+"\nc3.3,-7.3,9.3,-11,18,-11 H400000v"+(40+e)+"H1017.7\ns-90.5,478,-276.2,1466c-185.7,988,-279.5,1483,-281.5,1485c-2,6,-10,9,-24,9\nc-8,0,-12,-0.7,-12,-2c0,-1.3,-5.3,-32,-16,-92c-50.7,-293.3,-119.7,-693.3,-207,-1200\nc0,-1.3,-5.3,8.7,-16,30c-10.7,21.3,-21.3,42.7,-32,64s-16,33,-16,33s-26,-26,-26,-26\ns76,-153,76,-153s77,-151,77,-151c0.7,0.7,35.7,202,105,604c67.3,400.7,102,602.7,104,\n606zM"+(1001+e)+" 80h400000v"+(40+e)+"H1017.7z"}(t);break;case"sqrtTall":r=function(e,t,n){return"M702 "+(e+80)+"H400000"+(40+e)+"\nH742v"+(n-54-80-e)+"l-4 4-4 4c-.667.7 -2 1.5-4 2.5s-4.167 1.833-6.5 2.5-5.5 1-9.5 1\nh-12l-28-84c-16.667-52-96.667 -294.333-240-727l-212 -643 -85 170\nc-4-3.333-8.333-7.667-13 -13l-13-13l77-155 77-156c66 199.333 139 419.667\n219 661 l218 661zM702 80H400000v"+(40+e)+"H742z"}(t,0,n)}return r}(e,r,n),o=new ki(e,s),a=new _i([o],{width:"400em",height:hi(t),viewBox:"0 0 400000 "+n,preserveAspectRatio:"xMinYMin slice"});return Ss.makeSvgSpan(["hide-tail"],[a],i)},Uo=["(","\\lparen",")","\\rparen","[","\\lbrack","]","\\rbrack","\\{","\\lbrace","\\}","\\rbrace","\\lfloor","\\rfloor","","","\\lceil","\\rceil","","","\\surd"],Bo=["\\uparrow","\\downarrow","\\updownarrow","\\Uparrow","\\Downarrow","\\Updownarrow","|","\\|","\\vert","\\Vert","\\lvert","\\rvert","\\lVert","\\rVert","\\lgroup","\\rgroup","","","\\lmoustache","\\rmoustache","",""],qo=["<",">","\\langle","\\rangle","/","\\backslash","\\lt","\\gt"],Ko=[0,1.2,1.8,2.4,3],zo=[{type:"small",style:Wr.SCRIPTSCRIPT},{type:"small",style:Wr.SCRIPT},{type:"small",style:Wr.TEXT},{type:"large",size:1},{type:"large",size:2},{type:"large",size:3},{type:"large",size:4}],$o=[{type:"small",style:Wr.SCRIPTSCRIPT},{type:"small",style:Wr.SCRIPT},{type:"small",style:Wr.TEXT},{type:"stack"}],Vo=[{type:"small",style:Wr.SCRIPTSCRIPT},{type:"small",style:Wr.SCRIPT},{type:"small",style:Wr.TEXT},{type:"large",size:1},{type:"large",size:2},{type:"large",size:3},{type:"large",size:4},{type:"stack"}],Ho=function(e){if("small"===e.type)return"Main-Regular";if("large"===e.type)return"Size"+e.size+"-Regular";if("stack"===e.type)return"Size4-Regular";throw new Error("Add support for delim type '"+e.type+"' here.")},Wo=function(e,t,n,r){for(var i=Math.min(2,3-r.style.size);i<n.length&&"stack"!==n[i].type;i++){var s=Co(e,Ho(n[i]),"math"),o=s.height+s.depth;if("small"===n[i].type&&(o*=r.havingBaseStyle(n[i].style).sizeMultiplier),o>t)return n[i]}return n[n.length-1]},Go=function(e,t,n,r,i,s){var o;"<"===e||"\\lt"===e||""===e?e="\\langle":">"!==e&&"\\gt"!==e&&""!==e||(e="\\rangle"),o=Ir(qo,e)?zo:Ir(Uo,e)?Vo:$o;var a=Wo(e,t,o,r);return"small"===a.type?function(e,t,n,r,i,s){var o=Ss.makeSymbol(e,"Main-Regular",i,r),a=Ao(o,t,r,s);return n&&Io(a,r,t),a}(e,a.style,n,r,i,s):"large"===a.type?Ro(e,a.size,n,r,i,s):Fo(e,t,n,r,i,s)},Yo={sqrtImage:function(e,t){var n,r,i=t.havingBaseSizing(),s=Wo("\\surd",e*i.sizeMultiplier,Vo,i),o=i.sizeMultiplier,a=Math.max(0,t.minRuleThickness-t.fontMetrics().sqrtRuleThickness),l=0,c=0,d=0;return"small"===s.type?(e<1?o=1:e<1.4&&(o=.7),c=(1+a)/o,(n=jo("sqrtMain",l=(1+a+No)/o,d=1e3+1e3*a+80,a,t)).style.minWidth="0.853em",r=.833/o):"large"===s.type?(d=1080*Ko[s.size],c=(Ko[s.size]+a)/o,l=(Ko[s.size]+a+No)/o,(n=jo("sqrtSize"+s.size,l,d,a,t)).style.minWidth="1.02em",r=1/o):(l=e+a+No,c=e+a,d=Math.floor(1e3*e+a)+80,(n=jo("sqrtTall",l,d,a,t)).style.minWidth="0.742em",r=1.056),n.height=c,n.style.height=hi(l),{span:n,advanceWidth:r,ruleWidth:(t.fontMetrics().sqrtRuleThickness+a)*o}},sizedDelim:function(e,t,n,r,i){if("<"===e||"\\lt"===e||""===e?e="\\langle":">"!==e&&"\\gt"!==e&&""!==e||(e="\\rangle"),Ir(Uo,e)||Ir(qo,e))return Ro(e,t,!1,n,r,i);if(Ir(Bo,e))return Fo(e,Ko[t],!1,n,r,i);throw new xr("Illegal delimiter: '"+e+"'")},sizeToMaxHeight:Ko,customSizedDelim:Go,leftRightDelim:function(e,t,n,r,i,s){var o=r.fontMetrics().axisHeight*r.sizeMultiplier,a=5/r.fontMetrics().ptPerEm,l=Math.max(t-o,n+o),c=Math.max(l/500*901,2*l-a);return Go(e,c,!0,r,i,s)}},Xo={"\\bigl":{mclass:"mopen",size:1},"\\Bigl":{mclass:"mopen",size:2},"\\biggl":{mclass:"mopen",size:3},"\\Biggl":{mclass:"mopen",size:4},"\\bigr":{mclass:"mclose",size:1},"\\Bigr":{mclass:"mclose",size:2},"\\biggr":{mclass:"mclose",size:3},"\\Biggr":{mclass:"mclose",size:4},"\\bigm":{mclass:"mrel",size:1},"\\Bigm":{mclass:"mrel",size:2},"\\biggm":{mclass:"mrel",size:3},"\\Biggm":{mclass:"mrel",size:4},"\\big":{mclass:"mord",size:1},"\\Big":{mclass:"mord",size:2},"\\bigg":{mclass:"mord",size:3},"\\Bigg":{mclass:"mord",size:4}},Zo=["(","\\lparen",")","\\rparen","[","\\lbrack","]","\\rbrack","\\{","\\lbrace","\\}","\\rbrace","\\lfloor","\\rfloor","","","\\lceil","\\rceil","","","<",">","\\langle","","\\rangle","","\\lt","\\gt","\\lvert","\\rvert","\\lVert","\\rVert","\\lgroup","\\rgroup","","","\\lmoustache","\\rmoustache","","","/","\\backslash","|","\\vert","\\|","\\Vert","\\uparrow","\\Uparrow","\\downarrow","\\Downarrow","\\updownarrow","\\Updownarrow","."];function Jo(e,t){var n=mo(e);if(n&&Ir(Zo,n.text))return n;throw new xr(n?"Invalid delimiter '"+n.text+"' after '"+t.funcName+"'":"Invalid delimiter type '"+e.type+"'",e)}function Qo(e){if(!e.body)throw new Error("Bug: The leftright ParseNode wasn't fully parsed.")}Rs({type:"delimsizing",names:["\\bigl","\\Bigl","\\biggl","\\Biggl","\\bigr","\\Bigr","\\biggr","\\Biggr","\\bigm","\\Bigm","\\biggm","\\Biggm","\\big","\\Big","\\bigg","\\Bigg"],props:{numArgs:1,argTypes:["primitive"]},handler:(e,t)=>{var n=Jo(t[0],e);return{type:"delimsizing",mode:e.parser.mode,size:Xo[e.funcName].size,mclass:Xo[e.funcName].mclass,delim:n.text}},htmlBuilder:(e,t)=>"."===e.delim?Ss.makeSpan([e.mclass]):Yo.sizedDelim(e.delim,e.size,t,e.mode,[e.mclass]),mathmlBuilder:e=>{var t=[];"."!==e.delim&&t.push(Js(e.delim,e.mode));var n=new Zs.MathNode("mo",t);"mopen"===e.mclass||"mclose"===e.mclass?n.setAttribute("fence","true"):n.setAttribute("fence","false"),n.setAttribute("stretchy","true");var r=hi(Yo.sizeToMaxHeight[e.size]);return n.setAttribute("minsize",r),n.setAttribute("maxsize",r),n}}),Rs({type:"leftright-right",names:["\\right"],props:{numArgs:1,primitive:!0},handler:(e,t)=>{var n=e.parser.gullet.macros.get("\\current@color");if(n&&"string"!=typeof n)throw new xr("\\current@color set to non-string in \\right");return{type:"leftright-right",mode:e.parser.mode,delim:Jo(t[0],e).text,color:n}}}),Rs({type:"leftright",names:["\\left"],props:{numArgs:1,primitive:!0},handler:(e,t)=>{var n=Jo(t[0],e),r=e.parser;++r.leftrightDepth;var i=r.parseExpression(!1);--r.leftrightDepth,r.expect("\\right",!1);var s=ho(r.parseFunction(),"leftright-right");return{type:"leftright",mode:r.mode,body:i,left:n.text,right:s.delim,rightColor:s.color}},htmlBuilder:(e,t)=>{Qo(e);for(var n,r,i=Us(e.body,t,!0,["mopen","mclose"]),s=0,o=0,a=!1,l=0;l<i.length;l++)i[l].isMiddle?a=!0:(s=Math.max(i[l].height,s),o=Math.max(i[l].depth,o));if(s*=t.sizeMultiplier,o*=t.sizeMultiplier,n="."===e.left?$s(t,["mopen"]):Yo.leftRightDelim(e.left,s,o,t,e.mode,["mopen"]),i.unshift(n),a)for(var c=1;c<i.length;c++){var d=i[c].isMiddle;d&&(i[c]=Yo.leftRightDelim(d.delim,s,o,d.options,e.mode,[]))}if("."===e.right)r=$s(t,["mclose"]);else{var u=e.rightColor?t.withColor(e.rightColor):t;r=Yo.leftRightDelim(e.right,s,o,u,e.mode,["mclose"])}return i.push(r),Ss.makeSpan(["minner"],i,t)},mathmlBuilder:(e,t)=>{Qo(e);var n=to(e.body,t);if("."!==e.left){var r=new Zs.MathNode("mo",[Js(e.left,e.mode)]);r.setAttribute("fence","true"),n.unshift(r)}if("."!==e.right){var i=new Zs.MathNode("mo",[Js(e.right,e.mode)]);i.setAttribute("fence","true"),e.rightColor&&i.setAttribute("mathcolor",e.rightColor),n.push(i)}return Qs(n)}}),Rs({type:"middle",names:["\\middle"],props:{numArgs:1,primitive:!0},handler:(e,t)=>{var n=Jo(t[0],e);if(!e.parser.leftrightDepth)throw new xr("\\middle without preceding \\left",n);return{type:"middle",mode:e.parser.mode,delim:n.text}},htmlBuilder:(e,t)=>{var n;if("."===e.delim)n=$s(t,[]);else{n=Yo.sizedDelim(e.delim,1,t,e.mode,[]);var r={delim:e.delim,options:t};n.isMiddle=r}return n},mathmlBuilder:(e,t)=>{var n="\\vert"===e.delim||"|"===e.delim?Js("|","text"):Js(e.delim,e.mode),r=new Zs.MathNode("mo",[n]);return r.setAttribute("fence","true"),r.setAttribute("lspace","0.05em"),r.setAttribute("rspace","0.05em"),r}});var ea=(e,t)=>{var n,r,i=Ss.wrapFragment(Vs(e.body,t),t),s=e.label.substr(1),o=t.sizeMultiplier,a=0,l=Dr(e.body);if("sout"===s)(n=Ss.makeSpan(["stretchy","sout"])).height=t.fontMetrics().defaultRuleThickness/o,a=-.5*t.fontMetrics().xHeight;else if("phase"===s){var c=ui({number:.6,unit:"pt"},t),d=ui({number:.35,unit:"ex"},t);o/=t.havingBaseSizing().sizeMultiplier;var u=i.height+i.depth+c+d;i.style.paddingLeft=hi(u/2+c);var h=Math.floor(1e3*u*o),p=function(e){return"M400000 "+e+" H0 L"+e/2+" 0 l65 45 L145 "+(e-80)+" H400000z"}(h),m=new _i([new ki("phase",p)],{width:"400em",height:hi(h/1e3),viewBox:"0 0 400000 "+h,preserveAspectRatio:"xMinYMin slice"});(n=Ss.makeSvgSpan(["hide-tail"],[m],t)).style.height=hi(u),a=i.depth+c+d}else{/cancel/.test(s)?l||i.classes.push("cancel-pad"):"angl"===s?i.classes.push("anglpad"):i.classes.push("boxpad");var g=0,f=0,y=0;/box/.test(s)?(y=Math.max(t.fontMetrics().fboxrule,t.minRuleThickness),f=g=t.fontMetrics().fboxsep+("colorbox"===s?0:y)):"angl"===s?(g=4*(y=Math.max(t.fontMetrics().defaultRuleThickness,t.minRuleThickness)),f=Math.max(0,.25-i.depth)):f=g=l?.2:0,n=function(e,t,n,r,i){var s,o=e.height+e.depth+n+r;if(/fbox|color|angl/.test(t)){if(s=Ss.makeSpan(["stretchy",t],[],i),"fbox"===t){var a=i.color&&i.getColor();a&&(s.style.borderColor=a)}}else{var l=[];/^[bx]cancel$/.test(t)&&l.push(new xi({x1:"0",y1:"0",x2:"100%",y2:"100%","stroke-width":"0.046em"})),/^x?cancel$/.test(t)&&l.push(new xi({x1:"0",y1:"100%",x2:"100%",y2:"0","stroke-width":"0.046em"}));var c=new _i(l,{width:"100%",height:hi(o)});s=Ss.makeSvgSpan([],[c],i)}return s.height=o,s.style.height=hi(o),s}(i,s,g,f,t),/fbox|boxed|fcolorbox/.test(s)?(n.style.borderStyle="solid",n.style.borderWidth=hi(y)):"angl"===s&&.049!==y&&(n.style.borderTopWidth=hi(y),n.style.borderRightWidth=hi(y)),a=i.depth+f,e.backgroundColor&&(n.style.backgroundColor=e.backgroundColor,e.borderColor&&(n.style.borderColor=e.borderColor))}if(e.backgroundColor)r=Ss.makeVList({positionType:"individualShift",children:[{type:"elem",elem:n,shift:a},{type:"elem",elem:i,shift:0}]},t);else{var v=/cancel|phase/.test(s)?["svg-align"]:[];r=Ss.makeVList({positionType:"individualShift",children:[{type:"elem",elem:i,shift:0},{type:"elem",elem:n,shift:a,wrapperClasses:v}]},t)}return/cancel/.test(s)&&(r.height=i.height,r.depth=i.depth),/cancel/.test(s)&&!l?Ss.makeSpan(["mord","cancel-lap"],[r],t):Ss.makeSpan(["mord"],[r],t)},ta=(e,t)=>{var n=0,r=new Zs.MathNode(e.label.indexOf("colorbox")>-1?"mpadded":"menclose",[ro(e.body,t)]);switch(e.label){case"\\cancel":r.setAttribute("notation","updiagonalstrike");break;case"\\bcancel":r.setAttribute("notation","downdiagonalstrike");break;case"\\phase":r.setAttribute("notation","phasorangle");break;case"\\sout":r.setAttribute("notation","horizontalstrike");break;case"\\fbox":r.setAttribute("notation","box");break;case"\\angl":r.setAttribute("notation","actuarial");break;case"\\fcolorbox":case"\\colorbox":if(n=t.fontMetrics().fboxsep*t.fontMetrics().ptPerEm,r.setAttribute("width","+"+2*n+"pt"),r.setAttribute("height","+"+2*n+"pt"),r.setAttribute("lspace",n+"pt"),r.setAttribute("voffset",n+"pt"),"\\fcolorbox"===e.label){var i=Math.max(t.fontMetrics().fboxrule,t.minRuleThickness);r.setAttribute("style","border: "+i+"em solid "+String(e.borderColor))}break;case"\\xcancel":r.setAttribute("notation","updiagonalstrike downdiagonalstrike")}return e.backgroundColor&&r.setAttribute("mathbackground",e.backgroundColor),r};Rs({type:"enclose",names:["\\colorbox"],props:{numArgs:2,allowedInText:!0,argTypes:["color","text"]},handler(e,t,n){var{parser:r,funcName:i}=e,s=ho(t[0],"color-token").color,o=t[1];return{type:"enclose",mode:r.mode,label:i,backgroundColor:s,body:o}},htmlBuilder:ea,mathmlBuilder:ta}),Rs({type:"enclose",names:["\\fcolorbox"],props:{numArgs:3,allowedInText:!0,argTypes:["color","color","text"]},handler(e,t,n){var{parser:r,funcName:i}=e,s=ho(t[0],"color-token").color,o=ho(t[1],"color-token").color,a=t[2];return{type:"enclose",mode:r.mode,label:i,backgroundColor:o,borderColor:s,body:a}},htmlBuilder:ea,mathmlBuilder:ta}),Rs({type:"enclose",names:["\\fbox"],props:{numArgs:1,argTypes:["hbox"],allowedInText:!0},handler(e,t){var{parser:n}=e;return{type:"enclose",mode:n.mode,label:"\\fbox",body:t[0]}}}),Rs({type:"enclose",names:["\\cancel","\\bcancel","\\xcancel","\\sout","\\phase"],props:{numArgs:1},handler(e,t){var{parser:n,funcName:r}=e,i=t[0];return{type:"enclose",mode:n.mode,label:r,body:i}},htmlBuilder:ea,mathmlBuilder:ta}),Rs({type:"enclose",names:["\\angl"],props:{numArgs:1,argTypes:["hbox"],allowedInText:!1},handler(e,t){var{parser:n}=e;return{type:"enclose",mode:n.mode,label:"\\angl",body:t[0]}}});var na={};function ra(e){for(var{type:t,names:n,props:r,handler:i,htmlBuilder:s,mathmlBuilder:o}=e,a={type:t,numArgs:r.numArgs||0,allowedInText:!1,numOptionalArgs:0,handler:i},l=0;l<n.length;++l)na[n[l]]=a;s&&(As[t]=s),o&&(Is[t]=o)}var ia={};function sa(e,t){ia[e]=t}function oa(e){var t=[];e.consumeSpaces();for(var n=e.fetch().text;"\\hline"===n||"\\hdashline"===n;)e.consume(),t.push("\\hdashline"===n),e.consumeSpaces(),n=e.fetch().text;return t}var aa=e=>{if(!e.parser.settings.displayMode)throw new xr("{"+e.envName+"} can be used only in display mode.")};function la(e){if(-1===e.indexOf("ed"))return-1===e.indexOf("*")}function ca(e,t,n){var{hskipBeforeAndAfter:r,addJot:i,cols:s,arraystretch:o,colSeparationType:a,autoTag:l,singleRow:c,emptySingleRow:d,maxNumCols:u,leqno:h}=t;if(e.gullet.beginGroup(),c||e.gullet.macros.set("\\cr","\\\\\\relax"),!o){var p=e.gullet.expandMacroAsText("\\arraystretch");if(null==p)o=1;else if(!(o=parseFloat(p))||o<0)throw new xr("Invalid \\arraystretch: "+p)}e.gullet.beginGroup();var m=[],g=[m],f=[],y=[],v=null!=l?[]:void 0;function b(){l&&e.gullet.macros.set("\\@eqnsw","1",!0)}function w(){v&&(e.gullet.macros.get("\\df@tag")?(v.push(e.subparse([new kr("\\df@tag")])),e.gullet.macros.set("\\df@tag",void 0,!0)):v.push(Boolean(l)&&"1"===e.gullet.macros.get("\\@eqnsw")))}for(b(),y.push(oa(e));;){var S=e.parseExpression(!1,c?"\\end":"\\\\");e.gullet.endGroup(),e.gullet.beginGroup(),S={type:"ordgroup",mode:e.mode,body:S},n&&(S={type:"styling",mode:e.mode,style:n,body:[S]}),m.push(S);var _=e.fetch().text;if("&"===_){if(u&&m.length===u){if(c||a)throw new xr("Too many tab characters: &",e.nextToken);e.settings.reportNonstrict("textEnv","Too few columns specified in the {array} column argument.")}e.consume()}else{if("\\end"===_){w(),1===m.length&&"styling"===S.type&&0===S.body[0].body.length&&(g.length>1||!d)&&g.pop(),y.length<g.length+1&&y.push([]);break}if("\\\\"!==_)throw new xr("Expected & or \\\\ or \\cr or \\end",e.nextToken);e.consume();var k=void 0;" "!==e.gullet.future().text&&(k=e.parseSizeGroup(!0)),f.push(k?k.value:null),w(),y.push(oa(e)),m=[],g.push(m),b()}}return e.gullet.endGroup(),e.gullet.endGroup(),{type:"array",mode:e.mode,addJot:i,arraystretch:o,body:g,cols:s,rowGaps:f,hskipBeforeAndAfter:r,hLinesBeforeRow:y,colSeparationType:a,tags:v,leqno:h}}function da(e){return"d"===e.substr(0,1)?"display":"text"}var ua=function(e,t){var n,r,i=e.body.length,s=e.hLinesBeforeRow,o=0,a=new Array(i),l=[],c=Math.max(t.fontMetrics().arrayRuleWidth,t.minRuleThickness),d=1/t.fontMetrics().ptPerEm,u=5*d;e.colSeparationType&&"small"===e.colSeparationType&&(u=t.havingStyle(Wr.SCRIPT).sizeMultiplier/t.sizeMultiplier*.2778);var h="CD"===e.colSeparationType?ui({number:3,unit:"ex"},t):12*d,p=3*d,m=e.arraystretch*h,g=.7*m,f=.3*m,y=0;function v(e){for(var t=0;t<e.length;++t)t>0&&(y+=.25),l.push({pos:y,isDashed:e[t]})}for(v(s[0]),n=0;n<e.body.length;++n){var b=e.body[n],w=g,S=f;o<b.length&&(o=b.length);var _=new Array(b.length);for(r=0;r<b.length;++r){var k=Vs(b[r],t);S<k.depth&&(S=k.depth),w<k.height&&(w=k.height),_[r]=k}var x=e.rowGaps[n],E=0;x&&(E=ui(x,t))>0&&(S<(E+=f)&&(S=E),E=0),e.addJot&&(S+=p),_.height=w,_.depth=S,y+=w,_.pos=y,y+=S+E,a[n]=_,v(s[n+1])}var T,C,A=y/2+t.fontMetrics().axisHeight,I=e.cols||[],R=[],O=[];if(e.tags&&e.tags.some((e=>e)))for(n=0;n<i;++n){var P=a[n],M=P.pos-A,D=e.tags[n],L=void 0;(L=!0===D?Ss.makeSpan(["eqn-num"],[],t):Ss.makeSpan([],!1===D?[]:Us(D,t,!0),t)).depth=P.depth,L.height=P.height,O.push({type:"elem",elem:L,shift:M})}for(r=0,C=0;r<o||C<I.length;++r,++C){for(var F=I[C]||{},N=!0;"separator"===F.type;){if(N||((T=Ss.makeSpan(["arraycolsep"],[])).style.width=hi(t.fontMetrics().doubleRuleSep),R.push(T)),"|"!==F.separator&&":"!==F.separator)throw new xr("Invalid separator type: "+F.separator);var j="|"===F.separator?"solid":"dashed",U=Ss.makeSpan(["vertical-separator"],[],t);U.style.height=hi(y),U.style.borderRightWidth=hi(c),U.style.borderRightStyle=j,U.style.margin="0 "+hi(-c/2);var B=y-A;B&&(U.style.verticalAlign=hi(-B)),R.push(U),F=I[++C]||{},N=!1}if(!(r>=o)){var q=void 0;(r>0||e.hskipBeforeAndAfter)&&0!==(q=Rr(F.pregap,u))&&((T=Ss.makeSpan(["arraycolsep"],[])).style.width=hi(q),R.push(T));var K=[];for(n=0;n<i;++n){var z=a[n],$=z[r];if($){var V=z.pos-A;$.depth=z.depth,$.height=z.height,K.push({type:"elem",elem:$,shift:V})}}K=Ss.makeVList({positionType:"individualShift",children:K},t),K=Ss.makeSpan(["col-align-"+(F.align||"c")],[K]),R.push(K),(r<o-1||e.hskipBeforeAndAfter)&&0!==(q=Rr(F.postgap,u))&&((T=Ss.makeSpan(["arraycolsep"],[])).style.width=hi(q),R.push(T))}}if(a=Ss.makeSpan(["mtable"],R),l.length>0){for(var H=Ss.makeLineSpan("hline",t,c),W=Ss.makeLineSpan("hdashline",t,c),G=[{type:"elem",elem:a,shift:0}];l.length>0;){var Y=l.pop(),X=Y.pos-A;Y.isDashed?G.push({type:"elem",elem:W,shift:X}):G.push({type:"elem",elem:H,shift:X})}a=Ss.makeVList({positionType:"individualShift",children:G},t)}if(0===O.length)return Ss.makeSpan(["mord"],[a],t);var Z=Ss.makeVList({positionType:"individualShift",children:O},t);return Z=Ss.makeSpan(["tag"],[Z],t),Ss.makeFragment([a,Z])},ha={c:"center ",l:"left ",r:"right "},pa=function(e,t){for(var n=[],r=new Zs.MathNode("mtd",[],["mtr-glue"]),i=new Zs.MathNode("mtd",[],["mml-eqn-num"]),s=0;s<e.body.length;s++){for(var o=e.body[s],a=[],l=0;l<o.length;l++)a.push(new Zs.MathNode("mtd",[ro(o[l],t)]));e.tags&&e.tags[s]&&(a.unshift(r),a.push(r),e.leqno?a.unshift(i):a.push(i)),n.push(new Zs.MathNode("mtr",a))}var c=new Zs.MathNode("mtable",n),d=.5===e.arraystretch?.1:.16+e.arraystretch-1+(e.addJot?.09:0);c.setAttribute("rowspacing",hi(d));var u="",h="";if(e.cols&&e.cols.length>0){var p=e.cols,m="",g=!1,f=0,y=p.length;"separator"===p[0].type&&(u+="top ",f=1),"separator"===p[p.length-1].type&&(u+="bottom ",y-=1);for(var v=f;v<y;v++)"align"===p[v].type?(h+=ha[p[v].align],g&&(m+="none "),g=!0):"separator"===p[v].type&&g&&(m+="|"===p[v].separator?"solid ":"dashed ",g=!1);c.setAttribute("columnalign",h.trim()),/[sd]/.test(m)&&c.setAttribute("columnlines",m.trim())}if("align"===e.colSeparationType){for(var b=e.cols||[],w="",S=1;S<b.length;S++)w+=S%2?"0em ":"1em ";c.setAttribute("columnspacing",w.trim())}else"alignat"===e.colSeparationType||"gather"===e.colSeparationType?c.setAttribute("columnspacing","0em"):"small"===e.colSeparationType?c.setAttribute("columnspacing","0.2778em"):"CD"===e.colSeparationType?c.setAttribute("columnspacing","0.5em"):c.setAttribute("columnspacing","1em");var _="",k=e.hLinesBeforeRow;u+=k[0].length>0?"left ":"",u+=k[k.length-1].length>0?"right ":"";for(var x=1;x<k.length-1;x++)_+=0===k[x].length?"none ":k[x][0]?"dashed ":"solid ";return/[sd]/.test(_)&&c.setAttribute("rowlines",_.trim()),""!==u&&(c=new Zs.MathNode("menclose",[c])).setAttribute("notation",u.trim()),e.arraystretch&&e.arraystretch<1&&(c=new Zs.MathNode("mstyle",[c])).setAttribute("scriptlevel","1"),c},ma=function(e,t){-1===e.envName.indexOf("ed")&&aa(e);var n,r=[],i=e.envName.indexOf("at")>-1?"alignat":"align",s="split"===e.envName,o=ca(e.parser,{cols:r,addJot:!0,autoTag:s?void 0:la(e.envName),emptySingleRow:!0,colSeparationType:i,maxNumCols:s?2:void 0,leqno:e.parser.settings.leqno},"display"),a=0,l={type:"ordgroup",mode:e.mode,body:[]};if(t[0]&&"ordgroup"===t[0].type){for(var c="",d=0;d<t[0].body.length;d++)c+=ho(t[0].body[d],"textord").text;n=Number(c),a=2*n}var u=!a;o.body.forEach((function(e){for(var t=1;t<e.length;t+=2){var r=ho(e[t],"styling");ho(r.body[0],"ordgroup").body.unshift(l)}if(u)a<e.length&&(a=e.length);else{var i=e.length/2;if(n<i)throw new xr("Too many math in a row: expected "+n+", but got "+i,e[0])}}));for(var h=0;h<a;++h){var p="r",m=0;h%2==1?p="l":h>0&&u&&(m=1),r[h]={type:"align",align:p,pregap:m,postgap:0}}return o.colSeparationType=u?"align":"alignat",o};ra({type:"array",names:["array","darray"],props:{numArgs:1},handler(e,t){var n=(mo(t[0])?[t[0]]:ho(t[0],"ordgroup").body).map((function(e){var t=po(e).text;if(-1!=="lcr".indexOf(t))return{type:"align",align:t};if("|"===t)return{type:"separator",separator:"|"};if(":"===t)return{type:"separator",separator:":"};throw new xr("Unknown column alignment: "+t,e)})),r={cols:n,hskipBeforeAndAfter:!0,maxNumCols:n.length};return ca(e.parser,r,da(e.envName))},htmlBuilder:ua,mathmlBuilder:pa}),ra({type:"array",names:["matrix","pmatrix","bmatrix","Bmatrix","vmatrix","Vmatrix","matrix*","pmatrix*","bmatrix*","Bmatrix*","vmatrix*","Vmatrix*"],props:{numArgs:0},handler(e){var t={matrix:null,pmatrix:["(",")"],bmatrix:["[","]"],Bmatrix:["\\{","\\}"],vmatrix:["|","|"],Vmatrix:["\\Vert","\\Vert"]}[e.envName.replace("*","")],n="c",r={hskipBeforeAndAfter:!1,cols:[{type:"align",align:n}]};if("*"===e.envName.charAt(e.envName.length-1)){var i=e.parser;if(i.consumeSpaces(),"["===i.fetch().text){if(i.consume(),i.consumeSpaces(),n=i.fetch().text,-1==="lcr".indexOf(n))throw new xr("Expected l or c or r",i.nextToken);i.consume(),i.consumeSpaces(),i.expect("]"),i.consume(),r.cols=[{type:"align",align:n}]}}var s=ca(e.parser,r,da(e.envName)),o=Math.max(0,...s.body.map((e=>e.length)));return s.cols=new Array(o).fill({type:"align",align:n}),t?{type:"leftright",mode:e.mode,body:[s],left:t[0],right:t[1],rightColor:void 0}:s},htmlBuilder:ua,mathmlBuilder:pa}),ra({type:"array",names:["smallmatrix"],props:{numArgs:0},handler(e){var t=ca(e.parser,{arraystretch:.5},"script");return t.colSeparationType="small",t},htmlBuilder:ua,mathmlBuilder:pa}),ra({type:"array",names:["subarray"],props:{numArgs:1},handler(e,t){var n=(mo(t[0])?[t[0]]:ho(t[0],"ordgroup").body).map((function(e){var t=po(e).text;if(-1!=="lc".indexOf(t))return{type:"align",align:t};throw new xr("Unknown column alignment: "+t,e)}));if(n.length>1)throw new xr("{subarray} can contain only one column");var r={cols:n,hskipBeforeAndAfter:!1,arraystretch:.5};if((r=ca(e.parser,r,"script")).body.length>0&&r.body[0].length>1)throw new xr("{subarray} can contain only one column");return r},htmlBuilder:ua,mathmlBuilder:pa}),ra({type:"array",names:["cases","dcases","rcases","drcases"],props:{numArgs:0},handler(e){var t=ca(e.parser,{arraystretch:1.2,cols:[{type:"align",align:"l",pregap:0,postgap:1},{type:"align",align:"l",pregap:0,postgap:0}]},da(e.envName));return{type:"leftright",mode:e.mode,body:[t],left:e.envName.indexOf("r")>-1?".":"\\{",right:e.envName.indexOf("r")>-1?"\\}":".",rightColor:void 0}},htmlBuilder:ua,mathmlBuilder:pa}),ra({type:"array",names:["align","align*","aligned","split"],props:{numArgs:0},handler:ma,htmlBuilder:ua,mathmlBuilder:pa}),ra({type:"array",names:["gathered","gather","gather*"],props:{numArgs:0},handler(e){Ir(["gather","gather*"],e.envName)&&aa(e);var t={cols:[{type:"align",align:"c"}],addJot:!0,colSeparationType:"gather",autoTag:la(e.envName),emptySingleRow:!0,leqno:e.parser.settings.leqno};return ca(e.parser,t,"display")},htmlBuilder:ua,mathmlBuilder:pa}),ra({type:"array",names:["alignat","alignat*","alignedat"],props:{numArgs:1},handler:ma,htmlBuilder:ua,mathmlBuilder:pa}),ra({type:"array",names:["equation","equation*"],props:{numArgs:0},handler(e){aa(e);var t={autoTag:la(e.envName),emptySingleRow:!0,singleRow:!0,maxNumCols:1,leqno:e.parser.settings.leqno};return ca(e.parser,t,"display")},htmlBuilder:ua,mathmlBuilder:pa}),ra({type:"array",names:["CD"],props:{numArgs:0},handler:e=>(aa(e),function(e){var t=[];for(e.gullet.beginGroup(),e.gullet.macros.set("\\cr","\\\\\\relax"),e.gullet.beginGroup();;){t.push(e.parseExpression(!1,"\\\\")),e.gullet.endGroup(),e.gullet.beginGroup();var n=e.fetch().text;if("&"!==n&&"\\\\"!==n){if("\\end"===n){0===t[t.length-1].length&&t.pop();break}throw new xr("Expected \\\\ or \\cr or \\end",e.nextToken)}e.consume()}for(var r,i,s=[],o=[s],a=0;a<t.length;a++){for(var l=t[a],c={type:"styling",body:[],mode:"math",style:"display"},d=0;d<l.length;d++)if(wo(l[d])){s.push(c);var u=po(l[d+=1]).text,h=new Array(2);if(h[0]={type:"ordgroup",mode:"math",body:[]},h[1]={type:"ordgroup",mode:"math",body:[]},"=|.".indexOf(u)>-1);else{if(!("<>AV".indexOf(u)>-1))throw new xr('Expected one of "<>AV=|." after @',l[d]);for(var p=0;p<2;p++){for(var m=!0,g=d+1;g<l.length;g++){if(i=u,("mathord"===(r=l[g]).type||"atom"===r.type)&&r.text===i){m=!1,d=g;break}if(wo(l[g]))throw new xr("Missing a "+u+" character to complete a CD arrow.",l[g]);h[p].body.push(l[g])}if(m)throw new xr("Missing a "+u+" character to complete a CD arrow.",l[d])}}var f={type:"styling",body:[So(u,h,e)],mode:"math",style:"display"};s.push(f),c={type:"styling",body:[],mode:"math",style:"display"}}else c.body.push(l[d]);a%2==0?s.push(c):s.shift(),s=[],o.push(s)}return e.gullet.endGroup(),e.gullet.endGroup(),{type:"array",mode:"math",body:o,arraystretch:1,addJot:!0,rowGaps:[null],cols:new Array(o[0].length).fill({type:"align",align:"c",pregap:.25,postgap:.25}),colSeparationType:"CD",hLinesBeforeRow:new Array(o.length+1).fill([])}}(e.parser)),htmlBuilder:ua,mathmlBuilder:pa}),sa("\\nonumber","\\gdef\\@eqnsw{0}"),sa("\\notag","\\nonumber"),Rs({type:"text",names:["\\hline","\\hdashline"],props:{numArgs:0,allowedInText:!0,allowedInMath:!0},handler(e,t){throw new xr(e.funcName+" valid only within array environment")}});var ga=na;Rs({type:"environment",names:["\\begin","\\end"],props:{numArgs:1,argTypes:["text"]},handler(e,t){var{parser:n,funcName:r}=e,i=t[0];if("ordgroup"!==i.type)throw new xr("Invalid environment name",i);for(var s="",o=0;o<i.body.length;++o)s+=ho(i.body[o],"textord").text;if("\\begin"===r){if(!ga.hasOwnProperty(s))throw new xr("No such environment: "+s,i);var a=ga[s],{args:l,optArgs:c}=n.parseArguments("\\begin{"+s+"}",a),d={mode:n.mode,envName:s,parser:n},u=a.handler(d,l,c);n.expect("\\end",!1);var h=n.nextToken,p=ho(n.parseFunction(),"environment");if(p.name!==s)throw new xr("Mismatch: \\begin{"+s+"} matched by \\end{"+p.name+"}",h);return u}return{type:"environment",mode:n.mode,name:s,nameGroup:i}}});var fa=Ss.makeSpan;function ya(e,t){var n=Us(e.body,t,!0);return fa([e.mclass],n,t)}function va(e,t){var n,r=to(e.body,t);return"minner"===e.mclass?n=new Zs.MathNode("mpadded",r):"mord"===e.mclass?e.isCharacterBox?(n=r[0]).type="mi":n=new Zs.MathNode("mi",r):(e.isCharacterBox?(n=r[0]).type="mo":n=new Zs.MathNode("mo",r),"mbin"===e.mclass?(n.attributes.lspace="0.22em",n.attributes.rspace="0.22em"):"mpunct"===e.mclass?(n.attributes.lspace="0em",n.attributes.rspace="0.17em"):"mopen"===e.mclass||"mclose"===e.mclass?(n.attributes.lspace="0em",n.attributes.rspace="0em"):"minner"===e.mclass&&(n.attributes.lspace="0.0556em",n.attributes.width="+0.1111em")),n}Rs({type:"mclass",names:["\\mathord","\\mathbin","\\mathrel","\\mathopen","\\mathclose","\\mathpunct","\\mathinner"],props:{numArgs:1,primitive:!0},handler(e,t){var{parser:n,funcName:r}=e,i=t[0];return{type:"mclass",mode:n.mode,mclass:"m"+r.substr(5),body:Ms(i),isCharacterBox:Dr(i)}},htmlBuilder:ya,mathmlBuilder:va});var ba=e=>{var t="ordgroup"===e.type&&e.body.length?e.body[0]:e;return"atom"!==t.type||"bin"!==t.family&&"rel"!==t.family?"mord":"m"+t.family};Rs({type:"mclass",names:["\\@binrel"],props:{numArgs:2},handler(e,t){var{parser:n}=e;return{type:"mclass",mode:n.mode,mclass:ba(t[0]),body:Ms(t[1]),isCharacterBox:Dr(t[1])}}}),Rs({type:"mclass",names:["\\stackrel","\\overset","\\underset"],props:{numArgs:2},handler(e,t){var n,{parser:r,funcName:i}=e,s=t[1],o=t[0];n="\\stackrel"!==i?ba(s):"mrel";var a={type:"op",mode:s.mode,limits:!0,alwaysHandleSupSub:!0,parentIsSupSub:!1,symbol:!1,suppressBaseShift:"\\stackrel"!==i,body:Ms(s)},l={type:"supsub",mode:o.mode,base:a,sup:"\\underset"===i?null:o,sub:"\\underset"===i?o:null};return{type:"mclass",mode:r.mode,mclass:n,body:[l],isCharacterBox:Dr(l)}},htmlBuilder:ya,mathmlBuilder:va});var wa=(e,t)=>{var n=e.font,r=t.withFont(n);return Vs(e.body,r)},Sa=(e,t)=>{var n=e.font,r=t.withFont(n);return ro(e.body,r)},_a={"\\Bbb":"\\mathbb","\\bold":"\\mathbf","\\frak":"\\mathfrak","\\bm":"\\boldsymbol"};Rs({type:"font",names:["\\mathrm","\\mathit","\\mathbf","\\mathnormal","\\mathbb","\\mathcal","\\mathfrak","\\mathscr","\\mathsf","\\mathtt","\\Bbb","\\bold","\\frak"],props:{numArgs:1,allowedInArgument:!0},handler:(e,t)=>{var{parser:n,funcName:r}=e,i=Ps(t[0]),s=r;return s in _a&&(s=_a[s]),{type:"font",mode:n.mode,font:s.slice(1),body:i}},htmlBuilder:wa,mathmlBuilder:Sa}),Rs({type:"mclass",names:["\\boldsymbol","\\bm"],props:{numArgs:1},handler:(e,t)=>{var{parser:n}=e,r=t[0],i=Dr(r);return{type:"mclass",mode:n.mode,mclass:ba(r),body:[{type:"font",mode:n.mode,font:"boldsymbol",body:r}],isCharacterBox:i}}}),Rs({type:"font",names:["\\rm","\\sf","\\tt","\\bf","\\it","\\cal"],props:{numArgs:0,allowedInText:!0},handler:(e,t)=>{var{parser:n,funcName:r,breakOnTokenText:i}=e,{mode:s}=n,o=n.parseExpression(!0,i);return{type:"font",mode:s,font:"math"+r.slice(1),body:{type:"ordgroup",mode:n.mode,body:o}}},htmlBuilder:wa,mathmlBuilder:Sa});var ka=(e,t)=>{var n=t;return"display"===e?n=n.id>=Wr.SCRIPT.id?n.text():Wr.DISPLAY:"text"===e&&n.size===Wr.DISPLAY.size?n=Wr.TEXT:"script"===e?n=Wr.SCRIPT:"scriptscript"===e&&(n=Wr.SCRIPTSCRIPT),n},xa=(e,t)=>{var n,r=ka(e.size,t.style),i=r.fracNum(),s=r.fracDen();n=t.havingStyle(i);var o=Vs(e.numer,n,t);if(e.continued){var a=8.5/t.fontMetrics().ptPerEm,l=3.5/t.fontMetrics().ptPerEm;o.height=o.height<a?a:o.height,o.depth=o.depth<l?l:o.depth}n=t.havingStyle(s);var c,d,u,h,p,m,g,f,y,v,b=Vs(e.denom,n,t);if(e.hasBarLine?(e.barSize?(d=ui(e.barSize,t),c=Ss.makeLineSpan("frac-line",t,d)):c=Ss.makeLineSpan("frac-line",t),d=c.height,u=c.height):(c=null,d=0,u=t.fontMetrics().defaultRuleThickness),r.size===Wr.DISPLAY.size||"display"===e.size?(h=t.fontMetrics().num1,p=d>0?3*u:7*u,m=t.fontMetrics().denom1):(d>0?(h=t.fontMetrics().num2,p=u):(h=t.fontMetrics().num3,p=3*u),m=t.fontMetrics().denom2),c){var w=t.fontMetrics().axisHeight;h-o.depth-(w+.5*d)<p&&(h+=p-(h-o.depth-(w+.5*d))),w-.5*d-(b.height-m)<p&&(m+=p-(w-.5*d-(b.height-m))),g=Ss.makeVList({positionType:"individualShift",children:[{type:"elem",elem:b,shift:m},{type:"elem",elem:c,shift:-(w-.5*d)},{type:"elem",elem:o,shift:-h}]},t)}else{var S=h-o.depth-(b.height-m);S<p&&(h+=.5*(p-S),m+=.5*(p-S)),g=Ss.makeVList({positionType:"individualShift",children:[{type:"elem",elem:b,shift:m},{type:"elem",elem:o,shift:-h}]},t)}return n=t.havingStyle(r),g.height*=n.sizeMultiplier/t.sizeMultiplier,g.depth*=n.sizeMultiplier/t.sizeMultiplier,f=r.size===Wr.DISPLAY.size?t.fontMetrics().delim1:r.size===Wr.SCRIPTSCRIPT.size?t.havingStyle(Wr.SCRIPT).fontMetrics().delim2:t.fontMetrics().delim2,y=null==e.leftDelim?$s(t,["mopen"]):Yo.customSizedDelim(e.leftDelim,f,!0,t.havingStyle(r),e.mode,["mopen"]),v=e.continued?Ss.makeSpan([]):null==e.rightDelim?$s(t,["mclose"]):Yo.customSizedDelim(e.rightDelim,f,!0,t.havingStyle(r),e.mode,["mclose"]),Ss.makeSpan(["mord"].concat(n.sizingClasses(t)),[y,Ss.makeSpan(["mfrac"],[g]),v],t)},Ea=(e,t)=>{var n=new Zs.MathNode("mfrac",[ro(e.numer,t),ro(e.denom,t)]);if(e.hasBarLine){if(e.barSize){var r=ui(e.barSize,t);n.setAttribute("linethickness",hi(r))}}else n.setAttribute("linethickness","0px");var i=ka(e.size,t.style);if(i.size!==t.style.size){n=new Zs.MathNode("mstyle",[n]);var s=i.size===Wr.DISPLAY.size?"true":"false";n.setAttribute("displaystyle",s),n.setAttribute("scriptlevel","0")}if(null!=e.leftDelim||null!=e.rightDelim){var o=[];if(null!=e.leftDelim){var a=new Zs.MathNode("mo",[new Zs.TextNode(e.leftDelim.replace("\\",""))]);a.setAttribute("fence","true"),o.push(a)}if(o.push(n),null!=e.rightDelim){var l=new Zs.MathNode("mo",[new Zs.TextNode(e.rightDelim.replace("\\",""))]);l.setAttribute("fence","true"),o.push(l)}return Qs(o)}return n};Rs({type:"genfrac",names:["\\dfrac","\\frac","\\tfrac","\\dbinom","\\binom","\\tbinom","\\\\atopfrac","\\\\bracefrac","\\\\brackfrac"],props:{numArgs:2,allowedInArgument:!0},handler:(e,t)=>{var n,{parser:r,funcName:i}=e,s=t[0],o=t[1],a=null,l=null,c="auto";switch(i){case"\\dfrac":case"\\frac":case"\\tfrac":n=!0;break;case"\\\\atopfrac":n=!1;break;case"\\dbinom":case"\\binom":case"\\tbinom":n=!1,a="(",l=")";break;case"\\\\bracefrac":n=!1,a="\\{",l="\\}";break;case"\\\\brackfrac":n=!1,a="[",l="]";break;default:throw new Error("Unrecognized genfrac command")}switch(i){case"\\dfrac":case"\\dbinom":c="display";break;case"\\tfrac":case"\\tbinom":c="text"}return{type:"genfrac",mode:r.mode,continued:!1,numer:s,denom:o,hasBarLine:n,leftDelim:a,rightDelim:l,size:c,barSize:null}},htmlBuilder:xa,mathmlBuilder:Ea}),Rs({type:"genfrac",names:["\\cfrac"],props:{numArgs:2},handler:(e,t)=>{var{parser:n,funcName:r}=e,i=t[0],s=t[1];return{type:"genfrac",mode:n.mode,continued:!0,numer:i,denom:s,hasBarLine:!0,leftDelim:null,rightDelim:null,size:"display",barSize:null}}}),Rs({type:"infix",names:["\\over","\\choose","\\atop","\\brace","\\brack"],props:{numArgs:0,infix:!0},handler(e){var t,{parser:n,funcName:r,token:i}=e;switch(r){case"\\over":t="\\frac";break;case"\\choose":t="\\binom";break;case"\\atop":t="\\\\atopfrac";break;case"\\brace":t="\\\\bracefrac";break;case"\\brack":t="\\\\brackfrac";break;default:throw new Error("Unrecognized infix genfrac command")}return{type:"infix",mode:n.mode,replaceWith:t,token:i}}});var Ta=["display","text","script","scriptscript"],Ca=function(e){var t=null;return e.length>0&&(t="."===(t=e)?null:t),t};Rs({type:"genfrac",names:["\\genfrac"],props:{numArgs:6,allowedInArgument:!0,argTypes:["math","math","size","text","math","math"]},handler(e,t){var n,{parser:r}=e,i=t[4],s=t[5],o=Ps(t[0]),a="atom"===o.type&&"open"===o.family?Ca(o.text):null,l=Ps(t[1]),c="atom"===l.type&&"close"===l.family?Ca(l.text):null,d=ho(t[2],"size"),u=null;n=!!d.isBlank||(u=d.value).number>0;var h="auto",p=t[3];if("ordgroup"===p.type){if(p.body.length>0){var m=ho(p.body[0],"textord");h=Ta[Number(m.text)]}}else p=ho(p,"textord"),h=Ta[Number(p.text)];return{type:"genfrac",mode:r.mode,numer:i,denom:s,continued:!1,hasBarLine:n,barSize:u,leftDelim:a,rightDelim:c,size:h}},htmlBuilder:xa,mathmlBuilder:Ea}),Rs({type:"infix",names:["\\above"],props:{numArgs:1,argTypes:["size"],infix:!0},handler(e,t){var{parser:n,funcName:r,token:i}=e;return{type:"infix",mode:n.mode,replaceWith:"\\\\abovefrac",size:ho(t[0],"size").value,token:i}}}),Rs({type:"genfrac",names:["\\\\abovefrac"],props:{numArgs:3,argTypes:["math","size","math"]},handler:(e,t)=>{var{parser:n,funcName:r}=e,i=t[0],s=function(e){if(!e)throw new Error("Expected non-null, but got "+String(e));return e}(ho(t[1],"infix").size),o=t[2],a=s.number>0;return{type:"genfrac",mode:n.mode,numer:i,denom:o,continued:!1,hasBarLine:a,barSize:s,leftDelim:null,rightDelim:null,size:"auto"}},htmlBuilder:xa,mathmlBuilder:Ea});var Aa=(e,t)=>{var n,r,i=t.style;"supsub"===e.type?(n=e.sup?Vs(e.sup,t.havingStyle(i.sup()),t):Vs(e.sub,t.havingStyle(i.sub()),t),r=ho(e.base,"horizBrace")):r=ho(e,"horizBrace");var s,o=Vs(r.base,t.havingBaseStyle(Wr.DISPLAY)),a=uo(r,t);if(r.isOver?(s=Ss.makeVList({positionType:"firstBaseline",children:[{type:"elem",elem:o},{type:"kern",size:.1},{type:"elem",elem:a}]},t)).children[0].children[0].children[1].classes.push("svg-align"):(s=Ss.makeVList({positionType:"bottom",positionData:o.depth+.1+a.height,children:[{type:"elem",elem:a},{type:"kern",size:.1},{type:"elem",elem:o}]},t)).children[0].children[0].children[0].classes.push("svg-align"),n){var l=Ss.makeSpan(["mord",r.isOver?"mover":"munder"],[s],t);s=r.isOver?Ss.makeVList({positionType:"firstBaseline",children:[{type:"elem",elem:l},{type:"kern",size:.2},{type:"elem",elem:n}]},t):Ss.makeVList({positionType:"bottom",positionData:l.depth+.2+n.height+n.depth,children:[{type:"elem",elem:n},{type:"kern",size:.2},{type:"elem",elem:l}]},t)}return Ss.makeSpan(["mord",r.isOver?"mover":"munder"],[s],t)};Rs({type:"horizBrace",names:["\\overbrace","\\underbrace"],props:{numArgs:1},handler(e,t){var{parser:n,funcName:r}=e;return{type:"horizBrace",mode:n.mode,label:r,isOver:/^\\over/.test(r),base:t[0]}},htmlBuilder:Aa,mathmlBuilder:(e,t)=>{var n=co(e.label);return new Zs.MathNode(e.isOver?"mover":"munder",[ro(e.base,t),n])}}),Rs({type:"href",names:["\\href"],props:{numArgs:2,argTypes:["url","original"],allowedInText:!0},handler:(e,t)=>{var{parser:n}=e,r=t[1],i=ho(t[0],"url").url;return n.settings.isTrusted({command:"\\href",url:i})?{type:"href",mode:n.mode,href:i,body:Ms(r)}:n.formatUnsupportedCmd("\\href")},htmlBuilder:(e,t)=>{var n=Us(e.body,t,!1);return Ss.makeAnchor(e.href,[],n,t)},mathmlBuilder:(e,t)=>{var n=no(e.body,t);return n instanceof Ys||(n=new Ys("mrow",[n])),n.setAttribute("href",e.href),n}}),Rs({type:"href",names:["\\url"],props:{numArgs:1,argTypes:["url"],allowedInText:!0},handler:(e,t)=>{var{parser:n}=e,r=ho(t[0],"url").url;if(!n.settings.isTrusted({command:"\\url",url:r}))return n.formatUnsupportedCmd("\\url");for(var i=[],s=0;s<r.length;s++){var o=r[s];"~"===o&&(o="\\textasciitilde"),i.push({type:"textord",mode:"text",text:o})}var a={type:"text",mode:n.mode,font:"\\texttt",body:i};return{type:"href",mode:n.mode,href:r,body:Ms(a)}}}),Rs({type:"hbox",names:["\\hbox"],props:{numArgs:1,argTypes:["text"],allowedInText:!0,primitive:!0},handler(e,t){var{parser:n}=e;return{type:"hbox",mode:n.mode,body:Ms(t[0])}},htmlBuilder(e,t){var n=Us(e.body,t,!1);return Ss.makeFragment(n)},mathmlBuilder:(e,t)=>new Zs.MathNode("mrow",to(e.body,t))}),Rs({type:"html",names:["\\htmlClass","\\htmlId","\\htmlStyle","\\htmlData"],props:{numArgs:2,argTypes:["raw","original"],allowedInText:!0},handler:(e,t)=>{var n,{parser:r,funcName:i,token:s}=e,o=ho(t[0],"raw").string,a=t[1];r.settings.strict&&r.settings.reportNonstrict("htmlExtension","HTML extension is disabled on strict mode");var l={};switch(i){case"\\htmlClass":l.class=o,n={command:"\\htmlClass",class:o};break;case"\\htmlId":l.id=o,n={command:"\\htmlId",id:o};break;case"\\htmlStyle":l.style=o,n={command:"\\htmlStyle",style:o};break;case"\\htmlData":for(var c=o.split(","),d=0;d<c.length;d++){var u=c[d].split("=");if(2!==u.length)throw new xr("Error parsing key-value for \\htmlData");l["data-"+u[0].trim()]=u[1].trim()}n={command:"\\htmlData",attributes:l};break;default:throw new Error("Unrecognized html command")}return r.settings.isTrusted(n)?{type:"html",mode:r.mode,attributes:l,body:Ms(a)}:r.formatUnsupportedCmd(i)},htmlBuilder:(e,t)=>{var n=Us(e.body,t,!1),r=["enclosing"];e.attributes.class&&r.push(...e.attributes.class.trim().split(/\s+/));var i=Ss.makeSpan(r,n,t);for(var s in e.attributes)"class"!==s&&e.attributes.hasOwnProperty(s)&&i.setAttribute(s,e.attributes[s]);return i},mathmlBuilder:(e,t)=>no(e.body,t)}),Rs({type:"htmlmathml",names:["\\html@mathml"],props:{numArgs:2,allowedInText:!0},handler:(e,t)=>{var{parser:n}=e;return{type:"htmlmathml",mode:n.mode,html:Ms(t[0]),mathml:Ms(t[1])}},htmlBuilder:(e,t)=>{var n=Us(e.html,t,!1);return Ss.makeFragment(n)},mathmlBuilder:(e,t)=>no(e.mathml,t)});var Ia=function(e){if(/^[-+]? *(\d+(\.\d*)?|\.\d+)$/.test(e))return{number:+e,unit:"bp"};var t=/([-+]?) *(\d+(?:\.\d*)?|\.\d+) *([a-z]{2})/.exec(e);if(!t)throw new xr("Invalid size: '"+e+"' in \\includegraphics");var n={number:+(t[1]+t[2]),unit:t[3]};if(!di(n))throw new xr("Invalid unit: '"+n.unit+"' in \\includegraphics.");return n};Rs({type:"includegraphics",names:["\\includegraphics"],props:{numArgs:1,numOptionalArgs:1,argTypes:["raw","url"],allowedInText:!1},handler:(e,t,n)=>{var{parser:r}=e,i={number:0,unit:"em"},s={number:.9,unit:"em"},o={number:0,unit:"em"},a="";if(n[0])for(var l=ho(n[0],"raw").string.split(","),c=0;c<l.length;c++){var d=l[c].split("=");if(2===d.length){var u=d[1].trim();switch(d[0].trim()){case"alt":a=u;break;case"width":i=Ia(u);break;case"height":s=Ia(u);break;case"totalheight":o=Ia(u);break;default:throw new xr("Invalid key: '"+d[0]+"' in \\includegraphics.")}}}var h=ho(t[0],"url").url;return""===a&&(a=(a=(a=h).replace(/^.*[\\/]/,"")).substring(0,a.lastIndexOf("."))),r.settings.isTrusted({command:"\\includegraphics",url:h})?{type:"includegraphics",mode:r.mode,alt:a,width:i,height:s,totalheight:o,src:h}:r.formatUnsupportedCmd("\\includegraphics")},htmlBuilder:(e,t)=>{var n=ui(e.height,t),r=0;e.totalheight.number>0&&(r=ui(e.totalheight,t)-n);var i=0;e.width.number>0&&(i=ui(e.width,t));var s={height:hi(n+r)};i>0&&(s.width=hi(i)),r>0&&(s.verticalAlign=hi(-r));var o=new bi(e.src,e.alt,s);return o.height=n,o.depth=r,o},mathmlBuilder:(e,t)=>{var n=new Zs.MathNode("mglyph",[]);n.setAttribute("alt",e.alt);var r=ui(e.height,t),i=0;if(e.totalheight.number>0&&(i=ui(e.totalheight,t)-r,n.setAttribute("valign",hi(-i))),n.setAttribute("height",hi(r+i)),e.width.number>0){var s=ui(e.width,t);n.setAttribute("width",hi(s))}return n.setAttribute("src",e.src),n}}),Rs({type:"kern",names:["\\kern","\\mkern","\\hskip","\\mskip"],props:{numArgs:1,argTypes:["size"],primitive:!0,allowedInText:!0},handler(e,t){var{parser:n,funcName:r}=e,i=ho(t[0],"size");if(n.settings.strict){var s="m"===r[1],o="mu"===i.value.unit;s?(o||n.settings.reportNonstrict("mathVsTextUnits","LaTeX's "+r+" supports only mu units, not "+i.value.unit+" units"),"math"!==n.mode&&n.settings.reportNonstrict("mathVsTextUnits","LaTeX's "+r+" works only in math mode")):o&&n.settings.reportNonstrict("mathVsTextUnits","LaTeX's "+r+" doesn't support mu units")}return{type:"kern",mode:n.mode,dimension:i.value}},htmlBuilder:(e,t)=>Ss.makeGlue(e.dimension,t),mathmlBuilder(e,t){var n=ui(e.dimension,t);return new Zs.SpaceNode(n)}}),Rs({type:"lap",names:["\\mathllap","\\mathrlap","\\mathclap"],props:{numArgs:1,allowedInText:!0},handler:(e,t)=>{var{parser:n,funcName:r}=e,i=t[0];return{type:"lap",mode:n.mode,alignment:r.slice(5),body:i}},htmlBuilder:(e,t)=>{var n;"clap"===e.alignment?(n=Ss.makeSpan([],[Vs(e.body,t)]),n=Ss.makeSpan(["inner"],[n],t)):n=Ss.makeSpan(["inner"],[Vs(e.body,t)]);var r=Ss.makeSpan(["fix"],[]),i=Ss.makeSpan([e.alignment],[n,r],t),s=Ss.makeSpan(["strut"]);return s.style.height=hi(i.height+i.depth),i.depth&&(s.style.verticalAlign=hi(-i.depth)),i.children.unshift(s),i=Ss.makeSpan(["thinbox"],[i],t),Ss.makeSpan(["mord","vbox"],[i],t)},mathmlBuilder:(e,t)=>{var n=new Zs.MathNode("mpadded",[ro(e.body,t)]);if("rlap"!==e.alignment){var r="llap"===e.alignment?"-1":"-0.5";n.setAttribute("lspace",r+"width")}return n.setAttribute("width","0px"),n}}),Rs({type:"styling",names:["\\(","$"],props:{numArgs:0,allowedInText:!0,allowedInMath:!1},handler(e,t){var{funcName:n,parser:r}=e,i=r.mode;r.switchMode("math");var s="\\("===n?"\\)":"$",o=r.parseExpression(!1,s);return r.expect(s),r.switchMode(i),{type:"styling",mode:r.mode,style:"text",body:o}}}),Rs({type:"text",names:["\\)","\\]"],props:{numArgs:0,allowedInText:!0,allowedInMath:!1},handler(e,t){throw new xr("Mismatched "+e.funcName)}});var Ra=(e,t)=>{switch(t.style.size){case Wr.DISPLAY.size:return e.display;case Wr.TEXT.size:return e.text;case Wr.SCRIPT.size:return e.script;case Wr.SCRIPTSCRIPT.size:return e.scriptscript;default:return e.text}};Rs({type:"mathchoice",names:["\\mathchoice"],props:{numArgs:4,primitive:!0},handler:(e,t)=>{var{parser:n}=e;return{type:"mathchoice",mode:n.mode,display:Ms(t[0]),text:Ms(t[1]),script:Ms(t[2]),scriptscript:Ms(t[3])}},htmlBuilder:(e,t)=>{var n=Ra(e,t),r=Us(n,t,!1);return Ss.makeFragment(r)},mathmlBuilder:(e,t)=>{var n=Ra(e,t);return no(n,t)}});var Oa=(e,t,n,r,i,s,o)=>{e=Ss.makeSpan([],[e]);var a,l,c,d=n&&Dr(n);if(t){var u=Vs(t,r.havingStyle(i.sup()),r);l={elem:u,kern:Math.max(r.fontMetrics().bigOpSpacing1,r.fontMetrics().bigOpSpacing3-u.depth)}}if(n){var h=Vs(n,r.havingStyle(i.sub()),r);a={elem:h,kern:Math.max(r.fontMetrics().bigOpSpacing2,r.fontMetrics().bigOpSpacing4-h.height)}}if(l&&a){var p=r.fontMetrics().bigOpSpacing5+a.elem.height+a.elem.depth+a.kern+e.depth+o;c=Ss.makeVList({positionType:"bottom",positionData:p,children:[{type:"kern",size:r.fontMetrics().bigOpSpacing5},{type:"elem",elem:a.elem,marginLeft:hi(-s)},{type:"kern",size:a.kern},{type:"elem",elem:e},{type:"kern",size:l.kern},{type:"elem",elem:l.elem,marginLeft:hi(s)},{type:"kern",size:r.fontMetrics().bigOpSpacing5}]},r)}else if(a){var m=e.height-o;c=Ss.makeVList({positionType:"top",positionData:m,children:[{type:"kern",size:r.fontMetrics().bigOpSpacing5},{type:"elem",elem:a.elem,marginLeft:hi(-s)},{type:"kern",size:a.kern},{type:"elem",elem:e}]},r)}else{if(!l)return e;var g=e.depth+o;c=Ss.makeVList({positionType:"bottom",positionData:g,children:[{type:"elem",elem:e},{type:"kern",size:l.kern},{type:"elem",elem:l.elem,marginLeft:hi(s)},{type:"kern",size:r.fontMetrics().bigOpSpacing5}]},r)}var f=[c];if(a&&0!==s&&!d){var y=Ss.makeSpan(["mspace"],[],r);y.style.marginRight=hi(s),f.unshift(y)}return Ss.makeSpan(["mop","op-limits"],f,r)},Pa=["\\smallint"],Ma=(e,t)=>{var n,r,i,s=!1;"supsub"===e.type?(n=e.sup,r=e.sub,i=ho(e.base,"op"),s=!0):i=ho(e,"op");var o,a=t.style,l=!1;if(a.size===Wr.DISPLAY.size&&i.symbol&&!Ir(Pa,i.name)&&(l=!0),i.symbol){var c=l?"Size2-Regular":"Size1-Regular",d="";if("\\oiint"!==i.name&&"\\oiiint"!==i.name||(d=i.name.substr(1),i.name="oiint"===d?"\\iint":"\\iiint"),o=Ss.makeSymbol(i.name,c,"math",t,["mop","op-symbol",l?"large-op":"small-op"]),d.length>0){var u=o.italic,h=Ss.staticSvg(d+"Size"+(l?"2":"1"),t);o=Ss.makeVList({positionType:"individualShift",children:[{type:"elem",elem:o,shift:0},{type:"elem",elem:h,shift:l?.08:0}]},t),i.name="\\"+d,o.classes.unshift("mop"),o.italic=u}}else if(i.body){var p=Us(i.body,t,!0);1===p.length&&p[0]instanceof Si?(o=p[0]).classes[0]="mop":o=Ss.makeSpan(["mop"],p,t)}else{for(var m=[],g=1;g<i.name.length;g++)m.push(Ss.mathsym(i.name[g],i.mode,t));o=Ss.makeSpan(["mop"],m,t)}var f=0,y=0;return(o instanceof Si||"\\oiint"===i.name||"\\oiiint"===i.name)&&!i.suppressBaseShift&&(f=(o.height-o.depth)/2-t.fontMetrics().axisHeight,y=o.italic),s?Oa(o,n,r,t,a,y,f):(f&&(o.style.position="relative",o.style.top=hi(f)),o)},Da=(e,t)=>{var n;if(e.symbol)n=new Ys("mo",[Js(e.name,e.mode)]),Ir(Pa,e.name)&&n.setAttribute("largeop","false");else if(e.body)n=new Ys("mo",to(e.body,t));else{n=new Ys("mi",[new Xs(e.name.slice(1))]);var r=new Ys("mo",[Js("","text")]);n=e.parentIsSupSub?new Ys("mrow",[n,r]):Gs([n,r])}return n},La={"":"\\prod","":"\\coprod","":"\\sum","":"\\bigwedge","":"\\bigvee","":"\\bigcap","":"\\bigcup","":"\\bigodot","":"\\bigoplus","":"\\bigotimes","":"\\biguplus","":"\\bigsqcup"};Rs({type:"op",names:["\\coprod","\\bigvee","\\bigwedge","\\biguplus","\\bigcap","\\bigcup","\\intop","\\prod","\\sum","\\bigotimes","\\bigoplus","\\bigodot","\\bigsqcup","\\smallint","","","","","","","","","","","",""],props:{numArgs:0},handler:(e,t)=>{var{parser:n,funcName:r}=e,i=r;return 1===i.length&&(i=La[i]),{type:"op",mode:n.mode,limits:!0,parentIsSupSub:!1,symbol:!0,name:i}},htmlBuilder:Ma,mathmlBuilder:Da}),Rs({type:"op",names:["\\mathop"],props:{numArgs:1,primitive:!0},handler:(e,t)=>{var{parser:n}=e,r=t[0];return{type:"op",mode:n.mode,limits:!1,parentIsSupSub:!1,symbol:!1,body:Ms(r)}},htmlBuilder:Ma,mathmlBuilder:Da});var Fa={"":"\\int","":"\\iint","":"\\iiint","":"\\oint","":"\\oiint","":"\\oiiint"};Rs({type:"op",names:["\\arcsin","\\arccos","\\arctan","\\arctg","\\arcctg","\\arg","\\ch","\\cos","\\cosec","\\cosh","\\cot","\\cotg","\\coth","\\csc","\\ctg","\\cth","\\deg","\\dim","\\exp","\\hom","\\ker","\\lg","\\ln","\\log","\\sec","\\sin","\\sinh","\\sh","\\tan","\\tanh","\\tg","\\th"],props:{numArgs:0},handler(e){var{parser:t,funcName:n}=e;return{type:"op",mode:t.mode,limits:!1,parentIsSupSub:!1,symbol:!1,name:n}},htmlBuilder:Ma,mathmlBuilder:Da}),Rs({type:"op",names:["\\det","\\gcd","\\inf","\\lim","\\max","\\min","\\Pr","\\sup"],props:{numArgs:0},handler(e){var{parser:t,funcName:n}=e;return{type:"op",mode:t.mode,limits:!0,parentIsSupSub:!1,symbol:!1,name:n}},htmlBuilder:Ma,mathmlBuilder:Da}),Rs({type:"op",names:["\\int","\\iint","\\iiint","\\oint","\\oiint","\\oiiint","","","","","",""],props:{numArgs:0},handler(e){var{parser:t,funcName:n}=e,r=n;return 1===r.length&&(r=Fa[r]),{type:"op",mode:t.mode,limits:!1,parentIsSupSub:!1,symbol:!0,name:r}},htmlBuilder:Ma,mathmlBuilder:Da});var Na=(e,t)=>{var n,r,i,s,o=!1;if("supsub"===e.type?(n=e.sup,r=e.sub,i=ho(e.base,"operatorname"),o=!0):i=ho(e,"operatorname"),i.body.length>0){for(var a=i.body.map((e=>{var t=e.text;return"string"==typeof t?{type:"textord",mode:e.mode,text:t}:e})),l=Us(a,t.withFont("mathrm"),!0),c=0;c<l.length;c++){var d=l[c];d instanceof Si&&(d.text=d.text.replace(/\u2212/,"-").replace(/\u2217/,"*"))}s=Ss.makeSpan(["mop"],l,t)}else s=Ss.makeSpan(["mop"],[],t);return o?Oa(s,n,r,t,t.style,0,0):s};function ja(e,t,n){for(var r=Us(e,t,!1),i=t.sizeMultiplier/n.sizeMultiplier,s=0;s<r.length;s++){var o=r[s].classes.indexOf("sizing");o<0?Array.prototype.push.apply(r[s].classes,t.sizingClasses(n)):r[s].classes[o+1]==="reset-size"+t.size&&(r[s].classes[o+1]="reset-size"+n.size),r[s].height*=i,r[s].depth*=i}return Ss.makeFragment(r)}Rs({type:"operatorname",names:["\\operatorname@","\\operatornamewithlimits"],props:{numArgs:1},handler:(e,t)=>{var{parser:n,funcName:r}=e,i=t[0];return{type:"operatorname",mode:n.mode,body:Ms(i),alwaysHandleSupSub:"\\operatornamewithlimits"===r,limits:!1,parentIsSupSub:!1}},htmlBuilder:Na,mathmlBuilder:(e,t)=>{for(var n=to(e.body,t.withFont("mathrm")),r=!0,i=0;i<n.length;i++){var s=n[i];if(s instanceof Zs.SpaceNode);else if(s instanceof Zs.MathNode)switch(s.type){case"mi":case"mn":case"ms":case"mspace":case"mtext":break;case"mo":var o=s.children[0];1===s.children.length&&o instanceof Zs.TextNode?o.text=o.text.replace(/\u2212/,"-").replace(/\u2217/,"*"):r=!1;break;default:r=!1}else r=!1}if(r){var a=n.map((e=>e.toText())).join("");n=[new Zs.TextNode(a)]}var l=new Zs.MathNode("mi",n);l.setAttribute("mathvariant","normal");var c=new Zs.MathNode("mo",[Js("","text")]);return e.parentIsSupSub?new Zs.MathNode("mrow",[l,c]):Zs.newDocumentFragment([l,c])}}),sa("\\operatorname","\\@ifstar\\operatornamewithlimits\\operatorname@"),Os({type:"ordgroup",htmlBuilder:(e,t)=>e.semisimple?Ss.makeFragment(Us(e.body,t,!1)):Ss.makeSpan(["mord"],Us(e.body,t,!0),t),mathmlBuilder:(e,t)=>no(e.body,t,!0)}),Rs({type:"overline",names:["\\overline"],props:{numArgs:1},handler(e,t){var{parser:n}=e,r=t[0];return{type:"overline",mode:n.mode,body:r}},htmlBuilder(e,t){var n=Vs(e.body,t.havingCrampedStyle()),r=Ss.makeLineSpan("overline-line",t),i=t.fontMetrics().defaultRuleThickness,s=Ss.makeVList({positionType:"firstBaseline",children:[{type:"elem",elem:n},{type:"kern",size:3*i},{type:"elem",elem:r},{type:"kern",size:i}]},t);return Ss.makeSpan(["mord","overline"],[s],t)},mathmlBuilder(e,t){var n=new Zs.MathNode("mo",[new Zs.TextNode("")]);n.setAttribute("stretchy","true");var r=new Zs.MathNode("mover",[ro(e.body,t),n]);return r.setAttribute("accent","true"),r}}),Rs({type:"phantom",names:["\\phantom"],props:{numArgs:1,allowedInText:!0},handler:(e,t)=>{var{parser:n}=e,r=t[0];return{type:"phantom",mode:n.mode,body:Ms(r)}},htmlBuilder:(e,t)=>{var n=Us(e.body,t.withPhantom(),!1);return Ss.makeFragment(n)},mathmlBuilder:(e,t)=>{var n=to(e.body,t);return new Zs.MathNode("mphantom",n)}}),Rs({type:"hphantom",names:["\\hphantom"],props:{numArgs:1,allowedInText:!0},handler:(e,t)=>{var{parser:n}=e,r=t[0];return{type:"hphantom",mode:n.mode,body:r}},htmlBuilder:(e,t)=>{var n=Ss.makeSpan([],[Vs(e.body,t.withPhantom())]);if(n.height=0,n.depth=0,n.children)for(var r=0;r<n.children.length;r++)n.children[r].height=0,n.children[r].depth=0;return n=Ss.makeVList({positionType:"firstBaseline",children:[{type:"elem",elem:n}]},t),Ss.makeSpan(["mord"],[n],t)},mathmlBuilder:(e,t)=>{var n=to(Ms(e.body),t),r=new Zs.MathNode("mphantom",n),i=new Zs.MathNode("mpadded",[r]);return i.setAttribute("height","0px"),i.setAttribute("depth","0px"),i}}),Rs({type:"vphantom",names:["\\vphantom"],props:{numArgs:1,allowedInText:!0},handler:(e,t)=>{var{parser:n}=e,r=t[0];return{type:"vphantom",mode:n.mode,body:r}},htmlBuilder:(e,t)=>{var n=Ss.makeSpan(["inner"],[Vs(e.body,t.withPhantom())]),r=Ss.makeSpan(["fix"],[]);return Ss.makeSpan(["mord","rlap"],[n,r],t)},mathmlBuilder:(e,t)=>{var n=to(Ms(e.body),t),r=new Zs.MathNode("mphantom",n),i=new Zs.MathNode("mpadded",[r]);return i.setAttribute("width","0px"),i}}),Rs({type:"raisebox",names:["\\raisebox"],props:{numArgs:2,argTypes:["size","hbox"],allowedInText:!0},handler(e,t){var{parser:n}=e,r=ho(t[0],"size").value,i=t[1];return{type:"raisebox",mode:n.mode,dy:r,body:i}},htmlBuilder(e,t){var n=Vs(e.body,t),r=ui(e.dy,t);return Ss.makeVList({positionType:"shift",positionData:-r,children:[{type:"elem",elem:n}]},t)},mathmlBuilder(e,t){var n=new Zs.MathNode("mpadded",[ro(e.body,t)]),r=e.dy.number+e.dy.unit;return n.setAttribute("voffset",r),n}}),Rs({type:"internal",names:["\\relax"],props:{numArgs:0,allowedInText:!0},handler(e){var{parser:t}=e;return{type:"internal",mode:t.mode}}}),Rs({type:"rule",names:["\\rule"],props:{numArgs:2,numOptionalArgs:1,argTypes:["size","size","size"]},handler(e,t,n){var{parser:r}=e,i=n[0],s=ho(t[0],"size"),o=ho(t[1],"size");return{type:"rule",mode:r.mode,shift:i&&ho(i,"size").value,width:s.value,height:o.value}},htmlBuilder(e,t){var n=Ss.makeSpan(["mord","rule"],[],t),r=ui(e.width,t),i=ui(e.height,t),s=e.shift?ui(e.shift,t):0;return n.style.borderRightWidth=hi(r),n.style.borderTopWidth=hi(i),n.style.bottom=hi(s),n.width=r,n.height=i+s,n.depth=-s,n.maxFontSize=1.125*i*t.sizeMultiplier,n},mathmlBuilder(e,t){var n=ui(e.width,t),r=ui(e.height,t),i=e.shift?ui(e.shift,t):0,s=t.color&&t.getColor()||"black",o=new Zs.MathNode("mspace");o.setAttribute("mathbackground",s),o.setAttribute("width",hi(n)),o.setAttribute("height",hi(r));var a=new Zs.MathNode("mpadded",[o]);return i>=0?a.setAttribute("height",hi(i)):(a.setAttribute("height",hi(i)),a.setAttribute("depth",hi(-i))),a.setAttribute("voffset",hi(i)),a}});var Ua=["\\tiny","\\sixptsize","\\scriptsize","\\footnotesize","\\small","\\normalsize","\\large","\\Large","\\LARGE","\\huge","\\Huge"];Rs({type:"sizing",names:Ua,props:{numArgs:0,allowedInText:!0},handler:(e,t)=>{var{breakOnTokenText:n,funcName:r,parser:i}=e,s=i.parseExpression(!1,n);return{type:"sizing",mode:i.mode,size:Ua.indexOf(r)+1,body:s}},htmlBuilder:(e,t)=>{var n=t.havingSize(e.size);return ja(e.body,n,t)},mathmlBuilder:(e,t)=>{var n=t.havingSize(e.size),r=to(e.body,n),i=new Zs.MathNode("mstyle",r);return i.setAttribute("mathsize",hi(n.sizeMultiplier)),i}}),Rs({type:"smash",names:["\\smash"],props:{numArgs:1,numOptionalArgs:1,allowedInText:!0},handler:(e,t,n)=>{var{parser:r}=e,i=!1,s=!1,o=n[0]&&ho(n[0],"ordgroup");if(o)for(var a="",l=0;l<o.body.length;++l)if("t"===(a=o.body[l].text))i=!0;else{if("b"!==a){i=!1,s=!1;break}s=!0}else i=!0,s=!0;var c=t[0];return{type:"smash",mode:r.mode,body:c,smashHeight:i,smashDepth:s}},htmlBuilder:(e,t)=>{var n=Ss.makeSpan([],[Vs(e.body,t)]);if(!e.smashHeight&&!e.smashDepth)return n;if(e.smashHeight&&(n.height=0,n.children))for(var r=0;r<n.children.length;r++)n.children[r].height=0;if(e.smashDepth&&(n.depth=0,n.children))for(var i=0;i<n.children.length;i++)n.children[i].depth=0;var s=Ss.makeVList({positionType:"firstBaseline",children:[{type:"elem",elem:n}]},t);return Ss.makeSpan(["mord"],[s],t)},mathmlBuilder:(e,t)=>{var n=new Zs.MathNode("mpadded",[ro(e.body,t)]);return e.smashHeight&&n.setAttribute("height","0px"),e.smashDepth&&n.setAttribute("depth","0px"),n}}),Rs({type:"sqrt",names:["\\sqrt"],props:{numArgs:1,numOptionalArgs:1},handler(e,t,n){var{parser:r}=e,i=n[0],s=t[0];return{type:"sqrt",mode:r.mode,body:s,index:i}},htmlBuilder(e,t){var n=Vs(e.body,t.havingCrampedStyle());0===n.height&&(n.height=t.fontMetrics().xHeight),n=Ss.wrapFragment(n,t);var r=t.fontMetrics().defaultRuleThickness,i=r;t.style.id<Wr.TEXT.id&&(i=t.fontMetrics().xHeight);var s=r+i/4,o=n.height+n.depth+s+r,{span:a,ruleWidth:l,advanceWidth:c}=Yo.sqrtImage(o,t),d=a.height-l;d>n.height+n.depth+s&&(s=(s+d-n.height-n.depth)/2);var u=a.height-n.height-s-l;n.style.paddingLeft=hi(c);var h=Ss.makeVList({positionType:"firstBaseline",children:[{type:"elem",elem:n,wrapperClasses:["svg-align"]},{type:"kern",size:-(n.height+u)},{type:"elem",elem:a},{type:"kern",size:l}]},t);if(e.index){var p=t.havingStyle(Wr.SCRIPTSCRIPT),m=Vs(e.index,p,t),g=.6*(h.height-h.depth),f=Ss.makeVList({positionType:"shift",positionData:-g,children:[{type:"elem",elem:m}]},t),y=Ss.makeSpan(["root"],[f]);return Ss.makeSpan(["mord","sqrt"],[y,h],t)}return Ss.makeSpan(["mord","sqrt"],[h],t)},mathmlBuilder(e,t){var{body:n,index:r}=e;return r?new Zs.MathNode("mroot",[ro(n,t),ro(r,t)]):new Zs.MathNode("msqrt",[ro(n,t)])}});var Ba={display:Wr.DISPLAY,text:Wr.TEXT,script:Wr.SCRIPT,scriptscript:Wr.SCRIPTSCRIPT};Rs({type:"styling",names:["\\displaystyle","\\textstyle","\\scriptstyle","\\scriptscriptstyle"],props:{numArgs:0,allowedInText:!0,primitive:!0},handler(e,t){var{breakOnTokenText:n,funcName:r,parser:i}=e,s=i.parseExpression(!0,n),o=r.slice(1,r.length-5);return{type:"styling",mode:i.mode,style:o,body:s}},htmlBuilder(e,t){var n=Ba[e.style],r=t.havingStyle(n).withFont("");return ja(e.body,r,t)},mathmlBuilder(e,t){var n=Ba[e.style],r=t.havingStyle(n),i=to(e.body,r),s=new Zs.MathNode("mstyle",i),o={display:["0","true"],text:["0","false"],script:["1","false"],scriptscript:["2","false"]}[e.style];return s.setAttribute("scriptlevel",o[0]),s.setAttribute("displaystyle",o[1]),s}}),Os({type:"supsub",htmlBuilder(e,t){var n=function(e,t){var n=e.base;return n?"op"===n.type?n.limits&&(t.style.size===Wr.DISPLAY.size||n.alwaysHandleSupSub)?Ma:null:"operatorname"===n.type?n.alwaysHandleSupSub&&(t.style.size===Wr.DISPLAY.size||n.limits)?Na:null:"accent"===n.type?Dr(n.base)?go:null:"horizBrace"===n.type&&!e.sub===n.isOver?Aa:null:null}(e,t);if(n)return n(e,t);var r,i,s,{base:o,sup:a,sub:l}=e,c=Vs(o,t),d=t.fontMetrics(),u=0,h=0,p=o&&Dr(o);if(a){var m=t.havingStyle(t.style.sup());r=Vs(a,m,t),p||(u=c.height-m.fontMetrics().supDrop*m.sizeMultiplier/t.sizeMultiplier)}if(l){var g=t.havingStyle(t.style.sub());i=Vs(l,g,t),p||(h=c.depth+g.fontMetrics().subDrop*g.sizeMultiplier/t.sizeMultiplier)}s=t.style===Wr.DISPLAY?d.sup1:t.style.cramped?d.sup3:d.sup2;var f,y=t.sizeMultiplier,v=hi(.5/d.ptPerEm/y),b=null;if(i){var w=e.base&&"op"===e.base.type&&e.base.name&&("\\oiint"===e.base.name||"\\oiiint"===e.base.name);(c instanceof Si||w)&&(b=hi(-c.italic))}if(r&&i){u=Math.max(u,s,r.depth+.25*d.xHeight),h=Math.max(h,d.sub2);var S=4*d.defaultRuleThickness;if(u-r.depth-(i.height-h)<S){h=S-(u-r.depth)+i.height;var _=.8*d.xHeight-(u-r.depth);_>0&&(u+=_,h-=_)}f=Ss.makeVList({positionType:"individualShift",children:[{type:"elem",elem:i,shift:h,marginRight:v,marginLeft:b},{type:"elem",elem:r,shift:-u,marginRight:v}]},t)}else if(i){h=Math.max(h,d.sub1,i.height-.8*d.xHeight),f=Ss.makeVList({positionType:"shift",positionData:h,children:[{type:"elem",elem:i,marginLeft:b,marginRight:v}]},t)}else{if(!r)throw new Error("supsub must have either sup or sub.");u=Math.max(u,s,r.depth+.25*d.xHeight),f=Ss.makeVList({positionType:"shift",positionData:-u,children:[{type:"elem",elem:r,marginRight:v}]},t)}var k=zs(c,"right")||"mord";return Ss.makeSpan([k],[c,Ss.makeSpan(["msupsub"],[f])],t)},mathmlBuilder(e,t){var n,r=!1;e.base&&"horizBrace"===e.base.type&&!!e.sup===e.base.isOver&&(r=!0,n=e.base.isOver),!e.base||"op"!==e.base.type&&"operatorname"!==e.base.type||(e.base.parentIsSupSub=!0);var i,s=[ro(e.base,t)];if(e.sub&&s.push(ro(e.sub,t)),e.sup&&s.push(ro(e.sup,t)),r)i=n?"mover":"munder";else if(e.sub)if(e.sup){var o=e.base;i=o&&"op"===o.type&&o.limits&&t.style===Wr.DISPLAY||o&&"operatorname"===o.type&&o.alwaysHandleSupSub&&(t.style===Wr.DISPLAY||o.limits)?"munderover":"msubsup"}else{var a=e.base;i=a&&"op"===a.type&&a.limits&&(t.style===Wr.DISPLAY||a.alwaysHandleSupSub)||a&&"operatorname"===a.type&&a.alwaysHandleSupSub&&(a.limits||t.style===Wr.DISPLAY)?"munder":"msub"}else{var l=e.base;i=l&&"op"===l.type&&l.limits&&(t.style===Wr.DISPLAY||l.alwaysHandleSupSub)||l&&"operatorname"===l.type&&l.alwaysHandleSupSub&&(l.limits||t.style===Wr.DISPLAY)?"mover":"msup"}return new Zs.MathNode(i,s)}}),Os({type:"atom",htmlBuilder:(e,t)=>Ss.mathsym(e.text,e.mode,t,["m"+e.family]),mathmlBuilder(e,t){var n=new Zs.MathNode("mo",[Js(e.text,e.mode)]);if("bin"===e.family){var r=eo(e,t);"bold-italic"===r&&n.setAttribute("mathvariant",r)}else"punct"===e.family?n.setAttribute("separator","true"):"open"!==e.family&&"close"!==e.family||n.setAttribute("stretchy","false");return n}});var qa={mi:"italic",mn:"normal",mtext:"normal"};Os({type:"mathord",htmlBuilder:(e,t)=>Ss.makeOrd(e,t,"mathord"),mathmlBuilder(e,t){var n=new Zs.MathNode("mi",[Js(e.text,e.mode,t)]),r=eo(e,t)||"italic";return r!==qa[n.type]&&n.setAttribute("mathvariant",r),n}}),Os({type:"textord",htmlBuilder:(e,t)=>Ss.makeOrd(e,t,"textord"),mathmlBuilder(e,t){var n,r=Js(e.text,e.mode,t),i=eo(e,t)||"normal";return n="text"===e.mode?new Zs.MathNode("mtext",[r]):/[0-9]/.test(e.text)?new Zs.MathNode("mn",[r]):"\\prime"===e.text?new Zs.MathNode("mo",[r]):new Zs.MathNode("mi",[r]),i!==qa[n.type]&&n.setAttribute("mathvariant",i),n}});var Ka={"\\nobreak":"nobreak","\\allowbreak":"allowbreak"},za={" ":{},"\\ ":{},"~":{className:"nobreak"},"\\space":{},"\\nobreakspace":{className:"nobreak"}};Os({type:"spacing",htmlBuilder(e,t){if(za.hasOwnProperty(e.text)){var n=za[e.text].className||"";if("text"===e.mode){var r=Ss.makeOrd(e,t,"textord");return r.classes.push(n),r}return Ss.makeSpan(["mspace",n],[Ss.mathsym(e.text,e.mode,t)],t)}if(Ka.hasOwnProperty(e.text))return Ss.makeSpan(["mspace",Ka[e.text]],[],t);throw new xr('Unknown type of space "'+e.text+'"')},mathmlBuilder(e,t){if(!za.hasOwnProperty(e.text)){if(Ka.hasOwnProperty(e.text))return new Zs.MathNode("mspace");throw new xr('Unknown type of space "'+e.text+'"')}return new Zs.MathNode("mtext",[new Zs.TextNode("")])}});var $a=()=>{var e=new Zs.MathNode("mtd",[]);return e.setAttribute("width","50%"),e};Os({type:"tag",mathmlBuilder(e,t){var n=new Zs.MathNode("mtable",[new Zs.MathNode("mtr",[$a(),new Zs.MathNode("mtd",[no(e.body,t)]),$a(),new Zs.MathNode("mtd",[no(e.tag,t)])])]);return n.setAttribute("width","100%"),n}});var Va={"\\text":void 0,"\\textrm":"textrm","\\textsf":"textsf","\\texttt":"texttt","\\textnormal":"textrm"},Ha={"\\textbf":"textbf","\\textmd":"textmd"},Wa={"\\textit":"textit","\\textup":"textup"},Ga=(e,t)=>{var n=e.font;return n?Va[n]?t.withTextFontFamily(Va[n]):Ha[n]?t.withTextFontWeight(Ha[n]):t.withTextFontShape(Wa[n]):t};Rs({type:"text",names:["\\text","\\textrm","\\textsf","\\texttt","\\textnormal","\\textbf","\\textmd","\\textit","\\textup"],props:{numArgs:1,argTypes:["text"],allowedInArgument:!0,allowedInText:!0},handler(e,t){var{parser:n,funcName:r}=e,i=t[0];return{type:"text",mode:n.mode,body:Ms(i),font:r}},htmlBuilder(e,t){var n=Ga(e,t),r=Us(e.body,n,!0);return Ss.makeSpan(["mord","text"],r,n)},mathmlBuilder(e,t){var n=Ga(e,t);return no(e.body,n)}}),Rs({type:"underline",names:["\\underline"],props:{numArgs:1,allowedInText:!0},handler(e,t){var{parser:n}=e;return{type:"underline",mode:n.mode,body:t[0]}},htmlBuilder(e,t){var n=Vs(e.body,t),r=Ss.makeLineSpan("underline-line",t),i=t.fontMetrics().defaultRuleThickness,s=Ss.makeVList({positionType:"top",positionData:n.height,children:[{type:"kern",size:i},{type:"elem",elem:r},{type:"kern",size:3*i},{type:"elem",elem:n}]},t);return Ss.makeSpan(["mord","underline"],[s],t)},mathmlBuilder(e,t){var n=new Zs.MathNode("mo",[new Zs.TextNode("")]);n.setAttribute("stretchy","true");var r=new Zs.MathNode("munder",[ro(e.body,t),n]);return r.setAttribute("accentunder","true"),r}}),Rs({type:"vcenter",names:["\\vcenter"],props:{numArgs:1,argTypes:["original"],allowedInText:!1},handler(e,t){var{parser:n}=e;return{type:"vcenter",mode:n.mode,body:t[0]}},htmlBuilder(e,t){var n=Vs(e.body,t),r=t.fontMetrics().axisHeight,i=.5*(n.height-r-(n.depth+r));return Ss.makeVList({positionType:"shift",positionData:i,children:[{type:"elem",elem:n}]},t)},mathmlBuilder:(e,t)=>new Zs.MathNode("mpadded",[ro(e.body,t)],["vcenter"])}),Rs({type:"verb",names:["\\verb"],props:{numArgs:0,allowedInText:!0},handler(e,t,n){throw new xr("\\verb ended by end of line instead of matching delimiter")},htmlBuilder(e,t){for(var n=Ya(e),r=[],i=t.havingStyle(t.style.text()),s=0;s<n.length;s++){var o=n[s];"~"===o&&(o="\\textasciitilde"),r.push(Ss.makeSymbol(o,"Typewriter-Regular",e.mode,i,["mord","texttt"]))}return Ss.makeSpan(["mord","text"].concat(i.sizingClasses(t)),Ss.tryCombineChars(r),i)},mathmlBuilder(e,t){var n=new Zs.TextNode(Ya(e)),r=new Zs.MathNode("mtext",[n]);return r.setAttribute("mathvariant","monospace"),r}});var Ya=e=>e.body.replace(/ /g,e.star?"":""),Xa=Cs,Za=new RegExp("[-]+$");class Ja{constructor(e,t){this.input=void 0,this.settings=void 0,this.tokenRegex=void 0,this.catcodes=void 0,this.input=e,this.settings=t,this.tokenRegex=new RegExp("([ \r\n\t]+)|\\\\(\n|[ \r\t]+\n?)[ \r\t]*|([!-\\[\\]---][-]*|[\ud800-\udbff][\udc00-\udfff][-]*|\\\\verb\\*([^]).*?\\4|\\\\verb([^*a-zA-Z]).*?\\5|(\\\\[a-zA-Z@]+)[ \r\n\t]*|\\\\[^\ud800-\udfff])","g"),this.catcodes={"%":14,"~":13}}setCatcode(e,t){this.catcodes[e]=t}lex(){var e=this.input,t=this.tokenRegex.lastIndex;if(t===e.length)return new kr("EOF",new _r(this,t,t));var n=this.tokenRegex.exec(e);if(null===n||n.index!==t)throw new xr("Unexpected character: '"+e[t]+"'",new kr(e[t],new _r(this,t,t+1)));var r=n[6]||n[3]||(n[2]?"\\ ":" ");if(14===this.catcodes[r]){var i=e.indexOf("\n",this.tokenRegex.lastIndex);return-1===i?(this.tokenRegex.lastIndex=e.length,this.settings.reportNonstrict("commentAtEnd","% comment has no terminating newline; LaTeX would fail because of commenting the end of math mode (e.g. $)")):this.tokenRegex.lastIndex=i+1,this.lex()}return new kr(r,new _r(this,t,this.tokenRegex.lastIndex))}}class Qa{constructor(e,t){void 0===e&&(e={}),void 0===t&&(t={}),this.current=void 0,this.builtins=void 0,this.undefStack=void 0,this.current=t,this.builtins=e,this.undefStack=[]}beginGroup(){this.undefStack.push({})}endGroup(){if(0===this.undefStack.length)throw new xr("Unbalanced namespace destruction: attempt to pop global namespace; please report this as a bug");var e=this.undefStack.pop();for(var t in e)e.hasOwnProperty(t)&&(null==e[t]?delete this.current[t]:this.current[t]=e[t])}endGroups(){for(;this.undefStack.length>0;)this.endGroup()}has(e){return this.current.hasOwnProperty(e)||this.builtins.hasOwnProperty(e)}get(e){return this.current.hasOwnProperty(e)?this.current[e]:this.builtins[e]}set(e,t,n){if(void 0===n&&(n=!1),n){for(var r=0;r<this.undefStack.length;r++)delete this.undefStack[r][e];this.undefStack.length>0&&(this.undefStack[this.undefStack.length-1][e]=t)}else{var i=this.undefStack[this.undefStack.length-1];i&&!i.hasOwnProperty(e)&&(i[e]=this.current[e])}null==t?delete this.current[e]:this.current[e]=t}}var el=ia;sa("\\noexpand",(function(e){var t=e.popToken();return e.isExpandable(t.text)&&(t.noexpand=!0,t.treatAsRelax=!0),{tokens:[t],numArgs:0}})),sa("\\expandafter",(function(e){var t=e.popToken();return e.expandOnce(!0),{tokens:[t],numArgs:0}})),sa("\\@firstoftwo",(function(e){return{tokens:e.consumeArgs(2)[0],numArgs:0}})),sa("\\@secondoftwo",(function(e){return{tokens:e.consumeArgs(2)[1],numArgs:0}})),sa("\\@ifnextchar",(function(e){var t=e.consumeArgs(3);e.consumeSpaces();var n=e.future();return 1===t[0].length&&t[0][0].text===n.text?{tokens:t[1],numArgs:0}:{tokens:t[2],numArgs:0}})),sa("\\@ifstar","\\@ifnextchar *{\\@firstoftwo{#1}}"),sa("\\TextOrMath",(function(e){var t=e.consumeArgs(2);return"text"===e.mode?{tokens:t[0],numArgs:0}:{tokens:t[1],numArgs:0}}));var tl={0:0,1:1,2:2,3:3,4:4,5:5,6:6,7:7,8:8,9:9,a:10,A:10,b:11,B:11,c:12,C:12,d:13,D:13,e:14,E:14,f:15,F:15};sa("\\char",(function(e){var t,n=e.popToken(),r="";if("'"===n.text)t=8,n=e.popToken();else if('"'===n.text)t=16,n=e.popToken();else if("`"===n.text)if("\\"===(n=e.popToken()).text[0])r=n.text.charCodeAt(1);else{if("EOF"===n.text)throw new xr("\\char` missing argument");r=n.text.charCodeAt(0)}else t=10;if(t){if(null==(r=tl[n.text])||r>=t)throw new xr("Invalid base-"+t+" digit "+n.text);for(var i;null!=(i=tl[e.future().text])&&i<t;)r*=t,r+=i,e.popToken()}return"\\@char{"+r+"}"}));var nl=(e,t,n)=>{var r=e.consumeArg().tokens;if(1!==r.length)throw new xr("\\newcommand's first argument must be a macro name");var i=r[0].text,s=e.isDefined(i);if(s&&!t)throw new xr("\\newcommand{"+i+"} attempting to redefine "+i+"; use \\renewcommand");if(!s&&!n)throw new xr("\\renewcommand{"+i+"} when command "+i+" does not yet exist; use \\newcommand");var o=0;if(1===(r=e.consumeArg().tokens).length&&"["===r[0].text){for(var a="",l=e.expandNextToken();"]"!==l.text&&"EOF"!==l.text;)a+=l.text,l=e.expandNextToken();if(!a.match(/^\s*[0-9]+\s*$/))throw new xr("Invalid number of arguments: "+a);o=parseInt(a),r=e.consumeArg().tokens}return e.macros.set(i,{tokens:r,numArgs:o}),""};sa("\\newcommand",(e=>nl(e,!1,!0))),sa("\\renewcommand",(e=>nl(e,!0,!1))),sa("\\providecommand",(e=>nl(e,!0,!0))),sa("\\message",(e=>{var t=e.consumeArgs(1)[0];return console.log(t.reverse().map((e=>e.text)).join("")),""})),sa("\\errmessage",(e=>{var t=e.consumeArgs(1)[0];return console.error(t.reverse().map((e=>e.text)).join("")),""})),sa("\\show",(e=>{var t=e.popToken(),n=t.text;return console.log(t,e.macros.get(n),Xa[n],Ai.math[n],Ai.text[n]),""})),sa("\\bgroup","{"),sa("\\egroup","}"),sa("~","\\nobreakspace"),sa("\\lq","`"),sa("\\rq","'"),sa("\\aa","\\r a"),sa("\\AA","\\r A"),sa("\\textcopyright","\\html@mathml{\\textcircled{c}}{\\char`}"),sa("\\copyright","\\TextOrMath{\\textcopyright}{\\text{\\textcopyright}}"),sa("\\textregistered","\\html@mathml{\\textcircled{\\scriptsize R}}{\\char`}"),sa("","\\mathscr{B}"),sa("","\\mathscr{E}"),sa("","\\mathscr{F}"),sa("","\\mathscr{H}"),sa("","\\mathscr{I}"),sa("","\\mathscr{L}"),sa("","\\mathscr{M}"),sa("","\\mathscr{R}"),sa("","\\mathfrak{C}"),sa("","\\mathfrak{H}"),sa("","\\mathfrak{Z}"),sa("\\Bbbk","\\Bbb{k}"),sa("","\\cdotp"),sa("\\llap","\\mathllap{\\textrm{#1}}"),sa("\\rlap","\\mathrlap{\\textrm{#1}}"),sa("\\clap","\\mathclap{\\textrm{#1}}"),sa("\\mathstrut","\\vphantom{(}"),sa("\\underbar","\\underline{\\text{#1}}"),sa("\\not",'\\html@mathml{\\mathrel{\\mathrlap\\@not}}{\\char"338}'),sa("\\neq","\\html@mathml{\\mathrel{\\not=}}{\\mathrel{\\char`}}"),sa("\\ne","\\neq"),sa("","\\neq"),sa("\\notin","\\html@mathml{\\mathrel{{\\in}\\mathllap{/\\mskip1mu}}}{\\mathrel{\\char`}}"),sa("","\\notin"),sa("","\\html@mathml{\\mathrel{=\\kern{-1em}\\raisebox{0.4em}{$\\scriptsize\\frown$}}}{\\mathrel{\\char`}}"),sa("","\\html@mathml{\\stackrel{\\tiny\\wedge}{=}}{\\mathrel{\\char`}}"),sa("","\\html@mathml{\\stackrel{\\tiny\\vee}{=}}{\\mathrel{\\char`}}"),sa("","\\html@mathml{\\stackrel{\\scriptsize\\star}{=}}{\\mathrel{\\char`}}"),sa("","\\html@mathml{\\stackrel{\\tiny\\mathrm{def}}{=}}{\\mathrel{\\char`}}"),sa("","\\html@mathml{\\stackrel{\\tiny\\mathrm{m}}{=}}{\\mathrel{\\char`}}"),sa("","\\html@mathml{\\stackrel{\\tiny?}{=}}{\\mathrel{\\char`}}"),sa("","\\perp"),sa("","\\mathclose{!\\mkern-0.8mu!}"),sa("","\\notni"),sa("","\\ulcorner"),sa("","\\urcorner"),sa("","\\llcorner"),sa("","\\lrcorner"),sa("","\\copyright"),sa("","\\textregistered"),sa("","\\textregistered"),sa("\\ulcorner",'\\html@mathml{\\@ulcorner}{\\mathop{\\char"231c}}'),sa("\\urcorner",'\\html@mathml{\\@urcorner}{\\mathop{\\char"231d}}'),sa("\\llcorner",'\\html@mathml{\\@llcorner}{\\mathop{\\char"231e}}'),sa("\\lrcorner",'\\html@mathml{\\@lrcorner}{\\mathop{\\char"231f}}'),sa("\\vdots","\\mathord{\\varvdots\\rule{0pt}{15pt}}"),sa("","\\vdots"),sa("\\varGamma","\\mathit{\\Gamma}"),sa("\\varDelta","\\mathit{\\Delta}"),sa("\\varTheta","\\mathit{\\Theta}"),sa("\\varLambda","\\mathit{\\Lambda}"),sa("\\varXi","\\mathit{\\Xi}"),sa("\\varPi","\\mathit{\\Pi}"),sa("\\varSigma","\\mathit{\\Sigma}"),sa("\\varUpsilon","\\mathit{\\Upsilon}"),sa("\\varPhi","\\mathit{\\Phi}"),sa("\\varPsi","\\mathit{\\Psi}"),sa("\\varOmega","\\mathit{\\Omega}"),sa("\\substack","\\begin{subarray}{c}#1\\end{subarray}"),sa("\\colon","\\nobreak\\mskip2mu\\mathpunct{}\\mathchoice{\\mkern-3mu}{\\mkern-3mu}{}{}{:}\\mskip6mu\\relax"),sa("\\boxed","\\fbox{$\\displaystyle{#1}$}"),sa("\\iff","\\DOTSB\\;\\Longleftrightarrow\\;"),sa("\\implies","\\DOTSB\\;\\Longrightarrow\\;"),sa("\\impliedby","\\DOTSB\\;\\Longleftarrow\\;");var rl={",":"\\dotsc","\\not":"\\dotsb","+":"\\dotsb","=":"\\dotsb","<":"\\dotsb",">":"\\dotsb","-":"\\dotsb","*":"\\dotsb",":":"\\dotsb","\\DOTSB":"\\dotsb","\\coprod":"\\dotsb","\\bigvee":"\\dotsb","\\bigwedge":"\\dotsb","\\biguplus":"\\dotsb","\\bigcap":"\\dotsb","\\bigcup":"\\dotsb","\\prod":"\\dotsb","\\sum":"\\dotsb","\\bigotimes":"\\dotsb","\\bigoplus":"\\dotsb","\\bigodot":"\\dotsb","\\bigsqcup":"\\dotsb","\\And":"\\dotsb","\\longrightarrow":"\\dotsb","\\Longrightarrow":"\\dotsb","\\longleftarrow":"\\dotsb","\\Longleftarrow":"\\dotsb","\\longleftrightarrow":"\\dotsb","\\Longleftrightarrow":"\\dotsb","\\mapsto":"\\dotsb","\\longmapsto":"\\dotsb","\\hookrightarrow":"\\dotsb","\\doteq":"\\dotsb","\\mathbin":"\\dotsb","\\mathrel":"\\dotsb","\\relbar":"\\dotsb","\\Relbar":"\\dotsb","\\xrightarrow":"\\dotsb","\\xleftarrow":"\\dotsb","\\DOTSI":"\\dotsi","\\int":"\\dotsi","\\oint":"\\dotsi","\\iint":"\\dotsi","\\iiint":"\\dotsi","\\iiiint":"\\dotsi","\\idotsint":"\\dotsi","\\DOTSX":"\\dotsx"};sa("\\dots",(function(e){var t="\\dotso",n=e.expandAfterFuture().text;return n in rl?t=rl[n]:("\\not"===n.substr(0,4)||n in Ai.math&&Ir(["bin","rel"],Ai.math[n].group))&&(t="\\dotsb"),t}));var il={")":!0,"]":!0,"\\rbrack":!0,"\\}":!0,"\\rbrace":!0,"\\rangle":!0,"\\rceil":!0,"\\rfloor":!0,"\\rgroup":!0,"\\rmoustache":!0,"\\right":!0,"\\bigr":!0,"\\biggr":!0,"\\Bigr":!0,"\\Biggr":!0,$:!0,";":!0,".":!0,",":!0};sa("\\dotso",(function(e){return e.future().text in il?"\\ldots\\,":"\\ldots"})),sa("\\dotsc",(function(e){var t=e.future().text;return t in il&&","!==t?"\\ldots\\,":"\\ldots"})),sa("\\cdots",(function(e){return e.future().text in il?"\\@cdots\\,":"\\@cdots"})),sa("\\dotsb","\\cdots"),sa("\\dotsm","\\cdots"),sa("\\dotsi","\\!\\cdots"),sa("\\dotsx","\\ldots\\,"),sa("\\DOTSI","\\relax"),sa("\\DOTSB","\\relax"),sa("\\DOTSX","\\relax"),sa("\\tmspace","\\TextOrMath{\\kern#1#3}{\\mskip#1#2}\\relax"),sa("\\,","\\tmspace+{3mu}{.1667em}"),sa("\\thinspace","\\,"),sa("\\>","\\mskip{4mu}"),sa("\\:","\\tmspace+{4mu}{.2222em}"),sa("\\medspace","\\:"),sa("\\;","\\tmspace+{5mu}{.2777em}"),sa("\\thickspace","\\;"),sa("\\!","\\tmspace-{3mu}{.1667em}"),sa("\\negthinspace","\\!"),sa("\\negmedspace","\\tmspace-{4mu}{.2222em}"),sa("\\negthickspace","\\tmspace-{5mu}{.277em}"),sa("\\enspace","\\kern.5em "),sa("\\enskip","\\hskip.5em\\relax"),sa("\\quad","\\hskip1em\\relax"),sa("\\qquad","\\hskip2em\\relax"),sa("\\tag","\\@ifstar\\tag@literal\\tag@paren"),sa("\\tag@paren","\\tag@literal{({#1})}"),sa("\\tag@literal",(e=>{if(e.macros.get("\\df@tag"))throw new xr("Multiple \\tag");return"\\gdef\\df@tag{\\text{#1}}"})),sa("\\bmod","\\mathchoice{\\mskip1mu}{\\mskip1mu}{\\mskip5mu}{\\mskip5mu}\\mathbin{\\rm mod}\\mathchoice{\\mskip1mu}{\\mskip1mu}{\\mskip5mu}{\\mskip5mu}"),sa("\\pod","\\allowbreak\\mathchoice{\\mkern18mu}{\\mkern8mu}{\\mkern8mu}{\\mkern8mu}(#1)"),sa("\\pmod","\\pod{{\\rm mod}\\mkern6mu#1}"),sa("\\mod","\\allowbreak\\mathchoice{\\mkern18mu}{\\mkern12mu}{\\mkern12mu}{\\mkern12mu}{\\rm mod}\\,\\,#1"),sa("\\pmb","\\html@mathml{\\@binrel{#1}{\\mathrlap{#1}\\kern0.5px#1}}{\\mathbf{#1}}"),sa("\\newline","\\\\\\relax"),sa("\\TeX","\\textrm{\\html@mathml{T\\kern-.1667em\\raisebox{-.5ex}{E}\\kern-.125emX}{TeX}}");var sl=hi(Qr["Main-Regular"]["T".charCodeAt(0)][1]-.7*Qr["Main-Regular"]["A".charCodeAt(0)][1]);sa("\\LaTeX","\\textrm{\\html@mathml{L\\kern-.36em\\raisebox{"+sl+"}{\\scriptstyle A}\\kern-.15em\\TeX}{LaTeX}}"),sa("\\KaTeX","\\textrm{\\html@mathml{K\\kern-.17em\\raisebox{"+sl+"}{\\scriptstyle A}\\kern-.15em\\TeX}{KaTeX}}"),sa("\\hspace","\\@ifstar\\@hspacer\\@hspace"),sa("\\@hspace","\\hskip #1\\relax"),sa("\\@hspacer","\\rule{0pt}{0pt}\\hskip #1\\relax"),sa("\\ordinarycolon",":"),sa("\\vcentcolon","\\mathrel{\\mathop\\ordinarycolon}"),sa("\\dblcolon",'\\html@mathml{\\mathrel{\\vcentcolon\\mathrel{\\mkern-.9mu}\\vcentcolon}}{\\mathop{\\char"2237}}'),sa("\\coloneqq",'\\html@mathml{\\mathrel{\\vcentcolon\\mathrel{\\mkern-1.2mu}=}}{\\mathop{\\char"2254}}'),sa("\\Coloneqq",'\\html@mathml{\\mathrel{\\dblcolon\\mathrel{\\mkern-1.2mu}=}}{\\mathop{\\char"2237\\char"3d}}'),sa("\\coloneq",'\\html@mathml{\\mathrel{\\vcentcolon\\mathrel{\\mkern-1.2mu}\\mathrel{-}}}{\\mathop{\\char"3a\\char"2212}}'),sa("\\Coloneq",'\\html@mathml{\\mathrel{\\dblcolon\\mathrel{\\mkern-1.2mu}\\mathrel{-}}}{\\mathop{\\char"2237\\char"2212}}'),sa("\\eqqcolon",'\\html@mathml{\\mathrel{=\\mathrel{\\mkern-1.2mu}\\vcentcolon}}{\\mathop{\\char"2255}}'),sa("\\Eqqcolon",'\\html@mathml{\\mathrel{=\\mathrel{\\mkern-1.2mu}\\dblcolon}}{\\mathop{\\char"3d\\char"2237}}'),sa("\\eqcolon",'\\html@mathml{\\mathrel{\\mathrel{-}\\mathrel{\\mkern-1.2mu}\\vcentcolon}}{\\mathop{\\char"2239}}'),sa("\\Eqcolon",'\\html@mathml{\\mathrel{\\mathrel{-}\\mathrel{\\mkern-1.2mu}\\dblcolon}}{\\mathop{\\char"2212\\char"2237}}'),sa("\\colonapprox",'\\html@mathml{\\mathrel{\\vcentcolon\\mathrel{\\mkern-1.2mu}\\approx}}{\\mathop{\\char"3a\\char"2248}}'),sa("\\Colonapprox",'\\html@mathml{\\mathrel{\\dblcolon\\mathrel{\\mkern-1.2mu}\\approx}}{\\mathop{\\char"2237\\char"2248}}'),sa("\\colonsim",'\\html@mathml{\\mathrel{\\vcentcolon\\mathrel{\\mkern-1.2mu}\\sim}}{\\mathop{\\char"3a\\char"223c}}'),sa("\\Colonsim",'\\html@mathml{\\mathrel{\\dblcolon\\mathrel{\\mkern-1.2mu}\\sim}}{\\mathop{\\char"2237\\char"223c}}'),sa("","\\dblcolon"),sa("","\\eqcolon"),sa("","\\coloneqq"),sa("","\\eqqcolon"),sa("","\\Coloneqq"),sa("\\ratio","\\vcentcolon"),sa("\\coloncolon","\\dblcolon"),sa("\\colonequals","\\coloneqq"),sa("\\coloncolonequals","\\Coloneqq"),sa("\\equalscolon","\\eqqcolon"),sa("\\equalscoloncolon","\\Eqqcolon"),sa("\\colonminus","\\coloneq"),sa("\\coloncolonminus","\\Coloneq"),sa("\\minuscolon","\\eqcolon"),sa("\\minuscoloncolon","\\Eqcolon"),sa("\\coloncolonapprox","\\Colonapprox"),sa("\\coloncolonsim","\\Colonsim"),sa("\\simcolon","\\mathrel{\\sim\\mathrel{\\mkern-1.2mu}\\vcentcolon}"),sa("\\simcoloncolon","\\mathrel{\\sim\\mathrel{\\mkern-1.2mu}\\dblcolon}"),sa("\\approxcolon","\\mathrel{\\approx\\mathrel{\\mkern-1.2mu}\\vcentcolon}"),sa("\\approxcoloncolon","\\mathrel{\\approx\\mathrel{\\mkern-1.2mu}\\dblcolon}"),sa("\\notni","\\html@mathml{\\not\\ni}{\\mathrel{\\char`}}"),sa("\\limsup","\\DOTSB\\operatorname*{lim\\,sup}"),sa("\\liminf","\\DOTSB\\operatorname*{lim\\,inf}"),sa("\\injlim","\\DOTSB\\operatorname*{inj\\,lim}"),sa("\\projlim","\\DOTSB\\operatorname*{proj\\,lim}"),sa("\\varlimsup","\\DOTSB\\operatorname*{\\overline{lim}}"),sa("\\varliminf","\\DOTSB\\operatorname*{\\underline{lim}}"),sa("\\varinjlim","\\DOTSB\\operatorname*{\\underrightarrow{lim}}"),sa("\\varprojlim","\\DOTSB\\operatorname*{\\underleftarrow{lim}}"),sa("\\gvertneqq","\\html@mathml{\\@gvertneqq}{}"),sa("\\lvertneqq","\\html@mathml{\\@lvertneqq}{}"),sa("\\ngeqq","\\html@mathml{\\@ngeqq}{}"),sa("\\ngeqslant","\\html@mathml{\\@ngeqslant}{}"),sa("\\nleqq","\\html@mathml{\\@nleqq}{}"),sa("\\nleqslant","\\html@mathml{\\@nleqslant}{}"),sa("\\nshortmid","\\html@mathml{\\@nshortmid}{}"),sa("\\nshortparallel","\\html@mathml{\\@nshortparallel}{}"),sa("\\nsubseteqq","\\html@mathml{\\@nsubseteqq}{}"),sa("\\nsupseteqq","\\html@mathml{\\@nsupseteqq}{}"),sa("\\varsubsetneq","\\html@mathml{\\@varsubsetneq}{}"),sa("\\varsubsetneqq","\\html@mathml{\\@varsubsetneqq}{}"),sa("\\varsupsetneq","\\html@mathml{\\@varsupsetneq}{}"),sa("\\varsupsetneqq","\\html@mathml{\\@varsupsetneqq}{}"),sa("\\imath","\\html@mathml{\\@imath}{}"),sa("\\jmath","\\html@mathml{\\@jmath}{}"),sa("\\llbracket","\\html@mathml{\\mathopen{[\\mkern-3.2mu[}}{\\mathopen{\\char`}}"),sa("\\rrbracket","\\html@mathml{\\mathclose{]\\mkern-3.2mu]}}{\\mathclose{\\char`}}"),sa("","\\llbracket"),sa("","\\rrbracket"),sa("\\lBrace","\\html@mathml{\\mathopen{\\{\\mkern-3.2mu[}}{\\mathopen{\\char`}}"),sa("\\rBrace","\\html@mathml{\\mathclose{]\\mkern-3.2mu\\}}}{\\mathclose{\\char`}}"),sa("","\\lBrace"),sa("","\\rBrace"),sa("\\minuso","\\mathbin{\\html@mathml{{\\mathrlap{\\mathchoice{\\kern{0.145em}}{\\kern{0.145em}}{\\kern{0.1015em}}{\\kern{0.0725em}}\\circ}{-}}}{\\char`}}"),sa("","\\minuso"),sa("\\darr","\\downarrow"),sa("\\dArr","\\Downarrow"),sa("\\Darr","\\Downarrow"),sa("\\lang","\\langle"),sa("\\rang","\\rangle"),sa("\\uarr","\\uparrow"),sa("\\uArr","\\Uparrow"),sa("\\Uarr","\\Uparrow"),sa("\\N","\\mathbb{N}"),sa("\\R","\\mathbb{R}"),sa("\\Z","\\mathbb{Z}"),sa("\\alef","\\aleph"),sa("\\alefsym","\\aleph"),sa("\\Alpha","\\mathrm{A}"),sa("\\Beta","\\mathrm{B}"),sa("\\bull","\\bullet"),sa("\\Chi","\\mathrm{X}"),sa("\\clubs","\\clubsuit"),sa("\\cnums","\\mathbb{C}"),sa("\\Complex","\\mathbb{C}"),sa("\\Dagger","\\ddagger"),sa("\\diamonds","\\diamondsuit"),sa("\\empty","\\emptyset"),sa("\\Epsilon","\\mathrm{E}"),sa("\\Eta","\\mathrm{H}"),sa("\\exist","\\exists"),sa("\\harr","\\leftrightarrow"),sa("\\hArr","\\Leftrightarrow"),sa("\\Harr","\\Leftrightarrow"),sa("\\hearts","\\heartsuit"),sa("\\image","\\Im"),sa("\\infin","\\infty"),sa("\\Iota","\\mathrm{I}"),sa("\\isin","\\in"),sa("\\Kappa","\\mathrm{K}"),sa("\\larr","\\leftarrow"),sa("\\lArr","\\Leftarrow"),sa("\\Larr","\\Leftarrow"),sa("\\lrarr","\\leftrightarrow"),sa("\\lrArr","\\Leftrightarrow"),sa("\\Lrarr","\\Leftrightarrow"),sa("\\Mu","\\mathrm{M}"),sa("\\natnums","\\mathbb{N}"),sa("\\Nu","\\mathrm{N}"),sa("\\Omicron","\\mathrm{O}"),sa("\\plusmn","\\pm"),sa("\\rarr","\\rightarrow"),sa("\\rArr","\\Rightarrow"),sa("\\Rarr","\\Rightarrow"),sa("\\real","\\Re"),sa("\\reals","\\mathbb{R}"),sa("\\Reals","\\mathbb{R}"),sa("\\Rho","\\mathrm{P}"),sa("\\sdot","\\cdot"),sa("\\sect","\\S"),sa("\\spades","\\spadesuit"),sa("\\sub","\\subset"),sa("\\sube","\\subseteq"),sa("\\supe","\\supseteq"),sa("\\Tau","\\mathrm{T}"),sa("\\thetasym","\\vartheta"),sa("\\weierp","\\wp"),sa("\\Zeta","\\mathrm{Z}"),sa("\\argmin","\\DOTSB\\operatorname*{arg\\,min}"),sa("\\argmax","\\DOTSB\\operatorname*{arg\\,max}"),sa("\\plim","\\DOTSB\\mathop{\\operatorname{plim}}\\limits"),sa("\\bra","\\mathinner{\\langle{#1}|}"),sa("\\ket","\\mathinner{|{#1}\\rangle}"),sa("\\braket","\\mathinner{\\langle{#1}\\rangle}"),sa("\\Bra","\\left\\langle#1\\right|"),sa("\\Ket","\\left|#1\\right\\rangle"),sa("\\angln","{\\angl n}"),sa("\\blue","\\textcolor{##6495ed}{#1}"),sa("\\orange","\\textcolor{##ffa500}{#1}"),sa("\\pink","\\textcolor{##ff00af}{#1}"),sa("\\red","\\textcolor{##df0030}{#1}"),sa("\\green","\\textcolor{##28ae7b}{#1}"),sa("\\gray","\\textcolor{gray}{#1}"),sa("\\purple","\\textcolor{##9d38bd}{#1}"),sa("\\blueA","\\textcolor{##ccfaff}{#1}"),sa("\\blueB","\\textcolor{##80f6ff}{#1}"),sa("\\blueC","\\textcolor{##63d9ea}{#1}"),sa("\\blueD","\\textcolor{##11accd}{#1}"),sa("\\blueE","\\textcolor{##0c7f99}{#1}"),sa("\\tealA","\\textcolor{##94fff5}{#1}"),sa("\\tealB","\\textcolor{##26edd5}{#1}"),sa("\\tealC","\\textcolor{##01d1c1}{#1}"),sa("\\tealD","\\textcolor{##01a995}{#1}"),sa("\\tealE","\\textcolor{##208170}{#1}"),sa("\\greenA","\\textcolor{##b6ffb0}{#1}"),sa("\\greenB","\\textcolor{##8af281}{#1}"),sa("\\greenC","\\textcolor{##74cf70}{#1}"),sa("\\greenD","\\textcolor{##1fab54}{#1}"),sa("\\greenE","\\textcolor{##0d923f}{#1}"),sa("\\goldA","\\textcolor{##ffd0a9}{#1}"),sa("\\goldB","\\textcolor{##ffbb71}{#1}"),sa("\\goldC","\\textcolor{##ff9c39}{#1}"),sa("\\goldD","\\textcolor{##e07d10}{#1}"),sa("\\goldE","\\textcolor{##a75a05}{#1}"),sa("\\redA","\\textcolor{##fca9a9}{#1}"),sa("\\redB","\\textcolor{##ff8482}{#1}"),sa("\\redC","\\textcolor{##f9685d}{#1}"),sa("\\redD","\\textcolor{##e84d39}{#1}"),sa("\\redE","\\textcolor{##bc2612}{#1}"),sa("\\maroonA","\\textcolor{##ffbde0}{#1}"),sa("\\maroonB","\\textcolor{##ff92c6}{#1}"),sa("\\maroonC","\\textcolor{##ed5fa6}{#1}"),sa("\\maroonD","\\textcolor{##ca337c}{#1}"),sa("\\maroonE","\\textcolor{##9e034e}{#1}"),sa("\\purpleA","\\textcolor{##ddd7ff}{#1}"),sa("\\purpleB","\\textcolor{##c6b9fc}{#1}"),sa("\\purpleC","\\textcolor{##aa87ff}{#1}"),sa("\\purpleD","\\textcolor{##7854ab}{#1}"),sa("\\purpleE","\\textcolor{##543b78}{#1}"),sa("\\mintA","\\textcolor{##f5f9e8}{#1}"),sa("\\mintB","\\textcolor{##edf2df}{#1}"),sa("\\mintC","\\textcolor{##e0e5cc}{#1}"),sa("\\grayA","\\textcolor{##f6f7f7}{#1}"),sa("\\grayB","\\textcolor{##f0f1f2}{#1}"),sa("\\grayC","\\textcolor{##e3e5e6}{#1}"),sa("\\grayD","\\textcolor{##d6d8da}{#1}"),sa("\\grayE","\\textcolor{##babec2}{#1}"),sa("\\grayF","\\textcolor{##888d93}{#1}"),sa("\\grayG","\\textcolor{##626569}{#1}"),sa("\\grayH","\\textcolor{##3b3e40}{#1}"),sa("\\grayI","\\textcolor{##21242c}{#1}"),sa("\\kaBlue","\\textcolor{##314453}{#1}"),sa("\\kaGreen","\\textcolor{##71B307}{#1}");var ol={"^":!0,_:!0,"\\limits":!0,"\\nolimits":!0};class al{constructor(e,t,n){this.settings=void 0,this.expansionCount=void 0,this.lexer=void 0,this.macros=void 0,this.stack=void 0,this.mode=void 0,this.settings=t,this.expansionCount=0,this.feed(e),this.macros=new Qa(el,t.macros),this.mode=n,this.stack=[]}feed(e){this.lexer=new Ja(e,this.settings)}switchMode(e){this.mode=e}beginGroup(){this.macros.beginGroup()}endGroup(){this.macros.endGroup()}endGroups(){this.macros.endGroups()}future(){return 0===this.stack.length&&this.pushToken(this.lexer.lex()),this.stack[this.stack.length-1]}popToken(){return this.future(),this.stack.pop()}pushToken(e){this.stack.push(e)}pushTokens(e){this.stack.push(...e)}scanArgument(e){var t,n,r;if(e){if(this.consumeSpaces(),"["!==this.future().text)return null;t=this.popToken(),({tokens:r,end:n}=this.consumeArg(["]"]))}else({tokens:r,start:t,end:n}=this.consumeArg());return this.pushToken(new kr("EOF",n.loc)),this.pushTokens(r),t.range(n,"")}consumeSpaces(){for(;" "===this.future().text;)this.stack.pop()}consumeArg(e){var t=[],n=e&&e.length>0;n||this.consumeSpaces();var r,i=this.future(),s=0,o=0;do{if(r=this.popToken(),t.push(r),"{"===r.text)++s;else if("}"===r.text){if(-1==--s)throw new xr("Extra }",r)}else if("EOF"===r.text)throw new xr("Unexpected end of input in a macro argument, expected '"+(e&&n?e[o]:"}")+"'",r);if(e&&n)if((0===s||1===s&&"{"===e[o])&&r.text===e[o]){if(++o===e.length){t.splice(-o,o);break}}else o=0}while(0!==s||n);return"{"===i.text&&"}"===t[t.length-1].text&&(t.pop(),t.shift()),t.reverse(),{tokens:t,start:i,end:r}}consumeArgs(e,t){if(t){if(t.length!==e+1)throw new xr("The length of delimiters doesn't match the number of args!");for(var n=t[0],r=0;r<n.length;r++){var i=this.popToken();if(n[r]!==i.text)throw new xr("Use of the macro doesn't match its definition",i)}}for(var s=[],o=0;o<e;o++)s.push(this.consumeArg(t&&t[o+1]).tokens);return s}expandOnce(e){var t=this.popToken(),n=t.text,r=t.noexpand?null:this._getExpansion(n);if(null==r||e&&r.unexpandable){if(e&&null==r&&"\\"===n[0]&&!this.isDefined(n))throw new xr("Undefined control sequence: "+n);return this.pushToken(t),t}if(this.expansionCount++,this.expansionCount>this.settings.maxExpand)throw new xr("Too many expansions: infinite loop or need to increase maxExpand setting");var i=r.tokens,s=this.consumeArgs(r.numArgs,r.delimiters);if(r.numArgs)for(var o=(i=i.slice()).length-1;o>=0;--o){var a=i[o];if("#"===a.text){if(0===o)throw new xr("Incomplete placeholder at end of macro body",a);if("#"===(a=i[--o]).text)i.splice(o+1,1);else{if(!/^[1-9]$/.test(a.text))throw new xr("Not a valid argument number",a);i.splice(o,2,...s[+a.text-1])}}}return this.pushTokens(i),i}expandAfterFuture(){return this.expandOnce(),this.future()}expandNextToken(){for(;;){var e=this.expandOnce();if(e instanceof kr)return e.treatAsRelax&&(e.text="\\relax"),this.stack.pop()}throw new Error}expandMacro(e){return this.macros.has(e)?this.expandTokens([new kr(e)]):void 0}expandTokens(e){var t=[],n=this.stack.length;for(this.pushTokens(e);this.stack.length>n;){var r=this.expandOnce(!0);r instanceof kr&&(r.treatAsRelax&&(r.noexpand=!1,r.treatAsRelax=!1),t.push(this.stack.pop()))}return t}expandMacroAsText(e){var t=this.expandMacro(e);return t?t.map((e=>e.text)).join(""):t}_getExpansion(e){var t=this.macros.get(e);if(null==t)return t;if(1===e.length){var n=this.lexer.catcodes[e];if(null!=n&&13!==n)return}var r="function"==typeof t?t(this):t;if("string"==typeof r){var i=0;if(-1!==r.indexOf("#"))for(var s=r.replace(/##/g,"");-1!==s.indexOf("#"+(i+1));)++i;for(var o=new Ja(r,this.settings),a=[],l=o.lex();"EOF"!==l.text;)a.push(l),l=o.lex();return a.reverse(),{tokens:a,numArgs:i}}return r}isDefined(e){return this.macros.has(e)||Xa.hasOwnProperty(e)||Ai.math.hasOwnProperty(e)||Ai.text.hasOwnProperty(e)||ol.hasOwnProperty(e)}isExpandable(e){var t=this.macros.get(e);return null!=t?"string"==typeof t||"function"==typeof t||!t.unexpandable:Xa.hasOwnProperty(e)&&!Xa[e].primitive}}var ll={"":{text:"\\'",math:"\\acute"},"":{text:"\\`",math:"\\grave"},"":{text:'\\"',math:"\\ddot"},"":{text:"\\~",math:"\\tilde"},"":{text:"\\=",math:"\\bar"},"":{text:"\\u",math:"\\breve"},"":{text:"\\v",math:"\\check"},"":{text:"\\^",math:"\\hat"},"":{text:"\\.",math:"\\dot"},"":{text:"\\r",math:"\\mathring"},"":{text:"\\H"},"":{text:"\\c"}},cl={:"a",:"a",:"a",:"a",:"a",:"a",:"a",:"a",:"a",:"a",:"a",:"a",:"a",:"a",:"a",:"a",:"a",:"a",:"a",:"b",:"c",:"c",:"c",:"c",:"c",:"c",:"d",:"d",:"d",:"e",:"e",:"e",:"e",:"e",:"e",:"e",:"e",:"e",:"e",:"e",:"e",:"e",:"e",:"e",:"e",:"f",:"g",:"g",:"g",:"g",:"g",:"g",:"g",:"h",:"h",:"h",:"h",:"h",:"i",:"i",:"i",:"i",:"i",:"i",:"i",:"i",:"i",:"j",:"j",:"k",:"k",:"k",:"l",:"l",:"l",:"m",:"m",:"n",:"n",:"n",:"n",:"n",:"n",:"o",:"o",:"o",:"o",:"o",:"o",:"o",:"o",:"o",:"o",:"o",:"o",:"o",:"o",:"o",:"o",:"o",:"o",:"o",:"o",:"p",:"p",:"r",:"r",:"r",:"r",:"s",:"s",:"s",:"s",:"s",:"s",:"s",:"t",:"t",:"t",:"t",:"u",:"u",:"u",:"u",:"u",:"u",:"u",:"u",:"u",:"u",:"u",:"u",:"u",:"u",:"u",:"u",:"v",:"w",:"w",:"w",:"w",:"w",:"w",:"x",:"x",:"y",:"y",:"y",:"y",:"y",:"y",:"y",:"y",:"z",:"z",:"z",:"z",:"A",:"A",:"A",:"A",:"A",:"A",:"A",:"A",:"A",:"A",:"A",:"A",:"A",:"A",:"A",:"A",:"A",:"A",:"A",:"B",:"C",:"C",:"C",:"C",:"C",:"C",:"D",:"D",:"D",:"E",:"E",:"E",:"E",:"E",:"E",:"E",:"E",:"E",:"E",:"E",:"E",:"E",:"E",:"E",:"E",:"F",:"G",:"G",:"G",:"G",:"G",:"G",:"G",:"H",:"H",:"H",:"H",:"H",:"I",:"I",:"I",:"I",:"I",:"I",:"I",:"I",:"I",:"I",:"J",:"K",:"K",:"K",:"L",:"L",:"L",:"M",:"M",:"N",:"N",:"N",:"N",:"N",:"N",:"O",:"O",:"O",:"O",:"O",:"O",:"O",:"O",:"O",:"O",:"O",:"O",:"O",:"O",:"O",:"O",:"O",:"O",:"O",:"O",:"P",:"P",:"R",:"R",:"R",:"R",:"S",:"S",:"S",:"S",:"S",:"S",:"S",:"T",:"T",:"T",:"U",:"U",:"U",:"U",:"U",:"U",:"U",:"U",:"U",:"U",:"U",:"U",:"U",:"U",:"U",:"U",:"V",:"W",:"W",:"W",:"W",:"W",:"X",:"X",:"Y",:"Y",:"Y",:"Y",:"Y",:"Y",:"Y",:"Z",:"Z",:"Z",:"Z",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:""};class dl{constructor(e,t){this.mode=void 0,this.gullet=void 0,this.settings=void 0,this.leftrightDepth=void 0,this.nextToken=void 0,this.mode="math",this.gullet=new al(e,t,this.mode),this.settings=t,this.leftrightDepth=0}expect(e,t){if(void 0===t&&(t=!0),this.fetch().text!==e)throw new xr("Expected '"+e+"', got '"+this.fetch().text+"'",this.fetch());t&&this.consume()}consume(){this.nextToken=null}fetch(){return null==this.nextToken&&(this.nextToken=this.gullet.expandNextToken()),this.nextToken}switchMode(e){this.mode=e,this.gullet.switchMode(e)}parse(){this.settings.globalGroup||this.gullet.beginGroup(),this.settings.colorIsTextColor&&this.gullet.macros.set("\\color","\\textcolor");try{var e=this.parseExpression(!1);return this.expect("EOF"),this.settings.globalGroup||this.gullet.endGroup(),e}finally{this.gullet.endGroups()}}subparse(e){var t=this.nextToken;this.consume(),this.gullet.pushToken(new kr("}")),this.gullet.pushTokens(e);var n=this.parseExpression(!1);return this.expect("}"),this.nextToken=t,n}parseExpression(e,t){for(var n=[];;){"math"===this.mode&&this.consumeSpaces();var r=this.fetch();if(-1!==dl.endOfExpression.indexOf(r.text))break;if(t&&r.text===t)break;if(e&&Xa[r.text]&&Xa[r.text].infix)break;var i=this.parseAtom(t);if(!i)break;"internal"!==i.type&&n.push(i)}return"text"===this.mode&&this.formLigatures(n),this.handleInfixNodes(n)}handleInfixNodes(e){for(var t,n=-1,r=0;r<e.length;r++)if("infix"===e[r].type){if(-1!==n)throw new xr("only one infix operator per group",e[r].token);n=r,t=e[r].replaceWith}if(-1!==n&&t){var i,s,o=e.slice(0,n),a=e.slice(n+1);return i=1===o.length&&"ordgroup"===o[0].type?o[0]:{type:"ordgroup",mode:this.mode,body:o},s=1===a.length&&"ordgroup"===a[0].type?a[0]:{type:"ordgroup",mode:this.mode,body:a},["\\\\abovefrac"===t?this.callFunction(t,[i,e[n],s],[]):this.callFunction(t,[i,s],[])]}return e}handleSupSubscript(e){var t=this.fetch(),n=t.text;this.consume(),this.consumeSpaces();var r=this.parseGroup(e);if(!r)throw new xr("Expected group after '"+n+"'",t);return r}formatUnsupportedCmd(e){for(var t=[],n=0;n<e.length;n++)t.push({type:"textord",mode:"text",text:e[n]});var r={type:"text",mode:this.mode,body:t};return{type:"color",mode:this.mode,color:this.settings.errorColor,body:[r]}}parseAtom(e){var t,n,r=this.parseGroup("atom",e);if("text"===this.mode)return r;for(;;){this.consumeSpaces();var i=this.fetch();if("\\limits"===i.text||"\\nolimits"===i.text){if(r&&"op"===r.type){var s="\\limits"===i.text;r.limits=s,r.alwaysHandleSupSub=!0}else{if(!r||"operatorname"!==r.type)throw new xr("Limit controls must follow a math operator",i);r.alwaysHandleSupSub&&(r.limits="\\limits"===i.text)}this.consume()}else if("^"===i.text){if(t)throw new xr("Double superscript",i);t=this.handleSupSubscript("superscript")}else if("_"===i.text){if(n)throw new xr("Double subscript",i);n=this.handleSupSubscript("subscript")}else{if("'"!==i.text)break;if(t)throw new xr("Double superscript",i);var o={type:"textord",mode:this.mode,text:"\\prime"},a=[o];for(this.consume();"'"===this.fetch().text;)a.push(o),this.consume();"^"===this.fetch().text&&a.push(this.handleSupSubscript("superscript")),t={type:"ordgroup",mode:this.mode,body:a}}}return t||n?{type:"supsub",mode:this.mode,base:r,sup:t,sub:n}:r}parseFunction(e,t){var n=this.fetch(),r=n.text,i=Xa[r];if(!i)return null;if(this.consume(),t&&"atom"!==t&&!i.allowedInArgument)throw new xr("Got function '"+r+"' with no arguments"+(t?" as "+t:""),n);if("text"===this.mode&&!i.allowedInText)throw new xr("Can't use function '"+r+"' in text mode",n);if("math"===this.mode&&!1===i.allowedInMath)throw new xr("Can't use function '"+r+"' in math mode",n);var{args:s,optArgs:o}=this.parseArguments(r,i);return this.callFunction(r,s,o,n,e)}callFunction(e,t,n,r,i){var s={funcName:e,parser:this,token:r,breakOnTokenText:i},o=Xa[e];if(o&&o.handler)return o.handler(s,t,n);throw new xr("No function handler for "+e)}parseArguments(e,t){var n=t.numArgs+t.numOptionalArgs;if(0===n)return{args:[],optArgs:[]};for(var r=[],i=[],s=0;s<n;s++){var o=t.argTypes&&t.argTypes[s],a=s<t.numOptionalArgs;(t.primitive&&null==o||"sqrt"===t.type&&1===s&&null==i[0])&&(o="primitive");var l=this.parseGroupOfType("argument to '"+e+"'",o,a);if(a)i.push(l);else{if(null==l)throw new xr("Null argument, please report this as a bug");r.push(l)}}return{args:r,optArgs:i}}parseGroupOfType(e,t,n){switch(t){case"color":return this.parseColorGroup(n);case"size":return this.parseSizeGroup(n);case"url":return this.parseUrlGroup(n);case"math":case"text":return this.parseArgumentGroup(n,t);case"hbox":var r=this.parseArgumentGroup(n,"text");return null!=r?{type:"styling",mode:r.mode,body:[r],style:"text"}:null;case"raw":var i=this.parseStringGroup("raw",n);return null!=i?{type:"raw",mode:"text",string:i.text}:null;case"primitive":if(n)throw new xr("A primitive argument cannot be optional");var s=this.parseGroup(e);if(null==s)throw new xr("Expected group as "+e,this.fetch());return s;case"original":case null:case void 0:return this.parseArgumentGroup(n);default:throw new xr("Unknown group type as "+e,this.fetch())}}consumeSpaces(){for(;" "===this.fetch().text;)this.consume()}parseStringGroup(e,t){var n=this.gullet.scanArgument(t);if(null==n)return null;for(var r,i="";"EOF"!==(r=this.fetch()).text;)i+=r.text,this.consume();return this.consume(),n.text=i,n}parseRegexGroup(e,t){for(var n,r=this.fetch(),i=r,s="";"EOF"!==(n=this.fetch()).text&&e.test(s+n.text);)s+=(i=n).text,this.consume();if(""===s)throw new xr("Invalid "+t+": '"+r.text+"'",r);return r.range(i,s)}parseColorGroup(e){var t=this.parseStringGroup("color",e);if(null==t)return null;var n=/^(#[a-f0-9]{3}|#?[a-f0-9]{6}|[a-z]+)$/i.exec(t.text);if(!n)throw new xr("Invalid color: '"+t.text+"'",t);var r=n[0];return/^[0-9a-f]{6}$/i.test(r)&&(r="#"+r),{type:"color-token",mode:this.mode,color:r}}parseSizeGroup(e){var t,n=!1;if(this.gullet.consumeSpaces(),!(t=e||"{"===this.gullet.future().text?this.parseStringGroup("size",e):this.parseRegexGroup(/^[-+]? *(?:$|\d+|\d+\.\d*|\.\d*) *[a-z]{0,2} *$/,"size")))return null;e||0!==t.text.length||(t.text="0pt",n=!0);var r=/([-+]?) *(\d+(?:\.\d*)?|\.\d+) *([a-z]{2})/.exec(t.text);if(!r)throw new xr("Invalid size: '"+t.text+"'",t);var i={number:+(r[1]+r[2]),unit:r[3]};if(!di(i))throw new xr("Invalid unit: '"+i.unit+"'",t);return{type:"size",mode:this.mode,value:i,isBlank:n}}parseUrlGroup(e){this.gullet.lexer.setCatcode("%",13),this.gullet.lexer.setCatcode("~",12);var t=this.parseStringGroup("url",e);if(this.gullet.lexer.setCatcode("%",14),this.gullet.lexer.setCatcode("~",13),null==t)return null;var n=t.text.replace(/\\([#$%&~_^{}])/g,"$1");return{type:"url",mode:this.mode,url:n}}parseArgumentGroup(e,t){var n=this.gullet.scanArgument(e);if(null==n)return null;var r=this.mode;t&&this.switchMode(t),this.gullet.beginGroup();var i=this.parseExpression(!1,"EOF");this.expect("EOF"),this.gullet.endGroup();var s={type:"ordgroup",mode:this.mode,loc:n.loc,body:i};return t&&this.switchMode(r),s}parseGroup(e,t){var n,r=this.fetch(),i=r.text;if("{"===i||"\\begingroup"===i){this.consume();var s="{"===i?"}":"\\endgroup";this.gullet.beginGroup();var o=this.parseExpression(!1,s),a=this.fetch();this.expect(s),this.gullet.endGroup(),n={type:"ordgroup",mode:this.mode,loc:_r.range(r,a),body:o,semisimple:"\\begingroup"===i||void 0}}else if(null==(n=this.parseFunction(t,e)||this.parseSymbol())&&"\\"===i[0]&&!ol.hasOwnProperty(i)){if(this.settings.throwOnError)throw new xr("Undefined control sequence: "+i,r);n=this.formatUnsupportedCmd(i),this.consume()}return n}formLigatures(e){for(var t=e.length-1,n=0;n<t;++n){var r=e[n],i=r.text;"-"===i&&"-"===e[n+1].text&&(n+1<t&&"-"===e[n+2].text?(e.splice(n,3,{type:"textord",mode:"text",loc:_r.range(r,e[n+2]),text:"---"}),t-=2):(e.splice(n,2,{type:"textord",mode:"text",loc:_r.range(r,e[n+1]),text:"--"}),t-=1)),"'"!==i&&"`"!==i||e[n+1].text!==i||(e.splice(n,2,{type:"textord",mode:"text",loc:_r.range(r,e[n+1]),text:i+i}),t-=1)}}parseSymbol(){var e=this.fetch(),t=e.text;if(/^\\verb[^a-zA-Z]/.test(t)){this.consume();var n=t.slice(5),r="*"===n.charAt(0);if(r&&(n=n.slice(1)),n.length<2||n.charAt(0)!==n.slice(-1))throw new xr("\\verb assertion failed --\n                    please report what input caused this bug");return{type:"verb",mode:"text",body:n=n.slice(1,-1),star:r}}cl.hasOwnProperty(t[0])&&!Ai[this.mode][t[0]]&&(this.settings.strict&&"math"===this.mode&&this.settings.reportNonstrict("unicodeTextInMathMode",'Accented Unicode text character "'+t[0]+'" used in math mode',e),t=cl[t[0]]+t.substr(1));var i,s=Za.exec(t);if(s&&("i"===(t=t.substring(0,s.index))?t="":"j"===t&&(t="")),Ai[this.mode][t]){this.settings.strict&&"math"===this.mode&&os.indexOf(t)>=0&&this.settings.reportNonstrict("unicodeTextInMathMode",'Latin-1/Unicode text character "'+t[0]+'" used in math mode',e);var o,a=Ai[this.mode][t].group,l=_r.range(e);if(Ti.hasOwnProperty(a)){var c=a;o={type:"atom",mode:this.mode,family:c,loc:l,text:t}}else o={type:a,mode:this.mode,loc:l,text:t};i=o}else{if(!(t.charCodeAt(0)>=128))return null;this.settings.strict&&(Xr(t.charCodeAt(0))?"math"===this.mode&&this.settings.reportNonstrict("unicodeTextInMathMode",'Unicode text character "'+t[0]+'" used in math mode',e):this.settings.reportNonstrict("unknownSymbol",'Unrecognized Unicode character "'+t[0]+'" ('+t.charCodeAt(0)+")",e)),i={type:"textord",mode:"text",loc:_r.range(e),text:t}}if(this.consume(),s)for(var d=0;d<s[0].length;d++){var u=s[0][d];if(!ll[u])throw new xr("Unknown accent ' "+u+"'",e);var h=ll[u][this.mode]||ll[u].text;if(!h)throw new xr("Accent "+u+" unsupported in "+this.mode+" mode",e);i={type:"accent",mode:this.mode,loc:_r.range(e),label:h,isStretchy:!1,isShifty:!0,base:i}}return i}}dl.endOfExpression=["}","\\endgroup","\\end","\\right","&"];var ul=function(e,t){if(!("string"==typeof e||e instanceof String))throw new TypeError("KaTeX can only parse string typed expression");var n=new dl(e,t);delete n.gullet.macros.current["\\df@tag"];var r=n.parse();if(delete n.gullet.macros.current["\\current@color"],delete n.gullet.macros.current["\\color"],n.gullet.macros.get("\\df@tag")){if(!t.displayMode)throw new xr("\\tag works only in display equations");r=[{type:"tag",mode:"text",body:r,tag:n.subparse([new kr("\\df@tag")])}]}return r},hl=function(e,t,n){t.textContent="";var r=ml(e,n).toNode();t.appendChild(r)};"undefined"!=typeof document&&"CSS1Compat"!==document.compatMode&&("undefined"!=typeof console&&console.warn("Warning: KaTeX doesn't work in quirks mode. Make sure your website has a suitable doctype."),hl=function(){throw new xr("KaTeX doesn't work in quirks mode.")});var pl=function(e,t,n){if(n.throwOnError||!(e instanceof xr))throw e;var r=Ss.makeSpan(["katex-error"],[new Si(t)]);return r.setAttribute("title",e.toString()),r.setAttribute("style","color:"+n.errorColor),r},ml=function(e,t){var n=new jr(t);try{return function(e,t,n){var r,i=so(n);if("mathml"===n.output)return io(e,t,i,n.displayMode,!0);if("html"===n.output){var s=Ws(e,i);r=Ss.makeSpan(["katex"],[s])}else{var o=io(e,t,i,n.displayMode,!1),a=Ws(e,i);r=Ss.makeSpan(["katex"],[o,a])}return oo(r,n)}(ul(e,n),e,n)}catch(t){return pl(t,e,n)}},gl={version:"0.15.2",render:hl,renderToString:function(e,t){return ml(e,t).toMarkup()},ParseError:xr,SETTINGS_SCHEMA:Fr,__parse:function(e,t){var n=new jr(t);return ul(e,n)},__renderToDomTree:ml,__renderToHTMLTree:function(e,t){var n=new jr(t);try{return function(e,t,n){var r=Ws(e,so(n)),i=Ss.makeSpan(["katex"],[r]);return oo(i,n)}(ul(e,n),0,n)}catch(t){return pl(t,e,n)}},__setFontMetrics:function(e,t){Qr[e]=t},__defineSymbol:Ii,__defineMacro:sa,__domTree:{Span:yi,Anchor:vi,SymbolNode:Si,SvgNode:_i,PathNode:ki,LineNode:xi}};function fl(e){e&&Array.from(e.querySelectorAll("[data-mx-maths]")).forEach((e=>{"DIV"===e.tagName?gl.render(e.dataset.mxMaths,e,{displayMode:!0,throwOnError:!1}):gl.render(e.dataset.mxMaths,e,{throwOnError:!1})}))}function yl(e){e&&Array.from(e.querySelectorAll("a[href]")).forEach((e=>{try{const t=new URL(e.getAttribute("href"));if(t.host===window.location.host&&t.pathname===window.location.pathname){const t=new URL(e.getAttribute("href")).hash;e.addEventListener("click",(e=>{e.preventDefault(),Vn.push(t.slice(1))}))}else if("matrix.to"===t.host){const n=Ye.client.getUser(t.hash.slice(2));if(e.addEventListener("click",(e=>e.preventDefault())),n){const t=new fe(n.userId);e.style.setProperty("--user_dark",t.dark)}}}catch(e){}}))}function vl(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class bl extends g{constructor(...e){super(...e),vl(this,"displayName",Ye.client.getUser(this.props.userId).displayName),vl(this,"avatarUrl",Ye.client.getUser(this.props.userId).avatarUrl),vl(this,"avatarHttpURI",Ye.client.getHttpUriForMxcFromHS(this.avatarUrl,20,20,"crop")),vl(this,"userColor",new fe(this.props.userId)),vl(this,"theClass",this.props.isMe?"user-info-message message-from-user":this.props.isReply?"reply-sender-info":"user-info-message")}render(){return h("div",{class:this.theClass,style:this.userColor.styleVariables},this.avatarHttpURI?h("img",{src:this.avatarHttpURI}):null,h("span",null,this.displayName))}}function wl(e){if("string"!=typeof e||!e)throw new Error("expected a non-empty string, got: "+e)}function Sl(e){if("number"!=typeof e)throw new Error("expected a number, got: "+e)}const _l="emoji",kl="keyvalue",xl="favorites",El="tokens",Tl="count",Cl="group-order",Al="eTag",Il="url",Rl="skinTone",Ol="readonly",Pl="readwrite",Ml="skinUnicodes";function Dl(e){return function(e,t){const n=new Set,r=[];for(const i of e){const e=t(i);n.has(e)||(n.add(e),r.push(i))}return r}(e,(e=>e.unicode))}const Ll={},Fl={},Nl={};function jl(e,t,n){n.onerror=()=>t(n.error),n.onblocked=()=>t(new Error("IDB blocked")),n.onsuccess=()=>e(n.result)}function Ul(e,t,n,r){return new Promise(((i,s)=>{const o=e.transaction(t,n,{durability:"relaxed"}),a="string"==typeof t?o.objectStore(t):t.map((e=>o.objectStore(e)));let l;r(a,o,(e=>{l=e})),o.oncomplete=()=>i(l),o.onerror=()=>s(o.error)}))}function Bl(e){const t=Ll[e],n=t&&t.result;if(n){n.close();const t=Nl[e];if(t)for(const e of t)e()}delete Ll[e],delete Fl[e],delete Nl[e]}const ql=new Set([":D","xD",":'D","o:)",":x",":p",";p","xp",":l",":z",":j","8D","xo","8)",":B",":o",":s",":'o","Dx","x(","D:",":c",">0)",":3","</3","<3","\\m/",":E","8#"]);function Kl(e){return e.split(/[\s_]+/).map((e=>!e.match(/\w/)||ql.has(e)?e.toLowerCase():e.replace(/[)(:,]/g,"").replace(//g,"'").toLowerCase())).filter(Boolean)}function zl(e){return e.filter(Boolean).map((e=>e.toLowerCase())).filter((e=>e.length>=2))}function $l(e,t,n,r){e[t](n).onsuccess=e=>r&&r(e.target.result)}function Vl(e,t,n){$l(e,"get",t,n)}function Hl(e,t,n){$l(e,"getAll",t,n)}function Wl(e){e.commit&&e.commit()}function Gl(e,t){const n=function(e,t){let n=e[0];for(let r=1;r<e.length;r++){const i=e[r];t(n)>t(i)&&(n=i)}return n}(e,(e=>e.length)),r=[];for(const i of n)e.some((e=>-1===e.findIndex((e=>t(e)===t(i)))))||r.push(i);return r}async function Yl(e,t,n,r){try{const i=function(e){const t=e.map((({annotation:e,emoticon:t,group:n,order:r,shortcodes:i,skins:s,tags:o,emoji:a,version:l})=>{const c=[...new Set(zl([...(i||[]).map(Kl).flat(),...o.map(Kl).flat(),...Kl(e),t]))].sort(),d={annotation:e,group:n,order:r,tags:o,tokens:c,unicode:a,version:l};if(t&&(d.emoticon=t),i&&(d.shortcodes=i),s){d.skinTones=[],d.skinUnicodes=[],d.skinVersions=[];for(const{tone:e,emoji:t,version:n}of s)d.skinTones.push(e),d.skinUnicodes.push(t),d.skinVersions.push(n)}return d}));return t}(t);await Ul(e,[_l,kl],Pl,(([e,t],s)=>{let o,a,l=0;function c(){2==++l&&function(){if(o!==r||a!==n){e.clear();for(const t of i)e.put(t);t.put(r,Al),t.put(n,Il),Wl(s)}}()}Vl(t,Al,(e=>{o=e,c()})),Vl(t,Il,(e=>{a=e,c()}))}))}finally{}}async function Xl(e,t){const n=zl(Kl(t));return n.length?Ul(e,_l,Ol,((e,t,r)=>{const i=[],s=()=>{const e=Gl(i,(e=>e.unicode));r(e.sort(((e,t)=>e.order<t.order?-1:1)))};for(let t=0;t<n.length;t++){const r=n[t],o=t===n.length-1?IDBKeyRange.bound(r,r+"",!1,!0):IDBKeyRange.only(r);Hl(e.index(El),o,(e=>{i.push(e),i.length===n.length&&s()}))}})):[]}function Zl(e,t,n){return Ul(e,t,Ol,((e,t,r)=>Vl(e,n,r)))}const Jl=["name","url"];function Ql(e){!function(e){const t=e&&Array.isArray(e),n=t&&e.length&&(!e[0]||Jl.some((t=>!(t in e[0]))));if(!t||n)throw new Error("Custom emojis are in the wrong format")}(e);const t=(e,t)=>e.name.toLowerCase()<t.name.toLowerCase()?-1:1,n=e.sort(t),r=function(e,t){const n=new Map;for(const t of e){const e=[...new Set((t.shortcodes||[]).map((e=>Kl(e))).flat())];for(const r of e){let e=n;for(let t=0;t<r.length;t++){const n=r.charAt(t);let i=e.get(n);i||(i=new Map,e.set(n,i)),e=i}let i=e.get("");i||(i=[],e.set("",i)),i.push(t)}}return(e,t)=>{let r=n;for(let t=0;t<e.length;t++){const n=e.charAt(t),i=r.get(n);if(!i)return[];r=i}if(t)return r.get("")||[];const i=[],s=[r];for(;s.length;){const e=[...s.shift().entries()].sort(((e,t)=>e[0]<t[0]?-1:1));for(const[t,n]of e)""===t?i.push(...n):s.push(n)}return i}}(e),i=e=>r(e,!0),s=e=>r(e,!1),o=new Map,a=new Map;for(const t of e){a.set(t.name.toLowerCase(),t);for(const e of t.shortcodes||[])o.set(e.toLowerCase(),t)}return{all:n,search:e=>{const n=Kl(e);return Gl(n.map(((e,t)=>(t<n.length-1?i:s)(e))),(e=>e.name)).sort(t)},byShortcode:e=>o.get(e.toLowerCase()),byName:e=>a.get(e.toLowerCase())}}function ec(e){if(!e)return e;if(delete e.tokens,e.skinTones){const t=e.skinTones.length;e.skins=Array(t);for(let n=0;n<t;n++)e.skins[n]={tone:e.skinTones[n],unicode:e.skinUnicodes[n],version:e.skinVersions[n]};delete e.skinTones,delete e.skinUnicodes,delete e.skinVersions}return e}function tc(e){e||console.warn("emoji-picker-element is more efficient if the dataSource server exposes an ETag header.")}const nc=["annotation","emoji","group","order","tags","version"];function rc(e,t){if(2!==Math.floor(e.status/100))throw new Error("Failed to fetch: "+t+":  "+e.status)}async function ic(e){const t=await fetch(e);rc(t,e);const n=t.headers.get("etag");tc(n);const r=await t.json();return function(e){if(!e||!Array.isArray(e)||!e[0]||"object"!=typeof e[0]||nc.some((t=>!(t in e[0]))))throw new Error("Emoji data is in the wrong format")}(r),[n,r]}async function sc(e){const t=function(e){for(var t=e.length,n=new ArrayBuffer(t),r=new Uint8Array(n),i=-1;++i<t;)r[i]=e.charCodeAt(i);return n}(JSON.stringify(e)),n=function(e){for(var t="",n=new Uint8Array(e),r=n.byteLength,i=-1;++i<r;)t+=String.fromCharCode(n[i]);return t}(await crypto.subtle.digest("SHA-1",t));return btoa(n)}const oc=class{constructor({dataSource:e="https://cdn.jsdelivr.net/npm/emoji-picker-element-data@^1/en/emojibase/data.json",locale:t="en",customEmoji:n=[]}={}){this.dataSource=e,this.locale=t,this._dbName=`emoji-picker-element-${this.locale}`,this._db=void 0,this._lazyUpdate=void 0,this._custom=Ql(n),this._clear=this._clear.bind(this),this._ready=this._init()}async _init(){const e=this._db=await(t=this._dbName,Fl[t]||(Fl[t]=async function(e){const t=await new Promise(((t,n)=>{const r=indexedDB.open(e,1);Ll[e]=r,r.onupgradeneeded=e=>{e.oldVersion<1&&function(e){function t(t,n,r){const i=n?e.createObjectStore(t,{keyPath:n}):e.createObjectStore(t);if(r)for(const[e,[t,n]]of Object.entries(r))i.createIndex(e,t,{multiEntry:n});return i}t(kl),t(_l,"unicode",{[El]:["tokens",!0],[Cl]:[["group","order"]],[Ml]:["skinUnicodes",!0]}),t(xl,void 0,{[Tl]:[""]})}(r.result)},jl(t,n,r)}));return t.onclose=()=>Bl(e),t}(t)),Fl[t]);var t;!function(e,t){let n=Nl[e];n||(n=Nl[e]=[]),n.push(t)}(this._dbName,this._clear);const n=this.dataSource,r=await async function(e){return!await Zl(e,kl,Il)}(e);r?await async function(e,t){let[n,r]=await ic(t);n||(n=await sc(r)),await Yl(e,r,t,n)}(e,n):this._lazyUpdate=async function(e,t){let n,r=await async function(e){const t=await fetch(e,{method:"HEAD"});rc(t,e);const n=t.headers.get("etag");return tc(n),n}(t);if(!r){const e=await ic(t);r=e[0],n=e[1],r||(r=await sc(n))}await async function(e,t,n){const[r,i]=await Promise.all([Al,Il].map((t=>Zl(e,kl,t))));return r===n&&i===t}(e,t,r)||(n||(n=(await ic(t))[1]),await Yl(e,n,t,r))}(e,n)}async ready(){const e=async()=>(this._ready||(this._ready=this._init()),this._ready);await e(),this._db||await e()}async getEmojiByGroup(e){return Sl(e),await this.ready(),Dl(await async function(e,t){return Ul(e,_l,Ol,((e,n,r)=>{const i=IDBKeyRange.bound([t,0],[t+1,0],!1,!0);Hl(e.index(Cl),i,r)}))}(this._db,e)).map(ec)}async getEmojiBySearchQuery(e){return wl(e),await this.ready(),[...this._custom.search(e),...Dl(await Xl(this._db,e)).map(ec)]}async getEmojiByShortcode(e){wl(e),await this.ready();return this._custom.byShortcode(e)||ec(await async function(e,t){const n=await Xl(e,t);if(!n.length){const n=e=>(e.shortcodes||[]).includes(t.toLowerCase());return await async function(e,t){return Ul(e,_l,Ol,((e,n,r)=>{let i;const s=()=>{e.getAll(i&&IDBKeyRange.lowerBound(i,!0),50).onsuccess=e=>{const n=e.target.result;for(const e of n)if(i=e.unicode,t(e))return r(e);if(n.length<50)return r();s()}};s()}))}(e,n)||null}return n.filter((e=>{const n=(e.shortcodes||[]).map((e=>e.toLowerCase()));return n.includes(t.toLowerCase())}))[0]||null}(this._db,e))}async getEmojiByUnicodeOrName(e){wl(e),await this.ready();return this._custom.byName(e)||ec(await async function(e,t){return Ul(e,_l,Ol,((e,n,r)=>Vl(e,t,(n=>{if(n)return r(n);Vl(e.index(Ml),t,(e=>r(e||null)))}))))}(this._db,e))}async getPreferredSkinTone(){return await this.ready(),await Zl(this._db,kl,Rl)||0}async setPreferredSkinTone(e){return Sl(e),await this.ready(),t=this._db,Rl,n=e,Ul(t,kl,Pl,((e,t)=>{e.put(n,"skinTone"),Wl(t)}));var t,n}async incrementFavoriteEmojiCount(e){return wl(e),await this.ready(),t=this._db,n=e,Ul(t,xl,Pl,((e,t)=>Vl(e,n,(r=>{e.put((r||0)+1,n),Wl(t)}))));var t,n}async getTopFavoriteEmoji(e){return Sl(e),await this.ready(),(await function(e,t,n){return 0===n?[]:Ul(e,[xl,_l],Ol,(([e,r],i,s)=>{const o=[];e.index(Tl).openCursor(void 0,"prev").onsuccess=e=>{const i=e.target.result;if(!i)return s(o);function a(e){if(o.push(e),o.length===n)return s(o);i.continue()}const l=i.primaryKey,c=t.byName(l);if(c)return a(c);Vl(r,l,(e=>{if(e)return a(e);i.continue()}))}}))}(this._db,this._custom,e)).map(ec)}set customEmoji(e){this._custom=Ql(e)}get customEmoji(){return this._custom.all}async _shutdown(){await this.ready();try{await this._lazyUpdate}catch(e){}}_clear(){this._db=this._ready=this._lazyUpdate=void 0}async close(){await this._shutdown(),await Bl(this._dbName)}async delete(){var e;await this._shutdown(),await(e=this._dbName,new Promise(((t,n)=>{Bl(e),jl(t,n,indexedDB.deleteDatabase(e))})))}};function ac(){}function lc(e){return e()}function cc(){return Object.create(null)}function dc(e){e.forEach(lc)}function uc(e){return"function"==typeof e}function hc(e,t){return e!=e?t==t:e!==t||e&&"object"==typeof e||"function"==typeof e}let pc,mc;function gc(e,t){return pc||(pc=document.createElement("a")),pc.href=t,e===pc.href}function fc(e,t){e.appendChild(t)}function yc(e,t,n){e.insertBefore(t,n||null)}function vc(e){e.parentNode.removeChild(e)}function bc(e){return document.createElement(e)}function wc(e){return document.createTextNode(e)}function Sc(e,t,n,r){return e.addEventListener(t,n,r),()=>e.removeEventListener(t,n,r)}function _c(e,t,n){null==n?e.removeAttribute(t):e.getAttribute(t)!==n&&e.setAttribute(t,n)}function kc(e,t){t=""+t,e.wholeText!==t&&(e.data=t)}function xc(e,t){e.value=null==t?"":t}function Ec(e,t,n,r){e.style.setProperty(t,n,r?"important":"")}function Tc(e){mc=e}const Cc=[],Ac=[],Ic=[],Rc=[],Oc=Promise.resolve();let Pc=!1;function Mc(){Pc||(Pc=!0,Oc.then(Nc))}function Dc(e){Ic.push(e)}let Lc=!1;const Fc=new Set;function Nc(){if(!Lc){Lc=!0;do{for(let e=0;e<Cc.length;e+=1){const t=Cc[e];Tc(t),jc(t.$$)}for(Tc(null),Cc.length=0;Ac.length;)Ac.pop()();for(let e=0;e<Ic.length;e+=1){const t=Ic[e];Fc.has(t)||(Fc.add(t),t())}Ic.length=0}while(Cc.length);for(;Rc.length;)Rc.pop()();Pc=!1,Lc=!1,Fc.clear()}}function jc(e){if(null!==e.fragment){e.update(),dc(e.before_update);const t=e.dirty;e.dirty=[-1],e.fragment&&e.fragment.p(e.ctx,t),e.after_update.forEach(Dc)}}const Uc=new Set;function Bc(e,t){e&&e.i&&(Uc.delete(e),e.i(t))}const qc="undefined"!=typeof window?window:"undefined"!=typeof globalThis?globalThis:global;function Kc(e,t){e.d(1),t.delete(e.key)}function zc(e,t,n,r,i,s,o,a,l,c,d,u){let h=e.length,p=s.length,m=h;const g={};for(;m--;)g[e[m].key]=m;const f=[],y=new Map,v=new Map;for(m=p;m--;){const e=u(i,s,m),a=n(e);let l=o.get(a);l?r&&l.p(e,t):(l=c(a,e),l.c()),y.set(a,f[m]=l),a in g&&v.set(a,Math.abs(m-g[a]))}const b=new Set,w=new Set;function S(e){Bc(e,1),e.m(a,d),o.set(e.key,e),d=e.first,p--}for(;h&&p;){const t=f[p-1],n=e[h-1],r=t.key,i=n.key;t===n?(d=t.first,h--,p--):y.has(i)?!o.has(r)||b.has(r)?S(t):w.has(i)?h--:v.get(r)>v.get(i)?(w.add(r),S(t)):(b.add(i),h--):(l(n,o),h--)}for(;h--;){const t=e[h];y.has(t.key)||l(t,o)}for(;p;)S(f[p-1]);return f}const $c=[[-1,"","custom"],[0,"","smileys-emotion"],[1,"","people-body"],[3,"","animals-nature"],[4,"","food-drink"],[5,"","travel-places"],[6,"","activities"],[7,"","objects"],[8,"","symbols"],[9,"","flags"]].map((([e,t,n])=>({id:e,emoji:t,name:n}))),Vc=$c.slice(1),Hc=$c[0],Wc="function"==typeof requestIdleCallback?requestIdleCallback:setTimeout;function Gc(e){return e.unicode.includes("")}const Yc={"":13.1,"":12.1,"":11,"":5,"":4,"":3,"":2,"":1,"":.7,"":.6},Xc=["","","","","","","","","","","","","",""],Zc='"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Twemoji Mozilla","Noto Color Emoji","EmojiOne Color","Android Emoji",sans-serif',Jc=(e,t)=>e<t?-1:e>t?1:0,Qc=(e,t)=>{const n=document.createElement("canvas");n.width=n.height=1;const r=n.getContext("2d");return r.textBaseline="top",r.font=`100px ${Zc}`,r.fillStyle=t,r.scale(.01,.01),r.fillText(e,0,0),r.getImageData(0,0,1,1).data};function ed(e){const t=Qc(e,"#000"),n=Qc(e,"#fff");return t&&n&&((e,t)=>{const n=[...e].join(",");return n===[...t].join(",")&&!n.startsWith("0,0,0,")})(t,n)}const td=new Promise((e=>Wc((()=>e(function(){const e=Object.entries(Yc);try{for(const[t,n]of e)if(ed(t))return n}catch(e){}return e[0][1]}()))))),nd=new Map;function rd(e){e.preventDefault(),e.stopPropagation()}function id(e,t,n){return(t+=e?-1:1)<0?t=n.length-1:t>=n.length&&(t=0),t}function sd(e,t){const n=new Set,r=[];for(const i of e){const e=t(i);n.has(e)||(n.add(e),r.push(i))}return r}const od=requestAnimationFrame;let ad,ld="function"==typeof ResizeObserver;function cd(e){{const t=document.createRange();return t.selectNode(e.firstChild),t.getBoundingClientRect().width}}const{Map:dd}=qc;function ud(e,t,n){const r=e.slice();return r[63]=t[n],r[65]=n,r}function hd(e,t,n){const r=e.slice();return r[66]=t[n],r[65]=n,r}function pd(e,t,n){const r=e.slice();return r[63]=t[n],r[65]=n,r}function md(e,t,n){const r=e.slice();return r[69]=t[n],r}function gd(e,t,n){const r=e.slice();return r[72]=t[n],r[65]=n,r}function fd(e,t){let n,r,i,s,o,a,l,c=t[72]+"";return{key:e,first:null,c(){n=bc("div"),r=wc(c),_c(n,"id",i="skintone-"+t[65]),_c(n,"class",s="emoji hide-focus "+(t[65]===t[20]?"active":"")),_c(n,"aria-selected",o=t[65]===t[20]),_c(n,"role","option"),_c(n,"title",a=t[0].skinTones[t[65]]),_c(n,"tabindex","-1"),_c(n,"aria-label",l=t[0].skinTones[t[65]]),this.first=n},m(e,t){yc(e,n,t),fc(n,r)},p(e,d){t=e,512&d[0]&&c!==(c=t[72]+"")&&kc(r,c),512&d[0]&&i!==(i="skintone-"+t[65])&&_c(n,"id",i),1049088&d[0]&&s!==(s="emoji hide-focus "+(t[65]===t[20]?"active":""))&&_c(n,"class",s),1049088&d[0]&&o!==(o=t[65]===t[20])&&_c(n,"aria-selected",o),513&d[0]&&a!==(a=t[0].skinTones[t[65]])&&_c(n,"title",a),513&d[0]&&l!==(l=t[0].skinTones[t[65]])&&_c(n,"aria-label",l)},d(e){e&&vc(n)}}}function yd(e,t){let n,r,i,s,o,a,l,c,d,u=t[69].emoji+"";function h(){return t[49](t[69])}return{key:e,first:null,c(){n=bc("button"),r=bc("div"),i=wc(u),_c(r,"class","nav-emoji emoji"),_c(n,"role","tab"),_c(n,"class","nav-button"),_c(n,"aria-controls",s="tab-"+t[69].id),_c(n,"aria-label",o=t[0].categories[t[69].name]),_c(n,"aria-selected",a=!t[4]&&t[13].id===t[69].id),_c(n,"title",l=t[0].categories[t[69].name]),this.first=n},m(e,t){yc(e,n,t),fc(n,r),fc(r,i),c||(d=Sc(n,"click",h),c=!0)},p(e,r){t=e,4096&r[0]&&u!==(u=t[69].emoji+"")&&kc(i,u),4096&r[0]&&s!==(s="tab-"+t[69].id)&&_c(n,"aria-controls",s),4097&r[0]&&o!==(o=t[0].categories[t[69].name])&&_c(n,"aria-label",o),12304&r[0]&&a!==(a=!t[4]&&t[13].id===t[69].id)&&_c(n,"aria-selected",a),4097&r[0]&&l!==(l=t[0].categories[t[69].name])&&_c(n,"title",l)},d(e){e&&vc(n),c=!1,d()}}}function vd(e){let t,n;return{c(){t=bc("img"),_c(t,"class","custom-emoji"),gc(t.src,n=e[63].url)||_c(t,"src",n),_c(t,"alt",""),_c(t,"loading","lazy")},m(e,n){yc(e,t,n)},p(e,r){32768&r[0]&&!gc(t.src,n=e[63].url)&&_c(t,"src",n)},d(e){e&&vc(t)}}}function bd(e){let t,n=e[27](e[63],e[8])+"";return{c(){t=wc(n)},m(e,n){yc(e,t,n)},p(e,r){33024&r[0]&&n!==(n=e[27](e[63],e[8])+"")&&kc(t,n)},d(e){e&&vc(t)}}}function wd(e,t){let n,r,i,s,o,a,l;function c(e,t){return e[63].unicode?bd:vd}let d=c(t),u=d(t);return{key:e,first:null,c(){n=bc("button"),u.c(),_c(n,"role",r=t[4]?"option":"menuitem"),_c(n,"aria-selected",i=t[4]?t[65]==t[5]:""),_c(n,"aria-label",s=t[28](t[63],t[8])),_c(n,"title",o=t[63].title),_c(n,"class",a="emoji "+(t[4]&&t[65]===t[5]?"active":"")),_c(n,"id",l="emo-"+t[63].id),this.first=n},m(e,t){yc(e,n,t),u.m(n,null)},p(e,h){d===(d=c(t=e))&&u?u.p(t,h):(u.d(1),u=d(t),u&&(u.c(),u.m(n,null))),16&h[0]&&r!==(r=t[4]?"option":"menuitem")&&_c(n,"role",r),32816&h[0]&&i!==(i=t[4]?t[65]==t[5]:"")&&_c(n,"aria-selected",i),33024&h[0]&&s!==(s=t[28](t[63],t[8]))&&_c(n,"aria-label",s),32768&h[0]&&o!==(o=t[63].title)&&_c(n,"title",o),32816&h[0]&&a!==(a="emoji "+(t[4]&&t[65]===t[5]?"active":""))&&_c(n,"class",a),32768&h[0]&&l!==(l="emo-"+t[63].id)&&_c(n,"id",l)},d(e){e&&vc(n),u.d()}}}function Sd(e,t){let n,r,i,s,o,a,l,c,d=(t[4]?t[0].searchResultsLabel:t[66].category?t[66].category:t[15].length>1?t[0].categories.custom:t[0].categories[t[13].name])+"",u=[],h=new dd,p=t[66].emojis;const m=e=>e[63].id;for(let e=0;e<p.length;e+=1){let n=pd(t,p,e),r=m(n);h.set(r,u[e]=wd(r,n))}return{key:e,first:null,c(){n=bc("div"),r=wc(d),o=bc("div");for(let e=0;e<u.length;e+=1)u[e].c();_c(n,"id",i="menu-label-"+t[65]),_c(n,"class",s="category "+(1===t[15].length&&""===t[15][0].category?"gone":"")),_c(n,"aria-hidden","true"),_c(o,"class","emoji-menu"),_c(o,"role",a=t[4]?"listbox":"menu"),_c(o,"aria-labelledby",l="menu-label-"+t[65]),_c(o,"id",c=t[4]?"search-results":""),this.first=n},m(e,t){yc(e,n,t),fc(n,r),yc(e,o,t);for(let e=0;e<u.length;e+=1)u[e].m(o,null)},p(e,g){t=e,40977&g[0]&&d!==(d=(t[4]?t[0].searchResultsLabel:t[66].category?t[66].category:t[15].length>1?t[0].categories.custom:t[0].categories[t[13].name])+"")&&kc(r,d),32768&g[0]&&i!==(i="menu-label-"+t[65])&&_c(n,"id",i),32768&g[0]&&s!==(s="category "+(1===t[15].length&&""===t[15][0].category?"gone":""))&&_c(n,"class",s),402686256&g[0]&&(p=t[66].emojis,u=zc(u,g,m,1,t,p,h,o,Kc,wd,null,pd)),16&g[0]&&a!==(a=t[4]?"listbox":"menu")&&_c(o,"role",a),32768&g[0]&&l!==(l="menu-label-"+t[65])&&_c(o,"aria-labelledby",l),16&g[0]&&c!==(c=t[4]?"search-results":"")&&_c(o,"id",c)},d(e){e&&vc(n),e&&vc(o);for(let e=0;e<u.length;e+=1)u[e].d()}}}function _d(e){let t,n;return{c(){t=bc("img"),_c(t,"class","custom-emoji"),gc(t.src,n=e[63].url)||_c(t,"src",n),_c(t,"alt",""),_c(t,"loading","lazy")},m(e,n){yc(e,t,n)},p(e,r){1024&r[0]&&!gc(t.src,n=e[63].url)&&_c(t,"src",n)},d(e){e&&vc(t)}}}function kd(e){let t,n=e[27](e[63],e[8])+"";return{c(){t=wc(n)},m(e,n){yc(e,t,n)},p(e,r){1280&r[0]&&n!==(n=e[27](e[63],e[8])+"")&&kc(t,n)},d(e){e&&vc(t)}}}function xd(e,t){let n,r,i,s;function o(e,t){return e[63].unicode?kd:_d}let a=o(t),l=a(t);return{key:e,first:null,c(){n=bc("button"),l.c(),_c(n,"role","menuitem"),_c(n,"aria-label",r=t[28](t[63],t[8])),_c(n,"title",i=t[63].title),_c(n,"class","emoji"),_c(n,"id",s="fav-"+t[63].id),this.first=n},m(e,t){yc(e,n,t),l.m(n,null)},p(e,c){a===(a=o(t=e))&&l?l.p(t,c):(l.d(1),l=a(t),l&&(l.c(),l.m(n,null))),1280&c[0]&&r!==(r=t[28](t[63],t[8]))&&_c(n,"aria-label",r),1024&c[0]&&i!==(i=t[63].title)&&_c(n,"title",i),1024&c[0]&&s!==(s="fav-"+t[63].id)&&_c(n,"id",s)},d(e){e&&vc(n),l.d()}}}function Ed(e){let t,n,r,i,s,o,a,l,c,d,u,h,p,m,g,f,y,v,b,w,S,_,k,x,E,T,C,A,I,R,O,P,M,D,L,F,N,j,U,B,q,K,z,$,V=e[0].searchLabel+"",H=e[0].searchDescription+"",W=e[0].skinToneDescription+"",G=[],Y=new dd,X=[],Z=new dd,J=[],Q=new dd,ee=[],te=new dd,ne=e[9];const re=e=>e[72];for(let t=0;t<ne.length;t+=1){let n=gd(e,ne,t),r=re(n);Y.set(r,G[t]=fd(r,n))}let ie=e[12];const se=e=>e[69].id;for(let t=0;t<ie.length;t+=1){let n=md(e,ie,t),r=se(n);Z.set(r,X[t]=yd(r,n))}let oe=e[15];const ae=e=>e[66].category;for(let t=0;t<oe.length;t+=1){let n=hd(e,oe,t),r=ae(n);Q.set(r,J[t]=Sd(r,n))}let le=e[10];const ce=e=>e[63].id;for(let t=0;t<le.length;t+=1){let n=ud(e,le,t),r=ce(n);te.set(r,ee[t]=xd(r,n))}return{c(){t=bc("section"),n=bc("div"),r=bc("div"),i=bc("div"),s=bc("input"),c=bc("label"),d=wc(V),u=bc("span"),h=wc(H),p=bc("div"),m=bc("button"),g=wc(e[21]),v=bc("span"),b=wc(W),w=bc("div");for(let e=0;e<G.length;e+=1)G[e].c();E=bc("div");for(let e=0;e<X.length;e+=1)X[e].c();C=bc("div"),A=bc("div"),I=bc("div"),R=wc(e[18]),P=bc("div"),M=bc("div");for(let e=0;e<J.length;e+=1)J[e].c();j=bc("div");for(let e=0;e<ee.length;e+=1)ee[e].c();q=bc("button"),q.textContent="",_c(n,"class","pad-top"),_c(s,"id","search"),_c(s,"class","search"),_c(s,"type","search"),_c(s,"role","combobox"),_c(s,"enterkeyhint","search"),_c(s,"placeholder",o=e[0].searchLabel),_c(s,"autocapitalize","none"),_c(s,"autocomplete","off"),_c(s,"spellcheck","true"),_c(s,"aria-expanded",a=!(!e[4]||!e[1].length)),_c(s,"aria-controls","search-results"),_c(s,"aria-owns","search-results"),_c(s,"aria-describedby","search-description"),_c(s,"aria-autocomplete","list"),_c(s,"aria-activedescendant",l=e[26]?`emo-${e[26]}`:""),_c(c,"class","sr-only"),_c(c,"for","search"),_c(u,"id","search-description"),_c(u,"class","sr-only"),_c(i,"class","search-wrapper"),_c(m,"id","skintone-button"),_c(m,"class",f="emoji "+(e[6]?"hide-focus":"")),_c(m,"aria-label",e[23]),_c(m,"title",e[23]),_c(m,"aria-describedby","skintone-description"),_c(m,"aria-haspopup","listbox"),_c(m,"aria-expanded",e[6]),_c(m,"aria-controls","skintone-list"),_c(p,"class",y="skintone-button-wrapper "+(e[19]?"expanded":"")),_c(v,"id","skintone-description"),_c(v,"class","sr-only"),_c(w,"id","skintone-list"),_c(w,"class",S="skintone-list "+(e[6]?"":"hidden no-animate")),Ec(w,"transform","translateY("+(e[6]?0:"calc(-1 * var(--num-skintones) * var(--total-emoji-size))")+")"),_c(w,"role","listbox"),_c(w,"aria-label",_=e[0].skinTonesLabel),_c(w,"aria-activedescendant",k="skintone-"+e[20]),_c(w,"aria-hidden",x=!e[6]),_c(r,"class","search-row"),_c(E,"class","nav"),_c(E,"role","tablist"),Ec(E,"grid-template-columns","repeat("+e[12].length+", 1fr)"),_c(E,"aria-label",T=e[0].categoriesLabel),_c(A,"class","indicator"),Ec(A,"transform","translateX("+(e[24]?-1:1)*e[11]*100+"%)"),_c(C,"class","indicator-wrapper"),_c(I,"class",O="message "+(e[18]?"":"gone")),_c(I,"role","alert"),_c(I,"aria-live","polite"),_c(P,"class",D="tabpanel "+(!e[14]||e[18]?"gone":"")),_c(P,"role",L=e[4]?"region":"tabpanel"),_c(P,"aria-label",F=e[4]?e[0].searchResultsLabel:e[0].categories[e[13].name]),_c(P,"id",N=e[4]?"":`tab-${e[13].id}`),_c(P,"tabindex","0"),_c(j,"class",U="favorites emoji-menu "+(e[18]?"gone":"")),_c(j,"role","menu"),_c(j,"aria-label",B=e[0].favoritesLabel),Ec(j,"padding-inline-end",e[25]+"px"),_c(q,"aria-hidden","true"),_c(q,"tabindex","-1"),_c(q,"class","abs-pos hidden emoji"),_c(t,"class","picker"),_c(t,"aria-label",K=e[0].regionLabel),_c(t,"style",e[22])},m(o,a){yc(o,t,a),fc(t,n),fc(t,r),fc(r,i),fc(i,s),xc(s,e[2]),fc(i,c),fc(c,d),fc(i,u),fc(u,h),fc(r,p),fc(p,m),fc(m,g),fc(r,v),fc(v,b),fc(r,w);for(let e=0;e<G.length;e+=1)G[e].m(w,null);e[48](w),fc(t,E);for(let e=0;e<X.length;e+=1)X[e].m(E,null);fc(t,C),fc(C,A),fc(t,I),fc(I,R),fc(t,P),fc(P,M);for(let e=0;e<J.length;e+=1)J[e].m(M,null);e[50](P),fc(t,j);for(let e=0;e<ee.length;e+=1)ee[e].m(j,null);var l;fc(t,q),e[51](q),e[52](t),z||($=[Sc(s,"input",e[47]),Sc(s,"keydown",e[30]),Sc(m,"click",e[35]),Sc(w,"focusout",e[38]),Sc(w,"click",e[34]),Sc(w,"keydown",e[36]),Sc(w,"keyup",e[37]),Sc(E,"keydown",e[32]),(l=e[29].call(null,M),l&&uc(l.destroy)?l.destroy:ac),Sc(P,"click",e[33]),Sc(j,"click",e[33])],z=!0)},p(e,n){1&n[0]&&o!==(o=e[0].searchLabel)&&_c(s,"placeholder",o),18&n[0]&&a!==(a=!(!e[4]||!e[1].length))&&_c(s,"aria-expanded",a),67108864&n[0]&&l!==(l=e[26]?`emo-${e[26]}`:"")&&_c(s,"aria-activedescendant",l),4&n[0]&&xc(s,e[2]),1&n[0]&&V!==(V=e[0].searchLabel+"")&&kc(d,V),1&n[0]&&H!==(H=e[0].searchDescription+"")&&kc(h,H),2097152&n[0]&&kc(g,e[21]),64&n[0]&&f!==(f="emoji "+(e[6]?"hide-focus":""))&&_c(m,"class",f),8388608&n[0]&&_c(m,"aria-label",e[23]),8388608&n[0]&&_c(m,"title",e[23]),64&n[0]&&_c(m,"aria-expanded",e[6]),524288&n[0]&&y!==(y="skintone-button-wrapper "+(e[19]?"expanded":""))&&_c(p,"class",y),1&n[0]&&W!==(W=e[0].skinToneDescription+"")&&kc(b,W),1049089&n[0]&&(ne=e[9],G=zc(G,n,re,1,e,ne,Y,w,Kc,fd,null,gd)),64&n[0]&&S!==(S="skintone-list "+(e[6]?"":"hidden no-animate"))&&_c(w,"class",S),64&n[0]&&Ec(w,"transform","translateY("+(e[6]?0:"calc(-1 * var(--num-skintones) * var(--total-emoji-size))")+")"),1&n[0]&&_!==(_=e[0].skinTonesLabel)&&_c(w,"aria-label",_),1048576&n[0]&&k!==(k="skintone-"+e[20])&&_c(w,"aria-activedescendant",k),64&n[0]&&x!==(x=!e[6])&&_c(w,"aria-hidden",x),12305&n[0]|1&n[1]&&(ie=e[12],X=zc(X,n,se,1,e,ie,Z,E,Kc,yd,null,md)),4096&n[0]&&Ec(E,"grid-template-columns","repeat("+e[12].length+", 1fr)"),1&n[0]&&T!==(T=e[0].categoriesLabel)&&_c(E,"aria-label",T),16779264&n[0]&&Ec(A,"transform","translateX("+(e[24]?-1:1)*e[11]*100+"%)"),262144&n[0]&&kc(R,e[18]),262144&n[0]&&O!==(O="message "+(e[18]?"":"gone"))&&_c(I,"class",O),402694449&n[0]&&(oe=e[15],J=zc(J,n,ae,1,e,oe,Q,M,Kc,Sd,null,hd)),278528&n[0]&&D!==(D="tabpanel "+(!e[14]||e[18]?"gone":""))&&_c(P,"class",D),16&n[0]&&L!==(L=e[4]?"region":"tabpanel")&&_c(P,"role",L),8209&n[0]&&F!==(F=e[4]?e[0].searchResultsLabel:e[0].categories[e[13].name])&&_c(P,"aria-label",F),8208&n[0]&&N!==(N=e[4]?"":`tab-${e[13].id}`)&&_c(P,"id",N),402654464&n[0]&&(le=e[10],ee=zc(ee,n,ce,1,e,le,te,j,Kc,xd,null,ud)),262144&n[0]&&U!==(U="favorites emoji-menu "+(e[18]?"gone":""))&&_c(j,"class",U),1&n[0]&&B!==(B=e[0].favoritesLabel)&&_c(j,"aria-label",B),33554432&n[0]&&Ec(j,"padding-inline-end",e[25]+"px"),1&n[0]&&K!==(K=e[0].regionLabel)&&_c(t,"aria-label",K),4194304&n[0]&&_c(t,"style",e[22])},i:ac,o:ac,d(n){n&&vc(t);for(let e=0;e<G.length;e+=1)G[e].d();e[48](null);for(let e=0;e<X.length;e+=1)X[e].d();for(let e=0;e<J.length;e+=1)J[e].d();e[50](null);for(let e=0;e<ee.length;e+=1)ee[e].d();e[51](null),e[52](null),z=!1,dc($)}}}function Td(e,t,n){let r,i,s,o,a,l,c,d,u,h,{skinToneEmoji:p}=t,{i18n:m}=t,{database:g}=t,{customEmoji:f}=t,{customCategorySorting:y}=t,v=[],b=[],w="",S="",_=!1,k=-1,x=!1,E=!1,T=0,C=0,A="",I=[],R=[],O=8,P=!1,M=0,D=0,L=Vc,F=!1;const N=e=>{r.getRootNode().getElementById(e).focus()},j=(e,t)=>{r.dispatchEvent(new CustomEvent(e,{detail:t,bubbles:!0,composed:!0}))},U=(e,t)=>t&&e.skins&&e.skins[t]||e.unicode,B=e=>/^skintone-/.test(e.id);function q(e){return!e.unicode||!Gc(e)||nd.get(e.unicode)}async function K(e){const t=await td;return e.filter((({version:e})=>!e||e<=t))}async function z(e){return function(e,t){const n=e=>{const n={};for(const r of e)"number"==typeof r.tone&&r.version<=t&&(n[r.tone]=r.unicode);return n};return e.map((({unicode:e,skins:t,shortcodes:r,url:i,name:s,category:o})=>({unicode:e,name:s,shortcodes:r,url:i,category:o,id:e||s,skins:t&&n(t),title:(r||[]).join(", ")})))}(e,await td)}function $(e){n(2,w=""),n(44,S=""),n(5,k=-1),n(11,D=L.findIndex((t=>t.id===e.id)))}async function V(e){const t=await g.getEmojiByUnicodeOrName(e),n=[...v,...R].find((t=>t.id===e)),r=n.unicode&&U(n,T);await g.incrementFavoriteEmojiCount(e),j("emoji-click",{emoji:t,skinTone:T,...r&&{unicode:r},...n.name&&{name:n.name}})}async function H(e){const{target:t}=e;if(!B(t))return;rd(e);const r=parseInt(t.id.slice(9),10);n(8,T=r),n(6,x=!1),N("skintone-button"),j("skin-tone-change",{skinTone:r}),g.setPreferredSkinTone(r)}return td.then((e=>{e||n(18,o=m.emojiUnsupportedMessage)})),e.$$set=e=>{"skinToneEmoji"in e&&n(40,p=e.skinToneEmoji),"i18n"in e&&n(0,m=e.i18n),"database"in e&&n(39,g=e.database),"customEmoji"in e&&n(41,f=e.customEmoji),"customCategorySorting"in e&&n(42,y=e.customCategorySorting)},e.$$.update=()=>{if(1280&e.$$.dirty[1]&&f&&g&&n(39,g.customEmoji=f,g),1&e.$$.dirty[0]|256&e.$$.dirty[1]){async function e(){let e=!1;const t=setTimeout((()=>{e=!0,n(18,o=m.loadingMessage)}),1e3);try{await g.ready(),n(14,F=!0)}catch(e){console.error(e),n(18,o=m.networkErrorMessage)}finally{clearTimeout(t),e&&(e=!1,n(18,o=""))}}g&&e()}if(4096&e.$$.dirty[0]|1024&e.$$.dirty[1]&&(f&&f.length?n(12,L=[Hc,...Vc]):L!==Vc&&n(12,L=Vc)),4&e.$$.dirty[0]&&Wc((()=>{n(44,S=(w||"").trim()),n(5,k=-1)})),6144&e.$$.dirty[0]&&n(13,u=L[D]),24576&e.$$.dirty[0]|8192&e.$$.dirty[1]){async function e(){if(F){if(S.length>=2){const e=S,t=await async function(e){return z(await K(await g.getEmojiBySearchQuery(e)))}(e);e===S&&(n(1,v=t),n(4,_=!0))}else if(u){const e=u.id,t=await async function(e){if(void 0===e)return[];const t=-1===e?f:await g.getEmojiByGroup(e);return z(await K(t))}(e);e===u.id&&(n(1,v=t),n(4,_=!1))}}else n(1,v=[]),n(4,_=!1)}e()}if(4112&e.$$.dirty[0]&&n(22,c=`\n  --font-family: ${Zc};\n  --num-groups: ${L.length}; \n  --indicator-opacity: ${_?0:1}; \n  --num-skintones: 6;`),16384&e.$$.dirty[0]|256&e.$$.dirty[1]){async function e(){F&&n(8,T=await g.getPreferredSkinTone())}e()}if(512&e.$$.dirty[1]&&n(9,I=Array(6).fill().map(((e,t)=>function(e,t){if(0===t)return e;const n=e.indexOf("");return-1!==n?e.substring(0,n)+String.fromCodePoint(127995+t-1)+e.substring(n):(e.endsWith("")&&(e=e.substring(0,e.length-1)),e+"\ud83c"+String.fromCodePoint(57339+t-1))}(p,t)))),768&e.$$.dirty[0]&&n(21,l=I[T]),257&e.$$.dirty[0]&&n(23,A=m.skinToneLabel.replace("{skinTone}",m.skinTones[T])),16384&e.$$.dirty[0]|256&e.$$.dirty[1]){async function e(){n(45,d=(await Promise.all(Xc.map((e=>g.getEmojiByUnicodeOrName(e))))).filter(Boolean))}F&&e()}if(16384&e.$$.dirty[0]|49408&e.$$.dirty[1]){async function e(){const e=await g.getTopFavoriteEmoji(O),t=await z(sd([...e,...d],(e=>e.unicode||e.name)).slice(0,O));n(10,R=t)}F&&d&&e()}if(10&e.$$.dirty[0]){const e=v.filter((e=>e.unicode)).filter((e=>Gc(e)&&!nd.has(e.unicode)));e.length?od((()=>function(e){const t=r.getRootNode();!function(e,t,n){for(const r of e){const e=cd(n(r));void 0===ad&&(ad=cd(t));const i=e/1.8<ad;nd.set(r.unicode,i)}}(e,i,(e=>t.getElementById(`emo-${e.id}`))),n(1,v=v)}(e))):(n(1,v=v.filter(q)),od((()=>{(s||{}).scrollTop=0})))}if(e.$$.dirty[0],e.$$.dirty[1],18&e.$$.dirty[0]|2048&e.$$.dirty[1]){function e(){if(_)return[{category:"",emojis:v}];const e=new Map;for(const t of v){const n=t.category||"";let r=e.get(n);r||(r=[],e.set(n,r)),r.push(t)}return[...e.entries()].map((([e,t])=>({category:e,emojis:t}))).sort(((e,t)=>y(e.category,t.category)))}n(15,b=e())}34&e.$$.dirty[0]&&n(26,h=-1!==k&&v[k].id),192&e.$$.dirty[0]&&(x?a.addEventListener("transitionend",(()=>{n(19,E=!0)}),{once:!0}):n(19,E=!1))},[m,v,w,s,_,k,x,a,T,I,R,D,L,u,F,b,r,i,o,E,C,l,c,A,P,M,h,U,(e,t)=>{return(n=[e.name||U(e,t),...e.shortcodes||[]],sd(n,(e=>e))).join(", ");var n},function(e){return function(e,t){let n;return ld?(n=new ResizeObserver((e=>t(e[0].contentRect.width))),n.observe(e)):od((()=>t(e.getBoundingClientRect().width))),{destroy(){n&&n.disconnect()}}}(e,(t=>{{const i=getComputedStyle(r),s=parseInt(i.getPropertyValue("--num-columns"),10),o="rtl"===i.getPropertyValue("direction"),a=e.parentElement.getBoundingClientRect().width-t;n(46,O=s),n(25,M=a),n(24,P=o)}}))},function(e){if(!_||!v.length)return;const t=t=>{rd(e),n(5,k=id(t,k,v))};switch(e.key){case"ArrowDown":return t(!1);case"ArrowUp":return t(!0);case"Enter":if(-1!==k)return rd(e),V(v[k].id);v.length&&n(5,k=0)}},$,function(e){const{target:t,key:n}=e,r=t=>{t&&(rd(e),t.focus())};switch(n){case"ArrowLeft":return r(t.previousSibling);case"ArrowRight":return r(t.nextSibling);case"Home":return r(t.parentElement.firstChild);case"End":return r(t.parentElement.lastChild)}},async function(e){const{target:t}=e;t.classList.contains("emoji")&&(rd(e),V(t.id.substring(4)))},H,async function(e){n(6,x=!x),n(20,C=T),x&&(rd(e),od((()=>N(`skintone-${C}`))))},function(e){if(!x)return;const t=async t=>{rd(e),n(20,C=t),await(Mc(),Oc),N(`skintone-${C}`)};switch(e.key){case"ArrowUp":return t(id(!0,C,I));case"ArrowDown":return t(id(!1,C,I));case"Home":return t(0);case"End":return t(I.length-1);case"Enter":return H(e);case"Escape":return rd(e),n(6,x=!1),N("skintone-button")}},function(e){if(x)return" "===e.key?H(e):void 0},async function(e){const{relatedTarget:t}=e;t&&B(t)||n(6,x=!1)},g,p,f,y,!0,S,d,O,function(){w=this.value,n(2,w)},function(e){Ac[e?"unshift":"push"]((()=>{a=e,n(7,a)}))},e=>$(e),function(e){Ac[e?"unshift":"push"]((()=>{s=e,n(3,s)}))},function(e){Ac[e?"unshift":"push"]((()=>{i=e,n(17,i)}))},function(e){Ac[e?"unshift":"push"]((()=>{r=e,n(16,r)}))}]}class Cd extends class{$destroy(){!function(e,t){const n=e.$$;null!==n.fragment&&(dc(n.on_destroy),n.fragment&&n.fragment.d(1),n.on_destroy=n.fragment=null,n.ctx=[])}(this),this.$destroy=ac}$on(e,t){const n=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return n.push(t),()=>{const e=n.indexOf(t);-1!==e&&n.splice(e,1)}}$set(e){var t;this.$$set&&(t=e,0!==Object.keys(t).length)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}}{constructor(e){super(),function(e,t,n,r,i,s,o,a=[-1]){const l=mc;Tc(e);const c=e.$$={fragment:null,ctx:null,props:s,update:ac,not_equal:i,bound:cc(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(l?l.$$.context:t.context||[]),callbacks:cc(),dirty:a,skip_bound:!1,root:t.target||l.$$.root};o&&o(c.root);let d=!1;c.ctx=n?n(e,t.props||{},((t,n,...r)=>{const s=r.length?r[0]:n;return c.ctx&&i(c.ctx[t],c.ctx[t]=s)&&(!c.skip_bound&&c.bound[t]&&c.bound[t](s),d&&function(e,t){-1===e.$$.dirty[0]&&(Cc.push(e),Mc(),e.$$.dirty.fill(0)),e.$$.dirty[t/31|0]|=1<<t%31}(e,t)),n})):[],c.update(),d=!0,dc(c.before_update),c.fragment=!!r&&r(c.ctx),t.target&&(c.fragment&&c.fragment.c(),t.intro&&Bc(e.$$.fragment),function(e,t,n,r){const{fragment:i,on_mount:s,on_destroy:o,after_update:a}=e.$$;i&&i.m(t,n),r||Dc((()=>{const t=s.map(lc).filter(uc);o?o.push(...t):dc(t),e.$$.on_mount=[]})),a.forEach(Dc)}(e,t.target,t.anchor,t.customElement),Nc()),Tc(l)}(this,e,Td,Ed,hc,{skinToneEmoji:40,i18n:0,database:39,customEmoji:41,customCategorySorting:42},null,[-1,-1,-1])}}var Ad={categoriesLabel:"Categories",emojiUnsupportedMessage:"Your browser does not support color emoji.",favoritesLabel:"Favorites",loadingMessage:"Loading",networkErrorMessage:"Could not load emoji.",regionLabel:"Emoji picker",searchDescription:"When search results are available, press up or down to select and enter to choose.",searchLabel:"Search",searchResultsLabel:"Search results",skinToneDescription:"When expanded, press up or down to select and enter to choose.",skinToneLabel:"Choose a skin tone (currently {skinTone})",skinTonesLabel:"Skin tones",skinTones:["Default","Light","Medium-Light","Medium","Medium-Dark","Dark"],categories:{custom:"Custom","smileys-emotion":"Smileys and emoticons","people-body":"People and body","animals-nature":"Animals and nature","food-drink":"Food and drink","travel-places":"Travel and places",activities:"Activities",objects:"Objects",symbols:"Symbols",flags:"Flags"}};const Id=["customEmoji","customCategorySorting","database","dataSource","i18n","locale","skinToneEmoji"];class Rd extends HTMLElement{constructor(e){super(),this.attachShadow({mode:"open"});const t=document.createElement("style");t.textContent=":host{--emoji-size:1.375rem;--emoji-padding:0.5rem;--category-emoji-size:var(--emoji-size);--category-emoji-padding:var(--emoji-padding);--indicator-height:3px;--input-border-radius:0.5rem;--input-border-size:1px;--input-font-size:1rem;--input-line-height:1.5;--input-padding:0.25rem;--num-columns:8;--outline-size:2px;--border-size:1px;--skintone-border-radius:1rem;--category-font-size:1rem;display:flex;width:min-content;height:400px}:host,:host(.light){--background:#fff;--border-color:#e0e0e0;--indicator-color:#385ac1;--input-border-color:#999;--input-font-color:#111;--input-placeholder-color:#999;--outline-color:#999;--category-font-color:#111;--button-active-background:#e6e6e6;--button-hover-background:#d9d9d9}:host(.dark){--background:#222;--border-color:#444;--indicator-color:#5373ec;--input-border-color:#ccc;--input-font-color:#efefef;--input-placeholder-color:#ccc;--outline-color:#fff;--category-font-color:#efefef;--button-active-background:#555555;--button-hover-background:#484848}@media (prefers-color-scheme:dark){:host{--background:#222;--border-color:#444;--indicator-color:#5373ec;--input-border-color:#ccc;--input-font-color:#efefef;--input-placeholder-color:#ccc;--outline-color:#fff;--category-font-color:#efefef;--button-active-background:#555555;--button-hover-background:#484848}}:host([hidden]){display:none}button{margin:0;padding:0;border:0;background:0 0;box-shadow:none;-webkit-tap-highlight-color:transparent}button::-moz-focus-inner{border:0}input{padding:0;margin:0;line-height:1.15;font-family:inherit}input[type=search]{-webkit-appearance:none}:focus{outline:var(--outline-color) solid var(--outline-size);outline-offset:calc(-1*var(--outline-size))}:host([data-js-focus-visible]) :focus:not([data-focus-visible-added]){outline:0}:focus:not(:focus-visible){outline:0}.hide-focus{outline:0}*{box-sizing:border-box}.picker{contain:content;display:flex;flex-direction:column;background:var(--background);border:var(--border-size) solid var(--border-color);width:100%;height:100%;overflow:hidden;--total-emoji-size:calc(var(--emoji-size) + (2 * var(--emoji-padding)));--total-category-emoji-size:calc(var(--category-emoji-size) + (2 * var(--category-emoji-padding)))}.sr-only{position:absolute;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0,0,0,0);border:0}.hidden{opacity:0;pointer-events:none}.abs-pos{position:absolute;left:0;top:0}.gone{display:none!important}.skintone-button-wrapper,.skintone-list{background:var(--background);z-index:3}.skintone-button-wrapper.expanded{z-index:1}.skintone-list{position:absolute;inset-inline-end:0;top:0;z-index:2;overflow:visible;border-bottom:var(--border-size) solid var(--border-color);border-radius:0 0 var(--skintone-border-radius) var(--skintone-border-radius);will-change:transform;transition:transform .2s ease-in-out;transform-origin:center 0}@media (prefers-reduced-motion:reduce){.skintone-list{transition-duration:.001s}}@supports not (inset-inline-end:0){.skintone-list{right:0}}.skintone-list.no-animate{transition:none}.tabpanel{overflow-y:auto;-webkit-overflow-scrolling:touch;will-change:transform;min-height:0;flex:1;contain:content}.emoji-menu{display:grid;grid-template-columns:repeat(var(--num-columns),var(--total-emoji-size));justify-content:space-around;align-items:flex-start;width:100%}.category{padding:var(--emoji-padding);font-size:var(--category-font-size);color:var(--category-font-color)}.custom-emoji,.emoji,button.emoji{height:var(--total-emoji-size);width:var(--total-emoji-size)}.emoji,button.emoji{font-size:var(--emoji-size);display:flex;align-items:center;justify-content:center;border-radius:100%;line-height:1;overflow:hidden;font-family:var(--font-family);cursor:pointer}@media (hover:hover)and (pointer:fine){.emoji:hover,button.emoji:hover{background:var(--button-hover-background)}}.emoji.active,.emoji:active,button.emoji.active,button.emoji:active{background:var(--button-active-background)}.custom-emoji{padding:var(--emoji-padding);object-fit:contain;pointer-events:none;background-repeat:no-repeat;background-position:center center;background-size:var(--emoji-size) var(--emoji-size)}.nav,.nav-button{align-items:center}.nav{display:grid;justify-content:space-between;contain:content}.nav-button{display:flex;justify-content:center}.nav-emoji{font-size:var(--category-emoji-size);width:var(--total-category-emoji-size);height:var(--total-category-emoji-size)}.indicator-wrapper{display:flex;border-bottom:1px solid var(--border-color)}.indicator{width:calc(100%/var(--num-groups));height:var(--indicator-height);opacity:var(--indicator-opacity);background-color:var(--indicator-color);will-change:transform,opacity;transition:opacity .1s linear,transform .25s ease-in-out}@media (prefers-reduced-motion:reduce){.indicator{will-change:opacity;transition:opacity .1s linear}}.pad-top,input.search{background:var(--background);width:100%}.pad-top{height:var(--emoji-padding);z-index:3}.search-row{display:flex;align-items:center;position:relative;padding-inline-start:var(--emoji-padding);padding-bottom:var(--emoji-padding)}.search-wrapper{flex:1;min-width:0}input.search{padding:var(--input-padding);border-radius:var(--input-border-radius);border:var(--input-border-size) solid var(--input-border-color);color:var(--input-font-color);font-size:var(--input-font-size);line-height:var(--input-line-height)}input.search::placeholder{color:var(--input-placeholder-color)}.favorites{display:flex;flex-direction:row;border-top:var(--border-size) solid var(--border-color);contain:content}.message{padding:var(--emoji-padding)}",this.shadowRoot.appendChild(t),this._ctx={locale:"en",dataSource:"https://cdn.jsdelivr.net/npm/emoji-picker-element-data@^1/en/emojibase/data.json",skinToneEmoji:"",customCategorySorting:Jc,customEmoji:null,i18n:Ad,...e};for(const e of Id)"database"!==e&&Object.prototype.hasOwnProperty.call(this,e)&&(this._ctx[e]=this[e],delete this[e]);this._dbFlush()}connectedCallback(){this._cmp=new Cd({target:this.shadowRoot,props:this._ctx})}disconnectedCallback(){this._cmp.$destroy(),this._cmp=void 0;const{database:e}=this._ctx;e&&e.close().catch((e=>console.error(e)))}static get observedAttributes(){return["locale","data-source","skin-tone-emoji"]}attributeChangedCallback(e,t,n){this._set(e.replace(/-([a-z])/g,((e,t)=>t.toUpperCase())),n)}_set(e,t){this._ctx[e]=t,this._cmp&&this._cmp.$set({[e]:t}),["locale","dataSource"].includes(e)&&this._dbFlush()}_dbCreate(){const{locale:e,dataSource:t,database:n}=this._ctx;n&&n.locale===e&&n.dataSource===t||this._set("database",new oc({locale:e,dataSource:t}))}_dbFlush(){Promise.resolve().then((()=>this._dbCreate()))}}const Od={};for(const e of Id)Od[e]={get(){return"database"===e&&this._dbCreate(),this._ctx[e]},set(t){if("database"===e)throw new Error("database is read-only");this._set(e,t)}};Object.defineProperties(Rd.prototype,Od),customElements.define("emoji-picker",Rd);var Pd=__webpack_require__(8244),Md={};function Dd(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}Md.styleTagTransform=Ie(),Md.setAttributes=Ee(),Md.insert=ke().bind(null,"head"),Md.domAPI=Se(),Md.insertStyleElement=Ce(),be()(Pd.Z,Md),Pd.Z&&Pd.Z.locals&&Pd.Z.locals;class Ld extends g{constructor(...e){super(...e),Dd(this,"cancel",(e=>this.setState({active:null}))),Dd(this,"handleInput",(e=>this.props.actions[e.data]?this.setState({active:this.props.actions[e.data]}):null)),Dd(this,"insert",((e,t)=>{const n=this.props.textarea.current.selectionStart,r=this.props.textarea.current.selectionEnd;if(n===r){const n=this.props.textValue.slice(0,r),i=this.props.textValue.slice(r),s=n.replace(t,e);this.props.setTextValue(`${s}${i}`,(e=>{this.props.textarea.current.focus(),this.props.textarea.current.selectionEnd=s.length}))}this.cancel()}))}componentDidMount(){this.props.textarea&&(this.props.textarea.current.addEventListener("input",this.handleInput),this.props.textarea.current.addEventListener("click",this.cancel),this.props.textarea.current.addEventListener("blur",this.cancel))}componentWillUnmount(){this.props.textarea&&(this.props.textarea.current.removeEventListener("input",this.handleInput),this.props.textarea.current.removeEventListener("click",this.cancel),this.props.textarea.current.removeEventListener("blur",this.cancel))}render(e,t){if(t.active)return t.active({insert:this.insert,cancel:this.cancel,textarea:e.textarea,textValue:e.textValue})}}class Fd extends g{constructor(e){super(e),Dd(this,"handleKeydown",(e=>{"ArrowDown"===e.key&&(e.preventDefault(),this.state.selection+1<this.state.popupItems.length&&this.setState((e=>({selection:e.selection+1})))),"ArrowUp"===e.key&&(e.preventDefault(),this.state.selection>0&&this.setState((e=>({selection:e.selection-1})))),("Enter"===e.key||":"===e.key)&&this.state.popupItems.length>0&&(e.preventDefault(),this.insertSelection())})),Dd(this,"handleKeyup",(e=>{const t=this.props.textarea.current.selectionStart,n=this.props.textarea.current.selectionEnd;if(t===n){const e=this.props.textValue.slice(0,n).match(/:\S*$/);if(e){const t=e[0].slice(1);return t.length<2?this.setState({popupItems:[]}):void this.database.getEmojiBySearchQuery(t).then((e=>{this.setState({popupItems:e.filter((e=>e.version<13)).sort(((e,n)=>e.shortcodes[0]===t?-1:n.shortcodes[0]===t?1:e.shortcodes[0].includes(t)?n.shortcodes[0].includes(t)?0:-1:n.shortcodes[0].includes(t)?1:0)).slice(0,3).map(((e,t)=>h(Nd,{key:e.unicode,emoji:e,insert:this.props.insert,selected:this.state.selection===t})))})}))}}this.props.cancel()})),Dd(this,"insertSelection",(e=>{const t=this.state.popupItems[this.state.selection].props.emoji.unicode;this.props.insert(t,/:\S*$/)})),this.state={popupItems:[],selection:0},this.database=new oc}componentDidMount(){this.props.textarea&&(this.props.textarea.current.addEventListener("keydown",this.handleKeydown),this.props.textarea.current.addEventListener("keyup",this.handleKeyup))}componentWillUnmount(){this.props.textarea&&(this.props.textarea.current.removeEventListener("keydown",this.handleKeydown),this.props.textarea.current.removeEventListener("keyup",this.handleKeyup))}render(e,t){if(this.state.popupItems.length>0)return h("div",{style:{top:40*t.popupItems.length+"px"},id:"popup-wrapper"},h("div",{id:"popup-menu"},this.state.popupItems))}}class Nd extends g{constructor(...e){super(...e),Dd(this,"insertEmoji",(e=>{e.preventDefault(),this.props.insert(this.props.emoji.unicode,/:\S*$/)}))}render(e){return h("div",{onmousedown:this.insertEmoji,class:e.selected?"popup-menu-item-selected-emoji popup-menu-item":"popup-menu-item"},h("span",{class:"popup-menu-item-emojishortcode"}," :",e.emoji.shortcodes[0],": "),h("span",null,""),h("span",{class:"popup-menu-item-emojiglyph"}," ",e.emoji.unicode," "))}}class jd extends g{constructor(e){super(e),Dd(this,"handleKeydown",(e=>{"ArrowDown"===e.key&&(e.preventDefault(),this.state.selection+1<this.state.popupItems.length&&this.setState((e=>({selection:e.selection+1})))),"ArrowUp"===e.key&&(e.preventDefault(),this.state.selection>0&&this.setState((e=>({selection:e.selection-1})))),"Enter"===e.key&&this.state.popupItems.length>0&&(e.preventDefault(),this.insertSelection())})),Dd(this,"insertSelection",(e=>{const t=this.state.popupItems[this.state.selection].props.member.userId;this.props.insert(`${t} `,/@\S*$/)})),Dd(this,"handleKeyup",(e=>{const t=this.props.textarea.current.selectionStart,n=this.props.textarea.current.selectionEnd;if(t===n){const e=this.props.textValue.slice(0,n).match(/@\S*$/);if(e){const t=this.generatePopupItems(e[0].substring(1)),n={popupItems:t};return t.length<this.state.selection+1&&(n.selection=Math.max(t.length-1,0)),void this.setState(n)}}this.props.cancel()})),this.state={popupItems:[],selection:0}}componentDidMount(){this.props.textarea&&(this.props.textarea.current.addEventListener("keydown",this.handleKeydown),this.props.textarea.current.addEventListener("keyup",this.handleKeyup))}componentWillUnmount(){this.props.textarea&&(this.props.textarea.current.removeEventListener("keydown",this.handleKeydown),this.props.textarea.current.removeEventListener("keyup",this.handleKeyup))}generatePopupItems(e){const t=Ye.client.getRoom(this.props.roomId);return t?t.getMembersWithMembership("join").filter((t=>t.userId.includes(e)||t.name.includes(e))).slice(0,3).map(((e,t)=>h(Ud,{insert:this.props.insert,key:e.userId,selected:this.state.selection===t,member:e}))):[]}render(e,t){if(this.state.popupItems.length>0)return h("div",{style:{top:40*t.popupItems.length+"px"},id:"popup-wrapper"},h("div",{id:"popup-menu"},this.state.popupItems))}}class Ud extends g{constructor(...e){super(...e),Dd(this,"colorFromId",new fe(this.props.member.userId)),Dd(this,"insertUserId",(e=>{e.preventDefault(),this.props.insert(`${this.props.member.userId} `,/@\S*$/)}))}render(e){return h("div",{onmousedown:this.insertUserId,style:this.colorFromId.styleVariables,class:e.selected?"popup-menu-item-selected-user popup-menu-item":"popup-menu-item"},h("span",{class:"popup-menu-item-userid"}," @",e.member.userId.split(":")[0].substring(1)," "),h("span",null,""),h("span",{class:"popup-menu-item-username"}," ",e.member.name," "))}}class Bd extends g{constructor(e){super(e),Dd(this,"handleKeydown",(e=>{"ArrowDown"===e.key&&(e.preventDefault(),this.state.selection+1<this.state.popupItems.length&&this.setState((e=>({selection:e.selection+1})))),"ArrowUp"===e.key&&(e.preventDefault(),this.state.selection>0&&this.setState((e=>({selection:e.selection-1})))),"Enter"===e.key&&this.state.popupItems.length>0&&(e.preventDefault(),this.insertSelection())})),Dd(this,"insertSelection",(e=>{const t=this.state.popupItems[this.state.selection].props.flag.keyword;this.props.insert(`~${t} `,/~\S*$/)})),Dd(this,"handleKeyup",(e=>{const t=this.props.textarea.current.selectionStart,n=this.props.textarea.current.selectionEnd;if(t===n){const e=this.props.textValue.slice(0,n).match(/~\S*$/);if(e){const t=this.generatePopupItems(e[0].substring(1)),n={popupItems:t};return t.length<this.state.selection+1&&(n.selection=Math.max(t.length-1,0)),void this.setState(n)}}this.props.cancel()})),this.state={popupItems:[],selection:0}}componentDidMount(){this.props.textarea&&(this.props.textarea.current.addEventListener("keydown",this.handleKeydown),this.props.textarea.current.addEventListener("keyup",this.handleKeyup))}componentWillUnmount(){this.props.textarea&&(this.props.textarea.current.removeEventListener("keydown",this.handleKeydown),this.props.textarea.current.removeEventListener("keyup",this.handleKeyup))}generatePopupItems(e){return this.props.flags.filter((t=>t.keyword.includes(e))).slice(0,3).map(((e,t)=>h(qd,{insert:this.props.insert,key:e.keyword,selected:this.state.selection===t,flag:e})))}render(e,t){if(this.state.popupItems.length>0)return h("div",{style:{top:40*t.popupItems.length+"px"},id:"popup-wrapper"},h("div",{id:"popup-menu"},this.state.popupItems))}}class qd extends g{constructor(...e){super(...e),Dd(this,"insertFlag",(e=>{e.preventDefault(),this.props.insert(`~${this.props.flag.keyword} `,/~\S*$/)}))}render(e){return h("div",{onmousedown:this.insertFlag,class:e.selected?"popup-menu-item-selected-flag popup-menu-item":"popup-menu-item"},h("span",{class:"popup-menu-item-flag"}," ~",e.flag.keyword," "),h("span",null,""),h("span",{class:"popup-menu-item-flag-description"}," ",e.flag.description," "))}}function Kd(e){return!(!e["m.relates_to"]||!e["m.relates_to"]["m.in_reply_to"])}function zd(e){for(;e.length&&e[0].startsWith("> ");)e.shift();""===e[0]&&e.shift()}function $d(e){const t=e.trim().split("\n");for(;t.length&&t[0].startsWith("> ");)t.shift();return""===t[0]&&t.shift(),t.join("\n")}function Vd(e){let t;const n=e.getSender();switch(e.getContent().msgtype){case"m.file":t=["sent a file"];break;case"m.audio":t=["sent an audio file"];break;case"m.video":t=["sent a video"];break;default:t=e.getContent().body.trim().split("\n"),Kd(e.getContent())&&zd(t)}return t.length>0&&(t[0]=`<${n}> ${t[0]}`),`${t.map((e=>`> ${e}`)).join("\n")}\n\n`}function Hd(e){let t;const n=e.getSender();switch(e.getContent().msgtype){case"m.file":t="sent a file";break;case"m.audio":t="sent an audio file";break;case"m.video":t="sent a video";break;default:{const n=e.getContent().formatted_body||e.getContent().body.replace(/\n/g,"<br>");t=Sr()(n,Yd)}}return`<mx-reply><blockquote><a href="https://matrix.to/#/${e.getRoomId()}/${e.getId()}">In reply to</a> <a href="https://matrix.to/#/${n}">${n}</a><br>${t}</blockquote></mx-reply>`}function Wd(e){const t=e.formatted_body;if(!t)return"";const n=(new DOMParser).parseFromString(t,"text/html").body,r=n.querySelector("mx-reply > blockquote");return r?.removeChild(n.querySelector("a")),r?.removeChild(n.querySelector("a")),r?.removeChild(n.querySelector("br")),r?r.outerHTML:""}function Gd(e){const t=e.body.trim().split("\n");if(t.length>2&&t[0].startsWith("> <")){const e=[];for(const n of t){if(!n.startsWith("> "))break;e.push(n)}return`${e.join("\n")}\n\n`}return""}const Yd={allowedTags:!1,allowedAttributes:!1,allowedSchemes:["http","https","ftp","mailto","magnet","mxc"],exclusiveFilter:e=>"mx-reply"===e.tag},Xd=/\$(([^$]|\\\\$)*)\$/,Zd=/\$\$(([^$]|\\\\$)*)\$\$/,Jd=/@\S*:\S*/;function Qd(e){const t=new RegExp(`${Zd.source}|${Xd.source}|${Jd.source}`,"gm");return e.replaceAll(t,eu)}function eu(e){return Zd.test(e)?function(e){const t=document.createElement("div");return t.dataset.mxMaths=e,t.innerText=e,t.outerHTML}(e.match(Zd)[1]):Xd.test(e)?function(e){const t=document.createElement("span");return t.dataset.mxMaths=e,t.innerText=e,t.outerHTML}(e.match(Xd)[1]):Jd.test(e)?function(e){const t=Ye.client.getUser(e);if(!t)return e;const n=document.createElement("a");return n.href=`https://matrix.to/#/${t.userId}`,n.innerText=t.displayName||t.userId,n.outerHTML}(e):void 0}function tu(e){if(null==e)return window;if("[object Window]"!==e.toString()){var t=e.ownerDocument;return t&&t.defaultView||window}return e}function nu(e){return e instanceof tu(e).Element||e instanceof Element}function ru(e){return e instanceof tu(e).HTMLElement||e instanceof HTMLElement}function iu(e){return"undefined"!=typeof ShadowRoot&&(e instanceof tu(e).ShadowRoot||e instanceof ShadowRoot)}var su=Math.max,ou=Math.min,au=Math.round;function lu(e,t){void 0===t&&(t=!1);var n=e.getBoundingClientRect(),r=1,i=1;if(ru(e)&&t){var s=e.offsetHeight,o=e.offsetWidth;o>0&&(r=au(n.width)/o||1),s>0&&(i=au(n.height)/s||1)}return{width:n.width/r,height:n.height/i,top:n.top/i,right:n.right/r,bottom:n.bottom/i,left:n.left/r,x:n.left/r,y:n.top/i}}function cu(e){var t=tu(e);return{scrollLeft:t.pageXOffset,scrollTop:t.pageYOffset}}function du(e){return e?(e.nodeName||"").toLowerCase():null}function uu(e){return((nu(e)?e.ownerDocument:e.document)||window.document).documentElement}function hu(e){return lu(uu(e)).left+cu(e).scrollLeft}function pu(e){return tu(e).getComputedStyle(e)}function mu(e){var t=pu(e),n=t.overflow,r=t.overflowX,i=t.overflowY;return/auto|scroll|overlay|hidden/.test(n+i+r)}function gu(e,t,n){void 0===n&&(n=!1);var r,i,s=ru(t),o=ru(t)&&function(e){var t=e.getBoundingClientRect(),n=au(t.width)/e.offsetWidth||1,r=au(t.height)/e.offsetHeight||1;return 1!==n||1!==r}(t),a=uu(t),l=lu(e,o),c={scrollLeft:0,scrollTop:0},d={x:0,y:0};return(s||!s&&!n)&&(("body"!==du(t)||mu(a))&&(c=(r=t)!==tu(r)&&ru(r)?{scrollLeft:(i=r).scrollLeft,scrollTop:i.scrollTop}:cu(r)),ru(t)?((d=lu(t,!0)).x+=t.clientLeft,d.y+=t.clientTop):a&&(d.x=hu(a))),{x:l.left+c.scrollLeft-d.x,y:l.top+c.scrollTop-d.y,width:l.width,height:l.height}}function fu(e){var t=lu(e),n=e.offsetWidth,r=e.offsetHeight;return Math.abs(t.width-n)<=1&&(n=t.width),Math.abs(t.height-r)<=1&&(r=t.height),{x:e.offsetLeft,y:e.offsetTop,width:n,height:r}}function yu(e){return"html"===du(e)?e:e.assignedSlot||e.parentNode||(iu(e)?e.host:null)||uu(e)}function vu(e){return["html","body","#document"].indexOf(du(e))>=0?e.ownerDocument.body:ru(e)&&mu(e)?e:vu(yu(e))}function bu(e,t){var n;void 0===t&&(t=[]);var r=vu(e),i=r===(null==(n=e.ownerDocument)?void 0:n.body),s=tu(r),o=i?[s].concat(s.visualViewport||[],mu(r)?r:[]):r,a=t.concat(o);return i?a:a.concat(bu(yu(o)))}function wu(e){return["table","td","th"].indexOf(du(e))>=0}function Su(e){return ru(e)&&"fixed"!==pu(e).position?e.offsetParent:null}function _u(e){for(var t=tu(e),n=Su(e);n&&wu(n)&&"static"===pu(n).position;)n=Su(n);return n&&("html"===du(n)||"body"===du(n)&&"static"===pu(n).position)?t:n||function(e){var t=-1!==navigator.userAgent.toLowerCase().indexOf("firefox");if(-1!==navigator.userAgent.indexOf("Trident")&&ru(e)&&"fixed"===pu(e).position)return null;for(var n=yu(e);ru(n)&&["html","body"].indexOf(du(n))<0;){var r=pu(n);if("none"!==r.transform||"none"!==r.perspective||"paint"===r.contain||-1!==["transform","perspective"].indexOf(r.willChange)||t&&"filter"===r.willChange||t&&r.filter&&"none"!==r.filter)return n;n=n.parentNode}return null}(e)||t}var ku="top",xu="bottom",Eu="right",Tu="left",Cu="auto",Au=[ku,xu,Eu,Tu],Iu="start",Ru="end",Ou="viewport",Pu="popper",Mu=Au.reduce((function(e,t){return e.concat([t+"-"+Iu,t+"-"+Ru])}),[]),Du=[].concat(Au,[Cu]).reduce((function(e,t){return e.concat([t,t+"-"+Iu,t+"-"+Ru])}),[]),Lu=["beforeRead","read","afterRead","beforeMain","main","afterMain","beforeWrite","write","afterWrite"];function Fu(e){var t=new Map,n=new Set,r=[];function i(e){n.add(e.name),[].concat(e.requires||[],e.requiresIfExists||[]).forEach((function(e){if(!n.has(e)){var r=t.get(e);r&&i(r)}})),r.push(e)}return e.forEach((function(e){t.set(e.name,e)})),e.forEach((function(e){n.has(e.name)||i(e)})),r}var Nu={placement:"bottom",modifiers:[],strategy:"absolute"};function ju(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return!t.some((function(e){return!(e&&"function"==typeof e.getBoundingClientRect)}))}function Uu(e){void 0===e&&(e={});var t=e,n=t.defaultModifiers,r=void 0===n?[]:n,i=t.defaultOptions,s=void 0===i?Nu:i;return function(e,t,n){void 0===n&&(n=s);var i,o,a={placement:"bottom",orderedModifiers:[],options:Object.assign({},Nu,s),modifiersData:{},elements:{reference:e,popper:t},attributes:{},styles:{}},l=[],c=!1,d={state:a,setOptions:function(n){var i="function"==typeof n?n(a.options):n;u(),a.options=Object.assign({},s,a.options,i),a.scrollParents={reference:nu(e)?bu(e):e.contextElement?bu(e.contextElement):[],popper:bu(t)};var o,c,h=function(e){var t=Fu(e);return Lu.reduce((function(e,n){return e.concat(t.filter((function(e){return e.phase===n})))}),[])}((o=[].concat(r,a.options.modifiers),c=o.reduce((function(e,t){var n=e[t.name];return e[t.name]=n?Object.assign({},n,t,{options:Object.assign({},n.options,t.options),data:Object.assign({},n.data,t.data)}):t,e}),{}),Object.keys(c).map((function(e){return c[e]}))));return a.orderedModifiers=h.filter((function(e){return e.enabled})),a.orderedModifiers.forEach((function(e){var t=e.name,n=e.options,r=void 0===n?{}:n,i=e.effect;if("function"==typeof i){var s=i({state:a,name:t,instance:d,options:r});l.push(s||function(){})}})),d.update()},forceUpdate:function(){if(!c){var e=a.elements,t=e.reference,n=e.popper;if(ju(t,n)){a.rects={reference:gu(t,_u(n),"fixed"===a.options.strategy),popper:fu(n)},a.reset=!1,a.placement=a.options.placement,a.orderedModifiers.forEach((function(e){return a.modifiersData[e.name]=Object.assign({},e.data)}));for(var r=0;r<a.orderedModifiers.length;r++)if(!0!==a.reset){var i=a.orderedModifiers[r],s=i.fn,o=i.options,l=void 0===o?{}:o,u=i.name;"function"==typeof s&&(a=s({state:a,options:l,name:u,instance:d})||a)}else a.reset=!1,r=-1}}},update:(i=function(){return new Promise((function(e){d.forceUpdate(),e(a)}))},function(){return o||(o=new Promise((function(e){Promise.resolve().then((function(){o=void 0,e(i())}))}))),o}),destroy:function(){u(),c=!0}};if(!ju(e,t))return d;function u(){l.forEach((function(e){return e()})),l=[]}return d.setOptions(n).then((function(e){!c&&n.onFirstUpdate&&n.onFirstUpdate(e)})),d}}var Bu={passive:!0};const qu={name:"eventListeners",enabled:!0,phase:"write",fn:function(){},effect:function(e){var t=e.state,n=e.instance,r=e.options,i=r.scroll,s=void 0===i||i,o=r.resize,a=void 0===o||o,l=tu(t.elements.popper),c=[].concat(t.scrollParents.reference,t.scrollParents.popper);return s&&c.forEach((function(e){e.addEventListener("scroll",n.update,Bu)})),a&&l.addEventListener("resize",n.update,Bu),function(){s&&c.forEach((function(e){e.removeEventListener("scroll",n.update,Bu)})),a&&l.removeEventListener("resize",n.update,Bu)}},data:{}};function Ku(e){return e.split("-")[0]}function zu(e){return e.split("-")[1]}function $u(e){return["top","bottom"].indexOf(e)>=0?"x":"y"}function Vu(e){var t,n=e.reference,r=e.element,i=e.placement,s=i?Ku(i):null,o=i?zu(i):null,a=n.x+n.width/2-r.width/2,l=n.y+n.height/2-r.height/2;switch(s){case ku:t={x:a,y:n.y-r.height};break;case xu:t={x:a,y:n.y+n.height};break;case Eu:t={x:n.x+n.width,y:l};break;case Tu:t={x:n.x-r.width,y:l};break;default:t={x:n.x,y:n.y}}var c=s?$u(s):null;if(null!=c){var d="y"===c?"height":"width";switch(o){case Iu:t[c]=t[c]-(n[d]/2-r[d]/2);break;case Ru:t[c]=t[c]+(n[d]/2-r[d]/2)}}return t}var Hu={top:"auto",right:"auto",bottom:"auto",left:"auto"};function Wu(e){var t,n=e.popper,r=e.popperRect,i=e.placement,s=e.variation,o=e.offsets,a=e.position,l=e.gpuAcceleration,c=e.adaptive,d=e.roundOffsets,u=e.isFixed,h=o.x,p=void 0===h?0:h,m=o.y,g=void 0===m?0:m,f="function"==typeof d?d({x:p,y:g}):{x:p,y:g};p=f.x,g=f.y;var y=o.hasOwnProperty("x"),v=o.hasOwnProperty("y"),b=Tu,w=ku,S=window;if(c){var _=_u(n),k="clientHeight",x="clientWidth";_===tu(n)&&"static"!==pu(_=uu(n)).position&&"absolute"===a&&(k="scrollHeight",x="scrollWidth"),_=_,(i===ku||(i===Tu||i===Eu)&&s===Ru)&&(w=xu,g-=(u&&S.visualViewport?S.visualViewport.height:_[k])-r.height,g*=l?1:-1),i!==Tu&&(i!==ku&&i!==xu||s!==Ru)||(b=Eu,p-=(u&&S.visualViewport?S.visualViewport.width:_[x])-r.width,p*=l?1:-1)}var E,T=Object.assign({position:a},c&&Hu),C=!0===d?function(e){var t=e.x,n=e.y,r=window.devicePixelRatio||1;return{x:au(t*r)/r||0,y:au(n*r)/r||0}}({x:p,y:g}):{x:p,y:g};return p=C.x,g=C.y,l?Object.assign({},T,((E={})[w]=v?"0":"",E[b]=y?"0":"",E.transform=(S.devicePixelRatio||1)<=1?"translate("+p+"px, "+g+"px)":"translate3d("+p+"px, "+g+"px, 0)",E)):Object.assign({},T,((t={})[w]=v?g+"px":"",t[b]=y?p+"px":"",t.transform="",t))}const Gu={name:"computeStyles",enabled:!0,phase:"beforeWrite",fn:function(e){var t=e.state,n=e.options,r=n.gpuAcceleration,i=void 0===r||r,s=n.adaptive,o=void 0===s||s,a=n.roundOffsets,l=void 0===a||a,c={placement:Ku(t.placement),variation:zu(t.placement),popper:t.elements.popper,popperRect:t.rects.popper,gpuAcceleration:i,isFixed:"fixed"===t.options.strategy};null!=t.modifiersData.popperOffsets&&(t.styles.popper=Object.assign({},t.styles.popper,Wu(Object.assign({},c,{offsets:t.modifiersData.popperOffsets,position:t.options.strategy,adaptive:o,roundOffsets:l})))),null!=t.modifiersData.arrow&&(t.styles.arrow=Object.assign({},t.styles.arrow,Wu(Object.assign({},c,{offsets:t.modifiersData.arrow,position:"absolute",adaptive:!1,roundOffsets:l})))),t.attributes.popper=Object.assign({},t.attributes.popper,{"data-popper-placement":t.placement})},data:{}},Yu={name:"applyStyles",enabled:!0,phase:"write",fn:function(e){var t=e.state;Object.keys(t.elements).forEach((function(e){var n=t.styles[e]||{},r=t.attributes[e]||{},i=t.elements[e];ru(i)&&du(i)&&(Object.assign(i.style,n),Object.keys(r).forEach((function(e){var t=r[e];!1===t?i.removeAttribute(e):i.setAttribute(e,!0===t?"":t)})))}))},effect:function(e){var t=e.state,n={popper:{position:t.options.strategy,left:"0",top:"0",margin:"0"},arrow:{position:"absolute"},reference:{}};return Object.assign(t.elements.popper.style,n.popper),t.styles=n,t.elements.arrow&&Object.assign(t.elements.arrow.style,n.arrow),function(){Object.keys(t.elements).forEach((function(e){var r=t.elements[e],i=t.attributes[e]||{},s=Object.keys(t.styles.hasOwnProperty(e)?t.styles[e]:n[e]).reduce((function(e,t){return e[t]="",e}),{});ru(r)&&du(r)&&(Object.assign(r.style,s),Object.keys(i).forEach((function(e){r.removeAttribute(e)})))}))}},requires:["computeStyles"]},Xu={name:"offset",enabled:!0,phase:"main",requires:["popperOffsets"],fn:function(e){var t=e.state,n=e.options,r=e.name,i=n.offset,s=void 0===i?[0,0]:i,o=Du.reduce((function(e,n){return e[n]=function(e,t,n){var r=Ku(e),i=[Tu,ku].indexOf(r)>=0?-1:1,s="function"==typeof n?n(Object.assign({},t,{placement:e})):n,o=s[0],a=s[1];return o=o||0,a=(a||0)*i,[Tu,Eu].indexOf(r)>=0?{x:a,y:o}:{x:o,y:a}}(n,t.rects,s),e}),{}),a=o[t.placement],l=a.x,c=a.y;null!=t.modifiersData.popperOffsets&&(t.modifiersData.popperOffsets.x+=l,t.modifiersData.popperOffsets.y+=c),t.modifiersData[r]=o}};var Zu={left:"right",right:"left",bottom:"top",top:"bottom"};function Ju(e){return e.replace(/left|right|bottom|top/g,(function(e){return Zu[e]}))}var Qu={start:"end",end:"start"};function eh(e){return e.replace(/start|end/g,(function(e){return Qu[e]}))}function th(e,t){var n=t.getRootNode&&t.getRootNode();if(e.contains(t))return!0;if(n&&iu(n)){var r=t;do{if(r&&e.isSameNode(r))return!0;r=r.parentNode||r.host}while(r)}return!1}function nh(e){return Object.assign({},e,{left:e.x,top:e.y,right:e.x+e.width,bottom:e.y+e.height})}function rh(e,t){return t===Ou?nh(function(e){var t=tu(e),n=uu(e),r=t.visualViewport,i=n.clientWidth,s=n.clientHeight,o=0,a=0;return r&&(i=r.width,s=r.height,/^((?!chrome|android).)*safari/i.test(navigator.userAgent)||(o=r.offsetLeft,a=r.offsetTop)),{width:i,height:s,x:o+hu(e),y:a}}(e)):nu(t)?function(e){var t=lu(e);return t.top=t.top+e.clientTop,t.left=t.left+e.clientLeft,t.bottom=t.top+e.clientHeight,t.right=t.left+e.clientWidth,t.width=e.clientWidth,t.height=e.clientHeight,t.x=t.left,t.y=t.top,t}(t):nh(function(e){var t,n=uu(e),r=cu(e),i=null==(t=e.ownerDocument)?void 0:t.body,s=su(n.scrollWidth,n.clientWidth,i?i.scrollWidth:0,i?i.clientWidth:0),o=su(n.scrollHeight,n.clientHeight,i?i.scrollHeight:0,i?i.clientHeight:0),a=-r.scrollLeft+hu(e),l=-r.scrollTop;return"rtl"===pu(i||n).direction&&(a+=su(n.clientWidth,i?i.clientWidth:0)-s),{width:s,height:o,x:a,y:l}}(uu(e)))}function ih(e){return Object.assign({},{top:0,right:0,bottom:0,left:0},e)}function sh(e,t){return t.reduce((function(t,n){return t[n]=e,t}),{})}function oh(e,t){void 0===t&&(t={});var n=t,r=n.placement,i=void 0===r?e.placement:r,s=n.boundary,o=void 0===s?"clippingParents":s,a=n.rootBoundary,l=void 0===a?Ou:a,c=n.elementContext,d=void 0===c?Pu:c,u=n.altBoundary,h=void 0!==u&&u,p=n.padding,m=void 0===p?0:p,g=ih("number"!=typeof m?m:sh(m,Au)),f=d===Pu?"reference":Pu,y=e.rects.popper,v=e.elements[h?f:d],b=function(e,t,n){var r="clippingParents"===t?function(e){var t=bu(yu(e)),n=["absolute","fixed"].indexOf(pu(e).position)>=0&&ru(e)?_u(e):e;return nu(n)?t.filter((function(e){return nu(e)&&th(e,n)&&"body"!==du(e)})):[]}(e):[].concat(t),i=[].concat(r,[n]),s=i[0],o=i.reduce((function(t,n){var r=rh(e,n);return t.top=su(r.top,t.top),t.right=ou(r.right,t.right),t.bottom=ou(r.bottom,t.bottom),t.left=su(r.left,t.left),t}),rh(e,s));return o.width=o.right-o.left,o.height=o.bottom-o.top,o.x=o.left,o.y=o.top,o}(nu(v)?v:v.contextElement||uu(e.elements.popper),o,l),w=lu(e.elements.reference),S=Vu({reference:w,element:y,strategy:"absolute",placement:i}),_=nh(Object.assign({},y,S)),k=d===Pu?_:w,x={top:b.top-k.top+g.top,bottom:k.bottom-b.bottom+g.bottom,left:b.left-k.left+g.left,right:k.right-b.right+g.right},E=e.modifiersData.offset;if(d===Pu&&E){var T=E[i];Object.keys(x).forEach((function(e){var t=[Eu,xu].indexOf(e)>=0?1:-1,n=[ku,xu].indexOf(e)>=0?"y":"x";x[e]+=T[n]*t}))}return x}const ah={name:"flip",enabled:!0,phase:"main",fn:function(e){var t=e.state,n=e.options,r=e.name;if(!t.modifiersData[r]._skip){for(var i=n.mainAxis,s=void 0===i||i,o=n.altAxis,a=void 0===o||o,l=n.fallbackPlacements,c=n.padding,d=n.boundary,u=n.rootBoundary,h=n.altBoundary,p=n.flipVariations,m=void 0===p||p,g=n.allowedAutoPlacements,f=t.options.placement,y=Ku(f),v=l||(y!==f&&m?function(e){if(Ku(e)===Cu)return[];var t=Ju(e);return[eh(e),t,eh(t)]}(f):[Ju(f)]),b=[f].concat(v).reduce((function(e,n){return e.concat(Ku(n)===Cu?function(e,t){void 0===t&&(t={});var n=t,r=n.placement,i=n.boundary,s=n.rootBoundary,o=n.padding,a=n.flipVariations,l=n.allowedAutoPlacements,c=void 0===l?Du:l,d=zu(r),u=d?a?Mu:Mu.filter((function(e){return zu(e)===d})):Au,h=u.filter((function(e){return c.indexOf(e)>=0}));0===h.length&&(h=u);var p=h.reduce((function(t,n){return t[n]=oh(e,{placement:n,boundary:i,rootBoundary:s,padding:o})[Ku(n)],t}),{});return Object.keys(p).sort((function(e,t){return p[e]-p[t]}))}(t,{placement:n,boundary:d,rootBoundary:u,padding:c,flipVariations:m,allowedAutoPlacements:g}):n)}),[]),w=t.rects.reference,S=t.rects.popper,_=new Map,k=!0,x=b[0],E=0;E<b.length;E++){var T=b[E],C=Ku(T),A=zu(T)===Iu,I=[ku,xu].indexOf(C)>=0,R=I?"width":"height",O=oh(t,{placement:T,boundary:d,rootBoundary:u,altBoundary:h,padding:c}),P=I?A?Eu:Tu:A?xu:ku;w[R]>S[R]&&(P=Ju(P));var M=Ju(P),D=[];if(s&&D.push(O[C]<=0),a&&D.push(O[P]<=0,O[M]<=0),D.every((function(e){return e}))){x=T,k=!1;break}_.set(T,D)}if(k)for(var L=function(e){var t=b.find((function(t){var n=_.get(t);if(n)return n.slice(0,e).every((function(e){return e}))}));if(t)return x=t,"break"},F=m?3:1;F>0&&"break"!==L(F);F--);t.placement!==x&&(t.modifiersData[r]._skip=!0,t.placement=x,t.reset=!0)}},requiresIfExists:["offset"],data:{_skip:!1}};function lh(e,t,n){return su(e,ou(t,n))}const ch={name:"preventOverflow",enabled:!0,phase:"main",fn:function(e){var t=e.state,n=e.options,r=e.name,i=n.mainAxis,s=void 0===i||i,o=n.altAxis,a=void 0!==o&&o,l=n.boundary,c=n.rootBoundary,d=n.altBoundary,u=n.padding,h=n.tether,p=void 0===h||h,m=n.tetherOffset,g=void 0===m?0:m,f=oh(t,{boundary:l,rootBoundary:c,padding:u,altBoundary:d}),y=Ku(t.placement),v=zu(t.placement),b=!v,w=$u(y),S="x"===w?"y":"x",_=t.modifiersData.popperOffsets,k=t.rects.reference,x=t.rects.popper,E="function"==typeof g?g(Object.assign({},t.rects,{placement:t.placement})):g,T="number"==typeof E?{mainAxis:E,altAxis:E}:Object.assign({mainAxis:0,altAxis:0},E),C=t.modifiersData.offset?t.modifiersData.offset[t.placement]:null,A={x:0,y:0};if(_){if(s){var I,R="y"===w?ku:Tu,O="y"===w?xu:Eu,P="y"===w?"height":"width",M=_[w],D=M+f[R],L=M-f[O],F=p?-x[P]/2:0,N=v===Iu?k[P]:x[P],j=v===Iu?-x[P]:-k[P],U=t.elements.arrow,B=p&&U?fu(U):{width:0,height:0},q=t.modifiersData["arrow#persistent"]?t.modifiersData["arrow#persistent"].padding:{top:0,right:0,bottom:0,left:0},K=q[R],z=q[O],$=lh(0,k[P],B[P]),V=b?k[P]/2-F-$-K-T.mainAxis:N-$-K-T.mainAxis,H=b?-k[P]/2+F+$+z+T.mainAxis:j+$+z+T.mainAxis,W=t.elements.arrow&&_u(t.elements.arrow),G=W?"y"===w?W.clientTop||0:W.clientLeft||0:0,Y=null!=(I=null==C?void 0:C[w])?I:0,X=M+H-Y,Z=lh(p?ou(D,M+V-Y-G):D,M,p?su(L,X):L);_[w]=Z,A[w]=Z-M}if(a){var J,Q="x"===w?ku:Tu,ee="x"===w?xu:Eu,te=_[S],ne="y"===S?"height":"width",re=te+f[Q],ie=te-f[ee],se=-1!==[ku,Tu].indexOf(y),oe=null!=(J=null==C?void 0:C[S])?J:0,ae=se?re:te-k[ne]-x[ne]-oe+T.altAxis,le=se?te+k[ne]+x[ne]-oe-T.altAxis:ie,ce=p&&se?function(e,t,n){var r=lh(e,t,n);return r>n?n:r}(ae,te,le):lh(p?ae:re,te,p?le:ie);_[S]=ce,A[S]=ce-te}t.modifiersData[r]=A}},requiresIfExists:["offset"]},dh={name:"arrow",enabled:!0,phase:"main",fn:function(e){var t,n=e.state,r=e.name,i=e.options,s=n.elements.arrow,o=n.modifiersData.popperOffsets,a=Ku(n.placement),l=$u(a),c=[Tu,Eu].indexOf(a)>=0?"height":"width";if(s&&o){var d=function(e,t){return ih("number"!=typeof(e="function"==typeof e?e(Object.assign({},t.rects,{placement:t.placement})):e)?e:sh(e,Au))}(i.padding,n),u=fu(s),h="y"===l?ku:Tu,p="y"===l?xu:Eu,m=n.rects.reference[c]+n.rects.reference[l]-o[l]-n.rects.popper[c],g=o[l]-n.rects.reference[l],f=_u(s),y=f?"y"===l?f.clientHeight||0:f.clientWidth||0:0,v=m/2-g/2,b=d[h],w=y-u[c]-d[p],S=y/2-u[c]/2+v,_=lh(b,S,w),k=l;n.modifiersData[r]=((t={})[k]=_,t.centerOffset=_-S,t)}},effect:function(e){var t=e.state,n=e.options.element,r=void 0===n?"[data-popper-arrow]":n;null!=r&&("string"!=typeof r||(r=t.elements.popper.querySelector(r)))&&th(t.elements.popper,r)&&(t.elements.arrow=r)},requires:["popperOffsets"],requiresIfExists:["preventOverflow"]};function uh(e,t,n){return void 0===n&&(n={x:0,y:0}),{top:e.top-t.height-n.y,right:e.right-t.width+n.x,bottom:e.bottom-t.height+n.y,left:e.left-t.width-n.x}}function hh(e){return[ku,Eu,xu,Tu].some((function(t){return e[t]>=0}))}var ph=Uu({defaultModifiers:[qu,{name:"popperOffsets",enabled:!0,phase:"read",fn:function(e){var t=e.state,n=e.name;t.modifiersData[n]=Vu({reference:t.rects.reference,element:t.rects.popper,strategy:"absolute",placement:t.placement})},data:{}},Gu,Yu,Xu,ah,ch,dh,{name:"hide",enabled:!0,phase:"main",requiresIfExists:["preventOverflow"],fn:function(e){var t=e.state,n=e.name,r=t.rects.reference,i=t.rects.popper,s=t.modifiersData.preventOverflow,o=oh(t,{elementContext:"reference"}),a=oh(t,{altBoundary:!0}),l=uh(o,r),c=uh(a,i,s),d=hh(l),u=hh(c);t.modifiersData[n]={referenceClippingOffsets:l,popperEscapeOffsets:c,isReferenceHidden:d,hasPopperEscaped:u},t.attributes.popper=Object.assign({},t.attributes.popper,{"data-popper-reference-hidden":d,"data-popper-escaped":u})}}]}),mh="tippy-content",gh="tippy-arrow",fh="tippy-svg-arrow",yh={passive:!0,capture:!0},vh=function(){return document.body};function bh(e,t,n){if(Array.isArray(e)){var r=e[t];return null==r?Array.isArray(n)?n[t]:n:r}return e}function wh(e,t){var n={}.toString.call(e);return 0===n.indexOf("[object")&&n.indexOf(t+"]")>-1}function Sh(e,t){return"function"==typeof e?e.apply(void 0,t):e}function _h(e,t){return 0===t?e:function(r){clearTimeout(n),n=setTimeout((function(){e(r)}),t)};var n}function kh(e){return[].concat(e)}function xh(e,t){-1===e.indexOf(t)&&e.push(t)}function Eh(e){return[].slice.call(e)}function Th(e){return Object.keys(e).reduce((function(t,n){return void 0!==e[n]&&(t[n]=e[n]),t}),{})}function Ch(){return document.createElement("div")}function Ah(e){return["Element","Fragment"].some((function(t){return wh(e,t)}))}function Ih(e,t){e.forEach((function(e){e&&(e.style.transitionDuration=t+"ms")}))}function Rh(e,t){e.forEach((function(e){e&&e.setAttribute("data-state",t)}))}function Oh(e,t,n){var r=t+"EventListener";["transitionend","webkitTransitionEnd"].forEach((function(t){e[r](t,n)}))}function Ph(e,t){for(var n=t;n;){var r;if(e.contains(n))return!0;n=null==n.getRootNode||null==(r=n.getRootNode())?void 0:r.host}return!1}var Mh={isTouch:!1},Dh=0;function Lh(){Mh.isTouch||(Mh.isTouch=!0,window.performance&&document.addEventListener("mousemove",Fh))}function Fh(){var e=performance.now();e-Dh<20&&(Mh.isTouch=!1,document.removeEventListener("mousemove",Fh)),Dh=e}function Nh(){var e,t=document.activeElement;if((e=t)&&e._tippy&&e._tippy.reference===e){var n=t._tippy;t.blur&&!n.state.isVisible&&t.blur()}}var jh=!("undefined"==typeof window||"undefined"==typeof document||!window.msCrypto),Uh=Object.assign({appendTo:vh,aria:{content:"auto",expanded:"auto"},delay:0,duration:[300,250],getReferenceClientRect:null,hideOnClick:!0,ignoreAttributes:!1,interactive:!1,interactiveBorder:2,interactiveDebounce:0,moveTransition:"",offset:[0,10],onAfterUpdate:function(){},onBeforeUpdate:function(){},onCreate:function(){},onDestroy:function(){},onHidden:function(){},onHide:function(){},onMount:function(){},onShow:function(){},onShown:function(){},onTrigger:function(){},onUntrigger:function(){},onClickOutside:function(){},placement:"top",plugins:[],popperOptions:{},render:null,showOnCreate:!1,touch:!0,trigger:"mouseenter focus",triggerTarget:null},{animateFill:!1,followCursor:!1,inlinePositioning:!1,sticky:!1},{allowHTML:!1,animation:"fade",arrow:!0,content:"",inertia:!1,maxWidth:350,role:"tooltip",theme:"",zIndex:9999}),Bh=Object.keys(Uh);function qh(e){var t=(e.plugins||[]).reduce((function(t,n){var r,i=n.name,s=n.defaultValue;return i&&(t[i]=void 0!==e[i]?e[i]:null!=(r=Uh[i])?r:s),t}),{});return Object.assign({},e,t)}function Kh(e,t){var n=Object.assign({},t,{content:Sh(t.content,[e])},t.ignoreAttributes?{}:function(e,t){return(t?Object.keys(qh(Object.assign({},Uh,{plugins:t}))):Bh).reduce((function(t,n){var r=(e.getAttribute("data-tippy-"+n)||"").trim();if(!r)return t;if("content"===n)t[n]=r;else try{t[n]=JSON.parse(r)}catch(e){t[n]=r}return t}),{})}(e,t.plugins));return n.aria=Object.assign({},Uh.aria,n.aria),n.aria={expanded:"auto"===n.aria.expanded?t.interactive:n.aria.expanded,content:"auto"===n.aria.content?t.interactive?null:"describedby":n.aria.content},n}function zh(e,t){e.innerHTML=t}function $h(e){var t=Ch();return!0===e?t.className=gh:(t.className=fh,Ah(e)?t.appendChild(e):zh(t,e)),t}function Vh(e,t){Ah(t.content)?(zh(e,""),e.appendChild(t.content)):"function"!=typeof t.content&&(t.allowHTML?zh(e,t.content):e.textContent=t.content)}function Hh(e){var t=e.firstElementChild,n=Eh(t.children);return{box:t,content:n.find((function(e){return e.classList.contains(mh)})),arrow:n.find((function(e){return e.classList.contains(gh)||e.classList.contains(fh)})),backdrop:n.find((function(e){return e.classList.contains("tippy-backdrop")}))}}function Wh(e){var t=Ch(),n=Ch();n.className="tippy-box",n.setAttribute("data-state","hidden"),n.setAttribute("tabindex","-1");var r=Ch();function i(n,r){var i=Hh(t),s=i.box,o=i.content,a=i.arrow;r.theme?s.setAttribute("data-theme",r.theme):s.removeAttribute("data-theme"),"string"==typeof r.animation?s.setAttribute("data-animation",r.animation):s.removeAttribute("data-animation"),r.inertia?s.setAttribute("data-inertia",""):s.removeAttribute("data-inertia"),s.style.maxWidth="number"==typeof r.maxWidth?r.maxWidth+"px":r.maxWidth,r.role?s.setAttribute("role",r.role):s.removeAttribute("role"),n.content===r.content&&n.allowHTML===r.allowHTML||Vh(o,e.props),r.arrow?a?n.arrow!==r.arrow&&(s.removeChild(a),s.appendChild($h(r.arrow))):s.appendChild($h(r.arrow)):a&&s.removeChild(a)}return r.className=mh,r.setAttribute("data-state","hidden"),Vh(r,e.props),t.appendChild(n),n.appendChild(r),i(e.props,e.props),{popper:t,onUpdate:i}}Wh.$$tippy=!0;var Gh=1,Yh=[],Xh=[];function Zh(e,t){var n,r,i,s,o,a,l,c,d=Kh(e,Object.assign({},Uh,qh(Th(t)))),u=!1,h=!1,p=!1,m=!1,g=[],f=_h(W,d.interactiveDebounce),y=Gh++,v=(c=d.plugins).filter((function(e,t){return c.indexOf(e)===t})),b={id:y,reference:e,popper:Ch(),popperInstance:null,props:d,state:{isEnabled:!0,isVisible:!1,isDestroyed:!1,isMounted:!1,isShown:!1},plugins:v,clearDelayTimeouts:function(){clearTimeout(n),clearTimeout(r),cancelAnimationFrame(i)},setProps:function(t){if(!b.state.isDestroyed){M("onBeforeUpdate",[b,t]),V();var n=b.props,r=Kh(e,Object.assign({},n,Th(t),{ignoreAttributes:!0}));b.props=r,$(),n.interactiveDebounce!==r.interactiveDebounce&&(F(),f=_h(W,r.interactiveDebounce)),n.triggerTarget&&!r.triggerTarget?kh(n.triggerTarget).forEach((function(e){e.removeAttribute("aria-expanded")})):r.triggerTarget&&e.removeAttribute("aria-expanded"),L(),P(),_&&_(n,r),b.popperInstance&&(Z(),Q().forEach((function(e){requestAnimationFrame(e._tippy.popperInstance.forceUpdate)}))),M("onAfterUpdate",[b,t])}},setContent:function(e){b.setProps({content:e})},show:function(){var e=b.state.isVisible,t=b.state.isDestroyed,n=!b.state.isEnabled,r=Mh.isTouch&&!b.props.touch,i=bh(b.props.duration,0,Uh.duration);if(!(e||t||n||r||A().hasAttribute("disabled")||(M("onShow",[b],!1),!1===b.props.onShow(b)))){if(b.state.isVisible=!0,C()&&(S.style.visibility="visible"),P(),B(),b.state.isMounted||(S.style.transition="none"),C()){var s=R();Ih([s.box,s.content],0)}var o,l,c;a=function(){var e;if(b.state.isVisible&&!m){if(m=!0,S.offsetHeight,S.style.transition=b.props.moveTransition,C()&&b.props.animation){var t=R(),n=t.box,r=t.content;Ih([n,r],i),Rh([n,r],"visible")}D(),L(),xh(Xh,b),null==(e=b.popperInstance)||e.forceUpdate(),M("onMount",[b]),b.props.animation&&C()&&function(e,t){K(e,(function(){b.state.isShown=!0,M("onShown",[b])}))}(i)}},l=b.props.appendTo,c=A(),(o=b.props.interactive&&l===vh||"parent"===l?c.parentNode:Sh(l,[c])).contains(S)||o.appendChild(S),b.state.isMounted=!0,Z()}},hide:function(){var e=!b.state.isVisible,t=b.state.isDestroyed,n=!b.state.isEnabled,r=bh(b.props.duration,1,Uh.duration);if(!(e||t||n)&&(M("onHide",[b],!1),!1!==b.props.onHide(b))){if(b.state.isVisible=!1,b.state.isShown=!1,m=!1,u=!1,C()&&(S.style.visibility="hidden"),F(),q(),P(!0),C()){var i=R(),s=i.box,o=i.content;b.props.animation&&(Ih([s,o],r),Rh([s,o],"hidden"))}D(),L(),b.props.animation?C()&&function(e,t){K(e,(function(){!b.state.isVisible&&S.parentNode&&S.parentNode.contains(S)&&t()}))}(r,b.unmount):b.unmount()}},hideWithInteractivity:function(e){I().addEventListener("mousemove",f),xh(Yh,f),f(e)},enable:function(){b.state.isEnabled=!0},disable:function(){b.hide(),b.state.isEnabled=!1},unmount:function(){b.state.isVisible&&b.hide(),b.state.isMounted&&(J(),Q().forEach((function(e){e._tippy.unmount()})),S.parentNode&&S.parentNode.removeChild(S),Xh=Xh.filter((function(e){return e!==b})),b.state.isMounted=!1,M("onHidden",[b]))},destroy:function(){b.state.isDestroyed||(b.clearDelayTimeouts(),b.unmount(),V(),delete e._tippy,b.state.isDestroyed=!0,M("onDestroy",[b]))}};if(!d.render)return b;var w=d.render(b),S=w.popper,_=w.onUpdate;S.setAttribute("data-tippy-root",""),S.id="tippy-"+b.id,b.popper=S,e._tippy=b,S._tippy=b;var k=v.map((function(e){return e.fn(b)})),x=e.hasAttribute("aria-expanded");return $(),L(),P(),M("onCreate",[b]),d.showOnCreate&&ee(),S.addEventListener("mouseenter",(function(){b.props.interactive&&b.state.isVisible&&b.clearDelayTimeouts()})),S.addEventListener("mouseleave",(function(){b.props.interactive&&b.props.trigger.indexOf("mouseenter")>=0&&I().addEventListener("mousemove",f)})),b;function E(){var e=b.props.touch;return Array.isArray(e)?e:[e,0]}function T(){return"hold"===E()[0]}function C(){var e;return!(null==(e=b.props.render)||!e.$$tippy)}function A(){return l||e}function I(){var e,t,n=A().parentNode;return n?null!=(t=kh(n)[0])&&null!=(e=t.ownerDocument)&&e.body?t.ownerDocument:document:document}function R(){return Hh(S)}function O(e){return b.state.isMounted&&!b.state.isVisible||Mh.isTouch||s&&"focus"===s.type?0:bh(b.props.delay,e?0:1,Uh.delay)}function P(e){void 0===e&&(e=!1),S.style.pointerEvents=b.props.interactive&&!e?"":"none",S.style.zIndex=""+b.props.zIndex}function M(e,t,n){var r;void 0===n&&(n=!0),k.forEach((function(n){n[e]&&n[e].apply(n,t)})),n&&(r=b.props)[e].apply(r,t)}function D(){var t=b.props.aria;if(t.content){var n="aria-"+t.content,r=S.id;kh(b.props.triggerTarget||e).forEach((function(e){var t=e.getAttribute(n);if(b.state.isVisible)e.setAttribute(n,t?t+" "+r:r);else{var i=t&&t.replace(r,"").trim();i?e.setAttribute(n,i):e.removeAttribute(n)}}))}}function L(){!x&&b.props.aria.expanded&&kh(b.props.triggerTarget||e).forEach((function(e){b.props.interactive?e.setAttribute("aria-expanded",b.state.isVisible&&e===A()?"true":"false"):e.removeAttribute("aria-expanded")}))}function F(){I().removeEventListener("mousemove",f),Yh=Yh.filter((function(e){return e!==f}))}function N(t){if(!Mh.isTouch||!p&&"mousedown"!==t.type){var n=t.composedPath&&t.composedPath()[0]||t.target;if(!b.props.interactive||!Ph(S,n)){if(kh(b.props.triggerTarget||e).some((function(e){return Ph(e,n)}))){if(Mh.isTouch)return;if(b.state.isVisible&&b.props.trigger.indexOf("click")>=0)return}else M("onClickOutside",[b,t]);!0===b.props.hideOnClick&&(b.clearDelayTimeouts(),b.hide(),h=!0,setTimeout((function(){h=!1})),b.state.isMounted||q())}}}function j(){p=!0}function U(){p=!1}function B(){var e=I();e.addEventListener("mousedown",N,!0),e.addEventListener("touchend",N,yh),e.addEventListener("touchstart",U,yh),e.addEventListener("touchmove",j,yh)}function q(){var e=I();e.removeEventListener("mousedown",N,!0),e.removeEventListener("touchend",N,yh),e.removeEventListener("touchstart",U,yh),e.removeEventListener("touchmove",j,yh)}function K(e,t){var n=R().box;function r(e){e.target===n&&(Oh(n,"remove",r),t())}if(0===e)return t();Oh(n,"remove",o),Oh(n,"add",r),o=r}function z(t,n,r){void 0===r&&(r=!1),kh(b.props.triggerTarget||e).forEach((function(e){e.addEventListener(t,n,r),g.push({node:e,eventType:t,handler:n,options:r})}))}function $(){var e;T()&&(z("touchstart",H,{passive:!0}),z("touchend",G,{passive:!0})),(e=b.props.trigger,e.split(/\s+/).filter(Boolean)).forEach((function(e){if("manual"!==e)switch(z(e,H),e){case"mouseenter":z("mouseleave",G);break;case"focus":z(jh?"focusout":"blur",Y);break;case"focusin":z("focusout",Y)}}))}function V(){g.forEach((function(e){var t=e.node,n=e.eventType,r=e.handler,i=e.options;t.removeEventListener(n,r,i)})),g=[]}function H(e){var t,n=!1;if(b.state.isEnabled&&!X(e)&&!h){var r="focus"===(null==(t=s)?void 0:t.type);s=e,l=e.currentTarget,L(),!b.state.isVisible&&wh(e,"MouseEvent")&&Yh.forEach((function(t){return t(e)})),"click"===e.type&&(b.props.trigger.indexOf("mouseenter")<0||u)&&!1!==b.props.hideOnClick&&b.state.isVisible?n=!0:ee(e),"click"===e.type&&(u=!n),n&&!r&&te(e)}}function W(e){var t=e.target,n=A().contains(t)||S.contains(t);if("mousemove"!==e.type||!n){var r=Q().concat(S).map((function(e){var t,n=null==(t=e._tippy.popperInstance)?void 0:t.state;return n?{popperRect:e.getBoundingClientRect(),popperState:n,props:d}:null})).filter(Boolean);(function(e,t){var n=t.clientX,r=t.clientY;return e.every((function(e){var t=e.popperRect,i=e.popperState,s=e.props.interactiveBorder,o=i.placement.split("-")[0],a=i.modifiersData.offset;if(!a)return!0;var l="bottom"===o?a.top.y:0,c="top"===o?a.bottom.y:0,d="right"===o?a.left.x:0,u="left"===o?a.right.x:0,h=t.top-r+l>s,p=r-t.bottom-c>s,m=t.left-n+d>s,g=n-t.right-u>s;return h||p||m||g}))})(r,e)&&(F(),te(e))}}function G(e){X(e)||b.props.trigger.indexOf("click")>=0&&u||(b.props.interactive?b.hideWithInteractivity(e):te(e))}function Y(e){b.props.trigger.indexOf("focusin")<0&&e.target!==A()||b.props.interactive&&e.relatedTarget&&S.contains(e.relatedTarget)||te(e)}function X(e){return!!Mh.isTouch&&T()!==e.type.indexOf("touch")>=0}function Z(){J();var t=b.props,n=t.popperOptions,r=t.placement,i=t.offset,s=t.getReferenceClientRect,o=t.moveTransition,l=C()?Hh(S).arrow:null,c=s?{getBoundingClientRect:s,contextElement:s.contextElement||A()}:e,d={name:"$$tippy",enabled:!0,phase:"beforeWrite",requires:["computeStyles"],fn:function(e){var t=e.state;if(C()){var n=R().box;["placement","reference-hidden","escaped"].forEach((function(e){"placement"===e?n.setAttribute("data-placement",t.placement):t.attributes.popper["data-popper-"+e]?n.setAttribute("data-"+e,""):n.removeAttribute("data-"+e)})),t.attributes.popper={}}}},u=[{name:"offset",options:{offset:i}},{name:"preventOverflow",options:{padding:{top:2,bottom:2,left:5,right:5}}},{name:"flip",options:{padding:5}},{name:"computeStyles",options:{adaptive:!o}},d];C()&&l&&u.push({name:"arrow",options:{element:l,padding:3}}),u.push.apply(u,(null==n?void 0:n.modifiers)||[]),b.popperInstance=ph(c,S,Object.assign({},n,{placement:r,onFirstUpdate:a,modifiers:u}))}function J(){b.popperInstance&&(b.popperInstance.destroy(),b.popperInstance=null)}function Q(){return Eh(S.querySelectorAll("[data-tippy-root]"))}function ee(e){b.clearDelayTimeouts(),e&&M("onTrigger",[b,e]),B();var t=O(!0),r=E(),i=r[0],s=r[1];Mh.isTouch&&"hold"===i&&s&&(t=s),t?n=setTimeout((function(){b.show()}),t):b.show()}function te(e){if(b.clearDelayTimeouts(),M("onUntrigger",[b,e]),b.state.isVisible){if(!(b.props.trigger.indexOf("mouseenter")>=0&&b.props.trigger.indexOf("click")>=0&&["mouseleave","mousemove"].indexOf(e.type)>=0&&u)){var t=O(!1);t?r=setTimeout((function(){b.state.isVisible&&b.hide()}),t):i=requestAnimationFrame((function(){b.hide()}))}}else q()}}function Jh(e,t){void 0===t&&(t={});var n=Uh.plugins.concat(t.plugins||[]);document.addEventListener("touchstart",Lh,yh),window.addEventListener("blur",Nh);var r,i=Object.assign({},t,{plugins:n}),s=(r=e,Ah(r)?[r]:function(e){return wh(e,"NodeList")}(r)?Eh(r):Array.isArray(r)?r:Eh(document.querySelectorAll(r))).reduce((function(e,t){var n=t&&Zh(t,i);return n&&e.push(n),e}),[]);return Ah(e)?s[0]:s}Jh.defaultProps=Uh,Jh.setDefaultProps=function(e){Object.keys(e).forEach((function(t){Uh[t]=e[t]}))},Jh.currentInput=Mh,Object.assign({},Yu,{effect:function(e){var t=e.state,n={popper:{position:t.options.strategy,left:"0",top:"0",margin:"0"},arrow:{position:"absolute"},reference:{}};Object.assign(t.elements.popper.style,n.popper),t.styles=n,t.elements.arrow&&Object.assign(t.elements.arrow.style,n.arrow)}}),Jh.setDefaultProps({render:Wh});const Qh=Jh;var ep=__webpack_require__(6894),tp={};tp.styleTagTransform=Ie(),tp.setAttributes=Ee(),tp.insert=ke().bind(null,"head"),tp.domAPI=Se(),tp.insertStyleElement=Ce(),be()(ep.Z,tp),ep.Z&&ep.Z.locals&&ep.Z.locals;class np extends g{componentDidMount(){this.tippy=Qh(this.base,Object.assign({delay:[1500,null],touch:["hold",1e3]},this.props)),this.base.addEventListener("focusout",this.tippy.hide())}componentWillUnmount(){this.tippy.destroy()}render(e){return e.children}}function rp(e){switch(e._type){case"document":case"block_quote":case"list":case"item":case"paragraph":case"heading":case"emph":case"strong":case"link":case"image":case"custom_inline":case"custom_block":return!0;default:return!1}}var ip=function(e,t){this.current=e,this.entering=!0===t},sp=function(){var e=this.current,t=this.entering;if(null===e)return null;var n=rp(e);return t&&n?e._firstChild?(this.current=e._firstChild,this.entering=!0):this.entering=!1:e===this.root?this.current=null:null===e._next?(this.current=e._parent,this.entering=!1):(this.current=e._next,this.entering=!0),{entering:t,node:e}},op=function(e){return{current:e,root:e,entering:!0,next:sp,resumeAt:ip}},ap=function(e,t){this._type=e,this._parent=null,this._firstChild=null,this._lastChild=null,this._prev=null,this._next=null,this._sourcepos=t,this._lastLineBlank=!1,this._lastLineChecked=!1,this._open=!0,this._string_content=null,this._literal=null,this._listData={},this._info=null,this._destination=null,this._title=null,this._isFenced=!1,this._fenceChar=null,this._fenceLength=0,this._fenceOffset=null,this._level=null,this._onEnter=null,this._onExit=null},lp=ap.prototype;Object.defineProperty(lp,"isContainer",{get:function(){return rp(this)}}),Object.defineProperty(lp,"type",{get:function(){return this._type}}),Object.defineProperty(lp,"firstChild",{get:function(){return this._firstChild}}),Object.defineProperty(lp,"lastChild",{get:function(){return this._lastChild}}),Object.defineProperty(lp,"next",{get:function(){return this._next}}),Object.defineProperty(lp,"prev",{get:function(){return this._prev}}),Object.defineProperty(lp,"parent",{get:function(){return this._parent}}),Object.defineProperty(lp,"sourcepos",{get:function(){return this._sourcepos}}),Object.defineProperty(lp,"literal",{get:function(){return this._literal},set:function(e){this._literal=e}}),Object.defineProperty(lp,"destination",{get:function(){return this._destination},set:function(e){this._destination=e}}),Object.defineProperty(lp,"title",{get:function(){return this._title},set:function(e){this._title=e}}),Object.defineProperty(lp,"info",{get:function(){return this._info},set:function(e){this._info=e}}),Object.defineProperty(lp,"level",{get:function(){return this._level},set:function(e){this._level=e}}),Object.defineProperty(lp,"listType",{get:function(){return this._listData.type},set:function(e){this._listData.type=e}}),Object.defineProperty(lp,"listTight",{get:function(){return this._listData.tight},set:function(e){this._listData.tight=e}}),Object.defineProperty(lp,"listStart",{get:function(){return this._listData.start},set:function(e){this._listData.start=e}}),Object.defineProperty(lp,"listDelimiter",{get:function(){return this._listData.delimiter},set:function(e){this._listData.delimiter=e}}),Object.defineProperty(lp,"onEnter",{get:function(){return this._onEnter},set:function(e){this._onEnter=e}}),Object.defineProperty(lp,"onExit",{get:function(){return this._onExit},set:function(e){this._onExit=e}}),ap.prototype.appendChild=function(e){e.unlink(),e._parent=this,this._lastChild?(this._lastChild._next=e,e._prev=this._lastChild,this._lastChild=e):(this._firstChild=e,this._lastChild=e)},ap.prototype.prependChild=function(e){e.unlink(),e._parent=this,this._firstChild?(this._firstChild._prev=e,e._next=this._firstChild,this._firstChild=e):(this._firstChild=e,this._lastChild=e)},ap.prototype.unlink=function(){this._prev?this._prev._next=this._next:this._parent&&(this._parent._firstChild=this._next),this._next?this._next._prev=this._prev:this._parent&&(this._parent._lastChild=this._prev),this._parent=null,this._next=null,this._prev=null},ap.prototype.insertAfter=function(e){e.unlink(),e._next=this._next,e._next&&(e._next._prev=e),e._prev=this,this._next=e,e._parent=this._parent,e._next||(e._parent._lastChild=e)},ap.prototype.insertBefore=function(e){e.unlink(),e._prev=this._prev,e._prev&&(e._prev._next=e),e._next=this,this._prev=e,e._parent=this._parent,e._prev||(e._parent._firstChild=e)},ap.prototype.walker=function(){return new op(this)};const cp=ap;var dp,up=__webpack_require__(729),hp=__webpack_require__(5863),pp=new RegExp("^(?:<[A-Za-z][A-Za-z0-9-]*(?:\\s+[a-zA-Z_:][a-zA-Z0-9:._-]*(?:\\s*=\\s*(?:[^\"'=<>`\\x00-\\x20]+|'[^']*'|\"[^\"]*\"))?)*\\s*/?>|</[A-Za-z][A-Za-z0-9-]*\\s*[>]|\x3c!----\x3e|\x3c!--(?:-?[^>-])(?:-?[^-])*--\x3e|[<][?][\\s\\S]*?[?][>]|<![A-Z]+\\s+[^>]*>|<!\\[CDATA\\[[\\s\\S]*?\\]\\]>)"),mp=/[\\&]/,gp="[!\"#$%&'()*+,./:;<=>?@[\\\\\\]^_`{|}~-]",fp=new RegExp("\\\\"+gp+"|&(?:#x[a-f0-9]{1,6}|#[0-9]{1,7}|[a-z][a-z0-9]{1,31});","gi"),yp=new RegExp('[&<>"]',"g"),vp=function(e){return 92===e.charCodeAt(0)?e.charAt(1):(0,hp.decodeHTML)(e)},bp=function(e){return mp.test(e)?e.replace(fp,vp):e},wp=function(e){switch(e){case"&":return"&amp;";case"<":return"&lt;";case">":return"&gt;";case'"':return"&quot;";default:return e}},Sp=function(e){return yp.test(e)?e.replace(yp,wp):e};function _p(e){return dp(e)}if(String.fromCodePoint)dp=function(e){try{return String.fromCodePoint(e)}catch(e){if(e instanceof RangeError)return String.fromCharCode(65533);throw e}};else{var kp=String.fromCharCode,xp=Math.floor;dp=function(){var e,t,n=16384,r=[],i=-1,s=arguments.length;if(!s)return"";for(var o="";++i<s;){var a=Number(arguments[i]);if(!isFinite(a)||a<0||a>1114111||xp(a)!==a)return String.fromCharCode(65533);a<=65535?r.push(a):(e=55296+((a-=65536)>>10),t=a%1024+56320,r.push(e,t)),(i+1===s||r.length>n)&&(o+=kp.apply(null,r),r.length=0)}return o}}__webpack_require__(8822);var Ep=function(e){try{return up(e)}catch(t){return e}},Tp=bp,Cp=39,Ap=34,Ip=gp,Rp="\\\\"+Ip,Op=pp,Pp=new RegExp(/^[!"#$%&'()*+,\-./:;<=>?@\[\]\\^_`{|}~\xA1\xA7\xAB\xB6\xB7\xBB\xBF\u037E\u0387\u055A-\u055F\u0589\u058A\u05BE\u05C0\u05C3\u05C6\u05F3\u05F4\u0609\u060A\u060C\u060D\u061B\u061E\u061F\u066A-\u066D\u06D4\u0700-\u070D\u07F7-\u07F9\u0830-\u083E\u085E\u0964\u0965\u0970\u0AF0\u0DF4\u0E4F\u0E5A\u0E5B\u0F04-\u0F12\u0F14\u0F3A-\u0F3D\u0F85\u0FD0-\u0FD4\u0FD9\u0FDA\u104A-\u104F\u10FB\u1360-\u1368\u1400\u166D\u166E\u169B\u169C\u16EB-\u16ED\u1735\u1736\u17D4-\u17D6\u17D8-\u17DA\u1800-\u180A\u1944\u1945\u1A1E\u1A1F\u1AA0-\u1AA6\u1AA8-\u1AAD\u1B5A-\u1B60\u1BFC-\u1BFF\u1C3B-\u1C3F\u1C7E\u1C7F\u1CC0-\u1CC7\u1CD3\u2010-\u2027\u2030-\u2043\u2045-\u2051\u2053-\u205E\u207D\u207E\u208D\u208E\u2308-\u230B\u2329\u232A\u2768-\u2775\u27C5\u27C6\u27E6-\u27EF\u2983-\u2998\u29D8-\u29DB\u29FC\u29FD\u2CF9-\u2CFC\u2CFE\u2CFF\u2D70\u2E00-\u2E2E\u2E30-\u2E42\u3001-\u3003\u3008-\u3011\u3014-\u301F\u3030\u303D\u30A0\u30FB\uA4FE\uA4FF\uA60D-\uA60F\uA673\uA67E\uA6F2-\uA6F7\uA874-\uA877\uA8CE\uA8CF\uA8F8-\uA8FA\uA8FC\uA92E\uA92F\uA95F\uA9C1-\uA9CD\uA9DE\uA9DF\uAA5C-\uAA5F\uAADE\uAADF\uAAF0\uAAF1\uABEB\uFD3E\uFD3F\uFE10-\uFE19\uFE30-\uFE52\uFE54-\uFE61\uFE63\uFE68\uFE6A\uFE6B\uFF01-\uFF03\uFF05-\uFF0A\uFF0C-\uFF0F\uFF1A\uFF1B\uFF1F\uFF20\uFF3B-\uFF3D\uFF3F\uFF5B\uFF5D\uFF5F-\uFF65]|\uD800[\uDD00-\uDD02\uDF9F\uDFD0]|\uD801\uDD6F|\uD802[\uDC57\uDD1F\uDD3F\uDE50-\uDE58\uDE7F\uDEF0-\uDEF6\uDF39-\uDF3F\uDF99-\uDF9C]|\uD804[\uDC47-\uDC4D\uDCBB\uDCBC\uDCBE-\uDCC1\uDD40-\uDD43\uDD74\uDD75\uDDC5-\uDDC9\uDDCD\uDDDB\uDDDD-\uDDDF\uDE38-\uDE3D\uDEA9]|\uD805[\uDCC6\uDDC1-\uDDD7\uDE41-\uDE43\uDF3C-\uDF3E]|\uD809[\uDC70-\uDC74]|\uD81A[\uDE6E\uDE6F\uDEF5\uDF37-\uDF3B\uDF44]|\uD82F\uDC9F|\uD836[\uDE87-\uDE8B]/),Mp=new RegExp('^(?:"('+Rp+'|[^"\\x00])*"|\'('+Rp+"|[^'\\x00])*'|\\(("+Rp+"|[^()\\x00])*\\))"),Dp=/^(?:<(?:[^<>\n\\\x00]|\\.)*>)/,Lp=new RegExp("^"+Ip),Fp=new RegExp("^&(?:#x[a-f0-9]{1,6}|#[0-9]{1,7}|[a-z][a-z0-9]{1,31});","i"),Np=/`+/,jp=/^`+/,Up=/\.\.\./g,Bp=/--+/g,qp=/^<([a-zA-Z0-9.!#$%&'*+\/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*)>/,Kp=/^<[A-Za-z][A-Za-z0-9.+-]{1,31}:[^<>\x00-\x20]*>/i,zp=/^ *(?:\n *)?/,$p=/^[ \t\n\x0b\x0c\x0d]/,Vp=/^\s/,Hp=/ *$/,Wp=/^ */,Gp=/^ *(?:\n|$)/,Yp=/^\[(?:[^\\\[\]]|\\.){0,1000}\]/s,Xp=/^[^\n`\[\]\\!<&*_'"]+/m,Zp=function(e){var t=new cp("text");return t._literal=e,t},Jp=function(e){return e.slice(1,e.length-1).trim().replace(/[ \t\r\n]+/," ").toLowerCase().toUpperCase()},Qp=function(e){var t=e.exec(this.subject.slice(this.pos));return null===t?null:(this.pos+=t.index+t[0].length,t[0])},em=function(){return this.pos<this.subject.length?this.subject.charCodeAt(this.pos):-1},tm=function(){return this.match(zp),!0},nm=function(e){var t=this.match(jp);if(null===t)return!1;for(var n,r,i,s=this.pos;null!==(n=this.match(Np));)if(n===t)return r=new cp("code"),(i=this.subject.slice(s,this.pos-t.length).replace(/\n/gm," ")).length>0&&null!==i.match(/[^ ]/)&&" "==i[0]&&" "==i[i.length-1]?r._literal=i.slice(1,i.length-1):r._literal=i,e.appendChild(r),!0;return this.pos=s,e.appendChild(Zp(t)),!0},rm=function(e){var t,n=this.subject;return this.pos+=1,10===this.peek()?(this.pos+=1,t=new cp("linebreak"),e.appendChild(t)):Lp.test(n.charAt(this.pos))?(e.appendChild(Zp(n.charAt(this.pos))),this.pos+=1):e.appendChild(Zp("\\")),!0},im=function(e){var t,n,r;return(t=this.match(qp))?(n=t.slice(1,t.length-1),(r=new cp("link"))._destination=Ep("mailto:"+n),r._title="",r.appendChild(Zp(n)),e.appendChild(r),!0):!!(t=this.match(Kp))&&(n=t.slice(1,t.length-1),(r=new cp("link"))._destination=Ep(n),r._title="",r.appendChild(Zp(n)),e.appendChild(r),!0)},sm=function(e){var t=this.match(Op);if(null===t)return!1;var n=new cp("html_inline");return n._literal=t,e.appendChild(n),!0},om=function(e){var t,n,r,i,s,o,a,l,c,d,u,h=0,p=this.pos;if(e===Cp||e===Ap)h++,this.pos++;else for(;this.peek()===e;)h++,this.pos++;return 0===h?null:(t=0===p?"\n":this.subject.charAt(p-1),n=-1===(r=this.peek())?"\n":_p(r),l=Vp.test(n),c=Pp.test(n),d=Vp.test(t),u=Pp.test(t),i=!l&&(!c||d||u),s=!d&&(!u||l||c),95===e?(o=i&&(!s||u),a=s&&(!i||c)):e===Cp||e===Ap?(o=i&&!s,a=s):(o=i,a=s),this.pos=p,{numdelims:h,can_open:o,can_close:a})},am=function(e,t){var n=this.scanDelims(e);if(!n)return!1;var r,i=n.numdelims,s=this.pos;this.pos+=i,r=e===Cp?"":e===Ap?"":this.subject.slice(s,this.pos);var o=Zp(r);return t.appendChild(o),(n.can_open||n.can_close)&&(this.options.smart||e!==Cp&&e!==Ap)&&(this.delimiters={cc:e,numdelims:i,origdelims:i,node:o,previous:this.delimiters,next:null,can_open:n.can_open,can_close:n.can_close},null!==this.delimiters.previous&&(this.delimiters.previous.next=this.delimiters)),!0},lm=function(e){null!==e.previous&&(e.previous.next=e.next),null===e.next?this.delimiters=e.previous:e.next.previous=e.previous},cm=function(e,t){e.next!==t&&(e.next=t,t.previous=e)},dm=function(e){for(var t,n,r,i,s,o,a,l,c,d,u,h=[],p=!1,m=0;m<8;m++)h[m]=e;for(n=this.delimiters;null!==n&&n.previous!==e;)n=n.previous;for(;null!==n;){var g=n.cc;if(n.can_close){switch(t=n.previous,d=!1,g){case Cp:u=0;break;case Ap:u=1;break;case 95:u=2;break;case 42:u=3+(n.can_open?3:0)+n.origdelims%3}for(;null!==t&&t!==e&&t!==h[u];){if(p=(n.can_open||t.can_close)&&n.origdelims%3!=0&&(t.origdelims+n.origdelims)%3==0,t.cc===n.cc&&t.can_open&&!p){d=!0;break}t=t.previous}if(r=n,42===g||95===g)if(d){a=n.numdelims>=2&&t.numdelims>=2?2:1,i=t.node,s=n.node,t.numdelims-=a,n.numdelims-=a,i._literal=i._literal.slice(0,i._literal.length-a),s._literal=s._literal.slice(0,s._literal.length-a);var f=new cp(1===a?"emph":"strong");for(l=i._next;l&&l!==s;)c=l._next,l.unlink(),f.appendChild(l),l=c;i.insertAfter(f),cm(t,n),0===t.numdelims&&(i.unlink(),this.removeDelimiter(t)),0===n.numdelims&&(s.unlink(),o=n.next,this.removeDelimiter(n),n=o)}else n=n.next;else g===Cp?(n.node._literal="",d&&(t.node._literal=""),n=n.next):g===Ap&&(n.node._literal="",d&&(t.node.literal=""),n=n.next);d||(h[u]=r.previous,r.can_open||this.removeDelimiter(r))}else n=n.next}for(;null!==this.delimiters&&this.delimiters!==e;)this.removeDelimiter(this.delimiters)},um=function(){var e=this.match(Mp);return null===e?null:Tp(e.substr(1,e.length-2))},hm=function(){var e=this.match(Dp);if(null===e){if(60===this.peek())return null;for(var t,n=this.pos,r=0;-1!==(t=this.peek());)if(92===t&&Lp.test(this.subject.charAt(this.pos+1)))this.pos+=1,-1!==this.peek()&&(this.pos+=1);else if(40===t)this.pos+=1,r+=1;else if(41===t){if(r<1)break;this.pos+=1,r-=1}else{if(null!==$p.exec(_p(t)))break;this.pos+=1}return this.pos===n&&41!==t||0!==r?null:(e=this.subject.substr(n,this.pos-n),Ep(Tp(e)))}return Ep(Tp(e.substr(1,e.length-2)))},pm=function(){var e=this.match(Yp);return null===e||e.length>1001?0:e.length},mm=function(e){var t=this.pos;this.pos+=1;var n=Zp("[");return e.appendChild(n),this.addBracket(n,t,!1),!0},gm=function(e){var t=this.pos;if(this.pos+=1,91===this.peek()){this.pos+=1;var n=Zp("![");e.appendChild(n),this.addBracket(n,t+1,!0)}else e.appendChild(Zp("!"));return!0},fm=function(e){var t,n,r,i,s,o,a=!1;if(this.pos+=1,t=this.pos,null===(o=this.brackets))return e.appendChild(Zp("]")),!0;if(!o.active)return e.appendChild(Zp("]")),this.removeBracket(),!0;n=o.image;var l=this.pos;if(40===this.peek()&&(this.pos++,this.spnl()&&null!==(r=this.parseLinkDestination())&&this.spnl()&&($p.test(this.subject.charAt(this.pos-1))&&(i=this.parseLinkTitle()),1)&&this.spnl()&&41===this.peek()?(this.pos+=1,a=!0):this.pos=l),!a){var c=this.pos,d=this.parseLinkLabel();if(d>2?s=this.subject.slice(c,c+d):o.bracketAfter||(s=this.subject.slice(o.index,t)),0===d&&(this.pos=l),s){var u=this.refmap[Jp(s)];u&&(r=u.destination,i=u.title,a=!0)}}if(a){var h,p,m=new cp(n?"image":"link");for(m._destination=r,m._title=i||"",h=o.node._next;h;)p=h._next,h.unlink(),m.appendChild(h),h=p;if(e.appendChild(m),this.processEmphasis(o.previousDelimiter),this.removeBracket(),o.node.unlink(),!n)for(o=this.brackets;null!==o;)o.image||(o.active=!1),o=o.previous;return!0}return this.removeBracket(),this.pos=t,e.appendChild(Zp("]")),!0},ym=function(e,t,n){null!==this.brackets&&(this.brackets.bracketAfter=!0),this.brackets={node:e,previous:this.brackets,previousDelimiter:this.delimiters,index:t,image:n,active:!0}},vm=function(){this.brackets=this.brackets.previous},bm=function(e){var t;return!!(t=this.match(Fp))&&(e.appendChild(Zp((0,hp.decodeHTML)(t))),!0)},wm=function(e){var t;return!!(t=this.match(Xp))&&(this.options.smart?e.appendChild(Zp(t.replace(Up,"").replace(Bp,(function(e){var t=0,n=0;return e.length%3==0?n=e.length/3:e.length%2==0?t=e.length/2:e.length%3==2?(t=1,n=(e.length-2)/3):(t=2,n=(e.length-4)/3),"".repeat(n)+"".repeat(t)})))):e.appendChild(Zp(t)),!0)},Sm=function(e){this.pos+=1;var t=e._lastChild;if(t&&"text"===t.type&&" "===t._literal[t._literal.length-1]){var n=" "===t._literal[t._literal.length-2];t._literal=t._literal.replace(Hp,""),e.appendChild(new cp(n?"linebreak":"softbreak"))}else e.appendChild(new cp("softbreak"));return this.match(Wp),!0},_m=function(e,t){var n,r,i,s;this.subject=e,this.pos=0;var o=this.pos;if(0===(s=this.parseLinkLabel()))return 0;if(n=this.subject.substr(0,s),58!==this.peek())return this.pos=o,0;if(this.pos++,this.spnl(),null===(r=this.parseLinkDestination()))return this.pos=o,0;var a=this.pos;this.spnl(),this.pos!==a&&(i=this.parseLinkTitle()),null===i&&(i="",this.pos=a);var l=!0;if(null===this.match(Gp)&&(""===i?l=!1:(i="",this.pos=a,l=null!==this.match(Gp))),!l)return this.pos=o,0;var c=Jp(n);return""===c?(this.pos=o,0):(t[c]||(t[c]={destination:r,title:i}),this.pos-o)},km=function(e){var t=!1,n=this.peek();if(-1===n)return!1;switch(n){case 10:t=this.parseNewline(e);break;case 92:t=this.parseBackslash(e);break;case 96:t=this.parseBackticks(e);break;case 42:case 95:t=this.handleDelim(n,e);break;case Cp:case Ap:t=this.options.smart&&this.handleDelim(n,e);break;case 91:t=this.parseOpenBracket(e);break;case 33:t=this.parseBang(e);break;case 93:t=this.parseCloseBracket(e);break;case 60:t=this.parseAutolink(e)||this.parseHtmlTag(e);break;case 38:t=this.parseEntity(e);break;default:t=this.parseString(e)}return t||(this.pos+=1,e.appendChild(Zp(_p(n)))),!0},xm=function(e){for(this.subject=e._string_content.trim(),this.pos=0,this.delimiters=null,this.brackets=null;this.parseInline(e););e._string_content=null,this.processEmphasis(null)};const Em=function(e){return{subject:"",delimiters:null,brackets:null,pos:0,refmap:{},match:Qp,peek:em,spnl:tm,parseBackticks:nm,parseBackslash:rm,parseAutolink:im,parseHtmlTag:sm,scanDelims:om,handleDelim:am,parseLinkTitle:um,parseLinkDestination:hm,parseLinkLabel:pm,parseOpenBracket:mm,parseBang:gm,parseCloseBracket:fm,addBracket:ym,removeBracket:vm,parseEntity:bm,parseString:wm,parseNewline:Sm,parseReference:_m,parseInline:km,processEmphasis:dm,removeDelimiter:lm,options:e||{},parse:xm}};var Tm=[/./,/^<(?:script|pre|textarea|style)(?:\s|>|$)/i,/^<!--/,/^<[?]/,/^<![A-Z]/,/^<!\[CDATA\[/,/^<[/]?(?:address|article|aside|base|basefont|blockquote|body|caption|center|col|colgroup|dd|details|dialog|dir|div|dl|dt|fieldset|figcaption|figure|footer|form|frame|frameset|h[123456]|head|header|hr|html|iframe|legend|li|link|main|menu|menuitem|nav|noframes|ol|optgroup|option|p|param|section|source|summary|table|tbody|td|tfoot|th|thead|title|tr|track|ul)(?:\s|[/]?[>]|$)/i,new RegExp("^(?:<[A-Za-z][A-Za-z0-9-]*(?:\\s+[a-zA-Z_:][a-zA-Z0-9:._-]*(?:\\s*=\\s*(?:[^\"'=<>`\\x00-\\x20]+|'[^']*'|\"[^\"]*\"))?)*\\s*/?>|</[A-Za-z][A-Za-z0-9-]*\\s*[>])\\s*$","i")],Cm=[/./,/<\/(?:script|pre|textarea|style)>/i,/-->/,/\?>/,/>/,/\]\]>/],Am=/^(?:\*[ \t]*){3,}$|^(?:_[ \t]*){3,}$|^(?:-[ \t]*){3,}$/,Im=/^[#`~*+_=<>0-9-]/,Rm=/[^ \t\f\v\r\n]/,Om=/^[*+-]/,Pm=/^(\d{1,9})([.)])/,Mm=/^#{1,6}(?:[ \t]+|$)/,Dm=/^`{3,}(?!.*`)|^~{3,}/,Lm=/^(?:`{3,}|~{3,})(?= *$)/,Fm=/^(?:=+|-+)[ \t]*$/,Nm=/\r\n|\n|\r/,jm=function(e){return 32===e||9===e},Um=function(e,t){return t<e.length?e.charCodeAt(t):-1},Bm=function(e){for(;e;){if(e._lastLineBlank)return!0;var t=e.type;if(e._lastLineChecked||"list"!==t&&"item"!==t){e._lastLineChecked=!0;break}e._lastLineChecked=!0,e=e._lastChild}return!1},qm=function(){if(this.partiallyConsumedTab){this.offset+=1;var e=4-this.column%4;this.tip._string_content+=" ".repeat(e)}this.tip._string_content+=this.currentLine.slice(this.offset)+"\n"},Km=function(e,t){for(;!this.blocks[this.tip.type].canContain(e);)this.finalize(this.tip,this.lineNumber-1);var n=t+1,r=new cp(e,[[this.lineNumber,n],[0,0]]);return r._string_content="",this.tip.appendChild(r),this.tip=r,r},zm=function(){if(!this.allClosed){for(;this.oldtip!==this.lastMatchedContainer;){var e=this.oldtip._parent;this.finalize(this.oldtip,this.lineNumber-1),this.oldtip=e}this.allClosed=!0}},$m={document:{continue:function(){return 0},finalize:function(){},canContain:function(e){return"item"!==e},acceptsLines:!1},list:{continue:function(){return 0},finalize:function(e,t){for(var n=t._firstChild;n;){if(Bm(n)&&n._next){t._listData.tight=!1;break}for(var r=n._firstChild;r;){if(Bm(r)&&(n._next||r._next)){t._listData.tight=!1;break}r=r._next}n=n._next}},canContain:function(e){return"item"===e},acceptsLines:!1},block_quote:{continue:function(e){var t=e.currentLine;return e.indented||62!==Um(t,e.nextNonspace)?1:(e.advanceNextNonspace(),e.advanceOffset(1,!1),jm(Um(t,e.offset))&&e.advanceOffset(1,!0),0)},finalize:function(){},canContain:function(e){return"item"!==e},acceptsLines:!1},item:{continue:function(e,t){if(e.blank){if(null==t._firstChild)return 1;e.advanceNextNonspace()}else{if(!(e.indent>=t._listData.markerOffset+t._listData.padding))return 1;e.advanceOffset(t._listData.markerOffset+t._listData.padding,!0)}return 0},finalize:function(){},canContain:function(e){return"item"!==e},acceptsLines:!1},heading:{continue:function(){return 1},finalize:function(){},canContain:function(){return!1},acceptsLines:!1},thematic_break:{continue:function(){return 1},finalize:function(){},canContain:function(){return!1},acceptsLines:!1},code_block:{continue:function(e,t){var n=e.currentLine,r=e.indent;if(t._isFenced){var i=r<=3&&n.charAt(e.nextNonspace)===t._fenceChar&&n.slice(e.nextNonspace).match(Lm);if(i&&i[0].length>=t._fenceLength)return e.lastLineLength=e.offset+r+i[0].length,e.finalize(t,e.lineNumber),2;for(var s=t._fenceOffset;s>0&&jm(Um(n,e.offset));)e.advanceOffset(1,!0),s--}else if(r>=4)e.advanceOffset(4,!0);else{if(!e.blank)return 1;e.advanceNextNonspace()}return 0},finalize:function(e,t){if(t._isFenced){var n=t._string_content,r=n.indexOf("\n"),i=n.slice(0,r),s=n.slice(r+1);t.info=bp(i.trim()),t._literal=s}else t._literal=t._string_content.replace(/(\n *)+$/,"\n");t._string_content=null},canContain:function(){return!1},acceptsLines:!0},html_block:{continue:function(e,t){return!e.blank||6!==t._htmlBlockType&&7!==t._htmlBlockType?0:1},finalize:function(e,t){t._literal=t._string_content.replace(/(\n *)+$/,""),t._string_content=null},canContain:function(){return!1},acceptsLines:!0},paragraph:{continue:function(e){return e.blank?1:0},finalize:function(e,t){for(var n,r=!1;91===Um(t._string_content,0)&&(n=e.inlineParser.parseReference(t._string_content,e.refmap));)t._string_content=t._string_content.slice(n),r=!0;r&&function(e){return!Rm.test(e)}(t._string_content)&&t.unlink()},canContain:function(){return!1},acceptsLines:!0}},Vm=[function(e){return e.indented||62!==Um(e.currentLine,e.nextNonspace)?0:(e.advanceNextNonspace(),e.advanceOffset(1,!1),jm(Um(e.currentLine,e.offset))&&e.advanceOffset(1,!0),e.closeUnmatchedBlocks(),e.addChild("block_quote",e.nextNonspace),1)},function(e){var t;if(!e.indented&&(t=e.currentLine.slice(e.nextNonspace).match(Mm))){e.advanceNextNonspace(),e.advanceOffset(t[0].length,!1),e.closeUnmatchedBlocks();var n=e.addChild("heading",e.nextNonspace);return n.level=t[0].trim().length,n._string_content=e.currentLine.slice(e.offset).replace(/^[ \t]*#+[ \t]*$/,"").replace(/[ \t]+#+[ \t]*$/,""),e.advanceOffset(e.currentLine.length-e.offset),2}return 0},function(e){var t;if(!e.indented&&(t=e.currentLine.slice(e.nextNonspace).match(Dm))){var n=t[0].length;e.closeUnmatchedBlocks();var r=e.addChild("code_block",e.nextNonspace);return r._isFenced=!0,r._fenceLength=n,r._fenceChar=t[0][0],r._fenceOffset=e.indent,e.advanceNextNonspace(),e.advanceOffset(n,!1),2}return 0},function(e,t){if(!e.indented&&60===Um(e.currentLine,e.nextNonspace)){var n,r=e.currentLine.slice(e.nextNonspace);for(n=1;n<=7;n++)if(Tm[n].test(r)&&(n<7||"paragraph"!==t.type&&(e.allClosed||e.blank||"paragraph"!==e.tip.type)))return e.closeUnmatchedBlocks(),e.addChild("html_block",e.offset)._htmlBlockType=n,2}return 0},function(e,t){var n;if(!e.indented&&"paragraph"===t.type&&(n=e.currentLine.slice(e.nextNonspace).match(Fm))){var r;for(e.closeUnmatchedBlocks();91===Um(t._string_content,0)&&(r=e.inlineParser.parseReference(t._string_content,e.refmap));)t._string_content=t._string_content.slice(r);if(t._string_content.length>0){var i=new cp("heading",t.sourcepos);return i.level="="===n[0][0]?1:2,i._string_content=t._string_content,t.insertAfter(i),t.unlink(),e.tip=i,e.advanceOffset(e.currentLine.length-e.offset,!1),2}return 0}return 0},function(e){return!e.indented&&Am.test(e.currentLine.slice(e.nextNonspace))?(e.closeUnmatchedBlocks(),e.addChild("thematic_break",e.nextNonspace),e.advanceOffset(e.currentLine.length-e.offset,!1),2):0},function(e,t){var n,r,i;return e.indented&&"list"!==t.type||!(n=function(e,t){var n,r,i,s,o=e.currentLine.slice(e.nextNonspace),a={type:null,tight:!0,bulletChar:null,start:null,delimiter:null,padding:null,markerOffset:e.indent};if(e.indent>=4)return null;if(n=o.match(Om))a.type="bullet",a.bulletChar=n[0][0];else{if(!(n=o.match(Pm))||"paragraph"===t.type&&1!=n[1])return null;a.type="ordered",a.start=parseInt(n[1]),a.delimiter=n[2]}if(-1!==(r=Um(e.currentLine,e.nextNonspace+n[0].length))&&9!==r&&32!==r)return null;if("paragraph"===t.type&&!e.currentLine.slice(e.nextNonspace+n[0].length).match(Rm))return null;e.advanceNextNonspace(),e.advanceOffset(n[0].length,!0),i=e.column,s=e.offset;do{e.advanceOffset(1,!0),r=Um(e.currentLine,e.offset)}while(e.column-i<5&&jm(r));var l=-1===Um(e.currentLine,e.offset),c=e.column-i;return c>=5||c<1||l?(a.padding=n[0].length+1,e.column=i,e.offset=s,jm(Um(e.currentLine,e.offset))&&e.advanceOffset(1,!0)):a.padding=n[0].length+c,a}(e,t))?0:(e.closeUnmatchedBlocks(),"list"===e.tip.type&&(i=n,(r=t._listData).type===i.type&&r.delimiter===i.delimiter&&r.bulletChar===i.bulletChar)||((t=e.addChild("list",e.nextNonspace))._listData=n),(t=e.addChild("item",e.nextNonspace))._listData=n,1)},function(e){return e.indented&&"paragraph"!==e.tip.type&&!e.blank?(e.advanceOffset(4,!0),e.closeUnmatchedBlocks(),e.addChild("code_block",e.offset),2):0}],Hm=function(e,t){for(var n,r,i,s=this.currentLine;e>0&&(i=s[this.offset]);)"\t"===i?(n=4-this.column%4,t?(this.partiallyConsumedTab=n>e,r=n>e?e:n,this.column+=r,this.offset+=this.partiallyConsumedTab?0:1,e-=r):(this.partiallyConsumedTab=!1,this.column+=n,this.offset+=1,e-=1)):(this.partiallyConsumedTab=!1,this.offset+=1,this.column+=1,e-=1)},Wm=function(){this.offset=this.nextNonspace,this.column=this.nextNonspaceColumn,this.partiallyConsumedTab=!1},Gm=function(){for(var e,t=this.currentLine,n=this.offset,r=this.column;""!==(e=t.charAt(n));)if(" "===e)n++,r++;else{if("\t"!==e)break;n++,r+=4-r%4}this.blank="\n"===e||"\r"===e||""===e,this.nextNonspace=n,this.nextNonspaceColumn=r,this.indent=this.nextNonspaceColumn-this.column,this.indented=this.indent>=4},Ym=function(e){var t,n,r=!0,i=this.doc;for(this.oldtip=this.tip,this.offset=0,this.column=0,this.blank=!1,this.partiallyConsumedTab=!1,this.lineNumber+=1,-1!==e.indexOf("\0")&&(e=e.replace(/\0/g,"")),this.currentLine=e;(n=i._lastChild)&&n._open;){switch(i=n,this.findNextNonspace(),this.blocks[i.type].continue(this,i)){case 0:break;case 1:r=!1;break;case 2:return;default:throw"continue returned illegal value, must be 0, 1, or 2"}if(!r){i=i._parent;break}}this.allClosed=i===this.oldtip,this.lastMatchedContainer=i;for(var s="paragraph"!==i.type&&$m[i.type].acceptsLines,o=this.blockStarts,a=o.length;!s;){if(this.findNextNonspace(),!this.indented&&!Im.test(e.slice(this.nextNonspace))){this.advanceNextNonspace();break}for(var l=0;l<a;){var c=o[l](this,i);if(1===c){i=this.tip;break}if(2===c){i=this.tip,s=!0;break}l++}if(l===a){this.advanceNextNonspace();break}}if(this.allClosed||this.blank||"paragraph"!==this.tip.type){this.closeUnmatchedBlocks(),this.blank&&i.lastChild&&(i.lastChild._lastLineBlank=!0),t=i.type;for(var d=this.blank&&!("block_quote"===t||"code_block"===t&&i._isFenced||"item"===t&&!i._firstChild&&i.sourcepos[0][0]===this.lineNumber),u=i;u;)u._lastLineBlank=d,u=u._parent;this.blocks[t].acceptsLines?(this.addLine(),"html_block"===t&&i._htmlBlockType>=1&&i._htmlBlockType<=5&&Cm[i._htmlBlockType].test(this.currentLine.slice(this.offset))&&(this.lastLineLength=e.length,this.finalize(i,this.lineNumber))):this.offset<e.length&&!this.blank&&(i=this.addChild("paragraph",this.offset),this.advanceNextNonspace(),this.addLine())}else this.addLine();this.lastLineLength=e.length},Xm=function(e,t){var n=e._parent;e._open=!1,e.sourcepos[1]=[t,this.lastLineLength],this.blocks[e.type].finalize(this,e),this.tip=n},Zm=function(e){var t,n,r,i=e.walker();for(this.inlineParser.refmap=this.refmap,this.inlineParser.options=this.options;n=i.next();)r=(t=n.node).type,n.entering||"paragraph"!==r&&"heading"!==r||this.inlineParser.parse(t)},Jm=function(){return new cp("document",[[1,1],[0,0]])},Qm=function(e){this.doc=new Jm,this.tip=this.doc,this.refmap={},this.lineNumber=0,this.lastLineLength=0,this.offset=0,this.column=0,this.lastMatchedContainer=this.doc,this.currentLine="",this.options.time&&console.time("preparing input");var t=e.split(Nm),n=t.length;10===e.charCodeAt(e.length-1)&&(n-=1),this.options.time&&console.timeEnd("preparing input"),this.options.time&&console.time("block parsing");for(var r=0;r<n;r++)this.incorporateLine(t[r]);for(;this.tip;)this.finalize(this.tip,n);return this.options.time&&console.timeEnd("block parsing"),this.options.time&&console.time("inline parsing"),this.processInlines(this.doc),this.options.time&&console.timeEnd("inline parsing"),this.doc};const eg=function(e){return{doc:new Jm,blocks:$m,blockStarts:Vm,tip:this.doc,oldtip:this.doc,currentLine:"",lineNumber:0,offset:0,column:0,nextNonspace:0,nextNonspaceColumn:0,indent:0,indented:!1,blank:!1,partiallyConsumedTab:!1,allClosed:!0,lastMatchedContainer:this.doc,refmap:{},lastLineLength:0,inlineParser:new Em(e),findNextNonspace:Gm,advanceOffset:Hm,advanceNextNonspace:Wm,addLine:qm,addChild:Km,incorporateLine:Ym,finalize:Xm,processInlines:Zm,closeUnmatchedBlocks:zm,parse:Qm,options:e||{}}};function tg(){}tg.prototype.render=function(e){var t,n,r=e.walker();for(this.buffer="",this.lastOut="\n";t=r.next();)this[n=t.node.type]&&this[n](t.node,t.entering);return this.buffer},tg.prototype.out=function(e){this.lit(e)},tg.prototype.lit=function(e){this.buffer+=e,this.lastOut=e},tg.prototype.cr=function(){"\n"!==this.lastOut&&this.lit("\n")},tg.prototype.esc=function(e){return e};const ng=tg;var rg=/^javascript:|vbscript:|file:|data:/i,ig=/^data:image\/(?:png|gif|jpeg|webp)/i,sg=function(e){return rg.test(e)&&!ig.test(e)};function og(e){(e=e||{}).softbreak=e.softbreak||"\n",this.esc=e.esc||Sp,this.disableTags=0,this.lastOut="\n",this.options=e}og.prototype=Object.create(ng.prototype),og.prototype.text=function(e){this.out(e.literal)},og.prototype.html_inline=function(e){this.options.safe?this.lit("\x3c!-- raw HTML omitted --\x3e"):this.lit(e.literal)},og.prototype.html_block=function(e){this.cr(),this.options.safe?this.lit("\x3c!-- raw HTML omitted --\x3e"):this.lit(e.literal),this.cr()},og.prototype.softbreak=function(){this.lit(this.options.softbreak)},og.prototype.linebreak=function(){this.tag("br",[],!0),this.cr()},og.prototype.link=function(e,t){var n=this.attrs(e);t?(this.options.safe&&sg(e.destination)||n.push(["href",this.esc(e.destination)]),e.title&&n.push(["title",this.esc(e.title)]),this.tag("a",n)):this.tag("/a")},og.prototype.image=function(e,t){t?(0===this.disableTags&&(this.options.safe&&sg(e.destination)?this.lit('<img src="" alt="'):this.lit('<img src="'+this.esc(e.destination)+'" alt="')),this.disableTags+=1):(this.disableTags-=1,0===this.disableTags&&(e.title&&this.lit('" title="'+this.esc(e.title)),this.lit('" />')))},og.prototype.emph=function(e,t){this.tag(t?"em":"/em")},og.prototype.strong=function(e,t){this.tag(t?"strong":"/strong")},og.prototype.paragraph=function(e,t){var n=e.parent.parent,r=this.attrs(e);null!==n&&"list"===n.type&&n.listTight||(t?(this.cr(),this.tag("p",r)):(this.tag("/p"),this.cr()))},og.prototype.heading=function(e,t){var n="h"+e.level,r=this.attrs(e);t?(this.cr(),this.tag(n,r)):(this.tag("/"+n),this.cr())},og.prototype.code=function(e){this.tag("code"),this.out(e.literal),this.tag("/code")},og.prototype.code_block=function(e){var t=e.info?e.info.split(/\s+/):[],n=this.attrs(e);t.length>0&&t[0].length>0&&n.push(["class","language-"+this.esc(t[0])]),this.cr(),this.tag("pre"),this.tag("code",n),this.out(e.literal),this.tag("/code"),this.tag("/pre"),this.cr()},og.prototype.thematic_break=function(e){var t=this.attrs(e);this.cr(),this.tag("hr",t,!0),this.cr()},og.prototype.block_quote=function(e,t){var n=this.attrs(e);t?(this.cr(),this.tag("blockquote",n),this.cr()):(this.cr(),this.tag("/blockquote"),this.cr())},og.prototype.list=function(e,t){var n="bullet"===e.listType?"ul":"ol",r=this.attrs(e);if(t){var i=e.listStart;null!==i&&1!==i&&r.push(["start",i.toString()]),this.cr(),this.tag(n,r),this.cr()}else this.cr(),this.tag("/"+n),this.cr()},og.prototype.item=function(e,t){var n=this.attrs(e);t?this.tag("li",n):(this.tag("/li"),this.cr())},og.prototype.custom_inline=function(e,t){t&&e.onEnter?this.lit(e.onEnter):!t&&e.onExit&&this.lit(e.onExit)},og.prototype.custom_block=function(e,t){this.cr(),t&&e.onEnter?this.lit(e.onEnter):!t&&e.onExit&&this.lit(e.onExit),this.cr()},og.prototype.esc=Sp,og.prototype.out=function(e){this.lit(this.esc(e))},og.prototype.tag=function(e,t,n){if(!(this.disableTags>0)){if(this.buffer+="<"+e,t&&t.length>0)for(var r,i=0;void 0!==(r=t[i]);)this.buffer+=" "+r[0]+'="'+r[1]+'"',i++;n&&(this.buffer+=" /"),this.buffer+=">",this.lastOut=">"}},og.prototype.attrs=function(e){var t=[];if(this.options.sourcepos){var n=e.sourcepos;n&&t.push(["data-sourcepos",String(n[0][0])+":"+String(n[0][1])+"-"+String(n[1][0])+":"+String(n[1][1])])}return t};const ag=og;var lg=/\<[^>]*\>/;function cg(e){return e.replace(/([a-z])([A-Z])/g,"$1_$2").toLowerCase()}function dg(e){e=e||{},this.disableTags=0,this.lastOut="\n",this.indentLevel=0,this.indent="  ",this.esc=e.esc||Sp,this.options=e}function ug(){return ug=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},ug.apply(this,arguments)}function hg(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}dg.prototype=Object.create(ng.prototype),dg.prototype.render=function(e){var t,n;this.buffer="";var r,i,s,o,a,l,c=e.walker(),d=this.options;for(d.time&&console.time("rendering"),this.buffer+='<?xml version="1.0" encoding="UTF-8"?>\n',this.buffer+='<!DOCTYPE document SYSTEM "CommonMark.dtd">\n';r=c.next();)if(s=r.entering,l=(i=r.node).type,o=i.isContainer,a="thematic_break"===l||"linebreak"===l||"softbreak"===l,n=cg(l),s){switch(t=[],l){case"document":t.push(["xmlns","http://commonmark.org/xml/1.0"]);break;case"list":null!==i.listType&&t.push(["type",i.listType.toLowerCase()]),null!==i.listStart&&t.push(["start",String(i.listStart)]),null!==i.listTight&&t.push(["tight",i.listTight?"true":"false"]);var u=i.listDelimiter;if(null!==u){var h;h="."===u?"period":"paren",t.push(["delimiter",h])}break;case"code_block":i.info&&t.push(["info",i.info]);break;case"heading":t.push(["level",String(i.level)]);break;case"link":case"image":t.push(["destination",i.destination]),t.push(["title",i.title]);break;case"custom_inline":case"custom_block":t.push(["on_enter",i.onEnter]),t.push(["on_exit",i.onExit])}if(d.sourcepos){var p=i.sourcepos;p&&t.push(["sourcepos",String(p[0][0])+":"+String(p[0][1])+"-"+String(p[1][0])+":"+String(p[1][1])])}if(this.cr(),this.out(this.tag(n,t,a)),o)this.indentLevel+=1;else if(!o&&!a){var m=i.literal;m&&this.out(this.esc(m)),this.out(this.tag("/"+n))}}else this.indentLevel-=1,this.cr(),this.out(this.tag("/"+n));return d.time&&console.timeEnd("rendering"),this.buffer+="\n",this.buffer},dg.prototype.out=function(e){this.disableTags>0?this.buffer+=e.replace(lg,""):this.buffer+=e,this.lastOut=e},dg.prototype.cr=function(){if("\n"!==this.lastOut){this.buffer+="\n",this.lastOut="\n";for(var e=this.indentLevel;e>0;e--)this.buffer+=this.indent}},dg.prototype.tag=function(e,t,n){var r="<"+e;if(t&&t.length>0)for(var i,s=0;void 0!==(i=t[s]);)r+=" "+i[0]+'="'+this.esc(i[1])+'"',s++;return n&&(r+=" /"),r+">"},dg.prototype.esc=Sp;class pg extends g{constructor(e){super(e),hg(this,"handleStatus",((e,t)=>{this.setState({status:t})})),hg(this,"userColor",new fe(this.props.event.getSender())),hg(this,"openEditor",(()=>this.setState({responding:!0}))),hg(this,"closeEditor",(()=>this.setState({responding:!1}))),hg(this,"resend",(e=>Ye.client.resendEvent(this.props.event))),hg(this,"redactMessage",(()=>{Ye.client.redactEvent(this.props.event.getRoomId(),this.props.event.getId())})),this.state={responding:!1,status:e.event.getAssociatedStatus()}}componentDidMount(){this.props.event.getAssociatedStatus()&&this.props.event.on("Event.status",this.handleStatus)}componentWillUnmount(){this.props.event.off("Event.status",this.handleStatus)}render(e,t){const n=e.reactions[e.event.getId()]?e.reactions[e.event.getId()].filter((e=>"m.annotation"===e.getContent()["m.relates_to"].rel_type)):[],r=Ye.client.getUserId()===e.event.getSender();return h(m,null,h("div",{"data-event-status":r?t.status:null,id:e.event.getId(),style:e.styleOverride||this.userColor.styleVariables,class:r?"message-frame message-from-user":"message-frame"},e.children,"not_sent"===t.status?h("div",{class:"message-frame-status"},"message not sent - ",h("a",{onclick:this.resend},"resend?")):null,h(mg,{event:e.event,reactions:n},e.displayOnly?null:r?h(yg,{canEdit:!!e.getCurrentEdit,responding:t.responding,openEditor:this.openEditor,redactMessage:this.redactMessage}):h(fg,{responding:t.responding,openEditor:this.openEditor,event:e.event,reactions:n}))),t.responding?r?h(vg,{closeEditor:this.closeEditor,getCurrentEdit:e.getCurrentEdit,event:e.event}):h(bg,{closeEditor:this.closeEditor,getCurrentEdit:this.getCurrentEdit,event:e.event}):null)}}class mg extends g{shouldComponentUpdate(e){return this.props.reactions.length!==e.reactions.length}render(e){const t={};for(const n of e.reactions){const e=n.getContent()?.["m.relates_to"]?.key;e&&(t[e]?t[e]=t[e]+1:t[e]=1)}const n=[];for(const r in t)n.push(h(gg,{reactions:e.reactions,event:e.event,rtable:t,rkey:r}));return h("div",{class:"message-decoration"},n.length<1?null:h("div",{class:"message-reactions"},h("div",null,n)),e.children)}}class gg extends g{constructor(...e){super(...e),hg(this,"checkEmoji",(e=>this.props.reactions.find((e=>e.getSender()===Ye.client.getUserId()&&e.getContent()?.["m.relates_to"]?.key===this.props.rkey)))),hg(this,"increment",(e=>{Ye.client.sendEvent(this.props.event.getRoomId(),"m.reaction",{"m.relates_to":{rel_type:"m.annotation",event_id:this.props.event.getId(),key:this.props.rkey}})})),hg(this,"decrement",(e=>{Ye.client.redactEvent(e.getRoomId(),e.getId())})),hg(this,"onClick",(e=>{const t=this.checkEmoji();t?this.decrement(t):this.increment()}))}render(e){return h("div",{onClick:this.onClick,class:"emoji-badge"},h("span",null,e.rtable[e.rkey]),h("span",null,e.rkey))}}class fg extends g{constructor(e){super(e),hg(this,"checkEmoji",(e=>this.props.reactions.some((t=>t.getSender()===Ye.client.getUserId()&&t.getContent()?.["m.relates_to"]?.key===e)))),hg(this,"actions",{current:null}),hg(this,"clearCarefully",(e=>{e.target!==this.actions.current&&(this.actions.current.contains(e.target)||document.body.contains(e.target)&&this.clearSelecting())})),hg(this,"react",(e=>t=>{this.clearSelecting(),this.checkEmoji(e)||Ye.client.sendEvent(this.props.event.getRoomId(),"m.reaction",{"m.relates_to":{rel_type:"m.annotation",event_id:this.props.event.getId(),key:e}})})),hg(this,"handleEmojiClick",(e=>this.react(e.detail.unicode)())),hg(this,"selectEmoji",(e=>this.setState({selecting:"emoji"}))),hg(this,"pickEmoji",(e=>this.setState({selecting:"emoji-picker"}))),hg(this,"clearSelecting",(e=>this.setState({selecting:null}))),this.state={selecting:null}}componentDidUpdate(e,t){!t.selecting&&this.state.selecting&&window.addEventListener("click",this.clearCarefully),t.selecting||this.state.selecting||window.removeEventListener("click",this.clearCarefully)}render(e,t){switch(t.selecting){case"emoji-picker":return h("div",{ref:this.actions,"data-active":!0,class:"message-actions"},h("emoji-picker",{"onemoji-click":this.handleEmojiClick}),h("button",{key:"a",style:{position:"relative",left:"250px"},onclick:this.clearSelecting},et));case"emoji":return h("div",{ref:this.actions,"data-active":!0,class:"message-actions"},h("button",{key:"b",onclick:this.react("")},""),h("button",{key:"c",onclick:this.react("")},""),h("button",{key:"f",onclick:this.react("")},""),h("button",{key:"d",onclick:this.react("")},""),h("button",{key:"e",onclick:this.react("")},""),h("button",{key:"g",onclick:this.pickEmoji},ut));default:return h("div",{ref:this.actions,class:"message-actions"},!e.responding&&h(np,{placement:"top-start",theme:"small",content:"reply to this message"},h("button",{key:"h","aria-label":"Reply to this message",onclick:e.openEditor},Et)),h(np,{placement:"top-start",theme:"small",content:"React to this message"},h("button",{key:"i","aria-label":"React to this message",class:"reaction",onclick:this.selectEmoji},Tt)))}}}function yg(e){return h("div",{class:"message-actions"},!e.responding&&e.canEdit&&h(np,{placement:"top-end",theme:"small",content:"Edit this message"},h("button",{"aria-label":"Edit this message",onclick:e.openEditor},Ct)),h(np,{placement:"top-end",theme:"small",content:"Delete this message"},h("button",{"aria-label":"Delete this message",onclick:e.redactMessage,class:"redact"},At)))}class vg extends g{constructor(e){super(e),hg(this,"input",{current:null}),hg(this,"handleKeydown",(e=>{e.stopPropagation(),"Enter"===e.key&&e.ctrlKey&&(e.preventDefault(),this.sendResponse())})),hg(this,"handleInput",(e=>this.setValue(e.target.value,this.resize()))),hg(this,"setValue",((e,t)=>this.setState({value:e},t))),hg(this,"resize",(()=>{this.input.current.style.height="auto",this.input.current.style.height=`${this.input.current.scrollHeight}px`})),hg(this,"sendResponse",(()=>{const e=new eg,t=new ag,n=e.parse(Qd(this.state.value)),r=t.render(n),i={body:this.state.value,msgtype:"m.text",format:"org.matrix.custom.html",formatted_body:r};Kd(this.currentContent)&&(i["m.relates_to"]=this.currentContent["m.relates_to"],i.body=Gd(this.currentContent)+i.body,i.formatted_body=function(e){const t=e.formatted_body;return t?(new DOMParser).parseFromString(t,"text/html").body.querySelector("mx-reply").outerHTML:""}(this.currentContent)+i.formatted_body);const s={body:"an edit occurred",msgtype:"m.text","m.new_content":i,"m.relates_to":{rel_type:"m.replace",event_id:this.props.event.getId()}};Ye.client.sendEvent(this.props.event.getRoomId(),"m.reaction",s).then((e=>this.props.closeEditor()))})),hg(this,"popupActions",{"@":e=>h(jd,ug({roomId:this.props.event.getRoomId()},e)),":":e=>h(Fd,e)}),this.currentContent=e.getCurrentEdit(),Kd(this.currentContent)?this.setState({value:$d(this.currentContent.body)}):this.setState({value:this.currentContent.body})}componentDidMount(){this.resize()}render(e,t){return h("div",{class:"replyComposer"},h(Ld,{textValue:t.value,textarea:this.input,actions:this.popupActions,setTextValue:this.setValue}),h("textarea",{ref:this.input,value:t.value,onkeydown:this.handleKeydown,oninput:this.handleInput,"data-gramm":"false"}),h("button",{onclick:this.sendResponse},"Submit Changes"),h("button",{onclick:this.props.closeEditor},"Cancel"))}}class bg extends g{constructor(...e){super(...e),hg(this,"input",{current:null}),hg(this,"handleKeydown",(e=>{e.stopPropagation(),"Enter"===e.key&&e.ctrlKey&&(e.preventDefault(),this.sendResponse())})),hg(this,"handleInput",(e=>{this.setValue(e.target.value),this.input.current.style.height="auto",this.input.current.style.height=`${this.input.current.scrollHeight}px`})),hg(this,"setValue",((e,t)=>this.setState({value:e},t))),hg(this,"sendResponse",(()=>{const e=new eg,t=new ag,n=e.parse(Qd(this.state.value)),r=t.render(n);Ye.client.sendMessage(this.props.event.getRoomId(),{body:Vd(this.props.event)+this.state.value,formatted_body:Hd(this.props.event)+r,format:"org.matrix.custom.html",msgtype:"m.text","m.relates_to":{"m.in_reply_to":{event_id:this.props.event.getId()}}}).then((e=>this.props.closeEditor()))})),hg(this,"popupActions",{"@":e=>h(jd,ug({roomId:this.props.event.getRoomId()},e)),":":e=>h(Fd,e)})}render(e,t){return h("div",{class:"replyComposer"},h(Ld,{textValue:t.value,textarea:this.input,setTextValue:this.setValue,actions:this.popupActions}),h("textarea",{ref:this.input,value:t.value,onkeydown:this.handleKeydown,oninput:this.handleInput,"data-gramm":"false"}),h("button",{onclick:this.sendResponse},"Send Reply"),h("button",{onclick:this.props.closeEditor},"Cancel"))}}var wg=__webpack_require__(9688),Sg={};function _g(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}Sg.styleTagTransform=Ie(),Sg.setAttributes=Ee(),Sg.insert=ke().bind(null,"head"),Sg.domAPI=Se(),Sg.insertStyleElement=Ce(),be()(wg.Z,Sg),wg.Z&&wg.Z.locals&&wg.Z.locals;class kg extends g{constructor(...e){super(...e),_g(this,"messageBody",{current:null}),_g(this,"getEdits",(()=>this.props.reactions[this.props.event.getId()]?this.props.reactions[this.props.event.getId()].filter((e=>"m.replace"===e.getContent()["m.relates_to"].rel_type)):[])),_g(this,"getCurrentEdit",(()=>{const e=this.getEdits();return e.length>0?e[e.length-1].getContent()["m.new_content"]:this.props.event.getContent()}))}componentDidMount(){fl(this.messageBody.current),yl(this.messageBody.current)}componentDidUpdate(e){this.props.reactions[this.props.event.getId()]!==e.reactions[e.event.getId()]&&(fl(this.messageBody.current),yl(this.messageBody.current))}render(e){const t=this.getCurrentEdit(),n=Kd(t);return h(pg,{displayOnly:e.displayOnly,reactions:e.reactions,event:e.event,getCurrentEdit:this.getCurrentEdit},h("div",{ref:this.messageBody,class:"message-body"},n?h(Tg,{reactions:e.reactions,event:e.event}):null,h(Ag,{content:t})))}}class xg extends g{constructor(...e){super(...e),_g(this,"messageBody",{current:null}),_g(this,"sender",Ye.client.getUser(this.props.event.getSender())),_g(this,"userColor",new fe(this.props.event.getSender()))}componentDidMount(){fl(this.messageBody.current),yl(this.messageBody.current)}componentDidUpdate(e){this.props.reactions[this.props.event.getId()]!==e.reactions[e.event.getId()]&&(fl(this.messageBody.current),yl(this.messageBody.current))}render(e){const t=e.event.getContent();return h(pg,{displayOnly:e.displayOnly,reactions:e.reactions,event:e.event},h("div",{ref:this.messageBody,class:"message-body"},h("div",{class:"emote-banner",style:this.userColor.styleVariables},this.sender.displayName,":"),h(Ag,{content:t})))}}class Eg extends g{constructor(...e){super(...e),_g(this,"handleClick",(e=>{this.hasFocus()&&this.props.setSecondaryFocus(null)})),_g(this,"handleLinkClick",(e=>{e.stopPropagation(),this.hasFocus()||this.props.setSecondaryFocus(this.location)})),_g(this,"sender",Ye.client.getUser(this.props.event.getSender())),_g(this,"userColor",new fe(this.props.event.getSender())),_g(this,"location",new Zt(this.props.event)),_g(this,"text",this.location.getText()),_g(this,"pageNumber",this.location.getPageIndex()),_g(this,"hasFocus",(e=>this.location===this.props.secondaryFocus))}render(e){if(this.text)return h(pg,{styleOverride:this.hasFocus()?{background:this.userColor.ultralight,...this.userColor.styleVariables}:null,reactions:e.reactions,event:e.event,getCurrentEdit:this.getCurrentEdit},h("div",{onClick:this.handleClick,class:"message-body"},h("span",{class:"annotation-banner"},"On",h("a",{onClick:this.handleLinkClick,href:`${window.location.origin}${window.location.pathname}#/${encodeURIComponent(e.pdfFocused)}/${this.pageNumber}/`},"page ",this.pageNumber),":"),h("blockquote",null,this.text)))}}class Tg extends g{constructor(...e){super(...e),_g(this,"getCurrentEdit",(()=>{const e=this.getEdits();return e.length>0?e[e.length-1].getContent()["m.new_content"]:this.state.liveEvent.getContent()})),_g(this,"getEdits",(()=>this.props.reactions[this.state.liveEvent.getId()]?this.props.reactions[this.state.liveEvent.getId()].filter((e=>"m.replace"===e.getContent()["m.relates_to"].rel_type)):[])),_g(this,"replyPreview",{current:null}),_g(this,"fromLiveEvent",(e=>{const t=this.getCurrentEdit(),n="org.matrix.custom.html"===t.format&&t.formatted_body,r=Kd(t),i=new fe(this.state.liveEvent.getSender());let s;if(this.state.liveEvent.getContent().msgtype)switch(this.state.liveEvent.getContent().msgtype){case"m.video":{const e=this.state.liveEvent.getContent().info.thumbnail_url,t=e?Ye.client.getHttpUriForMxcFromHS(e):null;s=h("video",{class:"media-message-thumbnail",controls:!0,poster:t,preload:t?"none":"metadata",src:Ye.client.getHttpUriForMxcFromHS(this.state.liveEvent.getContent().url)});break}case"m.image":{const e=this.state.liveEvent.getContent().info.thumbnail_url;s=h("img",{class:"media-message-thumbnail",src:e?Ye.client.getHttpUriForMxcFromHS(e):null});break}case"m.audio":s=h("audio",{controls:!0,src:Ye.client.getHttpUriForMxcFromHS(this.state.liveEvent.getContent().url)});break;case"m.file":s=h("div",{class:"file-upload"},"file upload:",h("a",{href:Ye.client.getHttpUriForMxcFromHS(this.state.liveEvent.getContent().url)},this.state.liveEvent.getContent().filename));break;case"m.text":case"m.notice":s=r&&n?h("div",{dangerouslySetInnerHTML:{__html:Sr()(t.formatted_body,Yd)}}):n?h("div",{dangerouslySetInnerHTML:{__html:t.formatted_body}}):h("div",null,r?"Replies.stripFallbackPlainString(content.body)":"content.body")}else s=h("div",{class:"redacted-preview"},"Original Message Deleted");return h(m,null,h("div",{class:"reply-preface"},"In reply to:"),h(bl,{isReply:!0,userId:this.state.liveEvent.getSender()}),h("div",{ref:this.replyPreview,style:i.styleVariables,class:"reply-preview"},s))})),_g(this,"fallbackPreview",(e=>{const t=this.props.event.getContent(),n={"--user_light":"lightgray"};return"org.matrix.custom.html"===t.format&&t.formatted_body?h("div",{style:n,class:"reply-preview reply-fallback",dangerouslySetInnerHTML:{__html:Wd(t)}}):h("div",{style:n,class:"reply-preview reply-fallback"},function(e){return Gd(e).map((e=>e.slice(2)))}(t))}))}componentDidMount(){this.getLiveEvent(),fl(this.replyPreview.current),yl(this.replyPreview.current)}componentDidUpdate(){this.getLiveEvent(),fl(this.replyPreview.current),yl(this.replyPreview.current)}async getLiveEvent(){if(!this.state.liveEvent){const e=this.props.event.getContent()["m.relates_to"]["m.in_reply_to"].event_id,t=this.props.event.getRoomId(),n=Ye.client.getRoom(t);if(!n)return;const r=n.findEventById(e);r&&this.setState({liveEvent:r});try{console.log("trying to retrive live event"),await Ye.client.getEventTimeline(n.getUnfilteredTimelineSet(),e),console.log("retrived"),this.setState({liveEvent:n.findEventById(e)})}catch(e){console.log("couldn't retrieve - is this a dendrite server? see https://github.com/matrix-org/dendrite/issues/670"),console.log(e)}}}render(e,t){return t.liveEvent?this.fromLiveEvent():this.fallbackPreview()}}class Cg extends g{constructor(...e){super(...e),_g(this,"messageBody",{current:null}),_g(this,"noticeStyle",{"--user_ultralight":"hsl(0,0%, 95%)","--user_light":"hsl(0,0%, 80%)","--user_solid":"hsl(0,0%, 50%)","--user_dark":"hsl(0,0%, 20%)"})}componentDidMount(){fl(this.messageBody.current)}componentDidUpdate(e){this.props.reactions[this.props.event.getId()]!==e.reactions[e.event.getId()]&&fl(this.messageBody.current)}render(e){const t=e.event.getContent(),n=Kd(t);return h(pg,{displayOnly:e.displayOnly,reactions:e.reactions,styleOverride:this.noticeStyle,event:e.event,getCurrentEdit:this.getCurrentEdit},h("div",{ref:this.messageBody,class:"message-body"},n?h(Tg,{reactions:e.reactions,event:e.event}):null,h(Ag,{content:t})))}}function Ag(e){const t=e.content,n=Kd(t),r=/^\s*(\p{Extended_Pictographic}\p{Emoji_Component}*){1,3}\s*$/u.test(t.body);return!r&&"org.matrix.custom.html"===t.format&&t.formatted_body?h("div",{dangerouslySetInnerHTML:{__html:Sr()(n?Sr()(t.formatted_body,Yd):t.formatted_body,Ve)}}):h("div",{class:r?"large-emoji-display":null},n?zd(t.body):t.body)}class Ig extends g{constructor(...e){super(...e),_g(this,"userColor",new fe(this.props.event.getSender())),_g(this,"isMe",this.props.event.getSender()===Ye.client.getUserId()),_g(this,"url",Ye.client.getHttpUriForMxcFromHS(this.props.event.getContent().url))}render(e){const t=e.event.getContent().filename;return h(pg,{displayOnly:e.displayOnly,reactions:e.reactions,event:e.event},h("div",{class:"message-body file-upload"},"file upload:",h("a",{href:this.url,download:t},t)))}}class Rg extends g{constructor(...e){super(...e),_g(this,"userColor",new fe(this.props.event.getSender())),_g(this,"isMe",this.props.event.getSender()===Ye.client.getUserId()),_g(this,"url",this.props.event.getContent().info.thumbnail_url?Ye.client.getHttpUriForMxcFromHS(this.props.event.getContent().info.thumbnail_url):Ye.client.getHttpUriForMxcFromHS(this.props.event.getContent().url))}render(e){return h(pg,{displayOnly:e.displayOnly,reactions:e.reactions,event:e.event},h("div",{class:"message-body image-upload"},h("img",{class:"media-message-thumbnail",src:this.url})))}}class Og extends g{constructor(...e){super(...e),_g(this,"userColor",new fe(this.props.event.getSender())),_g(this,"isMe",this.props.event.getSender()===Ye.client.getUserId()),_g(this,"content",this.props.event.getContent()),_g(this,"poster",this.content.info.thumbnail_url?Ye.client.getHttpUriForMxcFromHS(this.content.info.thumbnail_url):null),_g(this,"url",Ye.client.getHttpUriForMxcFromHS(this.content.url))}render(e){return h(pg,{displayOnly:e.displayOnly,reactions:e.reactions,event:e.event},h("div",{class:"message-body image-upload"},h("video",{class:"media-message-thumbnail",controls:!0,poster:this.poster,preload:this.poster?"none":"metadata",src:this.url})))}}class Pg extends g{constructor(...e){super(...e),_g(this,"userColor",new fe(this.props.event.getSender())),_g(this,"isMe",this.props.event.getSender()===Ye.client.getUserId()),_g(this,"content",this.props.event.getContent()),_g(this,"url",Ye.client.getHttpUriForMxcFromHS(this.content.url))}render(e){return h(pg,{displayOnly:e.displayOnly,reactions:e.reactions,event:e.event},h("div",{class:"message-body image-upload"},h("audio",{controls:!0,src:this.url})))}}function Mg(e){const t=Ye.client.getRoom(e.getRoomId());if(t){const n=t.getLiveTimeline().getEvents(),r=t.getAccountData("m.fully_read"),i=r?r.getContent().event_id:null;if(i)for(let t=n.length-1;t>=0;--t){if(i===n[t].getId())return!1;if(e.getId()===n[t].getId())return!0}}return!0}var Dg=__webpack_require__(3519),Lg={};function Fg(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}Lg.styleTagTransform=Ie(),Lg.setAttributes=Ee(),Lg.insert=ke().bind(null,"head"),Lg.domAPI=Se(),Lg.insertStyleElement=Ce(),be()(Dg.Z,Lg),Dg.Z&&Dg.Z.locals&&Dg.Z.locals;class Ng extends g{constructor(e){super(e),Fg(this,"scrollAnchor",{current:null}),Fg(this,"updateEvents",(e=>this.setState({events:this.notificationWindow.getEvents().reverse()}))),Fg(this,"tryBackfill",(e=>{const t=this.scrollAnchor.current.base;!this.state.fullyLoaded&&window.innerHeight-t.getBoundingClientRect().top>0&&(this.notificationWindow.canPaginate(me.EventTimeline.BACKWARDS)?this.notificationWindow.paginate(me.EventTimeline.BACKWARDS,10).then((e=>setTimeout((e=>{this.setState({events:this.notificationWindow.getEvents().reverse()},this.tryBackfill)}),200))):this.setState({fullyLoaded:!0}))})),Fg(this,"handleTimeline",((e,t)=>{t||this.notificationPromise.then((e=>this.notificationWindow.paginate(me.EventTimeline.FORWARDS,1,!1))).then(this.updateEvents)})),Fg(this,"handleRoom",(e=>{clearTimeout(this.inviteDebounceTimeout),this.inviteDebounceTimeout=setTimeout((e=>{this.setState({invites:this.getInvites()})}),500)})),Fg(this,"handleScroll",(e=>{clearTimeout(this.scrollDebounceTimeout),this.scrollDebounceTimeout=setTimeout((e=>{this.tryBackfill()}),200)})),Fg(this,"toMilestone",(e=>h("div",{class:"notification-date-indicator"},e))),Fg(this,"toNotification",(e=>"m.text"===e.getContent().msgtype?h(Ug,{event:e,key:e.getId()}):null)),this.state={events:[],invites:this.getInvites(),fullyLoaded:!1},this.notificationPromise=this.loadNotificationWindow(),this.handleScroll=this.handleScroll.bind(this)}componentDidMount(){document.addEventListener("scroll",this.handleScroll),Ye.client.on("Room",this.handleRoom),Ye.client.on("RoomState.events",this.handleRoom),Ye.client.on("Room.timeline",this.handleTimeline),this.notificationPromise.then(this.updateEvents).then(this.tryBackfill)}componentWillUnmount(){document.removeEventListener("scroll",this.handleScroll),Ye.client.off("Room",this.handleRoom),Ye.client.off("RoomState.events",this.handleRoom),Ye.client.off("Room.timeline",this.handleTimeline)}async loadNotificationWindow(){this.notificationWindow=new me.TimelineWindow(Ye.client,Ye.client.getNotifTimelineSet()),await this.notificationWindow.load()}getInvites(){return Ye.client.getVisibleRooms().filter((e=>"invite"===e.getMyMembership())).filter((e=>"m.space"===e.getLiveTimeline().getState(me.EventTimeline.FORWARDS).getStateEvents("m.room.create","")?.getContent()?.type)).map((e=>h(qg,{handleRoom:this.handleRoom,key:e.roomId,room:e})))}render(e,t){return h("div",{id:"notifications-listing"},t.invites,function(e,t,n){const r=Date.now();let i=r;return e.reduce(((e,s)=>{const o=n(s),a=r-s.getTs(),l=i-s.getTs();if(o){let n;if(a<3e5&&l>6e4){i=s.getTs();const e=Math.floor(a/6e4);n=`${e} minute${1===e?"":"s"} ago`}else if(a<36e5&&l>6e5){i=s.getTs();const e=Math.floor(a/6e4);n=`${e} minute${1===e?"":"s"} ago`}else if(a<864e5&&l>36e5){i=s.getTs();const e=Math.floor(a/36e5);n=`${e} hour${1===e?"":"s"} ago`}else l>864e5&&(i=s.getTs(),n=`on ${new Date(i).toLocaleDateString("en-US",{weekday:"long",year:"numeric",month:"long",day:"numeric"})}`);n&&e.push(t(n)),e.push(o)}return e}),[])}(t.events,this.toMilestone,this.toNotification),h(jg,{ref:this.scrollAnchor,fullyLoaded:t.fullyLoaded}))}}function jg(e){return e.fullyLoaded?h("div",null,h("div",{id:"scroll-done"},"All notifications loaded")):h("div",{id:"scroll-anchor"},"loading...")}function Ug(e){return h(Bg,{event:e.event},h(kg,{reactions:{},displayOnly:!0,event:e.event}))}class Bg extends g{constructor(e){super(e),Fg(this,"userColor",new fe(this.props.event.getSender())),Fg(this,"userDisplayName",Ye.client.getUser(this.props.event.getSender()).displayName),Fg(this,"avatarUrl",Ye.client.getUser(this.props.event.getSender()).avatarUrl),Fg(this,"avatarHttpURI",Ye.client.getHttpUriForMxcFromHS(this.avatarUrl,20,20,"crop")),Fg(this,"originRoom",Ye.client.getRoom(this.props.event.getRoomId())),Fg(this,"originPDF",this.originRoom.getLiveTimeline().getState(me.EventTimeline.BACKWARDS).getStateEvents(Fe)?.[0].getStateKey()),Fg(this,"originAlias",this.originPDF?Ye.client.getRoom(this.originPDF)?.getCanonicalAlias():null),Fg(this,"originAnnotation",this.originPDF?Ye.client.getRoom(this.originPDF)?.getLiveTimeline().getState(me.EventTimeline.BACKWARDS).getStateEvents(Le,this.originRoom.roomId):null),Fg(this,"originAnnotationRoom",this.originAnnotation?Ye.client.getRoom(this.originAnnotation.getStateKey()):null),Fg(this,"topic",this.originAnnotationRoom&&this.originAnnotationRoom.getLiveTimeline().getState(me.EventTimeline.FORWARDS).getStateEvents("m.room.topic","")?.getContent().topic||""),Fg(this,"handleClick",(e=>{const t=new Zt(this.originAnnotation);Vn.push(`/${encodeURIComponent(this.originAlias.slice(1))}/${t.getPageIndex()}/${t.getChild()}`)})),this.state={unread:Mg(e.event)},this.checkUnread=this.checkUnread.bind(this)}componentDidMount(){Ye.client.on("Room.accountData",this.checkUnread)}componentWillUnmount(){Ye.client.off("Room.accountData",this.checkUnread)}checkUnread(e,t){t?.roomId===this.props.event.getRoomId()&&this.setState({unread:Mg(this.props.event)})}render(e,t){return Ye.client.getRoom(this.originPDF)?h("div",{onclick:this.originAlias?this.handleClick:null,class:t.unread?"notification unread-notification":"notification",style:this.userColor.styleVariables},Ye.client.getRoom(this.originPDF)?.name?h("div",{class:"discussion-intro"},"In ",h("b",null,Ye.client.getRoom(this.originPDF).name),", discussing"):h("div",{class:"discussion-intro"},"Discussing"),h("div",{class:"discussion-topic"},this.topic),h("div",{class:"notification-header"},this.avatarHttpURI?h("img",{src:this.avatarHttpURI}):null,h("span",{class:"sender"},this.userDisplayName),"said:"),h("div",{class:"notification-contents"},e.children)):h("div",{class:t.unread?"notification unread-notification":"notification",style:this.userColor.styleVariables},h("div",{class:"notification-header"},"Notification from departed room"))}}class qg extends g{constructor(...e){super(...e),Fg(this,"accept",(e=>{Ye.client.joinRoom(this.props.room.roomId),setTimeout(this.props.handleRoom,1e3)})),Fg(this,"decline",(e=>{Ye.client.leave(this.props.room.roomId),setTimeout(this.props.handleRoom,1e3)}))}render(e){return h("div",{class:"invite-entry"},h("div",{class:"invite-heading"},"You are invited to join the discussion ",e.room.name,"."),h("div",{class:"invite-buttons"},h("button",{class:"styled-button",onclick:this.accept},"Accept"),h("button",{class:"styled-button",onclick:this.decline},"Decline")))}}var Kg=__webpack_require__(7384),zg={};zg.styleTagTransform=Ie(),zg.setAttributes=Ee(),zg.insert=ke().bind(null,"head"),zg.domAPI=Se(),zg.insertStyleElement=Ce(),be()(Kg.Z,zg),Kg.Z&&Kg.Z.locals&&Kg.Z.locals;class $g extends g{constructor(e){super(e),this.state={syncStatus:this.fromState(Ye.client.getSyncState())},this.handleSync=this.handleSync.bind(this)}fromState(e){switch(e){case"PREPARED":case"CATCHUP":return"loading data...";case"ERROR":return"no connection - working offline";default:return null}}componentDidMount(){Ye.client.on("sync",this.handleSync)}componentWillUnmount(){Ye.client.off("sync",this.handleSync)}handleSync(e,t){"PREPARED"===t&&Ye.client.emit("sync.initial"),this.setState({syncStatus:this.fromState(e)})}render(e,t){return t.syncStatus?h("div",{class:e.class,id:"sync-indicator"},t.syncStatus):null}}var Vg=__webpack_require__(5188),Hg={};function Wg(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}Hg.styleTagTransform=Ie(),Hg.setAttributes=Ee(),Hg.insert=ke().bind(null,"head"),Hg.domAPI=Se(),Hg.insertStyleElement=Ce(),be()(Vg.Z,Hg),Vg.Z&&Vg.Z.locals&&Vg.Z.locals;class Gg extends g{constructor(e){super(e),Wg(this,"resizeListener",(e=>{clearTimeout(this.resizeDebounce),this.resizeDebounce=setTimeout((e=>document.body.offsetWidth>600?this.state.narrow?this.setState({view:"COLLECTION"===this.state.view?null:this.state.view,narrow:!1}):null:this.state.narrow?null:this.setState({narrow:!0})),500)})),Wg(this,"setSearch",(e=>this.setState({searchFilter:e}))),Wg(this,"setFilterItems",(e=>this.setState({filterItems:e}))),Wg(this,"submitSearch",(e=>{this.setState((e=>({searchFilter:"",filterItems:e.filterItems.concat(Fn(e.searchFilter).map((e=>({display:e,value:e}))))})))})),Wg(this,"setFocus",(e=>this.setState({inputFocus:e,view:null}))),Wg(this,"toggleUploadVisible",(e=>this.setState((e=>"UPLOAD"===e.view?{view:null}:{view:"UPLOAD"})))),Wg(this,"toggleProfileVisible",(e=>this.setState((e=>"PROFILE"===e.view?{view:null}:{view:"PROFILE"})))),Wg(this,"toggleNotifVisible",(e=>this.setState((e=>"NOTIF"===e.view?{view:null}:{view:"NOTIF"})))),Wg(this,"toggleCollectionVisible",(e=>this.setState((e=>"COLLECTION"===e.view?{view:null}:{view:"COLLECTION"})))),Wg(this,"showMainView",(e=>this.setState({view:null}))),this.state={view:null,inputFocus:!1,searchFilter:"",filterItems:[],narrow:document.body.offsetWidth<=600}}componentDidMount(){window.addEventListener("resize",this.resizeListener)}componentWillUnmount(){window.removeEventListener("resize",this.resizeListener)}render(e,t){return h(m,{key:"welcome-fragment"},h("header",{id:"welcome-header"},h("div",{id:"welcome-header-content"},h(dn,{search:t.searchFilter,setSearch:this.setSearch,submit:this.submitSearch,hint:"/",setFocus:this.setFocus}),(!t.inputFocus||!t.narrow)&&h(m,null,t.narrow?h("button",{"data-active":"COLLECTION"===t.view,id:"welcome-collection",onClick:this.toggleCollectionVisible},Kt):null,h("button",{"data-active":"UPLOAD"===t.view,id:"welcome-upload",onClick:this.toggleUploadVisible},lt),h(Yg,{active:"NOTIF"===t.view,toggleNotifVisible:this.toggleNotifVisible}),h(Xg,{active:"PROFILE"===t.view,toggleProfileVisible:this.toggleProfileVisible})))),h("div",{id:"welcome-container"},"UPLOAD"===t.view?h(Yt,{showMainView:this.showMainView}):"PROFILE"===t.view?h(br,{logoutHandler:e.logoutHandler,showMainView:this.showMainView}):"NOTIF"===t.view?h(Ng,null):"COLLECTION"===t.view?h("div",{class:"welcome-column"},h(dr,{narrow:t.narrow,showMainView:this.showMainView,setFilterItems:this.setFilterItems,filterItems:t.filterItems})):t.narrow?h(Yn,{narrow:t.narrow,setFilterItems:this.setFilterItems,filterItems:t.filterItems,searchFilter:t.searchFilter}):h("div",{id:"welcome-split"},h(dr,{setFilterItems:this.setFilterItems,filterItems:t.filterItems,narrow:t.narrow}),h(Yn,{narrow:t.narrow,setFilterItems:this.setFilterItems,filterItems:t.filterItems,searchFilter:t.searchFilter}))),h($g,null))}}class Yg extends g{constructor(e){super(e);const t=Ye.client.getVisibleRooms().reduce(((e,t)=>e+(t.getUnreadNotificationCount("highlight")||0)),0),n=Ye.client.getVisibleRooms().filter((e=>"invite"===e.getMyMembership())).filter((e=>"m.space"===e.getLiveTimeline().getState(me.EventTimeline.FORWARDS).getStateEvents("m.room.create","")?.getContent()?.type)).length;this.state={count:t+n},this.updateCount=this.updateCount.bind(this)}componentDidMount(){Ye.client.on("sync",this.updateCount),Ye.client.on("RoomState.events",this.updateCount)}componentWillUnmount(){Ye.client.off("sync",this.updateCount),Ye.client.off("RoomState.events",this.updateCount)}updateCount(){const e=Ye.client.getVisibleRooms().reduce(((e,t)=>e+(t.getUnreadNotificationCount("highlight")||0)),0),t=Ye.client.getVisibleRooms().filter((e=>"invite"===e.getMyMembership())).filter((e=>e.getLiveTimeline().getState(me.EventTimeline.FORWARDS).getStateEvents("m.room.create","")?.getContent()?.[je])).length;this.setState({count:e+t})}render(e,t){return h("button",{"data-active":e.active,id:"welcome-notifications",onClick:e.toggleNotifVisible},It,t.count>0?h("span",{class:"small-icon-badge"},t.count):null)}}class Xg extends g{constructor(e){super(e),Wg(this,"profileListener",(e=>{this.setState({avatarUrl:Ye.client.getHttpUriForMxcFromHS(this.user.avatarUrl,30,30,"crop")})})),Wg(this,"displayInitial",(e=>"@"===this.user.displayName.slice(0,1)?this.user.displayName.slice(1,2):this.user.displayName.slice(0,1)));const t=Ye.client.getUserId();this.user=Ye.client.getUser(t),this.userColor=new fe(t),this.state={avatarUrl:Ye.client.getHttpUriForMxcFromHS(this.user.avatarUrl,30,30,"crop")}}componentDidMount(){Ye.client.on("sync",this.profileListener)}componentWillUnmount(){Ye.client.off("sync",this.profileListener)}render(e,t){return h("button",{"data-active":e.active,id:"welcome-profile",onClick:e.toggleProfileVisible,style:this.userColor.styleVariables},t.avatarUrl?h("img",{id:"welcome-img",src:t.avatarUrl}):h("span",{id:"welcome-initial"},this.displayInitial()))}}var Zg=__webpack_require__(2462),Jg={};function Qg(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}Jg.styleTagTransform=Ie(),Jg.setAttributes=Ee(),Jg.insert=ke().bind(null,"head"),Jg.domAPI=Se(),Jg.insertStyleElement=Ce(),be()(Zg.Z,Jg),Zg.Z&&Zg.Z.locals&&Zg.Z.locals;class ef extends g{constructor(e){super(e),Qg(this,"switchView",(e=>t=>{t&&t.preventDefault(),this.setState({registering:e})})),Qg(this,"setServer",(e=>this.setState({server:e}))),Qg(this,"setName",(e=>this.setState({name:e}))),Qg(this,"setPassword",(e=>this.setState({password:e})));const t=new URLSearchParams(window.location.search);this.state={registering:!!t.get("sso")&&"SSO",name:"",password:"",server:t.get("server")||""}}render(e,t){const n={setServer:this.setServer,server:t.server,setName:this.setName,name:t.name,setPassword:this.setPassword,password:t.password,loginHandler:e.loginHandler,switchView:this.switchView};switch(t.registering){case"register":return h("div",null,h(rf,n));case"SSO":return h("div",null,h(nf,n))}return h("div",null,h(tf,n))}}class tf extends g{constructor(...e){super(...e),Qg(this,"handleSubmit",(e=>{e.preventDefault(),this.setState({submitting:!0});const t=document.getElementById("loginForm"),n=new FormData(t),r=Array.from(n.entries()).map((e=>e[1]));r[2]?localStorage.setItem("baseUrl",`https://${r[2]}`):localStorage.setItem("baseUrl",De),Ye.initClient().then((e=>e.loginWithPassword(r[0].toLowerCase(),r[1]))).then(this.props.loginHandler).catch((e=>{this.setState({submitting:!1}),window.alert(e)}))})),Qg(this,"handleSSO",(e=>e.preventDefault()))}render(e,t){return h("div",{id:"login"},h("h3",null,"Login To Populus"),h("form",{id:"loginForm",onSubmit:this.handleSubmit},h(sf,{setServer:e.setServer,server:e.server,setPassword:e.setPassword,password:e.password,setName:e.setName,name:e.name}),h("div",null,h("button",{disabled:t.submitting,class:"styled-button"},"Login")),h("div",null,h("span",null,"Don't have a username? "),h("div",{class:"login-options"},h("button",{class:"styled-button",disabled:t.submitting,onClick:e.switchView("register")},"Register"),h("span",null,"or "),h("button",{class:"styled-button",disabled:t.submitting,onClick:e.switchView("SSO")},"Login Via SSO")))))}}class nf extends g{constructor(e){super(e),Qg(this,"handleSubmit",(e=>{e.preventDefault();const t=document.getElementById("loginForm"),n=new FormData(t),r=Array.from(n.entries()).map((e=>e[1]));r[0]?localStorage.setItem("baseUrl",`https://${r[0]}`):localStorage.setItem("baseUrl",De),this.setState({SSOProviders:[],loading:!0}),Ye.initClient().then((e=>e.loginFlows())).then(this.handleFlows).catch((e=>{window.alert("Couldn't connect. Check your server name - it should look like 'matrix.org'"),this.setState({loading:!1})}))})),Qg(this,"handleFlows",(e=>{const t=e.flows.find((e=>"m.login.sso"===e.type));if(!t)return window.alert("This server doesn't appear to support SSO login."),void this.setState({loading:!1});this.setState({loading:!1,SSOProviders:t.identity_providers})})),Qg(this,"trySSO",((e,t,n)=>{n?.preventDefault(),t&&localStorage.setItem("baseUrl",`https://${t}`),Ye.client?window.location.replace(Ye.client.getSsoLoginUrl(window.location.href,"sso",e)):Ye.initClient().then((t=>{window.location.replace(t.getSsoLoginUrl(window.location.href,"sso",e))}))})),Qg(this,"handleServerInput",(e=>this.props.setServer(e.target.value)));const t=new URLSearchParams(window.location.search);this.state={SSOProviders:[],loading:!1},this.props.server&&t.get("sso")&&this.trySSO(t.get("sso"),t.get("server"))}render(e,t){return h("div",{id:"login"},h("h3",null,"Sign In To Populus"),h("form",{id:"loginForm"},h("div",null,h("label",{htmlFor:"servername"},"Server"),h("input",{id:"servername",value:e.server,oninput:this.handleServerInput,type:"text",name:"servername",placeholder:"populus.open-tower.com"}),h("button",{class:"styled-button",onClick:this.handleSubmit},"Look up SSO")),t.loading?h("div",{id:"server-loading-message"},"Loading..."):null,t.SSOProviders.map((t=>{let n=null;return t.icon&&(n=me.getHttpUriForMxc(localStorage.getItem("baseUrl"),t.icon,40,40,"crop")),h("div",{onclick:e=>this.trySSO(t.id,null,e),class:"login-sso-listing",key:t.id},n?h("img",{class:"sso-icon",width:"40",height:"40",src:n}):Pt,h("a",{class:"sso-name",href:`?server=${encodeURIComponent(e.server)}&sso=${encodeURIComponent(t.id)}`},t.name))})),h("div",null,h("span",null,"Don't want to use a third-party login? "),h("button",{class:"styled-button",onClick:e.switchView("register")},"Register an Account"))))}}class rf extends g{constructor(e){super(e),Qg(this,"registerForm",{current:null}),Qg(this,"beginRegistrationFlow",(async e=>{e.preventDefault(),this.setState({registrationStage:"retrieving-auth"});const t=this.registerForm.current,n=new FormData(t),r=Array.from(n.entries()).map((e=>e[1]));if(/[^a-zA-Z0-9._=/]/.test(r[0]))return alert("Usernames must consist of characters which are alphanumeric, or among '.' ,'/' ,'=' , and '_'."),void this.props.switchView("login")();if(this.username=r[0],r[1].length<8)return alert("passwords must be at least 8 characters long"),void this.props.switchView("login")();this.password=r[1],r[2]?this.server=`https://${r[2]}`:this.server=De,localStorage.setItem("baseUrl",this.server),await Ye.initClient();try{await Ye.client.register(this.username.toLowerCase(),this.password,void 0,{})}catch(e){e.data?.session&&e.data.params["m.login.recaptcha"]?(this.authSession=e.data.session,this.recaptchaKey=e.data.params["m.login.recaptcha"].public_key,this.setState({registrationStage:"awaiting-recaptcha"})):("ConnectionError"===e.name?alert(`Can't connect to a server at\n\n${this.server}\n\n Double-check that address?`):alert("Error: can't start recaptcha registration flow with this server"),this.setState({registrationStage:"awaiting-server"}))}})),Qg(this,"recaptchaHandler",(e=>{e.preventDefault(),this.setState({registrationStage:"registering"}),Ye.client.register(this.username.toLowerCase(),this.password,this.authSession,{type:"m.login.recaptcha",response:e.detail}).catch(this.handleDummy).then((e=>Ye.client.loginWithPassword(this.username.toLowerCase(),this.password))).then(this.props.loginHandler).catch(window.alert)})),Qg(this,"handleDummy",(e=>{if(console.log(e.data),(t=e.data).flows&&t.completed&&t.flows.some((e=>{const n=e.stages.filter((e=>!t.completed.includes(e)));return 1===n.length&&n.includes("m.login.dummy")})))return Ye.client.register(this.username.toLowerCase(),this.password,this.authSession,{type:"m.login.dummy"});var t;throw new Error("Error: can't complete this registration flow")})),this.state={registrationStage:"awaiting-server"},this.recaptchaHandler=this.recaptchaHandler.bind(this)}componentDidMount(){window.addEventListener("recaptcha",this.recaptchaHandler)}componentWillUnmount(){window.removeEventListener("recaptcha",this.recaptchaHandler)}render(e,t){switch(t.registrationStage){case"retrieving-auth":return h("div",{id:"registration"},h("div",{id:"registeringFeedback"},"Retrieving Authentication Procedures..."));case"registering":return h("div",{id:"registration"},h("div",{id:"registeringFeedback"},"Registering Account..."));case"awaiting-recaptcha":return h("div",{id:"registration"},h("form",{id:"registerForm"},h("div",{id:"theRecaptcha"},"Complete this Recaptcha to finish registration",h("div",{class:"g-recaptcha","data-sitekey":this.recaptchaKey,"data-callback":"recaptchaHandler"})),h("div",null,"OR, ",h("button",{class:"styled-button",onClick:e.switchView("login")},"Login With Existing Account")),h("script",{src:"https://www.google.com/recaptcha/api.js",async:!0,defer:!0})));case"awaiting-server":return h("div",{id:"registration"},h("h3",null,"Register an account"),h("form",{onSubmit:this.beginRegistrationFlow,ref:this.registerForm,id:"registerForm"},h(sf,{newAccount:!0,setServer:e.setServer,server:e.server,setPassword:e.setPassword,password:e.password,setName:e.setName,name:e.name}),h("div",null,h("button",{class:"styled-button"},"Register a New Account")),h("div",null,h("span",null,"Already have an account? "),h("div",{class:"login-options"},h("button",{class:"styled-button",onClick:e.switchView("login")},"Login With Existing Account")))))}}}class sf extends g{constructor(...e){super(...e),Qg(this,"usernameInput",{current:null}),Qg(this,"passwordInput",{current:null}),Qg(this,"validateUsername",(e=>{this.props.setName(e.target.value),/[^a-zA-Z0-9._=/]/.test(e.target.value)?this.usernameInput.current.setCustomValidity("Bad Character"):this.usernameInput.current.setCustomValidity("")})),Qg(this,"validatePassword",(e=>{this.props.setPassword(e.target.value),e.target.value.length<8&&e.target.value.length>0?this.passwordInput.current.setCustomValidity("Bad Password"):this.passwordInput.current.setCustomValidity("")})),Qg(this,"handleServerInput",(e=>this.props.setServer(e.target.value)))}render(e){return h(m,null,h("label",{htmlFor:"username"},"Username"),h("input",{autocomplete:"username",value:e.name,onInput:this.validateUsername,type:"text",ref:this.usernameInput,id:"username",name:"username"}),h("label",{htmlFor:"password"},"Password"),h("input",{autocomplete:e.newAccount?"new-password":"current-password",value:e.password,oninput:this.validatePassword,type:"password",ref:this.passwordInput,id:"password",name:"password"}),h("label",{htmlFor:"servername"},"Server"),h("input",{value:e.server,oninput:this.handleServerInput,type:"text",id:"servername",name:"servername",placeholder:"populus.open-tower.com"}))}}var of=__webpack_require__(3723),af={};af.styleTagTransform=Ie(),af.setAttributes=Ee(),af.insert=ke().bind(null,"head"),af.domAPI=Se(),af.insertStyleElement=Ce(),be()(of.Z,af),of.Z&&of.Z.locals&&of.Z.locals;var lf=__webpack_require__(8046),cf={};function df(e,t,n){const r=t.offsetParent;t.style.left=e.left-r.offsetLeft/n+"px",t.style.top=e.top-r.offsetTop/n+"px",t.style.height=`${e.height}px`,t.style.width=`${e.width}px`}cf.styleTagTransform=Ie(),cf.setAttributes=Ee(),cf.insert=ke().bind(null,"head"),cf.domAPI=Se(),cf.insertStyleElement=Ce(),be()(lf.Z,cf),lf.Z&&lf.Z.locals&&lf.Z.locals;var uf=__webpack_require__(5789),hf={};function pf(e){const t=e.getRangeAt(0);return Array.from(t.cloneContents().childNodes).map((e=>3===e.nodeType?e.data:1===e.nodeType?e.innerText:"")).join(" ").replace(/(.)-\s+/g,"$1")}function mf(e,t,n){return n?e.nextSibling?mf(e.nextSibling,t):e.parentNode?mf(e.parentNode,t,!0):null:t(e)?e:e.firstChild?mf(e.firstChild,t):e.nextSibling?mf(e.nextSibling,t):e.parentNode?mf(e.parentNode,t,!0):null}function gf(e){const t=[],n=t=>3===t.nodeType||t===e;let r=mf(e,n);if(r===e)return[e];for(t.push(r);(r=mf(r,n,!0))!==e;)t.push(r);return t}function ff(e,t,n){const r=document.createRange();return r.selectNode(e),t&&r.setStart(e,t),n&&r.setEnd(e,n),r.getBoundingClientRect()}hf.styleTagTransform=Ie(),hf.setAttributes=Ee(),hf.insert=ke().bind(null,"head"),hf.domAPI=Se(),hf.insertStyleElement=Ce(),be()(uf.Z,hf),uf.Z&&uf.Z.locals&&uf.Z.locals;class yf extends g{constructor(e){var t,n;super(e),n={current:null},(t="theCanvas")in this?Object.defineProperty(this,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):this[t]=n;const r=new(window.AudioContext||window.webkitAudioContext);this.analyser=r.createAnalyser(),r.createMediaStreamSource(e.stream).connect(this.analyser),this.analyser.fftSize=2048,this.bufferLength=this.analyser.frequencyBinCount,this.dataArray=new Uint8Array(this.bufferLength),this.draw=this.draw.bind(this)}componentDidMount(){this.width=this.theCanvas.current.width,this.height=this.theCanvas.current.height,this.canvasCtx=this.theCanvas.current.getContext("2d"),this.canvasCtx.clearRect(0,0,this.width,this.height),this.draw()}componentWillUnmount(){this.breakDraw=!0}draw(){this.analyser.getByteTimeDomainData(this.dataArray),this.canvasCtx.fillStyle="rgb(0, 0, 0)",this.canvasCtx.fillRect(0,0,this.width,this.height),this.canvasCtx.lineWidth=2,this.canvasCtx.strokeStyle="rgb(200, 200, 200)",this.canvasCtx.beginPath();const e=1*this.width/this.bufferLength;let t=0;for(let n=0;n<this.bufferLength;n++){const r=this.dataArray[n]/128*this.height/2;0===n?this.canvasCtx.moveTo(t,r):this.canvasCtx.lineTo(t,r),t+=e}this.canvasCtx.lineTo(this.width,this.height/2),this.canvasCtx.stroke(),this.breakDraw||requestAnimationFrame(this.draw)}render(e){return h("canvas",{class:"audioVisualizer",height:e.height,width:e.width,ref:this.theCanvas})}}function vf(){return vf=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},vf.apply(this,arguments)}function bf(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class wf extends g{constructor(e){super(e),bf(this,"userColor",new fe(Ye.client.getUserId())),bf(this,"theInput",{current:null}),bf(this,"setModeDefault",(e=>this.setState({mode:"Default"}))),bf(this,"setModeSendFile",(e=>this.setState({mode:"SendFile"}))),bf(this,"setModeSendImage",(e=>this.setState({mode:"SendMedia"}))),bf(this,"setModeRecordVideo",(e=>{navigator.mediaDevices&&navigator.mediaDevices.getUserMedia?this.setState({mode:"RecordVideo"}):alert("Your browser looks like it doesn't support accessing the webcam...")})),bf(this,"setModeRecordAudio",(e=>{navigator.mediaDevices&&navigator.mediaDevices.getUserMedia?this.setState({mode:"RecordAudio"}):alert("Your browser looks like it doesn't support accessing the webcam...")})),bf(this,"showMore",(e=>this.setState({buttons:this.state.buttons+1}))),bf(this,"showLess",(e=>this.setState({buttons:this.state.buttons-1}))),bf(this,"submitCurrentInput",(e=>{this.theInput.current&&this.theInput.current.submitInput()})),bf(this,"openPendingAnnotation",((e,t)=>{const n=Ye.client.getDomain();if("pending"===this.props.focus.getStatus()){const r={activityStatus:"open",rootEventId:t.event_id,rootContent:e},i=this.props.focus.location[Ue],s=this.props.focus.location[Be],o={via:[n],[qe]:{[ze]:Object.assign(this.props.focus.location[ze],r),...i&&{[Ue]:i},...s&&{[Be]:s}}};Ye.client.sendStateEvent(this.props.pdfId,Le,o,this.props.focus.getChild()).catch((e=>alert(e)))}})),bf(this,"sendSelection",(async e=>{const t=window.getSelection();if(t.isCollapsed)return;const n=pf(t),{clientQuads:r,boundingQuad:i}=this.props.quadsFromPdfSelection(t),s={[Ue]:{page_index:parseInt(this.props.pageFocused,10),rect:i.getBoundingRect(),quad_points:r.map((e=>e.getArray())),contents:"",text_content:n},[ze]:{activityStatus:"pending",creator:Ye.client.getUserId()}},o={body:"created an annotation",msgtype:"m.emote",[Ke]:{[Ne]:this.props.pdfId,[qe]:s}},a=await Ye.client.sendMessage(this.props.focus.getChild(),o);this.openPendingAnnotation(o,a)})),bf(this,"openSettings",(e=>{const t=Ye.client.getRoom(this.props.focus.getChild());sn.set(h(Ln,{room:t}))})),this.state={mode:"Default",buttons:1}}getInput(){const e={ref:this.theInput,submit:this.submitCurrentInput,roomId:this.props.focus.getChild(),handlePending:this.openPendingAnnotation,done:this.setModeDefault};switch(this.state.mode){case"Default":return h(kf,e);case"SendFile":return h(Sf,e);case"SendMedia":return h(_f,e);case"RecordVideo":return h(Ef,e);case"RecordAudio":return h(Tf,e)}}render(e,t){const n=Ye.client.getRoom(e.focus.getChild())?.getMember(Ye.client.getUserId()),r=!!n&&n.powerLevel>=100;return h("div",{style:this.userColor.styleVariables,id:"messageComposer"},this.getInput(),h("div",{id:"submit-button-wrapper"},"Default"===t.mode?1===t.buttons?h(m,null,h("button",{id:"submitButton",onclick:this.submitCurrentInput},"Submit"),h(np,{key:"record-audio",content:"Record audio message"},h("button",{"aria-label":"Record audio message",onclick:this.setModeRecordAudio},kt)),h(np,{key:"record-video",content:"Record video message"},h("button",{"aria-label":"Record video message",onclick:this.setModeRecordVideo},_t)),h(np,{key:"more-options",content:"More options"},h("button",{"aria-label":"More options",ref:this.showMoreButton,onclick:this.showMore},ut))):h(m,null,h(np,{key:"more-options-2",content:"More options"},h("button",{"aria-label":"More options",ref:this.showLessButton,onclick:this.showLess},ut)),h(np,{key:"quote-highlighted",content:"Quote highlighted"},h("button",{id:"quote-button",disabled:!e.hasSelection,"aria-label":"quote highlighted",onclick:this.sendSelection},qt)),h(np,{key:"upload-image",content:"Upload image"},h("button",{"aria-label":"Upload image",onclick:this.setModeSendImage},ot)),h(np,{key:"upload-file",content:"Upload file"},h("button",{"aria-label":"Upload file",onclick:this.setModeSendFile},it)),r?h(np,{key:"configure-room",content:"Configure room settings"},h("button",{"aria-label":"Configure room settings",onclick:this.openSettings},dt)):null):h(m,null,h("button",{id:"submitButton",onclick:this.submitCurrentInput},"Submit"),h("button",{id:"cancelButton",onclick:this.setModeDefault},"Cancel"))))}}class Sf extends g{constructor(...e){super(...e),bf(this,"fileLoader",{current:null}),bf(this,"theForm",{current:null}),bf(this,"submitInput",(async e=>{const t=this.fileLoader.current.files[0],n=await Ye.client.uploadContent(t,{progressHandler:this.progressHandler}).catch((e=>console.log(e))),r={body:t.name,filename:t.name,info:{mimetype:t.type?t.type:"application/octet-stream",size:t.size},msgtype:"m.file",url:n},i=await Ye.client.sendMessage(this.props.roomId,r);this.props.handlePending(r,i),this.props.done()})),bf(this,"progressHandler",(e=>this.setState({progress:e})))}render(){return h("form",{ref:this.theForm},h("input",{ref:this.fileLoader,type:"file"}),this.state.progress?h("div",{id:"pdfUploadFormProgress"},h("progress",{max:this.state.progress.total,value:this.state.progress.loaded})):null)}}class _f extends g{constructor(...e){super(...e),bf(this,"theForm",{current:null}),bf(this,"mediaLoader",{current:null}),bf(this,"mediaPreview",{current:null}),bf(this,"uploadImage",(e=>this.mediaLoader.current.click())),bf(this,"updatePreview",(e=>{const t=this.mediaLoader.current.files[0];t&&(/^video/.test(t.type)||/^image/.test(t.type))&&(this.setState({previewUrl:URL.createObjectURL(this.mediaLoader.current.files[0])}),/^video/.test(t.type)&&this.setState({mediaType:"video"}),/^image/.test(t.type)&&this.setState({mediaType:"image"}))})),bf(this,"getPreview",(e=>{switch(this.state.mediaType){case"image":return h("img",{ref:this.mediaPreview,class:"image-message-preview media-message-thumbnail",src:this.state.previewUrl});case"video":return h("video",{ref:this.mediaPreview,class:"video-message-preview media-message-thumbnail",controls:!0,src:this.state.previewUrl})}})),bf(this,"submitInput",(async e=>{let t;if(this.mediaPreview.current)switch(this.state.mediaType){case"image":t=await this.submitImage();break;case"video":t=await this.submitVideo()}this.props.done()})),bf(this,"progressHandler",(e=>this.setState({progress:e})))}async submitVideo(){const e=this.mediaLoader.current.files[0];window.theVideo=e;const t=await(n=e,new Promise(((e,t)=>{const r=document.createElement("video"),i=URL.createObjectURL(n);r.src=i,r.onloadeddata=t=>{URL.revokeObjectURL(i),e(r)},r.onerror=e=>t(e)})));var n;const r=await Rn(t,t.videoWidth,t.videoHeight,"image/jpeg"),i=await Ye.client.uploadContent(r.thumbnail,{name:`${e.name}_800x600`,type:"image/jpeg",progressHandler:this.progressHandler});console.log("upload video");const s=await Ye.client.uploadContent(e,{progressHandler:this.progressHandler}),o=Math.round(1e3*t.duration),a={body:e.name,info:{h:r.info.h,w:r.info.w,mimetype:e.type,size:e.size,thumbnail_url:i,thumbnail_info:r.info.thumbnail_info},msgtype:"m.video",url:s};o<1/0&&(a.duration=o),console.log("send video");const l=await Ye.client.sendMessage(this.props.roomId,a);this.props.handlePending(a,l)}async submitImage(){const e=this.mediaLoader.current.files[0],{width:t,height:n,img:r}=await On(e),i="image/jpeg"===e.type?"image/jpeg":"image/png",s=await Rn(r,t,n,i),o=await Ye.client.uploadContent(s.thumbnail,{name:`${e.name}_800x600`,type:i,progressHandler:this.progressHandler}),a=await Ye.client.uploadContent(e,{progressHandler:this.progressHandler}),l={body:e.name,info:{h:n,w:t,mimetype:e.type,size:e.size,thumbnail_url:o,thumbnail_info:s.thumbnail_info},msgtype:"m.image",url:a},c=await Ye.client.sendMessage(this.props.roomId,l);this.props.handlePending(l,c)}render(e,t){return h("form",{ref:this.theForm},h("input",{id:"mediaUploaderHidden",onchange:this.updatePreview,accept:"image/*,video/*",ref:this.mediaLoader,type:"file"}),t.previewUrl?this.getPreview():h("div",{onclick:this.uploadImage,class:"media-message-thumbnail awaiting"}),this.state.progress?h("div",{id:"pdfUploadFormProgress"},h("span",null,this.state.progress.loaded),h("span",null,"/"),h("span",null,this.state.progress.total," bytes")):null)}}class kf extends g{constructor(e){super(e),bf(this,"currentInput",{current:null}),bf(this,"startTyping",(e=>{Ye.client.sendTyping(this.props.roomId,!0,3e4),this.typingLock=!0,this.resetLockTimeout=setTimeout((e=>{this.typingLock=!1}),1e4)})),bf(this,"stopTyping",(e=>{this.typingLock=!1,clearTimeout(this.resetLockTimeout),clearTimeout(this.typingTimeout),Ye.client.sendTyping(this.props.roomId,!1)})),bf(this,"handleInput",(e=>{""===e.target.value&&this.stopTyping(),this.setValue(e.target.value),this.currentInput.current.style.height="auto",this.currentInput.current.style.height=`${this.currentInput.current.scrollHeight}px`})),bf(this,"setValue",((e,t)=>this.setState({value:e},t))),bf(this,"handleKeydown",(e=>{e.stopPropagation(),clearTimeout(this.typingTimeout),this.typingTimeout=setTimeout((e=>this.stopTyping()),5e3),"Enter"===e.code&&e.ctrlKey?(e.preventDefault(),this.props.submit()):this.typingLock||this.startTyping()})),bf(this,"submitInput",(e=>{if(this.props.roomId){if(this.stopTyping(),!this.state.value.replace(/\s/g,"").length)return;const e=this.reader.parse(Qd(this.state.value)),t=this.writer.render(e),n={body:this.state.value,msgtype:"m.text",format:"org.matrix.custom.html",formatted_body:t};Ye.client.sendMessage(this.props.roomId,n).then((e=>{this.props.handlePending(n,e)})),this.currentInput.current.style.height=null,this.setValue("")}})),bf(this,"popupActions",{"@":e=>h(jd,vf({roomId:this.props.roomId},e)),":":e=>h(Fd,e)}),this.state={value:""},this.reader=new eg,this.writer=new ag}render(e,t){return h(m,null,h(Ld,{textValue:t.value,textarea:this.currentInput,setTextValue:this.setValue,actions:this.popupActions}),h("textarea",{ref:this.currentInput,value:t.value,onkeydown:this.handleKeydown,oninput:this.handleInput,onblur:this.stopTyping,"data-gramm":"false"}))}}class xf extends g{constructor(...e){super(...e),bf(this,"mediaPreview",{current:null}),bf(this,"countdownToRecord",(async e=>{await this.initialization,this.state.countdown||this.setState({countdown:3,recording:"countdown"}),setTimeout((e=>{const t=this.state.countdown-1;if(this.setState({countdown:t}),0===t)return this.startRecord();this.countdownToRecord()}),1500)})),bf(this,"startRecord",(e=>{this.mediaRecorder.start(),this.setState({recording:"started"})})),bf(this,"finishRecord",(e=>{this.mediaRecorder.stop(),this.teardownStream(),this.setState({recording:"done"})})),bf(this,"progressHandler",(e=>this.setState({progress:e}))),bf(this,"recordingIcon",(e=>{switch(this.state.recording){case"started":return h("div",{"aria-label":"Stop recording","data-recording-state":this.state.recording,id:this.captionId},xt);case"countdown":return h("div",{"data-recording-state":this.state.recording,id:this.captionId},this.state.countdown);case"done":return null;case void 0:return h("div",{"aria-label":"Start recording","data-recording-state":this.state.recording,id:this.captionId},this.icon)}})),bf(this,"clickHandler",(()=>{switch(this.state.recording){case"started":return this.finishRecord();case"countdown":case"done":return null;case void 0:return this.countdownToRecord()}}))}componentDidMount(){this.initStream()}componentWillUnmount(){this.teardownStream()}async initStream(){try{let e;this.initialization=new Promise((t=>{e=t})),this.stream=await navigator.mediaDevices.getUserMedia(this.constraints),this.mediaPreview.current.srcObject=this.stream,this.mediaRecorder=new MediaRecorder(this.stream,this.recorderOptions),this.mediaRecorder.ondataavailable=e=>{this.setState({audioAvailable:!0}),this.recordingBlob=e.data,this.mediaPreview.current.srcObject=null,this.mediaPreview.current.setAttribute("controls",""),this.mediaPreview.current.src=URL.createObjectURL(e.data)},e()}catch(e){alert(e)}}async teardownStream(){await this.initialization,this.stream.getTracks().forEach((e=>e.stop()))}}class Ef extends xf{constructor(...e){super(...e),bf(this,"constraints",{audio:!0,video:{facingMode:"user"}}),bf(this,"recorderOptions",{mimeType:"video/webm",videoBitsPerSecond:1e6}),bf(this,"icon",_t),bf(this,"captionId","videoCaption")}async submitInput(){if("done"===this.state.recording){const e=this.mediaPreview.current,t=await Rn(e,e.videoWidth,e.videoHeight,"image/jpeg"),n=await Ye.client.uploadContent(t.thumbnail,{name:`${Ye.client.getUserId()}_${Date.now()}_thumbnail`,type:"image/jpeg",progressHandler:this.progressHandler}),r=await Ye.client.uploadContent(this.recordingBlob,{progressHandler:this.progressHandler}),i=Math.round(1e3*e.duration),s={body:`${Ye.client.getUserId()}_${Date.now()}`,info:{h:t.info.h,w:t.info.w,mimetype:"video/webm",size:this.recordingBlob.size,thumbnail_url:n,thumbnail_info:t.info.thumbnail_info},msgtype:"m.video",url:r};i<1/0&&(s.info.duration=i);const o=await Ye.client.sendMessage(this.props.roomId,s);this.props.handlePending(s,o),this.props.done()}else alert("Before submitting, you need to record something.")}render(e,t){return h("div",{id:"videoRecordingWrapper"},h("video",{autoplay:!0,onclick:this.clickHandler,muted:!("done"===t.recording),ref:this.mediaPreview,class:"video-message-preview media-message-thumbnail"}),this.recordingIcon(),t.progress?h("div",{id:"pdfUploadFormProgress"},h("span",null,t.progress.loaded),h("span",null,"/"),h("span",null,t.progress.total," bytes")):null)}}class Tf extends xf{constructor(...e){super(...e),bf(this,"constraints",{audio:!0,video:!1}),bf(this,"recorderOptions",{mimeType:"audio/webm"}),bf(this,"icon",kt),bf(this,"captionId","audioCaption")}async submitInput(){if("done"===this.state.recording){const e=this.mediaPreview.current,t=Math.round(1e3*e.duration),n=await Ye.client.uploadContent(this.recordingBlob,{progressHandler:this.progressHandler}),r={body:`${Ye.client.getUserId()}_${Date.now()}`,info:{mimetype:"audio/webm",size:this.recordingBlob.size},msgtype:"m.audio",url:n};t<1/0&&(r.info.duration=t);const i=await Ye.client.sendMessage(this.props.roomId,r);this.props.handlePending(r,i),this.props.done()}else alert("Before submitting, you need to record something")}render(e,t){return h(m,null,h("div",{onclick:this.clickHandler,id:"audioRecordingWrapper"},h("audio",{style:{display:t.audioAvailable?"block":"none"},ref:this.mediaPreview}),"started"===t.recording?h(yf,{stream:this.stream}):null,this.recordingIcon()),t.progress?h("div",{id:"pdfUploadFormProgress"},h("span",null,t.progress.loaded),h("span",null,"/"),h("span",null,t.progress.total," bytes")):null)}}function Cf(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class Af extends g{constructor(e){super(e),Cf(this,"chatWrapper",{current:null}),Cf(this,"scrollAnchor",{current:null}),Cf(this,"handleTimeline",(e=>{this.props.focus?.getChild()===e.getRoomId()&&this.timelinePromise.then((e=>this.timelineWindow.paginate(me.EventTimeline.FORWARDS,1,!1))).then(this.updateEvents)})),Cf(this,"handleScroll",(e=>{clearTimeout(this.debounceTimeout),this.debounceTimeout=setTimeout(this.tryBackfill,200)})),Cf(this,"tryBackfill",(e=>{const t=this.scrollAnchor.current.base;!this.state.fullyScrolled&&this.chatWrapper.current.getBoundingClientRect().top-5<t.getBoundingClientRect().top&&(this.timelineWindow.canPaginate(me.EventTimeline.BACKWARDS)?this.timelineWindow.paginate(me.EventTimeline.BACKWARDS,10).then((e=>setTimeout((e=>{this.setState({events:this.timelineWindow.getEvents()},this.tryBackfill)}),200))):(this.scrolledIdents.add(this.room.roomId),this.setState({fullyScrolled:!0})))})),Cf(this,"getTopic",(e=>this.room.getLiveTimeline().getState(me.EventTimeline.FORWARDS).getStateEvents("m.room.topic","")?.getContent().topic||"")),Cf(this,"updateEvents",(e=>{this.setState({topic:this.getTopic(),events:this.timelineWindow.getEvents()},this.updateReadReceipt)})),this.state={events:[],topic:"",fullyScrolled:!1},this.scrolledIdents=new Set,this.handleTimeline=this.handleTimeline.bind(this),this.timelinePromise=this.loadTimelineWindow(e.focus.getChild())}componentDidMount(){Ye.client.on("Room.timeline",this.handleTimeline),Ye.client.on("Room.localEchoUpdated",this.updateEvents),this.timelinePromise.then(this.updateEvents).then(this.tryBackfill)}componentWillUnmount(){Ye.client.off("Room.timeline",this.handleTimeline),Ye.client.off("Room.localEchoUpdated",this.updateEvents)}async componentDidUpdate(e){e.focus.getChild()!==this.props.focus.getChild()&&this.resetFocus()}async loadTimelineWindow(e){try{await Ye.client.joinRoom(this.props.focus.getChild(),{viaServers:this.props.focus.getVia()})}catch(e){return alert(e),void this.props.unsetFocus()}return this.room=await Ye.client.getRoomWithState(e),this.timelineWindow=new me.TimelineWindow(Ye.client,this.room.getUnfilteredTimelineSet()),this.timelineWindow.load(),!0}async updateReadReceipt(){clearTimeout(this.updateReadReceiptDebounce),this.updateReadReceiptDebounce=setTimeout((e=>{const t=this.state.events[this.state.events.length-1];if(t.getAssociatedStatus())return;const n=t.getId(),r=this.room.getEventReadUpTo(Ye.client.getUserId(),!0)!==n,i=n!==this.lastReceiptSentId;r&&i&&(console.log("sending receipt"),Ye.client.setRoomReadMarkers(this.room.roomId,n,t,{}).catch(console.log),Ye.client.sendReadReceipt(t,{}).then((e=>{this.room.setUnreadNotificationCount("total",0),this.room.setUnreadNotificationCount("hightlight",0),this.lastReceiptSentId=n})).catch(console.log))}),200)}async resetFocus(){this.timelinePromise=this.loadTimelineWindow(this.props.focus.getChild()),await this.timelinePromise,this.setState({topic:this.getTopic(),fullyScrolled:this.scrolledIdents.has(this.props.focus.getChild()),events:this.timelineWindow.getEvents()},(e=>{this.updateReadReceipt(),this.tryBackfill()}))}render(e,t){const n={},r=t.events.filter((e=>"m.room.message"===e.getType()&&("m.text"===e.getContent().msgtype||"m.emote"===e.getContent().msgtype||"m.notice"===e.getContent().msgtype||"m.file"===e.getContent().msgtype||"m.image"===e.getContent().msgtype||"m.video"===e.getContent().msgtype||"m.audio"===e.getContent().msgtype||0===Object.keys(e.getContent()).length)));let i=null;const s=r.reduce(((t,r)=>{switch(i&&i.getSender()===r.getSender()||(t.push(h(bl,{key:`${r.getId()}-userinfo`,userId:r.getSender(),isMe:r.getSender()===Ye.client.getUserId()})),i=r),r.getContent().msgtype){case"m.text":t.push(h(kg,{reactions:n,setFocus:e.setFocus,key:r.getId(),event:r}));break;case"m.notice":t.push(h(Cg,{reactions:n,key:r.getId(),event:r}));break;case"m.file":t.push(h(Ig,{reactions:n,key:r.getId(),event:r}));break;case"m.emote":r.getContent()[Ke]?t.push(h(Eg,{reactions:n,pdfFocused:e.pdfFocused,secondaryFocus:e.secondaryFocus,setSecondaryFocus:e.setSecondaryFocus,key:r.getId(),event:r})):t.push(h(xg,{reactions:n,key:r.getId(),event:r}));break;case"m.image":t.push(h(Rg,{reactions:n,key:r.getId(),event:r}));break;case"m.video":t.push(h(Og,{reactions:n,key:r.getId(),event:r}));break;case"m.audio":t.push(h(Pg,{reactions:n,key:r.getId(),event:r}));break;case void 0:i.getSender()===r.getSender()&&t.length>1&&t[t.length-1].type===If?t[t.length-1].props.count=t[t.length-1].props.count+1:t.push(h(If,{count:1,key:r.getId(),username:r.getSender(),isMe:r.getSender()===Ye.client.getUserId()}))}return t}),[]);return t.events.forEach((e=>{"m.reaction"===e.getType()&&e.getContent()?.["m.relates_to"]?.event_id&&(n[e.getContent()["m.relates_to"].event_id]?n[e.getContent()["m.relates_to"].event_id].push(e):n[e.getContent()["m.relates_to"].event_id]=[e])})),h("div",{ref:this.chatWrapper,class:e.class,onscroll:this.handleScroll,id:"chat-wrapper"},h("div",{id:"chat-panel"},h(wf,{hasSelection:e.hasSelection,quadsFromPdfSelection:e.quadsFromPdfSelection,pdfId:e.pdfId,pageFocused:e.pageFocused,focus:e.focus}),h("div",{id:"messages"},s,h(Of,{key:e.focus.getChild(),roomId:e.focus.getChild()})),h(Rf,{ref:this.scrollAnchor,focus:e.focus,topic:t.topic,fullyScrolled:t.fullyScrolled})))}}class If extends g{constructor(...e){super(...e),Cf(this,"userColor",new fe(this.props.username))}render(e){return e.isMe?h("div",{class:"redacted message-frame message-from-user",style:this.userColor.styleVariables},h("div",{class:"message-decoration"}),h("div",{class:"message-body"},e.count>1?`${e.count} messages deleted`:"message deleted")):h("div",{class:"redacted message-frame",style:this.userColor.styleVariables},h("div",{class:"message-decoration"}),h("div",{class:"message-body"},e.count>1?`${e.count} messages deleted`:"message deleted"))}}function Rf(e){return e.fullyScrolled?h("div",null,h("div",{id:"anchor-quote"},e.topic?h(m,null,h("span",null,qt),e.topic):null),"text"===e.focus.getType()?h("div",{id:"anchor-pin"},Ut," ",h("span",null,"on page ",e.focus.getPageIndex())):null,h("div",{id:"scroll-done"},"pending"===e.focus.getStatus()?"Awaiting your comment...":"All messages loaded")):h("div",{id:"scroll-anchor"},"loading...")}class Of extends g{constructor(e){super(e),Cf(this,"handleTypingNotification",((e,t)=>{if(t.roomId===this.props.roomId){const t=Ye.client.getUserId(),n=e.getContent().user_ids.filter((e=>e!==t));this.setState({typing:n})}})),this.handleTypingNotifications=this.handleTypingNotification.bind(this),this.state={typing:[]}}componentDidMount(){Ye.client.on("RoomMember.typing",this.handleTypingNotification)}componentWillUnmount(){Ye.client.off("RoomMember.typing",this.handleTypingNotification)}render(e,t){const n=t.typing.map((e=>Ye.client.getUser(e).displayName)),r=n.length;return 0===r?h("div",{class:"typing-indicator"},""):1===r?h("div",{class:"typing-indicator"},n[0]," is typing"):2===r?h("div",{class:"typing-indicator"},n[0]," and ",n[1]," are typing"):h("div",{class:"typing-indicator"},"several people are typing")}}var Pf=__webpack_require__(1444),Mf={};function Df(){return Df=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},Df.apply(this,arguments)}function Lf(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}Mf.styleTagTransform=Ie(),Mf.setAttributes=Ee(),Mf.insert=ke().bind(null,"head"),Mf.domAPI=Se(),Mf.insertStyleElement=Ce(),be()(Pf.Z,Mf),Pf.Z&&Pf.Z.locals&&Pf.Z.locals;class Ff extends g{constructor(e){super(e),Lf(this,"handleTypingNotification",((e,t)=>{Ye.client.getRoom(this.props.roomId).getLiveTimeline().getState(me.EventTimeline.FORWARDS).getStateEvents(Le,t.roomId)&&this.setState((n=>{const r=Ye.client.getUserId(),i=e.getContent().user_ids.filter((e=>e!==r));return{typing:{...n.typing,[t.roomId]:i}}}))})),Lf(this,"handleKeydown",(e=>{e.altKey&&!e.shiftKey&&"Tab"===e.key&&this.props.focusNext(),e.altKey&&e.shiftKey&&"Tab"===e.key&&this.props.focusPrev()})),Lf(this,"setFocus",(e=>this.setState({searchFocus:e}))),Lf(this,"searchInput",{current:null}),Lf(this,"byCreation",((e,t)=>e.event.getTs()>t.event.getTs()?-1:e.event.getTs()<t.event.getTs()?1:0)),Lf(this,"byPage",((e,t)=>e.getPageIndex()>t.getPageIndex()?1:e.getPageIndex()<t.getPageIndex()?-1:0)),Lf(this,"byActivity",((e,t)=>{const n=Ye.client.getRoom(e.getChild()),r=Ye.client.getRoom(t.getChild());if(n&&r){const e=n.getLastActiveTimestamp(),t=r.getLastActiveTimestamp();return e>t?-1:e<t?1:0}return n?-1:r?1:0})),Lf(this,"sortByActivity",(e=>{"Activity"===this.state.sort?this.setState((e=>({sortOrder:-1*e.sortOrder}))):this.setState({sort:"Activity"})})),Lf(this,"sortByPage",(e=>{"Page"===this.state.sort?this.setState((e=>({sortOrder:-1*e.sortOrder}))):this.setState({sort:"Page"})})),Lf(this,"sortByCreation",(e=>{"Creation"===this.state.sort?this.setState((e=>({sortOrder:-1*e.sortOrder}))):this.setState({sort:"Creation"})})),Lf(this,"flipSort",(e=>this.setState((e=>({sortOrder:-1*e.sortOrder}))))),Lf(this,"flags",[{keyword:"me",description:"my annotations"},{keyword:"hour",description:"annotations from the last hour"},{keyword:"day",description:"annotations from the last day"},{keyword:"week",description:"annotations from the last week"},{keyword:"unread",description:"unread annotations"}]),Lf(this,"popupActions",{"@":e=>h(jd,Df({roomId:this.props.roomId},e)),"~":e=>h(Bd,Df({roomId:this.props.roomId,flags:this.flags},e))}),this.state={typing:{},sort:"Page",sortOrder:1,searchFocus:!1},this.handleTypingNotification=this.handleTypingNotification.bind(this)}componentDidMount(){Ye.client.on("RoomMember.typing",this.handleTypingNotification),document.addEventListener("keydown",this.handleKeydown)}componentWillUnmount(){Ye.client.off("RoomMember.typing",this.handleTypingNotification),document.removeEventListener("keydown",this.handleKeydown)}getSortFunc(){switch(this.state.sort){case"Page":return this.byPage;case"Activity":return this.byActivity;case"Creation":return this.byCreation}}render(e,t){const n=[],r=Date.now();let i=r,s=1,o=!1;for(const a of e.filteredAnnotationContents.sort(this.getSortFunc())){let l;if(o)switch(t.sort){case"Page":if(s<a.getPageIndex()){const e=a.getPageIndex();l=h("div",{class:"annotation-listing-divider"},h("span",null,"Page ",1===t.sortOrder?e:s)),s=e}else l=h("div",{class:"annotation-listing-divider"});break;case"Activity":{const e=Ye.client.getRoom(a.getChild());if(e&&1===t.sortOrder){const t=r-e.getLastActiveTimestamp(),n=i-e.getLastActiveTimestamp();if(t<3e5&&n>6e4){i=e.getLastActiveTimestamp();const n=Math.floor(t/6e4);l=h("div",{class:"annotation-listing-divider"},h("span",null,`${n} minute${1===n?"":"s"} ago`))}else if(t<36e5&&n>6e5){i=e.getLastActiveTimestamp();const n=Math.floor(t/6e4);l=h("div",{class:"annotation-listing-divider"},h("span",null,`${n} minute${1===n?"":"s"} ago`))}else if(t<864e5&&n>36e5){i=e.getLastActiveTimestamp();const n=Math.floor(t/36e5);l=h("div",{class:"annotation-listing-divider"},h("span",null,`${n} hour${1===n?"":"s"} ago`))}else n>864e5?(i=e.getLastActiveTimestamp(),l=h("div",{class:"annotation-listing-divider"},h("span",null,`on ${new Date(i).toLocaleDateString("en-US",{weekday:"long",year:"numeric",month:"long",day:"numeric"})}`))):l=h("div",{class:"annotation-listing-divider"});break}}case"Creation":if(1===t.sortOrder){const e=r-a.event.getTs(),t=i-a.event.getTs();if(e<3e5&&t>6e4){i=a.event.getTs();const t=Math.floor(e/6e4);l=h("div",{class:"annotation-listing-divider"},h("span",null,`${t} minute${1===t?"":"s"} ago`))}else if(e<36e5&&t>6e5){i=a.event.getTs();const t=Math.floor(e/6e4);l=h("div",{class:"annotation-listing-divider"},h("span",null,`${t} minute${1===t?"":"s"} ago`))}else if(e<864e5&&t>36e5){i=a.event.getTs();const t=Math.floor(e/36e5);l=h("div",{class:"annotation-listing-divider"},h("span",null,`${t} hour${1===t?"":"s"} ago`))}else t>864e5?(i=a.event.getTs(),l=h("div",{class:"annotation-listing-divider"},h("span",null,`on ${new Date(i).toLocaleDateString("en-US",{weekday:"long",year:"numeric",month:"long",day:"numeric"})}`))):l=h("div",{class:"annotation-listing-divider"});break}default:l=h("div",{class:"annotation-listing-divider"})}else o=!0;n.push(l),n.push(h(Nf,{key:a.getChild(),typing:t.typing[a.getChild()],annotationLocation:a,focusByRoomId:e.focusByRoomId,focus:e.focus,parentRoom:e.room}))}return h("div",{id:"annotation-panel",class:e.class},h("div",{id:"annotation-entries-wrapper",tabindex:"-1"},h("div",{id:"annotation-controls"},h("button",{class:"small-icon",style:"cursor: pointer",onClick:this.flipSort},1===t.sortOrder?Nt:Ft),h("button",{"data-current-button":"Page"===t.sort,onClick:this.sortByPage,class:"styled-button"},"Page"),h("button",{"data-current-button":"Activity"===t.sort,onClick:this.sortByActivity,class:"styled-button"},"Activity"),h("button",{"data-current-button":"Creation"===t.sort,onClick:this.sortByCreation,class:"styled-button"},"Creation")),0===e.annotationContents.length?h("div",{class:"empty-marker"},h("b",null,"No annotations yet available")):0===e.filteredAnnotationContents.length?h("div",{class:"empty-marker"},h("b",null,"No annotations matching search")):1===t.sortOrder?n:n.reverse()),h("div",{id:"annotation-panel-button-wrapper","data-mode":t.searchFocus?"search":"navigation"},h(Ld,{textValue:e.annotationFilter,textarea:this.searchInput,actions:this.popupActions,setTextValue:e.setAnnotationFilter}),h(dn,{hint:"/",searchInput:this.searchInput,search:e.annotationFilter,setSearch:e.setAnnotationFilter,setFocus:this.setFocus})))}}class Nf extends g{constructor(e){super(e),Lf(this,"handleTimeline",((e,t)=>{t.roomId===this.room?.roomId&&this.setState({})})),Lf(this,"comment",{current:null}),Lf(this,"entry",{current:null}),Lf(this,"handleClick",(e=>{this.props.focusByRoomId(this.props.annotationLocation.getChild())})),Lf(this,"creator",this.props.parentRoom.getMember(this.props.annotationLocation.getCreator())),Lf(this,"userColor",new fe(this.creator.userId)),this.state={topic:e.annotationLocation.getText()}}componentDidMount(){fl(this.comment.current),Ye.client.on("Room.timeline",this.handleTimeline),Ye.client.on("Room.accountData",this.handleTimeline),yl(this.comment.current),this.setTopic()}componentWillUnmount(){Ye.client.off("Room.timeline",this.handleTimeline),Ye.client.off("Room.accountData",this.handleTimeline)}componentDidUpdate(e){e.focus?.getChild()!==this.props.annotationLocation.getChild()&&this.props.focus?.getChild()===this.props.annotationLocation.getChild()&&this.entry.current.scrollIntoView()}async setTopic(){this.room=await Ye.client.getRoomWithState(this.props.annotationLocation.getChild()),this.setState({topic:this.room.getLiveTimeline().getState(me.EventTimeline.FORWARDS).getStateEvents("m.room.topic","")?.getContent().topic||this.props.annotationLocation.getText()})}render(e,t){const n="object"==typeof e.typing&&Object.keys(e.typing).length>0||null,r=e.focus?.getChild()===e.annotationLocation.getChild();return h("div",{style:this.userColor.styleVariables,"data-annotation-entry-typing":n,"data-annotation-entry-focused":r,ref:this.entry,onclick:this.handleClick,class:"annotation-listing-entry"},"text"===e.annotationLocation.getType()?h("div",{class:"annotation-listing-pin-icon"},Ut," ",h("span",null,"on page ",e.annotationLocation.getPageIndex())):h("div",{class:"annotation-listing-topic"},h("span",{class:"annotation-listing-topic-icon"},qt),t.topic),h(jf,{creator:this.creator,unread:e.annotationLocation.getUnread(),commentRef:this.comment,annotationLocation:e.annotationLocation}))}}function jf(e){const t=e.annotationLocation.getRootContent();if(t){let n;switch(t.msgtype){case"m.text":n=Ag({content:t});break;case"m.notice":n=h("div",{class:"annotation-listing-fallback"},h("p",null,"Sent a notice"));break;case"m.image":n=h("div",{class:"annotation-listing-fallback"},h("p",null,"Sent a file"));break;case"m.video":n=h("div",{class:"annotation-listing-fallback"},h("p",null,"Sent a video"));break;case"m.audio":n=h("div",{class:"annotation-listing-fallback"},h("p",null,"Sent an audio recording"));break;case"m.emote":n=t[Ke]?h("div",{class:"annotation-listing-fallback"},h("p",null,"Sent an annotation")):h("div",{class:"annotation-listing-fallback"},h("p",null,"Sent a message"));break;default:n=h("div",{class:"annotation-listing-fallback"},h("p",null,"Sent a message"))}return h(m,null,h("div",{ref:e.commentRef,class:e.unread?"annotation-listing-comment-unread":"annotation-listing-comment"}," ",n," "),h("div",{class:"annotation-listing-info"},h("div",{class:"annotation-listing-features"},e.annotationLocation.isPrivate()?Bt:null),h("div",{class:"annotation-listing-creator"},h(en,{member:e.creator}))))}if("pending"===e.annotationLocation.getStatus())return h("div",{class:"annotation-listing-pending"},"awaiting your comment... ")}var Uf=__webpack_require__(6213),Bf={};function qf(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}Bf.styleTagTransform=Ie(),Bf.setAttributes=Ee(),Bf.insert=ke().bind(null,"head"),Bf.domAPI=Se(),Bf.insertStyleElement=Ce(),be()(Uf.Z,Bf),Uf.Z&&Uf.Z.locals&&Uf.Z.locals;class Kf extends g{constructor(e){super(e),qf(this,"resultListing",{current:null}),qf(this,"searchInput",{current:null}),qf(this,"setFocus",(e=>this.setState({focusedResult:e}))),qf(this,"focusNext",(e=>{null===this.state.focusedResult?this.setFocus(0):this.state.focusedResult+1<this.state.searchResults.length&&this.setFocus(this.state.focusedResult+1)})),qf(this,"focusPrev",(e=>{null===this.state.focusedResult&&this.setFocus(this.state.searchResults.length-1),this.state.focusedResult>0&&this.setFocus(this.state.focusedResult-1)})),qf(this,"handleScroll",(e=>{this.resultListing.current.scrollHeight-this.resultListing.current.clientHeight-this.resultListing.current.scrollTop<100&&!this.limitRaised&&(this.limitRaised=!0,this.setState((e=>({searchLimit:e.searchLimit+20}))))})),qf(this,"handleKeydown",(e=>{e.altKey&&!e.shiftKey&&"Tab"===e.key&&this.focusNext(),e.altKey&&e.shiftKey&&"Tab"===e.key&&this.focusPrev()})),qf(this,"handleBlur",(e=>{this.props.searchString.length<1&&this.props.endSearch()})),this.state={searchResults:[],searchLimit:20,focusedResult:null}}componentDidMount(){this.initializeSearch(),document.addEventListener("keydown",this.handleKeydown),this.searchInput.current.focus()}componentWillUnmount(){document.removeEventListener("keydown",this.handleKeydown)}componentDidUpdate(e,t){this.props.searchString!==e.searchString&&this.props.pdfText?this.initializeSearch():this.state.searchLimit>t.searchLimit&&this.props.pdfText&&this.expandSearch()}resetSearch(){this.setState({searchResults:[],searchLimit:20,focusedResult:null})}initializeSearch(){if(this.props.searchString.length<3)return void this.resetSearch();const e=[],t=this.props.searchString.toLowerCase().replace(/[^a-zA-Z0-9]/gm,"");for(const[n,r]of Object.entries(this.props.pdfText)){const i=r.toLowerCase().replace(/[^a-zA-Z0-9]/gm,""),s=[];let o=i.indexOf(t),a=o+t.length;for(;o>-1;){let e=!0,n=0,l=0,c=0;for(const d of r){if(e&&c===o&&(e=!1),!e&&c===a){s.push(r.slice(Math.max(0,n-15),l+40)),o=i.indexOf(t,o+1),a=o+t.length;break}e&&n++,d.match(/[a-zA-Z0-9]/)&&c++,l++}}if(s.length>0&&e.push({page:n,contexts:s}),e.length>20)break}this.setState({focusedResult:null,searchResults:e,searchLimit:20})}expandSearch(){if(this.props.searchString.length<3)return void this.resetSearch();const e=this.state.searchResults,t=e.slice(-1)[0].page,n=this.props.searchString.toLowerCase().replace(/[^a-zA-Z0-9]/gm,"");for(const[r,i]of Object.entries(this.props.pdfText))if(parseInt(r,10)>parseInt(t,10)){const t=i.toLowerCase().replace(/[^a-zA-Z0-9]/gm,"");let s=t.indexOf(n),o=s+n.length;const a=[];for(;s>-1;){let e=!0,r=0,l=0,c=0;for(const d of i){if(e&&c===s&&(e=!1),!e&&c===o){a.push(i.slice(Math.max(0,r-15),l+40)),s=t.indexOf(n,s+1),o=s+n.length;break}e&&r++,d.match(/[a-zA-Z0-9]/)&&c++,l++}}if(a.length>0&&e.push({page:r,contexts:a}),e.length>this.state.searchLimit)break}this.setState({searchResults:e},(e=>{this.limitRaised=!1}))}render(e,t){return h("div",{ref:this.resultListing,id:"pdf-search-result-panel",onscroll:this.handleScroll,class:e.class},this.props.pdfText?h(m,null,h("div",{id:"pdf-search-term"},h("div",null,h("b",null,"Search Results For:")),h(dn,{hint:"Alt-/",searchInput:this.searchInput,onBlur:this.handleBlur,search:e.searchString,setSearch:e.setSearch})),t.searchResults.map(((n,r)=>h(zf,{roomFocused:e.roomFocused,pdfFocused:e.pdfFocused,key:n.page,result:n,hideListing:e.hideListing,focusedResult:t.focusedResult,setFocus:this.setFocus,index:r})))):h("div",{id:"pdf-search-warn"},h("b",null,"Indexing Pdf, Please Wait...")))}}class zf extends g{constructor(...e){super(...e),qf(this,"focus",(e=>{this.props.setFocus(this.props.index);const t=`/${encodeURIComponent(this.props.pdfFocused)}/${this.props.result.page}/${this.props.roomFocused?this.props.roomFocused:""}`;Vn.push(t),this.result.current.scrollIntoView(),document.body.offsetWidth<=600&&this.props.hideListing()})),qf(this,"result",{current:null})}componentDidUpdate(e){this.props.focusedResult!==e.focusedResult&&this.props.index===this.props.focusedResult&&this.focus()}render(e){return h("div",{ref:this.result,onClick:this.focus,"data-focused-result":e.index===e.focusedResult,class:"pdf-search-result"},e.result.contexts.map(((t,n)=>h("div",{key:`${e.result.page}-${n}`,class:"result-context"}," ",t," "))),h("div",{class:"page-data"},"page: ",e.result.page," "))}}class $f{static fromQuadArray([e,t,n,r,i,s,o,a]){return new $f(e,t,n,r,i,s,o,a)}static fromRectIn(e,t,n){const r=72/(n||72),i=e.x,s=t.scrollHeight-e.y-e.height,o=e.x,a=t.scrollHeight-e.y,l=e.x+e.width,c=t.scrollHeight-e.y,d=e.x+e.width,u=t.scrollHeight-e.y-e.height;return new $f(i*r,s*r,o*r,a*r,l*r,c*r,d*r,u*r)}constructor(e,t,n,r,i,s,o,a){this.x1=e,this.y1=t,this.x2=n,this.y2=r,this.x3=i,this.y3=s,this.x4=o,this.y4=a}toDOMRectInHeight(e,t){const n=72/(t||72),r=this.getBoundingRect();return new DOMRect(r.left*n,(e-r.top)*n,(r.right-r.left)*n,(r.top-r.bottom)*n)}getArray(){return[this.x1,this.y1,this.x2,this.y2,this.x3,this.y3,this.x4,this.y4].map(Math.round)}getBoundingRect(){return{left:Math.round(Math.min(this.x1,this.x2,this.x3,this.x4)),right:Math.round(Math.max(this.x1,this.x2,this.x3,this.x4)),top:Math.round(Math.max(this.y1,this.y2,this.y3,this.y4)),bottom:Math.round(Math.min(this.y1,this.y2,this.y3,this.y4))}}}var Vf=__webpack_require__(5047),Hf={};function Wf(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}Hf.styleTagTransform=Ie(),Hf.setAttributes=Ee(),Hf.insert=ke().bind(null,"head"),Hf.domAPI=Se(),Hf.insertStyleElement=Ce(),be()(Vf.Z,Hf),Vf.Z&&Vf.Z.locals&&Vf.Z.locals;class Gf extends g{constructor(e){super(e),Wf(this,"handleTypingNotification",((e,t)=>{Ye.client.getRoom(this.props.roomId).getLiveTimeline().getState(me.EventTimeline.FORWARDS).getStateEvents(Le,t.roomId)&&this.setState((n=>{const r=Ye.client.getUserId(),i=e.getContent().user_ids.filter((e=>e!==r));return{typing:{...n.typing,[t.roomId]:i}}}))})),this.state={typing:{}},this.handleTypingNotification=this.handleTypingNotification.bind(this)}componentDidMount(){Ye.client.on("RoomMember.typing",this.handleTypingNotification)}componentDidUnmount(){Ye.client.off("RoomMember.typing",this.handleTypingNotification)}filterAnnotations(e){return e.isValid()&&e.getPageIndex()===parseInt(this.props.pageFocused,10)&&("pending"!==e.getStatus()||"pending"===e.getStatus()&&e.getCreator()===Ye.client.getUserId())}getAnnotations(){const e=Ye.client.getRoom(this.props.roomId),t=this.props.focus?.getChild();let n=[];if(e){let e=!1;const r=this.props.filteredAnnotationContents.filter((t=>(t.getChild()===this.props.focus?.getChild()&&(e=!0),this.filterAnnotations(t))));this.props.secondaryFocus&&this.filterAnnotations(this.props.secondaryFocus)&&r.push(this.props.secondaryFocus),this.props.focus&&this.filterAnnotations(this.props.focus)&&!e&&r.push(this.props.focus),n=r.map((e=>{const n=e.getChild();switch(e.getType()){case"text":return h(Xf,{key:e.event.getId(),focused:t===n,typing:this.state.typing[n],pdfWidthAdjustedPx:this.props.pdfWidthAdjustedPx,pdfHeightAdjustedPx:this.props.pdfHeightAdjustedPx,setFocus:this.props.setFocus,location:e});case"highlight":return h(Zf,{zoomFactor:this.props.zoomFactor,key:e.event.getId(),focused:t===n,typing:this.state.typing[n],setFocus:this.props.setFocus,pdfWidthAdjustedPx:this.props.pdfWidthAdjustedPx,pdfHeightAdjustedPx:this.props.pdfHeightAdjustedPx,location:e})}}))}return n}render(e){return h("div",{ref:e.annotationLayerWrapper,"data-annotation-focused":!!e.focus,id:"annotation-layer"},this.getAnnotations(),e.pindropMode?.x?h(Yf,{coordinates:e.pindropMode}):null)}}function Yf(e){return h("span",{class:"annotation-pindrop annotation-pindrop-preview","data-annotation":!0,style:{left:`${e.coordinates.x}px`,top:`${e.coordinates.y}px`}},Ut)}class Xf extends g{constructor(...e){super(...e),Wf(this,"setFocus",(e=>this.props.setFocus(this.props.location))),Wf(this,"userColor",new fe(this.props.location.getCreator())),Wf(this,"left",this.props.location.getRect().left),Wf(this,"top",this.props.pdfHeightAdjustedPx-this.props.location.getRect().top)}shouldComponentUpdate(e){if(0===e.pdfWidthAdjusted)return!1;e.pdfHeightAdjustedPx!==this.props.pdfHeightAdjustedPx&&(this.positioned||(this.left=this.props.location.getRect().left,this.top=this.props.pdfHeightAdjustedPx-this.props.location.getRect().top))}render(e){const t="object"==typeof e.typing&&Object.keys(e.typing).length>0||null;return h("span",{onclick:this.setFocus,class:"annotation-pindrop","data-focused":e.focused,"data-annotation-typing":t,"data-annotation":!0,style:{left:`${this.left}px`,top:`${this.top}px`,...this.userColor.styleVariables}},Ut)}}class Zf extends g{constructor(...e){super(...e),Wf(this,"setFocus",(e=>this.props.setFocus(this.props.location))),Wf(this,"roomId",this.props.location.getChild()),Wf(this,"rightSide",this.roomId.charCodeAt(1)%2==1),Wf(this,"clientRects",this.props.location.getQuadPoints().map((e=>$f.fromQuadArray(e).toDOMRectInHeight(this.props.pdfHeightAdjustedPx)))),Wf(this,"boundingRect",new DOMRect(this.props.location.getRect().left,this.props.pdfHeightAdjustedPx-this.props.location.getRect().top,this.props.location.getRect().right-this.props.location.getRect().left,this.props.location.getRect().top-this.props.location.getRect().bottom)),Wf(this,"userColor",new fe(this.props.location.getCreator()))}shouldComponentUpdate(e){if(0===e.pdfWidthAdjustedPx)return!1;if(e.pdfHeightAdjustedPx!==this.props.pdfHeightAdjustedPx&&!this.positioned&&(this.boundingRect=new DOMRect(this.props.location.getRect().left,e.pdfHeightAdjustedPx-this.props.location.getRect().top,this.props.location.getRect().right-this.props.location.getRect().left,this.props.location.getRect().top-this.props.location.getRect().bottom),this.clientRects=this.props.location.getQuadPoints().map((t=>$f.fromQuadArray(t).toDOMRectInHeight(e.pdfHeightAdjustedPx))),e.pdfWidthAdjustedPx>2*this.boundingRect.width)){const t=e.pdfWidthAdjustedPx-(this.boundingRect.width+this.boundingRect.x);t<this.boundingRect.x&&(this.rightSide=!0),t>this.boundingRect.x&&(this.rightSide=!1)}}render(e){if(!this.props.pdfWidthAdjustedPx)return null;const t=this.clientRects.map((e=>h(Qf,{pdfWidthAdjustedPx:this.props.pdfWidthAdjustedPx,key:e,zoomFactor:this.props.zoomFactor,setFocus:this.setFocus,rect:e}))),n="object"==typeof e.typing&&Object.keys(e.typing).length>0||null;return h("div",{style:this.userColor.styleVariables,"data-annotation-typing":n,"data-focused":e.focused,id:this.roomId},h(Jf,{pdfWidthAdjustedPx:e.pdfWidthAdjustedPx,rightSide:this.rightSide,rect:this.boundingRect,zoomFactor:e.zoomFactor,setFocus:this.setFocus}),h("div",{class:"inline-annotations"},t))}}class Jf extends g{constructor(e){super(e),Wf(this,"ref",{current:null}),Wf(this,"getTabRect",(e=>this.props.rightSide?new DOMRect(this.props.pdfWidthAdjustedPx-10+this.state.overlapOffset,this.props.rect.y,3,this.props.rect.height):new DOMRect(5-this.state.overlapOffset,this.props.rect.y,3,this.props.rect.height))),Wf(this,"scootch",(e=>{const t=this.ref.current.getBoundingClientRect();document.elementsFromPoint(t.x+1,t.y+1).filter((e=>{const n=e.getBoundingClientRect(),r="annotation-bartab"===e.className,i=4===e.compareDocumentPosition(this.ref.current);return r&&(n.y<t.y||i&&n.y===t.y)})).length>0&&this.setState({overlapOffset:this.state.overlapOffset+10})})),this.state={overlapOffset:0}}componentDidMount(){df(this.getTabRect(),this.ref.current,1),this.scootch()}componentDidUpdate(){df(this.getTabRect(),this.ref.current,this.props.zoomFactor),this.scootch()}render(e){return h("span",{onclick:e.setFocus,class:"annotation-bartab","data-annotation":!0,ref:this.ref})}}class Qf extends g{constructor(...e){super(...e),Wf(this,"ref",{current:null})}componentDidMount(){df(this.props.rect,this.ref.current,this.props.zoomFactor)}componentDidUpdate(){df(this.props.rect,this.ref.current,this.props.zoomFactor)}render(e){return h("span",{onclick:e.setFocus,"data-annotation":!0,ref:this.ref})}}var ey=__webpack_require__(2372),ty=__webpack_require__(145),ny={};function ry(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}ny.styleTagTransform=Ie(),ny.setAttributes=Ee(),ny.insert=ke().bind(null,"head"),ny.domAPI=Se(),ny.insertStyleElement=Ce(),be()(ty.Z,ny),ty.Z&&ty.Z.locals&&ty.Z.locals;class iy extends g{constructor(e){super(e),ry(this,"canvas",{current:null}),ry(this,"catchFetchPdfError",(e=>t=>{Vt.set(h(m,null,h("h3",{id:"toast-header"},"Couldn't fetch the PDF..."),h("div",null,"Tried to fetch: "),h("pre",null,e),h("div",null,"Here's the error message:"),h("pre",null,t.message))),Vn.push("/"),this.errorCondition=!0})),this.pendingRender=null,this.pendingTextRender=null,this.hasRendered=!1,this.hasFetched=new Promise(((e,t)=>{this.resolveFetch=e,this.rejectFetch=t}))}componentDidUpdate(e){if(!this.hasRendered||e.pageFocused!==this.props.pageFocused){const e=this.grabControl();this.drawPdf(e).then((e=>this.props.annotationLayer.current.forceUpdate())).then((e=>this.highlightText(this.props.searchString)))}e.searchString!==this.props.searchString&&this.highlightText(this.props.searchString)}componentDidMount(){this.fetchPdf(`#${this.props.pdfFocused}`),this.props.textLayer.current.addEventListener("click",(e=>{e.preventDefault();const t=new MouseEvent(e.type,e);document.elementsFromPoint(e.clientX,e.clientY).forEach((e=>{e.hasAttribute("data-annotation")&&e.dispatchEvent(t)}))}))}async fetchPdf(e){const{room_id:t,servers:n}=await Ye.client.getRoomIdForAlias(e).catch(this.catchFetchPdfError(e));if(this.errorCondition)return;if(await Ye.client.joinRoom(t,{viaServers:n}).catch(this.catchFetchPdfError(e)),this.errorCondition)return;const r=await Ye.client.getRoomWithState(t).catch(this.catchFetchPdfError(e));if(this.errorCondition)return;const i=new Xt(r);this.props.setResource(r),this.setState({pdfIdentifier:i.url}),iy.PDFStore[i.url]?console.log(`found pdf for ${r.name} in store`):iy.PDFStore[i.url]=window.fetch(i.httpUrl).then((async e=>{const t=e.clone(),n=+e.headers.get("Content-Length"),r=e.body.getReader();let i=0;for(;;){const{done:e,value:t}=await r.read();if(e)break;i+=t.length,this.props.setPdfLoadingStatus(i/n)}return t.arrayBuffer()})).then((e=>ey.getDocument(e).promise)).catch(this.catchFetchPdfError(e)),this.errorCondition||iy.PDFStore[i.url].then((e=>this.props.setTotalPages(e.numPages))).then(this.resolveFetch).then(this.gatherText(i.url))}async gatherText(e){const t=await iy.PDFStore[e];this.pdfText={};for(let e=1;e<t.numPages+1;e++){const n=await t.getPage(e),r=await n.getTextContent();this.pdfText[e]=r.items.map((e=>e.str)).join(" ")}this.props.setPdfText(this.pdfText)}grabControl(){const e={};this.controlToken=e;try{this.pendingRender.cancel()}catch(e){console.log(e)}try{this.pendingTextRender.cancel()}catch(e){console.log(e)}return this.cleanText="",this.props.textLayer.current.innerHTML="",e}async drawPdf(e){this.hasRendered=!0;const t=this.canvas.current;await this.hasFetched,this.props.setPdfLoadingStatus("Rendering PDF");const n=await iy.PDFStore[this.state.pdfIdentifier];if(e!==this.controlToken)return;const r=await n.getPage(parseInt(this.props.pageFocused,10)||1).catch(console.log);console.log("Page loaded");const i=this.props.pdfScale,s=r.getViewport({scale:i});t.height=s.height,t.width=s.width;const o=Math.min(s.width/i,window.innerWidth),a=o/s.width*s.height;this.props.setPdfDimensions(a,o),this.props.setPdfFitRatio(Math.min(1,window.innerWidth/(s.width/i)));const l=t.getContext("2d"),c={canvasContext:l,viewport:s};if(e!==this.controlToken)return;l.clearRect(0,0,t.width,t.height),this.pendingRender=r.render(c),await this.pendingRender.promise.catch((e=>"RenderingCancelledException"===e.name?console.log(e.message):console.log(e))),console.log("Page rendered");const d=await r.getTextContent();e===this.controlToken&&(this.pendingTextRender=ey.renderTextLayer({textContent:d,container:this.props.textLayer.current,viewport:r.getViewport({scale:1}),textDivs:[]}),this.pendingTextRender.promise.then((e=>{this.cleanText=this.props.textLayer.current.innerHTML})))}async highlightText(e){if(this.props.textLayer.current.innerHTML=this.cleanText,e.length<3)return;const t=this.props.textLayer.current.children,n=Array.from(t).map((e=>e.innerText)).join("").replace(/[^a-zA-Z0-9]/gm,"").toLowerCase();e=e.replace(/[^a-zA-Z0-9]/gm,"").toLowerCase();let r=n.indexOf(e),i=r+e.length,s=0,o=!0,a=!1;for(const l of t){let t="",c="",d="",u="";for(const h of l.innerText)s===r?o=!1:s===i&&(a=!0,r=n.indexOf(e,i),r>=0&&(t+=`${c}<mark>${d}</mark>${u}`,c="",d="",u="",i=r+e.length,o=!0,a=!1)),o?c+=h:a?u+=h:d+=h,h.match(/[a-zA-Z0-9]/)&&s++;""!==d?l.innerHTML=`${t}${c}<mark>${d}</mark>${u}`:""!==t&&(l.innerHTML=`${t}${c}${d}${u}`)}}render(e){return h(m,null,h("canvas",{ref:this.canvas,"data-page":e.pageFocused,id:"pdf-canvas"}),h("div",{style:"z-index:3",ref:this.props.textLayer,id:"text-layer"}))}}ry(iy,"PDFStore",{});class sy extends g{render(e){return h("div",{id:"document-wrapper","data-annotations-hidden":!e.annotationsVisible},h(iy,{setPdfWidthPx:e.setPdfWidthPx,setPdfDimensions:e.setPdfDimensions,setPdfFitRatio:e.setPdfFitRatio,pdfScale:e.pdfScale,annotationLayer:e.annotationLayer,textLayer:e.textLayer,searchString:e.searchString,pdfFocused:e.pdfFocused,pageFocused:e.pageFocused,initFocus:e.initFocus,setResource:e.setResource,setTotalPages:e.setTotalPages,setPdfText:e.setPdfText,setPdfLoadingStatus:e.setPdfLoadingStatus}),h(Gf,{ref:e.annotationLayer,pindropMode:e.pindropMode,annotationLayerWrapper:e.annotationLayerWrapper,filteredAnnotationContents:e.filteredAnnotationContents,pdfWidthAdjustedPx:e.pdfWidthAdjustedPx,pdfHeightAdjustedPx:e.pdfHeightAdjustedPx,zoomFactor:e.zoomFactor,pageFocused:e.pageFocused,roomId:e.roomId,setFocus:e.setFocus,focus:e.focus,secondaryFocus:e.secondaryFocus}))}}var oy=__webpack_require__(6145),ay={};function ly(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}ay.styleTagTransform=Ie(),ay.setAttributes=Ee(),ay.insert=ke().bind(null,"head"),ay.domAPI=Se(),ay.insertStyleElement=Ce(),be()(oy.Z,ay),oy.Z&&oy.Z.locals&&oy.Z.locals;class cy extends g{constructor(e){super(e),ly(this,"pageTotal",{current:null}),ly(this,"pageInput",{current:null}),ly(this,"bottomWrapper",{current:null}),ly(this,"toolTipOffset",[0,30]),ly(this,"handleInput",(e=>{/^[0-9]*$/.test(e.target.value)?this.setState({value:e.target.value}):this.setState({value:""})})),ly(this,"handlePageFocus",(e=>this.setState({pageFocused:!0,value:""}))),ly(this,"handlePageBlur",(e=>this.setState({pageFocused:!1,value:this.props.pageFocused}))),ly(this,"setSearchFocus",(e=>{e?(this.props.setNavHeight(150),this.setState({searchFocused:e,moreOptionsVisible:!0})):this.setState({searchFocused:e})})),ly(this,"handleSubmit",(e=>{e.preventDefault();const t=Number.isNaN(parseInt(this.state.value,10))?1:parseInt(this.state.value,10);t>0&&t<=this.props.total?Vn.push(`/${encodeURIComponent(this.props.pdfFocused)}/${t}/`):alert("Out of range")})),ly(this,"handleClick",(e=>Vn.push(`/${encodeURIComponent(this.props.pdfFocused)}/${parseInt(e.target.value,10)}`))),ly(this,"togglePageNav",(e=>this.setState({pageViewVisible:!this.state.pageViewVisible}))),ly(this,"toggleMoreOptions",(e=>{this.state.moreOptionsVisible?this.props.setNavHeight(75):this.props.setNavHeight(150),this.setState((e=>({moreOptionsVisible:!e.moreOptionsVisible})))})),ly(this,"mainMenu",(e=>Vn.push("/"))),ly(this,"download",(e=>{if(confirm("do you want to download the file you're annotating?")){const e=new Xt(this.props.room);window.open(e.httpUrl)}})),ly(this,"openInvite",(e=>sn.set(h(mn,{room:this.props.room})))),ly(this,"zoomOut",(e=>this.props.setZoom((e=>e-.1)))),ly(this,"zoomIn",(e=>this.props.setZoom((e=>e+.1)))),this.state={value:e.pageFocused,pageViewVisible:!1,moreOptionsVisible:!1,pageFocused:!1,searchFocused:!1}}componentDidUpdate(){this.pageInput.current&&(this.pageInput.current.style.width=`${this.pageTotal.current.scrollWidth}px`)}render(e,t){if(e.pdfWidthPx)return h("nav",{id:"page-nav"},h(dy,{total:e.total,handleClick:this.handleClick,roomId:e.roomId,currentPageElement:this.currentPageElement,visibility:t.pageViewVisible,typing:t.typing,current:e.pageFocused}),h("div",{id:"nav-background"}),h("div",{class:"nav-button-wrapper top-wrapper"},h(np,{content:"Go to main menu (ESC)",offset:this.toolTipOffset},h("button",{"aria-label":"Go to main menu",onclick:this.mainMenu},Je)),h(np,{content:"Add annotation (Alt + a)",offset:this.toolTipOffset},h("button",{"aria-label":"Add annotation",disabled:e.hasSelection||e.pindropMode?.x?null:"disabled",onclick:e.openAnnotation},yt)),h(np,{content:"Go to previous annotation (Alt + Shift + Tab)",offset:this.toolTipOffset},h("button",{"aria-label":"Go to previous annotation",disabled:!e.hasAnnotations,onclick:e.focusPrev},ft)),h(np,{content:"Go to previous page (k, )",offset:this.toolTipOffset},h("button",{"aria-label":"Go to previous page",disabled:e.pageFocused>1?null:"disabled",onclick:e.prevPage},pt)),h("form",{onSubmit:this.handleSubmit},h(np,{content:"Show page navigation",offset:this.toolTipOffset},h("button",{onclick:this.togglePageNav,class:t.pageViewVisible?"nav-toggled":null,"aria-label":"Show page navigation"},bt)),h("input",{type:"text",ref:this.pageInput,value:t.pageFocused?t.value:e.pageFocused,onblur:this.handlePageBlur,onfocus:this.handlePageFocus,oninput:this.handleInput}),h("span",null,"/"),h("span",{ref:this.pageTotal,id:"nav-total-pages"},e.total)),h(np,{content:"Go to next page (j, )",offset:this.toolTipOffset},h("button",{"aria-label":"Go to next page",disabled:e.total>e.pageFocused?null:"disabled",onclick:e.nextPage},mt)),h(np,{content:"Go to next annotation (Alt + Tab)",offset:[0,30]},h("button",{"aria-label":"Go to next annotation",disabled:!e.hasAnnotations,onclick:e.focusNext},gt)),h(np,{content:"Remove annotation (Alt + r)",offset:this.toolTipOffset},h("button",{"aria-label":"Remove annotatation",disabled:e.focus&&!e.hasSelection?null:"disabled",onclick:e.closeAnnotation},vt)),h(np,{content:"More options",offset:this.toolTipOffset},h("button",{"aria-label":"More options",onClick:this.toggleMoreOptions},ht))),h("div",{ref:this.bottomWrapper,"data-searchFocused":t.searchFocused,class:"nav-button-wrapper bottom-wrapper"},h(np,{content:"Invite a friend",theme:"bordered"},h("button",{"aria-label":"Invite a friend",onClick:this.openInvite},nt)),h(np,{content:"Download PDF",theme:"bordered"},h("button",{"aria-label":"Download PDF",onClick:this.download},zt," ")),h(np,{content:"Zoom out (-)",theme:"bordered"},h("button",{"aria-label":"Zoom out",onClick:this.zoomOut},Lt)),h(np,{content:"Zoom in (+)",theme:"bordered"},h("button",{"aria-label":"Zoom in",onClick:this.zoomIn},Dt)),h(np,{content:"Toggle annotation visibility (Alt + v)",theme:"bordered"},h("button",{"aria-label":"Toggle annotation visibility",onClick:e.toggleAnnotations},e.annotationsVisible?Ot:Rt)),h(np,{content:"Add Pin",theme:"bordered"},h("button",{"aria-label":"Add Pin",onClick:e.startPindrop},Ut)),h(np,{content:"Search Within PDF",theme:"bordered"},h("button",{"aria-label":"Search Within PDF",onClick:e.showSearch},at))))}}class dy extends g{constructor(e){super(e),ly(this,"handleTypingNotification",((e,t)=>{const n=Ye.client.getRoom(this.props.roomId).getLiveTimeline().getState(me.EventTimeline.FORWARDS).getStateEvents(Le,t.roomId);n&&this.setState((t=>{const r=new Zt(n).location;return{typing:{...t.typing,[r]:e.getContent().user_ids}}}))})),ly(this,"currentPageElement",{current:null}),this.state={typing:{}},this.handleTypingNotifications=this.handleTypingNotification.bind(this)}componentDidUpdate(){this.currentPageElement.current.scrollIntoView({inline:"center"})}componentDidMount(){Ye.client.on("RoomMember.typing",this.handleTypingNotification)}componentWillUnmount(){Ye.client.off("RoomMember.typing",this.handleTypingNotification)}render(e,t){const n=Array.from({length:e.total},((e,t)=>t+1)).map((n=>{let r,i;return t.typing[n]&&t.typing[n][0]&&(r="typing",i=new fe(t.typing[n][0])),h("button",{value:n,key:n,class:r,tabIndex:e.visibility?0:-1,style:i?.styleVariables,onclick:e.handleClick},n)}));return n[e.current-1]=h("button",{ref:this.currentPageElement,tabIndex:e.visibility?0:-1,class:"currentpage"},e.current),h("div",{class:e.visibility?null:"nav-hidden",id:"nav-pages"},n)}}function uy(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class hy extends g{constructor(e){super(e),uy(this,"handleStateUpdate",(e=>{e.getRoomId()===this.state.roomId&&e.getType()===Le&&this.updateAnnotations()})),uy(this,"handleAccountData",((e,t)=>{const n=this.state.annotationContents.map((e=>e.getChild()));if(t?.roomId in n)this.updateAnnotations();else if(t.roomId===this.state.roomId&&this.props.pageFocused&&e.getType()===Me){const t=e.getContent();t.page!==this.props.pageFocused&&t.deviceId!==Ye.deviceId&&Vt.set(h(m,null,h("h3",{id:"toast-header"},"Hey!"),h("div",null,"Another device is viewing a different page."),h("div",{style:"margin-top:10px"},h("button",{onclick:e=>{Vn.push(`/${encodeURIComponent(this.props.pdfFocused)}/${t.page}/`),Vt.set(null)},class:"styled-button"},"Jump to there "))))}})),uy(this,"handlePointerDown",(e=>{this.pointerCache.push(e),2===this.pointerCache.length&&(this.initialDistance=Math.abs(this.pointerCache[0].clientX-this.pointerCache[1].clientX),this.initialZoom=this.state.zoomFactor,this.setState({pinching:!0}))})),uy(this,"handlePointerUp",(e=>{this.pointerCache=this.pointerCache.filter((t=>t.pointerId!==e.pointerId)),this.state.pinching&&2!==this.pointerCache.length&&this.setState({pinching:!1})})),uy(this,"handlePointerMove",(e=>{if(this.pointerCache.forEach(((t,n)=>{e.pointerId===t.pointerId&&(this.pointerCache[n]=e)})),2===this.pointerCache.length){const e=Math.abs(this.pointerCache[0].clientX-this.pointerCache[1].clientX);this.setZoom((t=>this.initialZoom*(e/this.initialDistance)))}})),uy(this,"annotationLayer",{current:null}),uy(this,"textLayer",{current:null}),uy(this,"annotationLayerWrapper",{current:null}),uy(this,"documentView",{current:null}),uy(this,"contentContainer",{current:null}),uy(this,"pointerCache",[]),uy(this,"setNavHeight",(e=>this.setState({navHeight:e}))),uy(this,"setResource",(e=>{this.setState({room:e,roomId:e.roomId},(e=>this.props.roomFocused?this.focusByRoomId(this.props.roomFocused):null))})),uy(this,"startPindrop",(e=>{setTimeout((e=>{this.setState({pindropMode:{}}),document.addEventListener("click",this.releasePin)}),200)})),uy(this,"releasePin",(e=>{if(e.target===this.annotationLayer.current.base){const t=e.altKey?14*Math.round((e.offsetX-14)/14):e.offsetX-14,n=e.altKey?14*Math.round((e.offsetY-14)/14):e.offsetY-14;this.setState({pindropMode:{x:t,y:n}})}else document.removeEventListener("click",this.releasePin),this.setState({pindropMode:null})})),uy(this,"commitPin",((e,t)=>{if(!Wt())return;const n=Ye.client.getDomain(),r=this.annotationLayerWrapper.current.scrollHeight-t,i={[Be]:{page_index:this.getPage(),rect:{left:e,right:e+10,top:r,bottom:r-10},name:"Comment",contents:""},[ze]:{activityStatus:"pending",creator:Ye.client.getUserId()}};this.state.pindropMode?.x&&Ye.client.createRoom({visibility:"public",name:`pindrop on page ${this.getPage()}`,initial_state:[{type:"m.room.join_rules",state_key:"",content:{join_rule:"public"}},{type:Fe,content:{via:[n],[qe]:i},state_key:this.state.roomId}]}).then((e=>{const t={via:[n],[qe]:i},r=new me.MatrixEvent({type:"m.space.child",origin_server_ts:(new Date).getTime(),room_id:this.state.roomId,sender:Ye.client.getUserId(),state_key:e.room_id,content:t});return this.setFocus(new Zt(r)),this.setState({chatVisible:!0}),document.removeEventListener("click",this.releasePin),this.setState({pindropMode:null}),Ye.client.sendStateEvent(this.state.roomId,Le,t,e.room_id).then((t=>e))})).catch((e=>alert(e)))})),uy(this,"quadsFromPdfSelection",(e=>{const t=function(e,t,n){const r=e.getRangeAt(0);let i=[];if(r.startContainer!==r.endContainer){if(1===r.startContainer.nodeType){const e=Array.from(r.startContainer.childNodes).slice(r.startOffset).map(gf).reduce(((e,t)=>e.concat(t)),[]);i=i.concat(e.map((e=>ff(e))))}if(3===r.startContainer.nodeType&&i.push(ff(r.startContainer,r.startOffset)),1===r.endContainer.nodeType){const e=Array.from(r.startContainer.childNodes).slice(r.startOffset).map(gf).reduce(((e,t)=>e.concat(t)),[]);i=i.concat(e.map((e=>ff(e))))}3===r.startContainer.nodeType&&i.push(ff(r.endContainer,0,r.endOffset)),i=i.concat(function(e,t){const n=[],r=e=>3===e.nodeType||e===t;let i=e;for(;(i=mf(i,r,!0))!==t;)n.push(i);return n}(r.startContainer,r.endContainer).map((e=>ff(e))))}else{if(1===r.startContainer.nodeType){const e=Array.from(r.startContainer.childNodes).slice(r.startOffset,r.endOffset).map(gf).reduce(((e,t)=>e.concat(t)),[]);i=i.concat(e.map((e=>ff(e))))}3===r.startContainer.nodeType&&i.push(ff(r.startContainer,r.startOffset,r.endOffset))}return function(e){return e.filter((e=>e.width>1)).map((e=>(e.x=e.x-5,e.width=e.width+10,e)))}(i.map((e=>function(e,t,n){const r=e.getBoundingClientRect();return new DOMRect((t.x-r.x)/n,(t.y-r.y)/n,t.width/n,t.height/n)}(t,e,n))))}(e,this.annotationLayerWrapper.current,this.state.pdfFitRatio*this.state.zoomFactor),n=function(e){const t=e.map((e=>e.x)),n=e.map((e=>e.y)),r=e.map((e=>e.right)),i=e.map((e=>e.bottom)),s=Math.min(...t),o=Math.min(...n);return new DOMRect(s,o,Math.max(...r)-s,Math.max(...i)-o)}(t);return{clientQuads:t.map((e=>$f.fromRectIn(e,this.annotationLayerWrapper.current))),boundingQuad:$f.fromRectIn(n,this.annotationLayerWrapper.current)}})),uy(this,"commitHighlight",(e=>{if(!Wt())return;const t=window.getSelection();if(t.isCollapsed)return;const n=pf(t),{clientQuads:r,boundingQuad:i}=this.quadsFromPdfSelection(t),s=Ye.client.getDomain(),o={[Ue]:{page_index:this.getPage(),rect:i.getBoundingRect(),quad_points:r.map((e=>e.getArray())),contents:"",text_content:n},[ze]:{activityStatus:"pending",creator:Ye.client.getUserId()}};Ye.client.createRoom({visibility:"public",name:`highlighted passage on page ${this.getPage()}`,topic:n,initial_state:[{type:"m.room.join_rules",state_key:"",content:{join_rule:"public"}},{type:Fe,content:{via:[s],[qe]:o},state_key:this.state.roomId}]}).then((e=>{t.removeAllRanges();const n={via:[s],[qe]:o},r=new me.MatrixEvent({type:"m.space.child",origin_server_ts:(new Date).getTime(),room_id:this.state.roomId,sender:Ye.client.getUserId(),state_key:e.room_id,content:n});return this.setFocus(new Zt(r)),this.setState({chatVisible:!0}),Ye.client.sendStateEvent(this.state.roomId,Le,n,e.room_id)})).catch((e=>alert(e)))})),uy(this,"setPdfDimensions",((e,t)=>{const n=document.body.clientWidth,r=(document.body.clientHeight-this.state.navHeight-10)/e,i=n/t,s=this.state.zoomFactor||Math.max(Math.min(r,i,5),1);this.setState({pdfHeightPx:e,pdfWidthPx:t,zoomFactor:s})})),uy(this,"setPdfFitRatio",(e=>this.setState({pdfFitRatio:e}))),uy(this,"setPdfText",(e=>{this.pdfText=e})),uy(this,"setAnnotationFilter",(e=>this.setState((t=>({annotationFilter:e,filteredAnnotationContents:this.filterAnnotations(e,t.annotationContents)}))))),uy(this,"setTotalPages",(e=>this.setState({totalPages:e}))),uy(this,"setPdfLoadingStatus",(e=>this.setState({loadingStatus:e}))),uy(this,"setSearch",(e=>this.setState({searchString:e}))),uy(this,"showSearch",(e=>{this.setState({listingType:"search"}),this.showListing()})),uy(this,"endSearch",(e=>this.setState({listingType:null}))),uy(this,"toggleAnnotations",(e=>this.setState((e=>({annotationsVisible:!e.annotationsVisible}))))),uy(this,"setZoom",(e=>{let t=e(this.state.zoomFactor);if(t<1)this.setState({zoomFactor:1});else{t=Math.min(t,5);const e=this.contentContainer.current.clientWidth/2,n=this.contentContainer.current.clientWidth/2/this.state.zoomFactor*t,r=this.contentContainer.current.scrollLeft/this.state.zoomFactor*t,i=this.contentContainer.current.clientHeight/2,s=this.contentContainer.current.clientHeight/2/this.state.zoomFactor*t,o=r+n-e,a=this.contentContainer.current.scrollTop/this.state.zoomFactor*t+s-i;this.contentContainer.current.scrollTo(o,a),this.setState({zoomFactor:t})}})),uy(this,"focusByRoomId",(e=>{const t=this.state.room.getLiveTimeline().getState(me.EventTimeline.FORWARDS).getStateEvents(Le,e);if(t){const n=new Zt(t);Vn.push(`/${encodeURIComponent(this.props.pdfFocused)}/${n.getPageIndex()||this.getPage()}/${e}`);const r=!(document.body.offsetWidth<=600)&&this.state.listingVisible;this.setState({focus:n,secondaryFocus:null,chatVisible:!0,listingVisible:r})}})),uy(this,"focusNextInArray",(e=>{let t=!this.state.focus;if(e){for(const n of e){const e=n.getChild();if(t)return void this.focusByRoomId(e);t=this.state.focus.getChild()===e}this.focusByRoomId(e[0].getChild())}})),uy(this,"focusNext",(e=>{this.focusNextInArray(this.state.filteredAnnotationContents)})),uy(this,"focusPrev",(e=>{const t=[...this.state.filteredAnnotationContents];this.focusNextInArray(t.reverse())})),uy(this,"prevPage",(e=>{this.getPage()>1&&(Vn.push(`/${encodeURIComponent(this.props.pdfFocused)}/${this.getPage()-1}/`),this.contentContainer.current.scrollTop=this.contentContainer.current.scrollHeight)})),uy(this,"nextPage",(e=>{this.getPage()<this.state.totalPages&&(Vn.push(`/${encodeURIComponent(this.props.pdfFocused)}/${this.getPage()+1}/`),this.contentContainer.current.scrollTop=0)})),uy(this,"hideChat",(e=>this.setState({chatVisible:!1}))),uy(this,"showChat",(e=>{document.body.offsetWidth<=768?this.setState({listingVisible:!1,chatVisible:!0}):this.setState({chatVisible:!0})})),uy(this,"toggleChat",(e=>this.setState((e=>{e.chatVisible?this.hideChat():this.showChat()})))),uy(this,"hideListing",(e=>this.setState({listingVisible:!1}))),uy(this,"showListing",(e=>{document.body.offsetWidth<=768?this.setState({listingVisible:!0,chatVisible:!1}):this.setState({listingVisible:!0})})),uy(this,"toggleListing",(e=>this.setState((e=>{e.listingVisible?this.hideListing():this.showListing()})))),uy(this,"openSidebar",(e=>this.setState((e=>this.focus?{chatVisible:!0}:{listingVisible:!0})))),uy(this,"handleRouteChange",(e=>{this.props.pageFocused&&this.props.pdfFocused&&this.state.roomId&&(Ye.client.setRoomAccountData(this.state.roomId,Me,{deviceId:Ye.deviceId,...parseInt(this.props.pageFocused,10)&&{page:this.props.pageFocused}}),this.refreshFocus())})),uy(this,"handleKeydown",(e=>{e.altKey&&"a"===e.key&&this.openAnnotation(),e.altKey&&"r"===e.key&&this.closeAnnotation(),e.altKey&&"v"===e.key&&this.toggleAnnotations(),e.altKey&&"/"===e.key&&this.showSearch(),e.ctrlKey||e.altKey||e.metaKey||("+"!==e.key&&"="!==e.key||this.setZoom((e=>e+.1)),"-"===e.key&&this.setZoom((e=>e-.1)),"Esc"!==e.key&&"Escape"!==e.key||Vn.push("/"),e.shiftKey||("j"!==e.key&&"ArrowRight"!==e.key||this.nextPage(),"k"!==e.key&&"ArrowLeft"!==e.key||this.prevPage(),"ArrowUp"===e.key&&(e.preventDefault(),this.contentContainer.current.scroll({top:this.contentContainer.current.scrollTop-100,left:this.contentContainer.current.scrollLeft})),"ArrowDown"===e.key&&(e.preventDefault(),this.contentContainer.current.scroll({top:this.contentContainer.current.scrollTop+100,left:this.contentContainer.current.scrollLeft}))))})),uy(this,"openAnnotation",(e=>{this.setState({annotationsVisible:!0}),this.state.pindropMode?.x?this.commitPin(this.state.pindropMode.x,this.state.pindropMode.y):this.commitHighlight()})),uy(this,"closeAnnotation",(e=>{const t=Ye.client.getUserId()===this.state.focus.getCreator(),n=this.state.room.getMember(Ye.client.getUserId()).powerLevel>=50;confirm("Are you sure you want to close this annotation?")&&(t||n?(Ye.client.sendStateEvent(this.state.roomId,Le,{},this.state.focus.getChild()),this.unsetFocus()):alert("Only moderators can close annotations that they didn't create"))})),uy(this,"unsetFocus",(e=>{this.setState({secondaryFocus:null,focus:null},(e=>this.setState({chatVisible:!1}))),Vn.push(`/${encodeURIComponent(this.props.pdfFocused)}/${this.props.pageFocused}/`)})),uy(this,"setFocus",(e=>{Vn.push(`/${encodeURIComponent(this.props.pdfFocused)}/${this.props.pageFocused}/${e.getChild()}/`),this.setState({secondaryFocus:null,focus:e,chatVisible:!0})})),uy(this,"refreshFocus",(e=>{const t=this.state.room.getLiveTimeline().getState(me.EventTimeline.FORWARDS).getStateEvents(Le,this.props.roomFocused);t&&this.setState({focus:new Zt(t)})})),uy(this,"setSecondaryFocus",(e=>this.setState({secondaryFocus:e}))),uy(this,"updateAnnotations",(e=>{if(this.state.room){const e=this.state.room.getLiveTimeline().getState(me.EventTimeline.FORWARDS).getStateEvents(Le).map((e=>new Zt(e))).filter((e=>e.isValid()&&(!e.isPrivate()||"All"!==e.getUnread())&&("pending"!==e.getStatus()||"pending"===e.getStatus()&&e.getCreator()===Ye.client.getUserId())));this.setState({annotationContents:e,filteredAnnotationContents:this.filterAnnotations(this.state.annotationFilter,e)})}else setTimeout(this.updateAnnotations,500)})),uy(this,"filterAnnotations",((e,t)=>{const n=[],r=[],i=[],s=e.split(" ");for(const e of s)"@"===e.slice(0,1)?r.push(e.slice(1)):"~"===e.slice(0,1)?i.push(e.slice(1)):n.push(e);return t.filter((e=>{let t=!0;return i.includes("me")&&(t=t&&e.getCreator()===Ye.client.getUserId()),i.includes("hour")&&(t=t&&e.event.getTs()>Date.now()-36e5),i.includes("day")&&(t=t&&e.event.getTs()>Date.now()-864e5),i.includes("week")&&(t=t&&e.event.getTs()>Date.now()-6048e5),i.includes("unread")&&(t=t&&e.getUnread()),(!r.length||r.some((t=>e.getCreator().toLowerCase().includes(t.toLowerCase()))))&&t&&n.every((t=>!e.getText()&&!e.getRootContent()||e.getText()?.toLowerCase().includes(t.toLowerCase())||e.getRootContent()?.body.toLowerCase().includes(t.toLowerCase())))}))}));const t=Vn.history.location.state;this.state={roomId:null,focus:null,secondaryFocus:null,totalPages:null,navHeight:75,panelVisible:!1,chatVisible:!1,listingType:null,listingVisible:!!t&&!!t.searchString,hasSelection:!1,annotationsVisible:!0,annotationContents:[],filteredAnnotationContents:[],pindropMode:null,annotationFilter:t?t.searchString:"",searchString:"",loadingStatus:"loading...",pdfWidthPx:null,pdfHeightPx:null,pdfFitRatio:1,zoomFactor:null,pinching:!1},this.pdfScale=3,this.prevScrollTop=0,this.checkForSelection=this.checkForSelection.bind(this),this.handleKeydown=this.handleKeydown.bind(this),this.handleTimeline=this.handleTimeline.bind(this),this.handleAccountData=this.handleAccountData.bind(this),this.handleStateUpdate=this.handleStateUpdate.bind(this),this.userColor=new fe(Ye.client.getUserId())}getPage(){return parseInt(this.props.pageFocused,10)||1}componentDidMount(){document.addEventListener("selectionchange",this.checkForSelection),document.addEventListener("keydown",this.handleKeydown),this.updateAnnotations(),Ye.client.on("Room.timeline",this.handleTimeline),Ye.client.on("RoomState.events",this.handleStateUpdate),Ye.client.on("Room.accountData",this.handleAccountData)}componentWillUnmount(){document.removeEventListener("selectionchange",this.checkForSelection),document.removeEventListener("keydown",this.handleKeydown),Ye.client.off("Room.timeline",this.handleTimeline),Ye.client.off("RoomState.events",this.handleStateUpdate),Ye.client.off("Room.accountData",this.handleAccountData)}handleTimeline(e,t){const n=this.state.annotationContents.map((e=>e.getChild()));t?.roomId in n&&this.updateAnnotations()}checkForSelection(){this.selectionTimeout&&clearTimeout(this.selectionTimeout);const e=!window.getSelection().isCollapsed&&this.textLayer.current.contains(window.getSelection().getRangeAt(0).endContainer)&&this.textLayer.current.contains(window.getSelection().getRangeAt(0).startContainer);this.selectionTimeout=setTimeout(200,this.setState({hasSelection:e}))}getLoadingStatus(){return this.state.pdfHeightPx?null:"string"==typeof this.state.loadingStatus?h("div",{id:"document-view-loading"},this.state.loadingStatus):"number"==typeof this.state.loadingStatus?h("div",{id:"document-view-loading"},"Downloading Pdf...",h("progress",{class:"styled-progress",max:"1",value:this.state.loadingStatus})):void 0}render(e,t){const n={"--pdfZoomFactor":t.zoomFactor,"--navHeight":`${t.navHeight}px`,"--pdfFitRatio":t.pdfFitRatio,"--pdfWidthPx":`${t.pdfWidthPx}px`,"--pdfHeightPx":`${t.pdfHeightPx}px`,"--sidePanelVisible":t.panelVisible?1:0,"--chatVisible":t.chatVisible?1:0,"--listingVisible":t.listingVisible?1:0,"--chatFocused":t.focus?1:0,"--selectColor":this.userColor.solid,"touch-action":this.state.pinching?"none":null},r={visibility:t.pdfHeightPx?null:"hidden"};return h("div",{style:n,id:"content-container",ref:this.contentContainer,onPointerDown:this.handlePointerDown,onPointerUp:this.handlePointerUp,onPointerCancel:this.handlePointerUp,onPointerLeave:this.handlePointerUp,"data-pindrop-mode":!!t.pindropMode&&(t.pindropMode?.x?"placed":"unplaced"),onPointerMove:this.handlePointerMove},h(pe,{onChange:this.handleRouteChange}),this.getLoadingStatus(),h("div",{style:r,ref:this.documentView,id:"document-view"},h(sy,{annotationLayer:this.annotationLayer,annotationLayerWrapper:this.annotationLayerWrapper,annotationsVisible:t.annotationsVisible,filteredAnnotationContents:t.filteredAnnotationContents,focus:t.focus,initFocus:this.initFocus,pageFocused:this.getPage(),pdfFocused:e.pdfFocused,pdfHeightAdjustedPx:t.pdfHeightPx/t.pdfFitRatio,pdfScale:this.pdfScale,pdfWidthAdjustedPx:t.pdfWidthPx/t.pdfFitRatio,pindropMode:t.pindropMode,roomId:t.roomId,searchString:t.searchString,secondaryFocus:t.secondaryFocus,setFocus:this.setFocus,setResource:this.setResource,setPdfDimensions:this.setPdfDimensions,setPdfFitRatio:this.setPdfFitRatio,setPdfLoadingStatus:this.setPdfLoadingStatus,setPdfText:this.setPdfText,setPdfWidthPx:this.setPdfWidthPx,setTotalPages:this.setTotalPages,textLayer:this.textLayer,zoomFactor:t.zoomFactor})),h("div",{id:"sidepanel"},h(py,{visible:t.chatVisible,id:"panel-handle-1",offsetVar:"--dragOffset-1",contentContainer:this.contentContainer}),t.focus?h(Af,{class:"panel-widget-1",setFocus:this.setFocus,setSecondaryFocus:this.setSecondaryFocus,unsetFocus:this.unsetFocus,pdfId:t.roomId,pdfFocused:e.pdfFocused,pageFocused:this.getPage(),hasSelection:t.hasSelection,quadsFromPdfSelection:this.quadsFromPdfSelection,secondaryFocus:t.secondaryFocus,focus:t.focus}):h("div",{class:"panel-widget-1"}),h(py,{visible:t.listingVisible,id:"panel-handle-2",offsetVar:"--dragOffset-2",contentContainer:this.contentContainer}),"search"===t.listingType?h(Kf,{class:"panel-widget-2",searchString:t.searchString,setSearch:this.setSearch,endSearch:this.endSearch,hideListing:this.hideListing,pdfText:this.pdfText,pdfFocused:e.pdfFocused,roomFocused:e.roomFocused}):h(Ff,{roomId:t.roomId,class:"panel-widget-2",focus:t.focus,setAnnotationFilter:this.setAnnotationFilter,annotationFilter:t.annotationFilter,annotationContents:t.annotationContents,filteredAnnotationContents:t.filteredAnnotationContents,focusByRoomId:this.focusByRoomId,focusNext:this.focusNext,focusPrev:this.focusPrev,room:t.room}),h("div",{class:"panel-widget-controls"},t.room?h(lr,{roomId:t.roomId,size:42,name:t.room.name,avatarUrl:t.room.getMxcAvatarUrl()}):null,h("hr",null),h(np,{placement:"left",content:"Show chat"},h("button",{"data-active":t.chatVisible,disabled:!t.focus,id:"show-annotations",onclick:this.toggleChat},jt)),h(np,{placement:"left",content:"Show annotation list"},h("button",{"data-active":t.listingVisible,id:"show-annotations",onclick:this.toggleListing},wt)))),h(cy,{hasSelection:t.hasSelection,openAnnotation:this.openAnnotation,closeAnnotation:this.closeAnnotation,hasAnnotations:this.state.filteredAnnotationContents.length>0,pageFocused:this.getPage(),pdfFocused:e.pdfFocused,total:t.totalPages,focus:t.focus,roomId:t.roomId,room:t.room,focusNext:this.focusNext,focusPrev:this.focusPrev,nextPage:this.nextPage,prevPage:this.prevPage,searchString:t.searchString,pdfWidthPx:t.pdfWidthPx,annotationsVisible:t.annotationsVisible,toggleAnnotations:this.toggleAnnotations,setNavHeight:this.setNavHeight,showSearch:this.showSearch,startPindrop:this.startPindrop,pindropMode:t.pindropMode,setZoom:this.setZoom}),h("div",{id:"pdf-mobile-buttons"},h("button",{title:"open options",id:"panel-toggle",onclick:this.openSidebar},t.chatVisible||t.listingVisible?null:Qe)),h($g,null))}}class py extends g{constructor(...e){super(...e),uy(this,"dragOffset",0),uy(this,"handleMouseMove",(e=>{e.clientX<20||this.startingClientX-e.clientX<0||(this.dragOffset=this.startingClientX-e.clientX,this.props.contentContainer.current.style.setProperty(this.props.offsetVar,`${this.dragOffset}px`))})),uy(this,"startDrag",(e=>{this.props.contentContainer.current.style.setProperty("--transitionSizing","unset"),this.props.contentContainer.current.setPointerCapture(e.pointerId),this.startingClientX=e.clientX+this.dragOffset,this.props.contentContainer.current.addEventListener("pointermove",this.handleMouseMove),this.props.contentContainer.current.addEventListener("pointerup",(t=>{this.props.contentContainer.current.style.removeProperty("--transitionSizing"),this.props.contentContainer.current.releasePointerCapture(e.pointerId),this.props.contentContainer.current.removeEventListener("pointermove",this.handleMouseMove)}))}))}render(e){if(e.visible)return h("div",{id:e.id,onpointerdown:this.startDrag,class:"panel-handle"},"")}}var my=__webpack_require__(5578),gy={};gy.styleTagTransform=Ie(),gy.setAttributes=Ee(),gy.insert=ke().bind(null,"head"),gy.domAPI=Se(),gy.insertStyleElement=Ce(),be()(my.Z,gy),my.Z&&my.Z.locals&&my.Z.locals;class fy extends g{constructor(...e){var t,n;super(...e),n=async()=>{Ye.client&&["PREPARED","SYNCING","ERROR"].includes(Ye.client.getSyncState())?(this.props.setInitializationStage("initialized"),function(e){const t=new URLSearchParams(window.location.search),n=t.get("join"),r=t.getAll("via"),i=t.get("server");n&&r.length>0&&Ye.client.joinRoom(n,{viaServers:r}),i&&i!==Ye.client.getDomain()&&Vt.set(h(m,null,h("h3",{id:"toast-header"},"You might be in the wrong place"),h("div",null,"It looks like the link you followed to get here requested a server different from the one you're currently logged in to."),h("div",{style:"margin-top:10px"},h("button",{onclick:t=>{Vt.set(null),e()},class:"styled-button"},"Log out")))),window.history.replaceState({toastWarning:!0},"",window.location.pathname+window.location.hash)}(this.props.logoutHandler)):setTimeout(this.pollInitialized,1e3)},(t="pollInitialized")in this?Object.defineProperty(this,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):this[t]=n}componentDidMount(){this.pollInitialized()}render(e){return h("div",{id:"splash-wrapper"},h(yy,null),h("div",{id:"splash-loader"},e.initializationStage,"..."))}}function yy(){return h("svg",{id:"splash-logo",version:"1.1",viewBox:"0 0 43.752 7.5565",xmlns:"http://www.w3.org/2000/svg"},h("g",{transform:"translate(-35.949 -76.132)"},h("g",{"stroke-width":".26458","aria-label":"Populus"},h("path",{d:"m37.314 76.132h1.397q0.67733 0 1.1642 0.24342t0.75141 0.70908q0.26458 0.45508 0.26458 1.0901 0 0.48683-0.1905 0.87841-0.1905 0.381-0.508 0.64558-0.3175 0.26458-0.71966 0.40216-0.40216 0.127-0.83608 0.09525-0.42333-0.03175-0.8255-0.24342v-0.10583t0.17992 0.03175q0.17992 0.02117 0.45508 0.01058 0.28575-0.02117 0.59266-0.11642 0.3175-0.10583 0.58208-0.35983 0.27516-0.254 0.41275-0.70908 0.03175-0.11642 0.05292-0.28575 0.02117-0.17992 0.01058-0.34925-0.01058-0.73025-0.381-1.1747-0.37042-0.4445-1.0477-0.4445h-1.2488t-0.03175-0.07408q-0.02117-0.08467-0.05292-0.15875-0.02117-0.08467-0.02117-0.08467zm0.13758 0v7.4083h-0.68791v-7.4083zm-0.65616 6.6357v0.77258h-0.84666v-0.10583t0.0635 0q0.07408 0 0.07408 0 0.27516 0 0.46566-0.1905 0.20108-0.20108 0.21167-0.47625zm0-5.8631h-0.03175q0-0.27517-0.20108-0.46566-0.20108-0.20108-0.47625-0.20108 0 0-0.0635 0t-0.0635 0l-0.01058-0.10583h0.84666zm0.62441 5.8631h0.03175q0.01058 0.27517 0.20108 0.47625 0.20108 0.1905 0.47625 0.1905 0 0 0.0635 0 0.07408 0 0.07408 0v0.10583h-0.84666z",style:"font-variant-caps:normal;font-variant-east-asian:normal;font-variant-ligatures:normal;font-variant-numeric:normal"}),h("path",{d:"m45.379 77.042q0.74083 0 1.3864 0.24342 0.65616 0.23283 1.143 0.67733 0.49742 0.4445 0.77258 1.0583 0.27517 0.60325 0.27517 1.3441t-0.27517 1.3547q-0.27516 0.60325-0.77258 1.0477-0.48683 0.4445-1.143 0.68791-0.64558 0.23283-1.3864 0.23283t-1.3864-0.23283q-0.64558-0.24342-1.143-0.68791-0.48683-0.4445-0.762-1.0477-0.27517-0.61383-0.27517-1.3547t0.27517-1.3441q0.27516-0.61383 0.762-1.0583 0.49742-0.4445 1.143-0.67733 0.64558-0.24342 1.3864-0.24342zm0 6.3288q0.78316 0 1.4182-0.381t1.0054-1.0583q0.37042-0.67733 0.37042-1.5663 0-0.89958-0.37042-1.5663-0.37042-0.67733-1.0054-1.0583-0.635-0.381-1.4182-0.381-0.77258 0-1.4076 0.381-0.635 0.381-1.0054 1.0583-0.37042 0.66675-0.37042 1.5663 0 0.889 0.37042 1.5663 0.37042 0.67733 1.0054 1.0583t1.4076 0.381z",style:"font-variant-caps:normal;font-variant-east-asian:normal;font-variant-ligatures:normal;font-variant-numeric:normal"}),h("path",{d:"m51.2 77.191h1.1747q0.74083 0 1.2806 0.22225 0.53975 0.21167 0.83608 0.62442 0.29633 0.40216 0.29633 0.96308 0 0.60325-0.27517 1.0372-0.26458 0.42333-0.70908 0.65616-0.4445 0.22225-0.98425 0.22225-0.53975-0.01058-1.0795-0.27516v-0.10583t0.16933 0.03175q0.17992 0.03175 0.45508 0.03175 0.27517-0.01058 0.58208-0.09525 0.30692-0.09525 0.5715-0.33867 0.27517-0.24342 0.43392-0.6985 0.04233-0.11642 0.05292-0.27516 0.02117-0.15875 0.02117-0.29633 0-0.64558-0.4445-1.016-0.4445-0.37042-1.2277-0.37042h-1.0372t-0.03175-0.07408q-0.02117-0.08467-0.05292-0.15875-0.03175-0.08467-0.03175-0.08467zm0.13758 0v6.35h-0.67733v-6.35zm-0.65616 5.6726 0.13758 0.67733h-0.92075v-0.10583t0.07408 0 0.07408 0q0.254 0 0.42333-0.16933 0.17992-0.16933 0.1905-0.40216zm0-5.0059h-0.02117q-0.01058-0.24342-0.1905-0.40217-0.16933-0.15875-0.42333-0.15875 0 0-0.07408 0t-0.07408 0v-0.10583h0.92075zm0.62441 5.0059h0.02117q0.01058 0.23283 0.17992 0.40216 0.17992 0.16933 0.43392 0.16933 0.01058 0 0.07408 0 0.07408 0 0.07408 0v0.10583h-0.92075z",style:"font-variant-caps:normal;font-variant-east-asian:normal;font-variant-ligatures:normal;font-variant-numeric:normal"}),h("path",{d:"m56.936 77.191v4.0005q0 1.0266 0.51858 1.6192 0.52916 0.59266 1.4393 0.59266 1.0054 0 1.5769-0.56092 0.58208-0.56092 0.58208-1.5346v-4.1169h0.48683v4.1169q0 1.1007-0.70908 1.7462-0.6985 0.635-1.9262 0.635-1.2171 0-1.9367-0.635-0.70908-0.635-0.70908-1.7357v-4.1275zm-0.65616 0v0.56092h-0.02117q-0.01058-0.1905-0.15875-0.3175-0.13758-0.13758-0.34925-0.13758 0 0-0.08467 0-0.07408 0-0.07408 0v-0.10583zm1.3229 0v0.10583t-0.08467 0q-0.07408 0-0.07408 0-0.20108 0-0.35983 0.13758-0.14817 0.127-0.14817 0.3175h-0.02117v-0.56092zm3.4713 0v0.56092h-0.02117q0-0.1905-0.14817-0.3175-0.14817-0.13758-0.35983-0.13758 0 0-0.08467 0-0.07408 0-0.07408 0v-0.10583zm1.1324 0v0.10583t-0.08467 0q-0.07408 0-0.07408 0-0.20108 0-0.34925 0.13758-0.14817 0.127-0.15875 0.3175h-0.02117v-0.56092z",style:"font-variant-caps:normal;font-variant-east-asian:normal;font-variant-ligatures:normal;font-variant-numeric:normal"}),h("path",{d:"m64.598 77.191v6.35h-0.67733v-6.35zm2.8469 6.0219-0.02117 0.32808h-2.8469v-0.32808zm0.59266-1.1853-0.58208 1.5134h-1.6087l0.35983-0.32808q0.52916 0 0.84666-0.14817 0.32808-0.15875 0.52916-0.42333 0.20108-0.27517 0.34925-0.61383zm-4.0957 0.83608 0.13758 0.67733h-0.92075v-0.10583t0.07408 0 0.07408 0q0.26458 0 0.43392-0.16933 0.16933-0.16933 0.17992-0.40216zm0.62442-4.9953v-0.67733h0.78316v0.10583t-0.0635 0-0.0635 0q-0.254 0-0.4445 0.16933-0.17992 0.15875-0.17992 0.40216zm-0.62442 0h-0.02117q-0.01058-0.24342-0.1905-0.40216-0.17992-0.16933-0.4445-0.16933 0 0-0.0635 0t-0.0635 0v-0.10583h0.78316z",style:"font-variant-caps:normal;font-variant-east-asian:normal;font-variant-ligatures:normal;font-variant-numeric:normal"}),h("path",{d:"m69.741 77.191v4.0005q0 1.0266 0.51858 1.6192 0.52916 0.59266 1.4393 0.59266 1.0054 0 1.5769-0.56092 0.58208-0.56092 0.58208-1.5346v-4.1169h0.48683v4.1169q0 1.1007-0.70908 1.7462-0.6985 0.635-1.9262 0.635-1.2171 0-1.9367-0.635-0.70908-0.635-0.70908-1.7357v-4.1275zm-0.65616 0v0.56092h-0.02117q-0.01058-0.1905-0.15875-0.3175-0.13758-0.13758-0.34925-0.13758 0 0-0.08467 0-0.07408 0-0.07408 0v-0.10583zm1.3229 0v0.10583t-0.08467 0q-0.07408 0-0.07408 0-0.20108 0-0.35983 0.13758-0.14817 0.127-0.14817 0.3175h-0.02117v-0.56092zm3.4713 0v0.56092h-0.02117q0-0.1905-0.14817-0.3175-0.14817-0.13758-0.35983-0.13758 0 0-0.08467 0-0.07408 0-0.07408 0v-0.10583zm1.1324 0v0.10583t-0.08467 0q-0.07408 0-0.07408 0-0.20108 0-0.34925 0.13758-0.14817 0.127-0.15875 0.3175h-0.02117v-0.56092z",style:"font-variant-caps:normal;font-variant-east-asian:normal;font-variant-ligatures:normal;font-variant-numeric:normal"}),h("path",{d:"m77.859 77.042q0.29633 0 0.51858 0.02117 0.22225 0.02117 0.381 0.05292 0.16933 0.02117 0.28575 0.0635 0.127 0.03175 0.22225 0.0635l0.01058 1.0477h-0.127q0-0.43392-0.29633-0.67733-0.29633-0.254-0.92075-0.254-0.52916 0-0.91016 0.29633-0.37042 0.28575-0.35983 0.70908 0 0.13758 0.03175 0.28575 0.04233 0.13758 0.127 0.27517 0.09525 0.13758 0.254 0.27517l2.1378 1.651q0.24342 0.20108 0.35983 0.51858 0.11642 0.30692 0.127 0.61383 0.01058 0.46566-0.24342 0.85725-0.254 0.39158-0.68791 0.62442-0.42333 0.22225-0.94191 0.22225-0.30692 0-0.66675-0.05292-0.34925-0.05292-0.65616-0.15875-0.30692-0.11642-0.508-0.28575-0.03175-0.14817-0.03175-0.37042 0-0.23283 0.03175-0.48683 0.04233-0.254 0.10583-0.45508h0.127q-0.04233 0.47625 0.13758 0.81491 0.17992 0.33866 0.52916 0.51858 0.34925 0.16933 0.81491 0.15875 0.65616-0.02117 1.0266-0.32808 0.381-0.3175 0.381-0.83608 0-0.254-0.09525-0.45508-0.08467-0.21167-0.28575-0.39158l-2.1167-1.6298q-0.29633-0.254-0.40217-0.56092t-0.10583-0.58208q0-0.43392 0.23283-0.78316t0.62442-0.55033q0.40216-0.21167 0.889-0.21167zm1.397 0.09525 0.01058 0.1905h-0.75142v-0.1905z",style:"font-variant-caps:normal;font-variant-east-asian:normal;font-variant-ligatures:normal;font-variant-numeric:normal"}))))}__webpack_require__(7675),__webpack_require__(9738),__webpack_require__(3969),__webpack_require__(998),__webpack_require__(6361),__webpack_require__(6418),__webpack_require__(5921),__webpack_require__(7147);var vy=__webpack_require__(5812),by={};function wy(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}by.styleTagTransform=Ie(),by.setAttributes=Ee(),by.insert=ke().bind(null,"head"),by.domAPI=Se(),by.insertStyleElement=Ce(),be()(vy.Z,by),vy.Z&&vy.Z.locals&&vy.Z.locals,"serviceWorker"in navigator&&window.addEventListener("load",(()=>{navigator.serviceWorker.register("service-worker.js").then((e=>{console.log("[Service Worker] registered")})).catch((e=>{console.log("[Service Worker] failed to register: ",e)}))})),window.recaptchaHandler=function(e){window.dispatchEvent(new CustomEvent("recaptcha",{detail:e}))},function(n,r,i){var s,o,l;t.__&&t.__(n,r),o=(s="function"==typeof i)?null:i&&i.__k||r.__k,l=[],A(r,n=(!s&&i||r).__k=h(m,null,[n]),o||a,a,void 0!==r.ownerSVGElement,!s&&i?[i]:o?null:r.firstChild?e.call(r.childNodes):null,l,!s&&i?i:o?o.__e:r.firstChild,s),I(l,n)}(h(class extends g{constructor(){super(),wy(this,"setInitializationStage",(e=>this.setState({initializationStage:e}))),wy(this,"logoutHandler",(e=>{localStorage.clear(),Ye.restart(),this.setState({loggedIn:!1})})),wy(this,"loginHandler",(e=>{Ye.client.on("Session.logged_out",this.logoutHandler),localStorage.setItem("accessToken",Ye.client.getAccessToken()),localStorage.setItem("userId",Ye.client.getUserId()),Ye.client.startClient().then((e=>{this.setState({initializationStage:"performing initial sync",loggedIn:!0})}))})),this.state={initializationStage:"connecting to database",loggedIn:!0};const e=new URLSearchParams(window.location.search);this.loginToken=e.get("loginToken"),localStorage.getItem("scrollbars")?document.documentElement.dataset.scrollbars=localStorage.getItem("scrollbars"):document.documentElement.dataset.scrollbars="hidden",Ye.isResumable()?Ye.initClient().then(this.loginHandler):this.loginToken?Ye.initClient().then((e=>Ye.client.loginWithToken(this.loginToken,this.loginHandler))):this.setState({loggedIn:!1})}render(e,t){return t.loggedIn?"initialized"!==t.initializationStage?h(m,null,h(Vt,null),h(fy,{initializationStage:t.initializationStage,setInitializationStage:this.setInitializationStage,logoutHandler:this.logoutHandler})):h(m,null,h(sn,null),h(Vt,null),h(pe,{history:Vn.history},h(Gg,{path:"/",logoutHandler:this.logoutHandler}),h(hy,{path:"/:pdfFocused/:pageFocused?/:roomFocused?"}))):h(ef,{loginHandler:this.loginHandler})}},null),document.body)})()})();